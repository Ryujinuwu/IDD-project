(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const z of document.querySelectorAll('link[rel="modulepreload"]'))O(z);new MutationObserver(z=>{for(const W of z)if(W.type==="childList")for(const J of W.addedNodes)J.tagName==="LINK"&&J.rel==="modulepreload"&&O(J)}).observe(document,{childList:!0,subtree:!0});function u(z){const W={};return z.integrity&&(W.integrity=z.integrity),z.referrerPolicy&&(W.referrerPolicy=z.referrerPolicy),z.crossOrigin==="use-credentials"?W.credentials="include":z.crossOrigin==="anonymous"?W.credentials="omit":W.credentials="same-origin",W}function O(z){if(z.ep)return;z.ep=!0;const W=u(z);fetch(z.href,W)}})();const style_xpd="",style_ag="";var __webpackgi_modules__={109:function(T,g,u){var O=u(352),z=u.n(O)()(function(W){return W[1]});z.push([T.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),g.Z=z},44:function(T,g,u){var O=u(352),z=u.n(O)()(function(W){return W[1]});z.push([T.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),g.Z=z},798:function(T,g,u){var O=u(352),z=u.n(O)()(function(W){return W[1]});z.push([T.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),g.Z=z},729:function(T,g,u){var O=u(352),z=u.n(O)()(function(W){return W[1]});z.push([T.id,'.button-bar{background:var(--tp-base-background-color);border:1px solid #8f949c;width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:400;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:#ccc;transition:color .25s}.button-bar-button:hover{color:#eee}.button-bar-selected{color:#fff}.button-bar-selected-box{color:#fff}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:#413762}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:#ccc;transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px}.mode-button{font-weight:400}#webgi-logo{background-image:url("https://webgi.xyz/img/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:2.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.8rem !important;color:#ddd !important}#tweakpaneUiContainer{margin-top:7.5rem}@media only screen and (min-width: 480px){#tweakpaneUiContainer{margin-top:5.5rem}}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{background-color:#d1d4e7}',""]),g.Z=z},898:function(T,g,u){var O=u(352),z=u.n(O)()(function(W){return W[1]});z.push([T.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:#eee;border:none}',""]),g.Z=z},513:function(T,g,u){var O=u(352),z=u.n(O)()(function(W){return W[1]});z.push([T.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),g.Z=z},476:function(T){var g;g=function(){return function(u){var O={};function z(W){if(O[W])return O[W].exports;var J=O[W]={i:W,l:!1,exports:{}};return u[W].call(J.exports,J,J.exports,z),J.l=!0,J.exports}return z.m=u,z.c=O,z.i=function(W){return W},z.d=function(W,J,se){z.o(W,J)||Object.defineProperty(W,J,{configurable:!1,enumerable:!0,get:se})},z.n=function(W){var J=W&&W.__esModule?function(){return W.default}:function(){return W};return z.d(J,"a",J),J},z.o=function(W,J){return Object.prototype.hasOwnProperty.call(W,J)},z.p="",z(z.s=5)}([function(u,O,z){Object.defineProperty(O,"__esModule",{value:!0});var W={convertToObject:function(J){var se=J.substring(J.indexOf("{")+1).trim().slice(0,-1),Y={};return se.split(";").map(function(ie){if(ie=ie.trim()){var oe=ie.split(":");Y[oe[0].trim()]=oe[1].trim()}}),Y},getFromSheets:function(J){var se=document.styleSheets;for(var Y in se){var ie=null;try{ie=se[Y].rules||se[Y].cssRules}catch{}if(ie){for(var oe in ie)if(ie[oe].selectorText&&ie[oe].selectorText.split(",").indexOf(J)!=-1)return ie[oe].cssText?W.convertToObject(ie[oe].cssText):W.convertToObject(ie[oe].style.cssText)}}return{}},getPropertyDefault:function(J){return J=="timing-function"?"ease":J=="iteration-count"?1:J=="direction"?"normal":J=="fill-mode"?"none":null}};O.default=W},function(u,O,z){Object.defineProperty(O,"__esModule",{value:!0});var W={generateId:function(){for(var J="",se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Y=0;Y<8;++Y)J+=se.charAt(Math.floor(Math.random()*se.length));return J},frameToString:function(J){var se="";for(var Y in J)se+=Y+":"+J[Y]+";";return se},convertTimeToMs:function(J){if(!J)return 0;if(typeof J=="number")return J;var se=parseFloat(J);return J.indexOf("ms")!=-1?se:1e3*se},prefixes:["","-webkit-","-moz-","-o-"]};O.default=W},function(u,O,z){Object.defineProperty(O,"__esModule",{value:!0});var W,J=(W=z(0))&&W.__esModule?W:{default:W};O.default=function se(Y,ie){if(function(me,de){if(!(me instanceof de))throw new TypeError("Cannot call a class as a function")}(this,se),this.styles=typeof Y=="string"?J.default.getFromSheets(Y):Y,typeof ie=="string"){var oe=J.default.getFromSheets(ie);for(var fe in this.options={},oe)this.options[fe.replace("animation-","")]=oe[fe]}else this.options=typeof ie=="number"?{duration:ie}:ie}},function(u,O,z){Object.defineProperty(O,"__esModule",{value:!0});var W=function(){function fe(me,de){for(var Pe=0;Pe<de.length;Pe++){var ue=de[Pe];ue.enumerable=ue.enumerable||!1,ue.configurable=!0,"value"in ue&&(ue.writable=!0),Object.defineProperty(me,ue.key,ue)}}return function(me,de,Pe){return de&&fe(me.prototype,de),Pe&&fe(me,Pe),me}}(),J=ie(z(4)),se=ie(z(1)),Y=ie(z(0));function ie(fe){return fe&&fe.__esModule?fe:{default:fe}}var oe=function(){function fe(me,de,Pe,ue){if(function(Fe,et){if(!(Fe instanceof et))throw new TypeError("Cannot call a class as a function")}(this,fe),me.constructor===Array?this.doms=me:this.doms=[me],de.constructor===Array?this.frames=de:this.frames=[de],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},Pe!=null&&Pe!=null)if(typeof Pe=="boolean")this.options.instant=Pe;else if(typeof Pe=="number")this.options.count=Pe,typeof ue=="boolean"&&(this.options.instant=ue);else for(var He in Pe)He=="pauseAt"&&Pe.pauseAt.constructor!==Array?this.options[He]=[Pe[He]]:this.options[He]=Pe[He];for(var je in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=se.default.prefixes:this.prefixes=[""],me)this.countRemainder[je]=this.options.count-1;this.options.instant&&this.play()}return W(fe,[{key:"play",value:function(){var me=this;for(var de in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(ue){me.promiseResolve=ue})),this.doms){var Pe=this.makeAnimation(this.doms[de]);this.animations[de]=Pe.names,this.styleDoms[de]=Pe.styleDom,this.superSets[de]=this.makeSuperSet(this.doms[de],this.animations[de]),this.playAnimation(this.doms[de],this.superSets[de]),this.eventHandler[de]=this.handleAnimationEnd.bind(this,de),this.doms[de].addEventListener("animationend",this.eventHandler[de])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(me){if(!me){for(var de in this.doms)this.clear(de);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var Pe=this.styleDoms[me];for(var ue in Pe&&Pe.parentNode&&Pe.parentNode.removeChild(Pe),this.superSets[me])for(var He in this.prefixes)this.doms[me].style[this.prefixes[He]+"animation-"+ue]=null;for(var je in this.prefixes)this.doms[me].style[this.prefixes[je]+"animation-play-state"]=null;this.doms[me].removeEventListener("animationend",this.eventHandler[me]),this.countRemainder[me]=this.options.count-1}},{key:"replay",value:function(me){var de=this.doms[me],Pe=de.cloneNode(!0);de.parentNode.replaceChild(Pe,de),this.doms[me].removeEventListener("animationend",this.eventHandler[me]),this.doms[me]=Pe,this.doms[me].addEventListener("animationend",this.eventHandler[me])}},{key:"pause",value:function(){for(var me in this.doms)this.pauseDom(this.doms[me])}},{key:"resume",value:function(){for(var me in this.doms)this.resumeDom(this.doms[me])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(me,de){var Pe=de.animationName,ue=Pe.substring(Pe.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(ue))&&this.pauseDom(this.doms[me]),ue==this.frames.length&&(this.countRemainder[me]==-1?this.replay(me):this.countRemainder[me]>0?(this.countRemainder[me]--,this.replay(me)):(this.options.applyOnEnd&&this.applyOnEnd(me),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(me){for(var de in this.prefixes)me.style[this.prefixes[de]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(me){for(var de in this.prefixes)me.style[this.prefixes[de]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(me){var de=this.newFrames[this.frames.length];for(var Pe in de)this.doms[me].style[Pe]=de[Pe]}},{key:"makeAnimation",value:function(me){var de={},Pe=[],ue={};for(var He in this.frames)for(var je in Pe.push(this.frames[He].styles),Pe[He])ue[je]=!0;var Fe=window.getComputedStyle(me);for(var et in ue)de[et]=Fe[et];Pe.unshift(de);for(var pt=[Pe[0]],Ge=1;Ge<Pe.length;++Ge){var Ye=JSON.parse(JSON.stringify(pt[Ge-1]));for(var $ in Pe[Ge])Ye[$]=Pe[Ge][$];pt.push(Ye)}return this.newFrames=pt,J.default.make(pt,this.prefixes)}},{key:"makeSuperSet",value:function(me,de){var Pe=0,ue={};for(var He in this.frames)for(var je in this.frames[He].options)ue[je]="";ue.name="",ue.duration="",ue.delay="";for(var Fe=0;Fe<this.frames.length;++Fe){if(Fe)for(var et in ue)ue[et]+=",";var pt=se.default.convertTimeToMs(this.frames[Fe].options.duration),Ge=se.default.convertTimeToMs(this.frames[Fe].options.delay);for(var Ye in Fe<this.options.startFrom&&(pt=0,Ge=0),ue.name+=de[Fe],ue.duration+=pt+"ms",ue.delay+=Pe+Ge+"ms",ue)Ye!="name"&&Ye!="duration"&&Ye!="delay"&&(ue[Ye]+=this.frames[Fe].options[Ye]?this.frames[Fe].options[Ye]:Y.default.getPropertyDefault(Ye));var $=this.frames[Fe].options["iteration-count"];Pe+=pt*parseInt($||1)+Ge}return ue}},{key:"playAnimation",value:function(me,de){for(var Pe in de)for(var ue in this.prefixes)me.style[this.prefixes[ue]+"animation-"+Pe]=de[Pe];this.options.pauseAt.includes(0)&&this.pauseDom(me)}}]),fe}();O.default=oe},function(u,O,z){Object.defineProperty(O,"__esModule",{value:!0});var W,J=(W=z(1))&&W.__esModule?W:{default:W},se={make:function(Y,ie){for(var oe=[],fe="",me="atr-"+J.default.generateId(),de=document.createElement("style"),Pe=0;Pe<Y.length-1;++Pe)oe.push(me+"-"+(Pe+1)),fe+=se.makeFromTwoFrames(Y[Pe],Y[Pe+1],oe[Pe],ie);return de.innerHTML=fe,de.class="foo",document.getElementsByTagName("head")[0].appendChild(de),{names:oe,styleDom:de}},makeFromTwoFrames:function(Y,ie,oe,fe){var me="";for(var de in fe)me+="@"+fe[de]+"keyframes "+oe+" {",me+="0%",me+="{"+J.default.frameToString(Y)+"}",me+="100%",me+="{"+J.default.frameToString(ie)+"}",me+="}";return me}};O.default=se},function(u,O,z){Object.defineProperty(O,"__esModule",{value:!0}),O.Queue=O.Frame=void 0;var W=se(z(2)),J=se(z(3));function se(Y){return Y&&Y.__esModule?Y:{default:Y}}O.Frame=W.default,O.Queue=J.default}])},T.exports=g()},352:function(T){T.exports=function(g){var u=[];return u.toString=function(){return this.map(function(O){var z=g(O);return O[2]?"@media ".concat(O[2]," {").concat(z,"}"):z}).join("")},u.i=function(O,z,W){typeof O=="string"&&(O=[[null,O,""]]);var J={};if(W)for(var se=0;se<this.length;se++){var Y=this[se][0];Y!=null&&(J[Y]=!0)}for(var ie=0;ie<O.length;ie++){var oe=[].concat(O[ie]);W&&J[oe[0]]||(z&&(oe[2]?oe[2]="".concat(z," and ").concat(oe[2]):oe[2]=z),u.push(oe))}},u}},388:function(T){T.exports=function g(u,O,z){function W(Y,ie){if(!O[Y]){if(!u[Y]){if(J)return J(Y,!0);throw new Error("Cannot find module '"+Y+"'")}var oe=O[Y]={exports:{}};u[Y][0].call(oe.exports,function(fe){return W(u[Y][1][fe]||fe)},oe,oe.exports,g,u,O,z)}return O[Y].exports}for(var J=void 0,se=0;se<z.length;se++)W(z[se]);return W}({1:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){var de=g("crypto");function Pe(Ge,Ye){return function($,le){var _e;if((_e=le.algorithm!=="passthrough"?de.createHash(le.algorithm):new pt).write===void 0&&(_e.write=_e.update,_e.end=_e.update),et(le,_e).dispatch($),_e.update||_e.end(""),_e.digest)return _e.digest(le.encoding==="buffer"?void 0:le.encoding);var qe=_e.read();return le.encoding!=="buffer"?qe.toString(le.encoding):qe}(Ge,Ye=je(Ge,Ye))}(O=u.exports=Pe).sha1=function(Ge){return Pe(Ge)},O.keys=function(Ge){return Pe(Ge,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},O.MD5=function(Ge){return Pe(Ge,{algorithm:"md5",encoding:"hex"})},O.keysMD5=function(Ge){return Pe(Ge,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var ue=de.getHashes?de.getHashes().slice():["sha1","md5"];ue.push("passthrough");var He=["buffer","hex","binary","base64"];function je(Ge,Ye){Ye=Ye||{};var $={};if($.algorithm=Ye.algorithm||"sha1",$.encoding=Ye.encoding||"hex",$.excludeValues=!!Ye.excludeValues,$.algorithm=$.algorithm.toLowerCase(),$.encoding=$.encoding.toLowerCase(),$.ignoreUnknown=Ye.ignoreUnknown===!0,$.respectType=Ye.respectType!==!1,$.respectFunctionNames=Ye.respectFunctionNames!==!1,$.respectFunctionProperties=Ye.respectFunctionProperties!==!1,$.unorderedArrays=Ye.unorderedArrays===!0,$.unorderedSets=Ye.unorderedSets!==!1,$.unorderedObjects=Ye.unorderedObjects!==!1,$.replacer=Ye.replacer||void 0,$.excludeKeys=Ye.excludeKeys||void 0,Ge===void 0)throw new Error("Object argument required.");for(var le=0;le<ue.length;++le)ue[le].toLowerCase()===$.algorithm.toLowerCase()&&($.algorithm=ue[le]);if(ue.indexOf($.algorithm)===-1)throw new Error('Algorithm "'+$.algorithm+'"  not supported. supported values: '+ue.join(", "));if(He.indexOf($.encoding)===-1&&$.algorithm!=="passthrough")throw new Error('Encoding "'+$.encoding+'"  not supported. supported values: '+He.join(", "));return $}function Fe(Ge){if(typeof Ge=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(Ge))!=null}function et(Ge,Ye,$){function le(_e){return Ye.update?Ye.update(_e,"utf8"):Ye.write(_e,"utf8")}return $=$||[],{dispatch:function(_e){return Ge.replacer&&(_e=Ge.replacer(_e)),this["_"+(_e===null?"null":typeof _e)](_e)},_object:function(_e){var qe,re=Object.prototype.toString.call(_e),he=/\[object (.*)\]/i.exec(re);if(he=(he=he?he[1]:"unknown:["+re+"]").toLowerCase(),0<=(qe=$.indexOf(_e)))return this.dispatch("[CIRCULAR:"+qe+"]");if($.push(_e),J!==void 0&&J.isBuffer&&J.isBuffer(_e))return le("buffer:"),le(_e);if(he==="object"||he==="function"||he==="asyncfunction"){var ye=Object.keys(_e);Ge.unorderedObjects&&(ye=ye.sort()),Ge.respectType===!1||Fe(_e)||ye.splice(0,0,"prototype","__proto__","constructor"),Ge.excludeKeys&&(ye=ye.filter(function(nt){return!Ge.excludeKeys(nt)})),le("object:"+ye.length+":");var Me=this;return ye.forEach(function(nt){Me.dispatch(nt),le(":"),Ge.excludeValues||Me.dispatch(_e[nt]),le(",")})}if(!this["_"+he]){if(Ge.ignoreUnknown)return le("["+he+"]");throw new Error('Unknown object type "'+he+'"')}this["_"+he](_e)},_array:function(_e,qe){qe=qe!==void 0?qe:Ge.unorderedArrays!==!1;var re=this;if(le("array:"+_e.length+":"),!qe||_e.length<=1)return _e.forEach(function(Me){return re.dispatch(Me)});var he=[],ye=_e.map(function(Me){var nt=new pt,ft=$.slice();return et(Ge,nt,ft).dispatch(Me),he=he.concat(ft.slice($.length)),nt.read().toString()});return $=$.concat(he),ye.sort(),this._array(ye,!1)},_date:function(_e){return le("date:"+_e.toJSON())},_symbol:function(_e){return le("symbol:"+_e.toString())},_error:function(_e){return le("error:"+_e.toString())},_boolean:function(_e){return le("bool:"+_e.toString())},_string:function(_e){le("string:"+_e.length+":"),le(_e.toString())},_function:function(_e){le("fn:"),Fe(_e)?this.dispatch("[native]"):this.dispatch(_e.toString()),Ge.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(_e.name)),Ge.respectFunctionProperties&&this._object(_e)},_number:function(_e){return le("number:"+_e.toString())},_xml:function(_e){return le("xml:"+_e.toString())},_null:function(){return le("Null")},_undefined:function(){return le("Undefined")},_regexp:function(_e){return le("regex:"+_e.toString())},_uint8array:function(_e){return le("uint8array:"),this.dispatch(Array.prototype.slice.call(_e))},_uint8clampedarray:function(_e){return le("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(_e))},_int8array:function(_e){return le("uint8array:"),this.dispatch(Array.prototype.slice.call(_e))},_uint16array:function(_e){return le("uint16array:"),this.dispatch(Array.prototype.slice.call(_e))},_int16array:function(_e){return le("uint16array:"),this.dispatch(Array.prototype.slice.call(_e))},_uint32array:function(_e){return le("uint32array:"),this.dispatch(Array.prototype.slice.call(_e))},_int32array:function(_e){return le("uint32array:"),this.dispatch(Array.prototype.slice.call(_e))},_float32array:function(_e){return le("float32array:"),this.dispatch(Array.prototype.slice.call(_e))},_float64array:function(_e){return le("float64array:"),this.dispatch(Array.prototype.slice.call(_e))},_arraybuffer:function(_e){return le("arraybuffer:"),this.dispatch(new Uint8Array(_e))},_url:function(_e){return le("url:"+_e.toString())},_map:function(_e){le("map:");var qe=Array.from(_e);return this._array(qe,Ge.unorderedSets!==!1)},_set:function(_e){le("set:");var qe=Array.from(_e);return this._array(qe,Ge.unorderedSets!==!1)},_file:function(_e){return le("file:"),this.dispatch([_e.name,_e.size,_e.type,_e.lastModfied])},_blob:function(){if(Ge.ignoreUnknown)return le("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return le("domwindow")},_bigint:function(_e){return le("bigint:"+_e.toString())},_process:function(){return le("process")},_timer:function(){return le("timer")},_pipe:function(){return le("pipe")},_tcp:function(){return le("tcp")},_udp:function(){return le("udp")},_tty:function(){return le("tty")},_statwatcher:function(){return le("statwatcher")},_securecontext:function(){return le("securecontext")},_connection:function(){return le("connection")},_zlib:function(){return le("zlib")},_context:function(){return le("context")},_nodescript:function(){return le("nodescript")},_httpparser:function(){return le("httpparser")},_dataview:function(){return le("dataview")},_signal:function(){return le("signal")},_fsevent:function(){return le("fsevent")},_tlswrap:function(){return le("tlswrap")}}}function pt(){return{buf:"",write:function(Ge){this.buf+=Ge},end:function(Ge){this.buf+=Ge},read:function(){return this.buf}}}O.writeToStream=function(Ge,Ye,$){return $===void 0&&($=Ye,Ye={}),et(Ye=je(Ge,Ye),$).dispatch(Ge)}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){(function(de){var Pe=typeof Uint8Array<"u"?Uint8Array:Array,ue="+".charCodeAt(0),He="/".charCodeAt(0),je="0".charCodeAt(0),Fe="a".charCodeAt(0),et="A".charCodeAt(0),pt="-".charCodeAt(0),Ge="_".charCodeAt(0);function Ye($){var le=$.charCodeAt(0);return le===ue||le===pt?62:le===He||le===Ge?63:le<je?-1:le<je+10?le-je+26+26:le<et+26?le-et:le<Fe+26?le-Fe+26:void 0}de.toByteArray=function($){var le,_e;if(0<$.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var qe=$.length,re=$.charAt(qe-2)==="="?2:$.charAt(qe-1)==="="?1:0,he=new Pe(3*$.length/4-re),ye=0<re?$.length-4:$.length,Me=0;function nt(ft){he[Me++]=ft}for(le=0;le<ye;le+=4,0)nt((16711680&(_e=Ye($.charAt(le))<<18|Ye($.charAt(le+1))<<12|Ye($.charAt(le+2))<<6|Ye($.charAt(le+3))))>>16),nt((65280&_e)>>8),nt(255&_e);return re==2?nt(255&(_e=Ye($.charAt(le))<<2|Ye($.charAt(le+1))>>4)):re==1&&(nt((_e=Ye($.charAt(le))<<10|Ye($.charAt(le+1))<<4|Ye($.charAt(le+2))>>2)>>8&255),nt(255&_e)),he},de.fromByteArray=function($){var le,_e,qe,re,he=$.length%3,ye="";function Me(nt){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(nt)}for(le=0,qe=$.length-he;le<qe;le+=3)ye+=Me((re=_e=($[le]<<16)+($[le+1]<<8)+$[le+2])>>18&63)+Me(re>>12&63)+Me(re>>6&63)+Me(63&re);switch(he){case 1:ye+=Me((_e=$[$.length-1])>>2),ye+=Me(_e<<4&63),ye+="==";break;case 2:ye+=Me((_e=($[$.length-2]<<8)+$[$.length-1])>>10),ye+=Me(_e>>4&63),ye+=Me(_e<<2&63),ye+="="}return ye}})(O===void 0?this.base64js={}:O)}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(g,u,O){(function(z,W,ue,se,Y,ie,oe,fe,me){var de=g("base64-js"),Pe=g("ieee754");function ue(be,Ve,tt){if(!(this instanceof ue))return new ue(be,Ve,tt);var Zt,bt,cn,hi,Ci,mi=typeof be;if(Ve==="base64"&&mi=="string")for(be=(Zt=be).trim?Zt.trim():Zt.replace(/^\s+|\s+$/g,"");be.length%4!=0;)be+="=";if(mi=="number")bt=Me(be);else if(mi=="string")bt=ue.byteLength(be,Ve);else{if(mi!="object")throw new Error("First argument needs to be a number, array or string.");bt=Me(be.length)}if(ue._useTypedArrays?cn=ue._augment(new Uint8Array(bt)):((cn=this).length=bt,cn._isBuffer=!0),ue._useTypedArrays&&typeof be.byteLength=="number")cn._set(be);else if(nt(Ci=be)||ue.isBuffer(Ci)||Ci&&typeof Ci=="object"&&typeof Ci.length=="number")for(hi=0;hi<bt;hi++)ue.isBuffer(be)?cn[hi]=be.readUInt8(hi):cn[hi]=be[hi];else if(mi=="string")cn.write(be,0,Ve);else if(mi=="number"&&!ue._useTypedArrays&&!tt)for(hi=0;hi<bt;hi++)cn[hi]=0;return cn}function He(be,Ve,tt,Zt){Zt||(mt(typeof tt=="boolean","missing or invalid endian"),mt(Ve!=null,"missing offset"),mt(Ve+1<be.length,"Trying to read beyond buffer length"));var bt,cn=be.length;if(!(cn<=Ve))return tt?(bt=be[Ve],Ve+1<cn&&(bt|=be[Ve+1]<<8)):(bt=be[Ve]<<8,Ve+1<cn&&(bt|=be[Ve+1])),bt}function je(be,Ve,tt,Zt){Zt||(mt(typeof tt=="boolean","missing or invalid endian"),mt(Ve!=null,"missing offset"),mt(Ve+3<be.length,"Trying to read beyond buffer length"));var bt,cn=be.length;if(!(cn<=Ve))return tt?(Ve+2<cn&&(bt=be[Ve+2]<<16),Ve+1<cn&&(bt|=be[Ve+1]<<8),bt|=be[Ve],Ve+3<cn&&(bt+=be[Ve+3]<<24>>>0)):(Ve+1<cn&&(bt=be[Ve+1]<<16),Ve+2<cn&&(bt|=be[Ve+2]<<8),Ve+3<cn&&(bt|=be[Ve+3]),bt+=be[Ve]<<24>>>0),bt}function Fe(be,Ve,tt,Zt){if(Zt||(mt(typeof tt=="boolean","missing or invalid endian"),mt(Ve!=null,"missing offset"),mt(Ve+1<be.length,"Trying to read beyond buffer length")),!(be.length<=Ve)){var bt=He(be,Ve,tt,!0);return 32768&bt?-1*(65535-bt+1):bt}}function et(be,Ve,tt,Zt){if(Zt||(mt(typeof tt=="boolean","missing or invalid endian"),mt(Ve!=null,"missing offset"),mt(Ve+3<be.length,"Trying to read beyond buffer length")),!(be.length<=Ve)){var bt=je(be,Ve,tt,!0);return 2147483648&bt?-1*(4294967295-bt+1):bt}}function pt(be,Ve,tt,Zt){return Zt||(mt(typeof tt=="boolean","missing or invalid endian"),mt(Ve+3<be.length,"Trying to read beyond buffer length")),Pe.read(be,Ve,tt,23,4)}function Ge(be,Ve,tt,Zt){return Zt||(mt(typeof tt=="boolean","missing or invalid endian"),mt(Ve+7<be.length,"Trying to read beyond buffer length")),Pe.read(be,Ve,tt,52,8)}function Ye(be,Ve,tt,Zt,bt){bt||(mt(Ve!=null,"missing value"),mt(typeof Zt=="boolean","missing or invalid endian"),mt(tt!=null,"missing offset"),mt(tt+1<be.length,"trying to write beyond buffer length"),Ct(Ve,65535));var cn=be.length;if(!(cn<=tt))for(var hi=0,Ci=Math.min(cn-tt,2);hi<Ci;hi++)be[tt+hi]=(Ve&255<<8*(Zt?hi:1-hi))>>>8*(Zt?hi:1-hi)}function $(be,Ve,tt,Zt,bt){bt||(mt(Ve!=null,"missing value"),mt(typeof Zt=="boolean","missing or invalid endian"),mt(tt!=null,"missing offset"),mt(tt+3<be.length,"trying to write beyond buffer length"),Ct(Ve,4294967295));var cn=be.length;if(!(cn<=tt))for(var hi=0,Ci=Math.min(cn-tt,4);hi<Ci;hi++)be[tt+hi]=Ve>>>8*(Zt?hi:3-hi)&255}function le(be,Ve,tt,Zt,bt){bt||(mt(Ve!=null,"missing value"),mt(typeof Zt=="boolean","missing or invalid endian"),mt(tt!=null,"missing offset"),mt(tt+1<be.length,"Trying to write beyond buffer length"),Tt(Ve,32767,-32768)),be.length<=tt||Ye(be,0<=Ve?Ve:65535+Ve+1,tt,Zt,bt)}function _e(be,Ve,tt,Zt,bt){bt||(mt(Ve!=null,"missing value"),mt(typeof Zt=="boolean","missing or invalid endian"),mt(tt!=null,"missing offset"),mt(tt+3<be.length,"Trying to write beyond buffer length"),Tt(Ve,2147483647,-2147483648)),be.length<=tt||$(be,0<=Ve?Ve:4294967295+Ve+1,tt,Zt,bt)}function qe(be,Ve,tt,Zt,bt){bt||(mt(Ve!=null,"missing value"),mt(typeof Zt=="boolean","missing or invalid endian"),mt(tt!=null,"missing offset"),mt(tt+3<be.length,"Trying to write beyond buffer length"),Ft(Ve,34028234663852886e22,-34028234663852886e22)),be.length<=tt||Pe.write(be,Ve,tt,Zt,23,4)}function re(be,Ve,tt,Zt,bt){bt||(mt(Ve!=null,"missing value"),mt(typeof Zt=="boolean","missing or invalid endian"),mt(tt!=null,"missing offset"),mt(tt+7<be.length,"Trying to write beyond buffer length"),Ft(Ve,17976931348623157e292,-17976931348623157e292)),be.length<=tt||Pe.write(be,Ve,tt,Zt,52,8)}O.Buffer=ue,O.SlowBuffer=ue,O.INSPECT_MAX_BYTES=50,ue.poolSize=8192,ue._useTypedArrays=function(){try{var be=new ArrayBuffer(0),Ve=new Uint8Array(be);return Ve.foo=function(){return 42},Ve.foo()===42&&typeof Ve.subarray=="function"}catch{return!1}}(),ue.isEncoding=function(be){switch(String(be).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ue.isBuffer=function(be){return!(be==null||!be._isBuffer)},ue.byteLength=function(be,Ve){var tt;switch(be+="",Ve||"utf8"){case"hex":tt=be.length/2;break;case"utf8":case"utf-8":tt=Mt(be).length;break;case"ascii":case"binary":case"raw":tt=be.length;break;case"base64":tt=At(be).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":tt=2*be.length;break;default:throw new Error("Unknown encoding")}return tt},ue.concat=function(be,Ve){if(mt(nt(be),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),be.length===0)return new ue(0);if(be.length===1)return be[0];if(typeof Ve!="number")for(bt=Ve=0;bt<be.length;bt++)Ve+=be[bt].length;for(var tt=new ue(Ve),Zt=0,bt=0;bt<be.length;bt++){var cn=be[bt];cn.copy(tt,Zt),Zt+=cn.length}return tt},ue.prototype.write=function(be,Ve,tt,Zt){var bt;isFinite(Ve)?isFinite(tt)||(Zt=tt,tt=void 0):(bt=Zt,Zt=Ve,Ve=tt,tt=bt),Ve=Number(Ve)||0;var cn,hi,Ci,mi,gr,Ni,qr,Er=this.length-Ve;switch((!tt||Er<(tt=Number(tt)))&&(tt=Er),Zt=String(Zt||"utf8").toLowerCase()){case"hex":cn=function(vr,Ya,Ao,Fr){Ao=Number(Ao)||0;var zr=vr.length-Ao;(!Fr||zr<(Fr=Number(Fr)))&&(Fr=zr);var Sr=Ya.length;mt(Sr%2==0,"Invalid hex string"),Sr/2<Fr&&(Fr=Sr/2);for(var Dr=0;Dr<Fr;Dr++){var _r=parseInt(Ya.substr(2*Dr,2),16);mt(!isNaN(_r),"Invalid hex string"),vr[Ao+Dr]=_r}return ue._charsWritten=2*Dr,Dr}(this,be,Ve,tt);break;case"utf8":case"utf-8":gr=be,Ni=Ve,qr=tt,cn=ue._charsWritten=Dt(Mt(gr),this,Ni,qr);break;case"ascii":case"binary":cn=function(vr,Ya,Ao,Fr){return ue._charsWritten=Dt(function(zr){for(var Sr=[],Dr=0;Dr<zr.length;Dr++)Sr.push(255&zr.charCodeAt(Dr));return Sr}(Ya),vr,Ao,Fr)}(this,be,Ve,tt);break;case"base64":hi=be,Ci=Ve,mi=tt,cn=ue._charsWritten=Dt(At(hi),this,Ci,mi);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":cn=function(vr,Ya,Ao,Fr){return ue._charsWritten=Dt(function(zr){for(var Sr,Dr,_r,Oa=[],bo=0;bo<zr.length;bo++)Dr=(Sr=zr.charCodeAt(bo))>>8,_r=Sr%256,Oa.push(_r),Oa.push(Dr);return Oa}(Ya),vr,Ao,Fr)}(this,be,Ve,tt);break;default:throw new Error("Unknown encoding")}return cn},ue.prototype.toString=function(be,Ve,tt){var Zt,bt,cn,hi,Ci=this;if(be=String(be||"utf8").toLowerCase(),Ve=Number(Ve)||0,(tt=tt!==void 0?Number(tt):tt=Ci.length)===Ve)return"";switch(be){case"hex":Zt=function(mi,gr,Ni){var qr=mi.length;(!gr||gr<0)&&(gr=0),(!Ni||Ni<0||qr<Ni)&&(Ni=qr);for(var Er="",vr=gr;vr<Ni;vr++)Er+=ft(mi[vr]);return Er}(Ci,Ve,tt);break;case"utf8":case"utf-8":Zt=function(mi,gr,Ni){var qr="",Er="";Ni=Math.min(mi.length,Ni);for(var vr=gr;vr<Ni;vr++)mi[vr]<=127?(qr+=ot(Er)+String.fromCharCode(mi[vr]),Er=""):Er+="%"+mi[vr].toString(16);return qr+ot(Er)}(Ci,Ve,tt);break;case"ascii":case"binary":Zt=function(mi,gr,Ni){var qr="";Ni=Math.min(mi.length,Ni);for(var Er=gr;Er<Ni;Er++)qr+=String.fromCharCode(mi[Er]);return qr}(Ci,Ve,tt);break;case"base64":bt=Ci,hi=tt,Zt=(cn=Ve)===0&&hi===bt.length?de.fromByteArray(bt):de.fromByteArray(bt.slice(cn,hi));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Zt=function(mi,gr,Ni){for(var qr=mi.slice(gr,Ni),Er="",vr=0;vr<qr.length;vr+=2)Er+=String.fromCharCode(qr[vr]+256*qr[vr+1]);return Er}(Ci,Ve,tt);break;default:throw new Error("Unknown encoding")}return Zt},ue.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},ue.prototype.copy=function(be,Ve,tt,Zt){if(tt=tt||0,Zt||Zt===0||(Zt=this.length),Ve=Ve||0,Zt!==tt&&be.length!==0&&this.length!==0){mt(tt<=Zt,"sourceEnd < sourceStart"),mt(0<=Ve&&Ve<be.length,"targetStart out of bounds"),mt(0<=tt&&tt<this.length,"sourceStart out of bounds"),mt(0<=Zt&&Zt<=this.length,"sourceEnd out of bounds"),Zt>this.length&&(Zt=this.length),be.length-Ve<Zt-tt&&(Zt=be.length-Ve+tt);var bt=Zt-tt;if(bt<100||!ue._useTypedArrays)for(var cn=0;cn<bt;cn++)be[cn+Ve]=this[cn+tt];else be._set(this.subarray(tt,tt+bt),Ve)}},ue.prototype.slice=function(be,Ve){var tt=this.length;if(be=ye(be,tt,0),Ve=ye(Ve,tt,tt),ue._useTypedArrays)return ue._augment(this.subarray(be,Ve));for(var Zt=Ve-be,bt=new ue(Zt,void 0,!0),cn=0;cn<Zt;cn++)bt[cn]=this[cn+be];return bt},ue.prototype.get=function(be){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(be)},ue.prototype.set=function(be,Ve){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(be,Ve)},ue.prototype.readUInt8=function(be,Ve){if(Ve||(mt(be!=null,"missing offset"),mt(be<this.length,"Trying to read beyond buffer length")),!(be>=this.length))return this[be]},ue.prototype.readUInt16LE=function(be,Ve){return He(this,be,!0,Ve)},ue.prototype.readUInt16BE=function(be,Ve){return He(this,be,!1,Ve)},ue.prototype.readUInt32LE=function(be,Ve){return je(this,be,!0,Ve)},ue.prototype.readUInt32BE=function(be,Ve){return je(this,be,!1,Ve)},ue.prototype.readInt8=function(be,Ve){if(Ve||(mt(be!=null,"missing offset"),mt(be<this.length,"Trying to read beyond buffer length")),!(be>=this.length))return 128&this[be]?-1*(255-this[be]+1):this[be]},ue.prototype.readInt16LE=function(be,Ve){return Fe(this,be,!0,Ve)},ue.prototype.readInt16BE=function(be,Ve){return Fe(this,be,!1,Ve)},ue.prototype.readInt32LE=function(be,Ve){return et(this,be,!0,Ve)},ue.prototype.readInt32BE=function(be,Ve){return et(this,be,!1,Ve)},ue.prototype.readFloatLE=function(be,Ve){return pt(this,be,!0,Ve)},ue.prototype.readFloatBE=function(be,Ve){return pt(this,be,!1,Ve)},ue.prototype.readDoubleLE=function(be,Ve){return Ge(this,be,!0,Ve)},ue.prototype.readDoubleBE=function(be,Ve){return Ge(this,be,!1,Ve)},ue.prototype.writeUInt8=function(be,Ve,tt){tt||(mt(be!=null,"missing value"),mt(Ve!=null,"missing offset"),mt(Ve<this.length,"trying to write beyond buffer length"),Ct(be,255)),Ve>=this.length||(this[Ve]=be)},ue.prototype.writeUInt16LE=function(be,Ve,tt){Ye(this,be,Ve,!0,tt)},ue.prototype.writeUInt16BE=function(be,Ve,tt){Ye(this,be,Ve,!1,tt)},ue.prototype.writeUInt32LE=function(be,Ve,tt){$(this,be,Ve,!0,tt)},ue.prototype.writeUInt32BE=function(be,Ve,tt){$(this,be,Ve,!1,tt)},ue.prototype.writeInt8=function(be,Ve,tt){tt||(mt(be!=null,"missing value"),mt(Ve!=null,"missing offset"),mt(Ve<this.length,"Trying to write beyond buffer length"),Tt(be,127,-128)),Ve>=this.length||(0<=be?this.writeUInt8(be,Ve,tt):this.writeUInt8(255+be+1,Ve,tt))},ue.prototype.writeInt16LE=function(be,Ve,tt){le(this,be,Ve,!0,tt)},ue.prototype.writeInt16BE=function(be,Ve,tt){le(this,be,Ve,!1,tt)},ue.prototype.writeInt32LE=function(be,Ve,tt){_e(this,be,Ve,!0,tt)},ue.prototype.writeInt32BE=function(be,Ve,tt){_e(this,be,Ve,!1,tt)},ue.prototype.writeFloatLE=function(be,Ve,tt){qe(this,be,Ve,!0,tt)},ue.prototype.writeFloatBE=function(be,Ve,tt){qe(this,be,Ve,!1,tt)},ue.prototype.writeDoubleLE=function(be,Ve,tt){re(this,be,Ve,!0,tt)},ue.prototype.writeDoubleBE=function(be,Ve,tt){re(this,be,Ve,!1,tt)},ue.prototype.fill=function(be,Ve,tt){if(be=be||0,Ve=Ve||0,tt=tt||this.length,typeof be=="string"&&(be=be.charCodeAt(0)),mt(typeof be=="number"&&!isNaN(be),"value is not a number"),mt(Ve<=tt,"end < start"),tt!==Ve&&this.length!==0){mt(0<=Ve&&Ve<this.length,"start out of bounds"),mt(0<=tt&&tt<=this.length,"end out of bounds");for(var Zt=Ve;Zt<tt;Zt++)this[Zt]=be}},ue.prototype.inspect=function(){for(var be=[],Ve=this.length,tt=0;tt<Ve;tt++)if(be[tt]=ft(this[tt]),tt===O.INSPECT_MAX_BYTES){be[tt+1]="...";break}return"<Buffer "+be.join(" ")+">"},ue.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(ue._useTypedArrays)return new ue(this).buffer;for(var be=new Uint8Array(this.length),Ve=0,tt=be.length;Ve<tt;Ve+=1)be[Ve]=this[Ve];return be.buffer};var he=ue.prototype;function ye(be,Ve,tt){return typeof be!="number"?tt:Ve<=(be=~~be)?Ve:0<=be||0<=(be+=Ve)?be:0}function Me(be){return(be=~~Math.ceil(+be))<0?0:be}function nt(be){return(Array.isArray||function(Ve){return Object.prototype.toString.call(Ve)==="[object Array]"})(be)}function ft(be){return be<16?"0"+be.toString(16):be.toString(16)}function Mt(be){for(var Ve=[],tt=0;tt<be.length;tt++){var Zt=be.charCodeAt(tt);if(Zt<=127)Ve.push(be.charCodeAt(tt));else{var bt=tt;55296<=Zt&&Zt<=57343&&tt++;for(var cn=encodeURIComponent(be.slice(bt,tt+1)).substr(1).split("%"),hi=0;hi<cn.length;hi++)Ve.push(parseInt(cn[hi],16))}}return Ve}function At(be){return de.toByteArray(be)}function Dt(be,Ve,tt,Zt){for(var bt=0;bt<Zt&&!(bt+tt>=Ve.length||bt>=be.length);bt++)Ve[bt+tt]=be[bt];return bt}function ot(be){try{return decodeURIComponent(be)}catch{return String.fromCharCode(65533)}}function Ct(be,Ve){mt(typeof be=="number","cannot write a non-number as a number"),mt(0<=be,"specified a negative value for writing an unsigned value"),mt(be<=Ve,"value is larger than maximum value for type"),mt(Math.floor(be)===be,"value has a fractional component")}function Tt(be,Ve,tt){mt(typeof be=="number","cannot write a non-number as a number"),mt(be<=Ve,"value larger than maximum allowed value"),mt(tt<=be,"value smaller than minimum allowed value"),mt(Math.floor(be)===be,"value has a fractional component")}function Ft(be,Ve,tt){mt(typeof be=="number","cannot write a non-number as a number"),mt(be<=Ve,"value larger than maximum allowed value"),mt(tt<=be,"value smaller than minimum allowed value")}function mt(be,Ve){if(!be)throw new Error(Ve||"Failed assertion")}ue._augment=function(be){return be._isBuffer=!0,be._get=be.get,be._set=be.set,be.get=he.get,be.set=he.set,be.write=he.write,be.toString=he.toString,be.toLocaleString=he.toString,be.toJSON=he.toJSON,be.copy=he.copy,be.slice=he.slice,be.readUInt8=he.readUInt8,be.readUInt16LE=he.readUInt16LE,be.readUInt16BE=he.readUInt16BE,be.readUInt32LE=he.readUInt32LE,be.readUInt32BE=he.readUInt32BE,be.readInt8=he.readInt8,be.readInt16LE=he.readInt16LE,be.readInt16BE=he.readInt16BE,be.readInt32LE=he.readInt32LE,be.readInt32BE=he.readInt32BE,be.readFloatLE=he.readFloatLE,be.readFloatBE=he.readFloatBE,be.readDoubleLE=he.readDoubleLE,be.readDoubleBE=he.readDoubleBE,be.writeUInt8=he.writeUInt8,be.writeUInt16LE=he.writeUInt16LE,be.writeUInt16BE=he.writeUInt16BE,be.writeUInt32LE=he.writeUInt32LE,be.writeUInt32BE=he.writeUInt32BE,be.writeInt8=he.writeInt8,be.writeInt16LE=he.writeInt16LE,be.writeInt16BE=he.writeInt16BE,be.writeInt32LE=he.writeInt32LE,be.writeInt32BE=he.writeInt32BE,be.writeFloatLE=he.writeFloatLE,be.writeFloatBE=he.writeFloatBE,be.writeDoubleLE=he.writeDoubleLE,be.writeDoubleBE=he.writeDoubleBE,be.fill=he.fill,be.inspect=he.inspect,be.toArrayBuffer=he.toArrayBuffer,be}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){J=g("buffer").Buffer;var de=new J(4);de.fill(0),u.exports={hash:function(Pe,ue,He,je){return J.isBuffer(Pe)||(Pe=new J(Pe)),function(Fe,et,pt){for(var Ge=new J(et),Ye=pt?Ge.writeInt32BE:Ge.writeInt32LE,$=0;$<Fe.length;$++)Ye.call(Ge,Fe[$],4*$,!0);return Ge}(ue(function(Fe,et){var pt;Fe.length%4!=0&&(pt=Fe.length+(4-Fe.length%4),Fe=J.concat([Fe,de],pt));for(var Ge=[],Ye=et?Fe.readInt32BE:Fe.readInt32LE,$=0;$<Fe.length;$+=4)Ge.push(Ye.call(Fe,$));return Ge}(Pe,je),8*Pe.length),He,je)}}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){J=g("buffer").Buffer;var de=g("./sha"),Pe=g("./sha256"),ue=g("./rng"),He={sha1:de,sha256:Pe,md5:g("./md5")},je=64,Fe=new J(je);function et(Ge,Ye){var $=He[Ge=Ge||"sha1"],le=[];return $||pt("algorithm:",Ge,"is not yet supported"),{update:function(_e){return J.isBuffer(_e)||(_e=new J(_e)),le.push(_e),_e.length,this},digest:function(_e){var qe=J.concat(le),re=Ye?function(he,ye,Me){J.isBuffer(ye)||(ye=new J(ye)),J.isBuffer(Me)||(Me=new J(Me)),ye.length>je?ye=he(ye):ye.length<je&&(ye=J.concat([ye,Fe],je));for(var nt=new J(je),ft=new J(je),Mt=0;Mt<je;Mt++)nt[Mt]=54^ye[Mt],ft[Mt]=92^ye[Mt];var At=he(J.concat([nt,Me]));return he(J.concat([ft,At]))}($,Ye,qe):$(qe);return le=null,_e?re.toString(_e):re}}}function pt(){var Ge=[].slice.call(arguments).join(" ");throw new Error([Ge,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Fe.fill(0),O.createHash=function(Ge){return et(Ge)},O.createHmac=et,O.randomBytes=function(Ge,Ye){if(!Ye||!Ye.call)return new J(ue(Ge));try{Ye.call(this,void 0,new J(ue(Ge)))}catch($){Ye($)}},function(Ge,Ye){for(var $ in Ge)Ye(Ge[$])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(Ge){O[Ge]=function(){pt("sorry,",Ge,"is not implemented yet")}})}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){var de=g("./helpers");function Pe(Ge,Ye){Ge[Ye>>5]|=128<<Ye%32,Ge[14+(Ye+64>>>9<<4)]=Ye;for(var $=1732584193,le=-271733879,_e=-1732584194,qe=271733878,re=0;re<Ge.length;re+=16){var he=$,ye=le,Me=_e,nt=qe;$=He($,le,_e,qe,Ge[re+0],7,-680876936),qe=He(qe,$,le,_e,Ge[re+1],12,-389564586),_e=He(_e,qe,$,le,Ge[re+2],17,606105819),le=He(le,_e,qe,$,Ge[re+3],22,-1044525330),$=He($,le,_e,qe,Ge[re+4],7,-176418897),qe=He(qe,$,le,_e,Ge[re+5],12,1200080426),_e=He(_e,qe,$,le,Ge[re+6],17,-1473231341),le=He(le,_e,qe,$,Ge[re+7],22,-45705983),$=He($,le,_e,qe,Ge[re+8],7,1770035416),qe=He(qe,$,le,_e,Ge[re+9],12,-1958414417),_e=He(_e,qe,$,le,Ge[re+10],17,-42063),le=He(le,_e,qe,$,Ge[re+11],22,-1990404162),$=He($,le,_e,qe,Ge[re+12],7,1804603682),qe=He(qe,$,le,_e,Ge[re+13],12,-40341101),_e=He(_e,qe,$,le,Ge[re+14],17,-1502002290),$=je($,le=He(le,_e,qe,$,Ge[re+15],22,1236535329),_e,qe,Ge[re+1],5,-165796510),qe=je(qe,$,le,_e,Ge[re+6],9,-1069501632),_e=je(_e,qe,$,le,Ge[re+11],14,643717713),le=je(le,_e,qe,$,Ge[re+0],20,-373897302),$=je($,le,_e,qe,Ge[re+5],5,-701558691),qe=je(qe,$,le,_e,Ge[re+10],9,38016083),_e=je(_e,qe,$,le,Ge[re+15],14,-660478335),le=je(le,_e,qe,$,Ge[re+4],20,-405537848),$=je($,le,_e,qe,Ge[re+9],5,568446438),qe=je(qe,$,le,_e,Ge[re+14],9,-1019803690),_e=je(_e,qe,$,le,Ge[re+3],14,-187363961),le=je(le,_e,qe,$,Ge[re+8],20,1163531501),$=je($,le,_e,qe,Ge[re+13],5,-1444681467),qe=je(qe,$,le,_e,Ge[re+2],9,-51403784),_e=je(_e,qe,$,le,Ge[re+7],14,1735328473),$=Fe($,le=je(le,_e,qe,$,Ge[re+12],20,-1926607734),_e,qe,Ge[re+5],4,-378558),qe=Fe(qe,$,le,_e,Ge[re+8],11,-2022574463),_e=Fe(_e,qe,$,le,Ge[re+11],16,1839030562),le=Fe(le,_e,qe,$,Ge[re+14],23,-35309556),$=Fe($,le,_e,qe,Ge[re+1],4,-1530992060),qe=Fe(qe,$,le,_e,Ge[re+4],11,1272893353),_e=Fe(_e,qe,$,le,Ge[re+7],16,-155497632),le=Fe(le,_e,qe,$,Ge[re+10],23,-1094730640),$=Fe($,le,_e,qe,Ge[re+13],4,681279174),qe=Fe(qe,$,le,_e,Ge[re+0],11,-358537222),_e=Fe(_e,qe,$,le,Ge[re+3],16,-722521979),le=Fe(le,_e,qe,$,Ge[re+6],23,76029189),$=Fe($,le,_e,qe,Ge[re+9],4,-640364487),qe=Fe(qe,$,le,_e,Ge[re+12],11,-421815835),_e=Fe(_e,qe,$,le,Ge[re+15],16,530742520),$=et($,le=Fe(le,_e,qe,$,Ge[re+2],23,-995338651),_e,qe,Ge[re+0],6,-198630844),qe=et(qe,$,le,_e,Ge[re+7],10,1126891415),_e=et(_e,qe,$,le,Ge[re+14],15,-1416354905),le=et(le,_e,qe,$,Ge[re+5],21,-57434055),$=et($,le,_e,qe,Ge[re+12],6,1700485571),qe=et(qe,$,le,_e,Ge[re+3],10,-1894986606),_e=et(_e,qe,$,le,Ge[re+10],15,-1051523),le=et(le,_e,qe,$,Ge[re+1],21,-2054922799),$=et($,le,_e,qe,Ge[re+8],6,1873313359),qe=et(qe,$,le,_e,Ge[re+15],10,-30611744),_e=et(_e,qe,$,le,Ge[re+6],15,-1560198380),le=et(le,_e,qe,$,Ge[re+13],21,1309151649),$=et($,le,_e,qe,Ge[re+4],6,-145523070),qe=et(qe,$,le,_e,Ge[re+11],10,-1120210379),_e=et(_e,qe,$,le,Ge[re+2],15,718787259),le=et(le,_e,qe,$,Ge[re+9],21,-343485551),$=pt($,he),le=pt(le,ye),_e=pt(_e,Me),qe=pt(qe,nt)}return Array($,le,_e,qe)}function ue(Ge,Ye,$,le,_e,qe){return pt((re=pt(pt(Ye,Ge),pt(le,qe)))<<(he=_e)|re>>>32-he,$);var re,he}function He(Ge,Ye,$,le,_e,qe,re){return ue(Ye&$|~Ye&le,Ge,Ye,_e,qe,re)}function je(Ge,Ye,$,le,_e,qe,re){return ue(Ye&le|$&~le,Ge,Ye,_e,qe,re)}function Fe(Ge,Ye,$,le,_e,qe,re){return ue(Ye^$^le,Ge,Ye,_e,qe,re)}function et(Ge,Ye,$,le,_e,qe,re){return ue($^(Ye|~le),Ge,Ye,_e,qe,re)}function pt(Ge,Ye){var $=(65535&Ge)+(65535&Ye);return(Ge>>16)+(Ye>>16)+($>>16)<<16|65535&$}u.exports=function(Ge){return de.hash(Ge,Pe,16)}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){var de;de=function(Pe){for(var ue,He=new Array(Pe),je=0;je<Pe;je++)!(3&je)&&(ue=4294967296*Math.random()),He[je]=ue>>>((3&je)<<3)&255;return He},u.exports=de}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){var de=g("./helpers");function Pe(je,Fe){je[Fe>>5]|=128<<24-Fe%32,je[15+(Fe+64>>9<<4)]=Fe;for(var et,pt,Ge,Ye,$,le=Array(80),_e=1732584193,qe=-271733879,re=-1732584194,he=271733878,ye=-1009589776,Me=0;Me<je.length;Me+=16){for(var nt=_e,ft=qe,Mt=re,At=he,Dt=ye,ot=0;ot<80;ot++){le[ot]=ot<16?je[Me+ot]:He(le[ot-3]^le[ot-8]^le[ot-14]^le[ot-16],1);var Ct=ue(ue(He(_e,5),(Ge=qe,Ye=re,$=he,(pt=ot)<20?Ge&Ye|~Ge&$:!(pt<40)&&pt<60?Ge&Ye|Ge&$|Ye&$:Ge^Ye^$)),ue(ue(ye,le[ot]),(et=ot)<20?1518500249:et<40?1859775393:et<60?-1894007588:-899497514));ye=he,he=re,re=He(qe,30),qe=_e,_e=Ct}_e=ue(_e,nt),qe=ue(qe,ft),re=ue(re,Mt),he=ue(he,At),ye=ue(ye,Dt)}return Array(_e,qe,re,he,ye)}function ue(je,Fe){var et=(65535&je)+(65535&Fe);return(je>>16)+(Fe>>16)+(et>>16)<<16|65535&et}function He(je,Fe){return je<<Fe|je>>>32-Fe}u.exports=function(je){return de.hash(je,Pe,20,!0)}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){function de(je,Fe){var et=(65535&je)+(65535&Fe);return(je>>16)+(Fe>>16)+(et>>16)<<16|65535&et}function Pe(je,Fe){return je>>>Fe|je<<32-Fe}function ue(je,Fe){var et,pt,Ge,Ye,$,le,_e,qe,re,he,ye=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),Me=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),nt=new Array(64);je[Fe>>5]|=128<<24-Fe%32,je[15+(Fe+64>>9<<4)]=Fe;for(var ft,Mt,At,Dt,ot,Ct,Tt,Ft,mt=0;mt<je.length;mt+=16){et=Me[0],pt=Me[1],Ge=Me[2],Ye=Me[3],$=Me[4],le=Me[5],_e=Me[6],qe=Me[7];for(var be=0;be<64;be++)nt[be]=be<16?je[be+mt]:de(de(de(Pe(Ft=nt[be-2],17)^Pe(Ft,19)^Ft>>>10,nt[be-7]),Pe(Tt=nt[be-15],7)^Pe(Tt,18)^Tt>>>3),nt[be-16]),re=de(de(de(de(qe,Pe(Ct=$,6)^Pe(Ct,11)^Pe(Ct,25)),(ot=$)&le^~ot&_e),ye[be]),nt[be]),he=de(Pe(Dt=et,2)^Pe(Dt,13)^Pe(Dt,22),(ft=et)&(Mt=pt)^ft&(At=Ge)^Mt&At),qe=_e,_e=le,le=$,$=de(Ye,re),Ye=Ge,Ge=pt,pt=et,et=de(re,he);Me[0]=de(et,Me[0]),Me[1]=de(pt,Me[1]),Me[2]=de(Ge,Me[2]),Me[3]=de(Ye,Me[3]),Me[4]=de($,Me[4]),Me[5]=de(le,Me[5]),Me[6]=de(_e,Me[6]),Me[7]=de(qe,Me[7])}return Me}var He=g("./helpers");u.exports=function(je){return He.hash(je,ue,32,!0)}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){function de(){}(z=u.exports={}).nextTick=function(){var Pe=typeof window<"u"&&window.setImmediate,ue=typeof window<"u"&&window.postMessage&&window.addEventListener;if(Pe)return function(je){return window.setImmediate(je)};if(ue){var He=[];return window.addEventListener("message",function(je){var Fe=je.source;Fe!==window&&Fe!==null||je.data!=="process-tick"||(je.stopPropagation(),0<He.length&&He.shift()())},!0),function(je){He.push(je),window.postMessage("process-tick","*")}}return function(je){setTimeout(je,0)}}(),z.title="browser",z.browser=!0,z.env={},z.argv=[],z.on=de,z.addListener=de,z.once=de,z.off=de,z.removeListener=de,z.removeAllListeners=de,z.emit=de,z.binding=function(Pe){throw new Error("process.binding is not supported")},z.cwd=function(){return"/"},z.chdir=function(Pe){throw new Error("process.chdir is not supported")}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(g,u,O){(function(z,W,J,se,Y,ie,oe,fe,me){O.read=function(de,Pe,ue,He,je){var Fe,et,pt=8*je-He-1,Ge=(1<<pt)-1,Ye=Ge>>1,$=-7,le=ue?je-1:0,_e=ue?-1:1,qe=de[Pe+le];for(le+=_e,Fe=qe&(1<<-$)-1,qe>>=-$,$+=pt;0<$;Fe=256*Fe+de[Pe+le],le+=_e,$-=8);for(et=Fe&(1<<-$)-1,Fe>>=-$,$+=He;0<$;et=256*et+de[Pe+le],le+=_e,$-=8);if(Fe===0)Fe=1-Ye;else{if(Fe===Ge)return et?NaN:1/0*(qe?-1:1);et+=Math.pow(2,He),Fe-=Ye}return(qe?-1:1)*et*Math.pow(2,Fe-He)},O.write=function(de,Pe,ue,He,je,Fe){var et,pt,Ge,Ye=8*Fe-je-1,$=(1<<Ye)-1,le=$>>1,_e=je===23?Math.pow(2,-24)-Math.pow(2,-77):0,qe=He?0:Fe-1,re=He?1:-1,he=Pe<0||Pe===0&&1/Pe<0?1:0;for(Pe=Math.abs(Pe),isNaN(Pe)||Pe===1/0?(pt=isNaN(Pe)?1:0,et=$):(et=Math.floor(Math.log(Pe)/Math.LN2),Pe*(Ge=Math.pow(2,-et))<1&&(et--,Ge*=2),2<=(Pe+=1<=et+le?_e/Ge:_e*Math.pow(2,1-le))*Ge&&(et++,Ge/=2),$<=et+le?(pt=0,et=$):1<=et+le?(pt=(Pe*Ge-1)*Math.pow(2,je),et+=le):(pt=Pe*Math.pow(2,le-1)*Math.pow(2,je),et=0));8<=je;de[ue+qe]=255&pt,qe+=re,pt/=256,je-=8);for(et=et<<je|pt,Ye+=je;0<Ye;de[ue+qe]=255&et,qe+=re,et/=256,Ye-=8);de[ue+qe-re]|=128*he}}).call(this,g("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},g("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(T){var g=function(){function u(ue){return oe(ue,fe(ie(me(ue.length),ue),1/ue.length))}function O(ue){return ie(de(ue),ue)}function z(ue,He){return fe(ue,He?1/(ue.length-1):1/ue.length)}function W(ue){var He=function(Fe){var et,pt=Math.pow(2,-52),Ge=1e-64/pt,Ye=0,$=0,le=0,_e=0,qe=0,re=Pe(Fe),he=re.length,ye=re[0].length;if(he<ye)throw"Need more rows than columns";var Me=new Array(ye),nt=new Array(ye);for($=0;$<ye;$++)Me[$]=nt[$]=0;var ft=function Zt(bt,cn,hi){hi===void 0&&(hi=0);var Ci,mi=bt[hi],gr=Array(mi);if(hi===bt.length-1){for(Ci=mi-2;Ci>=0;Ci-=2)gr[Ci+1]=cn,gr[Ci]=cn;return Ci===-1&&(gr[0]=cn),gr}for(Ci=mi-1;Ci>=0;Ci--)gr[Ci]=Zt(bt,cn,hi+1);return gr}([ye,ye],0);function Mt(Zt,bt){return(Zt=Math.abs(Zt))>(bt=Math.abs(bt))?Zt*Math.sqrt(1+bt*bt/Zt/Zt):bt==0?Zt:bt*Math.sqrt(1+Zt*Zt/bt/bt)}var At=0,Dt=0,ot=0,Ct=0,Tt=0,Ft=0,mt=0;for($=0;$<ye;$++){for(Me[$]=Dt,mt=0,qe=$+1,le=$;le<he;le++)mt+=re[le][$]*re[le][$];if(mt<=Ge)Dt=0;else for(At=re[$][$],Dt=Math.sqrt(mt),At>=0&&(Dt=-Dt),ot=At*Dt-mt,re[$][$]=At-Dt,le=qe;le<ye;le++){for(mt=0,_e=$;_e<he;_e++)mt+=re[_e][$]*re[_e][le];for(At=mt/ot,_e=$;_e<he;_e++)re[_e][le]+=At*re[_e][$]}for(nt[$]=Dt,mt=0,le=qe;le<ye;le++)mt+=re[$][le]*re[$][le];if(mt<=Ge)Dt=0;else{for(At=re[$][$+1],Dt=Math.sqrt(mt),At>=0&&(Dt=-Dt),ot=At*Dt-mt,re[$][$+1]=At-Dt,le=qe;le<ye;le++)Me[le]=re[$][le]/ot;for(le=qe;le<he;le++){for(mt=0,_e=qe;_e<ye;_e++)mt+=re[le][_e]*re[$][_e];for(_e=qe;_e<ye;_e++)re[le][_e]+=mt*Me[_e]}}(Tt=Math.abs(nt[$])+Math.abs(Me[$]))>Ct&&(Ct=Tt)}for($=ye-1;$!=-1;$+=-1){if(Dt!=0){for(ot=Dt*re[$][$+1],le=qe;le<ye;le++)ft[le][$]=re[$][le]/ot;for(le=qe;le<ye;le++){for(mt=0,_e=qe;_e<ye;_e++)mt+=re[$][_e]*ft[_e][le];for(_e=qe;_e<ye;_e++)ft[_e][le]+=mt*ft[_e][$]}}for(le=qe;le<ye;le++)ft[$][le]=0,ft[le][$]=0;ft[$][$]=1,Dt=Me[$],qe=$}for($=ye-1;$!=-1;$+=-1){for(qe=$+1,Dt=nt[$],le=qe;le<ye;le++)re[$][le]=0;if(Dt!=0){for(ot=re[$][$]*Dt,le=qe;le<ye;le++){for(mt=0,_e=qe;_e<he;_e++)mt+=re[_e][$]*re[_e][le];for(At=mt/ot,_e=$;_e<he;_e++)re[_e][le]+=At*re[_e][$]}for(le=$;le<he;le++)re[le][$]=re[le][$]/Dt}else for(le=$;le<he;le++)re[le][$]=0;re[$][$]+=1}for(pt*=Ct,_e=ye-1;_e!=-1;_e+=-1)for(var be=0;be<50;be++){var Ve=!1;for(qe=_e;qe!=-1;qe+=-1){if(Math.abs(Me[qe])<=pt){Ve=!0;break}if(Math.abs(nt[qe-1])<=pt)break}if(!Ve){Ye=0,mt=1;var tt=qe-1;for($=qe;$<_e+1&&(At=mt*Me[$],Me[$]=Ye*Me[$],!(Math.abs(At)<=pt));$++)for(ot=Mt(At,Dt=nt[$]),nt[$]=ot,Ye=Dt/ot,mt=-At/ot,le=0;le<he;le++)Tt=re[le][tt],Ft=re[le][$],re[le][tt]=Tt*Ye+Ft*mt,re[le][$]=-Tt*mt+Ft*Ye}if(Ft=nt[_e],qe==_e){if(Ft<0)for(nt[_e]=-Ft,le=0;le<ye;le++)ft[le][_e]=-ft[le][_e];break}if(be>=49)throw"Error: no convergence.";for(Ct=nt[qe],Dt=Mt(At=(((Tt=nt[_e-1])-Ft)*(Tt+Ft)+((Dt=Me[_e-1])-(ot=Me[_e]))*(Dt+ot))/(2*ot*Tt),1),At=At<0?((Ct-Ft)*(Ct+Ft)+ot*(Tt/(At-Dt)-ot))/Ct:((Ct-Ft)*(Ct+Ft)+ot*(Tt/(At+Dt)-ot))/Ct,Ye=1,mt=1,$=qe+1;$<_e+1;$++){for(Dt=Me[$],Tt=nt[$],ot=mt*Dt,Dt*=Ye,Ft=Mt(At,ot),Me[$-1]=Ft,At=Ct*(Ye=At/Ft)+Dt*(mt=ot/Ft),Dt=-Ct*mt+Dt*Ye,ot=Tt*mt,Tt*=Ye,le=0;le<ye;le++)Ct=ft[le][$-1],Ft=ft[le][$],ft[le][$-1]=Ct*Ye+Ft*mt,ft[le][$]=-Ct*mt+Ft*Ye;for(Ft=Mt(At,ot),nt[$-1]=Ft,At=(Ye=At/Ft)*Dt+(mt=ot/Ft)*Tt,Ct=-mt*Dt+Ye*Tt,le=0;le<he;le++)Tt=re[le][$-1],Ft=re[le][$],re[le][$-1]=Tt*Ye+Ft*mt,re[le][$]=-Tt*mt+Ft*Ye}Me[qe]=0,Me[_e]=At,nt[_e]=Ct}for($=0;$<nt.length;$++)nt[$]<pt&&(nt[$]=0);for($=0;$<ye;$++)for(le=$-1;le>=0;le--)if(nt[le]<nt[$]){for(Ye=nt[le],nt[le]=nt[$],nt[$]=Ye,_e=0;_e<re.length;_e++)et=re[_e][$],re[_e][$]=re[_e][le],re[_e][le]=et;for(_e=0;_e<ft.length;_e++)et=ft[_e][$],ft[_e][$]=ft[_e][le],ft[_e][le]=et;$=le}return{U:re,S:nt,V:ft}}(ue);console.log(He);var je=He.U;return He.S.map(function(Fe,et){var pt={};return pt.eigenvalue=Fe,pt.vector=je.map(function(Ge,Ye){return-1*Ge[et]}),pt})}function J(ue,...He){var je=He.map(function(pt){return pt.vector}),Fe=ie(je,de(u(ue))),et=fe(ie(me(ue.length),ue),-1/ue.length);return{adjustedData:Fe,formattedAdjustedData:Y(Fe,2),avgData:et,selectedVectors:je}}function se(ue){return W(z(O(u(ue)),!1))}function Y(ue,He){var je=Math.pow(10,He||2);return ue.map(function(Fe,et){return Fe.map(function(pt){return Math.round(pt*je)/je})})}function ie(ue,He){if(!(ue[0]&&He[0]&&ue.length&&He.length))throw new Error("Both A and B should be matrices");if(He.length!==ue[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var je=[],Fe=0;Fe<ue.length;Fe++){je[Fe]=[];for(var et=0;et<He[0].length;et++)for(var pt=0;pt<ue[0].length;pt++)je[Fe][et]=je[Fe][et]?je[Fe][et]+ue[Fe][pt]*He[pt][et]:ue[Fe][pt]*He[pt][et]}return je}function oe(ue,He){if(ue.length!==He.length||ue[0].length!==He[0].length)throw new Error("Both A and B should have the same dimensions");for(var je=[],Fe=0;Fe<ue.length;Fe++){je[Fe]=[];for(var et=0;et<He[0].length;et++)je[Fe][et]=ue[Fe][et]-He[Fe][et]}return je}function fe(ue,He){for(var je=[],Fe=0;Fe<ue.length;Fe++){je[Fe]=[];for(var et=0;et<ue[0].length;et++)je[Fe][et]=ue[Fe][et]*He}return je}function me(ue){for(var He=[],je=0;je<ue;je++){He[je]=[];for(var Fe=0;Fe<ue;Fe++)He[je][Fe]=1}return He}function de(ue){return Pe(ue)[0].map(function(He,je){return ue.map(function(Fe){return Fe[je]})})}function Pe(ue){var He=JSON.stringify(ue);return JSON.parse(He)}return{computeDeviationScores:O,computeDeviationMatrix:u,computeSVD:W,computePercentageExplained:function(ue,...He){var je=ue.map(function(Fe){return Fe.eigenvalue}).reduce(function(Fe,et){return Fe+et});return He.map(function(Fe){return Fe.eigenvalue}).reduce(function(Fe,et){return Fe+et})/je},computeOriginalData:function(ue,He,je){var Fe=oe(de(ie(de(He),ue)),je);return{originalData:Fe,formattedOriginalData:Y(Fe,2)}},computeVarianceCovariance:z,computeAdjustedData:J,getEigenVectors:se,analyseTopResult:function(ue){var He=se(ue).sort(function(je,Fe){return Fe.eigenvalue-je.eigenvalue});return console.log("Sorted Vectors",He),J(ue,He[0].vector)},transpose:de,multiply:ie,clone:Pe,scale:fe}}();T.exports=g},701:function(T){var g=[];function u(W){for(var J=-1,se=0;se<g.length;se++)if(g[se].identifier===W){J=se;break}return J}function O(W,J){for(var se={},Y=[],ie=0;ie<W.length;ie++){var oe=W[ie],fe=J.base?oe[0]+J.base:oe[0],me=se[fe]||0,de="".concat(fe," ").concat(me);se[fe]=me+1;var Pe=u(de),ue={css:oe[1],media:oe[2],sourceMap:oe[3],supports:oe[4],layer:oe[5]};if(Pe!==-1)g[Pe].references++,g[Pe].updater(ue);else{var He=z(ue,J);J.byIndex=ie,g.splice(ie,0,{identifier:de,updater:He,references:1})}Y.push(de)}return Y}function z(W,J){var se=J.domAPI(J);return se.update(W),function(Y){if(Y){if(Y.css===W.css&&Y.media===W.media&&Y.sourceMap===W.sourceMap&&Y.supports===W.supports&&Y.layer===W.layer)return;se.update(W=Y)}else se.remove()}}T.exports=function(W,J){var se=O(W=W||[],J=J||{});return function(Y){Y=Y||[];for(var ie=0;ie<se.length;ie++){var oe=u(se[ie]);g[oe].references--}for(var fe=O(Y,J),me=0;me<se.length;me++){var de=u(se[me]);g[de].references===0&&(g[de].updater(),g.splice(de,1))}se=fe}}},182:function(T){T.exports=function(g){var u=document.createElement("style");return g.setAttributes(u,g.attributes),g.insert(u,g.options),u}},850:function(T,g,u){T.exports=function(O){var z=u.nc;z&&O.setAttribute("nonce",z)}},236:function(T){T.exports=function(g){var u=g.insertStyleElement(g);return{update:function(O){(function(z,W,J){var se="";J.supports&&(se+="@supports (".concat(J.supports,") {")),J.media&&(se+="@media ".concat(J.media," {"));var Y=J.layer!==void 0;Y&&(se+="@layer".concat(J.layer.length>0?" ".concat(J.layer):""," {")),se+=J.css,Y&&(se+="}"),J.media&&(se+="}"),J.supports&&(se+="}");var ie=J.sourceMap;ie&&typeof btoa<"u"&&(se+=`
/`,se+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(ie))))," *"),se+="/"),W.styleTagTransform(se,z,W.options)})(u,g,O)},remove:function(){(function(O){if(O.parentNode===null)return!1;O.parentNode.removeChild(O)})(u)}}}},213:function(T){T.exports=function(g,u){if(u.styleSheet)u.styleSheet.cssText=g;else{for(;u.firstChild;)u.removeChild(u.firstChild);u.appendChild(document.createTextNode(g))}}},1:function(T){T.exports=function(){var g={820:function(W,J,se){var Y=se(537),ie=se.n(Y),oe=se(645),fe=se.n(oe)()(ie());fe.push([W.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),J.Z=fe},645:function(W){W.exports=function(J){var se=[];return se.toString=function(){return this.map(function(Y){var ie="",oe=Y[5]!==void 0;return Y[4]&&(ie+="@supports (".concat(Y[4],") {")),Y[2]&&(ie+="@media ".concat(Y[2]," {")),oe&&(ie+="@layer".concat(Y[5].length>0?" ".concat(Y[5]):""," {")),ie+=J(Y),oe&&(ie+="}"),Y[2]&&(ie+="}"),Y[4]&&(ie+="}"),ie}).join("")},se.i=function(Y,ie,oe,fe,me){typeof Y=="string"&&(Y=[[null,Y,void 0]]);var de={};if(oe)for(var Pe=0;Pe<this.length;Pe++){var ue=this[Pe][0];ue!=null&&(de[ue]=!0)}for(var He=0;He<Y.length;He++){var je=[].concat(Y[He]);oe&&de[je[0]]||(me!==void 0&&(je[5]===void 0||(je[1]="@layer".concat(je[5].length>0?" ".concat(je[5]):""," {").concat(je[1],"}")),je[5]=me),ie&&(je[2]&&(je[1]="@media ".concat(je[2]," {").concat(je[1],"}")),je[2]=ie),fe&&(je[4]?(je[1]="@supports (".concat(je[4],") {").concat(je[1],"}"),je[4]=fe):je[4]="".concat(fe)),se.push(je))}},se}},537:function(W){W.exports=function(J){var se=J[1],Y=J[3];if(!Y)return se;if(typeof btoa=="function"){var ie=btoa(unescape(encodeURIComponent(JSON.stringify(Y)))),oe="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(ie),fe="/*# ".concat(oe," */"),me=Y.sources.map(function(de){return"/*# sourceURL=".concat(Y.sourceRoot||"").concat(de," */")});return[se].concat(me).concat([fe]).join(`
`)}return[se].join(`
`)}},379:function(W){var J=[];function se(oe){for(var fe=-1,me=0;me<J.length;me++)if(J[me].identifier===oe){fe=me;break}return fe}function Y(oe,fe){for(var me={},de=[],Pe=0;Pe<oe.length;Pe++){var ue=oe[Pe],He=fe.base?ue[0]+fe.base:ue[0],je=me[He]||0,Fe="".concat(He," ").concat(je);me[He]=je+1;var et=se(Fe),pt={css:ue[1],media:ue[2],sourceMap:ue[3],supports:ue[4],layer:ue[5]};if(et!==-1)J[et].references++,J[et].updater(pt);else{var Ge=ie(pt,fe);fe.byIndex=Pe,J.splice(Pe,0,{identifier:Fe,updater:Ge,references:1})}de.push(Fe)}return de}function ie(oe,fe){var me=fe.domAPI(fe);return me.update(oe),function(de){if(de){if(de.css===oe.css&&de.media===oe.media&&de.sourceMap===oe.sourceMap&&de.supports===oe.supports&&de.layer===oe.layer)return;me.update(oe=de)}else me.remove()}}W.exports=function(oe,fe){var me=Y(oe=oe||[],fe=fe||{});return function(de){de=de||[];for(var Pe=0;Pe<me.length;Pe++){var ue=se(me[Pe]);J[ue].references--}for(var He=Y(de,fe),je=0;je<me.length;je++){var Fe=se(me[je]);J[Fe].references===0&&(J[Fe].updater(),J.splice(Fe,1))}me=He}}},216:function(W){W.exports=function(J){var se=document.createElement("style");return J.setAttributes(se,J.attributes),J.insert(se,J.options),se}},636:function(W,J,se){W.exports=function(Y){var ie=se.nc;ie&&Y.setAttribute("nonce",ie)}},795:function(W){W.exports=function(J){var se=J.insertStyleElement(J);return{update:function(Y){(function(ie,oe,fe){var me="";fe.supports&&(me+="@supports (".concat(fe.supports,") {")),fe.media&&(me+="@media ".concat(fe.media," {"));var de=fe.layer!==void 0;de&&(me+="@layer".concat(fe.layer.length>0?" ".concat(fe.layer):""," {")),me+=fe.css,de&&(me+="}"),fe.media&&(me+="}"),fe.supports&&(me+="}");var Pe=fe.sourceMap;Pe&&typeof btoa<"u"&&(me+=`
/`,me+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(Pe))))," *"),me+="/"),oe.styleTagTransform(me,ie,oe.options)})(se,J,Y)},remove:function(){(function(Y){if(Y.parentNode===null)return!1;Y.parentNode.removeChild(Y)})(se)}}}},589:function(W){W.exports=function(J,se){if(se.styleSheet)se.styleSheet.cssText=J;else{for(;se.firstChild;)se.removeChild(se.firstChild);se.appendChild(document.createTextNode(J))}}}},u={};function O(W){var J=u[W];if(J!==void 0)return J.exports;var se=u[W]={id:W,exports:{}};return g[W](se,se.exports,O),se.exports}O.n=function(W){var J=W&&W.__esModule?function(){return W.default}:function(){return W};return O.d(J,{a:J}),J},O.d=function(W,J){for(var se in J)O.o(J,se)&&!O.o(W,se)&&Object.defineProperty(W,se,{enumerable:!0,get:J[se]})},O.o=function(W,J){return Object.prototype.hasOwnProperty.call(W,J)},O.nc=void 0;var z={};return function(){O.d(z,{default:function(){return nt}});var W=O(379),J=O.n(W),se=O(795),Y=O.n(se),ie=O(636),oe=O.n(ie),fe=O(216),me=O.n(fe),de=O(589),Pe=O.n(de),ue=O(820),He={};ue.Z&&ue.Z.locals&&(He.locals=ue.Z.locals);var je,Fe=0,et={};et.styleTagTransform=Pe(),et.setAttributes=oe(),et.insert=function(ft,Mt){(Mt.target||document.head).appendChild(ft)},et.domAPI=Y(),et.insertStyleElement=me(),He.use=function(ft){return et.options=ft||{},Fe++||(je=J()(ue.Z,et)),He},He.unuse=function(){Fe>0&&!--Fe&&(je(),je=null)};var pt=He;function Ge(ft,Mt){return function(At){if(Array.isArray(At))return At}(ft)||function(At,Dt){var ot=At==null?null:typeof Symbol<"u"&&At[Symbol.iterator]||At["@@iterator"];if(ot!=null){var Ct,Tt,Ft=[],mt=!0,be=!1;try{for(ot=ot.call(At);!(mt=(Ct=ot.next()).done)&&(Ft.push(Ct.value),!Dt||Ft.length!==Dt);mt=!0);}catch(Ve){be=!0,Tt=Ve}finally{try{mt||ot.return==null||ot.return()}finally{if(be)throw Tt}}return Ft}}(ft,Mt)||function(At,Dt){if(At){if(typeof At=="string")return Ye(At,Dt);var ot=Object.prototype.toString.call(At).slice(8,-1);return ot==="Object"&&At.constructor&&(ot=At.constructor.name),ot==="Map"||ot==="Set"?Array.from(At):ot==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ot)?Ye(At,Dt):void 0}}(ft,Mt)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ye(ft,Mt){(Mt==null||Mt>ft.length)&&(Mt=ft.length);for(var At=0,Dt=new Array(Mt);At<Mt;At++)Dt[At]=ft[At];return Dt}function $(ft,Mt){var At=Object.keys(ft);if(Object.getOwnPropertySymbols){var Dt=Object.getOwnPropertySymbols(ft);Mt&&(Dt=Dt.filter(function(ot){return Object.getOwnPropertyDescriptor(ft,ot).enumerable})),At.push.apply(At,Dt)}return At}function le(ft){for(var Mt=1;Mt<arguments.length;Mt++){var At=arguments[Mt]!=null?arguments[Mt]:{};Mt%2?$(Object(At),!0).forEach(function(Dt){_e(ft,Dt,At[Dt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ft,Object.getOwnPropertyDescriptors(At)):$(Object(At)).forEach(function(Dt){Object.defineProperty(ft,Dt,Object.getOwnPropertyDescriptor(At,Dt))})}return ft}function _e(ft,Mt,At){return Mt in ft?Object.defineProperty(ft,Mt,{value:At,enumerable:!0,configurable:!0,writable:!0}):ft[Mt]=At,ft}function qe(ft,Mt){for(var At=0;At<Mt.length;At++){var Dt=Mt[At];Dt.enumerable=Dt.enumerable||!1,Dt.configurable=!0,"value"in Dt&&(Dt.writable=!0),Object.defineProperty(ft,Dt.key,Dt)}}function re(ft){var Mt={};return ft.reduce(function(At,Dt){return Mt[Dt]||(Mt[Dt]=!0,At.push(Dt)),At},[])}function he(ft,Mt){requestAnimationFrame(function(){Mt.enter(),requestAnimationFrame(function(){Mt.active(),setTimeout(function(){Mt.leave()},ft)})})}function ye(ft,Mt){try{var At=ft.liElementsById[Mt.parent.id];At.classList.contains("treejs-node__close")||At.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(Mt,"parent")&&ye(ft,Mt.parent)}function Me(ft,Mt){var At=ft.liElementsById[Mt.id];At.classList.contains("treejs-node__close")&&At.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(Mt,"children")&&Mt.children.forEach(function(Dt){return Me(ft,Dt)})}var nt=function(){function ft(ot,Ct){(function(Tt,Ft){if(!(Tt instanceof Ft))throw new TypeError("Cannot call a class as a function")})(this,ft),pt.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=ot,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},Ct),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(Tt){this.setValues(re(Tt))}},disables:{get:function(){return this.getDisables()},set:function(Tt){this.setDisables(re(Tt))}},selectedNodes:{get:function(){var Tt=[],Ft=this.nodesById;return Object.keys(Ft).forEach(function(mt){if(Object.prototype.hasOwnProperty.call(Ft,mt)&&(Ft[mt].status===1||Ft[mt].status===2)){var be=le({},Ft[mt]);delete be.parent,delete be.children,Tt.push(be)}}),Tt}},disabledNodes:{get:function(){var Tt=[],Ft=this.nodesById;return Object.keys(Ft).forEach(function(mt){if(Object.prototype.hasOwnProperty.call(Ft,mt)&&Ft[mt].disabled){var be=le({},Ft[mt]);delete be.parent,Tt.push(be)}}),Tt}}}),this.init(this.options.data)}var Mt,At,Dt;return Mt=ft,Dt=[{key:"onSwitcherClick",value:function(ot){var Ct=ot.parentNode,Tt=Ct.lastChild,Ft=Tt.scrollHeight;Ct.classList.contains("treejs-node__close")?he(150,{enter:function(){Tt.style.height=0,Tt.style.opacity=0},active:function(){Tt.style.height="".concat(Ft,"px"),Tt.style.opacity=1},leave:function(){Tt.style.height="",Tt.style.opacity="",Ct.classList.remove("treejs-node__close")}}):he(150,{enter:function(){Tt.style.height="".concat(Ft,"px"),Tt.style.opacity=1},active:function(){Tt.style.height=0,Tt.style.opacity=0},leave:function(){Tt.style.height="",Tt.style.opacity="",Ct.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(ot){var Ct,Tt=(Ct=ot,JSON.parse(JSON.stringify(Ct))),Ft={},mt={},be=[],Ve=[];return function tt(Zt,bt){Zt.forEach(function(cn){Ft[cn.id]=cn,cn.checked&&be.push(cn.id),cn.disabled&&Ve.push(cn.id),bt&&(cn.parent=bt),cn.children&&cn.children.length?tt(cn.children,cn):mt[cn.id]=cn})}(Tt),{treeNodes:Tt,nodesById:Ft,leafNodesById:mt,defaultValues:be,defaultDisables:Ve}}},{key:"createRootEle",value:function(){var ot=document.createElement("div");return ot.classList.add("treejs"),ot}},{key:"createUlEle",value:function(){var ot=document.createElement("ul");return ot.classList.add("treejs-nodes"),ot}},{key:"createLiEle",value:function(ot,Ct){var Tt=document.createElement("li");if(Tt.classList.add("treejs-node"),Ct&&Tt.classList.add("treejs-node__close"),ot.children&&ot.children.length){var Ft=document.createElement("span");Ft.classList.add("treejs-switcher"),Tt.appendChild(Ft)}else Tt.classList.add("treejs-placeholder");var mt=document.createElement("span");mt.classList.add("treejs-checkbox"),Tt.appendChild(mt);var be=document.createElement("span");be.classList.add("treejs-label");var Ve=document.createTextNode(ot.text);return be.appendChild(Ve),Tt.appendChild(be),Tt.nodeId=ot.id,Tt}}],(At=[{key:"init",value:function(ot){var Ct=ft.parseTreeData(ot),Tt=Ct.treeNodes,Ft=Ct.nodesById,mt=Ct.leafNodesById,be=Ct.defaultValues,Ve=Ct.defaultDisables;this.treeNodes=Tt,this.nodesById=Ft,this.leafNodesById=mt,this.render(this.treeNodes);var tt=this.options,Zt=tt.values,bt=tt.disables,cn=tt.loaded;Zt&&Zt.length?this.setValues(Zt):be&&be.length&&this.setValues(be),bt&&bt.length?this.setDisables(bt):Ve&&Ve.length&&this.setDisables(Ve),typeof cn=="function"&&cn.call(this)}},{key:"render",value:function(ot){var Ct=ft.createRootEle();Ct.appendChild(this.buildTree(ot,0)),this.bindEvent(Ct);var Tt=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Ft){for(;Ft.firstChild;)Ft.removeChild(Ft.firstChild)})(Tt),Tt.appendChild(Ct)}},{key:"buildTree",value:function(ot,Ct){var Tt=this,Ft=ft.createUlEle();return ot&&ot.length&&ot.forEach(function(mt){var be=ft.createLiEle(mt,Ct===Tt.options.closeDepth-1);Tt.liElementsById[mt.id]=be;var Ve=null;mt.children&&mt.children.length&&(Ve=Tt.buildTree(mt.children,Ct+1)),Ve&&be.appendChild(Ve),Ft.appendChild(be)}),Ft}},{key:"bindEvent",value:function(ot){var Ct=this;ot.addEventListener("click",function(Tt){var Ft=Tt.target;Ft.nodeName==="SPAN"&&Ft.classList.contains("treejs-checkbox")?Ct.onItemClick(Ft.parentNode.nodeId):Ft.nodeName==="SPAN"&&Ft.classList.contains("treejs-label")?Ct.onItemLabelClick(Ft.parentNode.nodeId):Ft.nodeName==="LI"&&Ft.classList.contains("treejs-node")?Ct.onItemClick(Ft.nodeId):Ft.nodeName==="SPAN"&&Ft.classList.contains("treejs-switcher")&&ft.onSwitcherClick(Ft)},!1)}},{key:"onItemClick",value:function(ot){var Ct=this.nodesById[ot],Tt=this.options.onChange;Ct.disabled||(this.setValue(ot),this.updateLiElements()),Tt&&Tt.call(this)}},{key:"onItemLabelClick",value:function(ot){var Ct=this.options.onItemLabelClick;Ct&&Ct.call(this,ot)}},{key:"setValue",value:function(ot){var Ct=this.nodesById[ot];if(Ct){var Tt=Ct.status,Ft=Tt===1||Tt===2?0:2;Ct.status=Ft,this.markWillUpdateNode(Ct),this.walkUp(Ct,"status"),this.walkDown(Ct,"status")}}},{key:"getValues",value:function(){var ot=this,Ct=[];return Object.keys(this.leafNodesById).forEach(function(Tt){Object.prototype.hasOwnProperty.call(ot.leafNodesById,Tt)&&(ot.leafNodesById[Tt].status!==1&&ot.leafNodesById[Tt].status!==2||Ct.push(Tt))}),Ct}},{key:"setValues",value:function(ot){var Ct=this;this.emptyNodesCheckStatus(),ot.forEach(function(Ft){Ct.setValue(Ft)}),this.updateLiElements();var Tt=this.options.onChange;Tt&&Tt.call(this)}},{key:"setDisable",value:function(ot){var Ct=this.nodesById[ot];Ct&&(Ct.disabled||(Ct.disabled=!0,this.markWillUpdateNode(Ct),this.walkUp(Ct,"disabled"),this.walkDown(Ct,"disabled")))}},{key:"getDisables",value:function(){var ot=this,Ct=[];return Object.keys(this.leafNodesById).forEach(function(Tt){Object.prototype.hasOwnProperty.call(ot.leafNodesById,Tt)&&ot.leafNodesById[Tt].disabled&&Ct.push(Tt)}),Ct}},{key:"setDisables",value:function(ot){var Ct=this;this.emptyNodesDisable(),ot.forEach(function(Tt){Ct.setDisable(Tt)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(ot){ot.disabled||(ot.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(ot){ot.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(ot,Ct){var Tt=Ge(Ct,2),Ft=Tt[0],mt=Tt[1];return mt.status!==1&&mt.status!==2||(ot[Ft]=mt),ot},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(ot,Ct){var Tt=Ge(Ct,2),Ft=Tt[0],mt=Tt[1];return mt.disabled&&(ot[Ft]=mt),ot},{})}},{key:"updateLiElements",value:function(){var ot=this;Object.values(this.willUpdateNodesById).forEach(function(Ct){ot.updateLiElement(Ct)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(ot){this.willUpdateNodesById[ot.id]=ot}},{key:"walkUp",value:function(ot,Ct){var Tt=ot.parent;if(Tt){if(Ct==="status"){var Ft,mt=Tt.children.reduce(function(Ve,tt){return Number.isNaN(tt.status)?Ve:Ve+tt.status},0);if(Ft=mt?mt===2*Tt.children.length?2:1:0,Tt.status===Ft)return;Tt.status=Ft}else{var be=Tt.children.reduce(function(Ve,tt){return Ve&&tt.disabled},!0);if(Tt.disabled===be)return;Tt.disabled=be}this.markWillUpdateNode(Tt),this.walkUp(Tt,Ct)}}},{key:"walkDown",value:function(ot,Ct){var Tt=this;ot.children&&ot.children.length&&ot.children.forEach(function(Ft){Ct==="status"&&Ft.disabled||(Ft[Ct]=ot[Ct],Tt.markWillUpdateNode(Ft),Tt.walkDown(Ft,Ct))})}},{key:"updateLiElement",value:function(ot){var Ct=this.liElementsById[ot.id].classList;switch(ot.status){case 0:Ct.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:Ct.remove("treejs-node__checked"),Ct.add("treejs-node__halfchecked");break;case 2:Ct.remove("treejs-node__halfchecked"),Ct.add("treejs-node__checked")}switch(ot.disabled){case!0:Ct.contains("treejs-node__disabled")||Ct.add("treejs-node__disabled");break;case!1:Ct.contains("treejs-node__disabled")&&Ct.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var ot=this;Object.keys(this.leafNodesById).forEach(function(Ct){var Tt=ot.leafNodesById[Ct];ye(ot,Tt)})}},{key:"expandAll",value:function(){Me(this,this.treeNodes[0])}}])&&qe(Mt.prototype,At),Dt&&qe(Mt,Dt),Object.defineProperty(Mt,"prototype",{writable:!1}),ft}()}(),z.default}()},8:function(T,g){(function(u){class O{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(he,ye){const Me=this._eventListeners;Me[he]===void 0&&(Me[he]=[]),Me[he].includes(ye)||Me[he].push(ye)}hasEventListener(he,ye){const Me=this._eventListeners;return Me[he]!==void 0&&Me[he].includes(ye)}removeEventListener(he,ye){const Me=this._eventListeners[he];if(Me!==void 0){const nt=Me.indexOf(ye);nt!==-1&&Me.splice(nt,1)}}dispatchEvent(he){const ye=this._eventListeners[he.type];if(ye!==void 0){he.target=this;const Me=ye.slice(0);for(let nt=0,ft=Me.length;nt<ft;nt++)Me[nt].call(this,he)}}}function z(){return(typeof performance>"u"?Date:performance).now()}class W{constructor(he=W.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(he)}setDecayTime(he){this.naturalFrequency=1/Math.max(W.MIN_DECAY_MILLISECONDS,he)}update(he,ye,Me,nt){const ft=2e-4*this.naturalFrequency;if(he==null||nt===0||he===ye&&this.velocity===0)return ye;if(Me<0)return he;const Mt=he-ye,At=this.velocity+this.naturalFrequency*Mt,Dt=Mt+Me*At,ot=Math.exp(-this.naturalFrequency*Me),Ct=(At-this.naturalFrequency*Dt)*ot,Tt=-this.naturalFrequency*(Ct+At*ot);return Math.abs(Ct)<ft*Math.abs(nt)&&Tt*Mt>=0?(this.velocity=0,ye):(this.velocity=Ct,ye+Dt*ot)}}async function J(re){return new Promise((he,ye)=>{const Me=new Image;Me.onload=()=>he(Me),Me.onerror=ye,Me.crossOrigin="anonymous",Me.decoding="sync",Me.src=re})}function se(re,he=document.head){const ye=document.createElement("style");return ye.type="text/css",ye.innerText=re,he==null||he.appendChild(ye),ye}W.SETTLING_TIME=1e4,W.MIN_DECAY_MILLISECONDS=.001,W.DECAY_MILLISECONDS=50;const Y={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ie(re){return re.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function oe(re,he,ye){return re.replace(new RegExp(ie(he),"g"),ye)}const fe=(re,...he)=>String.raw({raw:re},...he),me=(re,...he)=>{let ye=String.raw({raw:re},...he);return ye=oe(ye,"%","%25"),ye=oe(ye,"> <","><"),ye=oe(ye,"; }",";}"),ye=oe(ye,"<","%3c"),ye=oe(ye,">","%3e"),ye=oe(ye,'"',"'"),ye=oe(ye,"#","%23"),ye=oe(ye,"{","%7b"),ye=oe(ye,"}","%7d"),ye=oe(ye,"|","%7c"),ye=oe(ye,"^","%5e"),ye=oe(ye,"`","%60"),ye=oe(ye,"@","%40"),ye=oe(ye,"&","&amp;"),ye=oe(ye,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+ye};function de(re,he){const ye=window.URL.createObjectURL(re),Me=document.createElement("a");Me.style.display="none",Me.href=ye,Me.download=he,document.body.appendChild(Me),Me.click(),setTimeout(()=>{document.body.removeChild(Me),window.URL.revokeObjectURL(ye)},1e3)}async function Pe(re){return new Promise((he,ye)=>{const Me=new FileReader;Me.onload=nt=>he(Me.result),Me.onerror=nt=>ye(Me.error),Me.onabort=nt=>ye(new Error("Read aborted")),Me.readAsDataURL(re)})}function ue(re,he){let ye;do ye=Object.getOwnPropertyDescriptor(re,he);while(!ye&&(re=Object.getPrototypeOf(re)));return ye}function He(re,he,ye=!0,Me=!1){const nt=ue(re,he);return!!(nt!=null&&nt.set)||ye&&(nt==null?void 0:nt.writable)!==!1&&(nt==null?void 0:nt.get)===void 0||Me&&!nt}function je(re,he,ye,Me=!0,nt=!1){return!(!re||!He(re,he,Me,nt)||(re[he]=ye,0))}function Fe(re,he){for(let ye=re.length-1;ye>=0;ye--)if(he(re[ye]))return ye;return-1}const et={priority:1/0,serialize:(re,he)=>Object.fromEntries(Object.entries(re).map(([ye,Me])=>[ye,pt.Serialize(Me,he,!1)])),deserialize:(re,he,ye)=>Object.assign(he||{},Object.fromEntries(Object.entries(re).map(([Me,nt])=>[Me,pt.Deserialize(nt,he==null?void 0:he[Me],ye,!1)]))),isType:re=>(re.constructor||Object)===Object};class pt{static GetSerializer(he){return pt.Serializers.find(ye=>ye.isType(he))}static RegisterSerializer(...he){var ye;for(const Me of he){const nt=(ye=Me.priority)!==null&&ye!==void 0?ye:1e10,ft=Fe(pt.Serializers,Mt=>Mt.priority!==void 0&&Mt.priority<nt);ft>=0?pt.Serializers.splice(ft+1,0,Me):pt.Serializers.push(Me)}}static UnregisterSerializer(...he){for(const ye of he){const Me=pt.Serializers.indexOf(ye);Me>=0&&pt.Serializers.splice(Me,1)}}static Serialize(he,ye,Me=!1){var nt,ft;if(typeof he=="function")return;if(!Me){const Dt=pt.GetSerializer(he);if(Dt)return Dt.serialize(he,ye);if(typeof he.toJSON=="function"){const ot=he.toJSON(ye);return he.serializableClassId&&ot&&(ot.serializableClassId=he.serializableClassId),ot}}let Mt=(nt=he.constructor)!==null&&nt!==void 0?nt:Object;const At={};for(;Mt&&Mt!==Object;){const Dt=(ft=pt.TypeMap.get(Mt))!==null&&ft!==void 0?ft:[];for(const[ot,Ct]of Dt)At[ot]=pt.Serialize(he[Ct],ye,!1);Mt=Object.getPrototypeOf(Mt)}return he.serializableClassId&&(At.serializableClassId=he.serializableClassId),At}static Deserialize(he,ye,Me,nt=!1){var ft,Mt;if(he===void 0||ye===he)return ye;if(he&&typeof he=="object"&&(he.constructor||Object)===Object&&he.resource&&typeof he.resource=="string"&&he.uuid){const Dt=Me==null?void 0:Me[he.resource];if(!Dt)return console.warn(`Resource ${he.resource} not found`),ye;if(typeof(he=Dt[he.uuid])=="object"&&(he.__useCount=he.__useCount?he.__useCount+1:1),he||console.warn(`Resource ${he.resource} with uuid ${he.uuid} not found`),ye===he)return ye;if(he&&typeof he=="object"){if((he.constructor||Object)!==Object)return ye&&console.warn("replacing object",ye,"with deserialized object from meta",he),he;console.error("Deserialize; meta should only have class instances, not js objects",he,ye,Me)}}if(he&&typeof he=="object"&&(he.constructor||Object)!==Object&&!Array.isArray(he)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",he,"source",ye,he.constructor,he.constructor!==Object),he&&typeof he=="object")if(!he.serializableClassId||ye&&ye.serializableClassId===he.serializableClassId)(he.constructor||Object)!==Object||ye?Array.isArray(he)&&!ye&&(ye=[]):ye={};else{const Dt=pt.SerializableClasses.get(he.serializableClassId);Dt&&(ye=Dt.DataInConstructor?new Dt(he):new Dt)}if(typeof ye=="function")return console.error("cannot deserialize over function",ye,he),ye;if(!nt){const Dt=pt.GetSerializer(he);if(Dt&&Dt!==et)return Dt.deserialize(he,ye,Me)}if(!he||ye==null||typeof ye!="object")return he;if(!nt&&typeof(ye==null?void 0:ye.fromJSON)=="function")return ye.fromJSON(he,Me),ye;let At=(ft=ye.constructor)!==null&&ft!==void 0?ft:Object;if(At===Object)return et.deserialize(he,ye,Me);for(;At&&At!==Object;){const Dt=(Mt=pt.TypeMap.get(At))!==null&&Mt!==void 0?Mt:[];for(const[ot,Ct]of Dt){const Tt=ye[Ct],Ft=pt.Deserialize(he[ot],Tt,Me,!1);Ft!==Tt&&je(ye,Ct,Ft,!0)}At=Object.getPrototypeOf(At)}return ye}}function Ge(re,he="param"){if(!re)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(ye,Me)=>{Object.defineProperty(ye,Me,{get(){return this[`_oc_${Me}`]},set(nt){var ft;const Mt=this[`_oc_${Me}`];if(Mt===nt)return;this[`_oc_${Me}`]=nt;const At=he==="param"?[Me,nt,Mt]:he==="object"?[{key:Me,value:nt,oldValue:Mt}]:"";if(typeof re=="string")(ft=this[re])===null||ft===void 0||ft.call(this,...At);else if(typeof re=="function"){let Dt=!1;if(re.name){let ot=this;for(;ot;){if(ot[re.name]===re){re.call(this,...At),Dt=!0;break}ot=Object.getPrototypeOf(ot)}}Dt||(re.name&&this[re.name].name===`bound ${re.name}`?this[re.name](...At):re(...At))}}})}}function Ye(re,{backgroundColor:he="",scale:ye=1,width:Me=512,height:nt=512}){const ft=document.createElement("canvas"),Mt=ft.getContext("2d"),At=ye,Dt=Me,ot=nt;return ft.width=Dt*At,ft.height=ot*At,ft.style.width=`${Dt}`,ft.style.height=`${ot}`,(he==null?void 0:he.length)>0&&(Mt.fillStyle=he,Mt.fillRect(0,0,ft.width,ft.height)),Mt.drawImage(re,0,0,ft.width,ft.height),ft}pt.TypeMap=new Map,pt.SerializableClasses=new Map,pt.Serializers=[{priority:0,isType:re=>Array.isArray(re),serialize:(re,he)=>re.map(ye=>pt.Serialize(ye,he,!1)),deserialize:(re,he,ye)=>{const Me=re.length;Array.isArray(he)||(he=[]);for(let nt=0;nt<Me;nt++){const ft=re[nt],Mt=he.length>nt?pt.Deserialize(ft,he[nt],ye,!1):pt.Deserialize(ft,void 0,ye,!1);he.length<=nt?he.push(Mt):he[nt]=Mt}return he}},{priority:0,isType:re=>!re||typeof re!="object",serialize:re=>{if(re&&typeof re=="number"){if(re===1/0)return"Infinity";if(re===-1/0)return"-Infinity";if(isNaN(re))return"NaN"}return re},deserialize:(re,he)=>{if(typeof he=="number"){if(re==="Infinity")return 1/0;if(re==="-Infinity")return-1/0;if(re==="NaN")return NaN;if(typeof re=="number"||!re)return re}return re}},et];const $=async(re,he)=>Ye(await J(re),he),le=async(re,he)=>await $(re,he).then(ye=>ye.toDataURL("image/png")),_e=async re=>Pe(await(await fetch(re)).blob());function qe(re,he,{width:ye,height:Me},nt=!0){const ft=`
<svg viewBox="0 0 ${ye} ${Me}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${he}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${re}
        </div>
    </foreignObject>
</svg>
    `;return nt?me(ft):ft}u.Damper=W,u.LinearToSRGB=function(re){return re<.0031308?12.92*re:1.055*Math.pow(re,.41666)-.055},u.PointerDragHelper=class extends O{constructor(){super(...arguments),this._onPointerDown=re=>{if(re.button!==0||!this._element)return;this._pointerUp=void 0;const he=re.clientX/this._element.clientWidth*2-1,ye=-re.clientY/this._element.clientHeight*2+1,Me=z();this._pointerDown={x:he,y:ye,time:Me},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=re=>{if(!this._pointerDown||!this._pointer||!this._element)return;const he=re.clientX/this._element.clientWidth*2-1,ye=-re.clientY/this._element.clientHeight*2+1,Me=z();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:he-this._pointerDown.x,y:ye-this._pointerDown.y,time:Me-this._pointerDown.time},delta:{x:he-this._pointer.x,y:ye-this._pointer.y,time:Me-this._pointer.time}}),this._pointer={x:he,y:ye,time:z()},re.buttons%2==0&&this._onPointerUp(re)},this._onPointerUp=re=>{if(re.button!==0||!this._pointerDown||!this._element)return;const he=re.clientX/this._element.clientWidth*2-1,ye=-re.clientY/this._element.clientHeight*2+1,Me=z();this._pointerUp={x:he,y:ye,time:Me},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(re){this._element!==re&&(this._element&&this._removeElement(),this._element=re,this._element&&this._addElement())}_removeElement(){var re,he,ye,Me,nt;(re=this._element)===null||re===void 0||re.removeEventListener("pointerdown",this._onPointerDown),(he=this._element)===null||he===void 0||he.removeEventListener("pointermove",this._onPointerMove),(ye=this._element)===null||ye===void 0||ye.removeEventListener("pointerup",this._onPointerUp),(Me=this._element)===null||Me===void 0||Me.removeEventListener("pointercancel",this._onPointerUp),(nt=this._element)===null||nt===void 0||nt.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var re,he,ye,Me,nt;(re=this._element)===null||re===void 0||re.addEventListener("pointerdown",this._onPointerDown),(he=this._element)===null||he===void 0||he.addEventListener("pointermove",this._onPointerMove),(ye=this._element)===null||ye===void 0||ye.addEventListener("pointerup",this._onPointerUp),(Me=this._element)===null||Me===void 0||Me.addEventListener("pointercancel",this._onPointerUp),(nt=this._element)===null||nt===void 0||nt.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},u.SRGBToLinear=function(re){return re<.04045?.0773993808*re:Math.pow(.9478672986*re+.0521327014,2.4)},u.Serialization=pt,u.SimpleEventDispatcher=O,u.TYPED_ARRAYS=Y,u.absMax=function(re,he){return Math.abs(re)>Math.abs(he)?re:he},u.aesGcmDecrypt=async function(re,he){const ye=typeof he=="string"?new TextEncoder().encode(he):he,Me=await crypto.subtle.digest("SHA-256",ye),nt=re.slice(0,12),ft={name:"AES-GCM",iv:typeof nt=="string"?new Uint8Array(Array.from(nt).map(ot=>ot.charCodeAt(0))):nt},Mt=await crypto.subtle.importKey("raw",Me,ft,!1,["decrypt"]),At=re.slice(12),Dt=typeof At=="string"?new Uint8Array(Array.from(At).map(ot=>ot.charCodeAt(0))):At;try{const ot=await crypto.subtle.decrypt(ft,Mt,Dt);return typeof re=="string"?new TextDecoder().decode(ot):new Uint8Array(ot)}catch{throw new Error("Decrypt failed")}},u.aesGcmEncrypt=async function(re,he,ye){const Me=typeof he=="string"?new TextEncoder().encode(he):he,nt=await crypto.subtle.digest("SHA-256",Me),ft=crypto.getRandomValues(new Uint8Array(12)),Mt=Array.from(ft).map(tt=>String.fromCharCode(tt)).join(""),At={name:"AES-GCM",iv:ft},Dt=await crypto.subtle.importKey("raw",nt,At,!1,["encrypt"]),ot=typeof re=="string"?new TextEncoder().encode(re):re,Ct=await crypto.subtle.encrypt(At,Dt,ot),Tt=new Uint8Array(Ct),Ft=Array.from(Tt),mt=Ft.map(tt=>String.fromCharCode(tt)).join(""),be=ye?typeof ye=="string"?ye:new TextDecoder().decode(ye):"",Ve=ye?typeof ye=="string"?new TextEncoder().encode(ye):Array.from(ye):[];return typeof re=="string"?be+Mt+mt:new Uint8Array([...Ve,...ft,...Ft])},u.arrayBufferToBase64=function(re){if(!window)return console.warn("window is required"),"";let he="";const ye=new Uint8Array(re),Me=ye.byteLength;for(let nt=0;nt<Me;nt++)he+=String.fromCharCode(ye[nt]);return window.btoa(he)},u.base64ToArrayBuffer=function(re){if(!window)return console.warn("window is required"),new Uint8Array(0);const he=window.atob(re),ye=he.length,Me=new Uint8Array(ye);for(let nt=0;nt<ye;nt++)Me[nt]=he.charCodeAt(nt);return Me.buffer},u.blobToDataURL=Pe,u.canvasFlipY=function(re){const he=document.createElement("canvas");he.width=re.width,he.height=re.height;const ye=he.getContext("2d");if(!ye)throw new Error("Unable to get 2d context");return ye.translate(0,re.height),ye.scale(1,-1),ye.drawImage(re,0,0),he},u.clearBit=function(re,he){return re&~(1<<he)},u.colorToDataUrl=function(re,he=1,ye=1){const Me=document.createElement("canvas");Me.width=he,Me.height=ye;const nt=Me.getContext("2d");nt.fillStyle="#"+re,nt.fillRect(0,0,he,ye);const ft=Me.toDataURL();return Me.remove(),ft},u.copyProps=function(re,he,ye){for(const Me of ye){const nt=re[Me];nt!==void 0&&je(he,Me,nt,!0)}return he},u.createCanvasElement=function(){const re=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return re.style.display="block",re},u.createDiv=function({innerHTML:re="",id:he,classList:ye,addToBody:Me=!0,elementTag:nt="div"}){const ft=document.createElement(nt);return he&&(ft.id=he),ft.innerHTML=re,ye&&ft.classList.add(...ye),Me&&document.body.appendChild(ft),ft},u.createImage=J,u.createScriptFromURL=async function(re,he=document.head){return new Promise((ye,Me)=>{const nt=document.createElement("script");nt.setAttribute("src",re),nt.addEventListener("load",()=>ye(nt)),nt.addEventListener("error",Me),he.appendChild(nt)})},u.createStyles=se,u.css=fe,u.deepAccessObject=function(re,he,ye=!1){for(typeof re=="string"&&(re=re.split("."));re.length>0;){if(!he)return;const Me=re.splice(0,1)[0];if(!(Me.length<1)){if(!(Me in he)){if(ye)throw new Error("invalid access, check "+Me+" in "+he);return}he=he[Me]}}return he},u.downloadBlob=de,u.downloadFile=function(re,he){return de(re,he??re.name)},u.embedUrlRefs=async function(re,he=_e){const ye=re.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(ye)for(const Me of ye){const nt=await he(Me);re=re.replace(Me,nt)}return re},u.escapeRegExp=ie,u.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(re=>re[0]):window.chooseFileSystemEntries()},u.getFilenameFromPath=function(re){return re.substring(re.lastIndexOf("/")+1)},u.getKeyByValue=function(re,he){return Object.keys(re).find(ye=>re[ye]===he)},u.getNewFileHandle=function(){if("showSaveFilePicker"in window){const re={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(re)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},u.getOrCall=function(re,...he){return typeof re=="function"&&(re=re(...he)),re},u.getPropertyDescriptor=ue,u.getTypedArray=function(re,he){return new Y[re](he)},u.getUrlQueryParam=function(re,he=null){var ye;return(ye=new URL(window.location.href).searchParams.get(re))!==null&&ye!==void 0?ye:he},u.glsl=(re,...he)=>String.raw({raw:re},...he),u.html=(re,...he)=>String.raw({raw:re},...he),u.htmlToCanvas=async function(re,he,ye){const Me=qe(re,he,ye);return await $(Me,ye)},u.htmlToPng=async function(re,he,ye){const Me=qe(re,he,ye);return await le(Me,ye)},u.htmlToSvg=qe,u.imageBitmapToBase64=function(re,he=8192,ye=!1){var Me;if(!re.width||!re.height)return"";const nt=document.createElement("canvas");nt.width=Math.min(he,re.width),nt.height=Math.floor(1+nt.width*re.height/re.width);const ft=re instanceof ImageBitmap,Mt=ft&&ye&&Math.abs(nt.width-re.width)<.5?nt.getContext("bitmaprenderer"):void 0;Mt?Mt.transferFromImageBitmap(re):(Me=nt.getContext("2d"))===null||Me===void 0||Me.drawImage(re,0,0,nt.width,nt.height);const At=nt.toDataURL("image/png");return nt.remove(),ft&&ye&&re.close(),At},u.imageDataToCanvas=function(re){const he=document.createElement("canvas");return he.width=re.width,he.height=re.height,he.getContext("2d").putImageData(re,0,0),he},u.imageToCanvas=Ye,u.imageUrlToImageData=async function(re){return new Promise((he,ye)=>{const Me=new Image;Me.addEventListener("load",()=>{const nt=document.createElement("canvas");nt.width=Me.width,nt.height=Me.height;const ft=nt.getContext("2d");if(!ft)return void ye(new Error("Could not get 2d context"));ft.drawImage(Me,0,0,nt.width,nt.height);const Mt=ft.getImageData(0,0,nt.width,nt.height);he(Mt),nt.remove(),Me.remove()},!1),Me.addEventListener("error",nt=>{Me.remove(),ye(nt)},!1),Me.src=re})},u.includesAll=function(re,he){for(const ye of he)if(!re.includes(ye))return!1;return!0},u.isPropertyWritable=He,u.isWebpExportSupported=function(){const re=document.createElement("canvas");return!(!re.getContext||!re.getContext("2d"))&&re.toDataURL("image/webp").startsWith("data:image/webp")},u.longestCommonPrefix=function(re){return re.sort(),re[0].split("").map((he,ye)=>re[re.length-1][ye]===he?he:"\0").join("").split("\0").at(0)||""},u.makeColorSvg=re=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${re}'/%3E%3C/svg%3E%0A`,u.makeColorSvgCircle=re=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${re}'/%3E%3C/svg%3E%0A`,u.makeTextSvg=re=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${re}%3C/text%3E%3C/svg%3E%0A`,u.mobileAndTabletCheck=function(){let re=!1;var he;return he=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(he)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(he.substr(0,4)))&&(re=!0),re},u.now=z,u.objectHasOwn=function(re,he){return Object.hasOwn?Object.hasOwn(re,he):re.hasOwnProperty(he)},u.onChange=Ge,u.onChange2=function(re,he="void"){if(!re)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return Ge(re,he)},u.onChange3=function(re,he="object"){if(!re)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return Ge(re,he)},u.parseFileExtension=function(re){var he;if(!re||re===""||re.match(/__MACOSX\/.*\._/))return"";const ye=(he=(re=re.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&he!==void 0?he:"",Me=ye.lastIndexOf(".");return ye===""||Me<1?"":ye.slice(Me+1)},u.pathJoin=function(re,he="/"){return re.join(he)},u.prettyScrollbar=function(re=document.head){return se(fe`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,re)},u.readFile=function(re){return re.text?re.text():function(he){return new Promise(ye=>{const Me=new FileReader;Me.addEventListener("loadend",nt=>{const ft=nt.srcElement.result;ye(ft)}),Me.readAsText(he)})}(re)},u.remoteWorkerURL=function(re,he){const ye=(he?`var Module = { locateFile: function(s) { return "${he}"; } }; 
`:"")+`importScripts( "${re}" );`;return URL.createObjectURL(new Blob([ye],{type:"text/javascript"}))},u.replaceAll=oe,u.safeSetProperty=je,u.serializable=function(re){return he=>(he=class extends he{constructor(){super(...arguments),this.serializableClassId=re}},pt.SerializableClasses.set(re,he),he)},u.serialize=function(re){return(he,ye)=>{const Me=he.constructor;if(Me===Object)throw new Error("All properties in an object are serialized by default");pt.TypeMap.has(Me)||pt.TypeMap.set(Me,[]),pt.TypeMap.get(Me).push([re||ye,ye])}},u.setUrlQueryParam=function(re,he,ye=!1){const Me=new URLSearchParams(location.search);he==null?Me.has(re)&&Me.delete(re):Me.set(re,he),ye?window.location.search=Me.toString():window.history.replaceState({},"","?"+Me.toString())},u.svgToCanvas=$,u.svgToPng=le,u.svgUrl=me,u.timeout=async function(re){return new Promise(he=>setTimeout(he,Math.max(0,re)))},u.toTitleCase=function(re){return re.replace(/\w\S*/g,function(he){return he.charAt(0).toUpperCase()+he.substr(1).toLowerCase()})},u.updateBit=function(re,he,ye){return re&~(1<<he)|(ye?1:0)<<he},u.uploadFile=async function(re=!1,he=!1,ye){const Me=document.createElement("input");Me.type="file",Me.multiple=re,Me.accept=ye||"*",Me.webkitdirectory=he,Me.style.display="none",document.body.appendChild(Me),Me.click();const nt=await new Promise(ft=>{Me.onchange=Mt=>{ft(Array.from(Me.files||[]))}});return document.body.removeChild(Me),nt},u.verifyPermission=async function(re,he){const ye={};return he&&(ye.writable=!0,ye.mode="readwrite"),await re.queryPermission(ye)==="granted"||await re.requestPermission(ye)==="granted"},u.writeFile=async function(re,he){if(re.createWriter){const Me=await re.createWriter();return await Me.write(0,he),void await Me.close()}const ye=await re.createWritable();await ye.write(he),await ye.close()}})(g)},819:function(T,g){(function(u){const O="tp";function z(Ye){return $=>le=>{if(!$&&le===void 0)return{succeeded:!1,value:void 0};if($&&le===void 0)return{succeeded:!0,value:void 0};const _e=Ye(le);return _e!==void 0?{succeeded:!0,value:_e}:{succeeded:!1,value:void 0}}}function W(Ye){return{custom:$=>z($)(Ye),boolean:z($=>typeof $=="boolean"?$:void 0)(Ye),number:z($=>typeof $=="number"?$:void 0)(Ye),string:z($=>typeof $=="string"?$:void 0)(Ye),function:z($=>typeof $=="function"?$:void 0)(Ye),constant:$=>z(le=>le===$?$:void 0)(Ye),raw:z($=>$)(Ye),object:$=>z(le=>{if((_e=le)!==null&&typeof _e=="object")return function(qe,re){return Object.keys(re).reduce((he,ye)=>{if(he===void 0)return;const Me=(0,re[ye])(qe[ye]);return Me.succeeded?Object.assign(Object.assign({},he),{[ye]:Me.value}):void 0},{})}(le,$);var _e})(Ye),array:$=>z(le=>{if(Array.isArray(le))return _e=$,le.reduce((qe,re)=>{if(qe===void 0)return;const he=_e(re);return he.succeeded&&he.value!==void 0?[...qe,he.value]:void 0},[]);var _e})(Ye)}}const J={optional:W(!0),required:W(!1)};function se(Ye){return $=>$.toFixed(Math.max(Math.min(Ye,20),0))}function Y(Ye){return[Ye[0],Ye[1],Ye[2]]}function ie(Ye){return $=>function(le,_e){const qe=se(_e==="float"?2:0);return`rgb(${Y(le.getComponents("rgb",_e)).map(re=>qe(re)).join(", ")})`}($,Ye)}function oe(Ye){return $=>function(le,_e){const qe=se(2),re=se(_e==="float"?2:0);return`rgba(${le.getComponents("rgb",_e).map((he,ye)=>(ye===3?qe:re)(he)).join(", ")})`}($,Ye)}function fe(Ye){return $=>function(le,_e){const qe=se(_e==="float"?2:0),re=["r","g","b"];return`{${Y(le.getComponents("rgb",_e)).map((he,ye)=>`${re[ye]}: ${qe(he)}`).join(", ")}}`}($,Ye)}function me(Ye){return $=>function(le,_e){const qe=se(2),re=se(_e==="float"?2:0),he=["r","g","b","a"];return`{${le.getComponents("rgb",_e).map((ye,Me)=>`${he[Me]}: ${(Me===3?qe:re)(ye)}`).join(", ")}}`}($,Ye)}function de(Ye,$,le,_e){return new(le||(le=Promise))(function(qe,re){function he(nt){try{Me(_e.next(nt))}catch(ft){re(ft)}}function ye(nt){try{Me(_e.throw(nt))}catch(ft){re(ft)}}function Me(nt){var ft;nt.done?qe(nt.value):(ft=nt.value,ft instanceof le?ft:new le(function(Mt){Mt(ft)})).then(he,ye)}Me((_e=_e.apply(Ye,$||[])).next())})}function Pe(Ye){return de(this,void 0,void 0,function*(){const $=new Image;return $.crossOrigin="anonymous",new Promise((le,_e)=>{$.src=Ye,$.onload=()=>{le($)},$.onerror=_e})})}["int","float"].reduce((Ye,$)=>[...Ye,{format:{alpha:!1,mode:"rgb",notation:"func",type:$},stringifier:ie($)},{format:{alpha:!0,mode:"rgb",notation:"func",type:$},stringifier:oe($)},{format:{alpha:!1,mode:"rgb",notation:"object",type:$},stringifier:fe($)},{format:{alpha:!0,mode:"rgb",notation:"object",type:$},stringifier:me($)}],[]);const ue=(He="img",(Ye,$)=>[O,"-",He,"v",Ye?`_${Ye}`:"",$?`-${$}`:""].join(""));var He;class je{constructor($,le){this.element=$.createElement("div"),this.element.classList.add(ue()),le.viewProps.bindClassModifiers(this.element),this.input=$.createElement("input"),this.input.classList.add(ue("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",le.extensions.join(",")),this.image_=$.createElement("img"),this.image_.classList.add(ue("image")),this.image_.classList.add(ue(`image_${le.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=_e=>{le.clickCallback?le.clickCallback(_e,this.input):this.input.click()},this.element.classList.add(ue("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage($){this.image_.src=$}changeDraggingState($){const le=this.element;$?le==null||le.classList.add(ue("area_dragging")):le==null||le.classList.remove(ue("area_dragging"))}}let Fe=null;class et{constructor($,le){this.value=le.value,this.viewProps=le.viewProps,this.view=new je($,{viewProps:this.viewProps,extensions:le.extensions,imageFit:le.imageFit,clickCallback:le.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile($){const le=($==null?void 0:$.target).files;if(!le||!le.length)return;const _e=le[0];this.setValue(_e)}onDrop($){return de(this,void 0,void 0,function*(){$.preventDefault();try{const{dataTransfer:le}=$,_e=le==null?void 0:le.files[0];if(_e)this.setValue(_e);else{const qe=le==null?void 0:le.getData("url");if(!qe)throw new Error("No url");this.setValue(qe)}}catch(le){console.error("Could not parse the dropped image",le)}finally{this.view.changeDraggingState(!1)}})}onDragOver($){$.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage($){return de(this,void 0,void 0,function*(){$ instanceof HTMLImageElement?this.updateImage($.src):typeof $!="string"&&$?yield this.setValue($):($!=="placeholder"&&$||($=(yield this.handlePlaceholderImage()).src),this.updateImage($))})}updateImage($){this.view.changeImage($)}setValue($){return de(this,void 0,void 0,function*(){if($ instanceof HTMLImageElement)this.value.setRawValue($);else if($ instanceof File){const le=URL.createObjectURL($)+"#"+$.name;$.src=le;const _e=yield Pe(le).catch(()=>{});this.value.setRawValue(_e||$)}else $?this.value.setRawValue(yield Pe($)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return de(this,void 0,void 0,function*(){return Fe||(Fe=yield function(){const $=document.createElement("canvas");$.width=320,$.height=50;const le=$.getContext("2d");return le.fillStyle="#00000004",le.fillRect(0,0,$.width,$.height),le.fillStyle="#eee",le.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',le.textAlign="center",le.textBaseline="middle",le.fillText("No image",.5*$.width,.5*$.height),new Promise(_e=>{$.toBlob(qe=>{const re=new Image;re.src=URL.createObjectURL(qe),re.isPlaceholder=!0,re.onload=()=>{_e(re)}})})}()),Fe})}}const pt=[".jpg",".png",".gif"],Ge={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(Ye,$){if(!(Ye instanceof HTMLImageElement||typeof Ye=="string"))return null;const le=J,_e=function(qe,re){const he=J.required.object(re)(qe);return he.succeeded?he.value:void 0}($,{view:le.required.constant("input-image"),acceptUrl:le.optional.boolean,clickCallback:le.optional.function,imageFit:le.optional.custom(qe=>qe==="contain"||qe==="cover"?qe:void 0),extensions:le.optional.array(le.required.string)});return _e?{initialValue:Ye,params:_e}:null},binding:{reader(Ye){return $=>$.src!==void 0?$.src===""?"placeholder":$.src:$},writer(Ye){return($,le)=>{$.write(le)}}},controller(Ye){var $,le;return new et(Ye.document,{value:Ye.value,imageFit:($=Ye.params.imageFit)!==null&&$!==void 0?$:"cover",clickCallback:Ye.params.clickCallback,viewProps:Ye.viewProps,extensions:(le=Ye.params.extensions)!==null&&le!==void 0?le:pt})}};u.plugin=Ge,Object.defineProperty(u,"__esModule",{value:!0})})(g)},665:function(T,g){(function(u){class O{constructor(A){this.controller_=A}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(A){this.controller_.viewProps.set("disabled",A)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(A){this.controller_.viewProps.set("hidden",A)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class z{constructor(A){this.target=A}}class W extends z{constructor(A,C,F,ee){super(A),this.value=C,this.presetKey=F,this.last=ee==null||ee}}class J extends z{constructor(A,C,F){super(A),this.value=C,this.presetKey=F}}class se extends z{constructor(A,C){super(A),this.expanded=C}}class Y extends z{constructor(A,C){super(A),this.index=C}}function ie(k){return k==null}function oe(k,A){if(k.length!==A.length)return!1;for(let C=0;C<k.length;C++)if(k[C]!==A[C])return!1;return!0}function fe(k,A){let C=k;do{const F=Object.getOwnPropertyDescriptor(C,A);if(F&&(F.set!==void 0||F.writable===!0))return!0;C=Object.getPrototypeOf(C)}while(C!==null);return!1}const me={alreadydisposed:()=>"View has been already disposed",invalidparams:k=>`Invalid parameters for '${k.name}'`,nomatchingcontroller:k=>`No matching controller for '${k.key}'`,nomatchingview:k=>`No matching view for '${JSON.stringify(k.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:k=>`Property '${k.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class de{static alreadyDisposed(){return new de({type:"alreadydisposed"})}static notBindable(){return new de({type:"notbindable"})}static propertyNotFound(A){return new de({type:"propertynotfound",context:{name:A}})}static shouldNeverHappen(){return new de({type:"shouldneverhappen"})}constructor(A){var C;this.message=(C=me[A.type](A.context))!==null&&C!==void 0?C:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=A.type}}class Pe{constructor(A,C,F){this.obj_=A,this.key_=C,this.presetKey_=F??C}static isBindable(A){return A!==null&&typeof A=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(A){this.obj_[this.key_]=A}writeProperty(A,C){const F=this.read();if(!Pe.isBindable(F))throw de.notBindable();if(!(A in F))throw de.propertyNotFound(A);F[A]=C}}class ue extends O{get label(){return this.controller_.props.get("label")}set label(A){this.controller_.props.set("label",A)}get title(){var A;return(A=this.controller_.valueController.props.get("title"))!==null&&A!==void 0?A:""}set title(A){this.controller_.valueController.props.set("title",A)}on(A,C){const F=C.bind(this);return this.controller_.valueController.emitter.on(A,()=>{F(new z(this))}),this}}class He{constructor(){this.observers_={}}on(A,C){let F=this.observers_[A];return F||(F=this.observers_[A]=[]),F.push({handler:C}),this}off(A,C){const F=this.observers_[A];return F&&(this.observers_[A]=F.filter(ee=>ee.handler!==C)),this}emit(A,C){const F=this.observers_[A];F&&F.forEach(ee=>{ee.handler(C)})}}const je="tp";function Fe(k){return(A,C)=>[je,"-",k,"v",A?`_${A}`:"",C?`-${C}`:""].join("")}function et(k){return k.rawValue}function pt(k,A){var C,F;k.emitter.on("change",(C=et,F=A,ee=>F(C(ee)))),A(k.rawValue)}function Ge(k,A,C){pt(k.value(A),C)}function Ye(k,A){return C=>{(function(F,ee,De){De?F.classList.add(ee):F.classList.remove(ee)})(k,A,C)}}function $(k,A){pt(k,C=>{A.textContent=C??""})}const le=Fe("btn");class _e{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(le()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("button");F.classList.add(le("b")),C.viewProps.bindDisabled(F),this.element.appendChild(F),this.buttonElement=F;const ee=A.createElement("div");ee.classList.add(le("t")),$(C.props.value("title"),ee),this.buttonElement.appendChild(ee)}}class qe{constructor(A,C){this.emitter=new He,this.onClick_=this.onClick_.bind(this),this.props=C.props,this.viewProps=C.viewProps,this.view=new _e(A,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class re{constructor(A,C){var F;this.constraint_=C==null?void 0:C.constraint,this.equals_=(F=C==null?void 0:C.equals)!==null&&F!==void 0?F:(ee,De)=>ee===De,this.emitter=new He,this.rawValue_=A}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(A){this.setRawValue(A,{forceEmit:!1,last:!0})}setRawValue(A,C){const F=C??{forceEmit:!1,last:!0},ee=this.constraint_?this.constraint_.constrain(A):A,De=this.rawValue_;(!this.equals_(De,ee)||F.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=ee,this.emitter.emit("change",{options:F,previousRawValue:De,rawValue:ee,sender:this}))}}class he{constructor(A){this.emitter=new He,this.value_=A}get rawValue(){return this.value_}set rawValue(A){this.setRawValue(A,{forceEmit:!1,last:!0})}setRawValue(A,C){const F=C??{forceEmit:!1,last:!0},ee=this.value_;(ee!==A||F.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=A,this.emitter.emit("change",{options:F,previousRawValue:ee,rawValue:this.value_,sender:this}))}}function ye(k,A){const C=A==null?void 0:A.constraint,F=A==null?void 0:A.equals;return C||F?new re(k,A):new he(k)}class Me{constructor(A){this.emitter=new He,this.valMap_=A;for(const C in this.valMap_)this.valMap_[C].emitter.on("change",()=>{this.emitter.emit("change",{key:C,sender:this})})}static createCore(A){return Object.keys(A).reduce((C,F)=>Object.assign(C,{[F]:ye(A[F])}),{})}static fromObject(A){const C=this.createCore(A);return new Me(C)}get(A){return this.valMap_[A].rawValue}set(A,C){this.valMap_[A].rawValue=C}value(A){return this.valMap_[A]}}function nt(k){return A=>C=>{if(!A&&C===void 0)return{succeeded:!1,value:void 0};if(A&&C===void 0)return{succeeded:!0,value:void 0};const F=k(C);return F!==void 0?{succeeded:!0,value:F}:{succeeded:!1,value:void 0}}}function ft(k){return{custom:A=>nt(A)(k),boolean:nt(A=>typeof A=="boolean"?A:void 0)(k),number:nt(A=>typeof A=="number"?A:void 0)(k),string:nt(A=>typeof A=="string"?A:void 0)(k),function:nt(A=>typeof A=="function"?A:void 0)(k),constant:A=>nt(C=>C===A?A:void 0)(k),raw:nt(A=>A)(k),object:A=>nt(C=>{if((F=C)!==null&&typeof F=="object")return function(ee,De){return Object.keys(De).reduce((Ue,gt)=>{if(Ue===void 0)return;const zt=(0,De[gt])(ee[gt]);return zt.succeeded?Object.assign(Object.assign({},Ue),{[gt]:zt.value}):void 0},{})}(C,A);var F})(k),array:A=>nt(C=>{if(Array.isArray(C))return F=A,C.reduce((ee,De)=>{if(ee===void 0)return;const Ue=F(De);return Ue.succeeded&&Ue.value!==void 0?[...ee,Ue.value]:void 0},[]);var F})(k)}}const Mt={optional:ft(!0),required:ft(!1)};function At(k,A){const C=Mt.required.object(A)(k);return C.succeeded?C.value:void 0}function Dt(k){console.warn([`Missing '${k.key}' of ${k.target} in ${k.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class ot{constructor(A){this.value_=A}static create(A){return[new ot(A),(C,F)=>{A.setRawValue(C,F)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Ct=Fe("");function Tt(k,A){return Ye(k,Ct(void 0,A))}class Ft extends Me{constructor(A){var C;super(A),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=ot.create(ye(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(C=this.get("parent"))===null||C===void 0||C.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(A){var C,F,ee;const De=A??{};return new Ft(Me.createCore({disabled:(C=De.disabled)!==null&&C!==void 0&&C,disposed:!1,hidden:(F=De.hidden)!==null&&F!==void 0&&F,parent:(ee=De.parent)!==null&&ee!==void 0?ee:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(A){pt(this.globalDisabled_,Tt(A,"disabled")),Ge(this,"hidden",Tt(A,"hidden"))}bindDisabled(A){pt(this.globalDisabled_,C=>{A.disabled=C})}bindTabIndex(A){pt(this.globalDisabled_,C=>{A.tabIndex=C?-1:0})}handleDispose(A){this.value("disposed").emitter.on("change",C=>{C&&A()})}getGlobalDisabled_(){const A=this.get("parent");return!!A&&A.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(A){var C;const F=A.previousRawValue;F==null||F.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(C=this.get("parent"))===null||C===void 0||C.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const mt=Fe(""),be={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Ve{constructor(A){this.parent_=null,this.blade=A.blade,this.view=A.view,this.viewProps=A.viewProps;const C=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(F=>{C.classList.remove(mt(void 0,be[F]))}),this.blade.get("positions").forEach(F=>{C.classList.add(mt(void 0,be[F]))})}),this.viewProps.handleDispose(()=>{(function(F){F&&F.parentElement&&F.parentElement.removeChild(F)})(C)})}get parent(){return this.parent_}set parent(A){this.parent_=A,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):Dt({key:"parent",target:Ft.name,place:"BladeController.parent"})}}const tt="http://www.w3.org/2000/svg";function Zt(k){k.offsetHeight}function bt(k){return k.ontouchstart!==void 0}function cn(){return globalThis.document}const hi={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ci(k,A){const C=k.createElementNS(tt,"svg");return C.innerHTML=hi[A],C}function mi(k,A,C){k.insertBefore(A,k.children[C])}function gr(k){k.parentElement&&k.parentElement.removeChild(k)}function Ni(k){for(;k.children.length>0;)k.removeChild(k.children[0])}function qr(k){return k.relatedTarget?k.relatedTarget:"explicitOriginalTarget"in k?k.explicitOriginalTarget:null}const Er=Fe("lbl");class vr{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(Er()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("div");F.classList.add(Er("l")),Ge(C.props,"label",De=>{ie(De)?this.element.classList.add(Er(void 0,"nol")):(this.element.classList.remove(Er(void 0,"nol")),function(Ue){for(;Ue.childNodes.length>0;)Ue.removeChild(Ue.childNodes[0])}(F),F.appendChild(function(Ue,gt){const zt=Ue.createDocumentFragment();return gt.split(`
`).map(yn=>Ue.createTextNode(yn)).forEach((yn,ri)=>{ri>0&&zt.appendChild(Ue.createElement("br")),zt.appendChild(yn)}),zt}(A,De)))}),this.element.appendChild(F),this.labelElement=F;const ee=A.createElement("div");ee.classList.add(Er("v")),this.element.appendChild(ee),this.valueElement=ee}}class Ya extends Ve{constructor(A,C){const F=C.valueController.viewProps;super(Object.assign(Object.assign({},C),{view:new vr(A,{props:C.props,viewProps:F}),viewProps:F})),this.props=C.props,this.valueController=C.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Ao={id:"button",type:"blade",accept(k){const A=Mt,C=At(k,{title:A.required.string,view:A.required.constant("button"),label:A.optional.string});return C?{params:C}:null},controller(k){return new Ya(k.document,{blade:k.blade,props:Me.fromObject({label:k.params.label}),valueController:new qe(k.document,{props:Me.fromObject({title:k.params.title}),viewProps:k.viewProps})})},api(k){return k.controller instanceof Ya&&k.controller.valueController instanceof qe?new ue(k.controller):null}};class Fr extends Ve{constructor(A){super(A),this.value=A.value}}function zr(){return new Me({positions:ye([],{equals:oe})})}class Sr extends Me{constructor(A){super(A)}static create(A){const C={completed:!0,expanded:A,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},F=Me.createCore(C);return new Sr(F)}get styleExpanded(){var A;return(A=this.get("temporaryExpanded"))!==null&&A!==void 0?A:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const A=this.get("expandedHeight");return this.get("shouldFixHeight")&&!ie(A)?`${A}px`:"auto"}bindExpandedClass(A,C){const F=()=>{this.styleExpanded?A.classList.add(C):A.classList.remove(C)};Ge(this,"expanded",F),Ge(this,"temporaryExpanded",F)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Dr(k,A){A.style.height=k.styleHeight}function _r(k,A){k.value("expanded").emitter.on("beforechange",()=>{if(k.set("completed",!1),ie(k.get("expandedHeight"))){const C=function(F,ee){let De=0;return function(Ue,gt){const zt=Ue.style.transition;Ue.style.transition="none",gt(),Ue.style.transition=zt}(ee,()=>{F.set("expandedHeight",null),F.set("temporaryExpanded",!0),Zt(ee),De=ee.clientHeight,F.set("temporaryExpanded",null),Zt(ee)}),De}(k,A);C>0&&k.set("expandedHeight",C)}k.set("shouldFixHeight",!0),Zt(A)}),k.emitter.on("change",()=>{Dr(k,A)}),Dr(k,A),A.addEventListener("transitionend",C=>{C.propertyName==="height"&&k.cleanUpTransition()})}class Oa extends O{constructor(A,C){super(A),this.rackApi_=C}}class bo{constructor(A){this.emitter=new He,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=A}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(A){for(const C of this.allItems())if(A(C))return C;return null}includes(A){return this.cache_.has(A)}add(A,C){if(this.includes(A))throw de.shouldNeverHappen();const F=C!==void 0?C:this.items_.length;this.items_.splice(F,0,A),this.cache_.add(A);const ee=this.extract_(A);ee&&(ee.emitter.on("add",this.onSubListAdd_),ee.emitter.on("remove",this.onSubListRemove_),ee.allItems().forEach(De=>{this.cache_.add(De)})),this.emitter.emit("add",{index:F,item:A,root:this,target:this})}remove(A){const C=this.items_.indexOf(A);if(C<0)return;this.items_.splice(C,1),this.cache_.delete(A);const F=this.extract_(A);F&&(F.emitter.off("add",this.onSubListAdd_),F.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:C,item:A,root:this,target:this})}onSubListAdd_(A){this.cache_.add(A.item),this.emitter.emit("add",{index:A.index,item:A.item,root:this,target:A.target})}onSubListRemove_(A){this.cache_.delete(A.item),this.emitter.emit("remove",{index:A.index,item:A.item,root:this,target:A.target})}}class Mr extends O{constructor(A){super(A),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new He,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(A){this.controller_.props.set("label",A)}on(A,C){const F=C.bind(this);return this.emitter_.on(A,ee=>{F(ee.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(A){const C=A.sender.target.read();this.emitter_.emit("change",{event:new W(this,C,this.controller_.binding.target.presetKey,A.options.last)})}}class Xs extends Ya{constructor(A,C){super(A,C),this.binding=C.binding}}class lr extends O{constructor(A){super(A),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new He,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(A){this.controller_.props.set("label",A)}on(A,C){const F=C.bind(this);return this.emitter_.on(A,ee=>{F(ee.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(A){const C=A.sender.target.read();this.emitter_.emit("update",{event:new J(this,C,this.controller_.binding.target.presetKey)})}}class Ka extends Ya{constructor(A,C){super(A,C),this.binding=C.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function z0(k){return k instanceof Cr?k.apiSet_:k instanceof Oa?k.rackApi_.apiSet_:null}function sc(k,A){const C=k.find(F=>F.controller_===A);if(!C)throw de.shouldNeverHappen();return C}function Cv(k,A,C){if(!Pe.isBindable(k))throw de.notBindable();return new Pe(k,A,C)}class Cr extends O{constructor(A,C){super(A),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new He,this.apiSet_=new bo(z0),this.pool_=C;const F=this.controller_.rack;F.emitter.on("add",this.onRackAdd_),F.emitter.on("remove",this.onRackRemove_),F.emitter.on("inputchange",this.onRackInputChange_),F.emitter.on("monitorupdate",this.onRackMonitorUpdate_),F.children.forEach(ee=>{this.setUpApi_(ee)})}get children(){return this.controller_.rack.children.map(A=>sc(this.apiSet_,A))}addInput(A,C,F){const ee=F??{},De=this.controller_.view.element.ownerDocument,Ue=this.pool_.createInput(De,Cv(A,C,ee.presetKey),ee),gt=new Mr(Ue);return this.add(gt,ee.index)}addMonitor(A,C,F){const ee=F??{},De=this.controller_.view.element.ownerDocument,Ue=this.pool_.createMonitor(De,Cv(A,C),ee),gt=new lr(Ue);return this.add(gt,ee.index)}addFolder(A){return function(C,F){return C.addBlade(Object.assign(Object.assign({},F),{view:"folder"}))}(this,A)}addButton(A){return function(C,F){return C.addBlade(Object.assign(Object.assign({},F),{view:"button"}))}(this,A)}addSeparator(A){return function(C,F){const ee=F??{};return C.addBlade(Object.assign(Object.assign({},ee),{view:"separator"}))}(this,A)}addTab(A){return function(C,F){return C.addBlade(Object.assign(Object.assign({},F),{view:"tab"}))}(this,A)}add(A,C){this.controller_.rack.add(A.controller_,C);const F=this.apiSet_.find(ee=>ee.controller_===A.controller_);return F&&this.apiSet_.remove(F),this.apiSet_.add(A),A}remove(A){this.controller_.rack.remove(A.controller_)}addBlade(A){const C=this.controller_.view.element.ownerDocument,F=this.pool_.createBlade(C,A),ee=this.pool_.createBladeApi(F);return this.add(ee,A.index)}on(A,C){const F=C.bind(this);return this.emitter_.on(A,ee=>{F(ee.event)}),this}setUpApi_(A){this.apiSet_.find(C=>C.controller_===A)||this.apiSet_.add(this.pool_.createBladeApi(A))}onRackAdd_(A){this.setUpApi_(A.bladeController)}onRackRemove_(A){if(A.isRoot){const C=sc(this.apiSet_,A.bladeController);this.apiSet_.remove(C)}}onRackInputChange_(A){const C=A.bladeController;if(C instanceof Xs){const F=sc(this.apiSet_,C),ee=C.binding;this.emitter_.emit("change",{event:new W(F,ee.target.read(),ee.target.presetKey,A.options.last)})}else if(C instanceof Fr){const F=sc(this.apiSet_,C);this.emitter_.emit("change",{event:new W(F,C.value.rawValue,void 0,A.options.last)})}}onRackMonitorUpdate_(A){if(!(A.bladeController instanceof Ka))throw de.shouldNeverHappen();const C=sc(this.apiSet_,A.bladeController),F=A.bladeController.binding;this.emitter_.emit("update",{event:new J(C,F.target.read(),F.target.presetKey)})}}class fa extends Oa{constructor(A,C){super(A,new Cr(A.rackController,C)),this.emitter_=new He,this.controller_.foldable.value("expanded").emitter.on("change",F=>{this.emitter_.emit("fold",{event:new se(this,F.sender.rawValue)})}),this.rackApi_.on("change",F=>{this.emitter_.emit("change",{event:F})}),this.rackApi_.on("update",F=>{this.emitter_.emit("update",{event:F})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(A){this.controller_.foldable.set("expanded",A)}get title(){return this.controller_.props.get("title")}set title(A){this.controller_.props.set("title",A)}get children(){return this.rackApi_.children}addInput(A,C,F){return this.rackApi_.addInput(A,C,F)}addMonitor(A,C,F){return this.rackApi_.addMonitor(A,C,F)}addFolder(A){return this.rackApi_.addFolder(A)}addButton(A){return this.rackApi_.addButton(A)}addSeparator(A){return this.rackApi_.addSeparator(A)}addTab(A){return this.rackApi_.addTab(A)}add(A,C){return this.rackApi_.add(A,C)}remove(A){this.rackApi_.remove(A)}addBlade(A){return this.rackApi_.addBlade(A)}on(A,C){const F=C.bind(this);return this.emitter_.on(A,ee=>{F(ee.event)}),this}}class cf extends Ve{constructor(A){super({blade:A.blade,view:A.view,viewProps:A.rackController.viewProps}),this.rackController=A.rackController}}class ds{constructor(A,C){const F=Fe(C.viewName);this.element=A.createElement("div"),this.element.classList.add(F()),C.viewProps.bindClassModifiers(this.element)}}function mh(k){return k instanceof Xr?k.rack:k instanceof cf?k.rackController.rack:null}function xl(k){const A=mh(k);return A?A.bcSet_:null}class er{constructor(A){var C,F;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new He,this.blade_=(C=A.blade)!==null&&C!==void 0?C:null,(F=this.blade_)===null||F===void 0||F.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=A.viewProps,this.bcSet_=new bo(xl),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(A,C){var F;(F=A.parent)===null||F===void 0||F.remove(A),fe(A,"parent")?A.parent=this:(A.parent_=this,Dt({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(A,C)}remove(A){fe(A,"parent")?A.parent=null:(A.parent_=null,Dt({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(A)}find(A){return this.bcSet_.allItems().filter(C=>C instanceof A)}onSetAdd_(A){this.updatePositions_();const C=A.target===A.root;if(this.emitter.emit("add",{bladeController:A.item,index:A.index,isRoot:C,sender:this}),!C)return;const F=A.item;if(F.viewProps.emitter.on("change",this.onChildViewPropsChange_),F.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),F.viewProps.handleDispose(this.onChildDispose_),F instanceof Xs)F.binding.emitter.on("change",this.onChildInputChange_);else if(F instanceof Ka)F.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(F instanceof Fr)F.value.emitter.on("change",this.onChildValueChange_);else{const ee=mh(F);if(ee){const De=ee.emitter;De.on("layout",this.onDescendantLayout_),De.on("inputchange",this.onDescendantInputChange_),De.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(A){this.updatePositions_();const C=A.target===A.root;if(this.emitter.emit("remove",{bladeController:A.item,isRoot:C,sender:this}),!C)return;const F=A.item;if(F instanceof Xs)F.binding.emitter.off("change",this.onChildInputChange_);else if(F instanceof Ka)F.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(F instanceof Fr)F.value.emitter.off("change",this.onChildValueChange_);else{const ee=mh(F);if(ee){const De=ee.emitter;De.off("layout",this.onDescendantLayout_),De.off("inputchange",this.onDescendantInputChange_),De.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const A=this.bcSet_.items.filter(ee=>!ee.viewProps.get("hidden")),C=A[0],F=A[A.length-1];this.bcSet_.items.forEach(ee=>{const De=[];ee===C&&(De.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||De.push("veryfirst")),ee===F&&(De.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||De.push("verylast")),ee.blade.set("positions",De)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(A){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(A=>A.viewProps.get("disposed")).forEach(A=>{this.bcSet_.remove(A)})}onChildInputChange_(A){const C=function(F,ee){for(let De=0;De<F.length;De++){const Ue=F[De];if(Ue instanceof Xs&&Ue.binding===ee)return Ue}return null}(this.find(Xs),A.sender);if(!C)throw de.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:C,options:A.options,sender:this})}onChildMonitorUpdate_(A){const C=function(F,ee){for(let De=0;De<F.length;De++){const Ue=F[De];if(Ue instanceof Ka&&Ue.binding===ee)return Ue}return null}(this.find(Ka),A.sender);if(!C)throw de.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:C,sender:this})}onChildValueChange_(A){const C=function(F,ee){for(let De=0;De<F.length;De++){const Ue=F[De];if(Ue instanceof Fr&&Ue.value===ee)return Ue}return null}(this.find(Fr),A.sender);if(!C)throw de.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:C,options:A.options,sender:this})}onDescendantLayout_(A){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(A){this.emitter.emit("inputchange",{bladeController:A.bladeController,options:A.options,sender:this})}onDescendantMonitorUpdate_(A){this.emitter.emit("monitorupdate",{bladeController:A.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Xr extends Ve{constructor(A,C){super(Object.assign(Object.assign({},C),{view:new ds(A,{viewName:"brk",viewProps:C.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const F=new er({blade:C.root?void 0:C.blade,viewProps:C.viewProps});F.emitter.on("add",this.onRackAdd_),F.emitter.on("remove",this.onRackRemove_),this.rack=F,this.viewProps.handleDispose(()=>{for(let ee=this.rack.children.length-1;ee>=0;ee--)this.rack.children[ee].viewProps.set("disposed",!0)})}onRackAdd_(A){A.isRoot&&mi(this.view.element,A.bladeController.view.element,A.index)}onRackRemove_(A){A.isRoot&&gr(A.bladeController.view.element)}}const cr=Fe("cnt");class Ud{constructor(A,C){var F;this.className_=Fe((F=C.viewName)!==null&&F!==void 0?F:"fld"),this.element=A.createElement("div"),this.element.classList.add(this.className_(),cr()),C.viewProps.bindClassModifiers(this.element),this.foldable_=C.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Ge(this.foldable_,"completed",Ye(this.element,this.className_(void 0,"cpl")));const ee=A.createElement("button");ee.classList.add(this.className_("b")),Ge(C.props,"title",yn=>{ie(yn)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),C.viewProps.bindDisabled(ee),this.element.appendChild(ee),this.buttonElement=ee;const De=A.createElement("div");De.classList.add(this.className_("i")),this.element.appendChild(De);const Ue=A.createElement("div");Ue.classList.add(this.className_("t")),$(C.props.value("title"),Ue),this.buttonElement.appendChild(Ue),this.titleElement=Ue;const gt=A.createElement("div");gt.classList.add(this.className_("m")),this.buttonElement.appendChild(gt);const zt=C.containerElement;zt.classList.add(this.className_("c")),this.element.appendChild(zt),this.containerElement=zt}}class xs extends cf{constructor(A,C){var F;const ee=Sr.create((F=C.expanded)===null||F===void 0||F),De=new Xr(A,{blade:C.blade,root:C.root,viewProps:C.viewProps});super(Object.assign(Object.assign({},C),{rackController:De,view:new Ud(A,{containerElement:De.view.element,foldable:ee,props:C.props,viewName:C.root?"rot":void 0,viewProps:C.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=C.props,this.foldable=ee,_r(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const wl={id:"folder",type:"blade",accept(k){const A=Mt,C=At(k,{title:A.required.string,view:A.required.constant("folder"),expanded:A.optional.boolean});return C?{params:C}:null},controller(k){return new xs(k.document,{blade:k.blade,expanded:k.params.expanded,props:Me.fromObject({title:k.params.title}),viewProps:k.viewProps})},api(k){return k.controller instanceof xs?new fa(k.controller,k.pool):null}};class Ja extends Fr{constructor(A,C){const F=C.valueController.viewProps;super(Object.assign(Object.assign({},C),{value:C.valueController.value,view:new vr(A,{props:C.props,viewProps:F}),viewProps:F})),this.props=C.props,this.valueController=C.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class gh extends O{}const vh=Fe("spr");class Uc{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(vh()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("hr");F.classList.add(vh("r")),this.element.appendChild(F)}}class Om extends Ve{constructor(A,C){super(Object.assign(Object.assign({},C),{view:new Uc(A,{viewProps:C.viewProps})}))}}const Ls={id:"separator",type:"blade",accept(k){const A=At(k,{view:Mt.required.constant("separator")});return A?{params:A}:null},controller(k){return new Om(k.document,{blade:k.blade,viewProps:k.viewProps})},api(k){return k.controller instanceof Om?new gh(k.controller):null}},ke=Fe("tbi");class Yo{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(ke()),C.viewProps.bindClassModifiers(this.element),Ge(C.props,"selected",De=>{De?this.element.classList.add(ke(void 0,"sel")):this.element.classList.remove(ke(void 0,"sel"))});const F=A.createElement("button");F.classList.add(ke("b")),C.viewProps.bindDisabled(F),this.element.appendChild(F),this.buttonElement=F;const ee=A.createElement("div");ee.classList.add(ke("t")),$(C.props.value("title"),ee),this.buttonElement.appendChild(ee),this.titleElement=ee}}class xo{constructor(A,C){this.emitter=new He,this.onClick_=this.onClick_.bind(this),this.props=C.props,this.viewProps=C.viewProps,this.view=new Yo(A,{props:C.props,viewProps:C.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ka{constructor(A,C){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new xo(A,{props:C.itemProps,viewProps:Ft.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Xr(A,{blade:zr(),viewProps:Ft.create()}),this.props=C.props,Ge(this.props,"selected",F=>{this.itemController.props.set("selected",F),this.contentController.viewProps.set("hidden",!F)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Fi{constructor(A,C){this.controller_=A,this.rackApi_=C}get title(){var A;return(A=this.controller_.itemController.props.get("title"))!==null&&A!==void 0?A:""}set title(A){this.controller_.itemController.props.set("title",A)}get selected(){return this.controller_.props.get("selected")}set selected(A){this.controller_.props.set("selected",A)}get children(){return this.rackApi_.children}addButton(A){return this.rackApi_.addButton(A)}addFolder(A){return this.rackApi_.addFolder(A)}addSeparator(A){return this.rackApi_.addSeparator(A)}addTab(A){return this.rackApi_.addTab(A)}add(A,C){this.rackApi_.add(A,C)}remove(A){this.rackApi_.remove(A)}addInput(A,C,F){return this.rackApi_.addInput(A,C,F)}addMonitor(A,C,F){return this.rackApi_.addMonitor(A,C,F)}addBlade(A){return this.rackApi_.addBlade(A)}}class Yi extends Oa{constructor(A,C){super(A,new Cr(A.rackController,C)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new He,this.pageApiMap_=new Map,this.rackApi_.on("change",F=>{this.emitter_.emit("change",{event:F})}),this.rackApi_.on("update",F=>{this.emitter_.emit("update",{event:F})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(F=>{this.setUpPageApi_(F)})}get pages(){return this.controller_.pageSet.items.map(A=>{const C=this.pageApiMap_.get(A);if(!C)throw de.shouldNeverHappen();return C})}addPage(A){const C=this.controller_.view.element.ownerDocument,F=new ka(C,{itemProps:Me.fromObject({selected:!1,title:A.title}),props:Me.fromObject({selected:!1})});this.controller_.add(F,A.index);const ee=this.pageApiMap_.get(F);if(!ee)throw de.shouldNeverHappen();return ee}removePage(A){this.controller_.remove(A)}on(A,C){const F=C.bind(this);return this.emitter_.on(A,ee=>{F(ee.event)}),this}setUpPageApi_(A){const C=this.rackApi_.apiSet_.find(ee=>ee.controller_===A.contentController);if(!C)throw de.shouldNeverHappen();const F=new Fi(A,C);this.pageApiMap_.set(A,F)}onPageAdd_(A){this.setUpPageApi_(A.item)}onPageRemove_(A){if(!this.pageApiMap_.get(A.item))throw de.shouldNeverHappen();this.pageApiMap_.delete(A.item)}onSelect_(A){this.emitter_.emit("select",{event:new Y(this,A.rawValue)})}}class km{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=ye(!0),this.selectedIndex=ye(-1),this.items_=[]}add(A,C){const F=C??this.items_.length;this.items_.splice(F,0,A),A.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(A){const C=this.items_.indexOf(A);C<0||(this.items_.splice(C,1),A.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const A=this.items_.findIndex(C=>C.rawValue);A<0?(this.items_.forEach((C,F)=>{C.rawValue=F===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((C,F)=>{C.rawValue=F===A}),this.selectedIndex.rawValue=A),this.empty.rawValue=!1}onItemSelectedChange_(A){if(A.rawValue){const C=this.items_.findIndex(F=>F===A.sender);this.items_.forEach((F,ee)=>{F.rawValue=ee===C}),this.selectedIndex.rawValue=C}else this.keepSelection_()}}const Ko=Fe("tab");class uf{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(Ko(),cr()),C.viewProps.bindClassModifiers(this.element),pt(C.empty,Ye(this.element,Ko(void 0,"nop")));const F=A.createElement("div");F.classList.add(Ko("t")),this.element.appendChild(F),this.itemsElement=F;const ee=A.createElement("div");ee.classList.add(Ko("i")),this.element.appendChild(ee);const De=C.contentsElement;De.classList.add(Ko("c")),this.element.appendChild(De),this.contentsElement=De}}class du extends cf{constructor(A,C){const F=new Xr(A,{blade:C.blade,viewProps:C.viewProps}),ee=new km;super({blade:C.blade,rackController:F,view:new uf(A,{contentsElement:F.view.element,empty:ee.empty,viewProps:C.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new bo(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=ee}get pageSet(){return this.pageSet_}add(A,C){this.pageSet_.add(A,C)}remove(A){this.pageSet_.remove(this.pageSet_.items[A])}onPageAdd_(A){const C=A.item;mi(this.view.itemsElement,C.itemController.view.element,A.index),C.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(C.contentController,A.index),this.tab.add(C.props.value("selected"))}onPageRemove_(A){const C=A.item;gr(C.itemController.view.element),C.itemController.viewProps.set("parent",null),this.rackController.rack.remove(C.contentController),this.tab.remove(C.props.value("selected"))}}const El={id:"tab",type:"blade",accept(k){const A=Mt,C=At(k,{pages:A.required.array(A.required.object({title:A.required.string})),view:A.required.constant("tab")});return C&&C.pages.length!==0?{params:C}:null},controller(k){const A=new du(k.document,{blade:k.blade,viewProps:k.viewProps});return k.params.pages.forEach(C=>{const F=new ka(k.document,{itemProps:Me.fromObject({selected:!1,title:C.title}),props:Me.fromObject({selected:!1})});A.add(F)}),A},api(k){return k.controller instanceof du?new Yi(k.controller,k.pool):null}};class Nd{constructor(){this.disabled=!1,this.emitter=new He}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class pu{constructor(A,C){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=A,this.emitter=new He,this.interval_=C,this.setTimer_()}get disabled(){return this.disabled_}set disabled(A){this.disabled_=A,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const A=this.doc_.defaultView;A&&A.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const A=this.doc_.defaultView;A&&(this.timerId_=A.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class hf{constructor(A){this.onValueChange_=this.onValueChange_.bind(this),this.reader=A.reader,this.writer=A.writer,this.emitter=new He,this.value=A.value,this.value.emitter.on("change",this.onValueChange_),this.target=A.target,this.read()}read(){const A=this.target.read();A!==void 0&&(this.value.rawValue=this.reader(A))}write_(A){this.writer(this.target,A)}onValueChange_(A){this.write_(A.rawValue),this.emitter.emit("change",{options:A.options,rawValue:A.rawValue,sender:this})}}function Fd(k,A){for(;k.length<A;)k.push(void 0)}function wo(k){const A=[];return Fd(A,k),ye(A)}function df(k){const A=k.indexOf(void 0);return A<0?k:k.slice(0,A)}class Um{constructor(A){this.onTick_=this.onTick_.bind(this),this.reader_=A.reader,this.target=A.target,this.emitter=new He,this.value=A.value,this.ticker=A.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const A=this.target.read();if(A===void 0)return;const C=this.value.rawValue,F=this.reader_(A);this.value.rawValue=function(ee,De){const Ue=[...df(ee),De];return Ue.length>ee.length?Ue.splice(0,Ue.length-ee.length):Fd(Ue,ee.length),Ue}(C,F),this.emitter.emit("update",{rawValue:F,sender:this})}onTick_(A){this.read()}}class Nc{constructor(A){this.constraints=A}constrain(A){return this.constraints.reduce((C,F)=>F.constrain(C),A)}}function Za(k,A){if(k instanceof A)return k;if(k instanceof Nc){const C=k.constraints.reduce((F,ee)=>F||(ee instanceof A?ee:null),null);if(C)return C}return null}class Yr{constructor(A){this.values=Me.fromObject({max:A.max,min:A.min})}constrain(A){const C=this.values.get("max"),F=this.values.get("min");return Math.min(Math.max(A,F),C)}}class ac{constructor(A){this.values=Me.fromObject({options:A})}get options(){return this.values.get("options")}constrain(A){const C=this.values.get("options");return C.length===0||C.filter(F=>F.value===A).length>0?A:C[0].value}}class pf{constructor(A){this.values=Me.fromObject({max:A.max,min:A.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(A){const C=this.values.get("max"),F=this.values.get("min");let ee=A;return ie(F)||(ee=Math.max(ee,F)),ie(C)||(ee=Math.min(ee,C)),ee}}class _h{constructor(A,C=0){this.step=A,this.origin=C}constrain(A){const C=this.origin%this.step;return C+Math.round((A-C)/this.step)*this.step}}const zd=Fe("lst");class ps{constructor(A,C){this.onValueChange_=this.onValueChange_.bind(this),this.props_=C.props,this.element=A.createElement("div"),this.element.classList.add(zd()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("select");F.classList.add(zd("s")),Ge(this.props_,"options",De=>{Ni(F),De.forEach((Ue,gt)=>{const zt=A.createElement("option");zt.dataset.index=String(gt),zt.textContent=Ue.text,zt.value=String(Ue.value),F.appendChild(zt)})}),C.viewProps.bindDisabled(F),this.element.appendChild(F),this.selectElement=F;const ee=A.createElement("div");ee.classList.add(zd("m")),ee.appendChild(Ci(A,"dropdown")),this.element.appendChild(ee),C.value.emitter.on("change",this.onValueChange_),this.value_=C.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class oc{constructor(A,C){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=C.props,this.value=C.value,this.viewProps=C.viewProps,this.view=new ps(A,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(A){const C=A.currentTarget.selectedOptions.item(0);if(!C)return;const F=Number(C.dataset.index);this.value.rawValue=this.props.get("options")[F].value}}const ff=Fe("pop");class Ys{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(ff()),C.viewProps.bindClassModifiers(this.element),pt(C.shows,Ye(this.element,ff(void 0,"v")))}}class fu{constructor(A,C){this.shows=ye(!1),this.viewProps=C.viewProps,this.view=new Ys(A,{shows:this.shows,viewProps:this.viewProps})}}const ma=Fe("txt");class sn{constructor(A,C){this.onChange_=this.onChange_.bind(this),this.element=A.createElement("div"),this.element.classList.add(ma()),C.viewProps.bindClassModifiers(this.element),this.props_=C.props,this.props_.emitter.on("change",this.onChange_);const F=A.createElement("input");F.classList.add(ma("i")),F.type="text",C.viewProps.bindDisabled(F),this.element.appendChild(F),this.inputElement=F,C.value.emitter.on("change",this.onChange_),this.value_=C.value,this.refresh()}refresh(){const A=this.props_.get("formatter");this.inputElement.value=A(this.value_.rawValue)}onChange_(){this.refresh()}}class Jo{constructor(A,C){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=C.parser,this.props=C.props,this.value=C.value,this.viewProps=C.viewProps,this.view=new sn(A,{props:C.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(A){const C=A.currentTarget.value,F=this.parser_(C);ie(F)||(this.value.rawValue=F),this.view.refresh()}}function gn(k){return k!=="false"&&!!k}function Ks(k){return function(A){return String(A)}(k)}class Eo{constructor(A){this.text=A}evaluate(){return Number(this.text)}toString(){return this.text}}const Bi={"**":(k,A)=>Math.pow(k,A),"*":(k,A)=>k*A,"/":(k,A)=>k/A,"%":(k,A)=>k%A,"+":(k,A)=>k+A,"-":(k,A)=>k-A,"<<":(k,A)=>k<<A,">>":(k,A)=>k>>A,">>>":(k,A)=>k>>>A,"&":(k,A)=>k&A,"^":(k,A)=>k^A,"|":(k,A)=>k|A};class gi{constructor(A,C,F){this.left=C,this.operator=A,this.right=F}evaluate(){const A=Bi[this.operator];if(!A)throw new Error(`unexpected binary operator: '${this.operator}`);return A(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const lc={"+":k=>k,"-":k=>-k,"~":k=>~k};class yh{constructor(A,C){this.operator=A,this.expression=C}evaluate(){const A=lc[this.operator];if(!A)throw new Error(`unexpected unary operator: '${this.operator}`);return A(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Sl(k){return(A,C)=>{for(let F=0;F<k.length;F++){const ee=k[F](A,C);if(ee!=="")return ee}return""}}function $a(k,A){var C;const F=k.substr(A).match(/^\s+/);return(C=F&&F[0])!==null&&C!==void 0?C:""}function Vn(k,A){var C;const F=k.substr(A).match(/^[0-9]+/);return(C=F&&F[0])!==null&&C!==void 0?C:""}function Ml(k,A){const C=k.substr(A,1);if(A+=1,C.toLowerCase()!=="e")return"";const F=function(ee,De){const Ue=Vn(ee,De);if(Ue!=="")return Ue;const gt=ee.substr(De,1);if(gt!=="-"&&gt!=="+")return"";const zt=Vn(ee,De+=1);return zt===""?"":gt+zt}(k,A);return F===""?"":C+F}function mu(k,A){const C=k.substr(A,1);if(C==="0")return C;const F=function(ee,De){const Ue=ee.substr(De,1);return Ue.match(/^[1-9]$/)?Ue:""}(k,A);return A+=F.length,F===""?"":F+Vn(k,A)}const Fc=Sl([function(k,A){const C=mu(k,A);if(A+=C.length,C==="")return"";const F=k.substr(A,1);if(A+=F.length,F!==".")return"";const ee=Vn(k,A);return C+F+ee+Ml(k,A+=ee.length)},function(k,A){const C=k.substr(A,1);if(A+=C.length,C!==".")return"";const F=Vn(k,A);return A+=F.length,F===""?"":C+F+Ml(k,A)},function(k,A){const C=mu(k,A);return A+=C.length,C===""?"":C+Ml(k,A)}]),cc=Sl([function(k,A){const C=k.substr(A,2);if(A+=C.length,C.toLowerCase()!=="0b")return"";const F=function(ee,De){var Ue;const gt=ee.substr(De).match(/^[01]+/);return(Ue=gt&&gt[0])!==null&&Ue!==void 0?Ue:""}(k,A);return F===""?"":C+F},function(k,A){const C=k.substr(A,2);if(A+=C.length,C.toLowerCase()!=="0o")return"";const F=function(ee,De){var Ue;const gt=ee.substr(De).match(/^[0-7]+/);return(Ue=gt&&gt[0])!==null&&Ue!==void 0?Ue:""}(k,A);return F===""?"":C+F},function(k,A){const C=k.substr(A,2);if(A+=C.length,C.toLowerCase()!=="0x")return"";const F=function(ee,De){var Ue;const gt=ee.substr(De).match(/^[0-9a-f]+/i);return(Ue=gt&&gt[0])!==null&&Ue!==void 0?Ue:""}(k,A);return F===""?"":C+F}]),Ah=Sl([cc,Fc]);function mf(k,A){var C;return(C=function(F,ee){const De=Ah(F,ee);return ee+=De.length,De===""?null:{evaluable:new Eo(De),cursor:ee}}(k,A))!==null&&C!==void 0?C:function(F,ee){const De=F.substr(ee,1);if(ee+=De.length,De!=="(")return null;const Ue=gu(F,ee);if(!Ue)return null;ee=Ue.cursor,ee+=$a(F,ee).length;const gt=F.substr(ee,1);return ee+=gt.length,gt!==")"?null:{evaluable:Ue.evaluable,cursor:ee}}(k,A)}function Ki(k,A,C){C+=$a(A,C).length;const F=k.filter(ee=>A.startsWith(ee,C))[0];return F?(C+=F.length,{cursor:C+=$a(A,C).length,operator:F}):null}const Xi=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((k,A)=>function(C,F){return(ee,De)=>{const Ue=C(ee,De);if(!Ue)return null;De=Ue.cursor;let gt=Ue.evaluable;for(;;){const zt=Ki(F,ee,De);if(!zt)break;De=zt.cursor;const yn=C(ee,De);if(!yn)return null;De=yn.cursor,gt=new gi(zt.operator,gt,yn.evaluable)}return gt?{cursor:De,evaluable:gt}:null}}(k,A),function k(A,C){const F=mf(A,C);if(F)return F;const ee=A.substr(C,1);if(C+=ee.length,ee!=="+"&&ee!=="-"&&ee!=="~")return null;const De=k(A,C);return De?{cursor:C=De.cursor,evaluable:new yh(ee,De.evaluable)}:null});function gu(k,A){return A+=$a(k,A).length,Xi(k,A)}function rs(k){var A;const C=function(F){const ee=gu(F,0);return ee?ee.cursor+$a(F,ee.cursor).length!==F.length?null:ee.evaluable:null}(k);return(A=C==null?void 0:C.evaluate())!==null&&A!==void 0?A:null}function Zo(k){if(typeof k=="number")return k;if(typeof k=="string"){const A=rs(k);if(!ie(A))return A}return 0}function Br(k){return String(k)}function _n(k){return A=>A.toFixed(Math.max(Math.min(k,20),0))}const fs=_n(0);function So(k){return fs(k)+"%"}function zc(k){return String(k)}function Mo(k){return k}function Xn({primary:k,secondary:A,forward:C,backward:F}){let ee=!1;function De(Ue){ee||(ee=!0,Ue(),ee=!1)}k.emitter.on("change",Ue=>{De(()=>{A.setRawValue(C(k,A),Ue.options)})}),A.emitter.on("change",Ue=>{De(()=>{k.setRawValue(F(k,A),Ue.options)}),De(()=>{A.setRawValue(C(k,A),Ue.options)})}),De(()=>{A.setRawValue(C(k,A),{forceEmit:!1,last:!0})})}function vi(k,A){const C=k*(A.altKey?.1:1)*(A.shiftKey?10:1);return A.upKey?+C:A.downKey?-C:0}function $o(k){return{altKey:k.altKey,downKey:k.key==="ArrowDown",shiftKey:k.shiftKey,upKey:k.key==="ArrowUp"}}function Co(k){return{altKey:k.altKey,downKey:k.key==="ArrowLeft",shiftKey:k.shiftKey,upKey:k.key==="ArrowRight"}}function Tv(k){return function(A){return A==="ArrowUp"||A==="ArrowDown"}(k)||k==="ArrowLeft"||k==="ArrowRight"}function ga(k,A){var C,F;const ee=A.ownerDocument.defaultView,De=A.getBoundingClientRect();return{x:k.pageX-(((C=ee&&ee.scrollX)!==null&&C!==void 0?C:0)+De.left),y:k.pageY-(((F=ee&&ee.scrollY)!==null&&F!==void 0?F:0)+De.top)}}class Sn{constructor(A){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=A,this.emitter=new He,A.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),A.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),A.addEventListener("touchend",this.onTouchEnd_),A.addEventListener("mousedown",this.onMouseDown_)}computePosition_(A){const C=this.elem_.getBoundingClientRect();return{bounds:{width:C.width,height:C.height},point:A?{x:A.x,y:A.y}:null}}onMouseDown_(A){var C;A.preventDefault(),(C=A.currentTarget)===null||C===void 0||C.focus();const F=this.elem_.ownerDocument;F.addEventListener("mousemove",this.onDocumentMouseMove_),F.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:A.altKey,data:this.computePosition_(ga(A,this.elem_)),sender:this,shiftKey:A.shiftKey})}onDocumentMouseMove_(A){this.emitter.emit("move",{altKey:A.altKey,data:this.computePosition_(ga(A,this.elem_)),sender:this,shiftKey:A.shiftKey})}onDocumentMouseUp_(A){const C=this.elem_.ownerDocument;C.removeEventListener("mousemove",this.onDocumentMouseMove_),C.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:A.altKey,data:this.computePosition_(ga(A,this.elem_)),sender:this,shiftKey:A.shiftKey})}onTouchStart_(A){A.preventDefault();const C=A.targetTouches.item(0),F=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:A.altKey,data:this.computePosition_(C?{x:C.clientX-F.left,y:C.clientY-F.top}:void 0),sender:this,shiftKey:A.shiftKey}),this.lastTouch_=C}onTouchMove_(A){const C=A.targetTouches.item(0),F=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:A.altKey,data:this.computePosition_(C?{x:C.clientX-F.left,y:C.clientY-F.top}:void 0),sender:this,shiftKey:A.shiftKey}),this.lastTouch_=C}onTouchEnd_(A){var C;const F=(C=A.targetTouches.item(0))!==null&&C!==void 0?C:this.lastTouch_,ee=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:A.altKey,data:this.computePosition_(F?{x:F.clientX-ee.left,y:F.clientY-ee.top}:void 0),sender:this,shiftKey:A.shiftKey})}}function tr(k,A,C,F,ee){return F+(k-A)/(C-A)*(ee-F)}function To(k){return String(k.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Kr(k,A,C){return Math.min(Math.max(k,A),C)}function gf(k,A){return(k%A+A)%A}const eo=Fe("txt");class Ri{constructor(A,C){this.onChange_=this.onChange_.bind(this),this.props_=C.props,this.props_.emitter.on("change",this.onChange_),this.element=A.createElement("div"),this.element.classList.add(eo(),eo(void 0,"num")),C.arrayPosition&&this.element.classList.add(eo(void 0,C.arrayPosition)),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("input");F.classList.add(eo("i")),F.type="text",C.viewProps.bindDisabled(F),this.element.appendChild(F),this.inputElement=F,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=C.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(eo()),this.inputElement.classList.add(eo("i"));const ee=A.createElement("div");ee.classList.add(eo("k")),this.element.appendChild(ee),this.knobElement=ee;const De=A.createElementNS(tt,"svg");De.classList.add(eo("g")),this.knobElement.appendChild(De);const Ue=A.createElementNS(tt,"path");Ue.classList.add(eo("gb")),De.appendChild(Ue),this.guideBodyElem_=Ue;const gt=A.createElementNS(tt,"path");gt.classList.add(eo("gh")),De.appendChild(gt),this.guideHeadElem_=gt;const zt=A.createElement("div");zt.classList.add(Fe("tt")()),this.knobElement.appendChild(zt),this.tooltipElem_=zt,C.value.emitter.on("change",this.onChange_),this.value=C.value,this.refresh()}onDraggingChange_(A){if(A.rawValue===null)return void this.element.classList.remove(eo(void 0,"drg"));this.element.classList.add(eo(void 0,"drg"));const C=A.rawValue/this.props_.get("draggingScale"),F=C+(C>0?-1:C<0?1:0),ee=Kr(-F,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${F+ee},0 L${F},4 L${F+ee},8`,`M ${C},-1 L${C},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${C},4`);const De=this.props_.get("formatter");this.tooltipElem_.textContent=De(this.value.rawValue),this.tooltipElem_.style.left=`${C}px`}refresh(){const A=this.props_.get("formatter");this.inputElement.value=A(this.value.rawValue)}onChange_(){this.refresh()}}class jd{constructor(A,C){var F;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=C.baseStep,this.parser_=C.parser,this.props=C.props,this.sliderProps_=(F=C.sliderProps)!==null&&F!==void 0?F:null,this.value=C.value,this.viewProps=C.viewProps,this.dragging_=ye(null),this.view=new Ri(A,{arrayPosition:C.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const ee=new Sn(this.view.knobElement);ee.emitter.on("down",this.onPointerDown_),ee.emitter.on("move",this.onPointerMove_),ee.emitter.on("up",this.onPointerUp_)}constrainValue_(A){var C,F;const ee=(C=this.sliderProps_)===null||C===void 0?void 0:C.get("minValue"),De=(F=this.sliderProps_)===null||F===void 0?void 0:F.get("maxValue");let Ue=A;return ee!==void 0&&(Ue=Math.max(Ue,ee)),De!==void 0&&(Ue=Math.min(Ue,De)),Ue}onInputChange_(A){const C=A.currentTarget.value,F=this.parser_(C);ie(F)||(this.value.rawValue=this.constrainValue_(F)),this.view.refresh()}onInputKeyDown_(A){const C=vi(this.baseStep_,$o(A));C!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+C),{forceEmit:!1,last:!1})}onInputKeyUp_(A){vi(this.baseStep_,$o(A))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(A){if(!A.point)return null;const C=A.point.x-A.bounds.width/2;return this.constrainValue_(this.originRawValue_+C*this.props.get("draggingScale"))}onPointerMove_(A){const C=this.computeDraggingValue_(A.data);C!==null&&(this.value.setRawValue(C,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(A){const C=this.computeDraggingValue_(A.data);C!==null&&(this.value.setRawValue(C,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const vf=Fe("sld");class Iv{constructor(A,C){this.onChange_=this.onChange_.bind(this),this.props_=C.props,this.props_.emitter.on("change",this.onChange_),this.element=A.createElement("div"),this.element.classList.add(vf()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("div");F.classList.add(vf("t")),C.viewProps.bindTabIndex(F),this.element.appendChild(F),this.trackElement=F;const ee=A.createElement("div");ee.classList.add(vf("k")),this.trackElement.appendChild(ee),this.knobElement=ee,C.value.emitter.on("change",this.onChange_),this.value=C.value,this.update_()}update_(){const A=Kr(tr(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${A}%`}onChange_(){this.update_()}}class Pv{constructor(A,C){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=C.baseStep,this.value=C.value,this.viewProps=C.viewProps,this.props=C.props,this.view=new Iv(A,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(A,C){A.point&&this.value.setRawValue(tr(Kr(A.point.x,0,A.bounds.width),0,A.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),C)}onPointerDownOrMove_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerUp_(A){this.handlePointerEvent_(A.data,{forceEmit:!0,last:!0})}onKeyDown_(A){const C=vi(this.baseStep_,Co(A));C!==0&&this.value.setRawValue(this.value.rawValue+C,{forceEmit:!1,last:!1})}onKeyUp_(A){vi(this.baseStep_,Co(A))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Nm=Fe("sldtxt");class Fm{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(Nm());const F=A.createElement("div");F.classList.add(Nm("s")),this.sliderView_=C.sliderView,F.appendChild(this.sliderView_.element),this.element.appendChild(F);const ee=A.createElement("div");ee.classList.add(Nm("t")),this.textView_=C.textView,ee.appendChild(this.textView_.element),this.element.appendChild(ee)}}class bh{constructor(A,C){this.value=C.value,this.viewProps=C.viewProps,this.sliderC_=new Pv(A,{baseStep:C.baseStep,props:C.sliderProps,value:C.value,viewProps:this.viewProps}),this.textC_=new jd(A,{baseStep:C.baseStep,parser:C.parser,props:C.textProps,sliderProps:C.sliderProps,value:C.value,viewProps:C.viewProps}),this.view=new Fm(A,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function el(k,A){k.write(A)}function Os(k){const A=Mt;return Array.isArray(k)?A.required.array(A.required.object({text:A.required.string,value:A.required.raw}))(k).value:typeof k=="object"?A.required.raw(k).value:void 0}function _f(k){if(k==="inline"||k==="popup")return k}function ks(k){const A=Mt;return A.required.object({max:A.optional.number,min:A.optional.number,step:A.optional.number})(k).value}function Vd(k){if(Array.isArray(k))return k;const A=[];return Object.keys(k).forEach(C=>{A.push({text:C,value:k[C]})}),A}function Gd(k){return ie(k)?null:new ac(Vd(k))}function yf(k,A){const C=k&&Za(k,_h);return C?To(C.step):Math.max(To(A),2)}function vu(k){const A=function(C){const F=C?Za(C,_h):null;return F?F.step:null}(k);return A??1}function _u(k,A){var C;const F=k&&Za(k,_h),ee=Math.abs((C=F==null?void 0:F.step)!==null&&C!==void 0?C:A);return ee===0?.1:Math.pow(10,Math.floor(Math.log10(ee))-1)}const yr=Fe("ckb");class xh{constructor(A,C){this.onValueChange_=this.onValueChange_.bind(this),this.element=A.createElement("div"),this.element.classList.add(yr()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("label");F.classList.add(yr("l")),this.element.appendChild(F);const ee=A.createElement("input");ee.classList.add(yr("i")),ee.type="checkbox",F.appendChild(ee),this.inputElement=ee,C.viewProps.bindDisabled(this.inputElement);const De=A.createElement("div");De.classList.add(yr("w")),F.appendChild(De);const Ue=Ci(A,"check");De.appendChild(Ue),C.value.emitter.on("change",this.onValueChange_),this.value=C.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Hd{constructor(A,C){this.onInputChange_=this.onInputChange_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.view=new xh(A,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(A){const C=A.currentTarget;this.value.rawValue=C.checked}}const tl={id:"input-bool",type:"input",accept:(k,A)=>{if(typeof k!="boolean")return null;const C=At(A,{options:Mt.optional.custom(Os)});return C?{initialValue:k,params:C}:null},binding:{reader:k=>gn,constraint:k=>function(A){const C=[],F=Gd(A.options);return F&&C.push(F),new Nc(C)}(k.params),writer:k=>el},controller:k=>{const A=k.document,C=k.value,F=k.constraint,ee=F&&Za(F,ac);return ee?new oc(A,{props:new Me({options:ee.values.value("options")}),value:C,viewProps:k.viewProps}):new Hd(A,{value:C,viewProps:k.viewProps})}},Ar=Fe("col");class Rv{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(Ar()),C.foldable.bindExpandedClass(this.element,Ar(void 0,"expanded")),Ge(C.foldable,"completed",Ye(this.element,Ar(void 0,"cpl")));const F=A.createElement("div");F.classList.add(Ar("h")),this.element.appendChild(F);const ee=A.createElement("div");ee.classList.add(Ar("s")),F.appendChild(ee),this.swatchElement=ee;const De=A.createElement("div");if(De.classList.add(Ar("t")),F.appendChild(De),this.textElement=De,C.pickerLayout==="inline"){const Ue=A.createElement("div");Ue.classList.add(Ar("p")),this.element.appendChild(Ue),this.pickerElement=Ue}else this.pickerElement=null}}function uc(k,A,C){const F=gf(k,360),ee=Kr(A/100,0,1),De=Kr(C/100,0,1),Ue=De*ee,gt=Ue*(1-Math.abs(F/60%2-1)),zt=De-Ue;let yn,ri,sr;return[yn,ri,sr]=F>=0&&F<60?[Ue,gt,0]:F>=60&&F<120?[gt,Ue,0]:F>=120&&F<180?[0,Ue,gt]:F>=180&&F<240?[0,gt,Ue]:F>=240&&F<300?[gt,0,Ue]:[Ue,0,gt],[255*(yn+zt),255*(ri+zt),255*(sr+zt)]}function Io(k){return[k[0],k[1],k[2]]}function Ua(k,A){return[k[0],k[1],k[2],A]}const Hn={hsl:{hsl:(k,A,C)=>[k,A,C],hsv:function(k,A,C){const F=C+A*(100-Math.abs(2*C-100))/200;return[k,F!==0?A*(100-Math.abs(2*C-100))/F:0,C+A*(100-Math.abs(2*C-100))/200]},rgb:function(k,A,C){const F=(k%360+360)%360,ee=Kr(A/100,0,1),De=Kr(C/100,0,1),Ue=(1-Math.abs(2*De-1))*ee,gt=Ue*(1-Math.abs(F/60%2-1)),zt=De-Ue/2;let yn,ri,sr;return[yn,ri,sr]=F>=0&&F<60?[Ue,gt,0]:F>=60&&F<120?[gt,Ue,0]:F>=120&&F<180?[0,Ue,gt]:F>=180&&F<240?[0,gt,Ue]:F>=240&&F<300?[gt,0,Ue]:[Ue,0,gt],[255*(yn+zt),255*(ri+zt),255*(sr+zt)]}},hsv:{hsl:function(k,A,C){const F=100-Math.abs(C*(200-A)/100-100);return[k,F!==0?A*C/F:0,C*(200-A)/200]},hsv:(k,A,C)=>[k,A,C],rgb:uc},rgb:{hsl:function(k,A,C){const F=Kr(k/255,0,1),ee=Kr(A/255,0,1),De=Kr(C/255,0,1),Ue=Math.max(F,ee,De),gt=Math.min(F,ee,De),zt=Ue-gt;let yn=0,ri=0;const sr=(gt+Ue)/2;return zt!==0&&(ri=zt/(1-Math.abs(Ue+gt-1)),yn=F===Ue?(ee-De)/zt:ee===Ue?2+(De-F)/zt:4+(F-ee)/zt,yn=yn/6+(yn<0?1:0)),[360*yn,100*ri,100*sr]},hsv:function(k,A,C){const F=Kr(k/255,0,1),ee=Kr(A/255,0,1),De=Kr(C/255,0,1),Ue=Math.max(F,ee,De),gt=Ue-Math.min(F,ee,De);let zt;return zt=gt===0?0:Ue===F?((ee-De)/gt%6+6)%6*60:Ue===ee?60*((De-F)/gt+2):60*((F-ee)/gt+4),[zt,100*(Ue===0?0:gt/Ue),100*Ue]},rgb:(k,A,C)=>[k,A,C]}};function wh(k,A){return[A==="float"?1:k==="rgb"?255:360,A==="float"?1:k==="rgb"?255:100,A==="float"?1:k==="rgb"?255:100]}function Eh(k,A,C,F){const ee=wh(A,C),De=wh(A,F);return k.map((Ue,gt)=>Ue/ee[gt]*De[gt])}function Sh(k,A){return typeof k=="object"&&!ie(k)&&A in k&&typeof k[A]=="number"}class Pi{static black(A="int"){return new Pi([0,0,0],"rgb",A)}static fromObject(A,C="int"){const F="a"in A?[A.r,A.g,A.b,A.a]:[A.r,A.g,A.b];return new Pi(F,"rgb",C)}static toRgbaObject(A,C="int"){return A.toRgbaObject(C)}static isRgbColorObject(A){return Sh(A,"r")&&Sh(A,"g")&&Sh(A,"b")}static isRgbaColorObject(A){return this.isRgbColorObject(A)&&Sh(A,"a")}static isColorObject(A){return this.isRgbColorObject(A)}static equals(A,C){if(A.mode!==C.mode)return!1;const F=A.comps_,ee=C.comps_;for(let De=0;De<F.length;De++)if(F[De]!==ee[De])return!1;return!0}constructor(A,C,F="int"){this.mode=C,this.type=F,this.comps_=function(ee,De,Ue){var gt;const zt=wh(De,Ue);return[De==="rgb"?Kr(ee[0],0,zt[0]):(yn=ee[0],ri=zt[0],yn===ri?ri:gf(yn,ri)),Kr(ee[1],0,zt[1]),Kr(ee[2],0,zt[2]),Kr((gt=ee[3])!==null&&gt!==void 0?gt:1,0,1)];var yn,ri}(A,C,F)}getComponents(A,C="int"){return Ua(function(F,ee,De){const Ue=Eh(F,ee.mode,ee.type,"int");return Eh(Hn[ee.mode][De.mode](...Ue),De.mode,"int",De.type)}(Io(this.comps_),{mode:this.mode,type:this.type},{mode:A??this.mode,type:C}),this.comps_[3])}toRgbaObject(A="int"){const C=this.getComponents("rgb",A);return{r:C[0],g:C[1],b:C[2],a:C[3]}}}const hc=Fe("colp");class to{constructor(A,C){this.alphaViews_=null,this.element=A.createElement("div"),this.element.classList.add(hc()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("div");F.classList.add(hc("hsv"));const ee=A.createElement("div");ee.classList.add(hc("sv")),this.svPaletteView_=C.svPaletteView,ee.appendChild(this.svPaletteView_.element),F.appendChild(ee);const De=A.createElement("div");De.classList.add(hc("h")),this.hPaletteView_=C.hPaletteView,De.appendChild(this.hPaletteView_.element),F.appendChild(De),this.element.appendChild(F);const Ue=A.createElement("div");if(Ue.classList.add(hc("rgb")),this.textView_=C.textView,Ue.appendChild(this.textView_.element),this.element.appendChild(Ue),C.alphaViews){this.alphaViews_={palette:C.alphaViews.palette,text:C.alphaViews.text};const gt=A.createElement("div");gt.classList.add(hc("a"));const zt=A.createElement("div");zt.classList.add(hc("ap")),zt.appendChild(this.alphaViews_.palette.element),gt.appendChild(zt);const yn=A.createElement("div");yn.classList.add(hc("at")),yn.appendChild(this.alphaViews_.text.element),gt.appendChild(yn),this.element.appendChild(gt)}}get allFocusableElements(){const A=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(C=>C.inputElement)];return this.alphaViews_&&A.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),A}}function Si(k){return k==="int"?"int":k==="float"?"float":void 0}function zm(k){const A=Mt;return At(k,{alpha:A.optional.boolean,color:A.optional.object({alpha:A.optional.boolean,type:A.optional.custom(Si)}),expanded:A.optional.boolean,picker:A.optional.custom(_f)})}function qt(k){return k?.1:1}function Ai(k){var A;return(A=k.color)===null||A===void 0?void 0:A.type}function Na(k,A){const C=k.match(/^(.+)%$/);return Math.min(C?.01*parseFloat(C[1])*A:parseFloat(k),A)}const Dv={deg:k=>k,grad:k=>360*k/400,rad:k=>360*k/(2*Math.PI),turn:k=>360*k};function Bv(k){const A=k.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!A)return parseFloat(k);const C=parseFloat(A[1]),F=A[2];return Dv[F](C)}function yu(k){const A=k.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!A)return null;const C=[Na(A[1],255),Na(A[2],255),Na(A[3],255)];return isNaN(C[0])||isNaN(C[1])||isNaN(C[2])?null:C}function Mh(k){return A=>{const C=yu(A);return C?new Pi(C,"rgb",k):null}}function Af(k){const A=k.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!A)return null;const C=[Na(A[1],255),Na(A[2],255),Na(A[3],255),Na(A[4],1)];return isNaN(C[0])||isNaN(C[1])||isNaN(C[2])||isNaN(C[3])?null:C}function Au(k){return A=>{const C=Af(A);return C?new Pi(C,"rgb",k):null}}function bu(k){const A=k.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!A)return null;const C=[Bv(A[1]),Na(A[2],100),Na(A[3],100)];return isNaN(C[0])||isNaN(C[1])||isNaN(C[2])?null:C}function bf(k){return A=>{const C=bu(A);return C?new Pi(C,"hsl",k):null}}function Lv(k){const A=k.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!A)return null;const C=[Bv(A[1]),Na(A[2],100),Na(A[3],100),Na(A[4],1)];return isNaN(C[0])||isNaN(C[1])||isNaN(C[2])||isNaN(C[3])?null:C}function jm(k){return A=>{const C=Lv(A);return C?new Pi(C,"hsl",k):null}}function Ov(k){const A=k.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(A)return[parseInt(A[1]+A[1],16),parseInt(A[2]+A[2],16),parseInt(A[3]+A[3],16)];const C=k.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return C?[parseInt(C[1],16),parseInt(C[2],16),parseInt(C[3],16)]:null}function kv(k){const A=k.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(A)return[parseInt(A[1]+A[1],16),parseInt(A[2]+A[2],16),parseInt(A[3]+A[3],16),tr(parseInt(A[4]+A[4],16),0,255,0,1)];const C=k.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return C?[parseInt(C[1],16),parseInt(C[2],16),parseInt(C[3],16),tr(parseInt(C[4],16),0,255,0,1)]:null}function Tr(k){const A=k.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!A)return null;const C=[parseFloat(A[1]),parseFloat(A[2]),parseFloat(A[3])];return isNaN(C[0])||isNaN(C[1])||isNaN(C[2])?null:C}function Po(k){return A=>{const C=Tr(A);return C?new Pi(C,"rgb",k):null}}function Qd(k){const A=k.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!A)return null;const C=[parseFloat(A[1]),parseFloat(A[2]),parseFloat(A[3]),parseFloat(A[4])];return isNaN(C[0])||isNaN(C[1])||isNaN(C[2])||isNaN(C[3])?null:C}function dc(k){return A=>{const C=Qd(A);return C?new Pi(C,"rgb",k):null}}const Wd=[{parser:Ov,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:kv,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:yu,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Af,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:bu,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Lv,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Tr,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Qd,result:{alpha:!0,mode:"rgb",notation:"object"}}];function qd(k,A="int"){const C=function(F){return Wd.reduce((ee,{parser:De,result:Ue})=>ee||(De(F)?Ue:null),null)}(k);return C?C.notation==="hex"&&A!=="float"?Object.assign(Object.assign({},C),{type:"int"}):C.notation==="func"?Object.assign(Object.assign({},C),{type:A}):null:null}const pr={int:[function(k){const A=Ov(k);return A?new Pi(A,"rgb","int"):null},function(k){const A=kv(k);return A?new Pi(A,"rgb","int"):null},Mh("int"),Au("int"),bf("int"),jm("int"),Po("int"),dc("int")],float:[Mh("float"),Au("float"),bf("float"),jm("float"),Po("float"),dc("float")]};function Ji(k){const A=pr[k];return C=>A.reduce((F,ee)=>F||ee(C),null)}function ms(k){const A=Kr(Math.floor(k),0,255).toString(16);return A.length===1?`0${A}`:A}function no(k,A="#"){return`${A}${Io(k.getComponents("rgb")).map(ms).join("")}`}function Vm(k,A="#"){const C=k.getComponents("rgb");return`${A}${[C[0],C[1],C[2],255*C[3]].map(ms).join("")}`}function xf(k,A){const C=_n(A==="float"?2:0);return`rgb(${Io(k.getComponents("rgb",A)).map(F=>C(F)).join(", ")})`}function Uv(k){return A=>xf(A,k)}function Ch(k,A){const C=_n(2),F=_n(A==="float"?2:0);return`rgba(${k.getComponents("rgb",A).map((ee,De)=>(De===3?C:F)(ee)).join(", ")})`}function Fa(k){return A=>Ch(A,k)}function ze(k,A){const C=_n(A==="float"?2:0),F=["r","g","b"];return`{${Io(k.getComponents("rgb",A)).map((ee,De)=>`${F[De]}: ${C(ee)}`).join(", ")}}`}function wf(k){return A=>ze(A,k)}function Ef(k,A){const C=_n(2),F=_n(A==="float"?2:0),ee=["r","g","b","a"];return`{${k.getComponents("rgb",A).map((De,Ue)=>`${ee[Ue]}: ${(Ue===3?C:F)(De)}`).join(", ")}}`}function nl(k){return A=>Ef(A,k)}const Cl=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:no},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Vm},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(k){const A=[_n(0),So,So];return`hsl(${Io(k.getComponents("hsl")).map((C,F)=>A[F](C)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(k){const A=[_n(0),So,So,_n(2)];return`hsla(${k.getComponents("hsl").map((C,F)=>A[F](C)).join(", ")})`}},...["int","float"].reduce((k,A)=>[...k,{format:{alpha:!1,mode:"rgb",notation:"func",type:A},stringifier:Uv(A)},{format:{alpha:!0,mode:"rgb",notation:"func",type:A},stringifier:Fa(A)},{format:{alpha:!1,mode:"rgb",notation:"object",type:A},stringifier:wf(A)},{format:{alpha:!0,mode:"rgb",notation:"object",type:A},stringifier:nl(A)}],[])];function Js(k){return Cl.reduce((A,C)=>{return A||(F=C.format,ee=k,F.alpha===ee.alpha&&F.mode===ee.mode&&F.notation===ee.notation&&F.type===ee.type?C.stringifier:null);var F,ee},null)}const Jr=Fe("apl");class xu{constructor(A,C){this.onValueChange_=this.onValueChange_.bind(this),this.value=C.value,this.value.emitter.on("change",this.onValueChange_),this.element=A.createElement("div"),this.element.classList.add(Jr()),C.viewProps.bindClassModifiers(this.element),C.viewProps.bindTabIndex(this.element);const F=A.createElement("div");F.classList.add(Jr("b")),this.element.appendChild(F);const ee=A.createElement("div");ee.classList.add(Jr("c")),F.appendChild(ee),this.colorElem_=ee;const De=A.createElement("div");De.classList.add(Jr("m")),this.element.appendChild(De),this.markerElem_=De;const Ue=A.createElement("div");Ue.classList.add(Jr("p")),this.markerElem_.appendChild(Ue),this.previewElem_=Ue,this.update_()}update_(){const A=this.value.rawValue,C=A.getComponents("rgb"),F=new Pi([C[0],C[1],C[2],0],"rgb"),ee=new Pi([C[0],C[1],C[2],255],"rgb"),De=["to right",Ch(F),Ch(ee)];this.colorElem_.style.background=`linear-gradient(${De.join(",")})`,this.previewElem_.style.backgroundColor=Ch(A);const Ue=tr(C[3],0,1,0,100);this.markerElem_.style.left=`${Ue}%`}onValueChange_(){this.update_()}}class Ro{constructor(A,C){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.view=new xu(A,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(A,C){if(!A.point)return;const F=A.point.x/A.bounds.width,ee=this.value.rawValue,[De,Ue,gt]=ee.getComponents("hsv");this.value.setRawValue(new Pi([De,Ue,gt,F],"hsv"),C)}onPointerDown_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerMove_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerUp_(A){this.handlePointerEvent_(A.data,{forceEmit:!0,last:!0})}onKeyDown_(A){const C=vi(qt(!0),Co(A));if(C===0)return;const F=this.value.rawValue,[ee,De,Ue,gt]=F.getComponents("hsv");this.value.setRawValue(new Pi([ee,De,Ue,gt+C],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(A){vi(qt(!0),Co(A))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Us=Fe("coltxt");class ws{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add(Us()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("div");F.classList.add(Us("m")),this.modeElem_=function(Ue){const gt=Ue.createElement("select");return gt.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((zt,yn)=>{const ri=Ue.createElement("option");return ri.textContent=yn.text,ri.value=yn.value,zt.appendChild(ri),zt},Ue.createDocumentFragment())),gt}(A),this.modeElem_.classList.add(Us("ms")),F.appendChild(this.modeSelectElement),C.viewProps.bindDisabled(this.modeElem_);const ee=A.createElement("div");ee.classList.add(Us("mm")),ee.appendChild(Ci(A,"dropdown")),F.appendChild(ee),this.element.appendChild(F);const De=A.createElement("div");De.classList.add(Us("w")),this.element.appendChild(De),this.textsElem_=De,this.textViews_=C.textViews,this.applyTextViews_(),pt(C.colorMode,Ue=>{this.modeElem_.value=Ue})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(A){this.textViews_=A,this.applyTextViews_()}applyTextViews_(){Ni(this.textsElem_);const A=this.element.ownerDocument;this.textViews_.forEach(C=>{const F=A.createElement("div");F.classList.add(Us("c")),F.appendChild(C.element),this.textsElem_.appendChild(F)})}}function jc(k,A,C){const F=wh(k,A)[C];return new Yr({min:0,max:F})}function pc(k,A,C){return new jd(k,{arrayPosition:C===0?"fst":C===2?"lst":"mid",baseStep:qt(!1),parser:A.parser,props:Me.fromObject({draggingScale:A.colorType==="float"?.01:1,formatter:(F=A.colorType,_n(F==="float"?2:0))}),value:ye(0,{constraint:jc(A.colorMode,A.colorType,C)}),viewProps:A.viewProps});var F}class Xd{constructor(A,C){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=C.colorType,this.parser_=C.parser,this.value=C.value,this.viewProps=C.viewProps,this.colorMode=ye(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(A),this.view=new ws(A,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(A){const C={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},F=[pc(A,C,0),pc(A,C,1),pc(A,C,2)];return F.forEach((ee,De)=>{Xn({primary:this.value,secondary:ee.value,forward:Ue=>Ue.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[De],backward:(Ue,gt)=>{const zt=this.colorMode.rawValue,yn=Ue.rawValue.getComponents(zt,this.colorType_);return yn[De]=gt.rawValue,new Pi(Ua(Io(yn),yn[3]),zt,this.colorType_)}})}),F}onModeSelectChange_(A){const C=A.currentTarget;this.colorMode.rawValue=C.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const wu=Fe("hpl");class Eu{constructor(A,C){this.onValueChange_=this.onValueChange_.bind(this),this.value=C.value,this.value.emitter.on("change",this.onValueChange_),this.element=A.createElement("div"),this.element.classList.add(wu()),C.viewProps.bindClassModifiers(this.element),C.viewProps.bindTabIndex(this.element);const F=A.createElement("div");F.classList.add(wu("c")),this.element.appendChild(F);const ee=A.createElement("div");ee.classList.add(wu("m")),this.element.appendChild(ee),this.markerElem_=ee,this.update_()}update_(){const A=this.value.rawValue,[C]=A.getComponents("hsv");this.markerElem_.style.backgroundColor=xf(new Pi([C,100,100],"hsv"));const F=tr(C,0,360,0,100);this.markerElem_.style.left=`${F}%`}onValueChange_(){this.update_()}}class Tl{constructor(A,C){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.view=new Eu(A,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(A,C){if(!A.point)return;const F=tr(Kr(A.point.x,0,A.bounds.width),0,A.bounds.width,0,360),ee=this.value.rawValue,[,De,Ue,gt]=ee.getComponents("hsv");this.value.setRawValue(new Pi([F,De,Ue,gt],"hsv"),C)}onPointerDown_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerMove_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerUp_(A){this.handlePointerEvent_(A.data,{forceEmit:!0,last:!0})}onKeyDown_(A){const C=vi(qt(!1),Co(A));if(C===0)return;const F=this.value.rawValue,[ee,De,Ue,gt]=F.getComponents("hsv");this.value.setRawValue(new Pi([ee+C,De,Ue,gt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(A){vi(qt(!1),Co(A))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Vc=Fe("svp");class Sf{constructor(A,C){this.onValueChange_=this.onValueChange_.bind(this),this.value=C.value,this.value.emitter.on("change",this.onValueChange_),this.element=A.createElement("div"),this.element.classList.add(Vc()),C.viewProps.bindClassModifiers(this.element),C.viewProps.bindTabIndex(this.element);const F=A.createElement("canvas");F.height=64,F.width=64,F.classList.add(Vc("c")),this.element.appendChild(F),this.canvasElement=F;const ee=A.createElement("div");ee.classList.add(Vc("m")),this.element.appendChild(ee),this.markerElem_=ee,this.update_()}update_(){const A=function(yn){const ri=yn.ownerDocument.defaultView;return ri&&"document"in ri?yn.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!A)return;const C=this.value.rawValue.getComponents("hsv"),F=this.canvasElement.width,ee=this.canvasElement.height,De=A.getImageData(0,0,F,ee),Ue=De.data;for(let yn=0;yn<ee;yn++)for(let ri=0;ri<F;ri++){const sr=tr(ri,0,F,0,100),zs=tr(yn,0,ee,100,0),Ms=uc(C[0],sr,zs),Oo=4*(yn*F+ri);Ue[Oo]=Ms[0],Ue[Oo+1]=Ms[1],Ue[Oo+2]=Ms[2],Ue[Oo+3]=255}A.putImageData(De,0,0);const gt=tr(C[1],0,100,0,100);this.markerElem_.style.left=`${gt}%`;const zt=tr(C[2],0,100,100,0);this.markerElem_.style.top=`${zt}%`}onValueChange_(){this.update_()}}class Yd{constructor(A,C){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.view=new Sf(A,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(A,C){if(!A.point)return;const F=tr(A.point.x,0,A.bounds.width,0,100),ee=tr(A.point.y,0,A.bounds.height,100,0),[De,,,Ue]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Pi([De,F,ee,Ue],"hsv"),C)}onPointerDown_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerMove_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerUp_(A){this.handlePointerEvent_(A.data,{forceEmit:!0,last:!0})}onKeyDown_(A){Tv(A.key)&&A.preventDefault();const[C,F,ee,De]=this.value.rawValue.getComponents("hsv"),Ue=qt(!1),gt=vi(Ue,Co(A)),zt=vi(Ue,$o(A));gt===0&&zt===0||this.value.setRawValue(new Pi([C,F+gt,ee+zt,De],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(A){const C=qt(!1),F=vi(C,Co(A)),ee=vi(C,$o(A));F===0&&ee===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Gm{constructor(A,C){this.value=C.value,this.viewProps=C.viewProps,this.hPaletteC_=new Tl(A,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Yd(A,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=C.supportsAlpha?{palette:new Ro(A,{value:this.value,viewProps:this.viewProps}),text:new jd(A,{parser:rs,baseStep:.1,props:Me.fromObject({draggingScale:.01,formatter:_n(2)}),value:ye(0,{constraint:new Yr({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Xn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:F=>F.rawValue.getComponents()[3],backward:(F,ee)=>{const De=F.rawValue.getComponents();return De[3]=ee.rawValue,new Pi(De,F.rawValue.mode)}}),this.textC_=new Xd(A,{colorType:C.colorType,parser:rs,value:this.value,viewProps:this.viewProps}),this.view=new to(A,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:C.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Do=Fe("colsw");class fc{constructor(A,C){this.onValueChange_=this.onValueChange_.bind(this),C.value.emitter.on("change",this.onValueChange_),this.value=C.value,this.element=A.createElement("div"),this.element.classList.add(Do()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("div");F.classList.add(Do("sw")),this.element.appendChild(F),this.swatchElem_=F;const ee=A.createElement("button");ee.classList.add(Do("b")),C.viewProps.bindDisabled(ee),this.element.appendChild(ee),this.buttonElement=ee,this.update_()}update_(){const A=this.value.rawValue;this.swatchElem_.style.backgroundColor=Vm(A)}onValueChange_(){this.update_()}}class Mf{constructor(A,C){this.value=C.value,this.viewProps=C.viewProps,this.view=new fc(A,{value:this.value,viewProps:this.viewProps})}}class Su{constructor(A,C){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.foldable_=Sr.create(C.expanded),this.swatchC_=new Mf(A,{value:this.value,viewProps:this.viewProps});const F=this.swatchC_.view.buttonElement;F.addEventListener("blur",this.onButtonBlur_),F.addEventListener("click",this.onButtonClick_),this.textC_=new Jo(A,{parser:C.parser,props:Me.fromObject({formatter:C.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Rv(A,{foldable:this.foldable_,pickerLayout:C.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=C.pickerLayout==="popup"?new fu(A,{viewProps:this.viewProps}):null;const ee=new Gm(A,{colorType:C.colorType,supportsAlpha:C.supportsAlpha,value:this.value,viewProps:this.viewProps});ee.view.allFocusableElements.forEach(De=>{De.addEventListener("blur",this.onPopupChildBlur_),De.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=ee,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(ee.view.element),Xn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:De=>De.rawValue,backward:(De,Ue)=>Ue.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),_r(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(A){if(!this.popC_)return;const C=this.view.element,F=A.relatedTarget;F&&C.contains(F)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(A){if(!this.popC_)return;const C=this.popC_.view.element,F=qr(A);F&&C.contains(F)||F&&F===this.swatchC_.view.buttonElement&&!bt(C.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(A){this.popC_?A.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&A.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function il(k){return Io(k.getComponents("rgb")).reduce((A,C)=>A<<8|255&Math.floor(C),0)}function Kd(k){return k.getComponents("rgb").reduce((A,C,F)=>A<<8|255&Math.floor(F===3?255*C:C),0)>>>0}function Th(k){return typeof k!="number"?Pi.black():new Pi([(A=k)>>16&255,A>>8&255,255&A],"rgb");var A}function Jd(k){return typeof k!="number"?Pi.black():new Pi([(A=k)>>24&255,A>>16&255,A>>8&255,tr(255&A,0,255,0,1)],"rgb");var A}function Mu(k){var A;return!(!(k!=null&&k.alpha)&&!(!((A=k==null?void 0:k.color)===null||A===void 0)&&A.alpha))}function _i(k){return k?A=>Vm(A,"0x"):A=>no(A,"0x")}const Ih={id:"input-color-number",type:"input",accept:(k,A)=>{if(typeof k!="number"||!function(F){return"color"in F||"view"in F&&F.view==="color"}(A))return null;const C=zm(A);return C?{initialValue:k,params:C}:null},binding:{reader:k=>Mu(k.params)?Jd:Th,equals:Pi.equals,writer:k=>function(A){const C=A?Kd:il;return(F,ee)=>{el(F,C(ee))}}(Mu(k.params))},controller:k=>{const A=Mu(k.params),C="expanded"in k.params?k.params.expanded:void 0,F="picker"in k.params?k.params.picker:void 0;return new Su(k.document,{colorType:"int",expanded:C!=null&&C,formatter:_i(A),parser:Ji("int"),pickerLayout:F??"popup",supportsAlpha:A,value:k.value,viewProps:k.viewProps})}};function Bo(k){return A=>function(C,F){return Pi.isColorObject(C)?Pi.fromObject(C,F):Pi.black(F)}(A,k)}function Li(k,A){return C=>k?Ef(C,A):ze(C,A)}const Es={id:"input-color-object",type:"input",accept:(k,A)=>{if(!Pi.isColorObject(k))return null;const C=zm(A);return C?{initialValue:k,params:C}:null},binding:{reader:k=>Bo(Ai(k.params)),equals:Pi.equals,writer:k=>{return F=k.initialValue,A=Pi.isRgbaColorObject(F),C=Ai(k.params),(ee,De)=>{A?function(Ue,gt,zt){const yn=gt.toRgbaObject(zt);Ue.writeProperty("r",yn.r),Ue.writeProperty("g",yn.g),Ue.writeProperty("b",yn.b),Ue.writeProperty("a",yn.a)}(ee,De,C):function(Ue,gt,zt){const yn=gt.toRgbaObject(zt);Ue.writeProperty("r",yn.r),Ue.writeProperty("g",yn.g),Ue.writeProperty("b",yn.b)}(ee,De,C)};var A,C,F}},controller:k=>{var A;const C=Pi.isRgbaColorObject(k.initialValue),F="expanded"in k.params?k.params.expanded:void 0,ee="picker"in k.params?k.params.picker:void 0,De=(A=Ai(k.params))!==null&&A!==void 0?A:"int";return new Su(k.document,{colorType:De,expanded:F!=null&&F,formatter:Li(C,De),parser:Ji(De),pickerLayout:ee??"popup",supportsAlpha:C,value:k.value,viewProps:k.viewProps})}},va={id:"input-color-string",type:"input",accept:(k,A)=>{if(typeof k!="string"||"view"in A&&A.view==="text")return null;const C=qd(k,Ai(A));if(!C||!Js(C))return null;const F=zm(A);return F?{initialValue:k,params:F}:null},binding:{reader:k=>{var A;return function(C){const F=pr[C];return ee=>{if(typeof ee!="string")return Pi.black(C);const De=F.reduce((Ue,gt)=>Ue||gt(ee),null);return De??Pi.black(C)}}((A=Ai(k.params))!==null&&A!==void 0?A:"int")},equals:Pi.equals,writer:k=>{const A=qd(k.initialValue,Ai(k.params));if(!A)throw de.shouldNeverHappen();const C=function(F){const ee=Js(F);return ee?(De,Ue)=>{el(De,ee(Ue))}:null}(A);if(!C)throw de.notBindable();return C}},controller:k=>{const A=qd(k.initialValue,Ai(k.params));if(!A)throw de.shouldNeverHappen();const C=Js(A);if(!C)throw de.shouldNeverHappen();const F="expanded"in k.params?k.params.expanded:void 0,ee="picker"in k.params?k.params.picker:void 0;return new Su(k.document,{colorType:A.type,expanded:F!=null&&F,formatter:C,parser:Ji(A.type),pickerLayout:ee??"popup",supportsAlpha:A.alpha,value:k.value,viewProps:k.viewProps})}};class Zs{constructor(A){this.components=A.components,this.asm_=A.assembly}constrain(A){const C=this.asm_.toComponents(A).map((F,ee)=>{var De,Ue;return(Ue=(De=this.components[ee])===null||De===void 0?void 0:De.constrain(F))!==null&&Ue!==void 0?Ue:F});return this.asm_.fromComponents(C)}}const gs=Fe("pndtxt");class Ph{constructor(A,C){this.textViews=C.textViews,this.element=A.createElement("div"),this.element.classList.add(gs()),this.textViews.forEach(F=>{const ee=A.createElement("div");ee.classList.add(gs("a")),ee.appendChild(F.element),this.element.appendChild(ee)})}}class Zd{constructor(A,C){this.value=C.value,this.viewProps=C.viewProps,this.acs_=C.axes.map((F,ee)=>function(De,Ue,gt){return new jd(De,{arrayPosition:gt===0?"fst":gt===Ue.axes.length-1?"lst":"mid",baseStep:Ue.axes[gt].baseStep,parser:Ue.parser,props:Ue.axes[gt].textProps,value:ye(0,{constraint:Ue.axes[gt].constraint}),viewProps:Ue.viewProps})}(A,C,ee)),this.acs_.forEach((F,ee)=>{Xn({primary:this.value,secondary:F.value,forward:De=>C.assembly.toComponents(De.rawValue)[ee],backward:(De,Ue)=>{const gt=C.assembly.toComponents(De.rawValue);return gt[ee]=Ue.rawValue,C.assembly.fromComponents(gt)}})}),this.view=new Ph(A,{textViews:this.acs_.map(F=>F.view)})}}function Cu(k,A){return"step"in k&&!ie(k.step)?new _h(k.step,A):null}function Tu(k){return ie(k.max)||ie(k.min)?ie(k.max)&&ie(k.min)?null:new pf({max:k.max,min:k.min}):new Yr({max:k.max,min:k.min})}const Cf={id:"input-number",type:"input",accept:(k,A)=>{if(typeof k!="number")return null;const C=Mt,F=At(A,{format:C.optional.function,max:C.optional.number,min:C.optional.number,options:C.optional.custom(Os),step:C.optional.number});return F?{initialValue:k,params:F}:null},binding:{reader:k=>Zo,constraint:k=>function(A,C){const F=[],ee=Cu(A,C);ee&&F.push(ee);const De=Tu(A);De&&F.push(De);const Ue=Gd(A.options);return Ue&&F.push(Ue),new Nc(F)}(k.params,k.initialValue),writer:k=>el},controller:k=>{var A;const C=k.value,F=k.constraint,ee=F&&Za(F,ac);if(ee)return new oc(k.document,{props:new Me({options:ee.values.value("options")}),value:C,viewProps:k.viewProps});const De=(A="format"in k.params?k.params.format:void 0)!==null&&A!==void 0?A:_n(yf(F,C.rawValue)),Ue=F&&Za(F,Yr);return Ue?new bh(k.document,{baseStep:vu(F),parser:rs,sliderProps:new Me({maxValue:Ue.values.value("max"),minValue:Ue.values.value("min")}),textProps:Me.fromObject({draggingScale:_u(F,C.rawValue),formatter:De}),value:C,viewProps:k.viewProps}):new jd(k.document,{baseStep:vu(F),parser:rs,props:Me.fromObject({draggingScale:_u(F,C.rawValue),formatter:De}),value:C,viewProps:k.viewProps})}};class Il{constructor(A=0,C=0){this.x=A,this.y=C}getComponents(){return[this.x,this.y]}static isObject(A){if(ie(A))return!1;const C=A.x,F=A.y;return typeof C=="number"&&typeof F=="number"}static equals(A,C){return A.x===C.x&&A.y===C.y}toObject(){return{x:this.x,y:this.y}}}const Gc={toComponents:k=>k.getComponents(),fromComponents:k=>new Il(...k)},$s=Fe("p2d");class Hc{constructor(A,C){this.element=A.createElement("div"),this.element.classList.add($s()),C.viewProps.bindClassModifiers(this.element),pt(C.expanded,Ye(this.element,$s(void 0,"expanded")));const F=A.createElement("div");F.classList.add($s("h")),this.element.appendChild(F);const ee=A.createElement("button");ee.classList.add($s("b")),ee.appendChild(Ci(A,"p2dpad")),C.viewProps.bindDisabled(ee),F.appendChild(ee),this.buttonElement=ee;const De=A.createElement("div");if(De.classList.add($s("t")),F.appendChild(De),this.textElement=De,C.pickerLayout==="inline"){const Ue=A.createElement("div");Ue.classList.add($s("p")),this.element.appendChild(Ue),this.pickerElement=Ue}else this.pickerElement=null}}const Oi=Fe("p2dp");class Iu{constructor(A,C){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=C.invertsY,this.maxValue_=C.maxValue,this.element=A.createElement("div"),this.element.classList.add(Oi()),C.layout==="popup"&&this.element.classList.add(Oi(void 0,"p")),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("div");F.classList.add(Oi("p")),C.viewProps.bindTabIndex(F),this.element.appendChild(F),this.padElement=F;const ee=A.createElementNS(tt,"svg");ee.classList.add(Oi("g")),this.padElement.appendChild(ee),this.svgElem_=ee;const De=A.createElementNS(tt,"line");De.classList.add(Oi("ax")),De.setAttributeNS(null,"x1","0"),De.setAttributeNS(null,"y1","50%"),De.setAttributeNS(null,"x2","100%"),De.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(De);const Ue=A.createElementNS(tt,"line");Ue.classList.add(Oi("ax")),Ue.setAttributeNS(null,"x1","50%"),Ue.setAttributeNS(null,"y1","0"),Ue.setAttributeNS(null,"x2","50%"),Ue.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Ue);const gt=A.createElementNS(tt,"line");gt.classList.add(Oi("l")),gt.setAttributeNS(null,"x1","50%"),gt.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(gt),this.lineElem_=gt;const zt=A.createElement("div");zt.classList.add(Oi("m")),this.padElement.appendChild(zt),this.markerElem_=zt,C.value.emitter.on("change",this.onValueChange_),this.value=C.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[A,C]=this.value.rawValue.getComponents(),F=this.maxValue_,ee=tr(A,-F,+F,0,100),De=tr(C,-F,+F,0,100),Ue=this.invertsY_?100-De:De;this.lineElem_.setAttributeNS(null,"x2",`${ee}%`),this.lineElem_.setAttributeNS(null,"y2",`${Ue}%`),this.markerElem_.style.left=`${ee}%`,this.markerElem_.style.top=`${Ue}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function io(k,A,C){return[vi(A[0],Co(k)),vi(A[1],$o(k))*(C?1:-1)]}class Pl{constructor(A,C){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.baseSteps_=C.baseSteps,this.maxValue_=C.maxValue,this.invertsY_=C.invertsY,this.view=new Iu(A,{invertsY:this.invertsY_,layout:C.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Sn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(A,C){if(!A.point)return;const F=this.maxValue_,ee=tr(A.point.x,0,A.bounds.width,-F,+F),De=tr(this.invertsY_?A.bounds.height-A.point.y:A.point.y,0,A.bounds.height,-F,+F);this.value.setRawValue(new Il(ee,De),C)}onPointerDown_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerMove_(A){this.handlePointerEvent_(A.data,{forceEmit:!1,last:!1})}onPointerUp_(A){this.handlePointerEvent_(A.data,{forceEmit:!0,last:!0})}onPadKeyDown_(A){Tv(A.key)&&A.preventDefault();const[C,F]=io(A,this.baseSteps_,this.invertsY_);C===0&&F===0||this.value.setRawValue(new Il(this.value.rawValue.x+C,this.value.rawValue.y+F),{forceEmit:!1,last:!1})}onPadKeyUp_(A){const[C,F]=io(A,this.baseSteps_,this.invertsY_);C===0&&F===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Pu{constructor(A,C){var F,ee;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=C.value,this.viewProps=C.viewProps,this.foldable_=Sr.create(C.expanded),this.popC_=C.pickerLayout==="popup"?new fu(A,{viewProps:this.viewProps}):null;const De=new Pl(A,{baseSteps:[C.axes[0].baseStep,C.axes[1].baseStep],invertsY:C.invertsY,layout:C.pickerLayout,maxValue:C.maxValue,value:this.value,viewProps:this.viewProps});De.view.allFocusableElements.forEach(Ue=>{Ue.addEventListener("blur",this.onPopupChildBlur_),Ue.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=De,this.textC_=new Zd(A,{assembly:Gc,axes:C.axes,parser:C.parser,value:this.value,viewProps:this.viewProps}),this.view=new Hc(A,{expanded:this.foldable_.value("expanded"),pickerLayout:C.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(F=this.view.buttonElement)===null||F===void 0||F.addEventListener("blur",this.onPadButtonBlur_),(ee=this.view.buttonElement)===null||ee===void 0||ee.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Xn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Ue=>Ue.rawValue,backward:(Ue,gt)=>gt.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),_r(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(A){if(!this.popC_)return;const C=this.view.element,F=A.relatedTarget;F&&C.contains(F)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(A){if(!this.popC_)return;const C=this.popC_.view.element,F=qr(A);F&&C.contains(F)||F&&F===this.view.buttonElement&&!bt(C.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(A){this.popC_?A.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&A.key==="Escape"&&this.view.buttonElement.focus()}}class Qc{constructor(A=0,C=0,F=0){this.x=A,this.y=C,this.z=F}getComponents(){return[this.x,this.y,this.z]}static isObject(A){if(ie(A))return!1;const C=A.x,F=A.y,ee=A.z;return typeof C=="number"&&typeof F=="number"&&typeof ee=="number"}static equals(A,C){return A.x===C.x&&A.y===C.y&&A.z===C.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Hm={toComponents:k=>k.getComponents(),fromComponents:k=>new Qc(...k)};function Qm(k){return Qc.isObject(k)?new Qc(k.x,k.y,k.z):new Qc}function Vi(k,A){k.writeProperty("x",A.x),k.writeProperty("y",A.y),k.writeProperty("z",A.z)}function ea(k,A){return{baseStep:vu(A),constraint:A,textProps:Me.fromObject({draggingScale:_u(A,k),formatter:_n(yf(A,k))})}}const ss={id:"input-point3d",type:"input",accept:(k,A)=>{if(!Qc.isObject(k))return null;const C=Mt,F=At(A,{x:C.optional.custom(ks),y:C.optional.custom(ks),z:C.optional.custom(ks)});return F?{initialValue:k,params:F}:null},binding:{reader:k=>Qm,constraint:k=>{return A=k.params,C=k.initialValue,new Zs({assembly:Hm,components:[rr("x"in A?A.x:void 0,C.x),rr("y"in A?A.y:void 0,C.y),rr("z"in A?A.z:void 0,C.z)]});var A,C},equals:Qc.equals,writer:k=>Vi},controller:k=>{const A=k.value,C=k.constraint;if(!(C instanceof Zs))throw de.shouldNeverHappen();return new Zd(k.document,{assembly:Hm,axes:[ea(A.rawValue.x,C.components[0]),ea(A.rawValue.y,C.components[1]),ea(A.rawValue.z,C.components[2])],parser:rs,value:A,viewProps:k.viewProps})}};class rl{constructor(A=0,C=0,F=0,ee=0){this.x=A,this.y=C,this.z=F,this.w=ee}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(A){if(ie(A))return!1;const C=A.x,F=A.y,ee=A.z,De=A.w;return typeof C=="number"&&typeof F=="number"&&typeof ee=="number"&&typeof De=="number"}static equals(A,C){return A.x===C.x&&A.y===C.y&&A.z===C.z&&A.w===C.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const za={toComponents:k=>k.getComponents(),fromComponents:k=>new rl(...k)};function Ns(k){return rl.isObject(k)?new rl(k.x,k.y,k.z,k.w):new rl}function Rl(k,A){k.writeProperty("x",A.x),k.writeProperty("y",A.y),k.writeProperty("z",A.z),k.writeProperty("w",A.w)}const sl={id:"input-point4d",type:"input",accept:(k,A)=>{if(!rl.isObject(k))return null;const C=Mt,F=At(A,{x:C.optional.custom(ks),y:C.optional.custom(ks),z:C.optional.custom(ks),w:C.optional.custom(ks)});return F?{initialValue:k,params:F}:null},binding:{reader:k=>Ns,constraint:k=>{return A=k.params,C=k.initialValue,new Zs({assembly:za,components:[rr("x"in A?A.x:void 0,C.x),rr("y"in A?A.y:void 0,C.y),rr("z"in A?A.z:void 0,C.z),rr("w"in A?A.w:void 0,C.w)]});var A,C},equals:rl.equals,writer:k=>Rl},controller:k=>{const A=k.value,C=k.constraint;if(!(C instanceof Zs))throw de.shouldNeverHappen();return new Zd(k.document,{assembly:za,axes:A.rawValue.getComponents().map((F,ee)=>{return De=F,{baseStep:vu(Ue=C.components[ee]),constraint:Ue,textProps:Me.fromObject({draggingScale:_u(Ue,De),formatter:_n(yf(Ue,De))})};var De,Ue}),parser:rs,value:A,viewProps:k.viewProps})}},Wc={id:"input-string",type:"input",accept:(k,A)=>{if(typeof k!="string")return null;const C=At(A,{options:Mt.optional.custom(Os)});return C?{initialValue:k,params:C}:null},binding:{reader:k=>zc,constraint:k=>function(A){const C=[],F=Gd(A.options);return F&&C.push(F),new Nc(C)}(k.params),writer:k=>el},controller:k=>{const A=k.document,C=k.value,F=k.constraint,ee=F&&Za(F,ac);return ee?new oc(A,{props:new Me({options:ee.values.value("options")}),value:C,viewProps:k.viewProps}):new Jo(A,{parser:De=>De,props:Me.fromObject({formatter:Mo}),value:C,viewProps:k.viewProps})}},Dl={monitor:{defaultInterval:200,defaultLineCount:3}},Ru=Fe("mll");class Rh{constructor(A,C){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=C.formatter,this.element=A.createElement("div"),this.element.classList.add(Ru()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("textarea");F.classList.add(Ru("i")),F.style.height=`calc(var(--bld-us) * ${C.lineCount})`,F.readOnly=!0,C.viewProps.bindDisabled(F),this.element.appendChild(F),this.textareaElem_=F,C.value.emitter.on("change",this.onValueUpdate_),this.value=C.value,this.update_()}update_(){const A=this.textareaElem_,C=A.scrollTop===A.scrollHeight-A.clientHeight,F=[];this.value.rawValue.forEach(ee=>{ee!==void 0&&F.push(this.formatter_(ee))}),A.textContent=F.join(`
`),C&&(A.scrollTop=A.scrollHeight)}onValueUpdate_(){this.update_()}}class Zr{constructor(A,C){this.value=C.value,this.viewProps=C.viewProps,this.view=new Rh(A,{formatter:C.formatter,lineCount:C.lineCount,value:this.value,viewProps:this.viewProps})}}const Dh=Fe("sgl");class Ss{constructor(A,C){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=C.formatter,this.element=A.createElement("div"),this.element.classList.add(Dh()),C.viewProps.bindClassModifiers(this.element);const F=A.createElement("input");F.classList.add(Dh("i")),F.readOnly=!0,F.type="text",C.viewProps.bindDisabled(F),this.element.appendChild(F),this.inputElement=F,C.value.emitter.on("change",this.onValueUpdate_),this.value=C.value,this.update_()}update_(){const A=this.value.rawValue,C=A[A.length-1];this.inputElement.value=C!==void 0?this.formatter_(C):""}onValueUpdate_(){this.update_()}}class $d{constructor(A,C){this.value=C.value,this.viewProps=C.viewProps,this.view=new Ss(A,{formatter:C.formatter,value:this.value,viewProps:this.viewProps})}}const Bl={id:"monitor-bool",type:"monitor",accept:(k,A)=>{if(typeof k!="boolean")return null;const C=At(A,{lineCount:Mt.optional.number});return C?{initialValue:k,params:C}:null},binding:{reader:k=>gn},controller:k=>{var A;return k.value.rawValue.length===1?new $d(k.document,{formatter:Ks,value:k.value,viewProps:k.viewProps}):new Zr(k.document,{formatter:Ks,lineCount:(A=k.params.lineCount)!==null&&A!==void 0?A:Dl.monitor.defaultLineCount,value:k.value,viewProps:k.viewProps})}},vs=Fe("grl");class ep{constructor(A,C){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=A.createElement("div"),this.element.classList.add(vs()),C.viewProps.bindClassModifiers(this.element),this.formatter_=C.formatter,this.props_=C.props,this.cursor_=C.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const F=A.createElementNS(tt,"svg");F.classList.add(vs("g")),F.style.height=`calc(var(--bld-us) * ${C.lineCount})`,this.element.appendChild(F),this.svgElem_=F;const ee=A.createElementNS(tt,"polyline");this.svgElem_.appendChild(ee),this.lineElem_=ee;const De=A.createElement("div");De.classList.add(vs("t"),Fe("tt")()),this.element.appendChild(De),this.tooltipElem_=De,C.value.emitter.on("change",this.onValueUpdate_),this.value=C.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const A=this.svgElem_.getBoundingClientRect(),C=this.value.rawValue.length-1,F=this.props_.get("minValue"),ee=this.props_.get("maxValue"),De=[];this.value.rawValue.forEach((ri,sr)=>{if(ri===void 0)return;const zs=tr(sr,0,C,0,A.width),Ms=tr(ri,F,ee,A.height,0);De.push([zs,Ms].join(","))}),this.lineElem_.setAttributeNS(null,"points",De.join(" "));const Ue=this.tooltipElem_,gt=this.value.rawValue[this.cursor_.rawValue];if(gt===void 0)return void Ue.classList.remove(vs("t","a"));const zt=tr(this.cursor_.rawValue,0,C,0,A.width),yn=tr(gt,F,ee,A.height,0);Ue.style.left=`${zt}px`,Ue.style.top=`${yn}px`,Ue.textContent=`${this.formatter_(gt)}`,Ue.classList.contains(vs("t","a"))||(Ue.classList.add(vs("t","a"),vs("t","in")),Zt(Ue),Ue.classList.remove(vs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class qc{constructor(A,C){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=C.props,this.value=C.value,this.viewProps=C.viewProps,this.cursor_=ye(-1),this.view=new ep(A,{cursor:this.cursor_,formatter:C.formatter,lineCount:C.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),bt(A)){const F=new Sn(this.view.element);F.emitter.on("down",this.onGraphPointerDown_),F.emitter.on("move",this.onGraphPointerMove_),F.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(A){const C=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(tr(A.offsetX,0,C.width,0,this.value.rawValue.length))}onGraphPointerDown_(A){this.onGraphPointerMove_(A)}onGraphPointerMove_(A){A.data.point?this.cursor_.rawValue=Math.floor(tr(A.data.point.x,0,A.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function En(k){return"format"in k&&!ie(k.format)?k.format:_n(2)}function Lr(k){return"view"in k&&k.view==="graph"}const Lo={id:"monitor-number",type:"monitor",accept:(k,A)=>{if(typeof k!="number")return null;const C=Mt,F=At(A,{format:C.optional.function,lineCount:C.optional.number,max:C.optional.number,min:C.optional.number,view:C.optional.string});return F?{initialValue:k,params:F}:null},binding:{defaultBufferSize:k=>Lr(k)?64:1,reader:k=>Zo},controller:k=>Lr(k.params)?function(A){var C,F,ee;return new qc(A.document,{formatter:En(A.params),lineCount:(C=A.params.lineCount)!==null&&C!==void 0?C:Dl.monitor.defaultLineCount,props:Me.fromObject({maxValue:(F="max"in A.params?A.params.max:null)!==null&&F!==void 0?F:100,minValue:(ee="min"in A.params?A.params.min:null)!==null&&ee!==void 0?ee:0}),value:A.value,viewProps:A.viewProps})}(k):function(A){var C;return A.value.rawValue.length===1?new $d(A.document,{formatter:En(A.params),value:A.value,viewProps:A.viewProps}):new Zr(A.document,{formatter:En(A.params),lineCount:(C=A.params.lineCount)!==null&&C!==void 0?C:Dl.monitor.defaultLineCount,value:A.value,viewProps:A.viewProps})}(k)},Ll={id:"monitor-string",type:"monitor",accept:(k,A)=>{if(typeof k!="string")return null;const C=Mt,F=At(A,{lineCount:C.optional.number,multiline:C.optional.boolean});return F?{initialValue:k,params:F}:null},binding:{reader:k=>zc},controller:k=>{var A;const C=k.value;return C.rawValue.length>1||"multiline"in k.params&&k.params.multiline?new Zr(k.document,{formatter:Mo,lineCount:(A=k.params.lineCount)!==null&&A!==void 0?A:Dl.monitor.defaultLineCount,value:C,viewProps:k.viewProps}):new $d(k.document,{formatter:Mo,value:C,viewProps:k.viewProps})}};function Tf(k,A){return A===0?new Nd:new pu(k,A??Dl.monitor.defaultInterval)}class ya{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(A){A.type==="blade"?this.pluginsMap_.blades.unshift(A):A.type==="input"?this.pluginsMap_.inputs.unshift(A):A.type==="monitor"&&this.pluginsMap_.monitors.unshift(A)}createInput(A,C,F){if(ie(C.read()))throw new de({context:{key:C.key},type:"nomatchingcontroller"});const ee=this.pluginsMap_.inputs.reduce((De,Ue)=>De??function(gt,zt){const yn=gt.accept(zt.target.read(),zt.params);if(ie(yn))return null;const ri=Mt,sr={target:zt.target,initialValue:yn.initialValue,params:yn.params},zs=gt.binding.reader(sr),Ms=gt.binding.constraint?gt.binding.constraint(sr):void 0,Oo=ye(zs(yn.initialValue),{constraint:Ms,equals:gt.binding.equals}),kl=new hf({reader:zs,target:zt.target,value:Oo,writer:gt.binding.writer(sr)}),mc=ri.optional.boolean(zt.params.disabled).value,tp=ri.optional.boolean(zt.params.hidden).value,Oh=gt.controller({constraint:Ms,document:zt.document,initialValue:yn.initialValue,params:yn.params,value:kl.value,viewProps:Ft.create({disabled:mc,hidden:tp})}),Yc=ri.optional.string(zt.params.label).value;return new Xs(zt.document,{binding:kl,blade:zr(),props:Me.fromObject({label:Yc??zt.target.key}),valueController:Oh})}(Ue,{document:A,target:C,params:F}),null);if(ee)return ee;throw new de({context:{key:C.key},type:"nomatchingcontroller"})}createMonitor(A,C,F){const ee=this.pluginsMap_.monitors.reduce((De,Ue)=>De??function(gt,zt){var yn,ri,sr;const zs=Mt,Ms=gt.accept(zt.target.read(),zt.params);if(ie(Ms))return null;const Oo={target:zt.target,initialValue:Ms.initialValue,params:Ms.params},kl=gt.binding.reader(Oo),mc=(ri=(yn=zs.optional.number(zt.params.bufferSize).value)!==null&&yn!==void 0?yn:gt.binding.defaultBufferSize&&gt.binding.defaultBufferSize(Ms.params))!==null&&ri!==void 0?ri:1,tp=zs.optional.number(zt.params.interval).value,Oh=new Um({reader:kl,target:zt.target,ticker:Tf(zt.document,tp),value:wo(mc)}),Yc=zs.optional.boolean(zt.params.disabled).value,kh=zs.optional.boolean(zt.params.hidden).value,Pf=gt.controller({document:zt.document,params:Ms.params,value:Oh.value,viewProps:Ft.create({disabled:Yc,hidden:kh})}),Cs=(sr=zs.optional.string(zt.params.label).value)!==null&&sr!==void 0?sr:zt.target.key;return new Ka(zt.document,{binding:Oh,blade:zr(),props:Me.fromObject({label:Cs}),valueController:Pf})}(Ue,{document:A,params:F,target:C}),null);if(ee)return ee;throw new de({context:{key:C.key},type:"nomatchingcontroller"})}createBlade(A,C){const F=this.pluginsMap_.blades.reduce((ee,De)=>ee??function(Ue,gt){const zt=Ue.accept(gt.params);if(!zt)return null;const yn=Mt.optional.boolean(gt.params.disabled).value,ri=Mt.optional.boolean(gt.params.hidden).value;return Ue.controller({blade:zr(),document:gt.document,params:Object.assign(Object.assign({},zt.params),{disabled:yn,hidden:ri}),viewProps:Ft.create({disabled:yn,hidden:ri})})}(De,{document:A,params:C}),null);if(!F)throw new de({type:"nomatchingview",context:{params:C}});return F}createBladeApi(A){if(A instanceof Xs)return new Mr(A);if(A instanceof Ka)return new lr(A);if(A instanceof Xr)return new Cr(A,this);const C=this.pluginsMap_.blades.reduce((F,ee)=>F??ee.api({controller:A,pool:this}),null);if(!C)throw de.shouldNeverHappen();return C}}function Ol(k){return Il.isObject(k)?new Il(k.x,k.y):new Il}function Bh(k,A){k.writeProperty("x",A.x),k.writeProperty("y",A.y)}function rr(k,A){if(!k)return;const C=[],F=Cu(k,A);F&&C.push(F);const ee=Tu(k);return ee&&C.push(ee),new Nc(C)}function Lh(k,A){const[C,F]=k?function(De){const Ue=Za(De,Yr);if(Ue)return[Ue.values.get("min"),Ue.values.get("max")];const gt=Za(De,pf);return gt?[gt.minValue,gt.maxValue]:[void 0,void 0]}(k):[];if(!ie(C)||!ie(F))return Math.max(Math.abs(C??0),Math.abs(F??0));const ee=vu(k);return Math.max(10*Math.abs(ee),10*Math.abs(A))}function ur(k,A){const C=A instanceof Zs?A.components[0]:void 0,F=A instanceof Zs?A.components[1]:void 0,ee=Lh(C,k.x),De=Lh(F,k.y);return Math.max(ee,De)}function Wm(k,A){return{baseStep:vu(A),constraint:A,textProps:Me.fromObject({draggingScale:_u(A,k),formatter:_n(yf(A,k))})}}function Xc(k){if(!("y"in k))return!1;const A=k.y;return!!A&&"inverted"in A&&!!A.inverted}const qm={id:"input-point2d",type:"input",accept:(k,A)=>{if(!Il.isObject(k))return null;const C=Mt,F=At(A,{expanded:C.optional.boolean,picker:C.optional.custom(_f),x:C.optional.custom(ks),y:C.optional.object({inverted:C.optional.boolean,max:C.optional.number,min:C.optional.number,step:C.optional.number})});return F?{initialValue:k,params:F}:null},binding:{reader:k=>Ol,constraint:k=>{return A=k.params,C=k.initialValue,new Zs({assembly:Gc,components:[rr("x"in A?A.x:void 0,C.x),rr("y"in A?A.y:void 0,C.y)]});var A,C},equals:Il.equals,writer:k=>Bh},controller:k=>{const A=k.document,C=k.value,F=k.constraint;if(!(F instanceof Zs))throw de.shouldNeverHappen();const ee="expanded"in k.params?k.params.expanded:void 0,De="picker"in k.params?k.params.picker:void 0;return new Pu(A,{axes:[Wm(C.rawValue.x,F.components[0]),Wm(C.rawValue.y,F.components[1])],expanded:ee!=null&&ee,invertsY:Xc(k.params),maxValue:ur(C.rawValue,F),parser:rs,pickerLayout:De??"popup",value:C,viewProps:k.viewProps})}};class Du extends O{constructor(A){super(A),this.emitter_=new He,this.controller_.valueController.value.emitter.on("change",C=>{this.emitter_.emit("change",{event:new W(this,C.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(A){this.controller_.props.set("label",A)}get options(){return this.controller_.valueController.props.get("options")}set options(A){this.controller_.valueController.props.set("options",A)}get value(){return this.controller_.valueController.value.rawValue}set value(A){this.controller_.valueController.value.rawValue=A}on(A,C){const F=C.bind(this);return this.emitter_.on(A,ee=>{F(ee.event)}),this}}class Aa extends O{constructor(A){super(A),this.emitter_=new He,this.controller_.valueController.value.emitter.on("change",C=>{this.emitter_.emit("change",{event:new W(this,C.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(A){this.controller_.props.set("label",A)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(A){this.controller_.valueController.sliderController.props.set("maxValue",A)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(A){this.controller_.valueController.sliderController.props.set("minValue",A)}get value(){return this.controller_.valueController.value.rawValue}set value(A){this.controller_.valueController.value.rawValue=A}on(A,C){const F=C.bind(this);return this.emitter_.on(A,ee=>{F(ee.event)}),this}}class Bu extends O{constructor(A){super(A),this.emitter_=new He,this.controller_.valueController.value.emitter.on("change",C=>{this.emitter_.emit("change",{event:new W(this,C.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(A){this.controller_.props.set("label",A)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(A){this.controller_.valueController.props.set("formatter",A)}get value(){return this.controller_.valueController.value.rawValue}set value(A){this.controller_.valueController.value.rawValue=A}on(A,C){const F=C.bind(this);return this.emitter_.on(A,ee=>{F(ee.event)}),this}}const Fs={id:"list",type:"blade",accept(k){const A=Mt,C=At(k,{options:A.required.custom(Os),value:A.required.raw,view:A.required.constant("list"),label:A.optional.string});return C?{params:C}:null},controller(k){const A=new ac(Vd(k.params.options)),C=ye(k.params.value,{constraint:A}),F=new oc(k.document,{props:new Me({options:A.values.value("options")}),value:C,viewProps:k.viewProps});return new Ja(k.document,{blade:k.blade,props:Me.fromObject({label:k.params.label}),valueController:F})},api(k){return k.controller instanceof Ja&&k.controller.valueController instanceof oc?new Du(k.controller):null}};class $r extends fa{constructor(A,C){super(A,C)}get element(){return this.controller_.view.element}importPreset(A){(function(C,F){C.forEach(ee=>{const De=F[ee.target.presetKey];De!==void 0&&ee.writer(ee.target,ee.reader(De))})})(this.controller_.rackController.rack.find(Xs).map(C=>C.binding),A),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(Xs).map(A=>A.binding.target).reduce((A,C)=>Object.assign(A,{[C.presetKey]:C.read()}),{})}refresh(){this.controller_.rackController.rack.find(Xs).forEach(A=>{A.binding.read()}),this.controller_.rackController.rack.find(Ka).forEach(A=>{A.binding.read()})}}class Tn extends xs{constructor(A,C){super(A,{expanded:C.expanded,blade:C.blade,props:C.props,root:!0,viewProps:C.viewProps})}}const nr={id:"slider",type:"blade",accept(k){const A=Mt,C=At(k,{max:A.required.number,min:A.required.number,view:A.required.constant("slider"),format:A.optional.function,label:A.optional.string,value:A.optional.number});return C?{params:C}:null},controller(k){var A,C;const F=(A=k.params.value)!==null&&A!==void 0?A:0,ee=new Yr({max:k.params.max,min:k.params.min}),De=new bh(k.document,{baseStep:1,parser:rs,sliderProps:new Me({maxValue:ee.values.value("max"),minValue:ee.values.value("min")}),textProps:Me.fromObject({draggingScale:_u(void 0,F),formatter:(C=k.params.format)!==null&&C!==void 0?C:Br}),value:ye(F,{constraint:ee}),viewProps:k.viewProps});return new Ja(k.document,{blade:k.blade,props:Me.fromObject({label:k.params.label}),valueController:De})},api(k){return k.controller instanceof Ja&&k.controller.valueController instanceof bh?new Aa(k.controller):null}},Xm={id:"text",type:"blade",accept(k){const A=Mt,C=At(k,{parse:A.required.function,value:A.required.raw,view:A.required.constant("text"),format:A.optional.function,label:A.optional.string});return C?{params:C}:null},controller(k){var A;const C=new Jo(k.document,{parser:k.params.parse,props:Me.fromObject({formatter:(A=k.params.format)!==null&&A!==void 0?A:F=>String(F)}),value:ye(k.params.value),viewProps:k.viewProps});return new Ja(k.document,{blade:k.blade,props:Me.fromObject({label:k.params.label}),valueController:C})},api(k){return k.controller instanceof Ja&&k.controller.valueController instanceof Jo?new Bu(k.controller):null}};function ba(k,A,C){if(k.querySelector(`style[data-tp-style=${A}]`))return;const F=k.createElement("style");F.dataset.tpStyle=A,F.textContent=C,k.head.appendChild(F)}const If=new class{constructor(k){const[A,C]=k.split("-"),F=A.split(".");this.major=parseInt(F[0],10),this.minor=parseInt(F[1],10),this.patch=parseInt(F[2],10),this.prerelease=C??null}toString(){const k=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[k,this.prerelease].join("-"):k}}("3.1.6");u.BladeApi=O,u.ButtonApi=ue,u.FolderApi=fa,u.InputBindingApi=Mr,u.ListApi=Du,u.MonitorBindingApi=lr,u.Pane=class extends $r{constructor(k){var A,C;const F=k??{},ee=(A=F.document)!==null&&A!==void 0?A:cn(),De=function(){const Ue=new ya;return[qm,ss,sl,Wc,Cf,va,Es,Ih,tl,Bl,Ll,Lo,Ao,wl,Ls,El].forEach(gt=>{Ue.register(gt)}),Ue}();super(new Tn(ee,{expanded:F.expanded,blade:zr(),props:Me.fromObject({title:F.title}),viewProps:Ft.create()}),De),this.pool_=De,this.containerElem_=(C=F.container)!==null&&C!==void 0?C:function(Ue){const gt=Ue.createElement("div");return gt.classList.add(Fe("dfw")()),Ue.body&&Ue.body.appendChild(gt),gt}(ee),this.containerElem_.appendChild(this.element),this.doc_=ee,this.usesDefaultWrapper_=!F.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw de.alreadyDisposed();return this.doc_}dispose(){const k=this.containerElem_;if(!k)throw de.alreadyDisposed();if(this.usesDefaultWrapper_){const A=k.parentElement;A&&A.removeChild(k)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(k){("plugin"in k?[k.plugin]:"plugins"in k?k.plugins:[]).forEach(A=>{this.pool_.register(A),this.embedPluginStyle_(A)})}embedPluginStyle_(k){k.css&&ba(this.document,`plugin-${k.id}`,k.css)}setUpDefaultPlugins_(){ba(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(k=>{this.embedPluginStyle_(k)}),this.registerPlugin({plugins:[nr,Fs,El,Xm]})}},u.SeparatorApi=gh,u.SliderApi=Aa,u.TabApi=Yi,u.TabPageApi=Fi,u.TextApi=Bu,u.TpChangeEvent=W,u.VERSION=If,Object.defineProperty(u,"__esModule",{value:!0})})(g)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(T){super(T),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}transform(T,g){return T?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(T,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(T=!0,g=!1){return T&&super.preload(),g&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))==null?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async T=>T.text()).then(T=>{const g=T.indexOf("/* worker */");if(g<1)throw new Error("unable to load decoder module");return T.substring(0,g-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))==null?void 0:_a()}async _loadLibrary(T,g){return DRACOLoader2.LibraryValueMap[T]?DRACOLoader2.LibraryValueMap[T]:DRACOLoader2.LibraryValueMap[T]=await super._loadLibrary(T,g)}static SetDecoderJsString(T){this.LibraryValueMap["draco_decoder.js"]=T}}DRACOLoader2.LibraryValueMap={}},988:function(T,g,u){u.d(g,{$TI:function(){return U_},$V:function(){return vE},$Vf:function(){return ld},$YQ:function(){return Fu},A5E:function(){return Bh},AXT:function(){return fy},Aip:function(){return Yy},B02:function(){return ie},BFQ:function(){return El},BG$:function(){return ps},BKK:function(){return ME},BVF:function(){return mt},BVQ:function(){return bp},BbS:function(){return ox},Bf4:function(){return _r},BtG:function(){return np},CJI:function(){return Zr},CP7:function(){return Ff},CaW:function(){return df},CdI:function(){return Er},Cne:function(){return yx},CtA:function(){return Ko},CtF:function(){return os},D1R:function(){return ds},D9w:function(){return Yi},DT1:function(){return ou},Djp:function(){return zd},DqL:function(){return Ty},DvJ:function(){return Ul},E2K:function(){return uf},EB7:function(){return vg},EJi:function(){return Xb},EoG:function(){return qr},F5T:function(){return Ss},FDw:function(){return mh},FE5:function(){return Zf},FIo:function(){return E_},FM8:function(){return qt},FT0:function(){return My},FUD:function(){return sn},FvO:function(){return _E},GG6:function(){return fu},GQ:function(){return j_},GUF:function(){return vi},GVz:function(){return Vm},GZb:function(){return EE},G_r:function(){return Co},Gih:function(){return ma},Gql:function(){return hE},H$k:function(){return Jf},HTd:function(){return z0},HW6:function(){return Mc},HdW:function(){return Eo},HgB:function(){return yf},HkE:function(){return lg},Hmr:function(){return Oy},Hw6:function(){return dc},Hy8:function(){return ot},Hyl:function(){return zo},IEO:function(){return Vf},IFH:function(){return mf},IKL:function(){return Ey},ILR:function(){return pu},IOt:function(){return So},Ilk:function(){return En},Ir4:function(){return Gd},JOQ:function(){return wa},JQ4:function(){return xs},JUT:function(){return xf},JWc:function(){return ks},KI_:function(){return Xn},Kgo:function(){return xp},KhW:function(){return nt},Kj0:function(){return Cs},Kz5:function(){return Ud},L5g:function(){return Ky},L5s:function(){return Ec},LBq:function(){return Dg},LSk:function(){return xh},LY2:function(){return Ya},L_r:function(){return Hd},Lcc:function(){return $u},LgZ:function(){return At},LsT:function(){return cr},Ltg:function(){return Ji},Lun:function(){return dp},M5h:function(){return Ye},M6v:function(){return hi},M8C:function(){return zm},Mig:function(){return Pg},MyG:function(){return Ri},N$j:function(){return ra},N4l:function(){return Ge},NDo:function(){return gr},NMF:function(){return Ml},NYV:function(){return oc},Ns1:function(){return Ci},NwF:function(){return ru},Ny0:function(){return _g},O7d:function(){return Sp},OAl:function(){return Pv},OM3:function(){return nr},OTo:function(){return Om},OdW:function(){return Qh},OoA:function(){return Xs},Ox3:function(){return Dy},PA7:function(){return zc},PMe:function(){return Ry},Pa4:function(){return ze},PeU:function(){return J},Pnf:function(){return Fc},PpQ:function(){return Qd},QM0:function(){return Vd},QRU:function(){return Sc},QZ1:function(){return _f},QmN:function(){return W},Qpg:function(){return dx},R2R:function(){return Cy},REq:function(){return SE},RNb:function(){return Wm},ROQ:function(){return zb},RSm:function(){return Kb},Rki:function(){return fx},RlZ:function(){return Ft},RsA:function(){return z},RvT:function(){return Nm},S2y:function(){return Y},S3k:function(){return ls},S9g:function(){return Tu},SJI:function(){return Uy},SPe:function(){return Ub},SUY:function(){return am},Se2:function(){return be},Sm8:function(){return he},So8:function(){return Ql},SvJ:function(){return gn},Syv:function(){return Vn},T95:function(){return er},TOt:function(){return __},TUj:function(){return F_},TUv:function(){return Fo},T_1:function(){return gx},T_J:function(){return gf},T__:function(){return dy},T_f:function(){return By},TlE:function(){return ur},Tme:function(){return Vi},Tn7:function(){return Cg},TyD:function(){return lr},U7:function(){return Vb},USm:function(){return Cu},UY4:function(){return _p},UZH:function(){return O},Uk6:function(){return $f},UlW:function(){return gu},Uol:function(){return Gl},V1s:function(){return Nv},V4E:function(){return Xy},VLJ:function(){return Hy},VYz:function(){return au},Vdb:function(){return Ct},Vj0:function(){return ta},Vkp:function(){return Ai},VzW:function(){return wl},W2J:function(){return el},WMw:function(){return pt},WTc:function(){return Xc},WXh:function(){return Tp},Wbm:function(){return _e},WdD:function(){return bi},Wid:function(){return wy},Wjw:function(){return Ug},Wl3:function(){return Pe},Wpd:function(){return Tt},Wqd:function(){return yy},WwZ:function(){return Xi},Wzm:function(){return uy},XZw:function(){return TE},Xaj:function(){return $},Xcj:function(){return mE},XvJ:function(){return Mg},Y8D:function(){return ke},YBo:function(){return Sy},YGz:function(){return vr},YKA:function(){return Sl},YLQ:function(){return Ka},YN5:function(){return vx},YT8:function(){return py},Ywn:function(){return Uv},Z6B:function(){return _u},ZAu:function(){return Is},ZQ6:function(){return my},ZRs:function(){return tr},ZTh:function(){return gi},ZZA:function(){return tm},Z_g:function(){return hy},Zp0:function(){return sm},Zr5:function(){return Ve},ZzF:function(){return nl},Zzh:function(){return Vy},_12:function(){return al},_3:function(){return kr},_AM:function(){return hf},_C8:function(){return xr},_Li:function(){return ue},_MY:function(){return oe},_YM:function(){return xc},_YX:function(){return yE},_am:function(){return V0},_fP:function(){return Fa},_iA:function(){return fe},_kC:function(){return lo},_lf:function(){return cc},_sL:function(){return Ah},a$l:function(){return Tn},aCh:function(){return Mo},aH4:function(){return sc},aLr:function(){return Do},aNw:function(){return dl},aVm:function(){return Du},ad5:function(){return Tv},anP:function(){return Yt},aq0:function(){return px},av9:function(){return km},b5g:function(){return i_},bBp:function(){return cx},bGH:function(){return le},b_z:function(){return Hu},bdR:function(){return et},blk:function(){return Vl},bnF:function(){return Jh},brP:function(){return ka},bsb:function(){return Ks},c8b:function(){return ye},cBI:function(){return xE},cBK:function(){return Iy},cJO:function(){return Mp},cLu:function(){return Ja},cPb:function(){return xa},cRx:function(){return Yo},cU9:function(){return ar},ce8:function(){return Sn},cek:function(){return Ip},cum:function(){return bh},dSO:function(){return Dr},dUE:function(){return nm},dYG:function(){return Zb},dZ3:function(){return Ao},dd2:function(){return ms},dj0:function(){return Os},dpR:function(){return T_},dwk:function(){return de},e62:function(){return $r},eD:function(){return Zt},eMJ:function(){return eo},eaV:function(){return wo},ehD:function(){return He},ejS:function(){return jl},ekQ:function(){return Za},epp:function(){return Tr},fHI:function(){return Yh},fO1:function(){return Fb},fQA:function(){return Og},fQK:function(){return t_},fSK:function(){return Dt},fY$:function(){return zr},fto:function(){return Um},g8_:function(){return Oa},gH0:function(){return um},gSk:function(){return Ki},g_z:function(){return g_},ghN:function(){return Me},gi4:function(){return _h},gti:function(){return gy},hEm:function(){return Fi},hH6:function(){return Ha},iAb:function(){return Xr},iDF:function(){return bc},iKG:function(){return jv},iLg:function(){return iu},iMs:function(){return jy},iUV:function(){return $i},iWC:function(){return ft},iWj:function(){return Jm},i_9:function(){return ky},iiP:function(){return Jo},irR:function(){return vh},j4z:function(){return Fm},j87:function(){return Bu},jAl:function(){return yh},jFi:function(){return Fe},jZA:function(){return ac},jfJ:function(){return To},jwo:function(){return vf},jyi:function(){return ju},jyz:function(){return gc},k0A:function(){return gh},k74:function(){return Mt},kB5:function(){return zu},kFz:function(){return Ch},kaV:function(){return Jb},knz:function(){return Br},kqm:function(){return lx},ksN:function(){return bt},l0P:function(){return Nc},l8J:function(){return vu},lCJ:function(){return Fs},lDi:function(){return R_},lGU:function(){return lc},lLk:function(){return C_},lRF:function(){return hp},lRj:function(){return cf},lb7:function(){return Ga},lfu:function(){return sa},lk7:function(){return su},m7l:function(){return qu},mSO:function(){return fs},mTL:function(){return rx},mXe:function(){return yg},m_w:function(){return Rp},mzJ:function(){return lm},nls:function(){return ao},ntZ:function(){return me},ntt:function(){return $o},nvb:function(){return wE},o8S:function(){return Wu},oAp:function(){return G0},oa8:function(){return Kf},oqc:function(){return Kr},p3g:function(){return no},p7y:function(){return Ap},pBf:function(){return tl},pIN:function(){return mu},pKu:function(){return Ys},pQR:function(){return Yf},ptH:function(){return Yr},qhX:function(){return mi},qkB:function(){return xo},qlB:function(){return Aa},qyh:function(){return fa},rAo:function(){return qm},rBU:function(){return An},rDY:function(){return j0},rOj:function(){return qe},r_:function(){return re},rnI:function(){return Zo},rpg:function(){return bo},s4_:function(){return nx},sYA:function(){return Xu},tEQ:function(){return Ig},tGC:function(){return mx},tJx:function(){return V_},tUh:function(){return oo},tf:function(){return k_},tm_:function(){return se},trn:function(){return qy},u37:function(){return dE},u7G:function(){return rm},u9r:function(){return ee},uEv:function(){return $a},uL9:function(){return Ni},uWy:function(){return Mr},uXU:function(){return jd},ub3:function(){return je},ujx:function(){return CE},v3W:function(){return Nd},v9Y:function(){return yr},vBJ:function(){return Lo},vCF:function(){return tt},vCx:function(){return Fd},vZf:function(){return Cv},vmT:function(){return co},vpT:function(){return Va},vuL:function(){return Bi},vxC:function(){return Sr},w$m:function(){return cn},wJv:function(){return Uc},wem:function(){return Cr},wk1:function(){return Ls},woe:function(){return h_},wuA:function(){return du},x12:function(){return Zi},x5V:function(){return ga},xEZ:function(){return pr},xG9:function(){return AE},xJs:function(){return ff},xWb:function(){return sd},xeV:function(){return oy},xfE:function(){return Fr},xo$:function(){return Cp},xoR:function(){return Yb},xsS:function(){return ul},y$t:function(){return Xh},y2t:function(){return pf},y8_:function(){return Wy},yC1:function(){return wc},yGw:function(){return _i},ybr:function(){return fp},yj7:function(){return jb},ylh:function(){return Rg},yo9:function(){return pp},yt0:function(){return Iv},ywz:function(){return xl},yxD:function(){return ex},z$h:function(){return rs},z81:function(){return _n},z8B:function(){return jf},zHn:function(){return Mu},zbs:function(){return $b},zf8:function(){return Gu}});const O="152",z={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},W={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},J=0,se=1,Y=2,ie=3,oe=0,fe=1,me=2,de=3,Pe=0,ue=1,He=2,je=2,Fe=0,et=1,pt=2,Ge=3,Ye=4,$=5,le=100,_e=101,qe=102,re=103,he=104,ye=200,Me=201,nt=202,ft=203,Mt=204,At=205,Dt=206,ot=207,Ct=208,Tt=209,Ft=210,mt=0,be=1,Ve=2,tt=3,Zt=4,bt=5,cn=6,hi=7,Ci=0,mi=1,gr=2,Ni=0,qr=1,Er=2,vr=3,Ya=4,Ao=5,Fr=300,zr=301,Sr=302,Dr=303,_r=304,Oa=306,bo=1e3,Mr=1001,Xs=1002,lr=1003,Ka=1004,z0=1004,sc=1005,Cv=1005,Cr=1006,fa=1007,cf=1007,ds=1008,mh=1008,xl=1009,er=1010,Xr=1011,cr=1012,Ud=1013,xs=1014,wl=1015,Ja=1016,gh=1017,vh=1018,Uc=1020,Om=1021,Ls=1023,ke=1024,Yo=1025,xo=1026,ka=1027,Fi=1028,Yi=1029,km=1030,Ko=1031,uf=1033,du=33776,El=33777,Nd=33778,pu=33779,hf=35840,Fd=35841,wo=35842,df=35843,Um=36196,Nc=37492,Za=37496,Yr=37808,ac=37809,pf=37810,_h=37811,zd=37812,ps=37813,oc=37814,ff=37815,Ys=37816,fu=37817,ma=37818,sn=37819,Jo=37820,gn=37821,Ks=36492,Eo=36283,Bi=36284,gi=36285,lc=36286,yh=2200,Sl=2201,$a=2202,Vn=2300,Ml=2301,mu=2302,Fc=2400,cc=2401,Ah=2402,mf=2500,Ki=2501,Xi=0,gu=1,rs=2,Zo=3e3,Br=3001,_n=3200,fs=3201,So=0,zc=1,Mo="",Xn="srgb",vi="srgb-linear",$o="display-p3",Co="rgbm-16",Tv=0,ga=7680,Sn=7681,tr=7682,To=7683,Kr=34055,gf=34056,eo=5386,Ri=512,jd=513,vf=514,Iv=515,Pv=516,Nm=517,Fm=518,bh=519,el=35044,Os=35048,_f=35040,ks=35045,Vd=35049,Gd=35041,yf=35046,vu=35050,_u=35042,yr="100",xh="300 es",Hd=1035;class tl{addEventListener(r,c){this._listeners===void 0&&(this._listeners={});const p=this._listeners;p[r]===void 0&&(p[r]=[]),p[r].indexOf(c)===-1&&p[r].push(c)}hasEventListener(r,c){if(this._listeners===void 0)return!1;const p=this._listeners;return p[r]!==void 0&&p[r].indexOf(c)!==-1}removeEventListener(r,c){if(this._listeners===void 0)return;const p=this._listeners[r];if(p!==void 0){const m=p.indexOf(c);m!==-1&&p.splice(m,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const c=this._listeners[r.type];if(c!==void 0){r.target=this;const p=c.slice(0);for(let m=0,_=p.length;m<_;m++)p[m].call(this,r);r.target=null}}}const Ar=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Rv=1234567;const uc=Math.PI/180,Io=180/Math.PI;function Ua(){const b=4294967295*Math.random()|0,r=4294967295*Math.random()|0,c=4294967295*Math.random()|0,p=4294967295*Math.random()|0;return(Ar[255&b]+Ar[b>>8&255]+Ar[b>>16&255]+Ar[b>>24&255]+"-"+Ar[255&r]+Ar[r>>8&255]+"-"+Ar[r>>16&15|64]+Ar[r>>24&255]+"-"+Ar[63&c|128]+Ar[c>>8&255]+"-"+Ar[c>>16&255]+Ar[c>>24&255]+Ar[255&p]+Ar[p>>8&255]+Ar[p>>16&255]+Ar[p>>24&255]).toLowerCase()}function Hn(b,r,c){return Math.max(r,Math.min(c,b))}function wh(b,r){return(b%r+r)%r}function Eh(b,r,c){return(1-c)*b+c*r}function Sh(b){return(b&b-1)==0&&b!==0}function Pi(b){return Math.pow(2,Math.ceil(Math.log(b)/Math.LN2))}function hc(b){return Math.pow(2,Math.floor(Math.log(b)/Math.LN2))}function to(b,r){switch(r.constructor){case Float32Array:return b;case Uint16Array:return b/65535;case Uint8Array:return b/255;case Int16Array:return Math.max(b/32767,-1);case Int8Array:return Math.max(b/127,-1);default:throw new Error("Invalid component type.")}}function Si(b,r){switch(r.constructor){case Float32Array:return b;case Uint16Array:return Math.round(65535*b);case Uint8Array:return Math.round(255*b);case Int16Array:return Math.round(32767*b);case Int8Array:return Math.round(127*b);default:throw new Error("Invalid component type.")}}const zm={DEG2RAD:uc,RAD2DEG:Io,generateUUID:Ua,clamp:Hn,euclideanModulo:wh,mapLinear:function(b,r,c,p,m){return p+(b-r)*(m-p)/(c-r)},inverseLerp:function(b,r,c){return b!==r?(c-b)/(r-b):0},lerp:Eh,damp:function(b,r,c,p){return Eh(b,r,1-Math.exp(-c*p))},pingpong:function(b,r=1){return r-Math.abs(wh(b,2*r)-r)},smoothstep:function(b,r,c){return b<=r?0:b>=c?1:(b=(b-r)/(c-r))*b*(3-2*b)},smootherstep:function(b,r,c){return b<=r?0:b>=c?1:(b=(b-r)/(c-r))*b*b*(b*(6*b-15)+10)},randInt:function(b,r){return b+Math.floor(Math.random()*(r-b+1))},randFloat:function(b,r){return b+Math.random()*(r-b)},randFloatSpread:function(b){return b*(.5-Math.random())},seededRandom:function(b){b!==void 0&&(Rv=b);let r=Rv+=1831565813;return r=Math.imul(r^r>>>15,1|r),r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296},degToRad:function(b){return b*uc},radToDeg:function(b){return b*Io},isPowerOfTwo:Sh,ceilPowerOfTwo:Pi,floorPowerOfTwo:hc,setQuaternionFromProperEuler:function(b,r,c,p,m){const _=Math.cos,x=Math.sin,S=_(c/2),B=x(c/2),D=_((r+p)/2),U=x((r+p)/2),G=_((r-p)/2),V=x((r-p)/2),Q=_((p-r)/2),q=x((p-r)/2);switch(m){case"XYX":b.set(S*U,B*G,B*V,S*D);break;case"YZY":b.set(B*V,S*U,B*G,S*D);break;case"ZXZ":b.set(B*G,B*V,S*U,S*D);break;case"XZX":b.set(S*U,B*q,B*Q,S*D);break;case"YXY":b.set(B*Q,S*U,B*q,S*D);break;case"ZYZ":b.set(B*q,B*Q,S*U,S*D);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+m)}},normalize:Si,denormalize:to};class qt{constructor(r=0,c=0){qt.prototype.isVector2=!0,this.x=r,this.y=c}get width(){return this.x}set width(r){this.x=r}get height(){return this.y}set height(r){this.y=r}set(r,c){return this.x=r,this.y=c,this}setScalar(r){return this.x=r,this.y=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setComponent(r,c){switch(r){case 0:this.x=c;break;case 1:this.y=c;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y)}copy(r){return this.x=r.x,this.y=r.y,this}add(r){return this.x+=r.x,this.y+=r.y,this}addScalar(r){return this.x+=r,this.y+=r,this}addVectors(r,c){return this.x=r.x+c.x,this.y=r.y+c.y,this}addScaledVector(r,c){return this.x+=r.x*c,this.y+=r.y*c,this}sub(r){return this.x-=r.x,this.y-=r.y,this}subScalar(r){return this.x-=r,this.y-=r,this}subVectors(r,c){return this.x=r.x-c.x,this.y=r.y-c.y,this}multiply(r){return this.x*=r.x,this.y*=r.y,this}multiplyScalar(r){return this.x*=r,this.y*=r,this}divide(r){return this.x/=r.x,this.y/=r.y,this}divideScalar(r){return this.multiplyScalar(1/r)}applyMatrix3(r){const c=this.x,p=this.y,m=r.elements;return this.x=m[0]*c+m[3]*p+m[6],this.y=m[1]*c+m[4]*p+m[7],this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this}clamp(r,c){return this.x=Math.max(r.x,Math.min(c.x,this.x)),this.y=Math.max(r.y,Math.min(c.y,this.y)),this}clampScalar(r,c){return this.x=Math.max(r,Math.min(c,this.x)),this.y=Math.max(r,Math.min(c,this.y)),this}clampLength(r,c){const p=this.length();return this.divideScalar(p||1).multiplyScalar(Math.max(r,Math.min(c,p)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(r){return this.x*r.x+this.y*r.y}cross(r){return this.x*r.y-this.y*r.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(r){const c=Math.sqrt(this.lengthSq()*r.lengthSq());if(c===0)return Math.PI/2;const p=this.dot(r)/c;return Math.acos(Hn(p,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const c=this.x-r.x,p=this.y-r.y;return c*c+p*p}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,c){return this.x+=(r.x-this.x)*c,this.y+=(r.y-this.y)*c,this}lerpVectors(r,c,p){return this.x=r.x+(c.x-r.x)*p,this.y=r.y+(c.y-r.y)*p,this}equals(r){return r.x===this.x&&r.y===this.y}fromArray(r,c=0){return this.x=r[c],this.y=r[c+1],this}toArray(r=[],c=0){return r[c]=this.x,r[c+1]=this.y,r}fromBufferAttribute(r,c){return this.x=r.getX(c),this.y=r.getY(c),this}rotateAround(r,c){const p=Math.cos(c),m=Math.sin(c),_=this.x-r.x,x=this.y-r.y;return this.x=_*p-x*m+r.x,this.y=_*m+x*p+r.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ai{constructor(){Ai.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(r,c,p,m,_,x,S,B,D){const U=this.elements;return U[0]=r,U[1]=m,U[2]=S,U[3]=c,U[4]=_,U[5]=B,U[6]=p,U[7]=x,U[8]=D,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){const c=this.elements,p=r.elements;return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c[4]=p[4],c[5]=p[5],c[6]=p[6],c[7]=p[7],c[8]=p[8],this}extractBasis(r,c,p){return r.setFromMatrix3Column(this,0),c.setFromMatrix3Column(this,1),p.setFromMatrix3Column(this,2),this}setFromMatrix4(r){const c=r.elements;return this.set(c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]),this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,c){const p=r.elements,m=c.elements,_=this.elements,x=p[0],S=p[3],B=p[6],D=p[1],U=p[4],G=p[7],V=p[2],Q=p[5],q=p[8],te=m[0],K=m[3],Z=m[6],ae=m[1],ce=m[4],Te=m[7],Ce=m[2],Ie=m[5],Ke=m[8];return _[0]=x*te+S*ae+B*Ce,_[3]=x*K+S*ce+B*Ie,_[6]=x*Z+S*Te+B*Ke,_[1]=D*te+U*ae+G*Ce,_[4]=D*K+U*ce+G*Ie,_[7]=D*Z+U*Te+G*Ke,_[2]=V*te+Q*ae+q*Ce,_[5]=V*K+Q*ce+q*Ie,_[8]=V*Z+Q*Te+q*Ke,this}multiplyScalar(r){const c=this.elements;return c[0]*=r,c[3]*=r,c[6]*=r,c[1]*=r,c[4]*=r,c[7]*=r,c[2]*=r,c[5]*=r,c[8]*=r,this}determinant(){const r=this.elements,c=r[0],p=r[1],m=r[2],_=r[3],x=r[4],S=r[5],B=r[6],D=r[7],U=r[8];return c*x*U-c*S*D-p*_*U+p*S*B+m*_*D-m*x*B}invert(){const r=this.elements,c=r[0],p=r[1],m=r[2],_=r[3],x=r[4],S=r[5],B=r[6],D=r[7],U=r[8],G=U*x-S*D,V=S*B-U*_,Q=D*_-x*B,q=c*G+p*V+m*Q;if(q===0)return this.set(0,0,0,0,0,0,0,0,0);const te=1/q;return r[0]=G*te,r[1]=(m*D-U*p)*te,r[2]=(S*p-m*x)*te,r[3]=V*te,r[4]=(U*c-m*B)*te,r[5]=(m*_-S*c)*te,r[6]=Q*te,r[7]=(p*B-D*c)*te,r[8]=(x*c-p*_)*te,this}transpose(){let r;const c=this.elements;return r=c[1],c[1]=c[3],c[3]=r,r=c[2],c[2]=c[6],c[6]=r,r=c[5],c[5]=c[7],c[7]=r,this}getNormalMatrix(r){return this.setFromMatrix4(r).invert().transpose()}transposeIntoArray(r){const c=this.elements;return r[0]=c[0],r[1]=c[3],r[2]=c[6],r[3]=c[1],r[4]=c[4],r[5]=c[7],r[6]=c[2],r[7]=c[5],r[8]=c[8],this}setUvTransform(r,c,p,m,_,x,S){const B=Math.cos(_),D=Math.sin(_);return this.set(p*B,p*D,-p*(B*x+D*S)+x+r,-m*D,m*B,-m*(-D*x+B*S)+S+c,0,0,1),this}scale(r,c){return this.premultiply(Na.makeScale(r,c)),this}rotate(r){return this.premultiply(Na.makeRotation(-r)),this}translate(r,c){return this.premultiply(Na.makeTranslation(r,c)),this}makeTranslation(r,c){return this.set(1,0,r,0,1,c,0,0,1),this}makeRotation(r){const c=Math.cos(r),p=Math.sin(r);return this.set(c,-p,0,p,c,0,0,0,1),this}makeScale(r,c){return this.set(r,0,0,0,c,0,0,0,1),this}equals(r){const c=this.elements,p=r.elements;for(let m=0;m<9;m++)if(c[m]!==p[m])return!1;return!0}fromArray(r,c=0){for(let p=0;p<9;p++)this.elements[p]=r[p+c];return this}toArray(r=[],c=0){const p=this.elements;return r[c]=p[0],r[c+1]=p[1],r[c+2]=p[2],r[c+3]=p[3],r[c+4]=p[4],r[c+5]=p[5],r[c+6]=p[6],r[c+7]=p[7],r[c+8]=p[8],r}clone(){return new this.constructor().fromArray(this.elements)}}const Na=new Ai;function Dv(b){for(let r=b.length-1;r>=0;--r)if(b[r]>=65535)return!0;return!1}const Bv={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function yu(b,r){return new Bv[b](r)}function Mh(b){return document.createElementNS("http://www.w3.org/1999/xhtml",b)}const Af={};function Au(b){b in Af||(Af[b]=!0,console.warn(b))}function bu(b){return b<.04045?.0773993808*b:Math.pow(.9478672986*b+.0521327014,2.4)}function bf(b){return b<.0031308?12.92*b:1.055*Math.pow(b,.41666)-.055}const Lv=new Ai().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),jm=new Ai().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Ov={[vi]:b=>b,[Xn]:b=>b.convertSRGBToLinear(),[$o]:function(b){return b.convertSRGBToLinear().applyMatrix3(jm)}},kv={[vi]:b=>b,[Xn]:b=>b.convertLinearToSRGB(),[$o]:function(b){return b.applyMatrix3(Lv).convertLinearToSRGB()}},Tr={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(b){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!b},get workingColorSpace(){return vi},set workingColorSpace(b){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(b,r,c){if(this.enabled===!1||r===c||!r||!c)return b;const p=Ov[r],m=kv[c];if(p===void 0||m===void 0)throw new Error(`Unsupported color space conversion, "${r}" to "${c}".`);return m(p(b))},fromWorkingColorSpace:function(b,r){return this.convert(b,this.workingColorSpace,r)},toWorkingColorSpace:function(b,r){return this.convert(b,r,this.workingColorSpace)}};let Po;class Qd{static getDataURL(r,c=!1){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let p;if(r instanceof HTMLCanvasElement)p=r;else{Po===void 0&&(Po=Mh("canvas")),Po.width=r.width,Po.height=r.height;const m=Po.getContext("2d");r instanceof ImageData?m.putImageData(r,0,0):m.drawImage(r,0,0,r.width,r.height),p=Po}return!c&&(p.width>2048||p.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),p.toDataURL("image/jpeg",.6)):p.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const c=Mh("canvas");c.width=r.width,c.height=r.height;const p=c.getContext("2d");p.drawImage(r,0,0,r.width,r.height);const m=p.getImageData(0,0,r.width,r.height),_=m.data;for(let x=0;x<_.length;x++)_[x]=255*bu(_[x]/255);return p.putImageData(m,0,0),c}if(r.data){const c=r.data.slice(0);for(let p=0;p<c.length;p++)c instanceof Uint8Array||c instanceof Uint8ClampedArray?c[p]=Math.floor(255*bu(c[p]/255)):c[p]=bu(c[p]);return{data:c,width:r.width,height:r.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}}class dc{constructor(r=null){this.isSource=!0,this.uuid=Ua(),this.data=r,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const c=r===void 0||typeof r=="string";if(!c&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const p={uuid:this.uuid,url:""},m=this.data;if(m!==null){let _;if(Array.isArray(m)){_=[];for(let x=0,S=m.length;x<S;x++)m[x].isDataTexture?_.push(Wd(m[x].image)):_.push(Wd(m[x]))}else _=Wd(m);p.url=_}return c||(r.images[this.uuid]=p),p}}function Wd(b){if(typeof HTMLImageElement<"u"&&b instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&b instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&b instanceof ImageBitmap)return Qd.getDataURL(b);if(b.data){let r=[];try{r=Array.from(b.data)}catch(c){c.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(c),r=b.data}return{data:r,width:b.width,height:b.height,type:b.data.constructor.name}}return b.url!==void 0?b.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let qd=0;class pr extends tl{constructor(r=pr.DEFAULT_IMAGE,c=pr.DEFAULT_MAPPING,p=Mr,m=Mr,_=Cr,x=ds,S=Ls,B=xl,D=pr.DEFAULT_ANISOTROPY,U=Mo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:qd++}),this.uuid=Ua(),this.name="",this.source=new dc(r),this.mipmaps=[],this.mapping=c,this.channel=0,this.wrapS=p,this.wrapT=m,this.magFilter=_,this.minFilter=x,this.anisotropy=D,this.format=S,this.internalFormat=null,this.type=B,this.offset=new qt(0,0),this.repeat=new qt(1,1),this.center=new qt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ai,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof U=="string"?this.colorSpace=U:(Au("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=U===Br?Xn:Mo),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(r=null){this.source.data=r}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(r){return this.name=r.name,this.source=r.source,this.mipmaps=r.mipmaps.slice(0),this.mapping=r.mapping,this.channel=r.channel,this.wrapS=r.wrapS,this.wrapT=r.wrapT,this.magFilter=r.magFilter,this.minFilter=r.minFilter,this.anisotropy=r.anisotropy,this.format=r.format,this.internalFormat=r.internalFormat,this.type=r.type,this.offset.copy(r.offset),this.repeat.copy(r.repeat),this.center.copy(r.center),this.rotation=r.rotation,this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrix.copy(r.matrix),this.generateMipmaps=r.generateMipmaps,this.premultiplyAlpha=r.premultiplyAlpha,this.flipY=r.flipY,this.unpackAlignment=r.unpackAlignment,this.colorSpace=r.colorSpace,this.userData=JSON.parse(JSON.stringify(r.userData)),this.needsUpdate=!0,this}toJSON(r){const c=r===void 0||typeof r=="string";if(!c&&r.textures[this.uuid]!==void 0)return r.textures[this.uuid];const p={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(r).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===Xn?Br:Zo,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(p.userData=this.userData),c||(r.textures[this.uuid]=p),p}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(r){if(this.mapping!==Fr)return r;if(r.applyMatrix3(this.matrix),r.x<0||r.x>1)switch(this.wrapS){case bo:r.x=r.x-Math.floor(r.x);break;case Mr:r.x=r.x<0?0:1;break;case Xs:Math.abs(Math.floor(r.x)%2)===1?r.x=Math.ceil(r.x)-r.x:r.x=r.x-Math.floor(r.x)}if(r.y<0||r.y>1)switch(this.wrapT){case bo:r.y=r.y-Math.floor(r.y);break;case Mr:r.y=r.y<0?0:1;break;case Xs:Math.abs(Math.floor(r.y)%2)===1?r.y=Math.ceil(r.y)-r.y:r.y=r.y-Math.floor(r.y)}return this.flipY&&(r.y=1-r.y),r}set needsUpdate(r){r===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return Au("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Xn?Br:Zo}set encoding(r){Au("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=r===Br?Xn:Mo}}pr.DEFAULT_IMAGE=null,pr.DEFAULT_MAPPING=Fr,pr.DEFAULT_ANISOTROPY=1;class Ji{constructor(r=0,c=0,p=0,m=1){Ji.prototype.isVector4=!0,this.x=r,this.y=c,this.z=p,this.w=m}get width(){return this.z}set width(r){this.z=r}get height(){return this.w}set height(r){this.w=r}set(r,c,p,m){return this.x=r,this.y=c,this.z=p,this.w=m,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this.w=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setW(r){return this.w=r,this}setComponent(r,c){switch(r){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;case 3:this.w=c;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w!==void 0?r.w:1,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this.w+=r,this}addVectors(r,c){return this.x=r.x+c.x,this.y=r.y+c.y,this.z=r.z+c.z,this.w=r.w+c.w,this}addScaledVector(r,c){return this.x+=r.x*c,this.y+=r.y*c,this.z+=r.z*c,this.w+=r.w*c,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this.w-=r.w,this}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this.w-=r,this}subVectors(r,c){return this.x=r.x-c.x,this.y=r.y-c.y,this.z=r.z-c.z,this.w=r.w-c.w,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this.w*=r.w,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this}applyMatrix4(r){const c=this.x,p=this.y,m=this.z,_=this.w,x=r.elements;return this.x=x[0]*c+x[4]*p+x[8]*m+x[12]*_,this.y=x[1]*c+x[5]*p+x[9]*m+x[13]*_,this.z=x[2]*c+x[6]*p+x[10]*m+x[14]*_,this.w=x[3]*c+x[7]*p+x[11]*m+x[15]*_,this}divideScalar(r){return this.multiplyScalar(1/r)}setAxisAngleFromQuaternion(r){this.w=2*Math.acos(r.w);const c=Math.sqrt(1-r.w*r.w);return c<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=r.x/c,this.y=r.y/c,this.z=r.z/c),this}setAxisAngleFromRotationMatrix(r){let c,p,m,_;const B=r.elements,D=B[0],U=B[4],G=B[8],V=B[1],Q=B[5],q=B[9],te=B[2],K=B[6],Z=B[10];if(Math.abs(U-V)<.01&&Math.abs(G-te)<.01&&Math.abs(q-K)<.01){if(Math.abs(U+V)<.1&&Math.abs(G+te)<.1&&Math.abs(q+K)<.1&&Math.abs(D+Q+Z-3)<.1)return this.set(1,0,0,0),this;c=Math.PI;const ce=(D+1)/2,Te=(Q+1)/2,Ce=(Z+1)/2,Ie=(U+V)/4,Ke=(G+te)/4,ct=(q+K)/4;return ce>Te&&ce>Ce?ce<.01?(p=0,m=.707106781,_=.707106781):(p=Math.sqrt(ce),m=Ie/p,_=Ke/p):Te>Ce?Te<.01?(p=.707106781,m=0,_=.707106781):(m=Math.sqrt(Te),p=Ie/m,_=ct/m):Ce<.01?(p=.707106781,m=.707106781,_=0):(_=Math.sqrt(Ce),p=Ke/_,m=ct/_),this.set(p,m,_,c),this}let ae=Math.sqrt((K-q)*(K-q)+(G-te)*(G-te)+(V-U)*(V-U));return Math.abs(ae)<.001&&(ae=1),this.x=(K-q)/ae,this.y=(G-te)/ae,this.z=(V-U)/ae,this.w=Math.acos((D+Q+Z-1)/2),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this.w=Math.min(this.w,r.w),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this.w=Math.max(this.w,r.w),this}clamp(r,c){return this.x=Math.max(r.x,Math.min(c.x,this.x)),this.y=Math.max(r.y,Math.min(c.y,this.y)),this.z=Math.max(r.z,Math.min(c.z,this.z)),this.w=Math.max(r.w,Math.min(c.w,this.w)),this}clampScalar(r,c){return this.x=Math.max(r,Math.min(c,this.x)),this.y=Math.max(r,Math.min(c,this.y)),this.z=Math.max(r,Math.min(c,this.z)),this.w=Math.max(r,Math.min(c,this.w)),this}clampLength(r,c){const p=this.length();return this.divideScalar(p||1).multiplyScalar(Math.max(r,Math.min(c,p)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z+this.w*r.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,c){return this.x+=(r.x-this.x)*c,this.y+=(r.y-this.y)*c,this.z+=(r.z-this.z)*c,this.w+=(r.w-this.w)*c,this}lerpVectors(r,c,p){return this.x=r.x+(c.x-r.x)*p,this.y=r.y+(c.y-r.y)*p,this.z=r.z+(c.z-r.z)*p,this.w=r.w+(c.w-r.w)*p,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z&&r.w===this.w}fromArray(r,c=0){return this.x=r[c],this.y=r[c+1],this.z=r[c+2],this.w=r[c+3],this}toArray(r=[],c=0){return r[c]=this.x,r[c+1]=this.y,r[c+2]=this.z,r[c+3]=this.w,r}fromBufferAttribute(r,c){return this.x=r.getX(c),this.y=r.getY(c),this.z=r.getZ(c),this.w=r.getW(c),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ms extends tl{constructor(r=1,c=1,p={}){super(),this.isWebGLRenderTarget=!0,this.width=r,this.height=c,this.depth=1,this.scissor=new Ji(0,0,r,c),this.scissorTest=!1,this.viewport=new Ji(0,0,r,c);const m={width:r,height:c,depth:1};p.encoding!==void 0&&(Au("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),p.colorSpace=p.encoding===Br?Xn:Mo),this.texture=new pr(m,p.mapping,p.wrapS,p.wrapT,p.magFilter,p.minFilter,p.format,p.type,p.anisotropy,p.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=p.generateMipmaps!==void 0&&p.generateMipmaps,this.texture.internalFormat=p.internalFormat!==void 0?p.internalFormat:null,this.texture.minFilter=p.minFilter!==void 0?p.minFilter:Cr,this.depthBuffer=p.depthBuffer===void 0||p.depthBuffer,this.stencilBuffer=p.stencilBuffer!==void 0&&p.stencilBuffer,this.depthTexture=p.depthTexture!==void 0?p.depthTexture:null,this.samples=p.samples!==void 0?p.samples:0}setSize(r,c,p=1){this.width===r&&this.height===c&&this.depth===p||(this.width=r,this.height=c,this.depth=p,this.texture.image.width=r,this.texture.image.height=c,this.texture.image.depth=p,this.dispose()),this.viewport.set(0,0,r,c),this.scissor.set(0,0,r,c)}clone(){return new this.constructor().copy(this)}copy(r){this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.texture=r.texture.clone(),this.texture.isRenderTargetTexture=!0;const c=Object.assign({},r.texture.image);return this.texture.source=new dc(c),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.samples=r.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class no extends pr{constructor(r=null,c=1,p=1,m=1){super(null),this.isDataArrayTexture=!0,this.image={data:r,width:c,height:p,depth:m},this.magFilter=lr,this.minFilter=lr,this.wrapR=Mr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Vm extends ms{constructor(r=1,c=1,p=1){super(r,c),this.isWebGLArrayRenderTarget=!0,this.depth=p,this.texture=new no(null,r,c,p),this.texture.isRenderTargetTexture=!0}}class xf extends pr{constructor(r=null,c=1,p=1,m=1){super(null),this.isData3DTexture=!0,this.image={data:r,width:c,height:p,depth:m},this.magFilter=lr,this.minFilter=lr,this.wrapR=Mr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Uv extends ms{constructor(r=1,c=1,p=1){super(r,c),this.isWebGL3DRenderTarget=!0,this.depth=p,this.texture=new xf(null,r,c,p),this.texture.isRenderTargetTexture=!0}}class Ch extends ms{constructor(r=1,c=1,p=1,m={}){super(r,c,m),this.isWebGLMultipleRenderTargets=!0;const _=this.texture;this.texture=[];for(let x=0;x<p;x++)this.texture[x]=_.clone(),this.texture[x].isRenderTargetTexture=!0}setSize(r,c,p=1){if(this.width!==r||this.height!==c||this.depth!==p){this.width=r,this.height=c,this.depth=p;for(let m=0,_=this.texture.length;m<_;m++)this.texture[m].image.width=r,this.texture[m].image.height=c,this.texture[m].image.depth=p;this.dispose()}return this.viewport.set(0,0,r,c),this.scissor.set(0,0,r,c),this}copy(r){this.dispose(),this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.texture.length=0;for(let c=0,p=r.texture.length;c<p;c++)this.texture[c]=r.texture[c].clone(),this.texture[c].isRenderTargetTexture=!0;return this}}class Fa{constructor(r=0,c=0,p=0,m=1){this.isQuaternion=!0,this._x=r,this._y=c,this._z=p,this._w=m}static slerpFlat(r,c,p,m,_,x,S){let B=p[m+0],D=p[m+1],U=p[m+2],G=p[m+3];const V=_[x+0],Q=_[x+1],q=_[x+2],te=_[x+3];if(S===0)return r[c+0]=B,r[c+1]=D,r[c+2]=U,void(r[c+3]=G);if(S===1)return r[c+0]=V,r[c+1]=Q,r[c+2]=q,void(r[c+3]=te);if(G!==te||B!==V||D!==Q||U!==q){let K=1-S;const Z=B*V+D*Q+U*q+G*te,ae=Z>=0?1:-1,ce=1-Z*Z;if(ce>Number.EPSILON){const Ce=Math.sqrt(ce),Ie=Math.atan2(Ce,Z*ae);K=Math.sin(K*Ie)/Ce,S=Math.sin(S*Ie)/Ce}const Te=S*ae;if(B=B*K+V*Te,D=D*K+Q*Te,U=U*K+q*Te,G=G*K+te*Te,K===1-S){const Ce=1/Math.sqrt(B*B+D*D+U*U+G*G);B*=Ce,D*=Ce,U*=Ce,G*=Ce}}r[c]=B,r[c+1]=D,r[c+2]=U,r[c+3]=G}static multiplyQuaternionsFlat(r,c,p,m,_,x){const S=p[m],B=p[m+1],D=p[m+2],U=p[m+3],G=_[x],V=_[x+1],Q=_[x+2],q=_[x+3];return r[c]=S*q+U*G+B*Q-D*V,r[c+1]=B*q+U*V+D*G-S*Q,r[c+2]=D*q+U*Q+S*V-B*G,r[c+3]=U*q-S*G-B*V-D*Q,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,c,p,m){return this._x=r,this._y=c,this._z=p,this._w=m,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,c){const p=r._x,m=r._y,_=r._z,x=r._order,S=Math.cos,B=Math.sin,D=S(p/2),U=S(m/2),G=S(_/2),V=B(p/2),Q=B(m/2),q=B(_/2);switch(x){case"XYZ":this._x=V*U*G+D*Q*q,this._y=D*Q*G-V*U*q,this._z=D*U*q+V*Q*G,this._w=D*U*G-V*Q*q;break;case"YXZ":this._x=V*U*G+D*Q*q,this._y=D*Q*G-V*U*q,this._z=D*U*q-V*Q*G,this._w=D*U*G+V*Q*q;break;case"ZXY":this._x=V*U*G-D*Q*q,this._y=D*Q*G+V*U*q,this._z=D*U*q+V*Q*G,this._w=D*U*G-V*Q*q;break;case"ZYX":this._x=V*U*G-D*Q*q,this._y=D*Q*G+V*U*q,this._z=D*U*q-V*Q*G,this._w=D*U*G+V*Q*q;break;case"YZX":this._x=V*U*G+D*Q*q,this._y=D*Q*G+V*U*q,this._z=D*U*q-V*Q*G,this._w=D*U*G-V*Q*q;break;case"XZY":this._x=V*U*G-D*Q*q,this._y=D*Q*G-V*U*q,this._z=D*U*q+V*Q*G,this._w=D*U*G+V*Q*q;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+x)}return c!==!1&&this._onChangeCallback(),this}setFromAxisAngle(r,c){const p=c/2,m=Math.sin(p);return this._x=r.x*m,this._y=r.y*m,this._z=r.z*m,this._w=Math.cos(p),this._onChangeCallback(),this}setFromRotationMatrix(r){const c=r.elements,p=c[0],m=c[4],_=c[8],x=c[1],S=c[5],B=c[9],D=c[2],U=c[6],G=c[10],V=p+S+G;if(V>0){const Q=.5/Math.sqrt(V+1);this._w=.25/Q,this._x=(U-B)*Q,this._y=(_-D)*Q,this._z=(x-m)*Q}else if(p>S&&p>G){const Q=2*Math.sqrt(1+p-S-G);this._w=(U-B)/Q,this._x=.25*Q,this._y=(m+x)/Q,this._z=(_+D)/Q}else if(S>G){const Q=2*Math.sqrt(1+S-p-G);this._w=(_-D)/Q,this._x=(m+x)/Q,this._y=.25*Q,this._z=(B+U)/Q}else{const Q=2*Math.sqrt(1+G-p-S);this._w=(x-m)/Q,this._x=(_+D)/Q,this._y=(B+U)/Q,this._z=.25*Q}return this._onChangeCallback(),this}setFromUnitVectors(r,c){let p=r.dot(c)+1;return p<Number.EPSILON?(p=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=p):(this._x=0,this._y=-r.z,this._z=r.y,this._w=p)):(this._x=r.y*c.z-r.z*c.y,this._y=r.z*c.x-r.x*c.z,this._z=r.x*c.y-r.y*c.x,this._w=p),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(Hn(this.dot(r),-1,1)))}rotateTowards(r,c){const p=this.angleTo(r);if(p===0)return this;const m=Math.min(1,c/p);return this.slerp(r,m),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,c){const p=r._x,m=r._y,_=r._z,x=r._w,S=c._x,B=c._y,D=c._z,U=c._w;return this._x=p*U+x*S+m*D-_*B,this._y=m*U+x*B+_*S-p*D,this._z=_*U+x*D+p*B-m*S,this._w=x*U-p*S-m*B-_*D,this._onChangeCallback(),this}slerp(r,c){if(c===0)return this;if(c===1)return this.copy(r);const p=this._x,m=this._y,_=this._z,x=this._w;let S=x*r._w+p*r._x+m*r._y+_*r._z;if(S<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,S=-S):this.copy(r),S>=1)return this._w=x,this._x=p,this._y=m,this._z=_,this;const B=1-S*S;if(B<=Number.EPSILON){const Q=1-c;return this._w=Q*x+c*this._w,this._x=Q*p+c*this._x,this._y=Q*m+c*this._y,this._z=Q*_+c*this._z,this.normalize(),this._onChangeCallback(),this}const D=Math.sqrt(B),U=Math.atan2(D,S),G=Math.sin((1-c)*U)/D,V=Math.sin(c*U)/D;return this._w=x*G+this._w*V,this._x=p*G+this._x*V,this._y=m*G+this._y*V,this._z=_*G+this._z*V,this._onChangeCallback(),this}slerpQuaternions(r,c,p){return this.copy(r).slerp(c,p)}random(){const r=Math.random(),c=Math.sqrt(1-r),p=Math.sqrt(r),m=2*Math.PI*Math.random(),_=2*Math.PI*Math.random();return this.set(c*Math.cos(m),p*Math.sin(_),p*Math.cos(_),c*Math.sin(m))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,c=0){return this._x=r[c],this._y=r[c+1],this._z=r[c+2],this._w=r[c+3],this._onChangeCallback(),this}toArray(r=[],c=0){return r[c]=this._x,r[c+1]=this._y,r[c+2]=this._z,r[c+3]=this._w,r}fromBufferAttribute(r,c){return this._x=r.getX(c),this._y=r.getY(c),this._z=r.getZ(c),this._w=r.getW(c),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ze{constructor(r=0,c=0,p=0){ze.prototype.isVector3=!0,this.x=r,this.y=c,this.z=p}set(r,c,p){return p===void 0&&(p=this.z),this.x=r,this.y=c,this.z=p,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setComponent(r,c){switch(r){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this}addVectors(r,c){return this.x=r.x+c.x,this.y=r.y+c.y,this.z=r.z+c.z,this}addScaledVector(r,c){return this.x+=r.x*c,this.y+=r.y*c,this.z+=r.z*c,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this}subVectors(r,c){return this.x=r.x-c.x,this.y=r.y-c.y,this.z=r.z-c.z,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}multiplyVectors(r,c){return this.x=r.x*c.x,this.y=r.y*c.y,this.z=r.z*c.z,this}applyEuler(r){return this.applyQuaternion(Ef.setFromEuler(r))}applyAxisAngle(r,c){return this.applyQuaternion(Ef.setFromAxisAngle(r,c))}applyMatrix3(r){const c=this.x,p=this.y,m=this.z,_=r.elements;return this.x=_[0]*c+_[3]*p+_[6]*m,this.y=_[1]*c+_[4]*p+_[7]*m,this.z=_[2]*c+_[5]*p+_[8]*m,this}applyNormalMatrix(r){return this.applyMatrix3(r).normalize()}applyMatrix4(r){const c=this.x,p=this.y,m=this.z,_=r.elements,x=1/(_[3]*c+_[7]*p+_[11]*m+_[15]);return this.x=(_[0]*c+_[4]*p+_[8]*m+_[12])*x,this.y=(_[1]*c+_[5]*p+_[9]*m+_[13])*x,this.z=(_[2]*c+_[6]*p+_[10]*m+_[14])*x,this}applyQuaternion(r){const c=this.x,p=this.y,m=this.z,_=r.x,x=r.y,S=r.z,B=r.w,D=B*c+x*m-S*p,U=B*p+S*c-_*m,G=B*m+_*p-x*c,V=-_*c-x*p-S*m;return this.x=D*B+V*-_+U*-S-G*-x,this.y=U*B+V*-x+G*-_-D*-S,this.z=G*B+V*-S+D*-x-U*-_,this}project(r){return this.applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix)}unproject(r){return this.applyMatrix4(r.projectionMatrixInverse).applyMatrix4(r.matrixWorld)}transformDirection(r){const c=this.x,p=this.y,m=this.z,_=r.elements;return this.x=_[0]*c+_[4]*p+_[8]*m,this.y=_[1]*c+_[5]*p+_[9]*m,this.z=_[2]*c+_[6]*p+_[10]*m,this.normalize()}divide(r){return this.x/=r.x,this.y/=r.y,this.z/=r.z,this}divideScalar(r){return this.multiplyScalar(1/r)}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}clamp(r,c){return this.x=Math.max(r.x,Math.min(c.x,this.x)),this.y=Math.max(r.y,Math.min(c.y,this.y)),this.z=Math.max(r.z,Math.min(c.z,this.z)),this}clampScalar(r,c){return this.x=Math.max(r,Math.min(c,this.x)),this.y=Math.max(r,Math.min(c,this.y)),this.z=Math.max(r,Math.min(c,this.z)),this}clampLength(r,c){const p=this.length();return this.divideScalar(p||1).multiplyScalar(Math.max(r,Math.min(c,p)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,c){return this.x+=(r.x-this.x)*c,this.y+=(r.y-this.y)*c,this.z+=(r.z-this.z)*c,this}lerpVectors(r,c,p){return this.x=r.x+(c.x-r.x)*p,this.y=r.y+(c.y-r.y)*p,this.z=r.z+(c.z-r.z)*p,this}cross(r){return this.crossVectors(this,r)}crossVectors(r,c){const p=r.x,m=r.y,_=r.z,x=c.x,S=c.y,B=c.z;return this.x=m*B-_*S,this.y=_*x-p*B,this.z=p*S-m*x,this}projectOnVector(r){const c=r.lengthSq();if(c===0)return this.set(0,0,0);const p=r.dot(this)/c;return this.copy(r).multiplyScalar(p)}projectOnPlane(r){return wf.copy(this).projectOnVector(r),this.sub(wf)}reflect(r){return this.sub(wf.copy(r).multiplyScalar(2*this.dot(r)))}angleTo(r){const c=Math.sqrt(this.lengthSq()*r.lengthSq());if(c===0)return Math.PI/2;const p=this.dot(r)/c;return Math.acos(Hn(p,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const c=this.x-r.x,p=this.y-r.y,m=this.z-r.z;return c*c+p*p+m*m}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)+Math.abs(this.z-r.z)}setFromSpherical(r){return this.setFromSphericalCoords(r.radius,r.phi,r.theta)}setFromSphericalCoords(r,c,p){const m=Math.sin(c)*r;return this.x=m*Math.sin(p),this.y=Math.cos(c)*r,this.z=m*Math.cos(p),this}setFromCylindrical(r){return this.setFromCylindricalCoords(r.radius,r.theta,r.y)}setFromCylindricalCoords(r,c,p){return this.x=r*Math.sin(c),this.y=p,this.z=r*Math.cos(c),this}setFromMatrixPosition(r){const c=r.elements;return this.x=c[12],this.y=c[13],this.z=c[14],this}setFromMatrixScale(r){const c=this.setFromMatrixColumn(r,0).length(),p=this.setFromMatrixColumn(r,1).length(),m=this.setFromMatrixColumn(r,2).length();return this.x=c,this.y=p,this.z=m,this}setFromMatrixColumn(r,c){return this.fromArray(r.elements,4*c)}setFromMatrix3Column(r,c){return this.fromArray(r.elements,3*c)}setFromEuler(r){return this.x=r._x,this.y=r._y,this.z=r._z,this}setFromColor(r){return this.x=r.r,this.y=r.g,this.z=r.b,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z}fromArray(r,c=0){return this.x=r[c],this.y=r[c+1],this.z=r[c+2],this}toArray(r=[],c=0){return r[c]=this.x,r[c+1]=this.y,r[c+2]=this.z,r}fromBufferAttribute(r,c){return this.x=r.getX(c),this.y=r.getY(c),this.z=r.getZ(c),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const r=2*(Math.random()-.5),c=Math.random()*Math.PI*2,p=Math.sqrt(1-r**2);return this.x=p*Math.cos(c),this.y=p*Math.sin(c),this.z=r,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const wf=new ze,Ef=new Fa;class nl{constructor(r=new ze(1/0,1/0,1/0),c=new ze(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=c}set(r,c){return this.min.copy(r),this.max.copy(c),this}setFromArray(r){this.makeEmpty();for(let c=0,p=r.length;c<p;c+=3)this.expandByPoint(Js.fromArray(r,c));return this}setFromBufferAttribute(r){this.makeEmpty();for(let c=0,p=r.count;c<p;c++)this.expandByPoint(Js.fromBufferAttribute(r,c));return this}setFromPoints(r){this.makeEmpty();for(let c=0,p=r.length;c<p;c++)this.expandByPoint(r[c]);return this}setFromCenterAndSize(r,c){const p=Js.copy(c).multiplyScalar(.5);return this.min.copy(r).sub(p),this.max.copy(r).add(p),this}setFromObject(r,c=!1){return this.makeEmpty(),this.expandByObject(r,c)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,c=!1){if(r.updateWorldMatrix(!1,!1),r.boundingBox!==void 0)r.boundingBox===null&&r.computeBoundingBox(),Jr.copy(r.boundingBox),Jr.applyMatrix4(r.matrixWorld),this.union(Jr);else{const m=r.geometry;if(m!==void 0)if(c&&m.attributes!==void 0&&m.attributes.position!==void 0){const _=m.attributes.position;for(let x=0,S=_.count;x<S;x++)Js.fromBufferAttribute(_,x).applyMatrix4(r.matrixWorld),this.expandByPoint(Js)}else m.boundingBox===null&&m.computeBoundingBox(),Jr.copy(m.boundingBox),Jr.applyMatrix4(r.matrixWorld),this.union(Jr)}const p=r.children;for(let m=0,_=p.length;m<_;m++)this.expandByObject(p[m],c);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,c){return c.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,Js),Js.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let c,p;return r.normal.x>0?(c=r.normal.x*this.min.x,p=r.normal.x*this.max.x):(c=r.normal.x*this.max.x,p=r.normal.x*this.min.x),r.normal.y>0?(c+=r.normal.y*this.min.y,p+=r.normal.y*this.max.y):(c+=r.normal.y*this.max.y,p+=r.normal.y*this.min.y),r.normal.z>0?(c+=r.normal.z*this.min.z,p+=r.normal.z*this.max.z):(c+=r.normal.z*this.max.z,p+=r.normal.z*this.min.z),c<=-r.constant&&p>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(Xd),wu.subVectors(this.max,Xd),xu.subVectors(r.a,Xd),Ro.subVectors(r.b,Xd),Us.subVectors(r.c,Xd),ws.subVectors(Ro,xu),jc.subVectors(Us,Ro),pc.subVectors(xu,Us);let c=[0,-ws.z,ws.y,0,-jc.z,jc.y,0,-pc.z,pc.y,ws.z,0,-ws.x,jc.z,0,-jc.x,pc.z,0,-pc.x,-ws.y,ws.x,0,-jc.y,jc.x,0,-pc.y,pc.x,0];return!!Vc(c,xu,Ro,Us,wu)&&(c=[1,0,0,0,1,0,0,0,1],!!Vc(c,xu,Ro,Us,wu)&&(Eu.crossVectors(ws,jc),c=[Eu.x,Eu.y,Eu.z],Vc(c,xu,Ro,Us,wu)))}clampPoint(r,c){return c.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,Js).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=.5*this.getSize(Js).length()),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()||(Cl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),Cl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),Cl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),Cl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),Cl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),Cl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),Cl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),Cl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(Cl)),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}const Cl=[new ze,new ze,new ze,new ze,new ze,new ze,new ze,new ze],Js=new ze,Jr=new nl,xu=new ze,Ro=new ze,Us=new ze,ws=new ze,jc=new ze,pc=new ze,Xd=new ze,wu=new ze,Eu=new ze,Tl=new ze;function Vc(b,r,c,p,m){for(let _=0,x=b.length-3;_<=x;_+=3){Tl.fromArray(b,_);const S=m.x*Math.abs(Tl.x)+m.y*Math.abs(Tl.y)+m.z*Math.abs(Tl.z),B=r.dot(Tl),D=c.dot(Tl),U=p.dot(Tl);if(Math.max(-Math.max(B,D,U),Math.min(B,D,U))>S)return!1}return!0}const Sf=new nl,Yd=new ze,Gm=new ze;class Do{constructor(r=new ze,c=-1){this.center=r,this.radius=c}set(r,c){return this.center.copy(r),this.radius=c,this}setFromPoints(r,c){const p=this.center;c!==void 0?p.copy(c):Sf.setFromPoints(r).getCenter(p);let m=0;for(let _=0,x=r.length;_<x;_++)m=Math.max(m,p.distanceToSquared(r[_]));return this.radius=Math.sqrt(m),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const c=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=c*c}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,c){const p=this.center.distanceToSquared(r);return c.copy(r),p>this.radius*this.radius&&(c.sub(this.center).normalize(),c.multiplyScalar(this.radius).add(this.center)),c}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;Yd.subVectors(r,this.center);const c=Yd.lengthSq();if(c>this.radius*this.radius){const p=Math.sqrt(c),m=.5*(p-this.radius);this.center.addScaledVector(Yd,m/p),this.radius+=m}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(Gm.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(Yd.copy(r.center).add(Gm)),this.expandByPoint(Yd.copy(r.center).sub(Gm))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}}const fc=new ze,Mf=new ze,Su=new ze,il=new ze,Kd=new ze,Th=new ze,Jd=new ze;class Mu{constructor(r=new ze,c=new ze(0,0,-1)){this.origin=r,this.direction=c}set(r,c){return this.origin.copy(r),this.direction.copy(c),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,c){return c.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,fc)),this}closestPointToPoint(r,c){c.subVectors(r,this.origin);const p=c.dot(this.direction);return p<0?c.copy(this.origin):c.copy(this.origin).addScaledVector(this.direction,p)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const c=fc.subVectors(r,this.origin).dot(this.direction);return c<0?this.origin.distanceToSquared(r):(fc.copy(this.origin).addScaledVector(this.direction,c),fc.distanceToSquared(r))}distanceSqToSegment(r,c,p,m){Mf.copy(r).add(c).multiplyScalar(.5),Su.copy(c).sub(r).normalize(),il.copy(this.origin).sub(Mf);const _=.5*r.distanceTo(c),x=-this.direction.dot(Su),S=il.dot(this.direction),B=-il.dot(Su),D=il.lengthSq(),U=Math.abs(1-x*x);let G,V,Q,q;if(U>0)if(G=x*B-S,V=x*S-B,q=_*U,G>=0)if(V>=-q)if(V<=q){const te=1/U;G*=te,V*=te,Q=G*(G+x*V+2*S)+V*(x*G+V+2*B)+D}else V=_,G=Math.max(0,-(x*V+S)),Q=-G*G+V*(V+2*B)+D;else V=-_,G=Math.max(0,-(x*V+S)),Q=-G*G+V*(V+2*B)+D;else V<=-q?(G=Math.max(0,-(-x*_+S)),V=G>0?-_:Math.min(Math.max(-_,-B),_),Q=-G*G+V*(V+2*B)+D):V<=q?(G=0,V=Math.min(Math.max(-_,-B),_),Q=V*(V+2*B)+D):(G=Math.max(0,-(x*_+S)),V=G>0?_:Math.min(Math.max(-_,-B),_),Q=-G*G+V*(V+2*B)+D);else V=x>0?-_:_,G=Math.max(0,-(x*V+S)),Q=-G*G+V*(V+2*B)+D;return p&&p.copy(this.origin).addScaledVector(this.direction,G),m&&m.copy(Mf).addScaledVector(Su,V),Q}intersectSphere(r,c){fc.subVectors(r.center,this.origin);const p=fc.dot(this.direction),m=fc.dot(fc)-p*p,_=r.radius*r.radius;if(m>_)return null;const x=Math.sqrt(_-m),S=p-x,B=p+x;return B<0?null:S<0?this.at(B,c):this.at(S,c)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const c=r.normal.dot(this.direction);if(c===0)return r.distanceToPoint(this.origin)===0?0:null;const p=-(this.origin.dot(r.normal)+r.constant)/c;return p>=0?p:null}intersectPlane(r,c){const p=this.distanceToPlane(r);return p===null?null:this.at(p,c)}intersectsPlane(r){const c=r.distanceToPoint(this.origin);return c===0||r.normal.dot(this.direction)*c<0}intersectBox(r,c){let p,m,_,x,S,B;const D=1/this.direction.x,U=1/this.direction.y,G=1/this.direction.z,V=this.origin;return D>=0?(p=(r.min.x-V.x)*D,m=(r.max.x-V.x)*D):(p=(r.max.x-V.x)*D,m=(r.min.x-V.x)*D),U>=0?(_=(r.min.y-V.y)*U,x=(r.max.y-V.y)*U):(_=(r.max.y-V.y)*U,x=(r.min.y-V.y)*U),p>x||_>m?null:((_>p||isNaN(p))&&(p=_),(x<m||isNaN(m))&&(m=x),G>=0?(S=(r.min.z-V.z)*G,B=(r.max.z-V.z)*G):(S=(r.max.z-V.z)*G,B=(r.min.z-V.z)*G),p>B||S>m?null:((S>p||p!=p)&&(p=S),(B<m||m!=m)&&(m=B),m<0?null:this.at(p>=0?p:m,c)))}intersectsBox(r){return this.intersectBox(r,fc)!==null}intersectTriangle(r,c,p,m,_){Kd.subVectors(c,r),Th.subVectors(p,r),Jd.crossVectors(Kd,Th);let x,S=this.direction.dot(Jd);if(S>0){if(m)return null;x=1}else{if(!(S<0))return null;x=-1,S=-S}il.subVectors(this.origin,r);const B=x*this.direction.dot(Th.crossVectors(il,Th));if(B<0)return null;const D=x*this.direction.dot(Kd.cross(il));if(D<0||B+D>S)return null;const U=-x*il.dot(Jd);return U<0?null:this.at(U/S,_)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class _i{constructor(){_i.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(r,c,p,m,_,x,S,B,D,U,G,V,Q,q,te,K){const Z=this.elements;return Z[0]=r,Z[4]=c,Z[8]=p,Z[12]=m,Z[1]=_,Z[5]=x,Z[9]=S,Z[13]=B,Z[2]=D,Z[6]=U,Z[10]=G,Z[14]=V,Z[3]=Q,Z[7]=q,Z[11]=te,Z[15]=K,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new _i().fromArray(this.elements)}copy(r){const c=this.elements,p=r.elements;return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c[4]=p[4],c[5]=p[5],c[6]=p[6],c[7]=p[7],c[8]=p[8],c[9]=p[9],c[10]=p[10],c[11]=p[11],c[12]=p[12],c[13]=p[13],c[14]=p[14],c[15]=p[15],this}copyPosition(r){const c=this.elements,p=r.elements;return c[12]=p[12],c[13]=p[13],c[14]=p[14],this}setFromMatrix3(r){const c=r.elements;return this.set(c[0],c[3],c[6],0,c[1],c[4],c[7],0,c[2],c[5],c[8],0,0,0,0,1),this}extractBasis(r,c,p){return r.setFromMatrixColumn(this,0),c.setFromMatrixColumn(this,1),p.setFromMatrixColumn(this,2),this}makeBasis(r,c,p){return this.set(r.x,c.x,p.x,0,r.y,c.y,p.y,0,r.z,c.z,p.z,0,0,0,0,1),this}extractRotation(r){const c=this.elements,p=r.elements,m=1/Ih.setFromMatrixColumn(r,0).length(),_=1/Ih.setFromMatrixColumn(r,1).length(),x=1/Ih.setFromMatrixColumn(r,2).length();return c[0]=p[0]*m,c[1]=p[1]*m,c[2]=p[2]*m,c[3]=0,c[4]=p[4]*_,c[5]=p[5]*_,c[6]=p[6]*_,c[7]=0,c[8]=p[8]*x,c[9]=p[9]*x,c[10]=p[10]*x,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}makeRotationFromEuler(r){const c=this.elements,p=r.x,m=r.y,_=r.z,x=Math.cos(p),S=Math.sin(p),B=Math.cos(m),D=Math.sin(m),U=Math.cos(_),G=Math.sin(_);if(r.order==="XYZ"){const V=x*U,Q=x*G,q=S*U,te=S*G;c[0]=B*U,c[4]=-B*G,c[8]=D,c[1]=Q+q*D,c[5]=V-te*D,c[9]=-S*B,c[2]=te-V*D,c[6]=q+Q*D,c[10]=x*B}else if(r.order==="YXZ"){const V=B*U,Q=B*G,q=D*U,te=D*G;c[0]=V+te*S,c[4]=q*S-Q,c[8]=x*D,c[1]=x*G,c[5]=x*U,c[9]=-S,c[2]=Q*S-q,c[6]=te+V*S,c[10]=x*B}else if(r.order==="ZXY"){const V=B*U,Q=B*G,q=D*U,te=D*G;c[0]=V-te*S,c[4]=-x*G,c[8]=q+Q*S,c[1]=Q+q*S,c[5]=x*U,c[9]=te-V*S,c[2]=-x*D,c[6]=S,c[10]=x*B}else if(r.order==="ZYX"){const V=x*U,Q=x*G,q=S*U,te=S*G;c[0]=B*U,c[4]=q*D-Q,c[8]=V*D+te,c[1]=B*G,c[5]=te*D+V,c[9]=Q*D-q,c[2]=-D,c[6]=S*B,c[10]=x*B}else if(r.order==="YZX"){const V=x*B,Q=x*D,q=S*B,te=S*D;c[0]=B*U,c[4]=te-V*G,c[8]=q*G+Q,c[1]=G,c[5]=x*U,c[9]=-S*U,c[2]=-D*U,c[6]=Q*G+q,c[10]=V-te*G}else if(r.order==="XZY"){const V=x*B,Q=x*D,q=S*B,te=S*D;c[0]=B*U,c[4]=-G,c[8]=D*U,c[1]=V*G+te,c[5]=x*U,c[9]=Q*G-q,c[2]=q*G-Q,c[6]=S*U,c[10]=te*G+V}return c[3]=0,c[7]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}makeRotationFromQuaternion(r){return this.compose(Li,r,Es)}lookAt(r,c,p){const m=this.elements;return gs.subVectors(r,c),gs.lengthSq()===0&&(gs.z=1),gs.normalize(),va.crossVectors(p,gs),va.lengthSq()===0&&(Math.abs(p.z)===1?gs.x+=1e-4:gs.z+=1e-4,gs.normalize(),va.crossVectors(p,gs)),va.normalize(),Zs.crossVectors(gs,va),m[0]=va.x,m[4]=Zs.x,m[8]=gs.x,m[1]=va.y,m[5]=Zs.y,m[9]=gs.y,m[2]=va.z,m[6]=Zs.z,m[10]=gs.z,this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,c){const p=r.elements,m=c.elements,_=this.elements,x=p[0],S=p[4],B=p[8],D=p[12],U=p[1],G=p[5],V=p[9],Q=p[13],q=p[2],te=p[6],K=p[10],Z=p[14],ae=p[3],ce=p[7],Te=p[11],Ce=p[15],Ie=m[0],Ke=m[4],ct=m[8],Je=m[12],yt=m[1],Ze=m[5],Pt=m[9],kt=m[13],en=m[2],xn=m[6],tn=m[10],Wt=m[14],dn=m[3],pn=m[7],It=m[11],Qt=m[15];return _[0]=x*Ie+S*yt+B*en+D*dn,_[4]=x*Ke+S*Ze+B*xn+D*pn,_[8]=x*ct+S*Pt+B*tn+D*It,_[12]=x*Je+S*kt+B*Wt+D*Qt,_[1]=U*Ie+G*yt+V*en+Q*dn,_[5]=U*Ke+G*Ze+V*xn+Q*pn,_[9]=U*ct+G*Pt+V*tn+Q*It,_[13]=U*Je+G*kt+V*Wt+Q*Qt,_[2]=q*Ie+te*yt+K*en+Z*dn,_[6]=q*Ke+te*Ze+K*xn+Z*pn,_[10]=q*ct+te*Pt+K*tn+Z*It,_[14]=q*Je+te*kt+K*Wt+Z*Qt,_[3]=ae*Ie+ce*yt+Te*en+Ce*dn,_[7]=ae*Ke+ce*Ze+Te*xn+Ce*pn,_[11]=ae*ct+ce*Pt+Te*tn+Ce*It,_[15]=ae*Je+ce*kt+Te*Wt+Ce*Qt,this}multiplyScalar(r){const c=this.elements;return c[0]*=r,c[4]*=r,c[8]*=r,c[12]*=r,c[1]*=r,c[5]*=r,c[9]*=r,c[13]*=r,c[2]*=r,c[6]*=r,c[10]*=r,c[14]*=r,c[3]*=r,c[7]*=r,c[11]*=r,c[15]*=r,this}determinant(){const r=this.elements,c=r[0],p=r[4],m=r[8],_=r[12],x=r[1],S=r[5],B=r[9],D=r[13],U=r[2],G=r[6],V=r[10],Q=r[14];return r[3]*(+_*B*G-m*D*G-_*S*V+p*D*V+m*S*Q-p*B*Q)+r[7]*(+c*B*Q-c*D*V+_*x*V-m*x*Q+m*D*U-_*B*U)+r[11]*(+c*D*G-c*S*Q-_*x*G+p*x*Q+_*S*U-p*D*U)+r[15]*(-m*S*U-c*B*G+c*S*V+m*x*G-p*x*V+p*B*U)}transpose(){const r=this.elements;let c;return c=r[1],r[1]=r[4],r[4]=c,c=r[2],r[2]=r[8],r[8]=c,c=r[6],r[6]=r[9],r[9]=c,c=r[3],r[3]=r[12],r[12]=c,c=r[7],r[7]=r[13],r[13]=c,c=r[11],r[11]=r[14],r[14]=c,this}setPosition(r,c,p){const m=this.elements;return r.isVector3?(m[12]=r.x,m[13]=r.y,m[14]=r.z):(m[12]=r,m[13]=c,m[14]=p),this}invert(){const r=this.elements,c=r[0],p=r[1],m=r[2],_=r[3],x=r[4],S=r[5],B=r[6],D=r[7],U=r[8],G=r[9],V=r[10],Q=r[11],q=r[12],te=r[13],K=r[14],Z=r[15],ae=G*K*D-te*V*D+te*B*Q-S*K*Q-G*B*Z+S*V*Z,ce=q*V*D-U*K*D-q*B*Q+x*K*Q+U*B*Z-x*V*Z,Te=U*te*D-q*G*D+q*S*Q-x*te*Q-U*S*Z+x*G*Z,Ce=q*G*B-U*te*B-q*S*V+x*te*V+U*S*K-x*G*K,Ie=c*ae+p*ce+m*Te+_*Ce;if(Ie===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ke=1/Ie;return r[0]=ae*Ke,r[1]=(te*V*_-G*K*_-te*m*Q+p*K*Q+G*m*Z-p*V*Z)*Ke,r[2]=(S*K*_-te*B*_+te*m*D-p*K*D-S*m*Z+p*B*Z)*Ke,r[3]=(G*B*_-S*V*_-G*m*D+p*V*D+S*m*Q-p*B*Q)*Ke,r[4]=ce*Ke,r[5]=(U*K*_-q*V*_+q*m*Q-c*K*Q-U*m*Z+c*V*Z)*Ke,r[6]=(q*B*_-x*K*_-q*m*D+c*K*D+x*m*Z-c*B*Z)*Ke,r[7]=(x*V*_-U*B*_+U*m*D-c*V*D-x*m*Q+c*B*Q)*Ke,r[8]=Te*Ke,r[9]=(q*G*_-U*te*_-q*p*Q+c*te*Q+U*p*Z-c*G*Z)*Ke,r[10]=(x*te*_-q*S*_+q*p*D-c*te*D-x*p*Z+c*S*Z)*Ke,r[11]=(U*S*_-x*G*_-U*p*D+c*G*D+x*p*Q-c*S*Q)*Ke,r[12]=Ce*Ke,r[13]=(U*te*m-q*G*m+q*p*V-c*te*V-U*p*K+c*G*K)*Ke,r[14]=(q*S*m-x*te*m-q*p*B+c*te*B+x*p*K-c*S*K)*Ke,r[15]=(x*G*m-U*S*m+U*p*B-c*G*B-x*p*V+c*S*V)*Ke,this}scale(r){const c=this.elements,p=r.x,m=r.y,_=r.z;return c[0]*=p,c[4]*=m,c[8]*=_,c[1]*=p,c[5]*=m,c[9]*=_,c[2]*=p,c[6]*=m,c[10]*=_,c[3]*=p,c[7]*=m,c[11]*=_,this}getMaxScaleOnAxis(){const r=this.elements,c=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=r[4]*r[4]+r[5]*r[5]+r[6]*r[6],m=r[8]*r[8]+r[9]*r[9]+r[10]*r[10];return Math.sqrt(Math.max(c,p,m))}makeTranslation(r,c,p){return this.set(1,0,0,r,0,1,0,c,0,0,1,p,0,0,0,1),this}makeRotationX(r){const c=Math.cos(r),p=Math.sin(r);return this.set(1,0,0,0,0,c,-p,0,0,p,c,0,0,0,0,1),this}makeRotationY(r){const c=Math.cos(r),p=Math.sin(r);return this.set(c,0,p,0,0,1,0,0,-p,0,c,0,0,0,0,1),this}makeRotationZ(r){const c=Math.cos(r),p=Math.sin(r);return this.set(c,-p,0,0,p,c,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(r,c){const p=Math.cos(c),m=Math.sin(c),_=1-p,x=r.x,S=r.y,B=r.z,D=_*x,U=_*S;return this.set(D*x+p,D*S-m*B,D*B+m*S,0,D*S+m*B,U*S+p,U*B-m*x,0,D*B-m*S,U*B+m*x,_*B*B+p,0,0,0,0,1),this}makeScale(r,c,p){return this.set(r,0,0,0,0,c,0,0,0,0,p,0,0,0,0,1),this}makeShear(r,c,p,m,_,x){return this.set(1,p,_,0,r,1,x,0,c,m,1,0,0,0,0,1),this}compose(r,c,p){const m=this.elements,_=c._x,x=c._y,S=c._z,B=c._w,D=_+_,U=x+x,G=S+S,V=_*D,Q=_*U,q=_*G,te=x*U,K=x*G,Z=S*G,ae=B*D,ce=B*U,Te=B*G,Ce=p.x,Ie=p.y,Ke=p.z;return m[0]=(1-(te+Z))*Ce,m[1]=(Q+Te)*Ce,m[2]=(q-ce)*Ce,m[3]=0,m[4]=(Q-Te)*Ie,m[5]=(1-(V+Z))*Ie,m[6]=(K+ae)*Ie,m[7]=0,m[8]=(q+ce)*Ke,m[9]=(K-ae)*Ke,m[10]=(1-(V+te))*Ke,m[11]=0,m[12]=r.x,m[13]=r.y,m[14]=r.z,m[15]=1,this}decompose(r,c,p){const m=this.elements;let _=Ih.set(m[0],m[1],m[2]).length();const x=Ih.set(m[4],m[5],m[6]).length(),S=Ih.set(m[8],m[9],m[10]).length();this.determinant()<0&&(_=-_),r.x=m[12],r.y=m[13],r.z=m[14],Bo.copy(this);const B=1/_,D=1/x,U=1/S;return Bo.elements[0]*=B,Bo.elements[1]*=B,Bo.elements[2]*=B,Bo.elements[4]*=D,Bo.elements[5]*=D,Bo.elements[6]*=D,Bo.elements[8]*=U,Bo.elements[9]*=U,Bo.elements[10]*=U,c.setFromRotationMatrix(Bo),p.x=_,p.y=x,p.z=S,this}makePerspective(r,c,p,m,_,x){const S=this.elements,B=2*_/(c-r),D=2*_/(p-m),U=(c+r)/(c-r),G=(p+m)/(p-m),V=-(x+_)/(x-_),Q=-2*x*_/(x-_);return S[0]=B,S[4]=0,S[8]=U,S[12]=0,S[1]=0,S[5]=D,S[9]=G,S[13]=0,S[2]=0,S[6]=0,S[10]=V,S[14]=Q,S[3]=0,S[7]=0,S[11]=-1,S[15]=0,this}makeOrthographic(r,c,p,m,_,x){const S=this.elements,B=1/(c-r),D=1/(p-m),U=1/(x-_),G=(c+r)*B,V=(p+m)*D,Q=(x+_)*U;return S[0]=2*B,S[4]=0,S[8]=0,S[12]=-G,S[1]=0,S[5]=2*D,S[9]=0,S[13]=-V,S[2]=0,S[6]=0,S[10]=-2*U,S[14]=-Q,S[3]=0,S[7]=0,S[11]=0,S[15]=1,this}equals(r){const c=this.elements,p=r.elements;for(let m=0;m<16;m++)if(c[m]!==p[m])return!1;return!0}fromArray(r,c=0){for(let p=0;p<16;p++)this.elements[p]=r[p+c];return this}toArray(r=[],c=0){const p=this.elements;return r[c]=p[0],r[c+1]=p[1],r[c+2]=p[2],r[c+3]=p[3],r[c+4]=p[4],r[c+5]=p[5],r[c+6]=p[6],r[c+7]=p[7],r[c+8]=p[8],r[c+9]=p[9],r[c+10]=p[10],r[c+11]=p[11],r[c+12]=p[12],r[c+13]=p[13],r[c+14]=p[14],r[c+15]=p[15],r}}const Ih=new ze,Bo=new _i,Li=new ze(0,0,0),Es=new ze(1,1,1),va=new ze,Zs=new ze,gs=new ze,Ph=new _i,Zd=new Fa;class Cu{constructor(r=0,c=0,p=0,m=Cu.DEFAULT_ORDER){this.isEuler=!0,this._x=r,this._y=c,this._z=p,this._order=m}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get order(){return this._order}set order(r){this._order=r,this._onChangeCallback()}set(r,c,p,m=this._order){return this._x=r,this._y=c,this._z=p,this._order=m,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(r){return this._x=r._x,this._y=r._y,this._z=r._z,this._order=r._order,this._onChangeCallback(),this}setFromRotationMatrix(r,c=this._order,p=!0){const m=r.elements,_=m[0],x=m[4],S=m[8],B=m[1],D=m[5],U=m[9],G=m[2],V=m[6],Q=m[10];switch(c){case"XYZ":this._y=Math.asin(Hn(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(-U,Q),this._z=Math.atan2(-x,_)):(this._x=Math.atan2(V,D),this._z=0);break;case"YXZ":this._x=Math.asin(-Hn(U,-1,1)),Math.abs(U)<.9999999?(this._y=Math.atan2(S,Q),this._z=Math.atan2(B,D)):(this._y=Math.atan2(-G,_),this._z=0);break;case"ZXY":this._x=Math.asin(Hn(V,-1,1)),Math.abs(V)<.9999999?(this._y=Math.atan2(-G,Q),this._z=Math.atan2(-x,D)):(this._y=0,this._z=Math.atan2(B,_));break;case"ZYX":this._y=Math.asin(-Hn(G,-1,1)),Math.abs(G)<.9999999?(this._x=Math.atan2(V,Q),this._z=Math.atan2(B,_)):(this._x=0,this._z=Math.atan2(-x,D));break;case"YZX":this._z=Math.asin(Hn(B,-1,1)),Math.abs(B)<.9999999?(this._x=Math.atan2(-U,D),this._y=Math.atan2(-G,_)):(this._x=0,this._y=Math.atan2(S,Q));break;case"XZY":this._z=Math.asin(-Hn(x,-1,1)),Math.abs(x)<.9999999?(this._x=Math.atan2(V,D),this._y=Math.atan2(S,_)):(this._x=Math.atan2(-U,Q),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+c)}return this._order=c,p===!0&&this._onChangeCallback(),this}setFromQuaternion(r,c,p){return Ph.makeRotationFromQuaternion(r),this.setFromRotationMatrix(Ph,c,p)}setFromVector3(r,c=this._order){return this.set(r.x,r.y,r.z,c)}reorder(r){return Zd.setFromEuler(this),this.setFromQuaternion(Zd,r)}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._order===this._order}fromArray(r){return this._x=r[0],this._y=r[1],this._z=r[2],r[3]!==void 0&&(this._order=r[3]),this._onChangeCallback(),this}toArray(r=[],c=0){return r[c]=this._x,r[c+1]=this._y,r[c+2]=this._z,r[c+3]=this._order,r}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Cu.DEFAULT_ORDER="XYZ";class Tu{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!=0}isEnabled(r){return(this.mask&(1<<r|0))!=0}}let Cf=0;const Il=new ze,Gc=new Fa,$s=new _i,Hc=new ze,Oi=new ze,Iu=new ze,io=new Fa,Pl=new ze(1,0,0),Pu=new ze(0,1,0),Qc=new ze(0,0,1),Hm={type:"added"},Qm={type:"removed"};class Vi extends tl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Cf++}),this.uuid=Ua(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Vi.DEFAULT_UP.clone();const r=new ze,c=new Cu,p=new Fa,m=new ze(1,1,1);c._onChange(function(){p.setFromEuler(c,!1)}),p._onChange(function(){c.setFromQuaternion(p,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:c},quaternion:{configurable:!0,enumerable:!0,value:p},scale:{configurable:!0,enumerable:!0,value:m},modelViewMatrix:{value:new _i},normalMatrix:{value:new Ai}}),this.matrix=new _i,this.matrixWorld=new _i,this.matrixAutoUpdate=Vi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Vi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Tu,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(r,c,p,m,_,x){this.dispatchEvent({type:"beforeRender",renderer:r,scene:c,camera:p,geometry:m,material:_,group:x})}onAfterRender(){}applyMatrix4(r){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(r),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(r){return this.quaternion.premultiply(r),this}setRotationFromAxisAngle(r,c){this.quaternion.setFromAxisAngle(r,c)}setRotationFromEuler(r){this.quaternion.setFromEuler(r,!0)}setRotationFromMatrix(r){this.quaternion.setFromRotationMatrix(r)}setRotationFromQuaternion(r){this.quaternion.copy(r)}rotateOnAxis(r,c){return Gc.setFromAxisAngle(r,c),this.quaternion.multiply(Gc),this}rotateOnWorldAxis(r,c){return Gc.setFromAxisAngle(r,c),this.quaternion.premultiply(Gc),this}rotateX(r){return this.rotateOnAxis(Pl,r)}rotateY(r){return this.rotateOnAxis(Pu,r)}rotateZ(r){return this.rotateOnAxis(Qc,r)}translateOnAxis(r,c){return Il.copy(r).applyQuaternion(this.quaternion),this.position.add(Il.multiplyScalar(c)),this}translateX(r){return this.translateOnAxis(Pl,r)}translateY(r){return this.translateOnAxis(Pu,r)}translateZ(r){return this.translateOnAxis(Qc,r)}localToWorld(r){return this.updateWorldMatrix(!0,!1),r.applyMatrix4(this.matrixWorld)}worldToLocal(r){return this.updateWorldMatrix(!0,!1),r.applyMatrix4($s.copy(this.matrixWorld).invert())}lookAt(r,c,p){r.isVector3?Hc.copy(r):Hc.set(r,c,p);const m=this.parent;this.updateWorldMatrix(!0,!1),Oi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$s.lookAt(Oi,Hc,this.up):$s.lookAt(Hc,Oi,this.up),this.quaternion.setFromRotationMatrix($s),m&&($s.extractRotation(m.matrixWorld),Gc.setFromRotationMatrix($s),this.quaternion.premultiply(Gc.invert()))}add(r){if(arguments.length>1){for(let c=0;c<arguments.length;c++)this.add(arguments[c]);return this}return r===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",r),this):(r&&r.isObject3D?(r.parent!==null&&r.parent.remove(r),r.parent=this,this.children.push(r),r.dispatchEvent(Hm)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",r),this)}remove(r){if(arguments.length>1){for(let p=0;p<arguments.length;p++)this.remove(arguments[p]);return this}const c=this.children.indexOf(r);return c!==-1&&(r.parent=null,this.children.splice(c,1),r.dispatchEvent(Qm)),this}removeFromParent(){const r=this.parent;return r!==null&&r.remove(this),this}clear(){for(let r=0;r<this.children.length;r++){const c=this.children[r];c.parent=null,c.dispatchEvent(Qm)}return this.children.length=0,this}attach(r){return this.updateWorldMatrix(!0,!1),$s.copy(this.matrixWorld).invert(),r.parent!==null&&(r.parent.updateWorldMatrix(!0,!1),$s.multiply(r.parent.matrixWorld)),r.applyMatrix4($s),this.add(r),r.updateWorldMatrix(!1,!0),this}getObjectById(r){return this.getObjectByProperty("id",r)}getObjectByName(r){return this.getObjectByProperty("name",r)}getObjectByProperty(r,c){if(this[r]===c)return this;for(let p=0,m=this.children.length;p<m;p++){const _=this.children[p].getObjectByProperty(r,c);if(_!==void 0)return _}}getObjectsByProperty(r,c){let p=[];this[r]===c&&p.push(this);for(let m=0,_=this.children.length;m<_;m++){const x=this.children[m].getObjectsByProperty(r,c);x.length>0&&(p=p.concat(x))}return p}getWorldPosition(r){return this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Oi,r,Iu),r}getWorldScale(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Oi,io,r),r}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const c=this.matrixWorld.elements;return r.set(c[8],c[9],c[10]).normalize()}raycast(){}traverse(r){r(this);const c=this.children;for(let p=0,m=c.length;p<m;p++)c[p].traverse(r)}traverseVisible(r){if(this.visible===!1)return;r(this);const c=this.children;for(let p=0,m=c.length;p<m;p++)c[p].traverseVisible(r)}traverseAncestors(r){const c=this.parent;c!==null&&(r(c),c.traverseAncestors(r))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,r=!0);const c=this.children;for(let p=0,m=c.length;p<m;p++){const _=c[p];_.matrixWorldAutoUpdate!==!0&&r!==!0||_.updateMatrixWorld(r)}}updateWorldMatrix(r,c){const p=this.parent;if(r===!0&&p!==null&&p.matrixWorldAutoUpdate===!0&&p.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),c===!0){const m=this.children;for(let _=0,x=m.length;_<x;_++){const S=m[_];S.matrixWorldAutoUpdate===!0&&S.updateWorldMatrix(!1,!0)}}}toJSON(r){const c=r===void 0||typeof r=="string",p={};c&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},p.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const m={};function _(S,B){return S[B.uuid]===void 0&&(S[B.uuid]=B.toJSON(r)),B.uuid}if(m.uuid=this.uuid,m.type=this.type,this.name!==""&&(m.name=this.name),this.castShadow===!0&&(m.castShadow=!0),this.receiveShadow===!0&&(m.receiveShadow=!0),this.visible===!1&&(m.visible=!1),this.frustumCulled===!1&&(m.frustumCulled=!1),this.renderOrder!==0&&(m.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(m.userData=this.userData),m.layers=this.layers.mask,m.matrix=this.matrix.toArray(),m.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(m.matrixAutoUpdate=!1),this.isInstancedMesh&&(m.type="InstancedMesh",m.count=this.count,m.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(m.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?m.background=this.background.toJSON():this.background.isTexture&&(m.background=this.background.toJSON(r).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(m.environment=this.environment.toJSON(r).uuid);else if(this.isMesh||this.isLine||this.isPoints){m.geometry=_(r.geometries,this.geometry);const S=this.geometry.parameters;if(S!==void 0&&S.shapes!==void 0){const B=S.shapes;if(Array.isArray(B))for(let D=0,U=B.length;D<U;D++){const G=B[D];_(r.shapes,G)}else _(r.shapes,B)}}if(this.isSkinnedMesh&&(m.bindMode=this.bindMode,m.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(_(r.skeletons,this.skeleton),m.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const S=[];for(let B=0,D=this.material.length;B<D;B++)S.push(_(r.materials,this.material[B]));m.material=S}else m.material=_(r.materials,this.material);if(this.children.length>0){m.children=[];for(let S=0;S<this.children.length;S++)m.children.push(this.children[S].toJSON(r).object)}if(this.animations.length>0){m.animations=[];for(let S=0;S<this.animations.length;S++){const B=this.animations[S];m.animations.push(_(r.animations,B))}}if(c){const S=x(r.geometries),B=x(r.materials),D=x(r.textures),U=x(r.images),G=x(r.shapes),V=x(r.skeletons),Q=x(r.animations),q=x(r.nodes);S.length>0&&(p.geometries=S),B.length>0&&(p.materials=B),D.length>0&&(p.textures=D),U.length>0&&(p.images=U),G.length>0&&(p.shapes=G),V.length>0&&(p.skeletons=V),Q.length>0&&(p.animations=Q),q.length>0&&(p.nodes=q)}return p.object=m,p;function x(S){const B=[];for(const D in S){const U=S[D];delete U.metadata,B.push(U)}return B}}clone(r){return new this.constructor().copy(this,r)}copy(r,c=!0){this.name=r.name,this.up.copy(r.up),this.position.copy(r.position),this.rotation.order=r.rotation.order,this.quaternion.copy(r.quaternion),this.scale.copy(r.scale),this.matrix.copy(r.matrix),this.matrixWorld.copy(r.matrixWorld),this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrixWorldNeedsUpdate=r.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=r.matrixWorldAutoUpdate,this.layers.mask=r.layers.mask,this.visible=r.visible,this.castShadow=r.castShadow,this.receiveShadow=r.receiveShadow,this.frustumCulled=r.frustumCulled,this.renderOrder=r.renderOrder,this.animations=r.animations,this.userData={};for(const[p,m]of Object.entries(r.userData))this.userData[p]=!m||m&&(m.isTexture||m.isObject3D)?m:JSON.parse(JSON.stringify(m));if(c===!0)for(let p=0;p<r.children.length;p++){const m=r.children[p];this.add(m.clone())}return this}}Vi.DEFAULT_UP=new ze(0,1,0),Vi.DEFAULT_MATRIX_AUTO_UPDATE=!0,Vi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ea=new ze,ss=new ze,rl=new ze,za=new ze,Ns=new ze,Rl=new ze,sl=new ze,Wc=new ze,Dl=new ze,Ru=new ze;let Rh=!1;class Zr{constructor(r=new ze,c=new ze,p=new ze){this.a=r,this.b=c,this.c=p}static getNormal(r,c,p,m){m.subVectors(p,c),ea.subVectors(r,c),m.cross(ea);const _=m.lengthSq();return _>0?m.multiplyScalar(1/Math.sqrt(_)):m.set(0,0,0)}static getBarycoord(r,c,p,m,_){ea.subVectors(m,c),ss.subVectors(p,c),rl.subVectors(r,c);const x=ea.dot(ea),S=ea.dot(ss),B=ea.dot(rl),D=ss.dot(ss),U=ss.dot(rl),G=x*D-S*S;if(G===0)return _.set(-2,-1,-1);const V=1/G,Q=(D*B-S*U)*V,q=(x*U-S*B)*V;return _.set(1-Q-q,q,Q)}static containsPoint(r,c,p,m){return this.getBarycoord(r,c,p,m,za),za.x>=0&&za.y>=0&&za.x+za.y<=1}static getUV(r,c,p,m,_,x,S,B){return Rh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Rh=!0),this.getInterpolation(r,c,p,m,_,x,S,B)}static getInterpolation(r,c,p,m,_,x,S,B){return this.getBarycoord(r,c,p,m,za),B.setScalar(0),B.addScaledVector(_,za.x),B.addScaledVector(x,za.y),B.addScaledVector(S,za.z),B}static isFrontFacing(r,c,p,m){return ea.subVectors(p,c),ss.subVectors(r,c),ea.cross(ss).dot(m)<0}set(r,c,p){return this.a.copy(r),this.b.copy(c),this.c.copy(p),this}setFromPointsAndIndices(r,c,p,m){return this.a.copy(r[c]),this.b.copy(r[p]),this.c.copy(r[m]),this}setFromAttributeAndIndices(r,c,p,m){return this.a.fromBufferAttribute(r,c),this.b.fromBufferAttribute(r,p),this.c.fromBufferAttribute(r,m),this}clone(){return new this.constructor().copy(this)}copy(r){return this.a.copy(r.a),this.b.copy(r.b),this.c.copy(r.c),this}getArea(){return ea.subVectors(this.c,this.b),ss.subVectors(this.a,this.b),.5*ea.cross(ss).length()}getMidpoint(r){return r.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(r){return Zr.getNormal(this.a,this.b,this.c,r)}getPlane(r){return r.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(r,c){return Zr.getBarycoord(r,this.a,this.b,this.c,c)}getUV(r,c,p,m,_){return Rh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Rh=!0),Zr.getInterpolation(r,this.a,this.b,this.c,c,p,m,_)}getInterpolation(r,c,p,m,_){return Zr.getInterpolation(r,this.a,this.b,this.c,c,p,m,_)}containsPoint(r){return Zr.containsPoint(r,this.a,this.b,this.c)}isFrontFacing(r){return Zr.isFrontFacing(this.a,this.b,this.c,r)}intersectsBox(r){return r.intersectsTriangle(this)}closestPointToPoint(r,c){const p=this.a,m=this.b,_=this.c;let x,S;Ns.subVectors(m,p),Rl.subVectors(_,p),Wc.subVectors(r,p);const B=Ns.dot(Wc),D=Rl.dot(Wc);if(B<=0&&D<=0)return c.copy(p);Dl.subVectors(r,m);const U=Ns.dot(Dl),G=Rl.dot(Dl);if(U>=0&&G<=U)return c.copy(m);const V=B*G-U*D;if(V<=0&&B>=0&&U<=0)return x=B/(B-U),c.copy(p).addScaledVector(Ns,x);Ru.subVectors(r,_);const Q=Ns.dot(Ru),q=Rl.dot(Ru);if(q>=0&&Q<=q)return c.copy(_);const te=Q*D-B*q;if(te<=0&&D>=0&&q<=0)return S=D/(D-q),c.copy(p).addScaledVector(Rl,S);const K=U*q-Q*G;if(K<=0&&G-U>=0&&Q-q>=0)return sl.subVectors(_,m),S=(G-U)/(G-U+(Q-q)),c.copy(m).addScaledVector(sl,S);const Z=1/(K+te+V);return x=te*Z,S=V*Z,c.copy(p).addScaledVector(Ns,x).addScaledVector(Rl,S)}equals(r){return r.a.equals(this.a)&&r.b.equals(this.b)&&r.c.equals(this.c)}}let Dh=0;class Ss extends tl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Dh++}),this.uuid=Ua(),this.name="",this.type="Material",this.blending=et,this.side=Pe,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Mt,this.blendDst=At,this.blendEquation=le,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=tt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=bh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ga,this.stencilZFail=ga,this.stencilZPass=ga,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const c in r){const p=r[c];if(p===void 0){console.warn(`THREE.Material: parameter '${c}' has value of undefined.`);continue}const m=this[c];m!==void 0&&(m&&m.isColor?m.set(p):m&&m.isVector3&&p&&p.isVector3?m.copy(p):Array.isArray(p)&&m&&typeof m.fromArray=="function"?m.fromArray(p):this[c]=p)}}toJSON(r){const c=r===void 0||typeof r=="string";c&&(r={textures:{},images:{}});const p={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function m(_){const x=[];for(const S in _){const B=_[S];delete B.metadata,x.push(B)}return x}if(p.uuid=this.uuid,p.type=this.type,this.name!==""&&(p.name=this.name),this.color&&this.color.isColor&&(p.color=this.color.getHex()),this.roughness!==void 0&&(p.roughness=this.roughness),this.metalness!==void 0&&(p.metalness=this.metalness),this.sheen!==void 0&&(p.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(p.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(p.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(p.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(p.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(p.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(p.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(p.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(p.shininess=this.shininess),this.clearcoat!==void 0&&(p.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(p.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(p.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(p.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(p.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,p.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(p.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(p.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(p.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(p.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(p.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(p.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(p.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(p.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(p.lightMap=this.lightMap.toJSON(r).uuid,p.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(p.aoMap=this.aoMap.toJSON(r).uuid,p.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(p.bumpMap=this.bumpMap.toJSON(r).uuid,p.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(p.normalMap=this.normalMap.toJSON(r).uuid,p.normalMapType=this.normalMapType,p.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(p.displacementMap=this.displacementMap.toJSON(r).uuid,p.displacementScale=this.displacementScale,p.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(p.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(p.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(p.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(p.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(p.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(p.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(p.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(p.combine=this.combine)),this.envMapIntensity!==void 0&&(p.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(p.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(p.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(p.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(p.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(p.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(p.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(p.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(p.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(p.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(p.size=this.size),this.shadowSide!==null&&(p.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(p.sizeAttenuation=this.sizeAttenuation),this.blending!==et&&(p.blending=this.blending),this.side!==Pe&&(p.side=this.side),this.vertexColors&&(p.vertexColors=!0),this.opacity<1&&(p.opacity=this.opacity),this.transparent===!0&&(p.transparent=this.transparent),p.depthFunc=this.depthFunc,p.depthTest=this.depthTest,p.depthWrite=this.depthWrite,p.colorWrite=this.colorWrite,p.stencilWrite=this.stencilWrite,p.stencilWriteMask=this.stencilWriteMask,p.stencilFunc=this.stencilFunc,p.stencilRef=this.stencilRef,p.stencilFuncMask=this.stencilFuncMask,p.stencilFail=this.stencilFail,p.stencilZFail=this.stencilZFail,p.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(p.rotation=this.rotation),this.polygonOffset===!0&&(p.polygonOffset=!0),this.polygonOffsetFactor!==0&&(p.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(p.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(p.linewidth=this.linewidth),this.dashSize!==void 0&&(p.dashSize=this.dashSize),this.gapSize!==void 0&&(p.gapSize=this.gapSize),this.scale!==void 0&&(p.scale=this.scale),this.dithering===!0&&(p.dithering=!0),this.alphaTest>0&&(p.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(p.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(p.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(p.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(p.wireframe=this.wireframe),this.wireframeLinewidth>1&&(p.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(p.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(p.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(p.flatShading=this.flatShading),this.visible===!1&&(p.visible=!1),this.toneMapped===!1&&(p.toneMapped=!1),this.fog===!1&&(p.fog=!1),Object.keys(this.userData).length>0&&(p.userData=this.userData),c){const _=m(r.textures),x=m(r.images);_.length>0&&(p.textures=_),x.length>0&&(p.images=x)}return p}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const c=r.clippingPlanes;let p=null;if(c!==null){const m=c.length;p=new Array(m);for(let _=0;_!==m;++_)p[_]=c[_].clone()}return this.clippingPlanes=p,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=$d({},r.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}}function $d(b,r){if(!r)return b;for(const c of Object.keys(r)){if(c.startsWith("__")||typeof b[c]=="function"||typeof r[c]=="function")continue;const p=r[c],m=!p||p.isTexture||p.isObject3D||p.isMaterial;m||typeof r[c].clone!="function"?m||typeof r[c]!="object"&&!Array.isArray(r[c])?b[c]=r[c]:b[c]=$d(Array.isArray(r[c])?[]:{},r[c]):b[c]=r[c].clone()}return b}const Bl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vs={h:0,s:0,l:0},ep={h:0,s:0,l:0};function qc(b,r,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?b+6*(r-b)*c:c<.5?r:c<2/3?b+6*(r-b)*(2/3-c):b}class En{constructor(r,c,p){return this.isColor=!0,this.r=1,this.g=1,this.b=1,c===void 0&&p===void 0?this.set(r):this.setRGB(r,c,p)}set(r){return r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r),this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,c=Xn){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(255&r)/255,Tr.toWorkingColorSpace(this,c),this}setRGB(r,c,p,m=Tr.workingColorSpace){return this.r=r,this.g=c,this.b=p,Tr.toWorkingColorSpace(this,m),this}setHSL(r,c,p,m=Tr.workingColorSpace){if(r=wh(r,1),c=Hn(c,0,1),p=Hn(p,0,1),c===0)this.r=this.g=this.b=p;else{const _=p<=.5?p*(1+c):p+c-p*c,x=2*p-_;this.r=qc(x,_,r+1/3),this.g=qc(x,_,r),this.b=qc(x,_,r-1/3)}return Tr.toWorkingColorSpace(this,m),this}setStyle(r,c=Xn){function p(_){_!==void 0&&parseFloat(_)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let m;if(m=/^(\w+)\(([^\)]*)\)/.exec(r)){let _;const x=m[1],S=m[2];switch(x){case"rgb":case"rgba":if(_=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(S))return p(_[4]),this.setRGB(Math.min(255,parseInt(_[1],10))/255,Math.min(255,parseInt(_[2],10))/255,Math.min(255,parseInt(_[3],10))/255,c);if(_=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(S))return p(_[4]),this.setRGB(Math.min(100,parseInt(_[1],10))/100,Math.min(100,parseInt(_[2],10))/100,Math.min(100,parseInt(_[3],10))/100,c);break;case"hsl":case"hsla":if(_=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(S))return p(_[4]),this.setHSL(parseFloat(_[1])/360,parseFloat(_[2])/100,parseFloat(_[3])/100,c);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(m=/^\#([A-Fa-f\d]+)$/.exec(r)){const _=m[1],x=_.length;if(x===3)return this.setRGB(parseInt(_.charAt(0),16)/15,parseInt(_.charAt(1),16)/15,parseInt(_.charAt(2),16)/15,c);if(x===6)return this.setHex(parseInt(_,16),c);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,c);return this}setColorName(r,c=Xn){const p=Bl[r.toLowerCase()];return p!==void 0?this.setHex(p,c):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=bu(r.r),this.g=bu(r.g),this.b=bu(r.b),this}copyLinearToSRGB(r){return this.r=bf(r.r),this.g=bf(r.g),this.b=bf(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=Xn){return Tr.fromWorkingColorSpace(Lr.copy(this),r),65536*Math.round(Hn(255*Lr.r,0,255))+256*Math.round(Hn(255*Lr.g,0,255))+Math.round(Hn(255*Lr.b,0,255))}getHexString(r=Xn){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,c=Tr.workingColorSpace){Tr.fromWorkingColorSpace(Lr.copy(this),c);const p=Lr.r,m=Lr.g,_=Lr.b,x=Math.max(p,m,_),S=Math.min(p,m,_);let B,D;const U=(S+x)/2;if(S===x)B=0,D=0;else{const G=x-S;switch(D=U<=.5?G/(x+S):G/(2-x-S),x){case p:B=(m-_)/G+(m<_?6:0);break;case m:B=(_-p)/G+2;break;case _:B=(p-m)/G+4}B/=6}return r.h=B,r.s=D,r.l=U,r}getRGB(r,c=Tr.workingColorSpace){return Tr.fromWorkingColorSpace(Lr.copy(this),c),r.r=Lr.r,r.g=Lr.g,r.b=Lr.b,r}getStyle(r=Xn){Tr.fromWorkingColorSpace(Lr.copy(this),r);const c=Lr.r,p=Lr.g,m=Lr.b;return r!==Xn?`color(${r} ${c.toFixed(3)} ${p.toFixed(3)} ${m.toFixed(3)})`:`rgb(${Math.round(255*c)},${Math.round(255*p)},${Math.round(255*m)})`}offsetHSL(r,c,p){return this.getHSL(vs),vs.h+=r,vs.s+=c,vs.l+=p,this.setHSL(vs.h,vs.s,vs.l),this}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,c){return this.r=r.r+c.r,this.g=r.g+c.g,this.b=r.b+c.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,c){return this.r+=(r.r-this.r)*c,this.g+=(r.g-this.g)*c,this.b+=(r.b-this.b)*c,this}lerpColors(r,c,p){return this.r=r.r+(c.r-r.r)*p,this.g=r.g+(c.g-r.g)*p,this.b=r.b+(c.b-r.b)*p,this}lerpHSL(r,c){this.getHSL(vs),r.getHSL(ep);const p=Eh(vs.h,ep.h,c),m=Eh(vs.s,ep.s,c),_=Eh(vs.l,ep.l,c);return this.setHSL(p,m,_),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const c=this.r,p=this.g,m=this.b,_=r.elements;return this.r=_[0]*c+_[3]*p+_[6]*m,this.g=_[1]*c+_[4]*p+_[7]*m,this.b=_[2]*c+_[5]*p+_[8]*m,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,c=0){return this.r=r[c],this.g=r[c+1],this.b=r[c+2],this}toArray(r=[],c=0){return r[c]=this.r,r[c+1]=this.g,r[c+2]=this.b,r}fromBufferAttribute(r,c){return this.r=r.getX(c),this.g=r.getY(c),this.b=r.getZ(c),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Lr=new En;En.NAMES=Bl;class Lo extends Ss{constructor(r){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new En(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ci,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}}const Ll=Tf();function Tf(){const b=new ArrayBuffer(4),r=new Float32Array(b),c=new Uint32Array(b),p=new Uint32Array(512),m=new Uint32Array(512);for(let B=0;B<256;++B){const D=B-127;D<-27?(p[B]=0,p[256|B]=32768,m[B]=24,m[256|B]=24):D<-14?(p[B]=1024>>-D-14,p[256|B]=1024>>-D-14|32768,m[B]=-D-1,m[256|B]=-D-1):D<=15?(p[B]=D+15<<10,p[256|B]=D+15<<10|32768,m[B]=13,m[256|B]=13):D<128?(p[B]=31744,p[256|B]=64512,m[B]=24,m[256|B]=24):(p[B]=31744,p[256|B]=64512,m[B]=13,m[256|B]=13)}const _=new Uint32Array(2048),x=new Uint32Array(64),S=new Uint32Array(64);for(let B=1;B<1024;++B){let D=B<<13,U=0;for(;!(8388608&D);)D<<=1,U-=8388608;D&=-8388609,U+=947912704,_[B]=D|U}for(let B=1024;B<2048;++B)_[B]=939524096+(B-1024<<13);for(let B=1;B<31;++B)x[B]=B<<23;x[31]=1199570944,x[32]=2147483648;for(let B=33;B<63;++B)x[B]=2147483648+(B-32<<23);x[63]=3347054592;for(let B=1;B<64;++B)B!==32&&(S[B]=1024);return{floatView:r,uint32View:c,baseTable:p,shiftTable:m,mantissaTable:_,exponentTable:x,offsetTable:S}}function ya(b){Math.abs(b)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),b=Hn(b,-65504,65504),Ll.floatView[0]=b;const r=Ll.uint32View[0],c=r>>23&511;return Ll.baseTable[c]+((8388607&r)>>Ll.shiftTable[c])}function Ol(b){const r=b>>10;return Ll.uint32View[0]=Ll.mantissaTable[Ll.offsetTable[r]+(1023&b)]+Ll.exponentTable[r],Ll.floatView[0]}const Bh={toHalfFloat:ya,fromHalfFloat:Ol},rr=new ze,Lh=new qt;class ur{constructor(r,c,p=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=c,this.count=r!==void 0?r.length/c:0,this.normalized=p,this.usage=el,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this}copyAt(r,c,p){r*=this.itemSize,p*=c.itemSize;for(let m=0,_=this.itemSize;m<_;m++)this.array[r+m]=c.array[p+m];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let c=0,p=this.count;c<p;c++)Lh.fromBufferAttribute(this,c),Lh.applyMatrix3(r),this.setXY(c,Lh.x,Lh.y);else if(this.itemSize===3)for(let c=0,p=this.count;c<p;c++)rr.fromBufferAttribute(this,c),rr.applyMatrix3(r),this.setXYZ(c,rr.x,rr.y,rr.z);return this}applyMatrix4(r){for(let c=0,p=this.count;c<p;c++)rr.fromBufferAttribute(this,c),rr.applyMatrix4(r),this.setXYZ(c,rr.x,rr.y,rr.z);return this}applyNormalMatrix(r){for(let c=0,p=this.count;c<p;c++)rr.fromBufferAttribute(this,c),rr.applyNormalMatrix(r),this.setXYZ(c,rr.x,rr.y,rr.z);return this}transformDirection(r){for(let c=0,p=this.count;c<p;c++)rr.fromBufferAttribute(this,c),rr.transformDirection(r),this.setXYZ(c,rr.x,rr.y,rr.z);return this}set(r,c=0){return this.array.set(r,c),this}getX(r){let c=this.array[r*this.itemSize];return this.normalized&&(c=to(c,this.array)),c}setX(r,c){return this.normalized&&(c=Si(c,this.array)),this.array[r*this.itemSize]=c,this}getY(r){let c=this.array[r*this.itemSize+1];return this.normalized&&(c=to(c,this.array)),c}setY(r,c){return this.normalized&&(c=Si(c,this.array)),this.array[r*this.itemSize+1]=c,this}getZ(r){let c=this.array[r*this.itemSize+2];return this.normalized&&(c=to(c,this.array)),c}setZ(r,c){return this.normalized&&(c=Si(c,this.array)),this.array[r*this.itemSize+2]=c,this}getW(r){let c=this.array[r*this.itemSize+3];return this.normalized&&(c=to(c,this.array)),c}setW(r,c){return this.normalized&&(c=Si(c,this.array)),this.array[r*this.itemSize+3]=c,this}setXY(r,c,p){return r*=this.itemSize,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array)),this.array[r+0]=c,this.array[r+1]=p,this}setXYZ(r,c,p,m){return r*=this.itemSize,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array),m=Si(m,this.array)),this.array[r+0]=c,this.array[r+1]=p,this.array[r+2]=m,this}setXYZW(r,c,p,m,_){return r*=this.itemSize,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array),m=Si(m,this.array),_=Si(_,this.array)),this.array[r+0]=c,this.array[r+1]=p,this.array[r+2]=m,this.array[r+3]=_,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==el&&(r.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(r.updateRange=this.updateRange),r}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Wm extends ur{constructor(r,c,p){super(new Int8Array(r),c,p)}}class Xc extends ur{constructor(r,c,p){super(new Uint8Array(r),c,p)}}class qm extends ur{constructor(r,c,p){super(new Uint8ClampedArray(r),c,p)}}class Du extends ur{constructor(r,c,p){super(new Int16Array(r),c,p)}}class Aa extends ur{constructor(r,c,p){super(new Uint16Array(r),c,p)}}class Bu extends ur{constructor(r,c,p){super(new Int32Array(r),c,p)}}class Fs extends ur{constructor(r,c,p){super(new Uint32Array(r),c,p)}}class $r extends ur{constructor(r,c,p){super(new Uint16Array(r),c,p),this.isFloat16BufferAttribute=!0}getX(r){let c=Ol(this.array[r*this.itemSize]);return this.normalized&&(c=to(c,this.array)),c}setX(r,c){return this.normalized&&(c=Si(c,this.array)),this.array[r*this.itemSize]=ya(c),this}getY(r){let c=Ol(this.array[r*this.itemSize+1]);return this.normalized&&(c=to(c,this.array)),c}setY(r,c){return this.normalized&&(c=Si(c,this.array)),this.array[r*this.itemSize+1]=ya(c),this}getZ(r){let c=Ol(this.array[r*this.itemSize+2]);return this.normalized&&(c=to(c,this.array)),c}setZ(r,c){return this.normalized&&(c=Si(c,this.array)),this.array[r*this.itemSize+2]=ya(c),this}getW(r){let c=Ol(this.array[r*this.itemSize+3]);return this.normalized&&(c=to(c,this.array)),c}setW(r,c){return this.normalized&&(c=Si(c,this.array)),this.array[r*this.itemSize+3]=ya(c),this}setXY(r,c,p){return r*=this.itemSize,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array)),this.array[r+0]=ya(c),this.array[r+1]=ya(p),this}setXYZ(r,c,p,m){return r*=this.itemSize,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array),m=Si(m,this.array)),this.array[r+0]=ya(c),this.array[r+1]=ya(p),this.array[r+2]=ya(m),this}setXYZW(r,c,p,m,_){return r*=this.itemSize,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array),m=Si(m,this.array),_=Si(_,this.array)),this.array[r+0]=ya(c),this.array[r+1]=ya(p),this.array[r+2]=ya(m),this.array[r+3]=ya(_),this}}class Tn extends ur{constructor(r,c,p){super(new Float32Array(r),c,p)}}class nr extends ur{constructor(r,c,p){super(new Float64Array(r),c,p)}}let Xm=0;const ba=new _i,If=new Vi,k=new ze,A=new nl,C=new nl,F=new ze;class ee extends tl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Xm++}),this.uuid=Ua(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(r){return Array.isArray(r)?this.index=new(Dv(r)?Fs:Aa)(r,1):this.index=r,this}getAttribute(r){return this.attributes[r]}setAttribute(r,c){return this.attributes[r]=c,this}deleteAttribute(r){return delete this.attributes[r],this}hasAttribute(r){return this.attributes[r]!==void 0}addGroup(r,c,p=0){this.groups.push({start:r,count:c,materialIndex:p})}clearGroups(){this.groups=[]}setDrawRange(r,c){this.drawRange.start=r,this.drawRange.count=c}applyMatrix4(r){const c=this.attributes.position;c!==void 0&&(c.applyMatrix4(r),c.needsUpdate=!0);const p=this.attributes.normal;if(p!==void 0){const _=new Ai().getNormalMatrix(r);p.applyNormalMatrix(_),p.needsUpdate=!0}const m=this.attributes.tangent;return m!==void 0&&(m.transformDirection(r),m.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(r){return ba.makeRotationFromQuaternion(r),this.applyMatrix4(ba),this}rotateX(r){return ba.makeRotationX(r),this.applyMatrix4(ba),this}rotateY(r){return ba.makeRotationY(r),this.applyMatrix4(ba),this}rotateZ(r){return ba.makeRotationZ(r),this.applyMatrix4(ba),this}translate(r,c,p){return ba.makeTranslation(r,c,p),this.applyMatrix4(ba),this}scale(r,c,p){return ba.makeScale(r,c,p),this.applyMatrix4(ba),this}lookAt(r){return If.lookAt(r),If.updateMatrix(),this.applyMatrix4(If.matrix),this}center(r=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(k).negate(),this.translate(k.x,k.y,k.z),r&&r.copy(k),this}setFromPoints(r){const c=[];for(let p=0,m=r.length;p<m;p++){const _=r[p];c.push(_.x,_.y,_.z||0)}return this.setAttribute("position",new Tn(c,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new nl);const r=this.attributes.position,c=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ze(-1/0,-1/0,-1/0),new ze(1/0,1/0,1/0));if(r!==void 0){if(this.boundingBox.setFromBufferAttribute(r),c)for(let p=0,m=c.length;p<m;p++){const _=c[p];A.setFromBufferAttribute(_),this.morphTargetsRelative?(F.addVectors(this.boundingBox.min,A.min),this.boundingBox.expandByPoint(F),F.addVectors(this.boundingBox.max,A.max),this.boundingBox.expandByPoint(F)):(this.boundingBox.expandByPoint(A.min),this.boundingBox.expandByPoint(A.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Do);const r=this.attributes.position,c=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ze,1/0);if(r){const p=this.boundingSphere.center;if(A.setFromBufferAttribute(r),c)for(let _=0,x=c.length;_<x;_++){const S=c[_];C.setFromBufferAttribute(S),this.morphTargetsRelative?(F.addVectors(A.min,C.min),A.expandByPoint(F),F.addVectors(A.max,C.max),A.expandByPoint(F)):(A.expandByPoint(C.min),A.expandByPoint(C.max))}A.getCenter(p);let m=0;for(let _=0,x=r.count;_<x;_++)F.fromBufferAttribute(r,_),m=Math.max(m,p.distanceToSquared(F));if(c)for(let _=0,x=c.length;_<x;_++){const S=c[_],B=this.morphTargetsRelative;for(let D=0,U=S.count;D<U;D++)F.fromBufferAttribute(S,D),B&&(k.fromBufferAttribute(r,D),F.add(k)),m=Math.max(m,p.distanceToSquared(F))}this.boundingSphere.radius=Math.sqrt(m),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const r=this.index,c=this.attributes;if(r===null||c.position===void 0||c.normal===void 0||c.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const p=r.array,m=c.position.array,_=c.normal.array,x=c.uv.array,S=m.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ur(new Float32Array(4*S),4));const B=this.getAttribute("tangent").array,D=[],U=[];for(let yt=0;yt<S;yt++)D[yt]=new ze,U[yt]=new ze;const G=new ze,V=new ze,Q=new ze,q=new qt,te=new qt,K=new qt,Z=new ze,ae=new ze;function ce(yt,Ze,Pt){G.fromArray(m,3*yt),V.fromArray(m,3*Ze),Q.fromArray(m,3*Pt),q.fromArray(x,2*yt),te.fromArray(x,2*Ze),K.fromArray(x,2*Pt),V.sub(G),Q.sub(G),te.sub(q),K.sub(q);const kt=1/(te.x*K.y-K.x*te.y);isFinite(kt)&&(Z.copy(V).multiplyScalar(K.y).addScaledVector(Q,-te.y).multiplyScalar(kt),ae.copy(Q).multiplyScalar(te.x).addScaledVector(V,-K.x).multiplyScalar(kt),D[yt].add(Z),D[Ze].add(Z),D[Pt].add(Z),U[yt].add(ae),U[Ze].add(ae),U[Pt].add(ae))}let Te=this.groups;Te.length===0&&(Te=[{start:0,count:p.length}]);for(let yt=0,Ze=Te.length;yt<Ze;++yt){const Pt=Te[yt],kt=Pt.start;for(let en=kt,xn=kt+Pt.count;en<xn;en+=3)ce(p[en+0],p[en+1],p[en+2])}const Ce=new ze,Ie=new ze,Ke=new ze,ct=new ze;function Je(yt){Ke.fromArray(_,3*yt),ct.copy(Ke);const Ze=D[yt];Ce.copy(Ze),Ce.sub(Ke.multiplyScalar(Ke.dot(Ze))).normalize(),Ie.crossVectors(ct,Ze);const Pt=Ie.dot(U[yt])<0?-1:1;B[4*yt]=Ce.x,B[4*yt+1]=Ce.y,B[4*yt+2]=Ce.z,B[4*yt+3]=Pt}for(let yt=0,Ze=Te.length;yt<Ze;++yt){const Pt=Te[yt],kt=Pt.start;for(let en=kt,xn=kt+Pt.count;en<xn;en+=3)Je(p[en+0]),Je(p[en+1]),Je(p[en+2])}}computeVertexNormals(){const r=this.index,c=this.getAttribute("position");if(c!==void 0){let p=this.getAttribute("normal");if(p===void 0)p=new ur(new Float32Array(3*c.count),3),this.setAttribute("normal",p);else for(let V=0,Q=p.count;V<Q;V++)p.setXYZ(V,0,0,0);const m=new ze,_=new ze,x=new ze,S=new ze,B=new ze,D=new ze,U=new ze,G=new ze;if(r)for(let V=0,Q=r.count;V<Q;V+=3){const q=r.getX(V+0),te=r.getX(V+1),K=r.getX(V+2);m.fromBufferAttribute(c,q),_.fromBufferAttribute(c,te),x.fromBufferAttribute(c,K),U.subVectors(x,_),G.subVectors(m,_),U.cross(G),S.fromBufferAttribute(p,q),B.fromBufferAttribute(p,te),D.fromBufferAttribute(p,K),S.add(U),B.add(U),D.add(U),p.setXYZ(q,S.x,S.y,S.z),p.setXYZ(te,B.x,B.y,B.z),p.setXYZ(K,D.x,D.y,D.z)}else for(let V=0,Q=c.count;V<Q;V+=3)m.fromBufferAttribute(c,V+0),_.fromBufferAttribute(c,V+1),x.fromBufferAttribute(c,V+2),U.subVectors(x,_),G.subVectors(m,_),U.cross(G),p.setXYZ(V+0,U.x,U.y,U.z),p.setXYZ(V+1,U.x,U.y,U.z),p.setXYZ(V+2,U.x,U.y,U.z);this.normalizeNormals(),p.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const r=this.attributes.normal;for(let c=0,p=r.count;c<p;c++)F.fromBufferAttribute(r,c),F.normalize(),r.setXYZ(c,F.x,F.y,F.z)}toNonIndexed(){function r(S,B){const D=S.array,U=S.itemSize,G=S.normalized,V=new D.constructor(B.length*U);let Q=0,q=0;for(let te=0,K=B.length;te<K;te++){Q=S.isInterleavedBufferAttribute?B[te]*S.data.stride+S.offset:B[te]*U;for(let Z=0;Z<U;Z++)V[q++]=D[Q++]}return new ur(V,U,G)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const c=new ee,p=this.index.array,m=this.attributes;for(const S in m){const B=r(m[S],p);c.setAttribute(S,B)}const _=this.morphAttributes;for(const S in _){const B=[],D=_[S];for(let U=0,G=D.length;U<G;U++){const V=r(D[U],p);B.push(V)}c.morphAttributes[S]=B}c.morphTargetsRelative=this.morphTargetsRelative;const x=this.groups;for(let S=0,B=x.length;S<B;S++){const D=x[S];c.addGroup(D.start,D.count,D.materialIndex)}return c}toJSON(){const r={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),Object.keys(this.userData).length>0&&(r.userData=this.userData),this.parameters!==void 0){const B=this.parameters;for(const D in B)B[D]!==void 0&&(r[D]=B[D]);return r}r.data={attributes:{}};const c=this.index;c!==null&&(r.data.index={type:c.array.constructor.name,array:Array.prototype.slice.call(c.array)});const p=this.attributes;for(const B in p){const D=p[B];r.data.attributes[B]=D.toJSON(r.data)}const m={};let _=!1;for(const B in this.morphAttributes){const D=this.morphAttributes[B],U=[];for(let G=0,V=D.length;G<V;G++){const Q=D[G];U.push(Q.toJSON(r.data))}U.length>0&&(m[B]=U,_=!0)}_&&(r.data.morphAttributes=m,r.data.morphTargetsRelative=this.morphTargetsRelative);const x=this.groups;x.length>0&&(r.data.groups=JSON.parse(JSON.stringify(x)));const S=this.boundingSphere;return S!==null&&(r.data.boundingSphere={center:S.center.toArray(),radius:S.radius}),r}clone(){return new this.constructor().copy(this)}copy(r){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const c={};this.name=r.name;const p=r.index;p!==null&&this.setIndex(p.clone(c));const m=r.attributes;for(const D in m){const U=m[D];this.setAttribute(D,U.clone(c))}const _=r.morphAttributes;for(const D in _){const U=[],G=_[D];for(let V=0,Q=G.length;V<Q;V++)U.push(G[V].clone(c));this.morphAttributes[D]=U}this.morphTargetsRelative=r.morphTargetsRelative;const x=r.groups;for(let D=0,U=x.length;D<U;D++){const G=x[D];this.addGroup(G.start,G.count,G.materialIndex)}const S=r.boundingBox;S!==null&&(this.boundingBox=S.clone());const B=r.boundingSphere;return B!==null&&(this.boundingSphere=B.clone()),this.drawRange.start=r.drawRange.start,this.drawRange.count=r.drawRange.count,this.userData=r.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const De=new _i,Ue=new Mu,gt=new Do,zt=new ze,yn=new ze,ri=new ze,sr=new ze,zs=new ze,Ms=new ze,Oo=new qt,kl=new qt,mc=new qt,tp=new ze,Oh=new ze,Yc=new ze,kh=new ze,Pf=new ze;class Cs extends Vi{constructor(r=new ee,c=new Lo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=c,this.updateMorphTargets()}copy(r,c){return super.copy(r,c),r.isMesh?(r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=r.material,this.geometry=r.geometry,this):this}updateMorphTargets(){const r=this.geometry.morphAttributes,c=Object.keys(r);if(c.length>0){const p=r[c[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,_=p.length;m<_;m++){const x=p[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=m}}}}getVertexPosition(r,c){const p=this.geometry,m=p.attributes.position,_=p.morphAttributes.position,x=p.morphTargetsRelative;c.fromBufferAttribute(m,r);const S=this.morphTargetInfluences;if(_&&S){Ms.set(0,0,0);for(let B=0,D=_.length;B<D;B++){const U=S[B],G=_[B];U!==0&&(zs.fromBufferAttribute(G,r),x?Ms.addScaledVector(zs,U):Ms.addScaledVector(zs.sub(c),U))}c.add(Ms)}return c}raycast(r,c){const p=this.geometry,m=this.material,_=this.matrixWorld;if(m!==void 0){if(p.boundingSphere===null&&p.computeBoundingSphere(),gt.copy(p.boundingSphere),gt.applyMatrix4(_),Ue.copy(r.ray).recast(r.near),gt.containsPoint(Ue.origin)===!1&&(Ue.intersectSphere(gt,zt)===null||Ue.origin.distanceToSquared(zt)>(r.far-r.near)**2))return;De.copy(_).invert(),Ue.copy(r.ray).applyMatrix4(De),p.boundingBox!==null&&Ue.intersectsBox(p.boundingBox)===!1||this._computeIntersections(r,c)}}_computeIntersections(r,c){let p;const m=this.geometry,_=this.material,x=m.index,S=m.attributes.position,B=m.attributes.uv,D=m.attributes.uv1,U=m.attributes.normal,G=m.groups,V=m.drawRange;if(x!==null)if(Array.isArray(_))for(let Q=0,q=G.length;Q<q;Q++){const te=G[Q],K=_[te.materialIndex];for(let Z=Math.max(te.start,V.start),ae=Math.min(x.count,Math.min(te.start+te.count,V.start+V.count));Z<ae;Z+=3){const ce=x.getX(Z),Te=x.getX(Z+1),Ce=x.getX(Z+2);p=Rf(this,K,r,Ue,B,D,U,ce,Te,Ce),p&&(p.faceIndex=Math.floor(Z/3),p.face.materialIndex=te.materialIndex,c.push(p))}}else for(let Q=Math.max(0,V.start),q=Math.min(x.count,V.start+V.count);Q<q;Q+=3){const te=x.getX(Q),K=x.getX(Q+1),Z=x.getX(Q+2);p=Rf(this,_,r,Ue,B,D,U,te,K,Z),p&&(p.faceIndex=Math.floor(Q/3),c.push(p))}else if(S!==void 0)if(Array.isArray(_))for(let Q=0,q=G.length;Q<q;Q++){const te=G[Q],K=_[te.materialIndex];for(let Z=Math.max(te.start,V.start),ae=Math.min(S.count,Math.min(te.start+te.count,V.start+V.count));Z<ae;Z+=3)p=Rf(this,K,r,Ue,B,D,U,Z,Z+1,Z+2),p&&(p.faceIndex=Math.floor(Z/3),p.face.materialIndex=te.materialIndex,c.push(p))}else for(let Q=Math.max(0,V.start),q=Math.min(S.count,V.start+V.count);Q<q;Q+=3)p=Rf(this,_,r,Ue,B,D,U,Q,Q+1,Q+2),p&&(p.faceIndex=Math.floor(Q/3),c.push(p))}}function Rf(b,r,c,p,m,_,x,S,B,D){b.getVertexPosition(S,yn),b.getVertexPosition(B,ri),b.getVertexPosition(D,sr);const U=function(G,V,Q,q,te,K,Z,ae){let ce;if(ce=V.side===ue?q.intersectTriangle(Z,K,te,!0,ae):q.intersectTriangle(te,K,Z,V.side===Pe,ae),ce===null)return null;Pf.copy(ae),Pf.applyMatrix4(G.matrixWorld);const Te=Q.ray.origin.distanceTo(Pf);return Te<Q.near||Te>Q.far?null:{distance:Te,point:Pf.clone(),object:G}}(b,r,c,p,yn,ri,sr,kh);if(U){m&&(Oo.fromBufferAttribute(m,S),kl.fromBufferAttribute(m,B),mc.fromBufferAttribute(m,D),U.uv=Zr.getInterpolation(kh,yn,ri,sr,Oo,kl,mc,new qt)),_&&(Oo.fromBufferAttribute(_,S),kl.fromBufferAttribute(_,B),mc.fromBufferAttribute(_,D),U.uv1=Zr.getInterpolation(kh,yn,ri,sr,Oo,kl,mc,new qt),U.uv2=U.uv1),x&&(tp.fromBufferAttribute(x,S),Oh.fromBufferAttribute(x,B),Yc.fromBufferAttribute(x,D),U.normal=Zr.getInterpolation(kh,yn,ri,sr,tp,Oh,Yc,new ze),U.normal.dot(p.direction)>0&&U.normal.multiplyScalar(-1));const G={a:S,b:B,c:D,normal:new ze,materialIndex:0};Zr.getNormal(yn,ri,sr,G.normal),U.face=G}return U}class Ul extends ee{constructor(r=1,c=1,p=1,m=1,_=1,x=1){super(),this.type="BoxGeometry",this.parameters={width:r,height:c,depth:p,widthSegments:m,heightSegments:_,depthSegments:x};const S=this;m=Math.floor(m),_=Math.floor(_),x=Math.floor(x);const B=[],D=[],U=[],G=[];let V=0,Q=0;function q(te,K,Z,ae,ce,Te,Ce,Ie,Ke,ct,Je){const yt=Te/Ke,Ze=Ce/ct,Pt=Te/2,kt=Ce/2,en=Ie/2,xn=Ke+1,tn=ct+1;let Wt=0,dn=0;const pn=new ze;for(let It=0;It<tn;It++){const Qt=It*Ze-kt;for(let un=0;un<xn;un++){const Kt=un*yt-Pt;pn[te]=Kt*ae,pn[K]=Qt*ce,pn[Z]=en,D.push(pn.x,pn.y,pn.z),pn[te]=0,pn[K]=0,pn[Z]=Ie>0?1:-1,U.push(pn.x,pn.y,pn.z),G.push(un/Ke),G.push(1-It/ct),Wt+=1}}for(let It=0;It<ct;It++)for(let Qt=0;Qt<Ke;Qt++){const un=V+Qt+xn*It,Kt=V+Qt+xn*(It+1),bn=V+(Qt+1)+xn*(It+1),ni=V+(Qt+1)+xn*It;B.push(un,Kt,ni),B.push(Kt,bn,ni),dn+=6}S.addGroup(Q,dn,Je),Q+=dn,V+=Wt}q("z","y","x",-1,-1,p,c,r,x,_,0),q("z","y","x",1,-1,p,c,-r,x,_,1),q("x","z","y",1,1,r,p,c,m,x,2),q("x","z","y",1,-1,r,p,-c,m,x,3),q("x","y","z",1,-1,r,c,p,m,_,4),q("x","y","z",-1,-1,r,c,-p,m,_,5),this.setIndex(B),this.setAttribute("position",new Tn(D,3)),this.setAttribute("normal",new Tn(U,3)),this.setAttribute("uv",new Tn(G,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Ul(r.width,r.height,r.depth,r.widthSegments,r.heightSegments,r.depthSegments)}}function Uh(b){const r={};for(const c in b){r[c]={};for(const p in b[c]){const m=b[c][p];m&&(m.isColor||m.isMatrix3||m.isMatrix4||m.isVector2||m.isVector3||m.isVector4||m.isTexture||m.isQuaternion)?m.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),r[c][p]=null):r[c][p]=m.clone():Array.isArray(m)?r[c][p]=m.slice():r[c][p]=m}}return r}function ja(b){const r={};for(let c=0;c<b.length;c++){const p=Uh(b[c]);for(const m in p)r[m]=p[m]}return r}function Ym(b){return b.getRenderTarget()===null?b.outputColorSpace:vi}const j0={clone:Uh,merge:ja};class gc extends Ss{constructor(r){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,r!==void 0&&this.setValues(r)}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=Uh(r.uniforms),this.uniformsGroups=function(c){const p=[];for(let m=0;m<c.length;m++)p.push(c[m].clone());return p}(r.uniformsGroups),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.fog=r.fog,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){const c=super.toJSON(r);c.glslVersion=this.glslVersion,c.uniforms={};for(const m in this.uniforms){const _=this.uniforms[m].value;_&&_.isTexture?c.uniforms[m]={type:"t",value:_.toJSON(r).uuid}:_&&_.isColor?c.uniforms[m]={type:"c",value:_.getHex()}:_&&_.isVector2?c.uniforms[m]={type:"v2",value:_.toArray()}:_&&_.isVector3?c.uniforms[m]={type:"v3",value:_.toArray()}:_&&_.isVector4?c.uniforms[m]={type:"v4",value:_.toArray()}:_&&_.isMatrix3?c.uniforms[m]={type:"m3",value:_.toArray()}:_&&_.isMatrix4?c.uniforms[m]={type:"m4",value:_.toArray()}:c.uniforms[m]={value:_}}Object.keys(this.defines).length>0&&(c.defines=this.defines),c.vertexShader=this.vertexShader,c.fragmentShader=this.fragmentShader,c.lights=this.lights,c.clipping=this.clipping;const p={};for(const m in this.extensions)this.extensions[m]===!0&&(p[m]=!0);return Object.keys(p).length>0&&(c.extensions=p),c}}class Nv extends Vi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new _i,this.projectionMatrix=new _i,this.projectionMatrixInverse=new _i}copy(r,c){return super.copy(r,c),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const c=this.matrixWorld.elements;return r.set(-c[8],-c[9],-c[10]).normalize()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,c){super.updateWorldMatrix(r,c),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class xa extends Nv{constructor(r=50,c=1,p=.1,m=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=p,this.far=m,this.focus=10,this.aspect=c,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,c){return super.copy(r,c),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const c=.5*this.getFilmHeight()/r;this.fov=2*Io*Math.atan(c),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(.5*uc*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return 2*Io*Math.atan(Math.tan(.5*uc*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(r,c,p,m,_,x){this.aspect=r/c,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=c,this.view.offsetX=p,this.view.offsetY=m,this.view.width=_,this.view.height=x,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let c=r*Math.tan(.5*uc*this.fov)/this.zoom,p=2*c,m=this.aspect*p,_=-.5*m;const x=this.view;if(this.view!==null&&this.view.enabled){const B=x.fullWidth,D=x.fullHeight;_+=x.offsetX*m/B,c-=x.offsetY*p/D,m*=x.width/B,p*=x.height/D}const S=this.filmOffset;S!==0&&(_+=r*S/this.getFilmWidth()),this.projectionMatrix.makePerspective(_,_+m,c,c-p,r,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const c=super.toJSON(r);return c.object.fov=this.fov,c.object.zoom=this.zoom,c.object.near=this.near,c.object.far=this.far,c.object.focus=this.focus,c.object.aspect=this.aspect,this.view!==null&&(c.object.view=Object.assign({},this.view)),c.object.filmGauge=this.filmGauge,c.object.filmOffset=this.filmOffset,c}}const Nh=-90;class V0 extends Vi{constructor(r,c,p){super(),this.type="CubeCamera",this.renderTarget=p;const m=new xa(Nh,1,r,c);m.layers=this.layers,m.up.set(0,1,0),m.lookAt(1,0,0),this.add(m);const _=new xa(Nh,1,r,c);_.layers=this.layers,_.up.set(0,1,0),_.lookAt(-1,0,0),this.add(_);const x=new xa(Nh,1,r,c);x.layers=this.layers,x.up.set(0,0,-1),x.lookAt(0,1,0),this.add(x);const S=new xa(Nh,1,r,c);S.layers=this.layers,S.up.set(0,0,1),S.lookAt(0,-1,0),this.add(S);const B=new xa(Nh,1,r,c);B.layers=this.layers,B.up.set(0,1,0),B.lookAt(0,0,1),this.add(B);const D=new xa(Nh,1,r,c);D.layers=this.layers,D.up.set(0,1,0),D.lookAt(0,0,-1),this.add(D)}update(r,c){this.parent===null&&this.updateMatrixWorld();const p=this.renderTarget,[m,_,x,S,B,D]=this.children,U=r.getRenderTarget(),G=r.toneMapping,V=r.xr.enabled;r.toneMapping=Ni,r.xr.enabled=!1;const Q=p.texture.generateMipmaps;p.texture.generateMipmaps=!1,r.setRenderTarget(p,0),r.render(c,m),r.setRenderTarget(p,1),r.render(c,_),r.setRenderTarget(p,2),r.render(c,x),r.setRenderTarget(p,3),r.render(c,S),r.setRenderTarget(p,4),r.render(c,B),p.texture.generateMipmaps=Q,r.setRenderTarget(p,5),r.render(c,D),r.setRenderTarget(U),r.toneMapping=G,r.xr.enabled=V,p.texture.needsPMREMUpdate=!0}}class np extends pr{constructor(r,c,p,m,_,x,S,B,D,U){super(r=r!==void 0?r:[],c=c!==void 0?c:zr,p,m,_,x,S,B,D,U),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(r){this.image=r}}class G0 extends ms{constructor(r=1,c={}){super(r,r,c),this.isWebGLCubeRenderTarget=!0;const p={width:r,height:r,depth:1},m=[p,p,p,p,p,p];c.encoding!==void 0&&(Au("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),c.colorSpace=c.encoding===Br?Xn:Mo),this.texture=new np(m,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=c.generateMipmaps!==void 0&&c.generateMipmaps,this.texture.minFilter=c.minFilter!==void 0?c.minFilter:Cr}fromEquirectangularTexture(r,c){this.texture.type=c.type,this.texture.colorSpace=c.colorSpace,this.texture.generateMipmaps=c.generateMipmaps,this.texture.minFilter=c.minFilter,this.texture.magFilter=c.magFilter;const p={tEquirect:{value:null}},m=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,_=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,x=new Ul(5,5,5),S=new gc({name:"CubemapFromEquirect",uniforms:Uh(p),vertexShader:m,fragmentShader:_,side:ue,blending:Fe});S.uniforms.tEquirect.value=c;const B=new Cs(x,S),D=c.minFilter;return c.minFilter===ds&&(c.minFilter=Cr),new V0(1,10,this).update(r,B),c.minFilter=D,B.geometry.dispose(),B.material.dispose(),this}clear(r,c,p,m){const _=r.getRenderTarget();for(let x=0;x<6;x++)r.setRenderTarget(this,x),r.clear(c,p,m);r.setRenderTarget(_)}}const Fv=new ze,N1=new ze,F1=new Ai;class wa{constructor(r=new ze(1,0,0),c=0){this.isPlane=!0,this.normal=r,this.constant=c}set(r,c){return this.normal.copy(r),this.constant=c,this}setComponents(r,c,p,m){return this.normal.set(r,c,p),this.constant=m,this}setFromNormalAndCoplanarPoint(r,c){return this.normal.copy(r),this.constant=-c.dot(this.normal),this}setFromCoplanarPoints(r,c,p){const m=Fv.subVectors(p,c).cross(N1.subVectors(r,c)).normalize();return this.setFromNormalAndCoplanarPoint(m,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,c){return c.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,c){const p=r.delta(Fv),m=this.normal.dot(p);if(m===0)return this.distanceToPoint(r.start)===0?c.copy(r.start):null;const _=-(r.start.dot(this.normal)+this.constant)/m;return _<0||_>1?null:c.copy(r.start).addScaledVector(p,_)}intersectsLine(r){const c=this.distanceToPoint(r.start),p=this.distanceToPoint(r.end);return c<0&&p>0||p<0&&c>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,c){const p=c||F1.getNormalMatrix(r),m=this.coplanarPoint(Fv).applyMatrix4(r),_=this.normal.applyMatrix3(p).normalize();return this.constant=-m.dot(_),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Kc=new Do,Km=new ze;class Jm{constructor(r=new wa,c=new wa,p=new wa,m=new wa,_=new wa,x=new wa){this.planes=[r,c,p,m,_,x]}set(r,c,p,m,_,x){const S=this.planes;return S[0].copy(r),S[1].copy(c),S[2].copy(p),S[3].copy(m),S[4].copy(_),S[5].copy(x),this}copy(r){const c=this.planes;for(let p=0;p<6;p++)c[p].copy(r.planes[p]);return this}setFromProjectionMatrix(r){const c=this.planes,p=r.elements,m=p[0],_=p[1],x=p[2],S=p[3],B=p[4],D=p[5],U=p[6],G=p[7],V=p[8],Q=p[9],q=p[10],te=p[11],K=p[12],Z=p[13],ae=p[14],ce=p[15];return c[0].setComponents(S-m,G-B,te-V,ce-K).normalize(),c[1].setComponents(S+m,G+B,te+V,ce+K).normalize(),c[2].setComponents(S+_,G+D,te+Q,ce+Z).normalize(),c[3].setComponents(S-_,G-D,te-Q,ce-Z).normalize(),c[4].setComponents(S-x,G-U,te-q,ce-ae).normalize(),c[5].setComponents(S+x,G+U,te+q,ce+ae).normalize(),this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),Kc.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const c=r.geometry;c.boundingSphere===null&&c.computeBoundingSphere(),Kc.copy(c.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(Kc)}intersectsSprite(r){return Kc.center.set(0,0,0),Kc.radius=.7071067811865476,Kc.applyMatrix4(r.matrixWorld),this.intersectsSphere(Kc)}intersectsSphere(r){const c=this.planes,p=r.center,m=-r.radius;for(let _=0;_<6;_++)if(c[_].distanceToPoint(p)<m)return!1;return!0}intersectsBox(r){const c=this.planes;for(let p=0;p<6;p++){const m=c[p];if(Km.x=m.normal.x>0?r.max.x:r.min.x,Km.y=m.normal.y>0?r.max.y:r.min.y,Km.z=m.normal.z>0?r.max.z:r.min.z,m.distanceToPoint(Km)<0)return!1}return!0}containsPoint(r){const c=this.planes;for(let p=0;p<6;p++)if(c[p].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function H0(){let b=null,r=!1,c=null,p=null;function m(_,x){c(_,x),p=b.requestAnimationFrame(m)}return{start:function(){r!==!0&&c!==null&&(p=b.requestAnimationFrame(m),r=!0)},stop:function(){b.cancelAnimationFrame(p),r=!1},setAnimationLoop:function(_){c=_},setContext:function(_){b=_}}}function ob(b,r){const c=r.isWebGL2,p=new WeakMap;return{get:function(m){return m.isInterleavedBufferAttribute&&(m=m.data),p.get(m)},remove:function(m){m.isInterleavedBufferAttribute&&(m=m.data);const _=p.get(m);_&&(b.deleteBuffer(_.buffer),p.delete(m))},update:function(m,_){if(m.isGLBufferAttribute){const S=p.get(m);return void((!S||S.version<m.version)&&p.set(m,{buffer:m.buffer,type:m.type,bytesPerElement:m.elementSize,version:m.version}))}m.isInterleavedBufferAttribute&&(m=m.data);const x=p.get(m);x===void 0?p.set(m,function(S,B){const D=S.array,U=S.usage,G=b.createBuffer();let V;if(b.bindBuffer(B,G),b.bufferData(B,D,U),S.onUploadCallback(),D instanceof Float32Array)V=b.FLOAT;else if(D instanceof Uint16Array)if(S.isFloat16BufferAttribute){if(!c)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");V=b.HALF_FLOAT}else V=b.UNSIGNED_SHORT;else if(D instanceof Int16Array)V=b.SHORT;else if(D instanceof Uint32Array)V=b.UNSIGNED_INT;else if(D instanceof Int32Array)V=b.INT;else if(D instanceof Int8Array)V=b.BYTE;else if(D instanceof Uint8Array)V=b.UNSIGNED_BYTE;else{if(!(D instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+D);V=b.UNSIGNED_BYTE}return{buffer:G,type:V,bytesPerElement:D.BYTES_PER_ELEMENT,version:S.version}}(m,_)):x.version<m.version&&(function(S,B,D){const U=B.array,G=B.updateRange;b.bindBuffer(D,S),G.count===-1?b.bufferSubData(D,0,U):(c?b.bufferSubData(D,G.offset*U.BYTES_PER_ELEMENT,U,G.offset,G.count):b.bufferSubData(D,G.offset*U.BYTES_PER_ELEMENT,U.subarray(G.offset,G.offset+G.count)),G.count=-1),B.onUploadCallback()}(x.buffer,m,_),x.version=m.version)}}}class al extends ee{constructor(r=1,c=1,p=1,m=1){super(),this.type="PlaneGeometry",this.parameters={width:r,height:c,widthSegments:p,heightSegments:m};const _=r/2,x=c/2,S=Math.floor(p),B=Math.floor(m),D=S+1,U=B+1,G=r/S,V=c/B,Q=[],q=[],te=[],K=[];for(let Z=0;Z<U;Z++){const ae=Z*V-x;for(let ce=0;ce<D;ce++){const Te=ce*G-_;q.push(Te,-ae,0),te.push(0,0,1),K.push(ce/S),K.push(1-Z/B)}}for(let Z=0;Z<B;Z++)for(let ae=0;ae<S;ae++){const ce=ae+D*Z,Te=ae+D*(Z+1),Ce=ae+1+D*(Z+1),Ie=ae+1+D*Z;Q.push(ce,Te,Ie),Q.push(Te,Ce,Ie)}this.setIndex(Q),this.setAttribute("position",new Tn(q,3)),this.setAttribute("normal",new Tn(te,3)),this.setAttribute("uv",new Tn(K,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new al(r.width,r.height,r.widthSegments,r.heightSegments)}}const bi={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	#ifndef WebGL2Context
	#define textureLod texture2DLodEXT
	#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))
	#define isinf(x) (x > 1e20 || x < -1e20)
	#endif
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},An={common:{diffuse:{value:new En(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ai},alphaMap:{value:null},alphaMapTransform:{value:new Ai},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ai}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ai}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ai}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ai},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ai},normalScale:{value:new qt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ai},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ai}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ai}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ai}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new En(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new En(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ai}},sprite:{diffuse:{value:new En(16777215)},opacity:{value:1},center:{value:new qt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ai},alphaMap:{value:null},alphaTest:{value:0}}},ta={basic:{uniforms:ja([An.common,An.specularmap,An.envmap,An.aomap,An.lightmap,An.fog]),vertexShader:bi.meshbasic_vert,fragmentShader:bi.meshbasic_frag},lambert:{uniforms:ja([An.common,An.specularmap,An.envmap,An.aomap,An.lightmap,An.emissivemap,An.bumpmap,An.normalmap,An.displacementmap,An.fog,An.lights,{emissive:{value:new En(0)}}]),vertexShader:bi.meshlambert_vert,fragmentShader:bi.meshlambert_frag},phong:{uniforms:ja([An.common,An.specularmap,An.envmap,An.aomap,An.lightmap,An.emissivemap,An.bumpmap,An.normalmap,An.displacementmap,An.fog,An.lights,{emissive:{value:new En(0)},specular:{value:new En(1118481)},shininess:{value:30}}]),vertexShader:bi.meshphong_vert,fragmentShader:bi.meshphong_frag},standard:{uniforms:ja([An.common,An.envmap,An.aomap,An.lightmap,An.emissivemap,An.bumpmap,An.normalmap,An.displacementmap,An.roughnessmap,An.metalnessmap,An.fog,An.lights,{emissive:{value:new En(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:bi.meshphysical_vert,fragmentShader:bi.meshphysical_frag},toon:{uniforms:ja([An.common,An.aomap,An.lightmap,An.emissivemap,An.bumpmap,An.normalmap,An.displacementmap,An.gradientmap,An.fog,An.lights,{emissive:{value:new En(0)}}]),vertexShader:bi.meshtoon_vert,fragmentShader:bi.meshtoon_frag},matcap:{uniforms:ja([An.common,An.bumpmap,An.normalmap,An.displacementmap,An.fog,{matcap:{value:null}}]),vertexShader:bi.meshmatcap_vert,fragmentShader:bi.meshmatcap_frag},points:{uniforms:ja([An.points,An.fog]),vertexShader:bi.points_vert,fragmentShader:bi.points_frag},dashed:{uniforms:ja([An.common,An.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:bi.linedashed_vert,fragmentShader:bi.linedashed_frag},depth:{uniforms:ja([An.common,An.displacementmap]),vertexShader:bi.depth_vert,fragmentShader:bi.depth_frag},normal:{uniforms:ja([An.common,An.bumpmap,An.normalmap,An.displacementmap,{opacity:{value:1}}]),vertexShader:bi.meshnormal_vert,fragmentShader:bi.meshnormal_frag},sprite:{uniforms:ja([An.sprite,An.fog]),vertexShader:bi.sprite_vert,fragmentShader:bi.sprite_frag},background:{uniforms:{uvTransform:{value:new Ai},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new En(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:bi.background_vert,fragmentShader:bi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:bi.backgroundCube_vert,fragmentShader:bi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:bi.cube_vert,fragmentShader:bi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:bi.equirect_vert,fragmentShader:bi.equirect_frag},distanceRGBA:{uniforms:ja([An.common,An.displacementmap,{referencePosition:{value:new ze},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:bi.distanceRGBA_vert,fragmentShader:bi.distanceRGBA_frag},shadow:{uniforms:ja([An.lights,An.fog,{color:{value:new En(0)},opacity:{value:1}}]),vertexShader:bi.shadow_vert,fragmentShader:bi.shadow_frag}};ta.physical={uniforms:ja([ta.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ai},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ai},clearcoatNormalScale:{value:new qt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ai},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ai},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ai},sheen:{value:0},sheenColor:{value:new En(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ai},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ai},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ai},transmissionSamplerSize:{value:new qt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ai},attenuationDistance:{value:0},attenuationColor:{value:new En(0)},specularColor:{value:new En(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ai},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ai}}]),vertexShader:bi.meshphysical_vert,fragmentShader:bi.meshphysical_frag};const zv={r:0,b:0,g:0};function z1(b,r,c,p,m,_,x){const S=new En(0);let B,D,U=_===!0?0:1,G=null,V=0,Q=null;function q(te,K){te.getRGB(zv,Ym(b)),p.buffers.color.setClear(zv.r,zv.g,zv.b,K,x)}return{getClearColor:function(){return S},setClearColor:function(te,K=1){S.set(te),U=K,q(S,U)},getClearAlpha:function(){return U},setClearAlpha:function(te){U=te,q(S,U)},getPlaneMesh:function(){return B},getBoxMesh:function(){return D},getBoxMesh2:function(){return D===void 0&&(D=new Cs(new Ul(1,1,1),new gc({name:"BackgroundCubeMaterial",uniforms:Uh(ta.backgroundCube.uniforms),vertexShader:ta.backgroundCube.vertexShader,fragmentShader:ta.backgroundCube.fragmentShader,side:ue,depthTest:!1,depthWrite:!1,fog:!1})),D.geometry.deleteAttribute("normal"),D.geometry.deleteAttribute("uv"),D.onBeforeRender=function(te,K,Z){this.matrixWorld.copyPosition(Z.matrixWorld)},Object.defineProperty(D.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),m.update(D)),D},render:function(te,K){let Z=!1,ae=K.isScene===!0?K.background:null;const ce=K.isScene&&K.backgroundColor!==void 0?K.backgroundColor:null;switch(ae==="environment"&&(ae=K.environment),ae&&ae.isTexture&&(ae=(K.backgroundBlurriness>0?c:r).get(ae)),ae===null?q(S,U):ae&&ae.isColor&&(q(ae,1),Z=!0),b.xr.getEnvironmentBlendMode()){case"opaque":Z=!0;break;case"additive":p.buffers.color.setClear(0,0,0,1,x),Z=!0;break;case"alpha-blend":p.buffers.color.setClear(0,0,0,0,x),Z=!0}if((b.autoClear||Z)&&b.clear(b.autoClearColor,b.autoClearDepth,b.autoClearStencil),ae&&(ae.isCubeTexture||ae.mapping===Oa))D===void 0&&(D=new Cs(new Ul(1,1,1),new gc({name:"BackgroundCubeMaterial",uniforms:Uh(ta.backgroundCube.uniforms),vertexShader:ta.backgroundCube.vertexShader,fragmentShader:ta.backgroundCube.fragmentShader,side:ue,depthTest:!1,depthWrite:!1,fog:!1})),D.geometry.deleteAttribute("normal"),D.geometry.deleteAttribute("uv"),D.onBeforeRender=function(Te,Ce,Ie){this.matrixWorld.copyPosition(Ie.matrixWorld)},Object.defineProperty(D.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),m.update(D)),D.material.uniforms.envMap.value=ae,D.material.uniforms.envMapRotation.value=ae&&ae.rotation||0,D.material.uniforms.envMapIntensity.value=ae===K.environment&&K.envMapIntensity||1,D.material.uniforms.flipEnvMap.value=ae.isCubeTexture&&ae.isRenderTargetTexture===!1?-1:1,D.material.uniforms.backgroundBlurriness.value=K.backgroundBlurriness,D.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,D.material.toneMapped=ae.colorSpace!==Xn,G===ae&&V===ae.version&&Q===b.toneMapping||(D.material.needsUpdate=!0,G=ae,V=ae.version,Q=b.toneMapping),D.layers.enableAll(),te.unshift(D,D.geometry,D.material,0,0,null);else if(ae&&ae.isTexture||!ae&&ce){B===void 0&&(B=new Cs(new al(2,2),new gc({name:"BackgroundMaterial",uniforms:Uh(ta.background.uniforms),vertexShader:ta.background.vertexShader,fragmentShader:ta.background.fragmentShader,side:Pe,depthTest:!1,depthWrite:!1,fog:!1})),B.geometry.deleteAttribute("normal"),Object.defineProperty(B.material,"map",{get:function(){return this.uniforms.t2D.value}}),m.update(B)),B.material.uniforms.backgroundColor.value.set(ce||16777215),B.material.uniforms.t2D.value=ae,B.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,ae?(B.material.toneMapped=ae.colorSpace!==Xn,B.material.uniforms.flipX.value=ae.userData.flipX||!1,B.material.uniforms.flipY.value=ae.userData.flipY||!1,ae.matrixAutoUpdate===!0&&ae.updateMatrix(),B.material.uniforms.uvTransform.value.copy(ae.matrix),B.material.defines.HAS_TEXTURE="1"):B.material.defines.HAS_TEXTURE&&delete B.material.defines.HAS_TEXTURE;const Te=ae?ae.version:-1;G===ae&&V===Te&&Q===b.toneMapping||(B.material.needsUpdate=!0,G=ae,V=Te,Q=b.toneMapping),B.layers.enableAll(),te.unshift(B,B.geometry,B.material,0,0,null)}}}}function j1(b,r,c,p){const m=b.getParameter(b.MAX_VERTEX_ATTRIBS),_=p.isWebGL2?null:r.get("OES_vertex_array_object"),x=p.isWebGL2||_!==null,S={},B=Q(null);let D=B,U=!1;function G(Ce){return p.isWebGL2?b.bindVertexArray(Ce):_.bindVertexArrayOES(Ce)}function V(Ce){return p.isWebGL2?b.deleteVertexArray(Ce):_.deleteVertexArrayOES(Ce)}function Q(Ce){const Ie=[],Ke=[],ct=[];for(let Je=0;Je<m;Je++)Ie[Je]=0,Ke[Je]=0,ct[Je]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ie,enabledAttributes:Ke,attributeDivisors:ct,object:Ce,attributes:{},index:null}}function q(){const Ce=D.newAttributes;for(let Ie=0,Ke=Ce.length;Ie<Ke;Ie++)Ce[Ie]=0}function te(Ce){K(Ce,0)}function K(Ce,Ie){const Ke=D.newAttributes,ct=D.enabledAttributes,Je=D.attributeDivisors;Ke[Ce]=1,ct[Ce]===0&&(b.enableVertexAttribArray(Ce),ct[Ce]=1),Je[Ce]!==Ie&&((p.isWebGL2?b:r.get("ANGLE_instanced_arrays"))[p.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Ce,Ie),Je[Ce]=Ie)}function Z(){const Ce=D.newAttributes,Ie=D.enabledAttributes;for(let Ke=0,ct=Ie.length;Ke<ct;Ke++)Ie[Ke]!==Ce[Ke]&&(b.disableVertexAttribArray(Ke),Ie[Ke]=0)}function ae(Ce,Ie,Ke,ct,Je,yt){p.isWebGL2!==!0||Ke!==b.INT&&Ke!==b.UNSIGNED_INT?b.vertexAttribPointer(Ce,Ie,Ke,ct,Je,yt):b.vertexAttribIPointer(Ce,Ie,Ke,Je,yt)}function ce(){Te(),U=!0,D!==B&&(D=B,G(D.object))}function Te(){B.geometry=null,B.program=null,B.wireframe=!1}return{setup:function(Ce,Ie,Ke,ct,Je){let yt=!1;if(x){const Ze=function(Pt,kt,en){const xn=en.wireframe===!0;let tn=S[Pt.id];tn===void 0&&(tn={},S[Pt.id]=tn);let Wt=tn[kt.id];Wt===void 0&&(Wt={},tn[kt.id]=Wt);let dn=Wt[xn];return dn===void 0&&(dn=Q(p.isWebGL2?b.createVertexArray():_.createVertexArrayOES()),Wt[xn]=dn),dn}(ct,Ke,Ie);D!==Ze&&(D=Ze,G(D.object)),yt=function(Pt,kt,en,xn){const tn=D.attributes,Wt=kt.attributes;let dn=0;const pn=en.getAttributes();for(const It in pn)if(pn[It].location>=0){const Qt=tn[It];let un=Wt[It];if(un===void 0&&(It==="instanceMatrix"&&Pt.instanceMatrix&&(un=Pt.instanceMatrix),It==="instanceColor"&&Pt.instanceColor&&(un=Pt.instanceColor)),Qt===void 0||Qt.attribute!==un||un&&Qt.data!==un.data)return!0;dn++}return D.attributesNum!==dn||D.index!==xn}(Ce,ct,Ke,Je),yt&&function(Pt,kt,en,xn){const tn={},Wt=kt.attributes;let dn=0;const pn=en.getAttributes();for(const It in pn)if(pn[It].location>=0){let Qt=Wt[It];Qt===void 0&&(It==="instanceMatrix"&&Pt.instanceMatrix&&(Qt=Pt.instanceMatrix),It==="instanceColor"&&Pt.instanceColor&&(Qt=Pt.instanceColor));const un={};un.attribute=Qt,Qt&&Qt.data&&(un.data=Qt.data),tn[It]=un,dn++}D.attributes=tn,D.attributesNum=dn,D.index=xn}(Ce,ct,Ke,Je)}else{const Ze=Ie.wireframe===!0;D.geometry===ct.id&&D.program===Ke.id&&D.wireframe===Ze||(D.geometry=ct.id,D.program=Ke.id,D.wireframe=Ze,yt=!0)}Je!==null&&c.update(Je,b.ELEMENT_ARRAY_BUFFER),(yt||U)&&(U=!1,function(Ze,Pt,kt,en){if(p.isWebGL2===!1&&(Ze.isInstancedMesh||en.isInstancedBufferGeometry)&&r.get("ANGLE_instanced_arrays")===null)return;q();const xn=en.attributes,tn=kt.getAttributes(),Wt=Pt.defaultAttributeValues;for(const dn in tn){const pn=tn[dn];if(pn.location>=0){let It=xn[dn];if(It===void 0&&(dn==="instanceMatrix"&&Ze.instanceMatrix&&(It=Ze.instanceMatrix),dn==="instanceColor"&&Ze.instanceColor&&(It=Ze.instanceColor)),It!==void 0){const Qt=It.normalized,un=It.itemSize,Kt=c.get(It);if(Kt===void 0)continue;const bn=Kt.buffer,ni=Kt.type,Xe=Kt.bytesPerElement;if(It.isInterleavedBufferAttribute){const Le=It.data,_t=Le.stride,rt=It.offset;if(Le.isInstancedInterleavedBuffer){for(let Qe=0;Qe<pn.locationSize;Qe++)K(pn.location+Qe,Le.meshPerAttribute);Ze.isInstancedMesh!==!0&&en._maxInstanceCount===void 0&&(en._maxInstanceCount=Le.meshPerAttribute*Le.count)}else for(let Qe=0;Qe<pn.locationSize;Qe++)te(pn.location+Qe);b.bindBuffer(b.ARRAY_BUFFER,bn);for(let Qe=0;Qe<pn.locationSize;Qe++)ae(pn.location+Qe,un/pn.locationSize,ni,Qt,_t*Xe,(rt+un/pn.locationSize*Qe)*Xe)}else{if(It.isInstancedBufferAttribute){for(let Le=0;Le<pn.locationSize;Le++)K(pn.location+Le,It.meshPerAttribute);Ze.isInstancedMesh!==!0&&en._maxInstanceCount===void 0&&(en._maxInstanceCount=It.meshPerAttribute*It.count)}else for(let Le=0;Le<pn.locationSize;Le++)te(pn.location+Le);b.bindBuffer(b.ARRAY_BUFFER,bn);for(let Le=0;Le<pn.locationSize;Le++)ae(pn.location+Le,un/pn.locationSize,ni,Qt,un*Xe,un/pn.locationSize*Le*Xe)}}else if(Wt!==void 0){const Qt=Wt[dn];if(Qt!==void 0)switch(Qt.length){case 2:b.vertexAttrib2fv(pn.location,Qt);break;case 3:b.vertexAttrib3fv(pn.location,Qt);break;case 4:b.vertexAttrib4fv(pn.location,Qt);break;default:b.vertexAttrib1fv(pn.location,Qt)}}}}Z()}(Ce,Ie,Ke,ct),Je!==null&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.get(Je).buffer))},reset:ce,resetDefaultState:Te,dispose:function(){ce();for(const Ce in S){const Ie=S[Ce];for(const Ke in Ie){const ct=Ie[Ke];for(const Je in ct)V(ct[Je].object),delete ct[Je];delete Ie[Ke]}delete S[Ce]}},releaseStatesOfGeometry:function(Ce){if(S[Ce.id]===void 0)return;const Ie=S[Ce.id];for(const Ke in Ie){const ct=Ie[Ke];for(const Je in ct)V(ct[Je].object),delete ct[Je];delete Ie[Ke]}delete S[Ce.id]},releaseStatesOfProgram:function(Ce){for(const Ie in S){const Ke=S[Ie];if(Ke[Ce.id]===void 0)continue;const ct=Ke[Ce.id];for(const Je in ct)V(ct[Je].object),delete ct[Je];delete Ke[Ce.id]}},initAttributes:q,enableAttribute:te,disableUnusedAttributes:Z}}function V1(b,r,c,p){const m=p.isWebGL2;let _;this.setMode=function(x){_=x},this.render=function(x,S){b.drawArrays(_,x,S),c.update(S,_,1)},this.renderInstances=function(x,S,B){if(B===0)return;let D,U;if(m)D=b,U="drawArraysInstanced";else if(D=r.get("ANGLE_instanced_arrays"),U="drawArraysInstancedANGLE",D===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");D[U](_,x,S,B),c.update(S,_,B)}}function Q0(b,r,c){let p;function m(Te){if(Te==="highp"){if(b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_FLOAT).precision>0&&b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT).precision>0)return"highp";Te="mediump"}return Te==="mediump"&&b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_FLOAT).precision>0&&b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const _=typeof WebGL2RenderingContext<"u"&&b.constructor.name==="WebGL2RenderingContext";let x=c.precision!==void 0?c.precision:"highp";const S=m(x);S!==x&&(console.warn("THREE.WebGLRenderer:",x,"not supported, using",S,"instead."),x=S);const B=_||r.has("WEBGL_draw_buffers"),D=c.logarithmicDepthBuffer===!0,U=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS),G=b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS),V=b.getParameter(b.MAX_TEXTURE_SIZE),Q=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),q=b.getParameter(b.MAX_VERTEX_ATTRIBS),te=b.getParameter(b.MAX_VERTEX_UNIFORM_VECTORS),K=b.getParameter(b.MAX_VARYING_VECTORS),Z=b.getParameter(b.MAX_FRAGMENT_UNIFORM_VECTORS),ae=G>0,ce=_||r.has("OES_texture_float");return{isWebGL2:_,drawBuffers:B,getMaxAnisotropy:function(){if(p!==void 0)return p;if(r.has("EXT_texture_filter_anisotropic")===!0){const Te=r.get("EXT_texture_filter_anisotropic");p=b.getParameter(Te.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else p=0;return p},getMaxPrecision:m,precision:x,logarithmicDepthBuffer:D,maxTextures:U,maxVertexTextures:G,maxTextureSize:V,maxCubemapSize:Q,maxAttributes:q,maxVertexUniforms:te,maxVaryings:K,maxFragmentUniforms:Z,vertexTextures:ae,floatFragmentTextures:ce,floatVertexTextures:ae&&ce,maxSamples:_?b.getParameter(b.MAX_SAMPLES):0}}function lb(b){const r=this;let c=null,p=0,m=!1,_=!1;const x=new wa,S=new Ai,B={value:null,needsUpdate:!1};function D(U,G,V,Q){const q=U!==null?U.length:0;let te=null;if(q!==0){if(te=B.value,Q!==!0||te===null){const K=V+4*q,Z=G.matrixWorldInverse;S.getNormalMatrix(Z),(te===null||te.length<K)&&(te=new Float32Array(K));for(let ae=0,ce=V;ae!==q;++ae,ce+=4)x.copy(U[ae]).applyMatrix4(Z,S),x.normal.toArray(te,ce),te[ce+3]=x.constant}B.value=te,B.needsUpdate=!0}return r.numPlanes=q,r.numIntersection=0,te}this.uniform=B,this.numPlanes=0,this.numIntersection=0,this.init=function(U,G){const V=U.length!==0||G||p!==0||m;return m=G,p=U.length,V},this.beginShadows=function(){_=!0,D(null)},this.endShadows=function(){_=!1},this.setGlobalState=function(U,G){c=D(U,G,0)},this.setState=function(U,G,V){const Q=U.clippingPlanes,q=U.clipIntersection,te=U.clipShadows,K=b.get(U);if(!m||Q===null||Q.length===0||_&&!te)_?D(null):(B.value!==c&&(B.value=c,B.needsUpdate=p>0),r.numPlanes=p,r.numIntersection=0);else{const Z=_?0:p,ae=4*Z;let ce=K.clippingState||null;B.value=ce,ce=D(Q,G,ae,V);for(let Te=0;Te!==ae;++Te)ce[Te]=c[Te];K.clippingState=ce,this.numIntersection=q?this.numPlanes:0,this.numPlanes+=Z}}}function G1(b){let r=new WeakMap;function c(m,_){return _===Dr?m.mapping=zr:_===_r&&(m.mapping=Sr),m}function p(m){const _=m.target;_.removeEventListener("dispose",p);const x=r.get(_);x!==void 0&&(r.delete(_),x.dispose())}return{get:function(m){if(m&&m.isTexture&&m.isRenderTargetTexture===!1){const _=m.mapping;if(_===Dr||_===_r){if(r.has(m)){const x=r.get(m).texture;return x.rotation=m.rotation,c(x,m.mapping)}{const x=m.image;if(x&&x.height>0){const S=new G0(x.height/2);return S.fromEquirectangularTexture(b,m),S.texture.rotation=m.rotation,r.set(m,S),m.addEventListener("dispose",p),c(S.texture,m.mapping)}return null}}}return m},dispose:function(){r=new WeakMap}}}class jv extends Nv{constructor(r=-1,c=1,p=1,m=-1,_=.1,x=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=c,this.top=p,this.bottom=m,this.near=_,this.far=x,this.updateProjectionMatrix()}copy(r,c){return super.copy(r,c),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,c,p,m,_,x){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=c,this.view.offsetX=p,this.view.offsetY=m,this.view.width=_,this.view.height=x,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),p=(this.right+this.left)/2,m=(this.top+this.bottom)/2;let _=p-r,x=p+r,S=m+c,B=m-c;if(this.view!==null&&this.view.enabled){const D=(this.right-this.left)/this.view.fullWidth/this.zoom,U=(this.top-this.bottom)/this.view.fullHeight/this.zoom;_+=D*this.view.offsetX,x=_+D*this.view.width,S-=U*this.view.offsetY,B=S-U*this.view.height}this.projectionMatrix.makeOrthographic(_,x,S,B,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const c=super.toJSON(r);return c.object.zoom=this.zoom,c.object.left=this.left,c.object.right=this.right,c.object.top=this.top,c.object.bottom=this.bottom,c.object.near=this.near,c.object.far=this.far,this.view!==null&&(c.object.view=Object.assign({},this.view)),c}}const cb=[.125,.215,.35,.446,.526,.582],Zm=20,ip=new jv,Vv=new En;let Gv=null;const Lu=(1+Math.sqrt(5))/2,rp=1/Lu,W0=[new ze(1,1,1),new ze(-1,1,1),new ze(1,1,-1),new ze(-1,1,-1),new ze(0,Lu,rp),new ze(0,Lu,-rp),new ze(rp,0,Lu),new ze(-rp,0,Lu),new ze(Lu,rp,0),new ze(-Lu,rp,0)];class Yt{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(r,c=0,p=.1,m=100){Gv=this._renderer.getRenderTarget(),this._setSize(256);const _=this._allocateTargets();return _.depthBuffer=!0,this._sceneToCubeUV(r,p,m,_),c>0&&this._blur(_,0,0,c),this._applyPMREM(_),this._cleanup(_),_}fromEquirectangular(r,c=null){return this._fromTexture(r,c)}fromCubemap(r,c=null){return this._fromTexture(r,c)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=sp(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Hv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(r){this._lodMax=Math.floor(Math.log2(r)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let r=0;r<this._lodPlanes.length;r++)this._lodPlanes[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(Gv),r.scissorTest=!1,Jc(r,0,0,r.width,r.height)}_fromTexture(r,c){r.mapping===zr||r.mapping===Sr?this._setSize(r.image.length===0?16:r.image[0].width||r.image[0].image.width):this._setSize(r.image.width/4),Gv=this._renderer.getRenderTarget();const p=c||this._allocateTargets();return this._textureToCubeUV(r,p),this._applyPMREM(p),this._cleanup(p),p}_allocateTargets(){const r=3*Math.max(this._cubeSize,112),c=4*this._cubeSize,p={magFilter:Cr,minFilter:Cr,generateMipmaps:!1,type:Ja,format:Ls,colorSpace:vi,depthBuffer:!1},m=q0(r,c,p);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==r||this._pingPongRenderTarget.height!==c){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=q0(r,c,p);const{_lodMax:_}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(x){const S=[],B=[],D=[];let U=x;const G=x-4+1+cb.length;for(let V=0;V<G;V++){const Q=Math.pow(2,U);B.push(Q);let q=1/Q;V>x-4?q=cb[V-x+4-1]:V===0&&(q=0),D.push(q);const te=1/(Q-2),K=-te,Z=1+te,ae=[K,K,Z,K,Z,Z,K,K,Z,Z,K,Z],ce=6,Te=6,Ce=3,Ie=2,Ke=1,ct=new Float32Array(Ce*Te*ce),Je=new Float32Array(Ie*Te*ce),yt=new Float32Array(Ke*Te*ce);for(let Pt=0;Pt<ce;Pt++){const kt=Pt%3*2/3-1,en=Pt>2?0:-1,xn=[kt,en,0,kt+2/3,en,0,kt+2/3,en+1,0,kt,en,0,kt+2/3,en+1,0,kt,en+1,0];ct.set(xn,Ce*Te*Pt),Je.set(ae,Ie*Te*Pt);const tn=[Pt,Pt,Pt,Pt,Pt,Pt];yt.set(tn,Ke*Te*Pt)}const Ze=new ee;Ze.setAttribute("position",new ur(ct,Ce)),Ze.setAttribute("uv",new ur(Je,Ie)),Ze.setAttribute("faceIndex",new ur(yt,Ke)),S.push(Ze),U>4&&U--}return{lodPlanes:S,sizeLods:B,sigmas:D}}(_)),this._blurMaterial=function(x,S,B){const D=new Float32Array(Zm),U=new ze(0,1,0);return new gc({name:"SphericalGaussianBlur",defines:{n:Zm,CUBEUV_TEXEL_WIDTH:1/S,CUBEUV_TEXEL_HEIGHT:1/B,CUBEUV_MAX_MIP:`${x}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:D},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:U}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Fe,depthTest:!1,depthWrite:!1})}(_,r,c)}return m}_compileMaterial(r){const c=new Cs(this._lodPlanes[0],r);this._renderer.compile(c,ip)}_sceneToCubeUV(r,c,p,m){const _=new xa(90,1,c,p),x=[1,-1,1,1,1,1],S=[1,1,1,-1,-1,-1],B=this._renderer,D=B.autoClear,U=B.toneMapping;B.getClearColor(Vv),B.toneMapping=Ni,B.autoClear=!1;const G=new Lo({name:"PMREM.Background",side:ue,depthWrite:!1,depthTest:!1}),V=new Cs(new Ul,G);let Q=!1;const q=r.background;q?q.isColor&&(G.color.copy(q),r.background=null,Q=!0):(G.color.copy(Vv),Q=!0);for(let te=0;te<6;te++){const K=te%3;K===0?(_.up.set(0,x[te],0),_.lookAt(S[te],0,0)):K===1?(_.up.set(0,0,x[te]),_.lookAt(0,S[te],0)):(_.up.set(0,x[te],0),_.lookAt(0,0,S[te]));const Z=this._cubeSize;Jc(m,K*Z,te>2?Z:0,Z,Z),B.setRenderTarget(m),Q&&B.render(V,_),B.render(r,_)}V.geometry.dispose(),V.material.dispose(),B.toneMapping=U,B.autoClear=D,r.background=q}_textureToCubeUV(r,c){const p=this._renderer,m=r.mapping===zr||r.mapping===Sr;m?(this._cubemapMaterial===null&&(this._cubemapMaterial=sp()),this._cubemapMaterial.uniforms.flipEnvMap.value=r.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Hv());const _=m?this._cubemapMaterial:this._equirectMaterial,x=new Cs(this._lodPlanes[0],_);_.uniforms.envMap.value=r;const S=this._cubeSize;Jc(c,0,0,3*S,2*S),p.setRenderTarget(c),p.render(x,ip)}_applyPMREM(r){const c=this._renderer,p=c.autoClear;c.autoClear=!1;for(let m=1;m<this._lodPlanes.length;m++){const _=Math.sqrt(this._sigmas[m]*this._sigmas[m]-this._sigmas[m-1]*this._sigmas[m-1]),x=W0[(m-1)%W0.length];this._blur(r,m-1,m,_,x)}c.autoClear=p}_blur(r,c,p,m,_){const x=this._pingPongRenderTarget;this._halfBlur(r,x,c,p,m,"latitudinal",_),this._halfBlur(x,r,p,p,m,"longitudinal",_)}_halfBlur(r,c,p,m,_,x,S){const B=this._renderer,D=this._blurMaterial;x!=="latitudinal"&&x!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const U=new Cs(this._lodPlanes[m],D),G=D.uniforms,V=this._sizeLods[p]-1,Q=isFinite(_)?Math.PI/(2*V):2*Math.PI/39,q=_/Q,te=isFinite(_)?1+Math.floor(3*q):Zm;te>Zm&&console.warn(`sigmaRadians, ${_}, is too large and will clip, as it requested ${te} samples when the maximum is set to 20`);const K=[];let Z=0;for(let Te=0;Te<Zm;++Te){const Ce=Te/q,Ie=Math.exp(-Ce*Ce/2);K.push(Ie),Te===0?Z+=Ie:Te<te&&(Z+=2*Ie)}for(let Te=0;Te<K.length;Te++)K[Te]=K[Te]/Z;G.envMap.value=r.texture,G.samples.value=te,G.weights.value=K,G.latitudinal.value=x==="latitudinal",S&&(G.poleAxis.value=S);const{_lodMax:ae}=this;G.dTheta.value=Q,G.mipInt.value=ae-p;const ce=this._sizeLods[m];Jc(c,3*ce*(m>ae-4?m-ae+4:0),4*(this._cubeSize-ce),3*ce,2*ce),B.setRenderTarget(c),B.render(U,ip)}}function q0(b,r,c){const p=new ms(b,r,c);return p.texture.mapping=Oa,p.texture.name="PMREM.cubeUv",p.scissorTest=!0,p}function Jc(b,r,c,p,m){b.viewport.set(r,c,p,m),b.scissor.set(r,c,p,m)}function Hv(){return new gc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Fe,depthTest:!1,depthWrite:!1})}function sp(){return new gc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Fe,depthTest:!1,depthWrite:!1})}function ol(b){let r=new WeakMap,c=null;function p(m){const _=m.target;_.removeEventListener("dispose",p);const x=r.get(_);x!==void 0&&(r.delete(_),x.dispose())}return{get:function(m){if(m&&m.isTexture){const _=m.mapping,x=_===Dr||_===_r,S=_===zr||_===Sr;if(x||S){if(m.isRenderTargetTexture&&m.needsPMREMUpdate===!0){m.needsPMREMUpdate=!1;let B=r.get(m);return c===null&&(c=new Yt(b)),B=x?c.fromEquirectangular(m,B):c.fromCubemap(m,B),r.set(m,B),B.texture}if(r.has(m))return r.get(m).texture;{const B=m.image;if(x&&B&&B.height>0||S&&B&&function(D){let U=0;for(let G=0;G<6;G++)D[G]!==void 0&&U++;return U===6}(B)){c===null&&(c=new Yt(b));const D=x?c.fromEquirectangular(m):c.fromCubemap(m);return r.set(m,D),m.addEventListener("dispose",p),D.texture}return null}}}return m},dispose:function(){r=new WeakMap,c!==null&&(c.dispose(),c=null)}}}function Qv(b){const r={};function c(p){if(r[p]!==void 0)return r[p];let m;switch(p){case"WEBGL_depth_texture":m=b.getExtension("WEBGL_depth_texture")||b.getExtension("MOZ_WEBGL_depth_texture")||b.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":m=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":m=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":m=b.getExtension("WEBGL_compressed_texture_pvrtc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:m=b.getExtension(p)}return r[p]=m,m}return{has:function(p){return c(p)!==null},init:function(p){p.isWebGL2?c("EXT_color_buffer_float"):(c("WEBGL_depth_texture"),c("OES_texture_float"),c("OES_texture_half_float"),c("OES_texture_half_float_linear"),c("OES_standard_derivatives"),c("OES_element_index_uint"),c("OES_vertex_array_object"),c("ANGLE_instanced_arrays")),c("OES_texture_float_linear"),c("EXT_color_buffer_half_float"),c("WEBGL_multisampled_render_to_texture")},get:function(p){const m=c(p);return m===null&&console.warn("THREE.WebGLRenderer: "+p+" extension not supported."),m}}}function H1(b,r,c,p){const m={},_=new WeakMap;function x(B){const D=B.target;D.index!==null&&r.remove(D.index);for(const G in D.attributes)r.remove(D.attributes[G]);D.removeEventListener("dispose",x),delete m[D.id];const U=_.get(D);U&&(r.remove(U),_.delete(D)),p.releaseStatesOfGeometry(D),D.isInstancedBufferGeometry===!0&&delete D._maxInstanceCount,c.memory.geometries--}function S(B){const D=[],U=B.index,G=B.attributes.position;let V=0;if(U!==null){const te=U.array;V=U.version;for(let K=0,Z=te.length;K<Z;K+=3){const ae=te[K+0],ce=te[K+1],Te=te[K+2];D.push(ae,ce,ce,Te,Te,ae)}}else{const te=G.array;V=G.version;for(let K=0,Z=te.length/3-1;K<Z;K+=3){const ae=K+0,ce=K+1,Te=K+2;D.push(ae,ce,ce,Te,Te,ae)}}const Q=new(Dv(D)?Fs:Aa)(D,1);Q.version=V;const q=_.get(B);q&&r.remove(q),_.set(B,Q)}return{get:function(B,D){return m[D.id]===!0||(D.addEventListener("dispose",x),m[D.id]=!0,c.memory.geometries++),D},update:function(B){const D=B.attributes;for(const G in D)r.update(D[G],b.ARRAY_BUFFER);const U=B.morphAttributes;for(const G in U){const V=U[G];for(let Q=0,q=V.length;Q<q;Q++)r.update(V[Q],b.ARRAY_BUFFER)}},getWireframeAttribute:function(B){const D=_.get(B);if(D){const U=B.index;U!==null&&D.version<U.version&&S(B)}else S(B);return _.get(B)}}}function Q1(b,r,c,p){const m=p.isWebGL2;let _,x,S;this.setMode=function(B){_=B},this.setIndex=function(B){x=B.type,S=B.bytesPerElement},this.render=function(B,D){b.drawElements(_,D,x,B*S),c.update(D,_,1)},this.renderInstances=function(B,D,U){if(U===0)return;let G,V;if(m)G=b,V="drawElementsInstanced";else if(G=r.get("ANGLE_instanced_arrays"),V="drawElementsInstancedANGLE",G===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");G[V](_,D,x,B*S,U),c.update(D,_,U)}}function vc(b){const r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(c,p,m){switch(r.calls++,p){case b.TRIANGLES:r.triangles+=m*(c/3);break;case b.LINES:r.lines+=m*(c/2);break;case b.LINE_STRIP:r.lines+=m*(c-1);break;case b.LINE_LOOP:r.lines+=m*c;break;case b.POINTS:r.points+=m*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",p)}}}}function ub(b,r){return b[0]-r[0]}function Ou(b,r){return Math.abs(r[1])-Math.abs(b[1])}function Wv(b,r,c){const p={},m=new Float32Array(8),_=new WeakMap,x=new Ji,S=[];for(let B=0;B<8;B++)S[B]=[B,0];return{update:function(B,D,U){const G=B.morphTargetInfluences;if(r.isWebGL2===!0){const V=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,Q=V!==void 0?V.length:0;let q=_.get(D);if(q===void 0||q.count!==Q){q!==void 0&&q.texture.dispose();const Z=D.morphAttributes.position!==void 0,ae=D.morphAttributes.normal!==void 0,ce=D.morphAttributes.color!==void 0,Te=D.morphAttributes.position||[],Ce=D.morphAttributes.normal||[],Ie=D.morphAttributes.color||[];let Ke=0;Z===!0&&(Ke=1),ae===!0&&(Ke=2),ce===!0&&(Ke=3);let ct=D.attributes.position.count*Ke,Je=1;ct>r.maxTextureSize&&(Je=Math.ceil(ct/r.maxTextureSize),ct=r.maxTextureSize);const yt=new Float32Array(ct*Je*4*Q),Ze=new no(yt,ct,Je,Q);Ze.type=wl,Ze.needsUpdate=!0;const Pt=4*Ke;for(let kt=0;kt<Q;kt++){const en=Te[kt],xn=Ce[kt],tn=Ie[kt],Wt=ct*Je*4*kt;for(let dn=0;dn<en.count;dn++){const pn=dn*Pt;Z===!0&&(x.fromBufferAttribute(en,dn),yt[Wt+pn+0]=x.x,yt[Wt+pn+1]=x.y,yt[Wt+pn+2]=x.z,yt[Wt+pn+3]=0),ae===!0&&(x.fromBufferAttribute(xn,dn),yt[Wt+pn+4]=x.x,yt[Wt+pn+5]=x.y,yt[Wt+pn+6]=x.z,yt[Wt+pn+7]=0),ce===!0&&(x.fromBufferAttribute(tn,dn),yt[Wt+pn+8]=x.x,yt[Wt+pn+9]=x.y,yt[Wt+pn+10]=x.z,yt[Wt+pn+11]=tn.itemSize===4?x.w:1)}}q={count:Q,texture:Ze,size:new qt(ct,Je)},_.set(D,q),D.addEventListener("dispose",function kt(){Ze.dispose(),_.delete(D),D.removeEventListener("dispose",kt)})}let te=0;for(let Z=0;Z<G.length;Z++)te+=G[Z];const K=D.morphTargetsRelative?1:1-te;U.getUniforms().setValue(b,"morphTargetBaseInfluence",K),U.getUniforms().setValue(b,"morphTargetInfluences",G),U.getUniforms().setValue(b,"morphTargetsTexture",q.texture,c),U.getUniforms().setValue(b,"morphTargetsTextureSize",q.size)}else{const V=G===void 0?0:G.length;let Q=p[D.id];if(Q===void 0||Q.length!==V){Q=[];for(let ae=0;ae<V;ae++)Q[ae]=[ae,0];p[D.id]=Q}for(let ae=0;ae<V;ae++){const ce=Q[ae];ce[0]=ae,ce[1]=G[ae]}Q.sort(Ou);for(let ae=0;ae<8;ae++)ae<V&&Q[ae][1]?(S[ae][0]=Q[ae][0],S[ae][1]=Q[ae][1]):(S[ae][0]=Number.MAX_SAFE_INTEGER,S[ae][1]=0);S.sort(ub);const q=D.morphAttributes.position,te=D.morphAttributes.normal;let K=0;for(let ae=0;ae<8;ae++){const ce=S[ae],Te=ce[0],Ce=ce[1];Te!==Number.MAX_SAFE_INTEGER&&Ce?(q&&D.getAttribute("morphTarget"+ae)!==q[Te]&&D.setAttribute("morphTarget"+ae,q[Te]),te&&D.getAttribute("morphNormal"+ae)!==te[Te]&&D.setAttribute("morphNormal"+ae,te[Te]),m[ae]=Ce,K+=Ce):(q&&D.hasAttribute("morphTarget"+ae)===!0&&D.deleteAttribute("morphTarget"+ae),te&&D.hasAttribute("morphNormal"+ae)===!0&&D.deleteAttribute("morphNormal"+ae),m[ae]=0)}const Z=D.morphTargetsRelative?1:1-K;U.getUniforms().setValue(b,"morphTargetBaseInfluence",Z),U.getUniforms().setValue(b,"morphTargetInfluences",m)}}}}function hb(b,r,c,p){let m=new WeakMap;function _(x){const S=x.target;S.removeEventListener("dispose",_),c.remove(S.instanceMatrix),S.instanceColor!==null&&c.remove(S.instanceColor)}return{update:function(x){const S=p.render.frame,B=x.geometry,D=r.get(x,B);return m.get(D)!==S&&(r.update(D),m.set(D,S)),x.isInstancedMesh&&(x.hasEventListener("dispose",_)===!1&&x.addEventListener("dispose",_),c.update(x.instanceMatrix,b.ARRAY_BUFFER),x.instanceColor!==null&&c.update(x.instanceColor,b.ARRAY_BUFFER)),D},dispose:function(){m=new WeakMap}}}const Zc=new pr,ku=new no,X0=new xf,Nl=new np,Df=[],$m=[],qv=new Float32Array(16),ap=new Float32Array(9),Bf=new Float32Array(4);function $c(b,r,c){const p=b[0];if(p<=0||p>0)return b;const m=r*c;let _=Df[m];if(_===void 0&&(_=new Float32Array(m),Df[m]=_),r!==0){p.toArray(_,0);for(let x=1,S=0;x!==r;++x)S+=c,b[x].toArray(_,S)}return _}function Ts(b,r){if(b.length!==r.length)return!1;for(let c=0,p=b.length;c<p;c++)if(b[c]!==r[c])return!1;return!0}function as(b,r){for(let c=0,p=r.length;c<p;c++)b[c]=r[c]}function ro(b,r){let c=$m[r];c===void 0&&(c=new Int32Array(r),$m[r]=c);for(let p=0;p!==r;++p)c[p]=b.allocateTextureUnit();return c}function _c(b,r){const c=this.cache;c[0]!==r&&(b.uniform1f(this.addr,r),c[0]=r)}function eg(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y||(b.uniform2f(this.addr,r.x,r.y),c[0]=r.x,c[1]=r.y);else{if(Ts(c,r))return;b.uniform2fv(this.addr,r),as(c,r)}}function db(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y&&c[2]===r.z||(b.uniform3f(this.addr,r.x,r.y,r.z),c[0]=r.x,c[1]=r.y,c[2]=r.z);else if(r.r!==void 0)c[0]===r.r&&c[1]===r.g&&c[2]===r.b||(b.uniform3f(this.addr,r.r,r.g,r.b),c[0]=r.r,c[1]=r.g,c[2]=r.b);else{if(Ts(c,r))return;b.uniform3fv(this.addr,r),as(c,r)}}function Y0(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y&&c[2]===r.z&&c[3]===r.w||(b.uniform4f(this.addr,r.x,r.y,r.z,r.w),c[0]=r.x,c[1]=r.y,c[2]=r.z,c[3]=r.w);else{if(Ts(c,r))return;b.uniform4fv(this.addr,r),as(c,r)}}function tg(b,r){const c=this.cache,p=r.elements;if(p===void 0){if(Ts(c,r))return;b.uniformMatrix2fv(this.addr,!1,r),as(c,r)}else{if(Ts(c,p))return;Bf.set(p),b.uniformMatrix2fv(this.addr,!1,Bf),as(c,p)}}function op(b,r){const c=this.cache,p=r.elements;if(p===void 0){if(Ts(c,r))return;b.uniformMatrix3fv(this.addr,!1,r),as(c,r)}else{if(Ts(c,p))return;ap.set(p),b.uniformMatrix3fv(this.addr,!1,ap),as(c,p)}}function Uu(b,r){const c=this.cache,p=r.elements;if(p===void 0){if(Ts(c,r))return;b.uniformMatrix4fv(this.addr,!1,r),as(c,r)}else{if(Ts(c,p))return;qv.set(p),b.uniformMatrix4fv(this.addr,!1,qv),as(c,p)}}function yc(b,r){const c=this.cache;c[0]!==r&&(b.uniform1i(this.addr,r),c[0]=r)}function pb(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y||(b.uniform2i(this.addr,r.x,r.y),c[0]=r.x,c[1]=r.y);else{if(Ts(c,r))return;b.uniform2iv(this.addr,r),as(c,r)}}function ll(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y&&c[2]===r.z||(b.uniform3i(this.addr,r.x,r.y,r.z),c[0]=r.x,c[1]=r.y,c[2]=r.z);else{if(Ts(c,r))return;b.uniform3iv(this.addr,r),as(c,r)}}function fb(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y&&c[2]===r.z&&c[3]===r.w||(b.uniform4i(this.addr,r.x,r.y,r.z,r.w),c[0]=r.x,c[1]=r.y,c[2]=r.z,c[3]=r.w);else{if(Ts(c,r))return;b.uniform4iv(this.addr,r),as(c,r)}}function Lf(b,r){const c=this.cache;c[0]!==r&&(b.uniform1ui(this.addr,r),c[0]=r)}function mb(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y||(b.uniform2ui(this.addr,r.x,r.y),c[0]=r.x,c[1]=r.y);else{if(Ts(c,r))return;b.uniform2uiv(this.addr,r),as(c,r)}}function W1(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y&&c[2]===r.z||(b.uniform3ui(this.addr,r.x,r.y,r.z),c[0]=r.x,c[1]=r.y,c[2]=r.z);else{if(Ts(c,r))return;b.uniform3uiv(this.addr,r),as(c,r)}}function Fh(b,r){const c=this.cache;if(r.x!==void 0)c[0]===r.x&&c[1]===r.y&&c[2]===r.z&&c[3]===r.w||(b.uniform4ui(this.addr,r.x,r.y,r.z,r.w),c[0]=r.x,c[1]=r.y,c[2]=r.z,c[3]=r.w);else{if(Ts(c,r))return;b.uniform4uiv(this.addr,r),as(c,r)}}function K0(b,r,c){const p=this.cache,m=c.allocateTextureUnit();p[0]!==m&&(b.uniform1i(this.addr,m),p[0]=m),c.setTexture2D(r||Zc,m)}function gb(b,r,c){const p=this.cache,m=c.allocateTextureUnit();p[0]!==m&&(b.uniform1i(this.addr,m),p[0]=m),c.setTexture3D(r||X0,m)}function J0(b,r,c){const p=this.cache,m=c.allocateTextureUnit();p[0]!==m&&(b.uniform1i(this.addr,m),p[0]=m),c.setTextureCube(r||Nl,m)}function na(b,r,c){const p=this.cache,m=c.allocateTextureUnit();p[0]!==m&&(b.uniform1i(this.addr,m),p[0]=m),c.setTexture2DArray(r||ku,m)}function Nu(b,r){b.uniform1fv(this.addr,r)}function Z0(b,r){const c=$c(r,this.size,2);b.uniform2fv(this.addr,c)}function zh(b,r){const c=$c(r,this.size,3);b.uniform3fv(this.addr,c)}function vb(b,r){const c=$c(r,this.size,4);b.uniform4fv(this.addr,c)}function cl(b,r){const c=$c(r,this.size,4);b.uniformMatrix2fv(this.addr,!1,c)}function $0(b,r){const c=$c(r,this.size,9);b.uniformMatrix3fv(this.addr,!1,c)}function q1(b,r){const c=$c(r,this.size,16);b.uniformMatrix4fv(this.addr,!1,c)}function X1(b,r){b.uniform1iv(this.addr,r)}function ng(b,r){b.uniform2iv(this.addr,r)}function _b(b,r){b.uniform3iv(this.addr,r)}function yb(b,r){b.uniform4iv(this.addr,r)}function Ab(b,r){b.uniform1uiv(this.addr,r)}function ig(b,r){b.uniform2uiv(this.addr,r)}function bb(b,r){b.uniform3uiv(this.addr,r)}function lp(b,r){b.uniform4uiv(this.addr,r)}function Of(b,r,c){const p=this.cache,m=r.length,_=ro(c,m);Ts(p,_)||(b.uniform1iv(this.addr,_),as(p,_));for(let x=0;x!==m;++x)c.setTexture2D(r[x]||Zc,_[x])}function rg(b,r,c){const p=this.cache,m=r.length,_=ro(c,m);Ts(p,_)||(b.uniform1iv(this.addr,_),as(p,_));for(let x=0;x!==m;++x)c.setTexture3D(r[x]||X0,_[x])}function Xv(b,r,c){const p=this.cache,m=r.length,_=ro(c,m);Ts(p,_)||(b.uniform1iv(this.addr,_),as(p,_));for(let x=0;x!==m;++x)c.setTextureCube(r[x]||Nl,_[x])}function kf(b,r,c){const p=this.cache,m=r.length,_=ro(c,m);Ts(p,_)||(b.uniform1iv(this.addr,_),as(p,_));for(let x=0;x!==m;++x)c.setTexture2DArray(r[x]||ku,_[x])}class sg{constructor(r,c,p){this.id=r,this.addr=p,this.cache=[],this.setValue=function(m){switch(m){case 5126:return _c;case 35664:return eg;case 35665:return db;case 35666:return Y0;case 35674:return tg;case 35675:return op;case 35676:return Uu;case 5124:case 35670:return yc;case 35667:case 35671:return pb;case 35668:case 35672:return ll;case 35669:case 35673:return fb;case 5125:return Lf;case 36294:return mb;case 36295:return W1;case 36296:return Fh;case 35678:case 36198:case 36298:case 36306:case 35682:return K0;case 35679:case 36299:case 36307:return gb;case 35680:case 36300:case 36308:case 36293:return J0;case 36289:case 36303:case 36311:case 36292:return na}}(c.type)}}class xb{constructor(r,c,p){this.id=r,this.addr=p,this.cache=[],this.size=c.size,this.setValue=function(m){switch(m){case 5126:return Nu;case 35664:return Z0;case 35665:return zh;case 35666:return vb;case 35674:return cl;case 35675:return $0;case 35676:return q1;case 5124:case 35670:return X1;case 35667:case 35671:return ng;case 35668:case 35672:return _b;case 35669:case 35673:return yb;case 5125:return Ab;case 36294:return ig;case 36295:return bb;case 36296:return lp;case 35678:case 36198:case 36298:case 36306:case 35682:return Of;case 35679:case 36299:case 36307:return rg;case 35680:case 36300:case 36308:case 36293:return Xv;case 36289:case 36303:case 36311:case 36292:return kf}}(c.type)}}class wb{constructor(r){this.id=r,this.seq=[],this.map={}}setValue(r,c,p){const m=this.seq;for(let _=0,x=m.length;_!==x;++_){const S=m[_];S.setValue(r,c[S.id],p)}}}const Uf=/(\w+)(\])?(\[|\.)?/g;function jh(b,r){b.seq.push(r),b.map[r.id]=r}function ey(b,r,c){const p=b.name,m=p.length;for(Uf.lastIndex=0;;){const _=Uf.exec(p),x=Uf.lastIndex;let S=_[1];const B=_[2]==="]",D=_[3];if(B&&(S|=0),D===void 0||D==="["&&x+2===m){jh(c,D===void 0?new sg(S,b,r):new xb(S,b,r));break}{let U=c.map[S];U===void 0&&(U=new wb(S),jh(c,U)),c=U}}}class Fl{constructor(r,c){this.seq=[],this.map={};const p=r.getProgramParameter(c,r.ACTIVE_UNIFORMS);for(let m=0;m<p;++m){const _=r.getActiveUniform(c,m);ey(_,r.getUniformLocation(c,_.name),this)}}setValue(r,c,p,m){const _=this.map[c];_!==void 0&&_.setValue(r,p,m)}setOptional(r,c,p){const m=c[p];m!==void 0&&this.setValue(r,p,m)}static upload(r,c,p,m){for(let _=0,x=c.length;_!==x;++_){const S=c[_],B=p[S.id];B.needsUpdate!==!1&&S.setValue(r,B.value,m)}}static seqWithValue(r,c){const p=[];for(let m=0,_=r.length;m!==_;++m){const x=r[m];x.id in c&&p.push(x)}return p}}function ty(b,r,c){const p=b.createShader(r);return b.shaderSource(p,c),b.compileShader(p),p}let Eb=0;function Yv(b){switch(b){case Mo:case vi:return["Linear","( value )"];case Xn:return["sRGB","( value )"];case Co:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",b),["Linear","( value )"]}}function Kv(b,r,c){const p=b.getShaderParameter(r,b.COMPILE_STATUS),m=b.getShaderInfoLog(r).trim();if(p&&m==="")return"";const _=/ERROR: 0:(\d+)/.exec(m);if(_){const x=parseInt(_[1]);return c.toUpperCase()+`

`+m+`

`+function(S,B){const D=S.split(`
`),U=[],G=Math.max(B-6,0),V=Math.min(B+6,D.length);for(let Q=G;Q<V;Q++){const q=Q+1;U.push(`${q===B?">":" "} ${q}: ${D[Q]}`)}return U.join(`
`)}(b.getShaderSource(r),x)}return m}function ny(b,r){const c=Yv(r);return"vec4 "+b+"( vec4 value ) { return "+c[0]+"ToLinear"+c[1]+"; }"}function cp(b,r){const c=Yv(r);return"vec4 "+b+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function ko(b,r){let c;switch(r){case qr:c="Linear";break;case Er:c="Reinhard";break;case vr:c="OptimizedCineon";break;case Ya:c="ACESFilmic";break;case Ao:c="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",r),c="Linear"}return"vec3 "+b+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function zl(b){return b!==""}function Or(b,r){const c=r.numSpotLightShadows+r.numSpotLightMaps-r.numSpotLightShadowsWithMaps;return b.replace(/NUM_DIR_LIGHTS/g,r.numDirLights).replace(/NUM_SPOT_LIGHTS/g,r.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,r.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,c).replace(/NUM_RECT_AREA_LIGHTS/g,r.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,r.numPointLights).replace(/NUM_HEMI_LIGHTS/g,r.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,r.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,r.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,r.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,r.numPointLightShadows)}function iy(b,r){return b.replace(/NUM_CLIPPING_PLANES/g,r.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,r.numClippingPlanes-r.numClipIntersection)}const ry=/^[ \t]*#include +<([\w\d./]+)>/gm;function Jv(b){return b.replace(ry,Sb)}function Sb(b,r){const c=bi[r];if(c===void 0)throw new Error("Can not resolve #include <"+r+">");return Jv(c)}const Mb=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Cb(b){return b.replace(Mb,Y1)}function Y1(b,r,c,p){let m="";for(let _=parseInt(r);_<parseInt(c);_++)m+=p.replace(/\[\s*i\s*\]/g,"[ "+_+" ]").replace(/UNROLLED_LOOP_INDEX/g,_);return m}function Tb(b){let r="precision "+b.precision+` float;
precision `+b.precision+" int;";return b.precision==="highp"?r+=`
#define HIGH_PRECISION`:b.precision==="mediump"?r+=`
#define MEDIUM_PRECISION`:b.precision==="lowp"&&(r+=`
#define LOW_PRECISION`),r}function K1(b,r,c,p){const m=b.getContext(),_=c.defines;let x=c.vertexShader,S=c.fragmentShader;const B=function(Je){let yt="SHADOWMAP_TYPE_BASIC";return Je.shadowMapType===fe?yt="SHADOWMAP_TYPE_PCF":Je.shadowMapType===me?yt="SHADOWMAP_TYPE_PCF_SOFT":Je.shadowMapType===de&&(yt="SHADOWMAP_TYPE_VSM"),yt}(c),D=function(Je){let yt="ENVMAP_TYPE_CUBE";if(Je.envMap)switch(Je.envMapMode){case zr:case Sr:yt="ENVMAP_TYPE_CUBE";break;case Oa:yt="ENVMAP_TYPE_CUBE_UV"}return yt}(c),U=function(Je){let yt="ENVMAP_MODE_REFLECTION";return Je.envMap&&Je.envMapMode===Sr&&(yt="ENVMAP_MODE_REFRACTION"),yt}(c),G=function(Je){let yt="ENVMAP_BLENDING_NONE";if(Je.envMap)switch(Je.combine){case Ci:yt="ENVMAP_BLENDING_MULTIPLY";break;case mi:yt="ENVMAP_BLENDING_MIX";break;case gr:yt="ENVMAP_BLENDING_ADD"}return yt}(c),V=function(Je){const yt=Je.envMapCubeUVHeight;if(yt===null)return null;const Ze=Math.log2(yt)-2,Pt=1/yt;return{texelWidth:1/(3*Math.max(Math.pow(2,Ze),112)),texelHeight:Pt,maxMip:Ze}}(c),Q=c.isWebGL2?"":function(Je){return[Je.extensionDerivatives||Je.envMapCubeUVHeight||Je.bumpMap||Je.normalMapTangentSpace||Je.clearcoatNormalMap||Je.flatShading||Je.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Je.extensionFragDepth||Je.logarithmicDepthBuffer)&&Je.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Je.extensionDrawBuffers&&Je.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Je.extensionShaderTextureLOD||Je.envMap||Je.transmission)&&Je.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(zl).join(`
`)}(c),q=function(Je){const yt=[];for(const Ze in Je){const Pt=Je[Ze];Pt!==!1&&yt.push("#define "+Ze+" "+Pt)}return yt.join(`
`)}(_),te=m.createProgram();let K,Z,ae=c.glslVersion?"#version "+c.glslVersion+`
`:"";c.isRawShaderMaterial?(K=[q].filter(zl).join(`
`),K.length>0&&(K+=`
`),Z=[Q,q].filter(zl).join(`
`),Z.length>0&&(Z+=`
`)):(K=[Tb(c),"#define SHADER_NAME "+c.shaderName,q,c.instancing?"#define USE_INSTANCING":"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+U:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",c.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",c.displacementMap?"#define USE_DISPLACEMENTMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",c.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",c.mapUv?"#define MAP_UV "+c.mapUv:"",c.alphaMapUv?"#define ALPHAMAP_UV "+c.alphaMapUv:"",c.lightMapUv?"#define LIGHTMAP_UV "+c.lightMapUv:"",c.aoMapUv?"#define AOMAP_UV "+c.aoMapUv:"",c.emissiveMapUv?"#define EMISSIVEMAP_UV "+c.emissiveMapUv:"",c.bumpMapUv?"#define BUMPMAP_UV "+c.bumpMapUv:"",c.normalMapUv?"#define NORMALMAP_UV "+c.normalMapUv:"",c.displacementMapUv?"#define DISPLACEMENTMAP_UV "+c.displacementMapUv:"",c.metalnessMapUv?"#define METALNESSMAP_UV "+c.metalnessMapUv:"",c.roughnessMapUv?"#define ROUGHNESSMAP_UV "+c.roughnessMapUv:"",c.clearcoatMapUv?"#define CLEARCOATMAP_UV "+c.clearcoatMapUv:"",c.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+c.clearcoatNormalMapUv:"",c.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+c.clearcoatRoughnessMapUv:"",c.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+c.iridescenceMapUv:"",c.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+c.iridescenceThicknessMapUv:"",c.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+c.sheenColorMapUv:"",c.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+c.sheenRoughnessMapUv:"",c.specularMapUv?"#define SPECULARMAP_UV "+c.specularMapUv:"",c.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+c.specularColorMapUv:"",c.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+c.specularIntensityMapUv:"",c.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+c.transmissionMapUv:"",c.thicknessMapUv?"#define THICKNESSMAP_UV "+c.thicknessMapUv:"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUv1s?"#define USE_UV1":"",c.vertexUv2s?"#define USE_UV2":"",c.vertexUv3s?"#define USE_UV3":"",c.pointsUvs?"#define USE_POINTS_UV":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&c.flatShading===!1?"#define USE_MORPHNORMALS":"",c.morphColors&&c.isWebGL2?"#define USE_MORPHCOLORS":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+c.morphTextureStride:"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_COUNT "+c.morphTargetsCount:"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+B:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(zl).join(`
`),Z=[Q,Tb(c),"#define SHADER_NAME "+c.shaderName,q,c.instancing?"#define USE_INSTANCING":"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+D:"",c.envMap?"#define "+U:"",c.envMap?"#define "+G:"",V?"#define CUBEUV_TEXEL_WIDTH "+V.texelWidth:"",V?"#define CUBEUV_TEXEL_HEIGHT "+V.texelHeight:"",V?"#define CUBEUV_MAX_MIP "+V.maxMip+".0":"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",c.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.clearcoat?"#define USE_CLEARCOAT":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescence?"#define USE_IRIDESCENCE":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",c.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaTest?"#define USE_ALPHATEST":"",c.sheen?"#define USE_SHEEN":"",c.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors||c.instancingColor?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUv1s?"#define USE_UV1":"",c.vertexUv2s?"#define USE_UV2":"",c.vertexUv3s?"#define USE_UV3":"",c.pointsUvs?"#define USE_POINTS_UV":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+B:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.useLegacyLights?"#define LEGACY_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",c.toneMapping!==Ni?"#define TONE_MAPPING":"",c.toneMapping!==Ni?bi.tonemapping_pars_fragment:"",c.toneMapping!==Ni?ko("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":"",c.opaque?"#define OPAQUE":"",bi.encodings_pars_fragment,cp("linearToOutputTexel",c.outputColorSpace),c.transmissionSamplerMapEncoding?ny("transmissionSamplerMapTexelToLinear",c.transmissionSamplerMapEncoding):"",c.useDepthPacking?"#define DEPTH_PACKING "+c.depthPacking:"",`
`].filter(zl).join(`
`)),x=Jv(x),x=Or(x,c),x=iy(x,c),S=Jv(S),S=Or(S,c),S=iy(S,c),x=Cb(x),S=Cb(S),c.isWebGL2&&c.isRawShaderMaterial!==!0&&(ae=`#version 300 es
`,K=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+K,Z=["#define varying in",c.glslVersion===xh?"":"layout(location = 0) out highp vec4 pc_fragColor;",c.glslVersion===xh?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join(`
`)+`
`+Z);const ce=ae+K+x,Te=ae+Z+S,Ce=ty(m,m.VERTEX_SHADER,ce),Ie=ty(m,m.FRAGMENT_SHADER,Te);if(m.attachShader(te,Ce),m.attachShader(te,Ie),c.index0AttributeName!==void 0?m.bindAttribLocation(te,0,c.index0AttributeName):c.morphTargets===!0&&m.bindAttribLocation(te,0,"position"),m.linkProgram(te),b.debug.checkShaderErrors){const Je=m.getProgramInfoLog(te).trim(),yt=m.getShaderInfoLog(Ce).trim(),Ze=m.getShaderInfoLog(Ie).trim();let Pt=!0,kt=!0;if(m.getProgramParameter(te,m.LINK_STATUS)===!1)if(Pt=!1,typeof b.debug.onShaderError=="function")b.debug.onShaderError(m,te,Ce,Ie);else{const en=Kv(m,Ce,"vertex"),xn=Kv(m,Ie,"fragment");console.error("THREE.WebGLProgram: Shader Error "+m.getError()+" - VALIDATE_STATUS "+m.getProgramParameter(te,m.VALIDATE_STATUS)+`

Program Info Log: `+Je+`
`+en+`
`+xn)}else Je!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Je):yt!==""&&Ze!==""||(kt=!1);kt&&(this.diagnostics={runnable:Pt,programLog:Je,vertexShader:{log:yt,prefix:K},fragmentShader:{log:Ze,prefix:Z}})}let Ke,ct;return m.deleteShader(Ce),m.deleteShader(Ie),this.getUniforms=function(){return Ke===void 0&&(Ke=new Fl(m,te)),Ke},this.getAttributes=function(){return ct===void 0&&(ct=function(Je,yt){const Ze={},Pt=Je.getProgramParameter(yt,Je.ACTIVE_ATTRIBUTES);for(let kt=0;kt<Pt;kt++){const en=Je.getActiveAttrib(yt,kt),xn=en.name;let tn=1;en.type===Je.FLOAT_MAT2&&(tn=2),en.type===Je.FLOAT_MAT3&&(tn=3),en.type===Je.FLOAT_MAT4&&(tn=4),Ze[xn]={type:en.type,location:Je.getAttribLocation(yt,xn),locationSize:tn}}return Ze}(m,te)),ct},this.destroy=function(){p.releaseStatesOfProgram(this),m.deleteProgram(te),this.program=void 0},this.name=c.shaderName,this.id=Eb++,this.cacheKey=r,this.usedTimes=1,this.program=te,this.vertexShader=Ce,this.fragmentShader=Ie,this}let J1=0;class Z1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(r){const c=r.vertexShader,p=r.fragmentShader,m=this._getShaderStage(c),_=this._getShaderStage(p),x=this._getShaderCacheForMaterial(r);return x.has(m)===!1&&(x.add(m),m.usedTimes++),x.has(_)===!1&&(x.add(_),_.usedTimes++),this}remove(r){const c=this.materialCache.get(r);for(const p of c)p.usedTimes--,p.usedTimes===0&&this.shaderCache.delete(p.code);return this.materialCache.delete(r),this}getVertexShaderID(r){return this._getShaderStage(r.vertexShader).id}getFragmentShaderID(r){return this._getShaderStage(r.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(r){const c=this.materialCache;let p=c.get(r);return p===void 0&&(p=new Set,c.set(r,p)),p}_getShaderStage(r){const c=this.shaderCache;let p=c.get(r);return p===void 0&&(p=new sy(r),c.set(r,p)),p}}class sy{constructor(r){this.id=J1++,this.code=r,this.usedTimes=0}}function Zv(b,r,c,p,m,_,x){const S=new Tu,B=new Z1,D=[],U=m.isWebGL2,G=m.logarithmicDepthBuffer,V=m.vertexTextures;let Q=m.precision;const q={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function te(K){return K===1?"uv1":K===2?"uv2":K===3?"uv3":"uv"}return{getParameters:function(K,Z,ae,ce,Te){const Ce=ce.fog,Ie=Te.geometry,Ke=K.isMeshStandardMaterial?ce.environment:null,ct=(K.isMeshStandardMaterial?c:r).get(K.envMap||Ke),Je=ct&&ct.mapping===Oa?ct.image.height:null,yt=q[K.type];K.precision!==null&&(Q=m.getMaxPrecision(K.precision),Q!==K.precision&&console.warn("THREE.WebGLProgram.getParameters:",K.precision,"not supported, using",Q,"instead."));const Ze=Ie.morphAttributes.position||Ie.morphAttributes.normal||Ie.morphAttributes.color,Pt=Ze!==void 0?Ze.length:0;let kt,en,xn,tn,Wt=0;if(Ie.morphAttributes.position!==void 0&&(Wt=1),Ie.morphAttributes.normal!==void 0&&(Wt=2),Ie.morphAttributes.color!==void 0&&(Wt=3),yt){const Ma=ta[yt];kt=Ma.vertexShader,en=Ma.fragmentShader}else kt=K.vertexShader,en=K.fragmentShader,B.update(K),xn=B.getVertexShaderID(K),tn=B.getFragmentShaderID(K);const dn=b.getRenderTarget(),pn=b.userData&&b.userData.transmissionRenderTarget,It=dn?Array.isArray(dn.texture)?dn.texture[0]:dn.texture:null,Qt=Te.isInstancedMesh===!0,un=!!K.map,Kt=!!K.matcap,bn=!!ct,ni=!!K.aoMap,Xe=!!K.lightMap,Le=!!K.bumpMap,_t=!!K.normalMap,rt=!!K.displacementMap,Qe=!!K.emissiveMap,lt=!!K.metalnessMap,Se=!!K.roughnessMap,$e=K.clearcoat>0,it=K.iridescence>0,Ot=K.sheen>0,Ut=K.transmission>0,Vt=$e&&!!K.clearcoatMap,mn=$e&&!!K.clearcoatNormalMap,In=$e&&!!K.clearcoatRoughnessMap,Qn=it&&!!K.iridescenceMap,Mn=it&&!!K.iridescenceThicknessMap,Yn=Ot&&!!K.sheenColorMap,Kn=Ot&&!!K.sheenRoughnessMap,Gn=!!K.specularMap,ki=!!K.specularColorMap,oa=!!K.specularIntensityMap,wi=Ut&&!!K.transmissionMap,Qi=Ut&&!!K.thicknessMap,Wi=!!K.gradientMap,eh=!!K.alphaMap,Rt=K.alphaTest>0,Dp=!!K.extensions,Ng=!!Ie.attributes.uv1,Vs=!!Ie.attributes.uv2,la=!!Ie.attributes.uv3;return{isWebGL2:U,shaderID:yt,shaderName:K.type,vertexShader:kt,fragmentShader:en,defines:K.defines,customVertexShaderID:xn,customFragmentShaderID:tn,isRawShaderMaterial:K.isRawShaderMaterial===!0,glslVersion:K.glslVersion,precision:Q,instancing:Qt,instancingColor:Qt&&Te.instanceColor!==null,supportsVertexTextures:V,outputColorSpace:dn===null?b.outputColorSpace:dn.isXRRenderTarget===!0||It.colorSpace&&It.colorSpace!==Xn?It.colorSpace:vi,map:un,matcap:Kt,envMap:bn,envMapMode:bn&&ct.mapping,envMapCubeUVHeight:Je,aoMap:ni,lightMap:Xe,bumpMap:Le,normalMap:_t,displacementMap:V&&rt,emissiveMap:Qe,normalMapObjectSpace:_t&&K.normalMapType===zc,normalMapTangentSpace:_t&&K.normalMapType===So,metalnessMap:lt,roughnessMap:Se,clearcoat:$e,clearcoatMap:Vt,clearcoatNormalMap:mn,clearcoatRoughnessMap:In,iridescence:it,iridescenceMap:Qn,iridescenceThicknessMap:Mn,sheen:Ot,sheenColorMap:Yn,sheenRoughnessMap:Kn,specularMap:Gn,specularColorMap:ki,specularIntensityMap:oa,transmission:Ut,transmissionMap:wi,thicknessMap:Qi,transmissionSamplerMapEncoding:pn&&pn.texture.colorSpace||vi,gradientMap:Wi,opaque:K.transparent===!1&&K.blending===et&&!(K.transmission>0),alphaMap:eh,alphaTest:Rt,combine:K.combine,mapUv:un&&te(K.map.channel),aoMapUv:ni&&te(K.aoMap.channel),lightMapUv:Xe&&te(K.lightMap.channel),bumpMapUv:Le&&te(K.bumpMap.channel),normalMapUv:_t&&te(K.normalMap.channel),displacementMapUv:rt&&te(K.displacementMap.channel),emissiveMapUv:Qe&&te(K.emissiveMap.channel),metalnessMapUv:lt&&te(K.metalnessMap.channel),roughnessMapUv:Se&&te(K.roughnessMap.channel),clearcoatMapUv:Vt&&te(K.clearcoatMap.channel),clearcoatNormalMapUv:mn&&te(K.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:In&&te(K.clearcoatRoughnessMap.channel),iridescenceMapUv:Qn&&te(K.iridescenceMap.channel),iridescenceThicknessMapUv:Mn&&te(K.iridescenceThicknessMap.channel),sheenColorMapUv:Yn&&te(K.sheenColorMap.channel),sheenRoughnessMapUv:Kn&&te(K.sheenRoughnessMap.channel),specularMapUv:Gn&&te(K.specularMap.channel),specularColorMapUv:ki&&te(K.specularColorMap.channel),specularIntensityMapUv:oa&&te(K.specularIntensityMap.channel),transmissionMapUv:wi&&te(K.transmissionMap.channel),thicknessMapUv:Qi&&te(K.thicknessMap.channel),alphaMapUv:eh&&te(K.alphaMap.channel),vertexTangents:_t&&!!Ie.attributes.tangent,vertexColors:K.vertexColors,vertexAlphas:K.vertexColors===!0&&!!Ie.attributes.color&&Ie.attributes.color.itemSize===4,vertexUv1s:Ng,vertexUv2s:Vs,vertexUv3s:la,pointsUvs:Te.isPoints===!0&&!!Ie.attributes.uv&&(un||eh),fog:!!Ce,useFog:K.fog===!0,fogExp2:Ce&&Ce.isFogExp2,flatShading:K.flatShading===!0,sizeAttenuation:K.sizeAttenuation===!0,logarithmicDepthBuffer:G,skinning:Te.isSkinnedMesh===!0,morphTargets:Ie.morphAttributes.position!==void 0,morphNormals:Ie.morphAttributes.normal!==void 0,morphColors:Ie.morphAttributes.color!==void 0,morphTargetsCount:Pt,morphTextureStride:Wt,numDirLights:Z.directional.length,numPointLights:Z.point.length,numSpotLights:Z.spot.length,numSpotLightMaps:Z.spotLightMap.length,numRectAreaLights:Z.rectArea.length,numHemiLights:Z.hemi.length,numDirLightShadows:Z.directionalShadowMap.length,numPointLightShadows:Z.pointShadowMap.length,numSpotLightShadows:Z.spotShadowMap.length,numSpotLightShadowsWithMaps:Z.numSpotLightShadowsWithMaps,numClippingPlanes:x.numPlanes,numClipIntersection:x.numIntersection,dithering:K.dithering,shadowMapEnabled:b.shadowMap.enabled&&ae.length>0,shadowMapType:b.shadowMap.type,toneMapping:K.toneMapped?b.toneMapping:Ni,useLegacyLights:b.useLegacyLights,premultipliedAlpha:K.premultipliedAlpha,doubleSided:K.side===He,flipSided:K.side===ue,useDepthPacking:K.depthPacking>=0,depthPacking:K.depthPacking||0,index0AttributeName:K.index0AttributeName,extensionDerivatives:Dp&&K.extensions.derivatives===!0,extensionFragDepth:Dp&&K.extensions.fragDepth===!0,extensionDrawBuffers:Dp&&K.extensions.drawBuffers===!0,extensionShaderTextureLOD:Dp&&K.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:U||p.has("EXT_frag_depth"),rendererExtensionDrawBuffers:U||p.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:U||p.has("EXT_shader_texture_lod"),customProgramCacheKey:K.customProgramCacheKey()}},getProgramCacheKey:function(K){const Z=[];if(K.shaderID?Z.push(K.shaderID):(Z.push(K.customVertexShaderID),Z.push(K.customFragmentShaderID)),K.defines!==void 0)for(const ae in K.defines)Z.push(ae),Z.push(K.defines[ae]);return K.isRawShaderMaterial===!1&&(function(ae,ce){ae.push(ce.precision),ae.push(ce.outputColorSpace),ae.push(ce.envMapMode),ae.push(ce.envMapCubeUVHeight),ae.push(ce.mapUv),ae.push(ce.alphaMapUv),ae.push(ce.lightMapUv),ae.push(ce.aoMapUv),ae.push(ce.bumpMapUv),ae.push(ce.normalMapUv),ae.push(ce.displacementMapUv),ae.push(ce.emissiveMapUv),ae.push(ce.metalnessMapUv),ae.push(ce.roughnessMapUv),ae.push(ce.clearcoatMapUv),ae.push(ce.clearcoatNormalMapUv),ae.push(ce.clearcoatRoughnessMapUv),ae.push(ce.iridescenceMapUv),ae.push(ce.iridescenceThicknessMapUv),ae.push(ce.sheenColorMapUv),ae.push(ce.sheenRoughnessMapUv),ae.push(ce.specularMapUv),ae.push(ce.specularColorMapUv),ae.push(ce.specularIntensityMapUv),ae.push(ce.transmissionMapUv),ae.push(ce.thicknessMapUv),ae.push(ce.combine),ae.push(ce.fogExp2),ae.push(ce.sizeAttenuation),ae.push(ce.morphTargetsCount),ae.push(ce.morphAttributeCount),ae.push(ce.numDirLights),ae.push(ce.numPointLights),ae.push(ce.numSpotLights),ae.push(ce.numSpotLightMaps),ae.push(ce.numHemiLights),ae.push(ce.numRectAreaLights),ae.push(ce.numDirLightShadows),ae.push(ce.numPointLightShadows),ae.push(ce.numSpotLightShadows),ae.push(ce.numSpotLightShadowsWithMaps),ae.push(ce.shadowMapType),ae.push(ce.toneMapping),ae.push(ce.numClippingPlanes),ae.push(ce.numClipIntersection),ae.push(ce.depthPacking)}(Z,K),function(ae,ce){S.disableAll(),ce.isWebGL2&&S.enable(0),ce.supportsVertexTextures&&S.enable(1),ce.instancing&&S.enable(2),ce.instancingColor&&S.enable(3),ce.matcap&&S.enable(4),ce.envMap&&S.enable(5),ce.normalMapObjectSpace&&S.enable(6),ce.normalMapTangentSpace&&S.enable(7),ce.clearcoat&&S.enable(8),ce.iridescence&&S.enable(9),ce.alphaTest&&S.enable(10),ce.vertexColors&&S.enable(11),ce.vertexAlphas&&S.enable(12),ce.vertexUv1s&&S.enable(13),ce.vertexUv2s&&S.enable(14),ce.vertexUv3s&&S.enable(15),ce.vertexTangents&&S.enable(16),ae.push(S.mask),S.disableAll(),ce.fog&&S.enable(0),ce.useFog&&S.enable(1),ce.flatShading&&S.enable(2),ce.logarithmicDepthBuffer&&S.enable(3),ce.skinning&&S.enable(4),ce.morphTargets&&S.enable(5),ce.morphNormals&&S.enable(6),ce.morphColors&&S.enable(7),ce.premultipliedAlpha&&S.enable(8),ce.shadowMapEnabled&&S.enable(9),ce.useLegacyLights&&S.enable(10),ce.doubleSided&&S.enable(11),ce.flipSided&&S.enable(12),ce.useDepthPacking&&S.enable(13),ce.dithering&&S.enable(14),ce.transmission&&S.enable(15),ce.sheen&&S.enable(16),ce.opaque&&S.enable(17),ce.pointsUvs&&S.enable(18),ae.push(S.mask)}(Z,K),Z.push(b.outputColorSpace)),Z.push(K.customProgramCacheKey),Z.join()},getUniforms:function(K){const Z=q[K.type];let ae;if(Z){const ce=ta[Z];ae=j0.clone(ce.uniforms)}else ae=K.uniforms;return ae},acquireProgram:function(K,Z){let ae;for(let ce=0,Te=D.length;ce<Te;ce++){const Ce=D[ce];if(Ce.cacheKey===Z){ae=Ce,++ae.usedTimes;break}}return ae===void 0&&(ae=new K1(b,Z,K,_),D.push(ae)),ae},releaseProgram:function(K){if(--K.usedTimes==0){const Z=D.indexOf(K);D[Z]=D[D.length-1],D.pop(),K.destroy()}},releaseShaderCache:function(K){B.remove(K)},programs:D,dispose:function(){B.dispose()}}}function br(){let b=new WeakMap;return{get:function(r){let c=b.get(r);return c===void 0&&(c={},b.set(r,c)),c},remove:function(r){b.delete(r)},update:function(r,c,p){b.get(r)[c]=p},dispose:function(){b=new WeakMap}}}function Ib(b,r){return b.groupOrder!==r.groupOrder?b.groupOrder-r.groupOrder:b.renderOrder!==r.renderOrder?b.renderOrder-r.renderOrder:b.material.id!==r.material.id?b.material.id-r.material.id:b.z!==r.z?b.z-r.z:b.id-r.id}function ay(b,r){return b.groupOrder!==r.groupOrder?b.groupOrder-r.groupOrder:b.renderOrder!==r.renderOrder?b.renderOrder-r.renderOrder:b.z!==r.z?r.z-b.z:b.id-r.id}function ag(){const b=[];let r=0;const c=[],p=[],m=[];function _(x,S,B,D,U,G){let V=b[r];return V===void 0?(V={id:x.id,object:x,geometry:S,material:B,groupOrder:D,renderOrder:x.renderOrder,z:U,group:G},b[r]=V):(V.id=x.id,V.object=x,V.geometry=S,V.material=B,V.groupOrder=D,V.renderOrder=x.renderOrder,V.z=U,V.group=G),r++,V}return{opaque:c,transmissive:p,transparent:m,init:function(){r=0,c.length=0,p.length=0,m.length=0},push:function(x,S,B,D,U,G){const V=_(x,S,B,D,U,G);B.transmission>0?p.push(V):B.transparent===!0?m.push(V):c.push(V)},unshift:function(x,S,B,D,U,G){const V=_(x,S,B,D,U,G);B.transmission>0?p.unshift(V):B.transparent===!0?m.unshift(V):c.unshift(V)},finish:function(){for(let x=r,S=b.length;x<S;x++){const B=b[x];if(B.id===null)break;B.id=null,B.object=null,B.geometry=null,B.material=null,B.group=null}},sort:function(x,S){c.length>1&&c.sort(x||Ib),p.length>1&&p.sort(S||ay),m.length>1&&m.sort(S||ay)}}}function $v(){let b=new WeakMap;return{get:function(r,c){const p=b.get(r);let m;return p===void 0?(m=new ag,b.set(r,[m])):c>=p.length?(m=new ag,p.push(m)):m=p[c],m},dispose:function(){b=new WeakMap}}}function eu(){const b={};return{get:function(r){if(b[r.id]!==void 0)return b[r.id];let c;switch(r.type){case"DirectionalLight":c={direction:new ze,color:new En};break;case"SpotLight":c={position:new ze,direction:new ze,color:new En,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":c={position:new ze,color:new En,distance:0,decay:0};break;case"HemisphereLight":c={direction:new ze,skyColor:new En,groundColor:new En};break;case"RectAreaLight":c={color:new En,position:new ze,halfWidth:new ze,halfHeight:new ze}}return b[r.id]=c,c}}}let Pb=0;function og(b,r){return(r.castShadow?2:0)-(b.castShadow?2:0)+(r.map?1:0)-(b.map?1:0)}function up(b,r){const c=new eu,p=function(){const B={};return{get:function(D){if(B[D.id]!==void 0)return B[D.id];let U;switch(D.type){case"DirectionalLight":case"SpotLight":U={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new qt};break;case"PointLight":U={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new qt,shadowCameraNear:1,shadowCameraFar:1e3}}return B[D.id]=U,U}}}(),m={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let B=0;B<9;B++)m.probe.push(new ze);const _=new ze,x=new _i,S=new _i;return{setup:function(B,D){let U=0,G=0,V=0;for(let Je=0;Je<9;Je++)m.probe[Je].set(0,0,0);let Q=0,q=0,te=0,K=0,Z=0,ae=0,ce=0,Te=0,Ce=0,Ie=0;B.sort(og);const Ke=D===!0?Math.PI:1;for(let Je=0,yt=B.length;Je<yt;Je++){const Ze=B[Je],Pt=Ze.color,kt=Ze.intensity,en=Ze.distance,xn=Ze.shadow&&Ze.shadow.map?Ze.shadow.map.texture:null;if(Ze.isAmbientLight)U+=Pt.r*kt*Ke,G+=Pt.g*kt*Ke,V+=Pt.b*kt*Ke;else if(Ze.isLightProbe)for(let tn=0;tn<9;tn++)m.probe[tn].addScaledVector(Ze.sh.coefficients[tn],kt);else if(Ze.isDirectionalLight){const tn=c.get(Ze);if(tn.color.copy(Ze.color).multiplyScalar(Ze.intensity*Ke),Ze.castShadow){const Wt=Ze.shadow,dn=p.get(Ze);dn.shadowBias=Wt.bias,dn.shadowNormalBias=Wt.normalBias,dn.shadowRadius=Wt.radius,dn.shadowMapSize=Wt.mapSize,m.directionalShadow[Q]=dn,m.directionalShadowMap[Q]=xn,m.directionalShadowMatrix[Q]=Ze.shadow.matrix,ae++}m.directional[Q]=tn,Q++}else if(Ze.isSpotLight){const tn=c.get(Ze);tn.position.setFromMatrixPosition(Ze.matrixWorld),tn.color.copy(Pt).multiplyScalar(kt*Ke),tn.distance=en,tn.coneCos=Math.cos(Ze.angle),tn.penumbraCos=Math.cos(Ze.angle*(1-Ze.penumbra)),tn.decay=Ze.decay,m.spot[te]=tn;const Wt=Ze.shadow;if(Ze.map&&(m.spotLightMap[Ce]=Ze.map,Ce++,Wt.updateMatrices(Ze),Ze.castShadow&&Ie++),m.spotLightMatrix[te]=Wt.matrix,Ze.castShadow){const dn=p.get(Ze);dn.shadowBias=Wt.bias,dn.shadowNormalBias=Wt.normalBias,dn.shadowRadius=Wt.radius,dn.shadowMapSize=Wt.mapSize,m.spotShadow[te]=dn,m.spotShadowMap[te]=xn,Te++}te++}else if(Ze.isRectAreaLight){const tn=c.get(Ze);tn.color.copy(Pt).multiplyScalar(kt),tn.halfWidth.set(.5*Ze.width,0,0),tn.halfHeight.set(0,.5*Ze.height,0),m.rectArea[K]=tn,K++}else if(Ze.isPointLight){const tn=c.get(Ze);if(tn.color.copy(Ze.color).multiplyScalar(Ze.intensity*Ke),tn.distance=Ze.distance,tn.decay=Ze.decay,Ze.castShadow){const Wt=Ze.shadow,dn=p.get(Ze);dn.shadowBias=Wt.bias,dn.shadowNormalBias=Wt.normalBias,dn.shadowRadius=Wt.radius,dn.shadowMapSize=Wt.mapSize,dn.shadowCameraNear=Wt.camera.near,dn.shadowCameraFar=Wt.camera.far,m.pointShadow[q]=dn,m.pointShadowMap[q]=xn,m.pointShadowMatrix[q]=Ze.shadow.matrix,ce++}m.point[q]=tn,q++}else if(Ze.isHemisphereLight){const tn=c.get(Ze);tn.skyColor.copy(Ze.color).multiplyScalar(kt*Ke),tn.groundColor.copy(Ze.groundColor).multiplyScalar(kt*Ke),m.hemi[Z]=tn,Z++}}K>0&&(r.isWebGL2||b.has("OES_texture_float_linear")===!0?(m.rectAreaLTC1=An.LTC_FLOAT_1,m.rectAreaLTC2=An.LTC_FLOAT_2):b.has("OES_texture_half_float_linear")===!0?(m.rectAreaLTC1=An.LTC_HALF_1,m.rectAreaLTC2=An.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),m.ambient[0]=U,m.ambient[1]=G,m.ambient[2]=V;const ct=m.hash;ct.directionalLength===Q&&ct.pointLength===q&&ct.spotLength===te&&ct.rectAreaLength===K&&ct.hemiLength===Z&&ct.numDirectionalShadows===ae&&ct.numPointShadows===ce&&ct.numSpotShadows===Te&&ct.numSpotMaps===Ce||(m.directional.length=Q,m.spot.length=te,m.rectArea.length=K,m.point.length=q,m.hemi.length=Z,m.directionalShadow.length=ae,m.directionalShadowMap.length=ae,m.pointShadow.length=ce,m.pointShadowMap.length=ce,m.spotShadow.length=Te,m.spotShadowMap.length=Te,m.directionalShadowMatrix.length=ae,m.pointShadowMatrix.length=ce,m.spotLightMatrix.length=Te+Ce-Ie,m.spotLightMap.length=Ce,m.numSpotLightShadowsWithMaps=Ie,ct.directionalLength=Q,ct.pointLength=q,ct.spotLength=te,ct.rectAreaLength=K,ct.hemiLength=Z,ct.numDirectionalShadows=ae,ct.numPointShadows=ce,ct.numSpotShadows=Te,ct.numSpotMaps=Ce,m.version=Pb++)},setupView:function(B,D){let U=0,G=0,V=0,Q=0,q=0;const te=D.matrixWorldInverse;for(let K=0,Z=B.length;K<Z;K++){const ae=B[K];if(ae.isDirectionalLight){const ce=m.directional[U];ce.direction.setFromMatrixPosition(ae.matrixWorld),_.setFromMatrixPosition(ae.target.matrixWorld),ce.direction.sub(_),ce.direction.transformDirection(te),U++}else if(ae.isSpotLight){const ce=m.spot[V];ce.position.setFromMatrixPosition(ae.matrixWorld),ce.position.applyMatrix4(te),ce.direction.setFromMatrixPosition(ae.matrixWorld),_.setFromMatrixPosition(ae.target.matrixWorld),ce.direction.sub(_),ce.direction.transformDirection(te),V++}else if(ae.isRectAreaLight){const ce=m.rectArea[Q];ce.position.setFromMatrixPosition(ae.matrixWorld),ce.position.applyMatrix4(te),S.identity(),x.copy(ae.matrixWorld),x.premultiply(te),S.extractRotation(x),ce.halfWidth.set(.5*ae.width,0,0),ce.halfHeight.set(0,.5*ae.height,0),ce.halfWidth.applyMatrix4(S),ce.halfHeight.applyMatrix4(S),Q++}else if(ae.isPointLight){const ce=m.point[G];ce.position.setFromMatrixPosition(ae.matrixWorld),ce.position.applyMatrix4(te),G++}else if(ae.isHemisphereLight){const ce=m.hemi[q];ce.direction.setFromMatrixPosition(ae.matrixWorld),ce.direction.transformDirection(te),q++}}},state:m}}function Nf(b,r){const c=new up(b,r),p=[],m=[];return{init:function(){p.length=0,m.length=0},state:{lightsArray:p,shadowsArray:m,lights:c},setupLights:function(_){c.setup(p,_)},setupLightsView:function(_){c.setupView(p,_)},pushLight:function(_){p.push(_)},pushShadow:function(_){m.push(_)}}}function e_(b,r){let c=new WeakMap;return{get:function(p,m=0){const _=c.get(p);let x;return _===void 0?(x=new Nf(b,r),c.set(p,[x])):m>=_.length?(x=new Nf(b,r),_.push(x)):x=_[m],x},dispose:function(){c=new WeakMap}}}class hp extends Ss{constructor(r){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=_n,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(r)}copy(r){return super.copy(r),this.depthPacking=r.depthPacking,this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this}}class dp extends Ss{constructor(r){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(r)}copy(r){return super.copy(r),this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this}}const $1=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,eE=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Rb(b,r,c){let p=new Jm;const m=new qt,_=new qt,x=new Ji,S=new hp({depthPacking:fs}),B=new dp,D={},U=c.maxTextureSize,G={[Pe]:ue,[ue]:Pe,[He]:He},V=new gc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new qt},radius:{value:4}},vertexShader:$1,fragmentShader:eE}),Q=V.clone();Q.defines.HORIZONTAL_PASS=1;const q=new ee;q.setAttribute("position",new ur(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const te=new Cs(q,V),K=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=fe;let Z=this.type;function ae(Ce,Ie){const Ke=r.update(te);V.defines.VSM_SAMPLES!==Ce.blurSamples&&(V.defines.VSM_SAMPLES=Ce.blurSamples,Q.defines.VSM_SAMPLES=Ce.blurSamples,V.needsUpdate=!0,Q.needsUpdate=!0),Ce.mapPass===null&&(Ce.mapPass=new ms(m.x,m.y)),V.uniforms.shadow_pass.value=Ce.map.texture,V.uniforms.resolution.value=Ce.mapSize,V.uniforms.radius.value=Ce.radius,b.setRenderTarget(Ce.mapPass),b.clear(),b.renderBufferDirect(Ie,null,Ke,V,te,null),Q.uniforms.shadow_pass.value=Ce.mapPass.texture,Q.uniforms.resolution.value=Ce.mapSize,Q.uniforms.radius.value=Ce.radius,b.setRenderTarget(Ce.map),b.clear(),b.renderBufferDirect(Ie,null,Ke,Q,te,null)}function ce(Ce,Ie,Ke,ct){let Je=null;const yt=Ke.isPointLight===!0?Ce.customDistanceMaterial:Ce.customDepthMaterial;if(yt!==void 0)Je=yt;else if(Je=Ke.isPointLight===!0?B:S,b.localClippingEnabled&&Ie.clipShadows===!0&&Array.isArray(Ie.clippingPlanes)&&Ie.clippingPlanes.length!==0||Ie.displacementMap&&Ie.displacementScale!==0||Ie.alphaMap&&Ie.alphaTest>0||Ie.map&&Ie.alphaTest>0){const Ze=Je.uuid,Pt=Ie.uuid;let kt=D[Ze];kt===void 0&&(kt={},D[Ze]=kt);let en=kt[Pt];en===void 0&&(en=Je.clone(),kt[Pt]=en),Je=en}return Je.visible=Ie.visible,Je.wireframe=Ie.wireframe,Je.side=ct===de?Ie.shadowSide!==null?Ie.shadowSide:Ie.side:Ie.shadowSide!==null?Ie.shadowSide:G[Ie.side],Je.alphaMap=Ie.alphaMap,Je.alphaTest=Ie.alphaTest,Je.map=Ie.map,Je.clipShadows=Ie.clipShadows,Je.clippingPlanes=Ie.clippingPlanes,Je.clipIntersection=Ie.clipIntersection,Je.displacementMap=Ie.displacementMap,Je.displacementScale=Ie.displacementScale,Je.displacementBias=Ie.displacementBias,Je.wireframeLinewidth=Ie.wireframeLinewidth,Je.linewidth=Ie.linewidth,Ke.isPointLight===!0&&Je.isMeshDistanceMaterial===!0&&(b.properties.get(Je).light=Ke),Je}function Te(Ce,Ie,Ke,ct,Je){if(Ce.visible===!1)return;if(Ce.layers.test(Ie.layers)&&(Ce.isMesh||Ce.isLine||Ce.isPoints)&&(Ce.castShadow||Ce.receiveShadow&&Je===de)&&(!Ce.frustumCulled||p.intersectsObject(Ce))){Ce.modelViewMatrix.multiplyMatrices(Ke.matrixWorldInverse,Ce.matrixWorld);const Ze=r.update(Ce),Pt=Ce.material;if(Array.isArray(Pt)){const kt=Ze.groups;for(let en=0,xn=kt.length;en<xn;en++){const tn=kt[en],Wt=Pt[tn.materialIndex];if(Wt&&Wt.visible){const dn=ce(Ce,Wt,ct,Je);b.renderBufferDirect(Ke,null,Ze,dn,Ce,tn)}}}else if(Pt.visible){const kt=ce(Ce,Pt,ct,Je);b.renderBufferDirect(Ke,null,Ze,kt,Ce,null)}}const yt=Ce.children;for(let Ze=0,Pt=yt.length;Ze<Pt;Ze++)Te(yt[Ze],Ie,Ke,ct,Je)}this.render=function(Ce,Ie,Ke){if(K.enabled===!1||K.autoUpdate===!1&&K.needsUpdate===!1||Ce.length===0)return;const ct=b.getRenderTarget(),Je=b.getActiveCubeFace(),yt=b.getActiveMipmapLevel(),Ze=b.state;Ze.setBlending(Fe),Ze.buffers.color.setClear(1,1,1,1),Ze.buffers.depth.setTest(!0),Ze.setScissorTest(!1);const Pt=Z!==de&&this.type===de,kt=Z===de&&this.type!==de;for(let en=0,xn=Ce.length;en<xn;en++){const tn=Ce[en],Wt=tn.shadow;if(Wt===void 0){console.warn("THREE.WebGLShadowMap:",tn,"has no shadow.");continue}if(Wt.autoUpdate===!1&&Wt.needsUpdate===!1)continue;m.copy(Wt.mapSize);const dn=Wt.getFrameExtents();if(m.multiply(dn),_.copy(Wt.mapSize),(m.x>U||m.y>U)&&(m.x>U&&(_.x=Math.floor(U/dn.x),m.x=_.x*dn.x,Wt.mapSize.x=_.x),m.y>U&&(_.y=Math.floor(U/dn.y),m.y=_.y*dn.y,Wt.mapSize.y=_.y)),Wt.map===null||Pt===!0||kt===!0){const It=this.type!==de?{minFilter:lr,magFilter:lr}:{};Wt.map!==null&&Wt.map.dispose(),Wt.map=new ms(m.x,m.y,It),Wt.map.texture.name=tn.name+".shadowMap",Wt.camera.updateProjectionMatrix()}b.setRenderTarget(Wt.map),b.clear();const pn=Wt.getViewportCount();for(let It=0;It<pn;It++){const Qt=Wt.getViewport(It);x.set(_.x*Qt.x,_.y*Qt.y,_.x*Qt.z,_.y*Qt.w),Ze.viewport(x),Wt.updateMatrices(tn,It),p=Wt.getFrustum(),Te(Ie,Ke,Wt.camera,tn,this.type)}Wt.isPointLightShadow!==!0&&this.type===de&&ae(Wt,Ke),Wt.needsUpdate=!1}Z=this.type,K.needsUpdate=!1,b.setRenderTarget(ct,Je,yt)}}function Db(b,r,c){const p=c.isWebGL2,m=new function(){let Se=!1;const $e=new Ji;let it=null;const Ot=new Ji(0,0,0,0);return{setMask:function(Ut){it===Ut||Se||(b.colorMask(Ut,Ut,Ut,Ut),it=Ut)},setLocked:function(Ut){Se=Ut},setClear:function(Ut,Vt,mn,In,Qn){Qn===!0&&(Ut*=In,Vt*=In,mn*=In),$e.set(Ut,Vt,mn,In),Ot.equals($e)===!1&&(b.clearColor(Ut,Vt,mn,In),Ot.copy($e))},reset:function(){Se=!1,it=null,Ot.set(-1,0,0,0)}}},_=new function(){let Se=!1,$e=null,it=null,Ot=null;return{setTest:function(Ut){Ut?bn(b.DEPTH_TEST):ni(b.DEPTH_TEST)},setMask:function(Ut){$e===Ut||Se||(b.depthMask(Ut),$e=Ut)},setFunc:function(Ut){if(it!==Ut){switch(Ut){case mt:b.depthFunc(b.NEVER);break;case be:b.depthFunc(b.ALWAYS);break;case Ve:b.depthFunc(b.LESS);break;case tt:b.depthFunc(b.LEQUAL);break;case Zt:b.depthFunc(b.EQUAL);break;case bt:b.depthFunc(b.GEQUAL);break;case cn:b.depthFunc(b.GREATER);break;case hi:b.depthFunc(b.NOTEQUAL);break;default:b.depthFunc(b.LEQUAL)}it=Ut}},setLocked:function(Ut){Se=Ut},setClear:function(Ut){Ot!==Ut&&(b.clearDepth(Ut),Ot=Ut)},reset:function(){Se=!1,$e=null,it=null,Ot=null}}},x=new function(){let Se=!1,$e=null,it=null,Ot=null,Ut=null,Vt=null,mn=null,In=null,Qn=null;return{setTest:function(Mn){Se||(Mn?bn(b.STENCIL_TEST):ni(b.STENCIL_TEST))},setMask:function(Mn){$e===Mn||Se||(b.stencilMask(Mn),$e=Mn)},setFunc:function(Mn,Yn,Kn){it===Mn&&Ot===Yn&&Ut===Kn||(b.stencilFunc(Mn,Yn,Kn),it=Mn,Ot=Yn,Ut=Kn)},setOp:function(Mn,Yn,Kn){Vt===Mn&&mn===Yn&&In===Kn||(b.stencilOp(Mn,Yn,Kn),Vt=Mn,mn=Yn,In=Kn)},setLocked:function(Mn){Se=Mn},setClear:function(Mn){Qn!==Mn&&(b.clearStencil(Mn),Qn=Mn)},reset:function(){Se=!1,$e=null,it=null,Ot=null,Ut=null,Vt=null,mn=null,In=null,Qn=null}}},S=new WeakMap,B=new WeakMap;let D={},U={},G=new WeakMap,V=[],Q=null,q=!1,te=null,K=null,Z=null,ae=null,ce=null,Te=null,Ce=null,Ie=!1,Ke=null,ct=null,Je=null,yt=null,Ze=null;const Pt=b.getParameter(b.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let kt=!1,en=0;const xn=b.getParameter(b.VERSION);xn.indexOf("WebGL")!==-1?(en=parseFloat(/^WebGL (\d)/.exec(xn)[1]),kt=en>=1):xn.indexOf("OpenGL ES")!==-1&&(en=parseFloat(/^OpenGL ES (\d)/.exec(xn)[1]),kt=en>=2);let tn=null,Wt={};const dn=b.getParameter(b.SCISSOR_BOX),pn=b.getParameter(b.VIEWPORT),It=new Ji().fromArray(dn),Qt=new Ji().fromArray(pn);function un(Se,$e,it,Ot){const Ut=new Uint8Array(4),Vt=b.createTexture();b.bindTexture(Se,Vt),b.texParameteri(Se,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(Se,b.TEXTURE_MAG_FILTER,b.NEAREST);for(let mn=0;mn<it;mn++)!p||Se!==b.TEXTURE_3D&&Se!==b.TEXTURE_2D_ARRAY?b.texImage2D($e+mn,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,Ut):b.texImage3D($e,0,b.RGBA,1,1,Ot,0,b.RGBA,b.UNSIGNED_BYTE,Ut);return Vt}const Kt={};function bn(Se){D[Se]!==!0&&(b.enable(Se),D[Se]=!0)}function ni(Se){D[Se]!==!1&&(b.disable(Se),D[Se]=!1)}Kt[b.TEXTURE_2D]=un(b.TEXTURE_2D,b.TEXTURE_2D,1),Kt[b.TEXTURE_CUBE_MAP]=un(b.TEXTURE_CUBE_MAP,b.TEXTURE_CUBE_MAP_POSITIVE_X,6),p&&(Kt[b.TEXTURE_2D_ARRAY]=un(b.TEXTURE_2D_ARRAY,b.TEXTURE_2D_ARRAY,1,1),Kt[b.TEXTURE_3D]=un(b.TEXTURE_3D,b.TEXTURE_3D,1,1)),m.setClear(0,0,0,1),_.setClear(1),x.setClear(0),bn(b.DEPTH_TEST),_.setFunc(tt),rt(!1),Qe(se),bn(b.CULL_FACE),_t(Fe);const Xe={[le]:b.FUNC_ADD,[_e]:b.FUNC_SUBTRACT,[qe]:b.FUNC_REVERSE_SUBTRACT};if(p)Xe[re]=b.MIN,Xe[he]=b.MAX;else{const Se=r.get("EXT_blend_minmax");Se!==null&&(Xe[re]=Se.MIN_EXT,Xe[he]=Se.MAX_EXT)}const Le={[ye]:b.ZERO,[Me]:b.ONE,[nt]:b.SRC_COLOR,[Mt]:b.SRC_ALPHA,[Ft]:b.SRC_ALPHA_SATURATE,[Ct]:b.DST_COLOR,[Dt]:b.DST_ALPHA,[ft]:b.ONE_MINUS_SRC_COLOR,[At]:b.ONE_MINUS_SRC_ALPHA,[Tt]:b.ONE_MINUS_DST_COLOR,[ot]:b.ONE_MINUS_DST_ALPHA};function _t(Se,$e,it,Ot,Ut,Vt,mn,In){if(Se!==Fe){if(q===!1&&(bn(b.BLEND),q=!0),Se===$)Ut=Ut||$e,Vt=Vt||it,mn=mn||Ot,$e===K&&Ut===ce||(b.blendEquationSeparate(Xe[$e],Xe[Ut]),K=$e,ce=Ut),it===Z&&Ot===ae&&Vt===Te&&mn===Ce||(b.blendFuncSeparate(Le[it],Le[Ot],Le[Vt],Le[mn]),Z=it,ae=Ot,Te=Vt,Ce=mn),te=Se,Ie=!1;else if(Se!==te||In!==Ie){if(K===le&&ce===le||(b.blendEquation(b.FUNC_ADD),K=le,ce=le),In)switch(Se){case et:b.blendFuncSeparate(b.ONE,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);break;case pt:b.blendFunc(b.ONE,b.ONE);break;case Ge:b.blendFuncSeparate(b.ZERO,b.ONE_MINUS_SRC_COLOR,b.ZERO,b.ONE);break;case Ye:b.blendFuncSeparate(b.ZERO,b.SRC_COLOR,b.ZERO,b.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Se)}else switch(Se){case et:b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);break;case pt:b.blendFunc(b.SRC_ALPHA,b.ONE);break;case Ge:b.blendFuncSeparate(b.ZERO,b.ONE_MINUS_SRC_COLOR,b.ZERO,b.ONE);break;case Ye:b.blendFunc(b.ZERO,b.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Se)}Z=null,ae=null,Te=null,Ce=null,te=Se,Ie=In}}else q===!0&&(ni(b.BLEND),q=!1)}function rt(Se){Ke!==Se&&(Se?b.frontFace(b.CW):b.frontFace(b.CCW),Ke=Se)}function Qe(Se){Se!==J?(bn(b.CULL_FACE),Se!==ct&&(Se===se?b.cullFace(b.BACK):Se===Y?b.cullFace(b.FRONT):b.cullFace(b.FRONT_AND_BACK))):ni(b.CULL_FACE),ct=Se}function lt(Se,$e,it){Se?(bn(b.POLYGON_OFFSET_FILL),yt===$e&&Ze===it||(b.polygonOffset($e,it),yt=$e,Ze=it)):ni(b.POLYGON_OFFSET_FILL)}return{buffers:{color:m,depth:_,stencil:x},enable:bn,disable:ni,bindFramebuffer:function(Se,$e){return U[Se]!==$e&&(b.bindFramebuffer(Se,$e),U[Se]=$e,p&&(Se===b.DRAW_FRAMEBUFFER&&(U[b.FRAMEBUFFER]=$e),Se===b.FRAMEBUFFER&&(U[b.DRAW_FRAMEBUFFER]=$e)),!0)},drawBuffers:function(Se,$e){let it=V,Ot=!1;if(Se)if(it=G.get($e),it===void 0&&(it=[],G.set($e,it)),Se.isWebGLMultipleRenderTargets){const Ut=Se.texture;if(it.length!==Ut.length||it[0]!==b.COLOR_ATTACHMENT0){for(let Vt=0,mn=Ut.length;Vt<mn;Vt++)it[Vt]=b.COLOR_ATTACHMENT0+Vt;it.length=Ut.length,Ot=!0}}else it[0]!==b.COLOR_ATTACHMENT0&&(it[0]=b.COLOR_ATTACHMENT0,Ot=!0);else it[0]!==b.BACK&&(it[0]=b.BACK,Ot=!0);Ot&&(c.isWebGL2?b.drawBuffers(it):r.get("WEBGL_draw_buffers").drawBuffersWEBGL(it))},useProgram:function(Se){return Q!==Se&&(b.useProgram(Se),Q=Se,!0)},setBlending:_t,setMaterial:function(Se,$e){Se.side===He?ni(b.CULL_FACE):bn(b.CULL_FACE);let it=Se.side===ue;$e&&(it=!it),rt(it),Se.blending===et&&Se.transparent===!1?_t(Fe):_t(Se.blending,Se.blendEquation,Se.blendSrc,Se.blendDst,Se.blendEquationAlpha,Se.blendSrcAlpha,Se.blendDstAlpha,Se.premultipliedAlpha),_.setFunc(Se.depthFunc),_.setTest(Se.depthTest),_.setMask(Se.depthWrite),m.setMask(Se.colorWrite);const Ot=Se.stencilWrite;x.setTest(Ot),Ot&&(x.setMask(Se.stencilWriteMask),x.setFunc(Se.stencilFunc,Se.stencilRef,Se.stencilFuncMask),x.setOp(Se.stencilFail,Se.stencilZFail,Se.stencilZPass)),lt(Se.polygonOffset,Se.polygonOffsetFactor,Se.polygonOffsetUnits),Se.alphaToCoverage===!0?bn(b.SAMPLE_ALPHA_TO_COVERAGE):ni(b.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:rt,setCullFace:Qe,setLineWidth:function(Se){Se!==Je&&(kt&&b.lineWidth(Se),Je=Se)},setPolygonOffset:lt,setScissorTest:function(Se){Se?bn(b.SCISSOR_TEST):ni(b.SCISSOR_TEST)},activeTexture:function(Se){Se===void 0&&(Se=b.TEXTURE0+Pt-1),tn!==Se&&(b.activeTexture(Se),tn=Se)},bindTexture:function(Se,$e,it){it===void 0&&(it=tn===null?b.TEXTURE0+Pt-1:tn);let Ot=Wt[it];Ot===void 0&&(Ot={type:void 0,texture:void 0},Wt[it]=Ot),Ot.type===Se&&Ot.texture===$e||(tn!==it&&(b.activeTexture(it),tn=it),b.bindTexture(Se,$e||Kt[Se]),Ot.type=Se,Ot.texture=$e)},unbindTexture:function(){const Se=Wt[tn];Se!==void 0&&Se.type!==void 0&&(b.bindTexture(Se.type,null),Se.type=void 0,Se.texture=void 0)},compressedTexImage2D:function(){try{b.compressedTexImage2D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},compressedTexImage3D:function(){try{b.compressedTexImage3D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},texImage2D:function(){try{b.texImage2D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},texImage3D:function(){try{b.texImage3D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},updateUBOMapping:function(Se,$e){let it=B.get($e);it===void 0&&(it=new WeakMap,B.set($e,it));let Ot=it.get(Se);Ot===void 0&&(Ot=b.getUniformBlockIndex($e,Se.name),it.set(Se,Ot))},uniformBlockBinding:function(Se,$e){const it=B.get($e).get(Se);S.get($e)!==it&&(b.uniformBlockBinding($e,it,Se.__bindingPointIndex),S.set($e,it))},texStorage2D:function(){try{b.texStorage2D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},texStorage3D:function(){try{b.texStorage3D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},texSubImage2D:function(){try{b.texSubImage2D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},texSubImage3D:function(){try{b.texSubImage3D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},compressedTexSubImage2D:function(){try{b.compressedTexSubImage2D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},compressedTexSubImage3D:function(){try{b.compressedTexSubImage3D.apply(b,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}},scissor:function(Se){It.equals(Se)===!1&&(b.scissor(Se.x,Se.y,Se.z,Se.w),It.copy(Se))},viewport:function(Se){Qt.equals(Se)===!1&&(b.viewport(Se.x,Se.y,Se.z,Se.w),Qt.copy(Se))},reset:function(){b.disable(b.BLEND),b.disable(b.CULL_FACE),b.disable(b.DEPTH_TEST),b.disable(b.POLYGON_OFFSET_FILL),b.disable(b.SCISSOR_TEST),b.disable(b.STENCIL_TEST),b.disable(b.SAMPLE_ALPHA_TO_COVERAGE),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ONE,b.ZERO),b.blendFuncSeparate(b.ONE,b.ZERO,b.ONE,b.ZERO),b.colorMask(!0,!0,!0,!0),b.clearColor(0,0,0,0),b.depthMask(!0),b.depthFunc(b.LESS),b.clearDepth(1),b.stencilMask(4294967295),b.stencilFunc(b.ALWAYS,0,4294967295),b.stencilOp(b.KEEP,b.KEEP,b.KEEP),b.clearStencil(0),b.cullFace(b.BACK),b.frontFace(b.CCW),b.polygonOffset(0,0),b.activeTexture(b.TEXTURE0),b.bindFramebuffer(b.FRAMEBUFFER,null),p===!0&&(b.bindFramebuffer(b.DRAW_FRAMEBUFFER,null),b.bindFramebuffer(b.READ_FRAMEBUFFER,null)),b.useProgram(null),b.lineWidth(1),b.scissor(0,0,b.canvas.width,b.canvas.height),b.viewport(0,0,b.canvas.width,b.canvas.height),D={},tn=null,Wt={},U={},G=new WeakMap,V=[],Q=null,q=!1,te=null,K=null,Z=null,ae=null,ce=null,Te=null,Ce=null,Ie=!1,Ke=null,ct=null,Je=null,yt=null,Ze=null,It.set(0,0,b.canvas.width,b.canvas.height),Qt.set(0,0,b.canvas.width,b.canvas.height),m.reset(),_.reset(),x.reset()}}}function Ti(b,r,c,p,m,_,x){const S=m.isWebGL2,B=m.maxTextures,D=m.maxCubemapSize,U=m.maxTextureSize,G=m.maxSamples,V=r.has("WEBGL_multisampled_render_to_texture")?r.get("WEBGL_multisampled_render_to_texture"):null,Q=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),q=new WeakMap;let te;const K=new WeakMap;let Z=!1;try{Z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ae(Xe,Le){return Z?new OffscreenCanvas(Xe,Le):Mh("canvas")}function ce(Xe,Le,_t,rt){let Qe=1;if((Xe.width>rt||Xe.height>rt)&&(Qe=rt/Math.max(Xe.width,Xe.height)),Qe<1||Le===!0){if(typeof HTMLImageElement<"u"&&Xe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Xe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Xe instanceof ImageBitmap){const lt=Le?hc:Math.floor,Se=lt(Qe*Xe.width),$e=lt(Qe*Xe.height);te===void 0&&(te=ae(Se,$e));const it=_t?ae(Se,$e):te;return it.width=Se,it.height=$e,it.getContext("2d").drawImage(Xe,0,0,Se,$e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Xe.width+"x"+Xe.height+") to ("+Se+"x"+$e+")."),it}return"data"in Xe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Xe.width+"x"+Xe.height+")."),Xe}return Xe}function Te(Xe){return Sh(Xe.width)&&Sh(Xe.height)}function Ce(Xe,Le){return Xe.generateMipmaps&&Le&&Xe.minFilter!==lr&&Xe.minFilter!==Cr}function Ie(Xe){b.generateMipmap(Xe)}function Ke(Xe,Le,_t,rt,Qe=!1){if(S===!1)return Le;if(Xe!==null){if(b[Xe]!==void 0)return b[Xe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Xe+"'")}let lt=Le;return Le===b.RED&&(_t===b.FLOAT&&(lt=b.R32F),_t===b.HALF_FLOAT&&(lt=b.R16F),_t===b.UNSIGNED_BYTE&&(lt=b.R8)),Le===b.RG&&(_t===b.FLOAT&&(lt=b.RG32F),_t===b.HALF_FLOAT&&(lt=b.RG16F),_t===b.UNSIGNED_BYTE&&(lt=b.RG8)),Le===b.RGBA&&(_t===b.FLOAT&&(lt=b.RGBA32F),_t===b.HALF_FLOAT&&(lt=b.RGBA16F),_t===b.UNSIGNED_BYTE&&(lt=rt===Xn&&Qe===!1?b.SRGB8_ALPHA8:b.RGBA8),_t===b.UNSIGNED_SHORT_4_4_4_4&&(lt=b.RGBA4),_t===b.UNSIGNED_SHORT_5_5_5_1&&(lt=b.RGB5_A1)),lt!==b.R16F&&lt!==b.R32F&&lt!==b.RG16F&&lt!==b.RG32F&&lt!==b.RGBA16F&&lt!==b.RGBA32F||r.get("EXT_color_buffer_float"),lt}function ct(Xe,Le,_t){return Ce(Xe,_t)===!0||Xe.isFramebufferTexture&&Xe.minFilter!==lr&&Xe.minFilter!==Cr?Math.log2(Math.max(Le.width,Le.height))+1:Xe.mipmaps!==void 0&&Xe.mipmaps.length>0?Xe.mipmaps.length:Xe.isCompressedTexture&&Array.isArray(Xe.image)?Le.mipmaps.length:1}function Je(Xe){return Xe===lr||Xe===Ka||Xe===sc?b.NEAREST:b.LINEAR}function yt(Xe){const Le=Xe.target;Le.removeEventListener("dispose",yt),function(_t){const rt=p.get(_t);if(rt.__webglInit===void 0)return;const Qe=_t.source,lt=K.get(Qe);if(lt){const Se=lt[rt.__cacheKey];Se.usedTimes--,Se.usedTimes===0&&Pt(_t),Object.keys(lt).length===0&&K.delete(Qe)}p.remove(_t)}(Le),Le.isVideoTexture&&q.delete(Le)}function Ze(Xe){const Le=Xe.target;Le.removeEventListener("dispose",Ze),function(_t){const rt=_t.texture,Qe=p.get(_t),lt=p.get(rt);if(lt.__webglTexture!==void 0&&(b.deleteTexture(lt.__webglTexture),x.memory.textures--),_t.depthTexture&&_t.depthTexture.dispose(),_t.isWebGLCubeRenderTarget)for(let Se=0;Se<6;Se++)b.deleteFramebuffer(Qe.__webglFramebuffer[Se]),Qe.__webglDepthbuffer&&b.deleteRenderbuffer(Qe.__webglDepthbuffer[Se]);else{if(b.deleteFramebuffer(Qe.__webglFramebuffer),Qe.__webglDepthbuffer&&b.deleteRenderbuffer(Qe.__webglDepthbuffer),Qe.__webglMultisampledFramebuffer&&b.deleteFramebuffer(Qe.__webglMultisampledFramebuffer),Qe.__webglColorRenderbuffer)for(let Se=0;Se<Qe.__webglColorRenderbuffer.length;Se++)Qe.__webglColorRenderbuffer[Se]&&b.deleteRenderbuffer(Qe.__webglColorRenderbuffer[Se]);Qe.__webglDepthRenderbuffer&&b.deleteRenderbuffer(Qe.__webglDepthRenderbuffer)}if(_t.isWebGLMultipleRenderTargets)for(let Se=0,$e=rt.length;Se<$e;Se++){const it=p.get(rt[Se]);it.__webglTexture&&(b.deleteTexture(it.__webglTexture),x.memory.textures--),p.remove(rt[Se])}p.remove(rt),p.remove(_t)}(Le)}function Pt(Xe){const Le=p.get(Xe);b.deleteTexture(Le.__webglTexture);const _t=Xe.source;delete K.get(_t)[Le.__cacheKey],x.memory.textures--}let kt=0;function en(Xe,Le){const _t=p.get(Xe);if(Xe.isVideoTexture&&function(rt){const Qe=x.render.frame;q.get(rt)!==Qe&&(q.set(rt,Qe),rt.update())}(Xe),Xe.isRenderTargetTexture===!1&&Xe.version>0&&_t.__version!==Xe.version){const rt=Xe.image;if(rt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(rt.complete!==!1)return void pn(_t,Xe,Le);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}c.bindTexture(b.TEXTURE_2D,_t.__webglTexture,b.TEXTURE0+Le)}const xn={[bo]:b.REPEAT,[Mr]:b.CLAMP_TO_EDGE,[Xs]:b.MIRRORED_REPEAT},tn={[lr]:b.NEAREST,[Ka]:b.NEAREST_MIPMAP_NEAREST,[sc]:b.NEAREST_MIPMAP_LINEAR,[Cr]:b.LINEAR,[fa]:b.LINEAR_MIPMAP_NEAREST,[ds]:b.LINEAR_MIPMAP_LINEAR};function Wt(Xe,Le,_t){if(_t?(b.texParameteri(Xe,b.TEXTURE_WRAP_S,xn[Le.wrapS]),b.texParameteri(Xe,b.TEXTURE_WRAP_T,xn[Le.wrapT]),Xe!==b.TEXTURE_3D&&Xe!==b.TEXTURE_2D_ARRAY||b.texParameteri(Xe,b.TEXTURE_WRAP_R,xn[Le.wrapR]),b.texParameteri(Xe,b.TEXTURE_MAG_FILTER,tn[Le.magFilter]),b.texParameteri(Xe,b.TEXTURE_MIN_FILTER,tn[Le.minFilter])):(b.texParameteri(Xe,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(Xe,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),Xe!==b.TEXTURE_3D&&Xe!==b.TEXTURE_2D_ARRAY||b.texParameteri(Xe,b.TEXTURE_WRAP_R,b.CLAMP_TO_EDGE),Le.wrapS===Mr&&Le.wrapT===Mr||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),b.texParameteri(Xe,b.TEXTURE_MAG_FILTER,Je(Le.magFilter)),b.texParameteri(Xe,b.TEXTURE_MIN_FILTER,Je(Le.minFilter)),Le.minFilter!==lr&&Le.minFilter!==Cr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),r.has("EXT_texture_filter_anisotropic")===!0){const rt=r.get("EXT_texture_filter_anisotropic");if(Le.magFilter===lr||Le.minFilter!==sc&&Le.minFilter!==ds||Le.type===wl&&r.has("OES_texture_float_linear")===!1||S===!1&&Le.type===Ja&&r.has("OES_texture_half_float_linear")===!1)return;(Le.anisotropy>1||p.get(Le).__currentAnisotropy)&&(b.texParameterf(Xe,rt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Le.anisotropy,m.getMaxAnisotropy())),p.get(Le).__currentAnisotropy=Le.anisotropy)}}function dn(Xe,Le){let _t=!1;Xe.__webglInit===void 0&&(Xe.__webglInit=!0,Le.addEventListener("dispose",yt));const rt=Le.source;let Qe=K.get(rt);Qe===void 0&&(Qe={},K.set(rt,Qe));const lt=function(Se){const $e=[];return $e.push(Se.wrapS),$e.push(Se.wrapT),$e.push(Se.wrapR||0),$e.push(Se.magFilter),$e.push(Se.minFilter),$e.push(Se.anisotropy),$e.push(Se.internalFormat),$e.push(Se.format),$e.push(Se.type),$e.push(Se.generateMipmaps),$e.push(Se.premultiplyAlpha),$e.push(Se.flipY),$e.push(Se.unpackAlignment),$e.push(Se.colorSpace),$e.join()}(Le);if(lt!==Xe.__cacheKey){Qe[lt]===void 0&&(Qe[lt]={texture:b.createTexture(),usedTimes:0},x.memory.textures++,_t=!0),Qe[lt].usedTimes++;const Se=Qe[Xe.__cacheKey];Se!==void 0&&(Qe[Xe.__cacheKey].usedTimes--,Se.usedTimes===0&&Pt(Le)),Xe.__cacheKey=lt,Xe.__webglTexture=Qe[lt].texture}return _t}function pn(Xe,Le,_t){let rt=b.TEXTURE_2D;(Le.isDataArrayTexture||Le.isCompressedArrayTexture)&&(rt=b.TEXTURE_2D_ARRAY),Le.isData3DTexture&&(rt=b.TEXTURE_3D);const Qe=dn(Xe,Le),lt=Le.source;c.bindTexture(rt,Xe.__webglTexture,b.TEXTURE0+_t);const Se=p.get(lt);if(lt.version!==Se.__version||Qe===!0){c.activeTexture(b.TEXTURE0+_t),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,Le.flipY),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Le.premultiplyAlpha),b.pixelStorei(b.UNPACK_ALIGNMENT,Le.unpackAlignment),b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.NONE);const $e=function(Gn){return!S&&(Gn.wrapS!==Mr||Gn.wrapT!==Mr||Gn.minFilter!==lr&&Gn.minFilter!==Cr)}(Le)&&Te(Le.image)===!1;let it=ce(Le.image,$e,!1,U);it=ni(Le,it);const Ot=Te(it)||S,Ut=_.convert(Le.format,Le.colorSpace);let Vt,mn=_.convert(Le.type),In=Ke(Le.internalFormat,Ut,mn,Le.colorSpace);Wt(rt,Le,Ot);const Qn=Le.mipmaps,Mn=S&&Le.isVideoTexture!==!0,Yn=Se.__version===void 0||Qe===!0,Kn=ct(Le,it,Ot);if(Le.isDepthTexture)In=b.DEPTH_COMPONENT,S?In=Le.type===wl?b.DEPTH_COMPONENT32F:Le.type===xs?b.DEPTH_COMPONENT24:Le.type===Uc?b.DEPTH24_STENCIL8:b.DEPTH_COMPONENT16:Le.type===wl&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Le.format===xo&&In===b.DEPTH_COMPONENT&&Le.type!==cr&&Le.type!==xs&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Le.type=xs,mn=_.convert(Le.type)),Le.format===ka&&In===b.DEPTH_COMPONENT&&(In=b.DEPTH_STENCIL,Le.type!==Uc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Le.type=Uc,mn=_.convert(Le.type))),Yn&&(Mn?c.texStorage2D(b.TEXTURE_2D,1,In,it.width,it.height):c.texImage2D(b.TEXTURE_2D,0,In,it.width,it.height,0,Ut,mn,null));else if(Le.isDataTexture)if(Qn.length>0&&Ot){Mn&&Yn&&c.texStorage2D(b.TEXTURE_2D,Kn,In,Qn[0].width,Qn[0].height);for(let Gn=0,ki=Qn.length;Gn<ki;Gn++)Vt=Qn[Gn],Mn?c.texSubImage2D(b.TEXTURE_2D,Gn,0,0,Vt.width,Vt.height,Ut,mn,Vt.data):c.texImage2D(b.TEXTURE_2D,Gn,In,Vt.width,Vt.height,0,Ut,mn,Vt.data);Le.generateMipmaps=!1}else Mn?(Yn&&c.texStorage2D(b.TEXTURE_2D,Kn,In,it.width,it.height),c.texSubImage2D(b.TEXTURE_2D,0,0,0,it.width,it.height,Ut,mn,it.data)):c.texImage2D(b.TEXTURE_2D,0,In,it.width,it.height,0,Ut,mn,it.data);else if(Le.isCompressedTexture)if(Le.isCompressedArrayTexture){Mn&&Yn&&c.texStorage3D(b.TEXTURE_2D_ARRAY,Kn,In,Qn[0].width,Qn[0].height,it.depth);for(let Gn=0,ki=Qn.length;Gn<ki;Gn++)Vt=Qn[Gn],Le.format!==Ls?Ut!==null?Mn?c.compressedTexSubImage3D(b.TEXTURE_2D_ARRAY,Gn,0,0,0,Vt.width,Vt.height,it.depth,Ut,Vt.data,0,0):c.compressedTexImage3D(b.TEXTURE_2D_ARRAY,Gn,In,Vt.width,Vt.height,it.depth,0,Vt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Mn?c.texSubImage3D(b.TEXTURE_2D_ARRAY,Gn,0,0,0,Vt.width,Vt.height,it.depth,Ut,mn,Vt.data):c.texImage3D(b.TEXTURE_2D_ARRAY,Gn,In,Vt.width,Vt.height,it.depth,0,Ut,mn,Vt.data)}else{Mn&&Yn&&c.texStorage2D(b.TEXTURE_2D,Kn,In,Qn[0].width,Qn[0].height);for(let Gn=0,ki=Qn.length;Gn<ki;Gn++)Vt=Qn[Gn],Le.format!==Ls?Ut!==null?Mn?c.compressedTexSubImage2D(b.TEXTURE_2D,Gn,0,0,Vt.width,Vt.height,Ut,Vt.data):c.compressedTexImage2D(b.TEXTURE_2D,Gn,In,Vt.width,Vt.height,0,Vt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Mn?c.texSubImage2D(b.TEXTURE_2D,Gn,0,0,Vt.width,Vt.height,Ut,mn,Vt.data):c.texImage2D(b.TEXTURE_2D,Gn,In,Vt.width,Vt.height,0,Ut,mn,Vt.data)}else if(Le.isDataArrayTexture)Mn?(Yn&&c.texStorage3D(b.TEXTURE_2D_ARRAY,Kn,In,it.width,it.height,it.depth),c.texSubImage3D(b.TEXTURE_2D_ARRAY,0,0,0,0,it.width,it.height,it.depth,Ut,mn,it.data)):c.texImage3D(b.TEXTURE_2D_ARRAY,0,In,it.width,it.height,it.depth,0,Ut,mn,it.data);else if(Le.isData3DTexture)Mn?(Yn&&c.texStorage3D(b.TEXTURE_3D,Kn,In,it.width,it.height,it.depth),c.texSubImage3D(b.TEXTURE_3D,0,0,0,0,it.width,it.height,it.depth,Ut,mn,it.data)):c.texImage3D(b.TEXTURE_3D,0,In,it.width,it.height,it.depth,0,Ut,mn,it.data);else if(Le.isFramebufferTexture){if(Yn)if(Mn)c.texStorage2D(b.TEXTURE_2D,Kn,In,it.width,it.height);else{let Gn=it.width,ki=it.height;for(let oa=0;oa<Kn;oa++)c.texImage2D(b.TEXTURE_2D,oa,In,Gn,ki,0,Ut,mn,null),Gn>>=1,ki>>=1}}else if(Qn.length>0&&Ot){Mn&&Yn&&c.texStorage2D(b.TEXTURE_2D,Kn,In,Qn[0].width,Qn[0].height);for(let Gn=0,ki=Qn.length;Gn<ki;Gn++)Vt=Qn[Gn],Mn?c.texSubImage2D(b.TEXTURE_2D,Gn,0,0,Ut,mn,Vt):c.texImage2D(b.TEXTURE_2D,Gn,In,Ut,mn,Vt);Le.generateMipmaps=!1}else Mn?(Yn&&c.texStorage2D(b.TEXTURE_2D,Kn,In,it.width,it.height),c.texSubImage2D(b.TEXTURE_2D,0,0,0,Ut,mn,it)):c.texImage2D(b.TEXTURE_2D,0,In,Ut,mn,it);Ce(Le,Ot)&&Ie(rt),Se.__version=lt.version,Le.onUpdate&&Le.onUpdate(Le)}Xe.__version=Le.version}function It(Xe,Le,_t,rt,Qe){const lt=_.convert(_t.format,_t.colorSpace),Se=_.convert(_t.type),$e=Ke(_t.internalFormat,lt,Se,_t.colorSpace);p.get(Le).__hasExternalTextures||(Qe===b.TEXTURE_3D||Qe===b.TEXTURE_2D_ARRAY?c.texImage3D(Qe,0,$e,Le.width,Le.height,Le.depth,0,lt,Se,null):c.texImage2D(Qe,0,$e,Le.width,Le.height,0,lt,Se,null)),c.bindFramebuffer(b.FRAMEBUFFER,Xe),bn(Le)?V.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,rt,Qe,p.get(_t).__webglTexture,0,Kt(Le)):(Qe===b.TEXTURE_2D||Qe>=b.TEXTURE_CUBE_MAP_POSITIVE_X&&Qe<=b.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&b.framebufferTexture2D(b.FRAMEBUFFER,rt,Qe,p.get(_t).__webglTexture,0),c.bindFramebuffer(b.FRAMEBUFFER,null)}function Qt(Xe,Le,_t){if(b.bindRenderbuffer(b.RENDERBUFFER,Xe),Le.depthBuffer&&!Le.stencilBuffer){let rt=b.DEPTH_COMPONENT16;if(_t||bn(Le)){const Qe=Le.depthTexture;Qe&&Qe.isDepthTexture&&(Qe.type===wl?rt=b.DEPTH_COMPONENT32F:Qe.type===xs&&(rt=b.DEPTH_COMPONENT24));const lt=Kt(Le);bn(Le)?V.renderbufferStorageMultisampleEXT(b.RENDERBUFFER,lt,rt,Le.width,Le.height):b.renderbufferStorageMultisample(b.RENDERBUFFER,lt,rt,Le.width,Le.height)}else b.renderbufferStorage(b.RENDERBUFFER,rt,Le.width,Le.height);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,Xe)}else if(Le.depthBuffer&&Le.stencilBuffer){const rt=Kt(Le);_t&&bn(Le)===!1?b.renderbufferStorageMultisample(b.RENDERBUFFER,rt,b.DEPTH24_STENCIL8,Le.width,Le.height):bn(Le)?V.renderbufferStorageMultisampleEXT(b.RENDERBUFFER,rt,b.DEPTH24_STENCIL8,Le.width,Le.height):b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,Le.width,Le.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,Xe)}else{const rt=Le.isWebGLMultipleRenderTargets===!0?Le.texture:[Le.texture];for(let Qe=0;Qe<rt.length;Qe++){const lt=rt[Qe],Se=_.convert(lt.format,lt.colorSpace),$e=_.convert(lt.type),it=Ke(lt.internalFormat,Se,$e,lt.colorSpace),Ot=Kt(Le);_t&&bn(Le)===!1?b.renderbufferStorageMultisample(b.RENDERBUFFER,Ot,it,Le.width,Le.height):bn(Le)?V.renderbufferStorageMultisampleEXT(b.RENDERBUFFER,Ot,it,Le.width,Le.height):b.renderbufferStorage(b.RENDERBUFFER,it,Le.width,Le.height)}}b.bindRenderbuffer(b.RENDERBUFFER,null)}function un(Xe){const Le=p.get(Xe),_t=Xe.isWebGLCubeRenderTarget===!0;if(Xe.depthTexture&&!Le.__autoAllocateDepthBuffer){if(_t)throw new Error("target.depthTexture not supported in Cube render targets");(function(rt,Qe){if(Qe&&Qe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(c.bindFramebuffer(b.FRAMEBUFFER,rt),!Qe.depthTexture||!Qe.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");p.get(Qe.depthTexture).__webglTexture&&Qe.depthTexture.image.width===Qe.width&&Qe.depthTexture.image.height===Qe.height||(Qe.depthTexture.image.width=Qe.width,Qe.depthTexture.image.height=Qe.height,Qe.depthTexture.needsUpdate=!0),en(Qe.depthTexture,0);const lt=p.get(Qe.depthTexture).__webglTexture,Se=Kt(Qe);if(Qe.depthTexture.format===xo)bn(Qe)?V.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,lt,0,Se):b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,lt,0);else{if(Qe.depthTexture.format!==ka)throw new Error("Unknown depthTexture format");bn(Qe)?V.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,lt,0,Se):b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,lt,0)}})(Le.__webglFramebuffer,Xe)}else if(_t){Le.__webglDepthbuffer=[];for(let rt=0;rt<6;rt++)c.bindFramebuffer(b.FRAMEBUFFER,Le.__webglFramebuffer[rt]),Le.__webglDepthbuffer[rt]=b.createRenderbuffer(),Qt(Le.__webglDepthbuffer[rt],Xe,!1)}else c.bindFramebuffer(b.FRAMEBUFFER,Le.__webglFramebuffer),Le.__webglDepthbuffer=b.createRenderbuffer(),Qt(Le.__webglDepthbuffer,Xe,!1);c.bindFramebuffer(b.FRAMEBUFFER,null)}function Kt(Xe){return Math.min(G,Xe.samples)}function bn(Xe){const Le=p.get(Xe);return S&&Xe.samples>0&&r.has("WEBGL_multisampled_render_to_texture")===!0&&Le.__useRenderToTexture!==!1}function ni(Xe,Le){const _t=Xe.colorSpace,rt=Xe.format,Qe=Xe.type;return Xe.isCompressedTexture===!0||Xe.format===Hd||_t!==vi&&_t!==Mo&&(_t===Xn?S===!1?r.has("EXT_sRGB")===!0&&rt===Ls?(Xe.format=Hd,Xe.minFilter=Cr,Xe.generateMipmaps=!1):Le=Qd.sRGBToLinear(Le):rt===Ls&&Qe===xl||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):_t===Co||console.error("THREE.WebGLTextures: Unsupported texture color space:",_t)),Le}this.allocateTextureUnit=function(){const Xe=kt;return Xe>=B&&console.warn("THREE.WebGLTextures: Trying to use "+Xe+" texture units while this GPU supports only "+B),kt+=1,Xe},this.resetTextureUnits=function(){kt=0},this.setTexture2D=en,this.setTexture2DArray=function(Xe,Le){const _t=p.get(Xe);Xe.version>0&&_t.__version!==Xe.version?pn(_t,Xe,Le):c.bindTexture(b.TEXTURE_2D_ARRAY,_t.__webglTexture,b.TEXTURE0+Le)},this.setTexture3D=function(Xe,Le){const _t=p.get(Xe);Xe.version>0&&_t.__version!==Xe.version?pn(_t,Xe,Le):c.bindTexture(b.TEXTURE_3D,_t.__webglTexture,b.TEXTURE0+Le)},this.setTextureCube=function(Xe,Le){const _t=p.get(Xe);Xe.version>0&&_t.__version!==Xe.version?function(rt,Qe,lt){if(Qe.image.length!==6)return;const Se=dn(rt,Qe),$e=Qe.source;c.bindTexture(b.TEXTURE_CUBE_MAP,rt.__webglTexture,b.TEXTURE0+lt);const it=p.get($e);if($e.version!==it.__version||Se===!0){c.activeTexture(b.TEXTURE0+lt),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,Qe.flipY),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Qe.premultiplyAlpha),b.pixelStorei(b.UNPACK_ALIGNMENT,Qe.unpackAlignment),b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.NONE);const Ot=Qe.isCompressedTexture||Qe.image[0].isCompressedTexture,Ut=Qe.image[0]&&Qe.image[0].isDataTexture,Vt=[];for(let wi=0;wi<6;wi++)Vt[wi]=Ot||Ut?Ut?Qe.image[wi].image:Qe.image[wi]:ce(Qe.image[wi],!1,!0,D),Vt[wi]=ni(Qe,Vt[wi]);const mn=Vt[0],In=Te(mn)||S,Qn=_.convert(Qe.format,Qe.colorSpace),Mn=_.convert(Qe.type),Yn=Ke(Qe.internalFormat,Qn,Mn,Qe.colorSpace),Kn=S&&Qe.isVideoTexture!==!0,Gn=it.__version===void 0||Se===!0;let ki,oa=ct(Qe,mn,In);if(Wt(b.TEXTURE_CUBE_MAP,Qe,In),Ot){Kn&&Gn&&c.texStorage2D(b.TEXTURE_CUBE_MAP,oa,Yn,mn.width,mn.height);for(let wi=0;wi<6;wi++){ki=Vt[wi].mipmaps;for(let Qi=0;Qi<ki.length;Qi++){const Wi=ki[Qi];Qe.format!==Ls?Qn!==null?Kn?c.compressedTexSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,Qi,0,0,Wi.width,Wi.height,Qn,Wi.data):c.compressedTexImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,Qi,Yn,Wi.width,Wi.height,0,Wi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Kn?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,Qi,0,0,Wi.width,Wi.height,Qn,Mn,Wi.data):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,Qi,Yn,Wi.width,Wi.height,0,Qn,Mn,Wi.data)}}}else{ki=Qe.mipmaps,Kn&&Gn&&(ki.length>0&&oa++,c.texStorage2D(b.TEXTURE_CUBE_MAP,oa,Yn,Vt[0].width,Vt[0].height));for(let wi=0;wi<6;wi++)if(Ut){Kn?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,0,0,0,Vt[wi].width,Vt[wi].height,Qn,Mn,Vt[wi].data):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,0,Yn,Vt[wi].width,Vt[wi].height,0,Qn,Mn,Vt[wi].data);for(let Qi=0;Qi<ki.length;Qi++){const Wi=ki[Qi].image[wi].image;Kn?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,Qi+1,0,0,Wi.width,Wi.height,Qn,Mn,Wi.data):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,Qi+1,Yn,Wi.width,Wi.height,0,Qn,Mn,Wi.data)}}else{Kn?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,0,0,0,Qn,Mn,Vt[wi]):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,0,Yn,Qn,Mn,Vt[wi]);for(let Qi=0;Qi<ki.length;Qi++){const Wi=ki[Qi];Kn?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,Qi+1,0,0,Qn,Mn,Wi.image[wi]):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+wi,Qi+1,Yn,Qn,Mn,Wi.image[wi])}}}Ce(Qe,In)&&Ie(b.TEXTURE_CUBE_MAP),it.__version=$e.version,Qe.onUpdate&&Qe.onUpdate(Qe)}rt.__version=Qe.version}(_t,Xe,Le):c.bindTexture(b.TEXTURE_CUBE_MAP,_t.__webglTexture,b.TEXTURE0+Le)},this.rebindTextures=function(Xe,Le,_t){const rt=p.get(Xe);Le!==void 0&&It(rt.__webglFramebuffer,Xe,Xe.texture,b.COLOR_ATTACHMENT0,b.TEXTURE_2D),_t!==void 0&&un(Xe)},this.setupRenderTarget=function(Xe){const Le=Xe.texture,_t=p.get(Xe),rt=p.get(Le);Xe.addEventListener("dispose",Ze),Xe.isWebGLMultipleRenderTargets!==!0&&(rt.__webglTexture===void 0&&(rt.__webglTexture=b.createTexture()),rt.__version=Le.version,x.memory.textures++);const Qe=Xe.isWebGLCubeRenderTarget===!0,lt=Xe.isWebGLMultipleRenderTargets===!0,Se=Te(Xe)||S;if(Qe){_t.__webglFramebuffer=[];for(let $e=0;$e<6;$e++)_t.__webglFramebuffer[$e]=b.createFramebuffer()}else{if(_t.__webglFramebuffer=b.createFramebuffer(),lt)if(m.drawBuffers){const $e=Xe.texture;for(let it=0,Ot=$e.length;it<Ot;it++){const Ut=p.get($e[it]);Ut.__webglTexture===void 0&&(Ut.__webglTexture=b.createTexture(),x.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(S&&Xe.samples>0&&bn(Xe)===!1){const $e=lt?Le:[Le];_t.__webglMultisampledFramebuffer=b.createFramebuffer(),_t.__webglColorRenderbuffer=[],c.bindFramebuffer(b.FRAMEBUFFER,_t.__webglMultisampledFramebuffer);for(let it=0;it<$e.length;it++){const Ot=$e[it];_t.__webglColorRenderbuffer[it]=b.createRenderbuffer(),b.bindRenderbuffer(b.RENDERBUFFER,_t.__webglColorRenderbuffer[it]);const Ut=_.convert(Ot.format,Ot.colorSpace),Vt=_.convert(Ot.type),mn=Ke(Ot.internalFormat,Ut,Vt,Ot.colorSpace,Xe.isXRRenderTarget===!0),In=Kt(Xe);b.renderbufferStorageMultisample(b.RENDERBUFFER,In,mn,Xe.width,Xe.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+it,b.RENDERBUFFER,_t.__webglColorRenderbuffer[it])}b.bindRenderbuffer(b.RENDERBUFFER,null),Xe.depthBuffer&&(_t.__webglDepthRenderbuffer=b.createRenderbuffer(),Qt(_t.__webglDepthRenderbuffer,Xe,!0)),c.bindFramebuffer(b.FRAMEBUFFER,null)}}if(Qe){c.bindTexture(b.TEXTURE_CUBE_MAP,rt.__webglTexture),Wt(b.TEXTURE_CUBE_MAP,Le,Se);for(let $e=0;$e<6;$e++)It(_t.__webglFramebuffer[$e],Xe,Le,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+$e);Ce(Le,Se)&&Ie(b.TEXTURE_CUBE_MAP),c.unbindTexture()}else if(lt){const $e=Xe.texture;for(let it=0,Ot=$e.length;it<Ot;it++){const Ut=$e[it],Vt=p.get(Ut);c.bindTexture(b.TEXTURE_2D,Vt.__webglTexture),Wt(b.TEXTURE_2D,Ut,Se),It(_t.__webglFramebuffer,Xe,Ut,b.COLOR_ATTACHMENT0+it,b.TEXTURE_2D),Ce(Ut,Se)&&Ie(b.TEXTURE_2D)}c.unbindTexture()}else{let $e=b.TEXTURE_2D;(Xe.isWebGL3DRenderTarget||Xe.isWebGLArrayRenderTarget)&&(S?$e=Xe.isWebGL3DRenderTarget?b.TEXTURE_3D:b.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),c.bindTexture($e,rt.__webglTexture),Wt($e,Le,Se),It(_t.__webglFramebuffer,Xe,Le,b.COLOR_ATTACHMENT0,$e),Ce(Le,Se)&&Ie($e),c.unbindTexture()}Xe.depthBuffer&&un(Xe)},this.updateRenderTargetMipmap=function(Xe){const Le=Te(Xe)||S,_t=Xe.isWebGLMultipleRenderTargets===!0?Xe.texture:[Xe.texture],rt=Xe.isWebGLCubeRenderTarget?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D;for(let Qe=0,lt=_t.length;Qe<lt;Qe++){const Se=_t[Qe],$e=p.get(Se),it=$e.__webglTexture;$e.__version!==Se.version&&(c.bindTexture(rt,it),Wt(rt,Se,Le),c.unbindTexture(),$e.__version=Se.version),Ce(Se,Le)&&(c.bindTexture(rt,it),Ie(rt),c.unbindTexture())}},this.updateMultisampleRenderTarget=function(Xe){if(S&&Xe.samples>0&&bn(Xe)===!1){const Le=Xe.isWebGLMultipleRenderTargets?Xe.texture:[Xe.texture],_t=Xe.width,rt=Xe.height;let Qe=b.COLOR_BUFFER_BIT;const lt=[],Se=Xe.stencilBuffer?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT,$e=p.get(Xe),it=Xe.isWebGLMultipleRenderTargets===!0;if(it)for(let Ot=0;Ot<Le.length;Ot++)c.bindFramebuffer(b.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+Ot,b.RENDERBUFFER,null),c.bindFramebuffer(b.FRAMEBUFFER,$e.__webglFramebuffer),b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0+Ot,b.TEXTURE_2D,null,0);c.bindFramebuffer(b.READ_FRAMEBUFFER,$e.__webglMultisampledFramebuffer),c.bindFramebuffer(b.DRAW_FRAMEBUFFER,$e.__webglFramebuffer);for(let Ot=0;Ot<Le.length;Ot++){lt.push(b.COLOR_ATTACHMENT0+Ot),Xe.depthBuffer&&lt.push(Se);const Ut=$e.__ignoreDepthValues!==void 0&&$e.__ignoreDepthValues;if(Ut===!1&&(Xe.depthBuffer&&(Qe|=b.DEPTH_BUFFER_BIT),Xe.stencilBuffer&&(Qe|=b.STENCIL_BUFFER_BIT)),it&&b.framebufferRenderbuffer(b.READ_FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,$e.__webglColorRenderbuffer[Ot]),Ut===!0&&(b.invalidateFramebuffer(b.READ_FRAMEBUFFER,[Se]),b.invalidateFramebuffer(b.DRAW_FRAMEBUFFER,[Se])),it){const Vt=p.get(Le[Ot]).__webglTexture;b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,Vt,0)}b.blitFramebuffer(0,0,_t,rt,0,0,_t,rt,Qe,b.NEAREST),Q&&b.invalidateFramebuffer(b.READ_FRAMEBUFFER,lt)}if(c.bindFramebuffer(b.READ_FRAMEBUFFER,null),c.bindFramebuffer(b.DRAW_FRAMEBUFFER,null),it)for(let Ot=0;Ot<Le.length;Ot++){c.bindFramebuffer(b.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+Ot,b.RENDERBUFFER,$e.__webglColorRenderbuffer[Ot]);const Ut=p.get(Le[Ot]).__webglTexture;c.bindFramebuffer(b.FRAMEBUFFER,$e.__webglFramebuffer),b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0+Ot,b.TEXTURE_2D,Ut,0)}c.bindFramebuffer(b.DRAW_FRAMEBUFFER,$e.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=un,this.setupFrameBufferTexture=It,this.useMultisampledRTT=bn}function t_(b,r,c){const p=c.isWebGL2;return{convert:function(m,_=Mo){let x;if(m===xl)return b.UNSIGNED_BYTE;if(m===gh)return b.UNSIGNED_SHORT_4_4_4_4;if(m===vh)return b.UNSIGNED_SHORT_5_5_5_1;if(m===er)return b.BYTE;if(m===Xr)return b.SHORT;if(m===cr)return b.UNSIGNED_SHORT;if(m===Ud)return b.INT;if(m===xs)return b.UNSIGNED_INT;if(m===wl)return b.FLOAT;if(m===Ja)return p?b.HALF_FLOAT:(x=r.get("OES_texture_half_float"),x!==null?x.HALF_FLOAT_OES:null);if(m===Om)return b.ALPHA;if(m===Ls)return b.RGBA;if(m===ke)return b.LUMINANCE;if(m===Yo)return b.LUMINANCE_ALPHA;if(m===xo)return b.DEPTH_COMPONENT;if(m===ka)return b.DEPTH_STENCIL;if(m===Hd)return x=r.get("EXT_sRGB"),x!==null?x.SRGB_ALPHA_EXT:null;if(m===Fi)return b.RED;if(m===Yi)return b.RED_INTEGER;if(m===km)return b.RG;if(m===Ko)return b.RG_INTEGER;if(m===uf)return b.RGBA_INTEGER;if(m===du||m===El||m===Nd||m===pu)if(_===Xn){if(x=r.get("WEBGL_compressed_texture_s3tc_srgb"),x===null)return null;if(m===du)return x.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(m===El)return x.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(m===Nd)return x.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(m===pu)return x.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(x=r.get("WEBGL_compressed_texture_s3tc"),x===null)return null;if(m===du)return x.COMPRESSED_RGB_S3TC_DXT1_EXT;if(m===El)return x.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(m===Nd)return x.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(m===pu)return x.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(m===hf||m===Fd||m===wo||m===df){if(x=r.get("WEBGL_compressed_texture_pvrtc"),x===null)return null;if(m===hf)return x.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(m===Fd)return x.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(m===wo)return x.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(m===df)return x.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(m===Um)return x=r.get("WEBGL_compressed_texture_etc1"),x!==null?x.COMPRESSED_RGB_ETC1_WEBGL:null;if(m===Nc||m===Za){if(x=r.get("WEBGL_compressed_texture_etc"),x===null)return null;if(m===Nc)return _===Xn?x.COMPRESSED_SRGB8_ETC2:x.COMPRESSED_RGB8_ETC2;if(m===Za)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:x.COMPRESSED_RGBA8_ETC2_EAC}if(m===Yr||m===ac||m===pf||m===_h||m===zd||m===ps||m===oc||m===ff||m===Ys||m===fu||m===ma||m===sn||m===Jo||m===gn){if(x=r.get("WEBGL_compressed_texture_astc"),x===null)return null;if(m===Yr)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:x.COMPRESSED_RGBA_ASTC_4x4_KHR;if(m===ac)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:x.COMPRESSED_RGBA_ASTC_5x4_KHR;if(m===pf)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:x.COMPRESSED_RGBA_ASTC_5x5_KHR;if(m===_h)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:x.COMPRESSED_RGBA_ASTC_6x5_KHR;if(m===zd)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:x.COMPRESSED_RGBA_ASTC_6x6_KHR;if(m===ps)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:x.COMPRESSED_RGBA_ASTC_8x5_KHR;if(m===oc)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:x.COMPRESSED_RGBA_ASTC_8x6_KHR;if(m===ff)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:x.COMPRESSED_RGBA_ASTC_8x8_KHR;if(m===Ys)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:x.COMPRESSED_RGBA_ASTC_10x5_KHR;if(m===fu)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:x.COMPRESSED_RGBA_ASTC_10x6_KHR;if(m===ma)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:x.COMPRESSED_RGBA_ASTC_10x8_KHR;if(m===sn)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:x.COMPRESSED_RGBA_ASTC_10x10_KHR;if(m===Jo)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:x.COMPRESSED_RGBA_ASTC_12x10_KHR;if(m===gn)return _===Xn?x.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:x.COMPRESSED_RGBA_ASTC_12x12_KHR}if(m===Ks){if(x=r.get("EXT_texture_compression_bptc"),x===null)return null;if(m===Ks)return _===Xn?x.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:x.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(m===Eo||m===Bi||m===gi||m===lc){if(x=r.get("EXT_texture_compression_rgtc"),x===null)return null;if(m===Ks)return x.COMPRESSED_RED_RGTC1_EXT;if(m===Bi)return x.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(m===gi)return x.COMPRESSED_RED_GREEN_RGTC2_EXT;if(m===lc)return x.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return m===Uc?p?b.UNSIGNED_INT_24_8:(x=r.get("WEBGL_depth_texture"),x!==null?x.UNSIGNED_INT_24_8_WEBGL:null):b[m]!==void 0?b[m]:null}}}class lg extends xa{constructor(r=[]){super(),this.isArrayCamera=!0,this.cameras=r}}class Is extends Vi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const tE={type:"move"};class n_{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Is,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Is,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ze,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ze),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Is,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ze,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ze),this._grip}dispatchEvent(r){return this._targetRay!==null&&this._targetRay.dispatchEvent(r),this._grip!==null&&this._grip.dispatchEvent(r),this._hand!==null&&this._hand.dispatchEvent(r),this}connect(r){if(r&&r.hand){const c=this._hand;if(c)for(const p of r.hand.values())this._getHandJoint(c,p)}return this.dispatchEvent({type:"connected",data:r}),this}disconnect(r){return this.dispatchEvent({type:"disconnected",data:r}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(r,c,p){let m=null,_=null,x=null;const S=this._targetRay,B=this._grip,D=this._hand;if(r&&c.session.visibilityState!=="visible-blurred"){if(D&&r.hand){x=!0;for(const te of r.hand.values()){const K=c.getJointPose(te,p),Z=this._getHandJoint(D,te);K!==null&&(Z.matrix.fromArray(K.transform.matrix),Z.matrix.decompose(Z.position,Z.rotation,Z.scale),Z.matrixWorldNeedsUpdate=!0,Z.jointRadius=K.radius),Z.visible=K!==null}const U=D.joints["index-finger-tip"],G=D.joints["thumb-tip"],V=U.position.distanceTo(G.position),Q=.02,q=.005;D.inputState.pinching&&V>Q+q?(D.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:r.handedness,target:this})):!D.inputState.pinching&&V<=Q-q&&(D.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:r.handedness,target:this}))}else B!==null&&r.gripSpace&&(_=c.getPose(r.gripSpace,p),_!==null&&(B.matrix.fromArray(_.transform.matrix),B.matrix.decompose(B.position,B.rotation,B.scale),B.matrixWorldNeedsUpdate=!0,_.linearVelocity?(B.hasLinearVelocity=!0,B.linearVelocity.copy(_.linearVelocity)):B.hasLinearVelocity=!1,_.angularVelocity?(B.hasAngularVelocity=!0,B.angularVelocity.copy(_.angularVelocity)):B.hasAngularVelocity=!1));S!==null&&(m=c.getPose(r.targetRaySpace,p),m===null&&_!==null&&(m=_),m!==null&&(S.matrix.fromArray(m.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.matrixWorldNeedsUpdate=!0,m.linearVelocity?(S.hasLinearVelocity=!0,S.linearVelocity.copy(m.linearVelocity)):S.hasLinearVelocity=!1,m.angularVelocity?(S.hasAngularVelocity=!0,S.angularVelocity.copy(m.angularVelocity)):S.hasAngularVelocity=!1,this.dispatchEvent(tE)))}return S!==null&&(S.visible=m!==null),B!==null&&(B.visible=_!==null),D!==null&&(D.visible=x!==null),this}_getHandJoint(r,c){if(r.joints[c.jointName]===void 0){const p=new Is;p.matrixAutoUpdate=!1,p.visible=!1,r.joints[c.jointName]=p,r.add(p)}return r.joints[c.jointName]}}class Fu extends pr{constructor(r,c,p,m,_,x,S,B,D,U){if((U=U!==void 0?U:xo)!==xo&&U!==ka)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");p===void 0&&U===xo&&(p=xs),p===void 0&&U===ka&&(p=Uc),super(null,m,_,x,S,B,U,p,D),this.isDepthTexture=!0,this.image={width:r,height:c},this.magFilter=S!==void 0?S:lr,this.minFilter=B!==void 0?B:lr,this.flipY=!1,this.generateMipmaps=!1}}class ia extends tl{constructor(r,c){super();const p=this;let m=null,_=1,x=null,S="local-floor",B=1,D=null,U=null,G=null,V=null,Q=null,q=null;const te=c.getContextAttributes();let K=null,Z=null;const ae=[],ce=[],Te=new Set,Ce=new Map,Ie=new xa;Ie.layers.enable(1),Ie.viewport=new Ji;const Ke=new xa;Ke.layers.enable(2),Ke.viewport=new Ji;const ct=[Ie,Ke],Je=new lg;Je.layers.enable(1),Je.layers.enable(2);let yt=null,Ze=null;function Pt(It){const Qt=ce.indexOf(It.inputSource);if(Qt===-1)return;const un=ae[Qt];un!==void 0&&(un.update(It.inputSource,It.frame,D||x),un.dispatchEvent({type:It.type,data:It.inputSource}))}function kt(){m.removeEventListener("select",Pt),m.removeEventListener("selectstart",Pt),m.removeEventListener("selectend",Pt),m.removeEventListener("squeeze",Pt),m.removeEventListener("squeezestart",Pt),m.removeEventListener("squeezeend",Pt),m.removeEventListener("end",kt),m.removeEventListener("inputsourceschange",en);for(let It=0;It<ae.length;It++){const Qt=ce[It];Qt!==null&&(ce[It]=null,ae[It].disconnect(Qt))}yt=null,Ze=null,r.setRenderTarget(K),Q=null,V=null,G=null,m=null,Z=null,pn.stop(),p.isPresenting=!1,p.dispatchEvent({type:"sessionend"})}function en(It){for(let Qt=0;Qt<It.removed.length;Qt++){const un=It.removed[Qt],Kt=ce.indexOf(un);Kt>=0&&(ce[Kt]=null,ae[Kt].disconnect(un))}for(let Qt=0;Qt<It.added.length;Qt++){const un=It.added[Qt];let Kt=ce.indexOf(un);if(Kt===-1){for(let ni=0;ni<ae.length;ni++){if(ni>=ce.length){ce.push(un),Kt=ni;break}if(ce[ni]===null){ce[ni]=un,Kt=ni;break}}if(Kt===-1)break}const bn=ae[Kt];bn&&bn.connect(un)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(It){let Qt=ae[It];return Qt===void 0&&(Qt=new n_,ae[It]=Qt),Qt.getTargetRaySpace()},this.getControllerGrip=function(It){let Qt=ae[It];return Qt===void 0&&(Qt=new n_,ae[It]=Qt),Qt.getGripSpace()},this.getHand=function(It){let Qt=ae[It];return Qt===void 0&&(Qt=new n_,ae[It]=Qt),Qt.getHandSpace()},this.setFramebufferScaleFactor=function(It){_=It,p.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(It){S=It,p.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return D||x},this.setReferenceSpace=function(It){D=It},this.getBaseLayer=function(){return V!==null?V:Q},this.getBinding=function(){return G},this.getFrame=function(){return q},this.getSession=function(){return m},this.setSession=async function(It){if(m=It,m!==null){if(K=r.getRenderTarget(),m.addEventListener("select",Pt),m.addEventListener("selectstart",Pt),m.addEventListener("selectend",Pt),m.addEventListener("squeeze",Pt),m.addEventListener("squeezestart",Pt),m.addEventListener("squeezeend",Pt),m.addEventListener("end",kt),m.addEventListener("inputsourceschange",en),te.xrCompatible!==!0&&await c.makeXRCompatible(),m.renderState.layers===void 0||r.capabilities.isWebGL2===!1){const Qt={antialias:m.renderState.layers!==void 0||te.antialias,alpha:!0,depth:te.depth,stencil:te.stencil,framebufferScaleFactor:_};Q=new XRWebGLLayer(m,c,Qt),m.updateRenderState({baseLayer:Q}),Z=new ms(Q.framebufferWidth,Q.framebufferHeight,{format:Ls,type:xl,colorSpace:r.outputColorSpace,stencilBuffer:te.stencil})}else{let Qt=null,un=null,Kt=null;te.depth&&(Kt=te.stencil?c.DEPTH24_STENCIL8:c.DEPTH_COMPONENT24,Qt=te.stencil?ka:xo,un=te.stencil?Uc:xs);const bn={colorFormat:c.RGBA8,depthFormat:Kt,scaleFactor:_};G=new XRWebGLBinding(m,c),V=G.createProjectionLayer(bn),m.updateRenderState({layers:[V]}),Z=new ms(V.textureWidth,V.textureHeight,{format:Ls,type:xl,depthTexture:new Fu(V.textureWidth,V.textureHeight,un,void 0,void 0,void 0,void 0,void 0,void 0,Qt),stencilBuffer:te.stencil,colorSpace:r.outputColorSpace,samples:te.antialias?4:0}),r.properties.get(Z).__ignoreDepthValues=V.ignoreDepthValues}Z.isXRRenderTarget=!0,this.setFoveation(B),D=null,x=await m.requestReferenceSpace(S),pn.setContext(m),pn.start(),p.isPresenting=!0,p.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(m!==null)return m.environmentBlendMode};const xn=new ze,tn=new ze;function Wt(It,Qt){Qt===null?It.matrixWorld.copy(It.matrix):It.matrixWorld.multiplyMatrices(Qt.matrixWorld,It.matrix),It.matrixWorldInverse.copy(It.matrixWorld).invert()}this.updateCamera=function(It){if(m===null)return;Je.near=Ke.near=Ie.near=It.near,Je.far=Ke.far=Ie.far=It.far,yt===Je.near&&Ze===Je.far||(m.updateRenderState({depthNear:Je.near,depthFar:Je.far}),yt=Je.near,Ze=Je.far);const Qt=It.parent,un=Je.cameras;Wt(Je,Qt);for(let Kt=0;Kt<un.length;Kt++)Wt(un[Kt],Qt);un.length===2?function(Kt,bn,ni){xn.setFromMatrixPosition(bn.matrixWorld),tn.setFromMatrixPosition(ni.matrixWorld);const Xe=xn.distanceTo(tn),Le=bn.projectionMatrix.elements,_t=ni.projectionMatrix.elements,rt=Le[14]/(Le[10]-1),Qe=Le[14]/(Le[10]+1),lt=(Le[9]+1)/Le[5],Se=(Le[9]-1)/Le[5],$e=(Le[8]-1)/Le[0],it=(_t[8]+1)/_t[0],Ot=rt*$e,Ut=rt*it,Vt=Xe/(-$e+it),mn=Vt*-$e;bn.matrixWorld.decompose(Kt.position,Kt.quaternion,Kt.scale),Kt.translateX(mn),Kt.translateZ(Vt),Kt.matrixWorld.compose(Kt.position,Kt.quaternion,Kt.scale),Kt.matrixWorldInverse.copy(Kt.matrixWorld).invert();const In=rt+Vt,Qn=Qe+Vt,Mn=Ot-mn,Yn=Ut+(Xe-mn),Kn=lt*Qe/Qn*In,Gn=Se*Qe/Qn*In;Kt.projectionMatrix.makePerspective(Mn,Yn,Kn,Gn,In,Qn),Kt.projectionMatrixInverse.copy(Kt.projectionMatrix).invert()}(Je,Ie,Ke):Je.projectionMatrix.copy(Ie.projectionMatrix),function(Kt,bn,ni){ni===null?Kt.matrix.copy(bn.matrixWorld):(Kt.matrix.copy(ni.matrixWorld),Kt.matrix.invert(),Kt.matrix.multiply(bn.matrixWorld)),Kt.matrix.decompose(Kt.position,Kt.quaternion,Kt.scale),Kt.updateMatrixWorld(!0);const Xe=Kt.children;for(let Le=0,_t=Xe.length;Le<_t;Le++)Xe[Le].updateMatrixWorld(!0);Kt.projectionMatrix.copy(bn.projectionMatrix),Kt.projectionMatrixInverse.copy(bn.projectionMatrixInverse),Kt.isPerspectiveCamera&&(Kt.fov=2*Io*Math.atan(1/Kt.projectionMatrix.elements[5]),Kt.zoom=1)}(It,Je,Qt)},this.getCamera=function(){return Je},this.getFoveation=function(){if(V!==null||Q!==null)return B},this.setFoveation=function(It){B=It,V!==null&&(V.fixedFoveation=It),Q!==null&&Q.fixedFoveation!==void 0&&(Q.fixedFoveation=It)},this.getPlanes=function(){return Te};let dn=null;this.onPreAnimationFrameCallback=null;const pn=new H0;pn.setAnimationLoop(function(It,Qt){if(p.onPreAnimationFrameCallback&&p.onPreAnimationFrameCallback(It,Qt),U=Qt.getViewerPose(D||x),q=Qt,U!==null){const un=U.views;Q!==null&&(r.setRenderTargetFramebuffer(Z,Q.framebuffer),r.setRenderTarget(Z));let Kt=!1;un.length!==Je.cameras.length&&(Je.cameras.length=0,Kt=!0);for(let bn=0;bn<un.length;bn++){const ni=un[bn];let Xe=null;if(Q!==null)Xe=Q.getViewport(ni);else{const _t=G.getViewSubImage(V,ni);Xe=_t.viewport,bn===0&&(r.setRenderTargetTextures(Z,_t.colorTexture,V.ignoreDepthValues?void 0:_t.depthStencilTexture),r.setRenderTarget(Z))}let Le=ct[bn];Le===void 0&&(Le=new xa,Le.layers.enable(bn),Le.viewport=new Ji,ct[bn]=Le),Le.matrix.fromArray(ni.transform.matrix),Le.matrix.decompose(Le.position,Le.quaternion,Le.scale),Le.projectionMatrix.fromArray(ni.projectionMatrix),Le.projectionMatrixInverse.copy(Le.projectionMatrix).invert(),Le.viewport.set(Xe.x,Xe.y,Xe.width,Xe.height),bn===0&&(Je.matrix.copy(Le.matrix),Je.matrix.decompose(Je.position,Je.quaternion,Je.scale)),Kt===!0&&Je.cameras.push(Le)}}for(let un=0;un<ae.length;un++){const Kt=ce[un],bn=ae[un];Kt!==null&&bn!==void 0&&bn.update(Kt,Qt,D||x)}if(dn&&dn(It,Qt),Qt.detectedPlanes){p.dispatchEvent({type:"planesdetected",data:Qt.detectedPlanes});let un=null;for(const Kt of Te)Qt.detectedPlanes.has(Kt)||(un===null&&(un=[]),un.push(Kt));if(un!==null)for(const Kt of un)Te.delete(Kt),Ce.delete(Kt),p.dispatchEvent({type:"planeremoved",data:Kt});for(const Kt of Qt.detectedPlanes)if(Te.has(Kt)){const bn=Ce.get(Kt);Kt.lastChangedTime>bn&&(Ce.set(Kt,Kt.lastChangedTime),p.dispatchEvent({type:"planechanged",data:Kt}))}else Te.add(Kt),Ce.set(Kt,Qt.lastChangedTime),p.dispatchEvent({type:"planeadded",data:Kt})}q=null}),this.setAnimationLoop=function(It){dn=It},this.dispose=function(){}}}function hr(b,r){function c(m,_){m.matrixAutoUpdate===!0&&m.updateMatrix(),_.value.copy(m.matrix)}function p(m,_){m.opacity.value=_.opacity,_.color&&m.diffuse.value.copy(_.color),_.emissive&&m.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(m.map.value=_.map,c(_.map,m.mapTransform)),_.alphaMap&&(m.alphaMap.value=_.alphaMap,c(_.alphaMap,m.alphaMapTransform)),_.bumpMap&&(m.bumpMap.value=_.bumpMap,c(_.bumpMap,m.bumpMapTransform),m.bumpScale.value=_.bumpScale,_.side===ue&&(m.bumpScale.value*=-1)),_.normalMap&&(m.normalMap.value=_.normalMap,c(_.normalMap,m.normalMapTransform),m.normalScale.value.copy(_.normalScale),_.side===ue&&m.normalScale.value.negate()),_.displacementMap&&(m.displacementMap.value=_.displacementMap,c(_.displacementMap,m.displacementMapTransform),m.displacementScale.value=_.displacementScale,m.displacementBias.value=_.displacementBias),_.emissiveMap&&(m.emissiveMap.value=_.emissiveMap,c(_.emissiveMap,m.emissiveMapTransform)),_.specularMap&&(m.specularMap.value=_.specularMap,c(_.specularMap,m.specularMapTransform)),_.alphaTest>0&&(m.alphaTest.value=_.alphaTest);const x=r.get(_).envMap;if(x){m.envMap.value=x;const S=r.get(_).environment||x;m.envMapRotation.value=S?S.rotation:0,m.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=_.reflectivity,m.ior.value=_.ior,m.refractionRatio.value=_.refractionRatio}if(_.lightMap){m.lightMap.value=_.lightMap;const S=b.useLegacyLights===!0?Math.PI:1;m.lightMapIntensity.value=_.lightMapIntensity*S,c(_.lightMap,m.lightMapTransform)}_.aoMap&&(m.aoMap.value=_.aoMap,m.aoMapIntensity.value=_.aoMapIntensity,c(_.aoMap,m.aoMapTransform))}return{refreshTransformUniform:c,refreshFogUniforms:function(m,_){_.color.getRGB(m.fogColor.value,Ym(b)),_.isFog?(m.fogNear.value=_.near,m.fogFar.value=_.far):_.isFogExp2&&(m.fogDensity.value=_.density)},refreshMaterialUniforms:function(m,_,x,S,B){_.isMeshBasicMaterial||_.isMeshLambertMaterial?p(m,_):_.isMeshToonMaterial?(p(m,_),function(D,U){U.gradientMap&&(D.gradientMap.value=U.gradientMap)}(m,_)):_.isMeshPhongMaterial?(p(m,_),function(D,U){D.specular.value.copy(U.specular),D.shininess.value=Math.max(U.shininess,1e-4)}(m,_)):_.isMeshStandardMaterial?(p(m,_),function(D,U){D.metalness.value=U.metalness,U.metalnessMap&&(D.metalnessMap.value=U.metalnessMap,c(U.metalnessMap,D.metalnessMapTransform)),D.roughness.value=U.roughness,U.roughnessMap&&(D.roughnessMap.value=U.roughnessMap,c(U.roughnessMap,D.roughnessMapTransform)),r.get(U).envMap&&(D.envMapIntensity.value=U.envMapIntensity)}(m,_),_.isMeshPhysicalMaterial&&function(D,U,G){D.ior.value=U.ior,U.sheen>0&&(D.sheenColor.value.copy(U.sheenColor).multiplyScalar(U.sheen),D.sheenRoughness.value=U.sheenRoughness,U.sheenColorMap&&(D.sheenColorMap.value=U.sheenColorMap,c(U.sheenColorMap,D.sheenColorMapTransform)),U.sheenRoughnessMap&&(D.sheenRoughnessMap.value=U.sheenRoughnessMap,c(U.sheenRoughnessMap,D.sheenRoughnessMapTransform))),U.clearcoat>0&&(D.clearcoat.value=U.clearcoat,D.clearcoatRoughness.value=U.clearcoatRoughness,U.clearcoatMap&&(D.clearcoatMap.value=U.clearcoatMap,c(U.clearcoatMap,D.clearcoatMapTransform)),U.clearcoatRoughnessMap&&(D.clearcoatRoughnessMap.value=U.clearcoatRoughnessMap,c(U.clearcoatRoughnessMap,D.clearcoatRoughnessMapTransform)),U.clearcoatNormalMap&&(D.clearcoatNormalMap.value=U.clearcoatNormalMap,c(U.clearcoatNormalMap,D.clearcoatNormalMapTransform),D.clearcoatNormalScale.value.copy(U.clearcoatNormalScale),U.side===ue&&D.clearcoatNormalScale.value.negate())),U.iridescence>0&&(D.iridescence.value=U.iridescence,D.iridescenceIOR.value=U.iridescenceIOR,D.iridescenceThicknessMinimum.value=U.iridescenceThicknessRange[0],D.iridescenceThicknessMaximum.value=U.iridescenceThicknessRange[1],U.iridescenceMap&&(D.iridescenceMap.value=U.iridescenceMap,c(U.iridescenceMap,D.iridescenceMapTransform)),U.iridescenceThicknessMap&&(D.iridescenceThicknessMap.value=U.iridescenceThicknessMap,c(U.iridescenceThicknessMap,D.iridescenceThicknessMapTransform))),U.transmission>0&&(D.transmission.value=U.transmission,D.transmissionSamplerMap.value=G.texture,D.transmissionSamplerSize.value.set(G.width,G.height),U.transmissionMap&&(D.transmissionMap.value=U.transmissionMap,c(U.transmissionMap,D.transmissionMapTransform)),D.thickness.value=U.thickness,U.thicknessMap&&(D.thicknessMap.value=U.thicknessMap,c(U.thicknessMap,D.thicknessMapTransform)),D.attenuationDistance.value=U.attenuationDistance,D.attenuationColor.value.copy(U.attenuationColor)),D.specularIntensity.value=U.specularIntensity,D.specularColor.value.copy(U.specularColor),U.specularColorMap&&(D.specularColorMap.value=U.specularColorMap,c(U.specularColorMap,D.specularColorMapTransform)),U.specularIntensityMap&&(D.specularIntensityMap.value=U.specularIntensityMap,c(U.specularIntensityMap,D.specularIntensityMapTransform))}(m,_,B)):_.isMeshMatcapMaterial?(p(m,_),function(D,U){U.matcap&&(D.matcap.value=U.matcap)}(m,_)):_.isMeshDepthMaterial?p(m,_):_.isMeshDistanceMaterial?(p(m,_),function(D,U){const G=r.get(U).light;D.referencePosition.value.setFromMatrixPosition(G.matrixWorld),D.nearDistance.value=G.shadow.camera.near,D.farDistance.value=G.shadow.camera.far}(m,_)):_.isMeshNormalMaterial?p(m,_):_.isLineBasicMaterial?(function(D,U){D.diffuse.value.copy(U.color),D.opacity.value=U.opacity,U.map&&(D.map.value=U.map,c(U.map,D.mapTransform))}(m,_),_.isLineDashedMaterial&&function(D,U){D.dashSize.value=U.dashSize,D.totalSize.value=U.dashSize+U.gapSize,D.scale.value=U.scale}(m,_)):_.isPointsMaterial?function(D,U,G,V){D.diffuse.value.copy(U.color),D.opacity.value=U.opacity,D.size.value=U.size*G,D.scale.value=.5*V,U.map&&(D.map.value=U.map,c(U.map,D.uvTransform)),U.alphaMap&&(D.alphaMap.value=U.alphaMap),U.alphaTest>0&&(D.alphaTest.value=U.alphaTest)}(m,_,x,S):_.isSpriteMaterial?function(D,U){D.diffuse.value.copy(U.color),D.opacity.value=U.opacity,D.rotation.value=U.rotation,U.map&&(D.map.value=U.map,c(U.map,D.mapTransform)),U.alphaMap&&(D.alphaMap.value=U.alphaMap),U.alphaTest>0&&(D.alphaTest.value=U.alphaTest)}(m,_):_.isShadowMaterial?(m.color.value.copy(_.color),m.opacity.value=_.opacity):_.isShaderMaterial&&(_.transmission!==void 0&&(m.transmission&&(m.transmission.value=_.transmission),m.transmissionSamplerMap&&B&&(m.transmissionSamplerMap.value=B?B.texture:null),m.transmissionSamplerSize&&B&&m.transmissionSamplerSize.value.set(B.width,B.height)),_.uniformsNeedUpdate=!1)}}}function nE(b,r,c,p){let m={},_={},x=[];const S=c.isWebGL2?b.getParameter(b.MAX_UNIFORM_BUFFER_BINDINGS):0;function B(G,V,Q){const q=G.value;if(Q[V]===void 0){if(typeof q=="number")Q[V]=q;else{const te=Array.isArray(q)?q:[q],K=[];for(let Z=0;Z<te.length;Z++)K.push(te[Z].clone());Q[V]=K}return!0}if(typeof q=="number"){if(Q[V]!==q)return Q[V]=q,!0}else{const te=Array.isArray(Q[V])?Q[V]:[Q[V]],K=Array.isArray(q)?q:[q];for(let Z=0;Z<te.length;Z++){const ae=te[Z];if(ae.equals(K[Z])===!1)return ae.copy(K[Z]),!0}}return!1}function D(G){const V={boundary:0,storage:0};return typeof G=="number"?(V.boundary=4,V.storage=4):G.isVector2?(V.boundary=8,V.storage=8):G.isVector3||G.isColor?(V.boundary=16,V.storage=12):G.isVector4?(V.boundary=16,V.storage=16):G.isMatrix3?(V.boundary=48,V.storage=48):G.isMatrix4?(V.boundary=64,V.storage=64):G.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",G),V}function U(G){const V=G.target;V.removeEventListener("dispose",U);const Q=x.indexOf(V.__bindingPointIndex);x.splice(Q,1),b.deleteBuffer(m[V.id]),delete m[V.id],delete _[V.id]}return{bind:function(G,V){const Q=V.program;p.uniformBlockBinding(G,Q)},update:function(G,V){let Q=m[G.id];Q===void 0&&(function(K){const Z=K.uniforms;let ae=0,ce=0;for(let Te=0,Ce=Z.length;Te<Ce;Te++){const Ie=Z[Te],Ke={boundary:0,storage:0},ct=Array.isArray(Ie.value)?Ie.value:[Ie.value];for(let Je=0,yt=ct.length;Je<yt;Je++){const Ze=D(ct[Je]);Ke.boundary+=Ze.boundary,Ke.storage+=Ze.storage}Ie.__data=new Float32Array(Ke.storage/Float32Array.BYTES_PER_ELEMENT),Ie.__offset=ae,Te>0&&(ce=ae%16,ce!==0&&16-ce-Ke.boundary<0&&(ae+=16-ce,Ie.__offset=ae)),ae+=Ke.storage}ce=ae%16,ce>0&&(ae+=16-ce),K.__size=ae,K.__cache={}}(G),Q=function(K){const Z=function(){for(let Ce=0;Ce<S;Ce++)if(x.indexOf(Ce)===-1)return x.push(Ce),Ce;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();K.__bindingPointIndex=Z;const ae=b.createBuffer(),ce=K.__size,Te=K.usage;return b.bindBuffer(b.UNIFORM_BUFFER,ae),b.bufferData(b.UNIFORM_BUFFER,ce,Te),b.bindBuffer(b.UNIFORM_BUFFER,null),b.bindBufferBase(b.UNIFORM_BUFFER,Z,ae),ae}(G),m[G.id]=Q,G.addEventListener("dispose",U));const q=V.program;p.updateUBOMapping(G,q);const te=r.render.frame;_[G.id]!==te&&(function(K){const Z=m[K.id],ae=K.uniforms,ce=K.__cache;b.bindBuffer(b.UNIFORM_BUFFER,Z);for(let Te=0,Ce=ae.length;Te<Ce;Te++){const Ie=ae[Te];if(B(Ie,Te,ce)===!0){const Ke=Ie.__offset,ct=Array.isArray(Ie.value)?Ie.value:[Ie.value];let Je=0;for(let yt=0;yt<ct.length;yt++){const Ze=ct[yt],Pt=D(Ze);typeof Ze=="number"?(Ie.__data[0]=Ze,b.bufferSubData(b.UNIFORM_BUFFER,Ke+Je,Ie.__data)):Ze.isMatrix3?(Ie.__data[0]=Ze.elements[0],Ie.__data[1]=Ze.elements[1],Ie.__data[2]=Ze.elements[2],Ie.__data[3]=Ze.elements[0],Ie.__data[4]=Ze.elements[3],Ie.__data[5]=Ze.elements[4],Ie.__data[6]=Ze.elements[5],Ie.__data[7]=Ze.elements[0],Ie.__data[8]=Ze.elements[6],Ie.__data[9]=Ze.elements[7],Ie.__data[10]=Ze.elements[8],Ie.__data[11]=Ze.elements[0]):(Ze.toArray(Ie.__data,Je),Je+=Pt.storage/Float32Array.BYTES_PER_ELEMENT)}b.bufferSubData(b.UNIFORM_BUFFER,Ke,Ie.__data)}}b.bindBuffer(b.UNIFORM_BUFFER,null)}(G),_[G.id]=te)},dispose:function(){for(const G in m)b.deleteBuffer(m[G]);x=[],m={},_={}}}}function iE(){const b=Mh("canvas");return b.style.display="block",b}class Ff{constructor(r={}){const{canvas:c=iE(),context:p=null,depth:m=!0,stencil:_=!0,alpha:x=!1,antialias:S=!1,premultipliedAlpha:B=!0,preserveDrawingBuffer:D=!1,powerPreference:U="default",failIfMajorPerformanceCaveat:G=!1}=r;let V;this.isWebGLRenderer=!0,V=p!==null?p.getContextAttributes().alpha:x;let Q=null,q=null;const te=[],K=[];this.domElement=c,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Xn,this.useLegacyLights=!0,this.toneMapping=Ni,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const Z=this;let ae=!1,ce=0,Te=0,Ce=null,Ie=-1,Ke=null;const ct=new Ji,Je=new Ji;let yt=null,Ze=c.width,Pt=c.height,kt=1,en=null,xn=null;const tn=new Ji(0,0,Ze,Pt),Wt=new Ji(0,0,Ze,Pt);let dn=!1;const pn=new Jm;let It=!1,Qt=!1,un=null;const Kt=new _i,bn=new ze,ni={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Xe(){return Ce===null?kt:1}let Le,_t,rt,Qe,lt,Se,$e,it,Ot,Ut,Vt,mn,In,Qn,Mn,Yn,Kn,Gn,ki,oa,wi,Qi,Wi,eh,Rt=p;function Dp(We,Lt){for(let Ht=0;Ht<We.length;Ht++){const Gt=We[Ht],nn=c.getContext(Gt,Lt);if(nn!==null)return nn}return null}try{const We={alpha:!0,depth:m,stencil:_,antialias:S,premultipliedAlpha:B,preserveDrawingBuffer:D,powerPreference:U,failIfMajorPerformanceCaveat:G};if("setAttribute"in c&&c.setAttribute("data-engine",`three.js r${O}`),c.addEventListener("webglcontextlost",la,!1),c.addEventListener("webglcontextrestored",Ma,!1),c.addEventListener("webglcontextcreationerror",Vo,!1),Rt===null){const Lt=["webgl2","webgl","experimental-webgl"];if(Z.isWebGL1Renderer===!0&&Lt.shift(),Rt=Dp(Lt,We),Rt===null)throw Dp(Lt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Rt.getShaderPrecisionFormat===void 0&&(Rt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(We){throw console.error("THREE.WebGLRenderer: "+We.message),We}function Ng(){Le=new Qv(Rt),_t=new Q0(Rt,Le,r),Le.init(_t),Qi=new t_(Rt,Le,_t),rt=new Db(Rt,Le,_t),Qe=new vc(Rt),lt=new br,Se=new Ti(Rt,Le,rt,lt,_t,Qi,Qe),$e=new G1(Z),it=new ol(Z),Ot=new ob(Rt,_t),Wi=new j1(Rt,Le,Ot,_t),Ut=new H1(Rt,Ot,Qe,Wi),Vt=new hb(Rt,Ut,Ot,Qe),ki=new Wv(Rt,_t,Se),Yn=new lb(lt),mn=new Zv(Z,$e,it,Le,_t,Wi,Yn),In=new hr(Z,lt),Qn=new $v,Mn=new e_(Le,_t),Gn=new z1(Z,$e,it,rt,Vt,V,B),Kn=new Rb(Z,Vt,_t),eh=new nE(Rt,Qe,_t,rt),oa=new V1(Rt,Le,Qe,_t),wi=new Q1(Rt,Le,Qe,_t),Qe.programs=mn.programs,Z.capabilities=_t,Z.extensions=Le,Z.properties=lt,Z.renderLists=Qn,Z.shadowMap=Kn,Z.state=rt,Z.info=Qe,Z.background=Gn,Z.cubemaps=$e,Z.cubeuvmaps=it,Z.materials=In}Ng();const Vs=new ia(Z,Rt);function la(We){We.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ae=!0,Z.onContextLost(We)}function Ma(){console.log("THREE.WebGLRenderer: Context Restored."),ae=!1;const We=Z.info?Z.info.autoReset:void 0,Lt=Kn.enabled,Ht=Kn.autoUpdate,Gt=Kn.needsUpdate,nn=Kn.type;Ng(),Z.info&&We!==void 0&&(Z.info.autoReset=We),Kn.enabled=Lt,Kn.autoUpdate=Ht,Kn.needsUpdate=Gt,Kn.type=nn,Z.onContextRestore&&Z.onContextRestore(),console.log("restored")}function Vo(We){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",We.statusMessage),Z.onContextCreationError(We)}function Wa(We){const Lt=We.target;Lt.removeEventListener("dispose",Wa),function(Ht){(function(Gt){const nn=lt.get(Gt).programs;nn!==void 0&&(nn.forEach(function(Bn){mn.releaseProgram(Bn)}),Gt.isShaderMaterial&&mn.releaseShaderCache(Gt))})(Ht),lt.remove(Ht)}(Lt)}this.xr=Vs,this.getContext=function(){return Rt},this.getContextAttributes=function(){return Rt.getContextAttributes()},this.forceContextLoss=function(){const We=Le.get("WEBGL_lose_context");We&&We.loseContext()},this.forceContextRestore=function(){const We=Le.get("WEBGL_lose_context");We&&We.restoreContext()},this.getPixelRatio=function(){return kt},this.setPixelRatio=function(We){We!==void 0&&(kt=We,this.setSize(Ze,Pt,!1))},this.getSize=function(We){return We.set(Ze,Pt)},this.setSize=function(We,Lt,Ht=!0){Vs.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Ze=We,Pt=Lt,c.width=Math.floor(We*kt),c.height=Math.floor(Lt*kt),Ht===!0&&(c.style.width=We+"px",c.style.height=Lt+"px"),this.setViewport(0,0,We,Lt))},this.getDrawingBufferSize=function(We){return We.set(Ze*kt,Pt*kt).floor()},this.setDrawingBufferSize=function(We,Lt,Ht){Ze=We,Pt=Lt,kt=Ht,c.width=Math.floor(We*Ht),c.height=Math.floor(Lt*Ht),this.setViewport(0,0,We,Lt)},this.getCurrentViewport=function(We){return We.copy(ct)},this.getViewport=function(We){return We.copy(tn)},this.setViewport=function(We,Lt,Ht,Gt){We.isVector4?tn.set(We.x,We.y,We.z,We.w):tn.set(We,Lt,Ht,Gt),rt.viewport(ct.copy(tn).multiplyScalar(kt).floor())},this.getScissor=function(We){return We.copy(Wt)},this.setScissor=function(We,Lt,Ht,Gt){We.isVector4?Wt.set(We.x,We.y,We.z,We.w):Wt.set(We,Lt,Ht,Gt),rt.scissor(Je.copy(Wt).multiplyScalar(kt).floor())},this.getScissorTest=function(){return dn},this.setScissorTest=function(We){rt.setScissorTest(dn=We)},this.setOpaqueSort=function(We){en=We},this.setTransparentSort=function(We){xn=We},this.getClearColor=function(We){return We.copy(Gn.getClearColor())},this.setClearColor=function(){Gn.setClearColor.apply(Gn,arguments)},this.getClearAlpha=function(){return Gn.getClearAlpha()},this.setClearAlpha=function(){Gn.setClearAlpha.apply(Gn,arguments)},this.clear=function(We=!0,Lt=!0,Ht=!0){let Gt=0;We&&(Gt|=Rt.COLOR_BUFFER_BIT),Lt&&(Gt|=Rt.DEPTH_BUFFER_BIT),Ht&&(Gt|=Rt.STENCIL_BUFFER_BIT),Rt.clear(Gt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){c.removeEventListener("webglcontextlost",la,!1),c.removeEventListener("webglcontextrestored",Ma,!1),c.removeEventListener("webglcontextcreationerror",Vo,!1),Qn.dispose(),Mn.dispose(),lt.dispose(),$e.dispose(),it.dispose(),Vt.dispose(),Wi.dispose(),eh.dispose(),mn.dispose(),Vs.dispose(),Vs.removeEventListener("sessionstart",Bp),Vs.removeEventListener("sessionend",cd),un&&(un.dispose(),un=null),ql.stop()},this.renderBufferDirect=function(We,Lt,Ht,Gt,nn,Bn){Lt===null&&(Lt=ni);const qi=nn.isMesh&&nn.matrixWorld.determinant()<0,si=function(fr,Go,ys,ci,cs){Go.isScene!==!0&&(Go=ni),Se.resetTextureUnits();const $y=Go.fog,Ax=ci.isMeshStandardMaterial?Go.environment:null,eA=Ce===null?Z.outputColorSpace:Ce.isXRRenderTarget===!0||Ce.texture.colorSpace&&Ce.texture.colorSpace!==Xn?Ce.texture.colorSpace:vi,Lp=(ci.isMeshStandardMaterial?it:$e).get(ci.envMap||Ax),bx=ci.vertexColors===!0&&!!ys.attributes.color&&ys.attributes.color.itemSize===4,IE=!!ci.normalMap&&!!ys.attributes.tangent,q_=!!ys.morphAttributes.position,PE=!!ys.morphAttributes.normal,xx=!!ys.morphAttributes.color,wx=ci.toneMapped?Z.toneMapping:Ni,X_=ys.morphAttributes.position||ys.morphAttributes.normal||ys.morphAttributes.color,Ex=X_!==void 0?X_.length:0,mr=lt.get(ci),Sx=q.state.lights;if(It===!0&&(Qt===!0||fr!==Ke)){const fo=fr===Ke&&ci.id===Ie;Yn.setState(ci,fr,fo)}let Ho=!1;ci.version===mr.__version?mr.needsLights&&mr.lightsStateVersion!==Sx.state.version||mr.outputColorSpace!==eA||cs.isInstancedMesh&&mr.instancing===!1?Ho=!0:cs.isInstancedMesh||mr.instancing!==!0?cs.isSkinnedMesh&&mr.skinning===!1?Ho=!0:cs.isSkinnedMesh||mr.skinning!==!0?mr.envMap!==Lp||ci.fog===!0&&mr.fog!==$y?Ho=!0:mr.numClippingPlanes===void 0||mr.numClippingPlanes===Yn.numPlanes&&mr.numIntersection===Yn.numIntersection?(mr.vertexAlphas!==bx||mr.vertexTangents!==IE||mr.morphTargets!==q_||mr.morphNormals!==PE||mr.morphColors!==xx||mr.toneMapping!==wx||_t.isWebGL2===!0&&mr.morphTargetsCount!==Ex)&&(Ho=!0):Ho=!0:Ho=!0:Ho=!0:(Ho=!0,mr.__version=ci.version);let ud=mr.currentProgram;Ho===!0&&(ud=fm(ci,Go,cs));let mm=!1,gm=!1,Y_=!1;const Ia=ud.getUniforms(),hd=mr.uniforms;if(rt.useProgram(ud.program)&&(mm=!0,gm=!0,Y_=!0),ci.id!==Ie&&(Ie=ci.id,gm=!0),mm||Ke!==fr){if(Ia.setValue(Rt,"projectionMatrix",fr.projectionMatrix),_t.logarithmicDepthBuffer&&Ia.setValue(Rt,"logDepthBufFC",2/(Math.log(fr.far+1)/Math.LN2)),Ke!==fr&&(Ke=fr,gm=!0,Y_=!0),ci.isShaderMaterial||ci.isMeshPhongMaterial||ci.isMeshToonMaterial||ci.isMeshStandardMaterial||ci.envMap){const fo=Ia.map.cameraPosition;fo!==void 0&&fo.setValue(Rt,bn.setFromMatrixPosition(fr.matrixWorld))}(ci.isMeshPhongMaterial||ci.isMeshToonMaterial||ci.isMeshLambertMaterial||ci.isMeshBasicMaterial||ci.isMeshStandardMaterial||ci.isShaderMaterial)&&Ia.setValue(Rt,"isOrthographic",fr.isOrthographicCamera===!0),(ci.isMeshPhongMaterial||ci.isMeshToonMaterial||ci.isMeshLambertMaterial||ci.isMeshBasicMaterial||ci.isMeshStandardMaterial||ci.isShaderMaterial||ci.isShadowMaterial||cs.isSkinnedMesh)&&Ia.setValue(Rt,"viewMatrix",fr.matrixWorldInverse)}if(cs.isSkinnedMesh){Ia.setOptional(Rt,cs,"bindMatrix"),Ia.setOptional(Rt,cs,"bindMatrixInverse");const fo=cs.skeleton;fo&&(_t.floatVertexTextures?(fo.boneTexture===null&&fo.computeBoneTexture(),Ia.setValue(Rt,"boneTexture",fo.boneTexture,Se),Ia.setValue(Rt,"boneTextureSize",fo.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const K_=ys.morphAttributes;var Cc,Tc;(K_.position!==void 0||K_.normal!==void 0||K_.color!==void 0&&_t.isWebGL2===!0)&&ki.update(cs,ys,ud),(gm||mr.receiveShadow!==cs.receiveShadow)&&(mr.receiveShadow=cs.receiveShadow,Ia.setValue(Rt,"receiveShadow",cs.receiveShadow)),ci.isMeshGouraudMaterial&&ci.envMap!==null&&(hd.envMap.value=Lp,hd.flipEnvMap.value=Lp.isCubeTexture&&Lp.isRenderTargetTexture===!1?-1:1),gm&&(Ia.setValue(Rt,"toneMappingExposure",Z.toneMappingExposure),mr.needsLights&&(Tc=Y_,(Cc=hd).ambientLightColor.needsUpdate=Tc,Cc.lightProbe.needsUpdate=Tc,Cc.directionalLights.needsUpdate=Tc,Cc.directionalLightShadows.needsUpdate=Tc,Cc.pointLights.needsUpdate=Tc,Cc.pointLightShadows.needsUpdate=Tc,Cc.spotLights.needsUpdate=Tc,Cc.spotLightShadows.needsUpdate=Tc,Cc.rectAreaLights.needsUpdate=Tc,Cc.hemisphereLights.needsUpdate=Tc),$y&&ci.fog===!0&&In.refreshFogUniforms(hd,$y),In.refreshMaterialUniforms(hd,ci,kt,Pt,Z.userData.transmissionRenderTarget||un),Fl.upload(Rt,mr.uniformsList,hd,Se)),ci.isShaderMaterial&&ci.uniformsNeedUpdate===!0&&(Fl.upload(Rt,mr.uniformsList,hd,Se),ci.uniformsNeedUpdate=!1),ci.isSpriteMaterial&&Ia.setValue(Rt,"center",cs.center),Ia.setValue(Rt,"modelViewMatrix",cs.modelViewMatrix),Ia.setValue(Rt,"normalMatrix",cs.normalMatrix),Ia.setValue(Rt,"modelMatrix",cs.matrixWorld);const tA=ci.extraUniformsToUpload;if(tA&&Object.entries(tA).forEach(([fo,vm])=>Ia.setValue(Rt,fo,vm.value,Se)),ci.isShaderMaterial||ci.isRawShaderMaterial){const fo=ci.uniformsGroups;for(let vm=0,Mx=fo.length;vm<Mx;vm++)if(_t.isWebGL2){const dd=fo[vm];eh.update(dd,ud),eh.bind(dd,ud)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ud}(We,Lt,Ht,Gt,nn);rt.setMaterial(Gt,qi);let Di=Ht.index,or=1;Gt.wireframe===!0&&(Di=Ut.getWireframeAttribute(Ht),or=2);const zi=Ht.drawRange,Ui=Ht.attributes.position;let Ca=zi.start*or,Ta=(zi.start+zi.count)*or;Bn!==null&&(Ca=Math.max(Ca,Bn.start*or),Ta=Math.min(Ta,(Bn.start+Bn.count)*or)),Di!==null?(Ca=Math.max(Ca,0),Ta=Math.min(Ta,Di.count)):Ui!=null&&(Ca=Math.max(Ca,0),Ta=Math.min(Ta,Ui.count));const _s=Ta-Ca;if(_s<0||_s===1/0)return;let nh;Wi.setup(nn,Gt,si,Ht,Di);let Ur=oa;if(Di!==null&&(nh=Ot.get(Di),Ur=wi,Ur.setIndex(nh)),nn.isMesh)Gt.wireframe===!0?(rt.setLineWidth(Gt.wireframeLinewidth*Xe()),Ur.setMode(Rt.LINES)):Ur.setMode(Rt.TRIANGLES);else if(nn.isLine){let fr=Gt.linewidth;fr===void 0&&(fr=1),rt.setLineWidth(fr*Xe()),nn.isLineSegments?Ur.setMode(Rt.LINES):nn.isLineLoop?Ur.setMode(Rt.LINE_LOOP):Ur.setMode(Rt.LINE_STRIP)}else nn.isPoints?Ur.setMode(Rt.POINTS):nn.isSprite&&Ur.setMode(Rt.TRIANGLES);if(nn.isInstancedMesh)Ur.renderInstances(Ca,_s,nn.count);else if(Ht.isInstancedBufferGeometry){const fr=Ht._maxInstanceCount!==void 0?Ht._maxInstanceCount:1/0,Go=Math.min(Ht.instanceCount,fr);Ur.renderInstances(Ca,_s,Go)}else Ur.render(Ca,_s)},this.compile=function(We,Lt){function Ht(Gt,nn,Bn){Gt.transparent===!0&&Gt.side===He&&Gt.forceSinglePass===!1?(Gt.side=ue,Gt.needsUpdate=!0,fm(Gt,nn,Bn),Gt.side=Pe,Gt.needsUpdate=!0,fm(Gt,nn,Bn),Gt.side=He):fm(Gt,nn,Bn)}q=Mn.get(We),q.init(),K.push(q),We.traverseVisible(function(Gt){Gt.isLight&&Gt.layers.test(Lt.layers)&&(q.pushLight(Gt),Gt.castShadow&&q.pushShadow(Gt))}),q.setupLights(Z.useLegacyLights),We.traverse(function(Gt){const nn=Gt.material;if(nn)if(Array.isArray(nn))for(let Bn=0;Bn<nn.length;Bn++)Ht(nn[Bn],We,Gt);else Ht(nn,We,Gt)}),K.pop(),q=null};let pm=null;function Bp(){ql.stop()}function cd(){ql.start()}const ql=new H0;function Jy(We,Lt,Ht,Gt){if(We.visible===!1)return;if(We.layers.test(Lt.layers)){if(We.isGroup)Ht=We.renderOrder;else if(We.isLOD)We.autoUpdate===!0&&We.update(Lt);else if(We.isLight)q.pushLight(We),We.castShadow&&q.pushShadow(We);else if(We.isSprite){if(!We.frustumCulled||pn.intersectsSprite(We)){Gt&&bn.setFromMatrixPosition(We.matrixWorld).applyMatrix4(Kt);const Bn=Vt.update(We),qi=We.material;qi.visible&&Q.push(We,Bn,qi,Ht,bn.z,null)}}else if((We.isMesh||We.isLine||We.isPoints)&&(!We.frustumCulled||pn.intersectsObject(We))){We.isSkinnedMesh&&We.skeleton.frame!==Qe.render.frame&&(We.skeleton.update(),We.skeleton.frame=Qe.render.frame);const Bn=Vt.update(We),qi=We.material;if(Gt&&(Bn.boundingSphere===null&&Bn.computeBoundingSphere(),bn.copy(Bn.boundingSphere.center).applyMatrix4(We.matrixWorld).applyMatrix4(Kt)),Array.isArray(qi)){const si=Bn.groups;for(let Di=0,or=si.length;Di<or;Di++){const zi=si[Di],Ui=qi[zi.materialIndex];Ui&&Ui.visible&&Q.push(We,Bn,Ui,Ht,bn.z,zi)}}else qi.visible&&Q.push(We,Bn,qi,Ht,bn.z,null)}}const nn=We.children;for(let Bn=0,qi=nn.length;Bn<qi;Bn++)Jy(nn[Bn],Lt,Ht,Gt)}function Q_(We,Lt,Ht,Gt){const nn=We.opaque,Bn=We.transmissive,qi=We.transparent;if(q.setupLightsView(Ht),It===!0&&Yn.setGlobalState(Z.clippingPlanes,Ht),Z.userData.transmissionRender===void 0&&Z.userData.renderTransmissionPass!==!1&&Bn.length>0&&function(si,Di,or,zi){if(console.warn("three.js internal render transmission pass should not be called"),un===null){const _s=_t.isWebGL2;un=new ms(1024,1024,{generateMipmaps:!0,type:Le.has("EXT_color_buffer_half_float")?Ja:xl,minFilter:ds,samples:_s&&S===!0?4:0})}const Ui=Z.getRenderTarget();Z.setRenderTarget(un),Z.clear();const Ca=Z.toneMapping;Z.toneMapping=Ni,th(si,or,zi),Se.updateMultisampleRenderTarget(un),Se.updateRenderTargetMipmap(un);let Ta=!1;for(let _s=0,nh=Di.length;_s<nh;_s++){const Ur=Di[_s],fr=Ur.object,Go=Ur.geometry,ys=Ur.material,ci=Ur.group;if(ys.side===He&&fr.layers.test(zi.layers)){const cs=ys.side;ys.side=ue,ys.needsUpdate=!0,Zy(fr,or,zi,Go,ys,ci),ys.side=cs,ys.needsUpdate=!0,Ta=!0}}Ta===!0&&(Se.updateMultisampleRenderTarget(un),Se.updateRenderTargetMipmap(un)),Z.setRenderTarget(Ui),Z.toneMapping=Ca}([...nn,...qi],Bn,Lt,Ht),Gt&&rt.viewport(ct.copy(Gt)),Z.userData.opaqueRender!==!1&&nn.length>0&&th(nn,Lt,Ht),Z.userData.transparentRender!==!1&&qi.length>0&&th(qi,Lt,Ht),Z.userData.transmissionRender!==!1&&Bn.length>0){un||(un=new ms(1,1));const si=(Z.userData.transmissionRenderTarget||un).texture,Di=_t.isWebGL2,or=si.generateMipmaps,zi=si.minFilter;Di&&Z.userData.blurTransmissionTarget&&Z.userData.transmissionRenderTarget&&(si.generateMipmaps=!0,si.minFilter=ds,si.needsUpdate=!0,Se.updateMultisampleRenderTarget(Z.userData.transmissionRenderTarget),Se.updateRenderTargetMipmap(Z.userData.transmissionRenderTarget)),th(Bn,Lt,Ht),Di&&Z.userData.blurTransmissionTarget&&Z.userData.transmissionRenderTarget&&(si.generateMipmaps=or,si.minFilter=zi,si.needsUpdate=!0,Se.updateMultisampleRenderTarget(Z.userData.transmissionRenderTarget),Se.updateRenderTargetMipmap(Z.userData.transmissionRenderTarget))}rt.buffers.depth.setTest(!0),rt.buffers.depth.setMask(!0),rt.buffers.color.setMask(!0),rt.setPolygonOffset(!1)}function th(We,Lt,Ht){const Gt={...Z.userData};Z.userData.opaqueRender=void 0,Z.userData.transparentRender=void 0,Z.userData.transmissionRender=void 0,Z.userData.backgroundRender=void 0;const nn=Lt.isScene===!0?Lt.overrideMaterial:null;for(let Bn=0,qi=We.length;Bn<qi;Bn++){const si=We[Bn],Di=si.object,or=si.geometry,zi=nn===null?si.material:nn,Ui=si.group;Di.layers.test(Ht.layers)&&Zy(Di,Lt,Ht,or,zi,Ui)}Object.assign(Z.userData,Gt)}function Zy(We,Lt,Ht,Gt,nn,Bn){We.onBeforeRender(Z,Lt,Ht,Gt,nn,Bn),We.modelViewMatrix.multiplyMatrices(Ht.matrixWorldInverse,We.matrixWorld),We.normalMatrix.getNormalMatrix(We.modelViewMatrix),nn.onBeforeRender(Z,Lt,Ht,Gt,We,Bn),nn.transparent===!0&&nn.side===He&&nn.forceSinglePass===!1?(nn.side=ue,nn.needsUpdate=!0,Z.renderBufferDirect(Ht,Lt,Gt,nn,We,Bn),nn.side=Pe,nn.needsUpdate=!0,Z.renderBufferDirect(Ht,Lt,Gt,nn,We,Bn),nn.side=He):Z.renderBufferDirect(Ht,Lt,Gt,nn,We,Bn),We.onAfterRender(Z,Lt,Ht,Gt,nn,Bn),nn.onAfterRender(Z,Lt,Ht,Gt,We,Bn)}function fm(We,Lt,Ht){Lt.isScene!==!0&&(Lt=ni);const Gt=lt.get(We),nn=q.state.lights,Bn=q.state.shadowsArray,qi=nn.state.version,si=mn.getParameters(We,nn.state,Bn,Lt,Ht),Di=mn.getProgramCacheKey(si);let or=Gt.programs;Gt.environment=We.isMeshStandardMaterial?Lt.environment:null,Gt.fog=Lt.fog,Gt.envMap=(We.isMeshStandardMaterial?it:$e).get(We.envMap||Gt.environment),or===void 0&&(We.addEventListener("dispose",Wa),or=new Map,Gt.programs=or);let zi=or.get(Di);if(zi!==void 0){if(Gt.currentProgram===zi&&Gt.lightsStateVersion===qi)return W_(We,si),zi}else si.uniforms=mn.getUniforms(We),We.onBuild(Ht,si,Z),We.onBeforeCompile(si,Z),zi=mn.acquireProgram(si,Di),or.set(Di,zi),Gt.uniforms=si.uniforms;const Ui=Gt.uniforms;(We.isShaderMaterial||We.isRawShaderMaterial)&&We.clipping!==!0||(Ui.clippingPlanes=Yn.uniform),W_(We,si),Gt.needsLights=function(_s){return _s.isMeshLambertMaterial||_s.isMeshToonMaterial||_s.isMeshPhongMaterial||_s.isMeshStandardMaterial||_s.isShadowMaterial||_s.isShaderMaterial&&_s.lights===!0}(We),Gt.lightsStateVersion=qi,Gt.needsLights&&(Ui.ambientLightColor.value=nn.state.ambient,Ui.lightProbe.value=nn.state.probe,Ui.directionalLights.value=nn.state.directional,Ui.directionalLightShadows.value=nn.state.directionalShadow,Ui.spotLights.value=nn.state.spot,Ui.spotLightShadows.value=nn.state.spotShadow,Ui.rectAreaLights.value=nn.state.rectArea,Ui.ltc_1.value=nn.state.rectAreaLTC1,Ui.ltc_2.value=nn.state.rectAreaLTC2,Ui.pointLights.value=nn.state.point,Ui.pointLightShadows.value=nn.state.pointShadow,Ui.hemisphereLights.value=nn.state.hemi,Ui.directionalShadowMap.value=nn.state.directionalShadowMap,Ui.directionalShadowMatrix.value=nn.state.directionalShadowMatrix,Ui.spotShadowMap.value=nn.state.spotShadowMap,Ui.spotLightMatrix.value=nn.state.spotLightMatrix,Ui.spotLightMap.value=nn.state.spotLightMap,Ui.pointShadowMap.value=nn.state.pointShadowMap,Ui.pointShadowMatrix.value=nn.state.pointShadowMatrix);const Ca=zi.getUniforms(),Ta=Fl.seqWithValue(Ca.seq,Ui);return Gt.currentProgram=zi,Gt.uniformsList=Ta,zi}function W_(We,Lt){const Ht=lt.get(We);Ht.outputColorSpace=Lt.outputColorSpace,Ht.instancing=Lt.instancing,Ht.skinning=Lt.skinning,Ht.morphTargets=Lt.morphTargets,Ht.morphNormals=Lt.morphNormals,Ht.morphColors=Lt.morphColors,Ht.morphTargetsCount=Lt.morphTargetsCount,Ht.numClippingPlanes=Lt.numClippingPlanes,Ht.numIntersection=Lt.numClipIntersection,Ht.vertexAlphas=Lt.vertexAlphas,Ht.vertexTangents=Lt.vertexTangents,Ht.toneMapping=Lt.toneMapping}ql.setAnimationLoop(function(We){pm&&pm(We)}),typeof self<"u"&&ql.setContext(self),this.setAnimationLoop=function(We){pm=We,Vs.setAnimationLoop(We),We===null?ql.stop():ql.start()},Vs.addEventListener("sessionstart",Bp),Vs.addEventListener("sessionend",cd),this.render=function(We,Lt){if(Lt===void 0||Lt.isCamera===!0){if(ae!==!0){if(We.matrixWorldAutoUpdate===!0&&We.updateMatrixWorld(),Lt.parent===null&&Lt.matrixWorldAutoUpdate===!0&&Lt.updateMatrixWorld(),Vs.enabled===!0&&Vs.isPresenting===!0&&(Vs.cameraAutoUpdate===!0&&Vs.updateCamera(Lt),Lt=Vs.getCamera()),We.isScene===!0&&We.onBeforeRender(Z,We,Lt,Ce),q=Mn.get(We,K.length),q.init(),K.push(q),Kt.multiplyMatrices(Lt.projectionMatrix,Lt.matrixWorldInverse),pn.setFromProjectionMatrix(Kt),Qt=this.localClippingEnabled,It=Yn.init(this.clippingPlanes,Qt),Q=Qn.get(We,te.length),Q.init(),te.push(Q),Jy(We,Lt,0,Z.sortObjects),Q.finish(),Z.sortObjects===!0&&Q.sort(en,xn),Z.userData.shadowMapRender!==!1){It===!0&&Yn.beginShadows();const Ht=q.state.shadowsArray;Ht.length>0&&Kn.render(Ht,We,Lt),It===!0&&Yn.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),Z.userData.backgroundRender!==!1&&Gn.render(Q,We),Z.userData.sceneRender!==!1)if(q.setupLights(Z.useLegacyLights),Lt.isArrayCamera){const Ht=Lt.cameras;for(let Gt=0,nn=Ht.length;Gt<nn;Gt++){const Bn=Ht[Gt];Q_(Q,We,Bn,Bn.viewport)}}else Q_(Q,We,Lt);Ce!==null&&(Se.updateMultisampleRenderTarget(Ce),Se.updateRenderTargetMipmap(Ce)),We.isScene===!0&&We.onAfterRender(Z,We,Lt),Wi.resetDefaultState(),Ie=-1,Ke=null,K.pop(),q=K.length>0?K[K.length-1]:null,te.pop(),Q=te.length>0?te[te.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return ce},this.getActiveMipmapLevel=function(){return Te},this.getRenderTarget=function(){return Ce},this.setRenderTargetTextures=function(We,Lt,Ht){lt.get(We.texture).__webglTexture=Lt,lt.get(We.depthTexture).__webglTexture=Ht;const Gt=lt.get(We);Gt.__hasExternalTextures=!0,Gt.__hasExternalTextures&&(Gt.__autoAllocateDepthBuffer=Ht===void 0,Gt.__autoAllocateDepthBuffer||Le.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Gt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(We,Lt){const Ht=lt.get(We);Ht.__webglFramebuffer=Lt,Ht.__useDefaultFramebuffer=Lt===void 0},this.setRenderTarget=function(We,Lt=0,Ht=0){Ce=We,ce=Lt,Te=Ht;let Gt=!0,nn=null,Bn=!1,qi=!1;if(We){const si=lt.get(We);si.__useDefaultFramebuffer!==void 0?(rt.bindFramebuffer(Rt.FRAMEBUFFER,null),Gt=!1):si.__webglFramebuffer===void 0?Se.setupRenderTarget(We):si.__hasExternalTextures&&Se.rebindTextures(We,lt.get(We.texture).__webglTexture,lt.get(We.depthTexture).__webglTexture);const Di=We.texture;(Di.isData3DTexture||Di.isDataArrayTexture||Di.isCompressedArrayTexture)&&(qi=!0);const or=lt.get(We).__webglFramebuffer;We.isWebGLCubeRenderTarget?(nn=or[Lt],Bn=!0):nn=_t.isWebGL2&&We.samples>0&&Se.useMultisampledRTT(We)===!1?lt.get(We).__webglMultisampledFramebuffer:or,ct.copy(We.viewport),Je.copy(We.scissor),yt=We.scissorTest}else ct.copy(tn).multiplyScalar(kt).floor(),Je.copy(Wt).multiplyScalar(kt).floor(),yt=dn;if(rt.bindFramebuffer(Rt.FRAMEBUFFER,nn)&&_t.drawBuffers&&Gt&&rt.drawBuffers(We,nn),rt.viewport(ct),rt.scissor(Je),rt.setScissorTest(yt),Bn){const si=lt.get(We.texture);Rt.framebufferTexture2D(Rt.FRAMEBUFFER,Rt.COLOR_ATTACHMENT0,Rt.TEXTURE_CUBE_MAP_POSITIVE_X+Lt,si.__webglTexture,Ht)}else if(qi){const si=lt.get(We.texture),Di=Lt||0;Rt.framebufferTextureLayer(Rt.FRAMEBUFFER,Rt.COLOR_ATTACHMENT0,si.__webglTexture,Ht||0,Di)}Ie=-1},this.readRenderTargetPixels=function(We,Lt,Ht,Gt,nn,Bn,qi){if(!We||!We.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let si=lt.get(We).__webglFramebuffer;if(We.isWebGLCubeRenderTarget&&qi!==void 0&&(si=si[qi]),si){rt.bindFramebuffer(Rt.FRAMEBUFFER,si);try{const Di=We.texture,or=Di.format,zi=Di.type;if(or!==Ls&&Qi.convert(or)!==Rt.getParameter(Rt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Ui=zi===Ja&&(Le.has("EXT_color_buffer_half_float")||_t.isWebGL2&&Le.has("EXT_color_buffer_float"));if(!(zi===xl||Qi.convert(zi)===Rt.getParameter(Rt.IMPLEMENTATION_COLOR_READ_TYPE)||zi===wl&&(_t.isWebGL2||Le.has("OES_texture_float")||Le.has("WEBGL_color_buffer_float"))||Ui))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Lt>=0&&Lt<=We.width-Gt&&Ht>=0&&Ht<=We.height-nn&&Rt.readPixels(Lt,Ht,Gt,nn,Qi.convert(or),Qi.convert(zi),Bn)}finally{const Di=Ce?lt.get(Ce).__webglFramebuffer:null;rt.bindFramebuffer(Rt.FRAMEBUFFER,Di)}}},this.copyFramebufferToTexture=function(We,Lt,Ht=0){const Gt=Math.pow(2,-Ht),nn=Math.floor(Lt.image.width*Gt),Bn=Math.floor(Lt.image.height*Gt);Se.setTexture2D(Lt,0),Rt.copyTexSubImage2D(Rt.TEXTURE_2D,Ht,0,0,We.x,We.y,nn,Bn),rt.unbindTexture()},this.copyTextureToTexture=function(We,Lt,Ht,Gt=0){const nn=Lt.image.width,Bn=Lt.image.height,qi=Qi.convert(Ht.format),si=Qi.convert(Ht.type);Se.setTexture2D(Ht,0),Rt.pixelStorei(Rt.UNPACK_FLIP_Y_WEBGL,Ht.flipY),Rt.pixelStorei(Rt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ht.premultiplyAlpha),Rt.pixelStorei(Rt.UNPACK_ALIGNMENT,Ht.unpackAlignment),Lt.isDataTexture?Rt.texSubImage2D(Rt.TEXTURE_2D,Gt,We.x,We.y,nn,Bn,qi,si,Lt.image.data):Lt.isCompressedTexture?Rt.compressedTexSubImage2D(Rt.TEXTURE_2D,Gt,We.x,We.y,Lt.mipmaps[0].width,Lt.mipmaps[0].height,qi,Lt.mipmaps[0].data):Rt.texSubImage2D(Rt.TEXTURE_2D,Gt,We.x,We.y,qi,si,Lt.image),Gt===0&&Ht.generateMipmaps&&Rt.generateMipmap(Rt.TEXTURE_2D),rt.unbindTexture()},this.copyTextureToTexture3D=function(We,Lt,Ht,Gt,nn=0){if(Z.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Bn=We.max.x-We.min.x+1,qi=We.max.y-We.min.y+1,si=We.max.z-We.min.z+1,Di=Qi.convert(Gt.format),or=Qi.convert(Gt.type);let zi;if(Gt.isData3DTexture)Se.setTexture3D(Gt,0),zi=Rt.TEXTURE_3D;else{if(!Gt.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Se.setTexture2DArray(Gt,0),zi=Rt.TEXTURE_2D_ARRAY}Rt.pixelStorei(Rt.UNPACK_FLIP_Y_WEBGL,Gt.flipY),Rt.pixelStorei(Rt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Gt.premultiplyAlpha),Rt.pixelStorei(Rt.UNPACK_ALIGNMENT,Gt.unpackAlignment);const Ui=Rt.getParameter(Rt.UNPACK_ROW_LENGTH),Ca=Rt.getParameter(Rt.UNPACK_IMAGE_HEIGHT),Ta=Rt.getParameter(Rt.UNPACK_SKIP_PIXELS),_s=Rt.getParameter(Rt.UNPACK_SKIP_ROWS),nh=Rt.getParameter(Rt.UNPACK_SKIP_IMAGES),Ur=Ht.isCompressedTexture?Ht.mipmaps[0]:Ht.image;Rt.pixelStorei(Rt.UNPACK_ROW_LENGTH,Ur.width),Rt.pixelStorei(Rt.UNPACK_IMAGE_HEIGHT,Ur.height),Rt.pixelStorei(Rt.UNPACK_SKIP_PIXELS,We.min.x),Rt.pixelStorei(Rt.UNPACK_SKIP_ROWS,We.min.y),Rt.pixelStorei(Rt.UNPACK_SKIP_IMAGES,We.min.z),Ht.isDataTexture||Ht.isData3DTexture?Rt.texSubImage3D(zi,nn,Lt.x,Lt.y,Lt.z,Bn,qi,si,Di,or,Ur.data):Ht.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Rt.compressedTexSubImage3D(zi,nn,Lt.x,Lt.y,Lt.z,Bn,qi,si,Di,Ur.data)):Rt.texSubImage3D(zi,nn,Lt.x,Lt.y,Lt.z,Bn,qi,si,Di,or,Ur),Rt.pixelStorei(Rt.UNPACK_ROW_LENGTH,Ui),Rt.pixelStorei(Rt.UNPACK_IMAGE_HEIGHT,Ca),Rt.pixelStorei(Rt.UNPACK_SKIP_PIXELS,Ta),Rt.pixelStorei(Rt.UNPACK_SKIP_ROWS,_s),Rt.pixelStorei(Rt.UNPACK_SKIP_IMAGES,nh),nn===0&&Gt.generateMipmaps&&Rt.generateMipmap(zi),rt.unbindTexture()},this.initTexture=function(We){We.isCubeTexture?Se.setTextureCube(We,0):We.isData3DTexture?Se.setTexture3D(We,0):We.isDataArrayTexture||We.isCompressedArrayTexture?Se.setTexture2DArray(We,0):Se.setTexture2D(We,0),rt.unbindTexture()},this.resetState=function(){ce=0,Te=0,Ce=null,rt.reset(),Wi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(r){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!r}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Xn?Br:Zo}set outputEncoding(r){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=r===Br?Xn:vi}}class i_ extends Ff{}i_.prototype.isWebGL1Renderer=!0;class pp{constructor(r,c=25e-5){this.isFogExp2=!0,this.name="",this.color=new En(r),this.density=c}clone(){return new pp(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class fp{constructor(r,c=1,p=1e3){this.isFog=!0,this.name="",this.color=new En(r),this.near=c,this.far=p}clone(){return new fp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class ul extends Vi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,c){return super.copy(r,c),r.background!==null&&(this.background=r.background.clone()),r.environment!==null&&(this.environment=r.environment.clone()),r.fog!==null&&(this.fog=r.fog.clone()),this.backgroundBlurriness=r.backgroundBlurriness,this.backgroundIntensity=r.backgroundIntensity,r.overrideMaterial!==null&&(this.overrideMaterial=r.overrideMaterial.clone()),this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){const c=super.toJSON(r);return this.fog!==null&&(c.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(c.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(c.object.backgroundIntensity=this.backgroundIntensity),c}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(r){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=r}}class Va{constructor(r,c){this.isInterleavedBuffer=!0,this.array=r,this.stride=c,this.count=r!==void 0?r.length/c:0,this.usage=el,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ua()}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,c,p){r*=this.stride,p*=c.stride;for(let m=0,_=this.stride;m<_;m++)this.array[r+m]=c.array[p+m];return this}set(r,c=0){return this.array.set(r,c),this}clone(r){r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ua()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const c=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),p=new this.constructor(c,this.stride);return p.setUsage(this.usage),p}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ua()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const js=new ze;class zu{constructor(r,c,p,m=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=r,this.itemSize=c,this.offset=p,this.normalized=m}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(r){this.data.needsUpdate=r}applyMatrix4(r){for(let c=0,p=this.data.count;c<p;c++)js.fromBufferAttribute(this,c),js.applyMatrix4(r),this.setXYZ(c,js.x,js.y,js.z);return this}applyNormalMatrix(r){for(let c=0,p=this.count;c<p;c++)js.fromBufferAttribute(this,c),js.applyNormalMatrix(r),this.setXYZ(c,js.x,js.y,js.z);return this}transformDirection(r){for(let c=0,p=this.count;c<p;c++)js.fromBufferAttribute(this,c),js.transformDirection(r),this.setXYZ(c,js.x,js.y,js.z);return this}setX(r,c){return this.normalized&&(c=Si(c,this.array)),this.data.array[r*this.data.stride+this.offset]=c,this}setY(r,c){return this.normalized&&(c=Si(c,this.array)),this.data.array[r*this.data.stride+this.offset+1]=c,this}setZ(r,c){return this.normalized&&(c=Si(c,this.array)),this.data.array[r*this.data.stride+this.offset+2]=c,this}setW(r,c){return this.normalized&&(c=Si(c,this.array)),this.data.array[r*this.data.stride+this.offset+3]=c,this}getX(r){let c=this.data.array[r*this.data.stride+this.offset];return this.normalized&&(c=to(c,this.array)),c}getY(r){let c=this.data.array[r*this.data.stride+this.offset+1];return this.normalized&&(c=to(c,this.array)),c}getZ(r){let c=this.data.array[r*this.data.stride+this.offset+2];return this.normalized&&(c=to(c,this.array)),c}getW(r){let c=this.data.array[r*this.data.stride+this.offset+3];return this.normalized&&(c=to(c,this.array)),c}setXY(r,c,p){return r=r*this.data.stride+this.offset,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array)),this.data.array[r+0]=c,this.data.array[r+1]=p,this}setXYZ(r,c,p,m){return r=r*this.data.stride+this.offset,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array),m=Si(m,this.array)),this.data.array[r+0]=c,this.data.array[r+1]=p,this.data.array[r+2]=m,this}setXYZW(r,c,p,m,_){return r=r*this.data.stride+this.offset,this.normalized&&(c=Si(c,this.array),p=Si(p,this.array),m=Si(m,this.array),_=Si(_,this.array)),this.data.array[r+0]=c,this.data.array[r+1]=p,this.data.array[r+2]=m,this.data.array[r+3]=_,this}clone(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const c=[];for(let p=0;p<this.count;p++){const m=p*this.data.stride+this.offset;for(let _=0;_<this.itemSize;_++)c.push(this.data.array[m+_])}return new ur(new this.array.constructor(c),this.itemSize,this.normalized)}return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.clone(r)),new zu(r.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const c=[];for(let p=0;p<this.count;p++){const m=p*this.data.stride+this.offset;for(let _=0;_<this.itemSize;_++)c.push(this.data.array[m+_])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:c,normalized:this.normalized}}return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.toJSON(r)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class oy extends Ss{constructor(r){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new En(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.rotation=r.rotation,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}}let hl;const mp=new ze,Vh=new ze,Gh=new ze,Hh=new qt,cg=new qt,Bb=new _i,r_=new ze,ug=new ze,hg=new ze,zf=new qt,s_=new qt,a_=new qt;class ju extends Vi{constructor(r){if(super(),this.isSprite=!0,this.type="Sprite",hl===void 0){hl=new ee;const c=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),p=new Va(c,5);hl.setIndex([0,1,2,0,2,3]),hl.setAttribute("position",new zu(p,3,0,!1)),hl.setAttribute("uv",new zu(p,2,3,!1))}this.geometry=hl,this.material=r!==void 0?r:new oy,this.center=new qt(.5,.5)}raycast(r,c){r.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Vh.setFromMatrixScale(this.matrixWorld),Bb.copy(r.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(r.camera.matrixWorldInverse,this.matrixWorld),Gh.setFromMatrixPosition(this.modelViewMatrix),r.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Vh.multiplyScalar(-Gh.z);const p=this.material.rotation;let m,_;p!==0&&(_=Math.cos(p),m=Math.sin(p));const x=this.center;dg(r_.set(-.5,-.5,0),Gh,x,Vh,m,_),dg(ug.set(.5,-.5,0),Gh,x,Vh,m,_),dg(hg.set(.5,.5,0),Gh,x,Vh,m,_),zf.set(0,0),s_.set(1,0),a_.set(1,1);let S=r.ray.intersectTriangle(r_,ug,hg,!1,mp);if(S===null&&(dg(ug.set(-.5,.5,0),Gh,x,Vh,m,_),s_.set(0,1),S=r.ray.intersectTriangle(r_,hg,ug,!1,mp),S===null))return;const B=r.ray.origin.distanceTo(mp);B<r.near||B>r.far||c.push({distance:B,point:mp.clone(),uv:Zr.getInterpolation(mp,r_,ug,hg,zf,s_,a_,new qt),face:null,object:this})}copy(r,c){return super.copy(r,c),r.center!==void 0&&this.center.copy(r.center),this.material=r.material,this}}function dg(b,r,c,p,m,_){Hh.subVectors(b,c).addScalar(.5).multiply(p),m!==void 0?(cg.x=_*Hh.x-m*Hh.y,cg.y=m*Hh.x+_*Hh.y):cg.copy(Hh),b.copy(r),b.x+=cg.x,b.y+=cg.y,b.applyMatrix4(Bb)}const Uo=new ze,No=new ze;class jf extends Vi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(r){super.copy(r,!1);const c=r.levels;for(let p=0,m=c.length;p<m;p++){const _=c[p];this.addLevel(_.object.clone(),_.distance,_.hysteresis)}return this.autoUpdate=r.autoUpdate,this}addLevel(r,c=0,p=0){c=Math.abs(c);const m=this.levels;let _;for(_=0;_<m.length&&!(c<m[_].distance);_++);return m.splice(_,0,{distance:c,hysteresis:p,object:r}),this.add(r),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){const c=this.levels;if(c.length>0){let p,m;for(p=1,m=c.length;p<m;p++){let _=c[p].distance;if(c[p].object.visible&&(_-=_*c[p].hysteresis),r<_)break}return c[p-1].object}return null}raycast(r,c){if(this.levels.length>0){Uo.setFromMatrixPosition(this.matrixWorld);const p=r.ray.origin.distanceTo(Uo);this.getObjectForDistance(p).raycast(r,c)}}update(r){const c=this.levels;if(c.length>1){Uo.setFromMatrixPosition(r.matrixWorld),No.setFromMatrixPosition(this.matrixWorld);const p=Uo.distanceTo(No)/r.zoom;let m,_;for(c[0].object.visible=!0,m=1,_=c.length;m<_;m++){let x=c[m].distance;if(c[m].object.visible&&(x-=x*c[m].hysteresis),!(p>=x))break;c[m-1].object.visible=!1,c[m].object.visible=!0}for(this._currentLevel=m-1;m<_;m++)c[m].object.visible=!1}}toJSON(r){const c=super.toJSON(r);this.autoUpdate===!1&&(c.object.autoUpdate=!1),c.object.levels=[];const p=this.levels;for(let m=0,_=p.length;m<_;m++){const x=p[m];c.object.levels.push({object:x.object.uuid,distance:x.distance,hysteresis:x.hysteresis})}return c}}const o_=new ze,so=new Ji,Lb=new Ji,rE=new ze,l_=new _i,gp=new ze;class Fo extends Cs{constructor(r,c){super(r,c),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new _i,this.bindMatrixInverse=new _i,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const r=this.geometry;this.boundingBox===null&&(this.boundingBox=new nl),this.boundingBox.makeEmpty();const c=r.getAttribute("position");for(let p=0;p<c.count;p++)gp.fromBufferAttribute(c,p),this.applyBoneTransform(p,gp),this.boundingBox.expandByPoint(gp)}computeBoundingSphere(){const r=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Do),this.boundingSphere.makeEmpty();const c=r.getAttribute("position");for(let p=0;p<c.count;p++)gp.fromBufferAttribute(c,p),this.applyBoneTransform(p,gp),this.boundingSphere.expandByPoint(gp)}copy(r,c){return super.copy(r,c),this.bindMode=r.bindMode,this.bindMatrix.copy(r.bindMatrix),this.bindMatrixInverse.copy(r.bindMatrixInverse),this.skeleton=r.skeleton,this}getVertexPosition(r,c){return super.getVertexPosition(r,c),this.applyBoneTransform(r,c),c}bind(r,c){this.skeleton=r,c===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),c=this.matrixWorld),this.bindMatrix.copy(c),this.bindMatrixInverse.copy(c).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const r=new Ji,c=this.geometry.attributes.skinWeight;for(let p=0,m=c.count;p<m;p++){r.fromBufferAttribute(c,p);const _=1/r.manhattanLength();_!==1/0?r.multiplyScalar(_):r.set(1,0,0,0),c.setXYZW(p,r.x,r.y,r.z,r.w)}}updateMatrixWorld(r){super.updateMatrixWorld(r),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(r,c){const p=this.skeleton,m=this.geometry;so.fromBufferAttribute(m.attributes.skinIndex,r),Lb.fromBufferAttribute(m.attributes.skinWeight,r),o_.copy(c).applyMatrix4(this.bindMatrix),c.set(0,0,0);for(let _=0;_<4;_++){const x=Lb.getComponent(_);if(x!==0){const S=so.getComponent(_);l_.multiplyMatrices(p.bones[S].matrixWorld,p.boneInverses[S]),c.addScaledVector(rE.copy(o_).applyMatrix4(l_),x)}}return c.applyMatrix4(this.bindMatrixInverse)}boneTransform(r,c){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(r,c)}}class ra extends Vi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Vf extends pr{constructor(r=null,c=1,p=1,m,_,x,S,B,D=lr,U=lr,G,V){super(null,x,S,B,D,U,m,_,G,V),this.isDataTexture=!0,this.image={data:r,width:c,height:p},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ob=new _i,Gf=new _i;class Qh{constructor(r=[],c=[]){this.uuid=Ua(),this.bones=r.slice(0),this.boneInverses=c,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const r=this.bones,c=this.boneInverses;if(this.boneMatrices=new Float32Array(16*r.length),c.length===0)this.calculateInverses();else if(r.length!==c.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let p=0,m=this.bones.length;p<m;p++)this.boneInverses.push(new _i)}}calculateInverses(){this.boneInverses.length=0;for(let r=0,c=this.bones.length;r<c;r++){const p=new _i;this.bones[r]&&p.copy(this.bones[r].matrixWorld).invert(),this.boneInverses.push(p)}}pose(){for(let r=0,c=this.bones.length;r<c;r++){const p=this.bones[r];p&&p.matrixWorld.copy(this.boneInverses[r]).invert()}for(let r=0,c=this.bones.length;r<c;r++){const p=this.bones[r];p&&(p.parent&&p.parent.isBone?(p.matrix.copy(p.parent.matrixWorld).invert(),p.matrix.multiply(p.matrixWorld)):p.matrix.copy(p.matrixWorld),p.matrix.decompose(p.position,p.quaternion,p.scale))}}update(){const r=this.bones,c=this.boneInverses,p=this.boneMatrices,m=this.boneTexture;for(let _=0,x=r.length;_<x;_++){const S=r[_]?r[_].matrixWorld:Gf;Ob.multiplyMatrices(S,c[_]),Ob.toArray(p,16*_)}m!==null&&(m.needsUpdate=!0)}clone(){return new Qh(this.bones,this.boneInverses)}computeBoneTexture(){let r=Math.sqrt(4*this.bones.length);r=Pi(r),r=Math.max(r,4);const c=new Float32Array(r*r*4);c.set(this.boneMatrices);const p=new Vf(c,r,r,Ls,wl);return p.needsUpdate=!0,this.boneMatrices=c,this.boneTexture=p,this.boneTextureSize=r,this}getBoneByName(r){for(let c=0,p=this.bones.length;c<p;c++){const m=this.bones[c];if(m.name===r)return m}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,c){this.uuid=r.uuid;for(let p=0,m=r.bones.length;p<m;p++){const _=r.bones[p];let x=c[_];x===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",_),x=new ra),this.bones.push(x),this.boneInverses.push(new _i().fromArray(r.boneInverses[p]))}return this.init(),this}toJSON(){const r={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};r.uuid=this.uuid;const c=this.bones,p=this.boneInverses;for(let m=0,_=c.length;m<_;m++){const x=c[m];r.bones.push(x.uuid);const S=p[m];r.boneInverses.push(S.toArray())}return r}}class Ga extends ur{constructor(r,c,p,m=1){super(r,c,p),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=m}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}toJSON(){const r=super.toJSON();return r.meshPerAttribute=this.meshPerAttribute,r.isInstancedBufferAttribute=!0,r}}const Ac=new _i,Wh=new _i,Ea=[],Hf=new nl,kb=new _i,pg=new Cs,Qf=new Do;class Ub extends Cs{constructor(r,c,p){super(r,c),this.isInstancedMesh=!0,this.instanceMatrix=new Ga(new Float32Array(16*p),16),this.instanceColor=null,this.sourceTrs=null,this.count=p,this.boundingBox=null,this.boundingSphere=null;for(let m=0;m<p;m++)this.setMatrixAt(m,kb)}computeBoundingBox(){const r=this.geometry,c=this.count;this.boundingBox===null&&(this.boundingBox=new nl),r.boundingBox===null&&r.computeBoundingBox(),this.boundingBox.makeEmpty();for(let p=0;p<c;p++)this.getMatrixAt(p,Ac),Hf.copy(r.boundingBox).applyMatrix4(Ac),this.boundingBox.union(Hf)}computeBoundingSphere(){const r=this.geometry,c=this.count;this.boundingSphere===null&&(this.boundingSphere=new Do),r.boundingSphere===null&&r.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let p=0;p<c;p++)this.getMatrixAt(p,Ac),Qf.copy(r.boundingSphere).applyMatrix4(Ac),this.boundingSphere.union(Qf)}copy(r,c){return super.copy(r,c),r.isInstancedMesh?(this.instanceMatrix.copy(r.instanceMatrix),r.instanceColor!==null&&(this.instanceColor=r.instanceColor.clone()),this.count=r.count,this):this}getColorAt(r,c){c.fromArray(this.instanceColor.array,3*r)}getMatrixAt(r,c){c.fromArray(this.instanceMatrix.array,16*r)}raycast(r,c){const p=this.matrixWorld,m=this.count;if(pg.geometry=this.geometry,pg.material=this.material,pg.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Qf.copy(this.boundingSphere),Qf.applyMatrix4(p),r.ray.intersectsSphere(Qf)!==!1))for(let _=0;_<m;_++){this.getMatrixAt(_,Ac),Wh.multiplyMatrices(p,Ac),pg.matrixWorld=Wh,pg.raycast(r,Ea);for(let x=0,S=Ea.length;x<S;x++){const B=Ea[x];B.instanceId=_,B.object=this,c.push(B)}Ea.length=0}}setColorAt(r,c){this.instanceColor===null&&(this.instanceColor=new Ga(new Float32Array(3*this.instanceMatrix.count),3)),c.toArray(this.instanceColor.array,3*r)}setMatrixAt(r,c){c.toArray(this.instanceMatrix.array,16*r)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class ao extends Ss{constructor(r){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new En(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}}const ly=new ze,cy=new ze,Sa=new _i,Gi=new Mu,vp=new Do;class Zi extends Vi{constructor(r=new ee,c=new ao){super(),this.isLine=!0,this.type="Line",this.geometry=r,this.material=c,this.updateMorphTargets()}copy(r,c){return super.copy(r,c),this.material=r.material,this.geometry=r.geometry,this}computeLineDistances(){const r=this.geometry;if(r.index===null){const c=r.attributes.position,p=[0];for(let m=1,_=c.count;m<_;m++)ly.fromBufferAttribute(c,m-1),cy.fromBufferAttribute(c,m),p[m]=p[m-1],p[m]+=ly.distanceTo(cy);r.setAttribute("lineDistance",new Tn(p,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(r,c){const p=this.geometry,m=this.matrixWorld,_=r.params.Line.threshold,x=p.drawRange;if(p.boundingSphere===null&&p.computeBoundingSphere(),vp.copy(p.boundingSphere),vp.applyMatrix4(m),vp.radius+=_,r.ray.intersectsSphere(vp)===!1)return;Sa.copy(m).invert(),Gi.copy(r.ray).applyMatrix4(Sa);const S=_/((this.scale.x+this.scale.y+this.scale.z)/3),B=S*S,D=new ze,U=new ze,G=new ze,V=new ze,Q=this.isLineSegments?2:1,q=p.index,te=p.attributes.position;if(q!==null)for(let K=Math.max(0,x.start),Z=Math.min(q.count,x.start+x.count)-1;K<Z;K+=Q){const ae=q.getX(K),ce=q.getX(K+1);if(D.fromBufferAttribute(te,ae),U.fromBufferAttribute(te,ce),Gi.distanceSqToSegment(D,U,V,G)>B)continue;V.applyMatrix4(this.matrixWorld);const Te=r.ray.origin.distanceTo(V);Te<r.near||Te>r.far||c.push({distance:Te,point:G.clone().applyMatrix4(this.matrixWorld),index:K,face:null,faceIndex:null,object:this})}else for(let K=Math.max(0,x.start),Z=Math.min(te.count,x.start+x.count)-1;K<Z;K+=Q){if(D.fromBufferAttribute(te,K),U.fromBufferAttribute(te,K+1),Gi.distanceSqToSegment(D,U,V,G)>B)continue;V.applyMatrix4(this.matrixWorld);const ae=r.ray.origin.distanceTo(V);ae<r.near||ae>r.far||c.push({distance:ae,point:G.clone().applyMatrix4(this.matrixWorld),index:K,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const r=this.geometry.morphAttributes,c=Object.keys(r);if(c.length>0){const p=r[c[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,_=p.length;m<_;m++){const x=p[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=m}}}}}const Nb=new ze,c_=new ze;class jl extends Zi{constructor(r,c){super(r,c),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const r=this.geometry;if(r.index===null){const c=r.attributes.position,p=[];for(let m=0,_=c.count;m<_;m+=2)Nb.fromBufferAttribute(c,m),c_.fromBufferAttribute(c,m+1),p[m]=m===0?0:p[m-1],p[m+1]=p[m]+Nb.distanceTo(c_);r.setAttribute("lineDistance",new Tn(p,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Vl extends Zi{constructor(r,c){super(r,c),this.isLineLoop=!0,this.type="LineLoop"}}class _p extends Ss{constructor(r){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new En(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.size=r.size,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}}const fg=new _i,u_=new Mu,Wf=new Do,mg=new ze;class h_ extends Vi{constructor(r=new ee,c=new _p){super(),this.isPoints=!0,this.type="Points",this.geometry=r,this.material=c,this.updateMorphTargets()}copy(r,c){return super.copy(r,c),this.material=r.material,this.geometry=r.geometry,this}raycast(r,c){const p=this.geometry,m=this.matrixWorld,_=r.params.Points.threshold,x=p.drawRange;if(p.boundingSphere===null&&p.computeBoundingSphere(),Wf.copy(p.boundingSphere),Wf.applyMatrix4(m),Wf.radius+=_,r.ray.intersectsSphere(Wf)===!1)return;fg.copy(m).invert(),u_.copy(r.ray).applyMatrix4(fg);const S=_/((this.scale.x+this.scale.y+this.scale.z)/3),B=S*S,D=p.index,U=p.attributes.position;if(D!==null)for(let G=Math.max(0,x.start),V=Math.min(D.count,x.start+x.count);G<V;G++){const Q=D.getX(G);mg.fromBufferAttribute(U,Q),gg(mg,Q,B,m,r,c,this)}else for(let G=Math.max(0,x.start),V=Math.min(U.count,x.start+x.count);G<V;G++)mg.fromBufferAttribute(U,G),gg(mg,G,B,m,r,c,this)}updateMorphTargets(){const r=this.geometry.morphAttributes,c=Object.keys(r);if(c.length>0){const p=r[c[0]];if(p!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,_=p.length;m<_;m++){const x=p[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[x]=m}}}}}function gg(b,r,c,p,m,_,x){const S=u_.distanceSqToPoint(b);if(S<c){const B=new ze;u_.closestPointToPoint(b,B),B.applyMatrix4(p);const D=m.ray.origin.distanceTo(B);if(D<m.near||D>m.far)return;_.push({distance:D,distanceToRay:Math.sqrt(S),point:B,index:r,face:null,object:x})}}class Fb extends pr{constructor(r,c,p,m,_,x,S,B,D){super(r,c,p,m,_,x,S,B,D),this.isVideoTexture=!0,this.minFilter=x!==void 0?x:Cr,this.magFilter=_!==void 0?_:Cr,this.generateMipmaps=!1;const U=this;"requestVideoFrameCallback"in r&&r.requestVideoFrameCallback(function G(){U.needsUpdate=!0,r.requestVideoFrameCallback(G)})}clone(){return new this.constructor(this.image).copy(this)}update(){const r=this.image;!("requestVideoFrameCallback"in r)&&r.readyState>=r.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class uy extends pr{constructor(r,c,p){super({width:r,height:c}),this.isFramebufferTexture=!0,this.format=p,this.magFilter=lr,this.minFilter=lr,this.generateMipmaps=!1,this.needsUpdate=!0}}class vg extends pr{constructor(r,c,p,m,_,x,S,B,D,U,G,V){super(null,x,S,B,D,U,m,_,G,V),this.isCompressedTexture=!0,this.image={width:c,height:p},this.mipmaps=r,this.flipY=!1,this.generateMipmaps=!1}}class hy extends vg{constructor(r,c,p,m,_,x){super(r,c,p,_,x),this.isCompressedArrayTexture=!0,this.image.depth=m,this.wrapR=Mr}}class zb extends pr{constructor(r,c,p,m,_,x,S,B,D){super(r,c,p,m,_,x,S,B,D),this.isCanvasTexture=!0,this.needsUpdate=!0}}class zo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(r,c){const p=this.getUtoTmapping(r);return this.getPoint(p,c)}getPoints(r=5){const c=[];for(let p=0;p<=r;p++)c.push(this.getPoint(p/r));return c}getSpacedPoints(r=5){const c=[];for(let p=0;p<=r;p++)c.push(this.getPointAt(p/r));return c}getLength(){const r=this.getLengths();return r[r.length-1]}getLengths(r=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===r+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const c=[];let p,m=this.getPoint(0),_=0;c.push(0);for(let x=1;x<=r;x++)p=this.getPoint(x/r),_+=p.distanceTo(m),c.push(_),m=p;return this.cacheArcLengths=c,c}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(r,c){const p=this.getLengths();let m=0;const _=p.length;let x;x=c||r*p[_-1];let S,B=0,D=_-1;for(;B<=D;)if(m=Math.floor(B+(D-B)/2),S=p[m]-x,S<0)B=m+1;else{if(!(S>0)){D=m;break}D=m-1}if(m=D,p[m]===x)return m/(_-1);const U=p[m];return(m+(x-U)/(p[m+1]-U))/(_-1)}getTangent(r,c){let m=r-1e-4,_=r+1e-4;m<0&&(m=0),_>1&&(_=1);const x=this.getPoint(m),S=this.getPoint(_),B=c||(x.isVector2?new qt:new ze);return B.copy(S).sub(x).normalize(),B}getTangentAt(r,c){const p=this.getUtoTmapping(r);return this.getTangent(p,c)}computeFrenetFrames(r,c){const p=new ze,m=[],_=[],x=[],S=new ze,B=new _i;for(let Q=0;Q<=r;Q++){const q=Q/r;m[Q]=this.getTangentAt(q,new ze)}_[0]=new ze,x[0]=new ze;let D=Number.MAX_VALUE;const U=Math.abs(m[0].x),G=Math.abs(m[0].y),V=Math.abs(m[0].z);U<=D&&(D=U,p.set(1,0,0)),G<=D&&(D=G,p.set(0,1,0)),V<=D&&p.set(0,0,1),S.crossVectors(m[0],p).normalize(),_[0].crossVectors(m[0],S),x[0].crossVectors(m[0],_[0]);for(let Q=1;Q<=r;Q++){if(_[Q]=_[Q-1].clone(),x[Q]=x[Q-1].clone(),S.crossVectors(m[Q-1],m[Q]),S.length()>Number.EPSILON){S.normalize();const q=Math.acos(Hn(m[Q-1].dot(m[Q]),-1,1));_[Q].applyMatrix4(B.makeRotationAxis(S,q))}x[Q].crossVectors(m[Q],_[Q])}if(c===!0){let Q=Math.acos(Hn(_[0].dot(_[r]),-1,1));Q/=r,m[0].dot(S.crossVectors(_[0],_[r]))>0&&(Q=-Q);for(let q=1;q<=r;q++)_[q].applyMatrix4(B.makeRotationAxis(m[q],Q*q)),x[q].crossVectors(m[q],_[q])}return{tangents:m,normals:_,binormals:x}}clone(){return new this.constructor().copy(this)}copy(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}toJSON(){const r={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return r.arcLengthDivisions=this.arcLengthDivisions,r.type=this.type,r}fromJSON(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}}class _g extends zo{constructor(r=0,c=0,p=1,m=1,_=0,x=2*Math.PI,S=!1,B=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=r,this.aY=c,this.xRadius=p,this.yRadius=m,this.aStartAngle=_,this.aEndAngle=x,this.aClockwise=S,this.aRotation=B}getPoint(r,c){const p=c||new qt,m=2*Math.PI;let _=this.aEndAngle-this.aStartAngle;const x=Math.abs(_)<Number.EPSILON;for(;_<0;)_+=m;for(;_>m;)_-=m;_<Number.EPSILON&&(_=x?0:m),this.aClockwise!==!0||x||(_===m?_=-m:_-=m);const S=this.aStartAngle+r*_;let B=this.aX+this.xRadius*Math.cos(S),D=this.aY+this.yRadius*Math.sin(S);if(this.aRotation!==0){const U=Math.cos(this.aRotation),G=Math.sin(this.aRotation),V=B-this.aX,Q=D-this.aY;B=V*U-Q*G+this.aX,D=V*G+Q*U+this.aY}return p.set(B,D)}copy(r){return super.copy(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}toJSON(){const r=super.toJSON();return r.aX=this.aX,r.aY=this.aY,r.xRadius=this.xRadius,r.yRadius=this.yRadius,r.aStartAngle=this.aStartAngle,r.aEndAngle=this.aEndAngle,r.aClockwise=this.aClockwise,r.aRotation=this.aRotation,r}fromJSON(r){return super.fromJSON(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}}class dy extends _g{constructor(r,c,p,m,_,x){super(r,c,p,p,m,_,x),this.isArcCurve=!0,this.type="ArcCurve"}}function d_(){let b=0,r=0,c=0,p=0;function m(_,x,S,B){b=_,r=S,c=-3*_+3*x-2*S-B,p=2*_-2*x+S+B}return{initCatmullRom:function(_,x,S,B,D){m(x,S,D*(S-_),D*(B-x))},initNonuniformCatmullRom:function(_,x,S,B,D,U,G){let V=(x-_)/D-(S-_)/(D+U)+(S-x)/U,Q=(S-x)/U-(B-x)/(U+G)+(B-S)/G;V*=U,Q*=U,m(x,S,V,Q)},calc:function(_){const x=_*_;return b+r*_+c*x+p*(x*_)}}}const qh=new ze,p_=new d_,f_=new d_,jr=new d_;class py extends zo{constructor(r=[],c=!1,p="centripetal",m=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=r,this.closed=c,this.curveType=p,this.tension=m}getPoint(r,c=new ze){const p=c,m=this.points,_=m.length,x=(_-(this.closed?0:1))*r;let S,B,D=Math.floor(x),U=x-D;this.closed?D+=D>0?0:(Math.floor(Math.abs(D)/_)+1)*_:U===0&&D===_-1&&(D=_-2,U=1),this.closed||D>0?S=m[(D-1)%_]:(qh.subVectors(m[0],m[1]).add(m[0]),S=qh);const G=m[D%_],V=m[(D+1)%_];if(this.closed||D+2<_?B=m[(D+2)%_]:(qh.subVectors(m[_-1],m[_-2]).add(m[_-1]),B=qh),this.curveType==="centripetal"||this.curveType==="chordal"){const Q=this.curveType==="chordal"?.5:.25;let q=Math.pow(S.distanceToSquared(G),Q),te=Math.pow(G.distanceToSquared(V),Q),K=Math.pow(V.distanceToSquared(B),Q);te<1e-4&&(te=1),q<1e-4&&(q=te),K<1e-4&&(K=te),p_.initNonuniformCatmullRom(S.x,G.x,V.x,B.x,q,te,K),f_.initNonuniformCatmullRom(S.y,G.y,V.y,B.y,q,te,K),jr.initNonuniformCatmullRom(S.z,G.z,V.z,B.z,q,te,K)}else this.curveType==="catmullrom"&&(p_.initCatmullRom(S.x,G.x,V.x,B.x,this.tension),f_.initCatmullRom(S.y,G.y,V.y,B.y,this.tension),jr.initCatmullRom(S.z,G.z,V.z,B.z,this.tension));return p.set(p_.calc(U),f_.calc(U),jr.calc(U)),p}copy(r){super.copy(r),this.points=[];for(let c=0,p=r.points.length;c<p;c++){const m=r.points[c];this.points.push(m.clone())}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){const r=super.toJSON();r.points=[];for(let c=0,p=this.points.length;c<p;c++){const m=this.points[c];r.points.push(m.toArray())}return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let c=0,p=r.points.length;c<p;c++){const m=r.points[c];this.points.push(new ze().fromArray(m))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}function m_(b,r,c,p,m){const _=.5*(p-r),x=.5*(m-c),S=b*b;return(2*c-2*p+_+x)*(b*S)+(-3*c+3*p-2*_-x)*S+_*b+c}function Vu(b,r,c,p){return function(m,_){const x=1-m;return x*x*_}(b,r)+function(m,_){return 2*(1-m)*m*_}(b,c)+function(m,_){return m*m*_}(b,p)}function yp(b,r,c,p,m){return function(_,x){const S=1-_;return S*S*S*x}(b,r)+function(_,x){const S=1-_;return 3*S*S*_*x}(b,c)+function(_,x){return 3*(1-_)*_*_*x}(b,p)+function(_,x){return _*_*_*x}(b,m)}class fy extends zo{constructor(r=new qt,c=new qt,p=new qt,m=new qt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=r,this.v1=c,this.v2=p,this.v3=m}getPoint(r,c=new qt){const p=c,m=this.v0,_=this.v1,x=this.v2,S=this.v3;return p.set(yp(r,m.x,_.x,x.x,S.x),yp(r,m.y,_.y,x.y,S.y)),p}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}class jb extends zo{constructor(r=new ze,c=new ze,p=new ze,m=new ze){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=r,this.v1=c,this.v2=p,this.v3=m}getPoint(r,c=new ze){const p=c,m=this.v0,_=this.v1,x=this.v2,S=this.v3;return p.set(yp(r,m.x,_.x,x.x,S.x),yp(r,m.y,_.y,x.y,S.y),yp(r,m.z,_.z,x.z,S.z)),p}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}class g_ extends zo{constructor(r=new qt,c=new qt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=r,this.v2=c}getPoint(r,c=new qt){const p=c;return r===1?p.copy(this.v2):(p.copy(this.v2).sub(this.v1),p.multiplyScalar(r).add(this.v1)),p}getPointAt(r,c){return this.getPoint(r,c)}getTangent(r,c=new qt){return c.subVectors(this.v2,this.v1).normalize()}getTangentAt(r,c){return this.getTangent(r,c)}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class Vb extends zo{constructor(r=new ze,c=new ze){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=r,this.v2=c}getPoint(r,c=new ze){const p=c;return r===1?p.copy(this.v2):(p.copy(this.v2).sub(this.v1),p.multiplyScalar(r).add(this.v1)),p}getPointAt(r,c){return this.getPoint(r,c)}getTangent(r,c=new ze){return c.subVectors(this.v2,this.v1).normalize()}getTangentAt(r,c){return this.getTangent(r,c)}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class my extends zo{constructor(r=new qt,c=new qt,p=new qt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=r,this.v1=c,this.v2=p}getPoint(r,c=new qt){const p=c,m=this.v0,_=this.v1,x=this.v2;return p.set(Vu(r,m.x,_.x,x.x),Vu(r,m.y,_.y,x.y)),p}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class yg extends zo{constructor(r=new ze,c=new ze,p=new ze){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=r,this.v1=c,this.v2=p}getPoint(r,c=new ze){const p=c,m=this.v0,_=this.v1,x=this.v2;return p.set(Vu(r,m.x,_.x,x.x),Vu(r,m.y,_.y,x.y),Vu(r,m.z,_.z,x.z)),p}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class gy extends zo{constructor(r=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=r}getPoint(r,c=new qt){const p=c,m=this.points,_=(m.length-1)*r,x=Math.floor(_),S=_-x,B=m[x===0?x:x-1],D=m[x],U=m[x>m.length-2?m.length-1:x+1],G=m[x>m.length-3?m.length-1:x+2];return p.set(m_(S,B.x,D.x,U.x,G.x),m_(S,B.y,D.y,U.y,G.y)),p}copy(r){super.copy(r),this.points=[];for(let c=0,p=r.points.length;c<p;c++){const m=r.points[c];this.points.push(m.clone())}return this}toJSON(){const r=super.toJSON();r.points=[];for(let c=0,p=this.points.length;c<p;c++){const m=this.points[c];r.points.push(m.toArray())}return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let c=0,p=r.points.length;c<p;c++){const m=r.points[c];this.points.push(new qt().fromArray(m))}return this}}var vy=Object.freeze({__proto__:null,ArcCurve:dy,CatmullRomCurve3:py,CubicBezierCurve:fy,CubicBezierCurve3:jb,EllipseCurve:_g,LineCurve:g_,LineCurve3:Vb,QuadraticBezierCurve:my,QuadraticBezierCurve3:yg,SplineCurve:gy});class yy extends zo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(r){this.curves.push(r)}closePath(){const r=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);r.equals(c)||this.curves.push(new g_(c,r))}getPoint(r,c){const p=r*this.getLength(),m=this.getCurveLengths();let _=0;for(;_<m.length;){if(m[_]>=p){const x=m[_]-p,S=this.curves[_],B=S.getLength(),D=B===0?0:1-x/B;return S.getPointAt(D,c)}_++}return null}getLength(){const r=this.getCurveLengths();return r[r.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const r=[];let c=0;for(let p=0,m=this.curves.length;p<m;p++)c+=this.curves[p].getLength(),r.push(c);return this.cacheLengths=r,r}getSpacedPoints(r=40){const c=[];for(let p=0;p<=r;p++)c.push(this.getPoint(p/r));return this.autoClose&&c.push(c[0]),c}getPoints(r=12){const c=[];let p;for(let m=0,_=this.curves;m<_.length;m++){const x=_[m],S=x.isEllipseCurve?2*r:x.isLineCurve||x.isLineCurve3?1:x.isSplineCurve?r*x.points.length:r,B=x.getPoints(S);for(let D=0;D<B.length;D++){const U=B[D];p&&p.equals(U)||(c.push(U),p=U)}}return this.autoClose&&c.length>1&&!c[c.length-1].equals(c[0])&&c.push(c[0]),c}copy(r){super.copy(r),this.curves=[];for(let c=0,p=r.curves.length;c<p;c++){const m=r.curves[c];this.curves.push(m.clone())}return this.autoClose=r.autoClose,this}toJSON(){const r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let c=0,p=this.curves.length;c<p;c++){const m=this.curves[c];r.curves.push(m.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let c=0,p=r.curves.length;c<p;c++){const m=r.curves[c];this.curves.push(new vy[m.type]().fromJSON(m))}return this}}class Xh extends yy{constructor(r){super(),this.type="Path",this.currentPoint=new qt,r&&this.setFromPoints(r)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let c=1,p=r.length;c<p;c++)this.lineTo(r[c].x,r[c].y);return this}moveTo(r,c){return this.currentPoint.set(r,c),this}lineTo(r,c){const p=new g_(this.currentPoint.clone(),new qt(r,c));return this.curves.push(p),this.currentPoint.set(r,c),this}quadraticCurveTo(r,c,p,m){const _=new my(this.currentPoint.clone(),new qt(r,c),new qt(p,m));return this.curves.push(_),this.currentPoint.set(p,m),this}bezierCurveTo(r,c,p,m,_,x){const S=new fy(this.currentPoint.clone(),new qt(r,c),new qt(p,m),new qt(_,x));return this.curves.push(S),this.currentPoint.set(_,x),this}splineThru(r){const c=[this.currentPoint.clone()].concat(r),p=new gy(c);return this.curves.push(p),this.currentPoint.copy(r[r.length-1]),this}arc(r,c,p,m,_,x){const S=this.currentPoint.x,B=this.currentPoint.y;return this.absarc(r+S,c+B,p,m,_,x),this}absarc(r,c,p,m,_,x){return this.absellipse(r,c,p,p,m,_,x),this}ellipse(r,c,p,m,_,x,S,B){const D=this.currentPoint.x,U=this.currentPoint.y;return this.absellipse(r+D,c+U,p,m,_,x,S,B),this}absellipse(r,c,p,m,_,x,S,B){const D=new _g(r,c,p,m,_,x,S,B);if(this.curves.length>0){const G=D.getPoint(0);G.equals(this.currentPoint)||this.lineTo(G.x,G.y)}this.curves.push(D);const U=D.getPoint(1);return this.currentPoint.copy(U),this}copy(r){return super.copy(r),this.currentPoint.copy(r.currentPoint),this}toJSON(){const r=super.toJSON();return r.currentPoint=this.currentPoint.toArray(),r}fromJSON(r){return super.fromJSON(r),this.currentPoint.fromArray(r.currentPoint),this}}class Ap extends ee{constructor(r=[new qt(0,-.5),new qt(.5,0),new qt(0,.5)],c=12,p=0,m=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:r,segments:c,phiStart:p,phiLength:m},c=Math.floor(c),m=Hn(m,0,2*Math.PI);const _=[],x=[],S=[],B=[],D=[],U=1/c,G=new ze,V=new qt,Q=new ze,q=new ze,te=new ze;let K=0,Z=0;for(let ae=0;ae<=r.length-1;ae++)switch(ae){case 0:K=r[ae+1].x-r[ae].x,Z=r[ae+1].y-r[ae].y,Q.x=1*Z,Q.y=-K,Q.z=0*Z,te.copy(Q),Q.normalize(),B.push(Q.x,Q.y,Q.z);break;case r.length-1:B.push(te.x,te.y,te.z);break;default:K=r[ae+1].x-r[ae].x,Z=r[ae+1].y-r[ae].y,Q.x=1*Z,Q.y=-K,Q.z=0*Z,q.copy(Q),Q.x+=te.x,Q.y+=te.y,Q.z+=te.z,Q.normalize(),B.push(Q.x,Q.y,Q.z),te.copy(q)}for(let ae=0;ae<=c;ae++){const ce=p+ae*U*m,Te=Math.sin(ce),Ce=Math.cos(ce);for(let Ie=0;Ie<=r.length-1;Ie++){G.x=r[Ie].x*Te,G.y=r[Ie].y,G.z=r[Ie].x*Ce,x.push(G.x,G.y,G.z),V.x=ae/c,V.y=Ie/(r.length-1),S.push(V.x,V.y);const Ke=B[3*Ie+0]*Te,ct=B[3*Ie+1],Je=B[3*Ie+0]*Ce;D.push(Ke,ct,Je)}}for(let ae=0;ae<c;ae++)for(let ce=0;ce<r.length-1;ce++){const Te=ce+ae*r.length,Ce=Te,Ie=Te+r.length,Ke=Te+r.length+1,ct=Te+1;_.push(Ce,Ie,ct),_.push(Ke,ct,Ie)}this.setIndex(_),this.setAttribute("position",new Tn(x,3)),this.setAttribute("uv",new Tn(S,2)),this.setAttribute("normal",new Tn(D,3))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Ap(r.points,r.segments,r.phiStart,r.phiLength)}}class bp extends Ap{constructor(r=1,c=1,p=4,m=8){const _=new Xh;_.absarc(0,-c/2,r,1.5*Math.PI,0),_.absarc(0,c/2,r,0,.5*Math.PI),super(_.getPoints(p),m),this.type="CapsuleGeometry",this.parameters={radius:r,height:c,capSegments:p,radialSegments:m}}static fromJSON(r){return new bp(r.radius,r.length,r.capSegments,r.radialSegments)}}class Gu extends ee{constructor(r=1,c=32,p=0,m=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:c,thetaStart:p,thetaLength:m},c=Math.max(3,c);const _=[],x=[],S=[],B=[],D=new ze,U=new qt;x.push(0,0,0),S.push(0,0,1),B.push(.5,.5);for(let G=0,V=3;G<=c;G++,V+=3){const Q=p+G/c*m;D.x=r*Math.cos(Q),D.y=r*Math.sin(Q),x.push(D.x,D.y,D.z),S.push(0,0,1),U.x=(x[V]/r+1)/2,U.y=(x[V+1]/r+1)/2,B.push(U.x,U.y)}for(let G=1;G<=c;G++)_.push(G,G+1,0);this.setIndex(_),this.setAttribute("position",new Tn(x,3)),this.setAttribute("normal",new Tn(S,3)),this.setAttribute("uv",new Tn(B,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Gu(r.radius,r.segments,r.thetaStart,r.thetaLength)}}class Yh extends ee{constructor(r=1,c=1,p=1,m=32,_=1,x=!1,S=0,B=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:r,radiusBottom:c,height:p,radialSegments:m,heightSegments:_,openEnded:x,thetaStart:S,thetaLength:B};const D=this;m=Math.floor(m),_=Math.floor(_);const U=[],G=[],V=[],Q=[];let q=0;const te=[],K=p/2;let Z=0;function ae(ce){const Te=q,Ce=new qt,Ie=new ze;let Ke=0;const ct=ce===!0?r:c,Je=ce===!0?1:-1;for(let Ze=1;Ze<=m;Ze++)G.push(0,K*Je,0),V.push(0,Je,0),Q.push(.5,.5),q++;const yt=q;for(let Ze=0;Ze<=m;Ze++){const Pt=Ze/m*B+S,kt=Math.cos(Pt),en=Math.sin(Pt);Ie.x=ct*en,Ie.y=K*Je,Ie.z=ct*kt,G.push(Ie.x,Ie.y,Ie.z),V.push(0,Je,0),Ce.x=.5*kt+.5,Ce.y=.5*en*Je+.5,Q.push(Ce.x,Ce.y),q++}for(let Ze=0;Ze<m;Ze++){const Pt=Te+Ze,kt=yt+Ze;ce===!0?U.push(kt,kt+1,Pt):U.push(kt+1,kt,Pt),Ke+=3}D.addGroup(Z,Ke,ce===!0?1:2),Z+=Ke}(function(){const ce=new ze,Te=new ze;let Ce=0;const Ie=(c-r)/p;for(let Ke=0;Ke<=_;Ke++){const ct=[],Je=Ke/_,yt=Je*(c-r)+r;for(let Ze=0;Ze<=m;Ze++){const Pt=Ze/m,kt=Pt*B+S,en=Math.sin(kt),xn=Math.cos(kt);Te.x=yt*en,Te.y=-Je*p+K,Te.z=yt*xn,G.push(Te.x,Te.y,Te.z),ce.set(en,Ie,xn).normalize(),V.push(ce.x,ce.y,ce.z),Q.push(Pt,1-Je),ct.push(q++)}te.push(ct)}for(let Ke=0;Ke<m;Ke++)for(let ct=0;ct<_;ct++){const Je=te[ct][Ke],yt=te[ct+1][Ke],Ze=te[ct+1][Ke+1],Pt=te[ct][Ke+1];U.push(Je,yt,Pt),U.push(yt,Ze,Pt),Ce+=6}D.addGroup(Z,Ce,0),Z+=Ce})(),x===!1&&(r>0&&ae(!0),c>0&&ae(!1)),this.setIndex(U),this.setAttribute("position",new Tn(G,3)),this.setAttribute("normal",new Tn(V,3)),this.setAttribute("uv",new Tn(Q,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Yh(r.radiusTop,r.radiusBottom,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class Hu extends Yh{constructor(r=1,c=1,p=32,m=1,_=!1,x=0,S=2*Math.PI){super(0,r,c,p,m,_,x,S),this.type="ConeGeometry",this.parameters={radius:r,height:c,radialSegments:p,heightSegments:m,openEnded:_,thetaStart:x,thetaLength:S}}static fromJSON(r){return new Hu(r.radius,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class Gl extends ee{constructor(r=[],c=[],p=1,m=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:c,radius:p,detail:m};const _=[],x=[];function S(V,Q,q,te){const K=te+1,Z=[];for(let ae=0;ae<=K;ae++){Z[ae]=[];const ce=V.clone().lerp(q,ae/K),Te=Q.clone().lerp(q,ae/K),Ce=K-ae;for(let Ie=0;Ie<=Ce;Ie++)Z[ae][Ie]=Ie===0&&ae===K?ce:ce.clone().lerp(Te,Ie/Ce)}for(let ae=0;ae<K;ae++)for(let ce=0;ce<2*(K-ae)-1;ce++){const Te=Math.floor(ce/2);ce%2==0?(B(Z[ae][Te+1]),B(Z[ae+1][Te]),B(Z[ae][Te])):(B(Z[ae][Te+1]),B(Z[ae+1][Te+1]),B(Z[ae+1][Te]))}}function B(V){_.push(V.x,V.y,V.z)}function D(V,Q){const q=3*V;Q.x=r[q+0],Q.y=r[q+1],Q.z=r[q+2]}function U(V,Q,q,te){te<0&&V.x===1&&(x[Q]=V.x-1),q.x===0&&q.z===0&&(x[Q]=te/2/Math.PI+.5)}function G(V){return Math.atan2(V.z,-V.x)}(function(V){const Q=new ze,q=new ze,te=new ze;for(let K=0;K<c.length;K+=3)D(c[K+0],Q),D(c[K+1],q),D(c[K+2],te),S(Q,q,te,V)})(m),function(V){const Q=new ze;for(let q=0;q<_.length;q+=3)Q.x=_[q+0],Q.y=_[q+1],Q.z=_[q+2],Q.normalize().multiplyScalar(V),_[q+0]=Q.x,_[q+1]=Q.y,_[q+2]=Q.z}(p),function(){const V=new ze;for(let q=0;q<_.length;q+=3){V.x=_[q+0],V.y=_[q+1],V.z=_[q+2];const te=G(V)/2/Math.PI+.5,K=(Q=V,Math.atan2(-Q.y,Math.sqrt(Q.x*Q.x+Q.z*Q.z))/Math.PI+.5);x.push(te,1-K)}var Q;(function(){const q=new ze,te=new ze,K=new ze,Z=new ze,ae=new qt,ce=new qt,Te=new qt;for(let Ce=0,Ie=0;Ce<_.length;Ce+=9,Ie+=6){q.set(_[Ce+0],_[Ce+1],_[Ce+2]),te.set(_[Ce+3],_[Ce+4],_[Ce+5]),K.set(_[Ce+6],_[Ce+7],_[Ce+8]),ae.set(x[Ie+0],x[Ie+1]),ce.set(x[Ie+2],x[Ie+3]),Te.set(x[Ie+4],x[Ie+5]),Z.copy(q).add(te).add(K).divideScalar(3);const Ke=G(Z);U(ae,Ie+0,q,Ke),U(ce,Ie+2,te,Ke),U(Te,Ie+4,K,Ke)}})(),function(){for(let q=0;q<x.length;q+=6){const te=x[q+0],K=x[q+2],Z=x[q+4],ae=Math.max(te,K,Z),ce=Math.min(te,K,Z);ae>.9&&ce<.1&&(te<.2&&(x[q+0]+=1),K<.2&&(x[q+2]+=1),Z<.2&&(x[q+4]+=1))}}()}(),this.setAttribute("position",new Tn(_,3)),this.setAttribute("normal",new Tn(_.slice(),3)),this.setAttribute("uv",new Tn(x,2)),m===0?this.computeVertexNormals():this.normalizeNormals()}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Gl(r.vertices,r.indices,r.radius,r.details)}}class xp extends Gl{constructor(r=1,c=0){const p=(1+Math.sqrt(5))/2,m=1/p;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-m,-p,0,-m,p,0,m,-p,0,m,p,-m,-p,0,-m,p,0,m,-p,0,m,p,0,-p,0,-m,p,0,-m,-p,0,m,p,0,m],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],r,c),this.type="DodecahedronGeometry",this.parameters={radius:r,detail:c}}static fromJSON(r){return new xp(r.radius,r.detail)}}const v_=new ze,Kh=new ze,qf=new ze,Ag=new Zr;class __ extends ee{constructor(r=null,c=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:r,thresholdAngle:c},r!==null){const m=Math.pow(10,4),_=Math.cos(uc*c),x=r.getIndex(),S=r.getAttribute("position"),B=x?x.count:S.count,D=[0,0,0],U=["a","b","c"],G=new Array(3),V={},Q=[];for(let q=0;q<B;q+=3){x?(D[0]=x.getX(q),D[1]=x.getX(q+1),D[2]=x.getX(q+2)):(D[0]=q,D[1]=q+1,D[2]=q+2);const{a:te,b:K,c:Z}=Ag;if(te.fromBufferAttribute(S,D[0]),K.fromBufferAttribute(S,D[1]),Z.fromBufferAttribute(S,D[2]),Ag.getNormal(qf),G[0]=`${Math.round(te.x*m)},${Math.round(te.y*m)},${Math.round(te.z*m)}`,G[1]=`${Math.round(K.x*m)},${Math.round(K.y*m)},${Math.round(K.z*m)}`,G[2]=`${Math.round(Z.x*m)},${Math.round(Z.y*m)},${Math.round(Z.z*m)}`,G[0]!==G[1]&&G[1]!==G[2]&&G[2]!==G[0])for(let ae=0;ae<3;ae++){const ce=(ae+1)%3,Te=G[ae],Ce=G[ce],Ie=Ag[U[ae]],Ke=Ag[U[ce]],ct=`${Te}_${Ce}`,Je=`${Ce}_${Te}`;Je in V&&V[Je]?(qf.dot(V[Je].normal)<=_&&(Q.push(Ie.x,Ie.y,Ie.z),Q.push(Ke.x,Ke.y,Ke.z)),V[Je]=null):ct in V||(V[ct]={index0:D[ae],index1:D[ce],normal:qf.clone()})}}for(const q in V)if(V[q]){const{index0:te,index1:K}=V[q];v_.fromBufferAttribute(S,te),Kh.fromBufferAttribute(S,K),Q.push(v_.x,v_.y,v_.z),Q.push(Kh.x,Kh.y,Kh.z)}this.setAttribute("position",new Tn(Q,3))}}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}}class Jh extends Xh{constructor(r){super(r),this.uuid=Ua(),this.type="Shape",this.holes=[]}getPointsHoles(r){const c=[];for(let p=0,m=this.holes.length;p<m;p++)c[p]=this.holes[p].getPoints(r);return c}extractPoints(r){return{shape:this.getPoints(r),holes:this.getPointsHoles(r)}}copy(r){super.copy(r),this.holes=[];for(let c=0,p=r.holes.length;c<p;c++){const m=r.holes[c];this.holes.push(m.clone())}return this}toJSON(){const r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let c=0,p=this.holes.length;c<p;c++){const m=this.holes[c];r.holes.push(m.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let c=0,p=r.holes.length;c<p;c++){const m=r.holes[c];this.holes.push(new Xh().fromJSON(m))}return this}}function Gb(b,r,c,p,m){let _,x;if(m===function(S,B,D,U){let G=0;for(let V=B,Q=D-U;V<D;V+=U)G+=(S[Q]-S[V])*(S[V+1]+S[Q+1]),Q=V;return G}(b,r,c,p)>0)for(_=r;_<c;_+=p)x=Wb(_,b[_],b[_+1],x);else for(_=c-p;_>=r;_-=p)x=Wb(_,b[_],b[_+1],x);return x&&wg(x,x.next)&&(Ep(x),x=x.next),x}function Qu(b,r){if(!b)return b;r||(r=b);let c,p=b;do if(c=!1,p.steiner||!wg(p,p.next)&&Vr(p.prev,p,p.next)!==0)p=p.next;else{if(Ep(p),p=r=p.prev,p===p.next)break;c=!0}while(c||p!==r);return r}function tu(b,r,c,p,m,_,x){if(!b)return;!x&&_&&function(U,G,V,Q){let q=U;do q.z===0&&(q.z=xg(q.x,q.y,G,V,Q)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==U);q.prevZ.nextZ=null,q.prevZ=null,function(te){let K,Z,ae,ce,Te,Ce,Ie,Ke,ct=1;do{for(Z=te,te=null,Te=null,Ce=0;Z;){for(Ce++,ae=Z,Ie=0,K=0;K<ct&&(Ie++,ae=ae.nextZ,ae);K++);for(Ke=ct;Ie>0||Ke>0&&ae;)Ie!==0&&(Ke===0||!ae||Z.z<=ae.z)?(ce=Z,Z=Z.nextZ,Ie--):(ce=ae,ae=ae.nextZ,Ke--),Te?Te.nextZ=ce:te=ce,ce.prevZ=Te,Te=ce;Z=ae}Te.nextZ=null,ct*=2}while(Ce>1)}(q)}(b,p,m,_);let S,B,D=b;for(;b.prev!==b.next;)if(S=b.prev,B=b.next,_?sE(b,p,m,_):Ay(b))r.push(S.i/c|0),r.push(b.i/c|0),r.push(B.i/c|0),Ep(b),b=B.next,D=B.next;else if((b=B)===D){x?x===1?tu(b=bg(Qu(b),r,c),r,c,p,m,_,2):x===2&&Xf(b,r,c,p,m,_):tu(Qu(b),r,c,p,m,_,1);break}}function Ay(b){const r=b.prev,c=b,p=b.next;if(Vr(r,c,p)>=0)return!1;const m=r.x,_=c.x,x=p.x,S=r.y,B=c.y,D=p.y,U=m<_?m<x?m:x:_<x?_:x,G=S<B?S<D?S:D:B<D?B:D,V=m>_?m>x?m:x:_>x?_:x,Q=S>B?S>D?S:D:B>D?B:D;let q=p.next;for(;q!==r;){if(q.x>=U&&q.x<=V&&q.y>=G&&q.y<=Q&&wp(m,S,_,B,x,D,q.x,q.y)&&Vr(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function sE(b,r,c,p){const m=b.prev,_=b,x=b.next;if(Vr(m,_,x)>=0)return!1;const S=m.x,B=_.x,D=x.x,U=m.y,G=_.y,V=x.y,Q=S<B?S<D?S:D:B<D?B:D,q=U<G?U<V?U:V:G<V?G:V,te=S>B?S>D?S:D:B>D?B:D,K=U>G?U>V?U:V:G>V?G:V,Z=xg(Q,q,r,c,p),ae=xg(te,K,r,c,p);let ce=b.prevZ,Te=b.nextZ;for(;ce&&ce.z>=Z&&Te&&Te.z<=ae;){if(ce.x>=Q&&ce.x<=te&&ce.y>=q&&ce.y<=K&&ce!==m&&ce!==x&&wp(S,U,B,G,D,V,ce.x,ce.y)&&Vr(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,Te.x>=Q&&Te.x<=te&&Te.y>=q&&Te.y<=K&&Te!==m&&Te!==x&&wp(S,U,B,G,D,V,Te.x,Te.y)&&Vr(Te.prev,Te,Te.next)>=0))return!1;Te=Te.nextZ}for(;ce&&ce.z>=Z;){if(ce.x>=Q&&ce.x<=te&&ce.y>=q&&ce.y<=K&&ce!==m&&ce!==x&&wp(S,U,B,G,D,V,ce.x,ce.y)&&Vr(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;Te&&Te.z<=ae;){if(Te.x>=Q&&Te.x<=te&&Te.y>=q&&Te.y<=K&&Te!==m&&Te!==x&&wp(S,U,B,G,D,V,Te.x,Te.y)&&Vr(Te.prev,Te,Te.next)>=0)return!1;Te=Te.nextZ}return!0}function bg(b,r,c){let p=b;do{const m=p.prev,_=p.next.next;!wg(m,_)&&by(m,p,p.next,_)&&Sg(m,_)&&Sg(_,m)&&(r.push(m.i/c|0),r.push(p.i/c|0),r.push(_.i/c|0),Ep(p),Ep(p.next),p=b=_),p=p.next}while(p!==b);return Qu(p)}function Xf(b,r,c,p,m,_){let x=b;do{let S=x.next.next;for(;S!==x.prev;){if(x.i!==S.i&&Qb(x,S)){let B=b_(x,S);return x=Qu(x,x.next),B=Qu(B,B.next),tu(x,r,c,p,m,_,0),void tu(B,r,c,p,m,_,0)}S=S.next}x=x.next}while(x!==b)}function aE(b,r){return b.x-r.x}function oE(b,r){const c=function(m,_){let x,S=_,B=-1/0;const D=m.x,U=m.y;do{if(U<=S.y&&U>=S.next.y&&S.next.y!==S.y){const K=S.x+(U-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(K<=D&&K>B&&(B=K,x=S.x<S.next.x?S:S.next,K===D))return x}S=S.next}while(S!==_);if(!x)return null;const G=x,V=x.x,Q=x.y;let q,te=1/0;S=x;do D>=S.x&&S.x>=V&&D!==S.x&&wp(U<Q?D:B,U,V,Q,U<Q?B:D,U,S.x,S.y)&&(q=Math.abs(U-S.y)/(D-S.x),Sg(S,m)&&(q<te||q===te&&(S.x>x.x||S.x===x.x&&Hb(x,S)))&&(x=S,te=q)),S=S.next;while(S!==G);return x}(b,r);if(!c)return r;const p=b_(c,b);return Qu(p,p.next),Qu(c,c.next)}function Hb(b,r){return Vr(b.prev,b,r.prev)<0&&Vr(r.next,b,b.next)<0}function xg(b,r,c,p,m){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=(b-c)*m|0)|b<<8))|b<<4))|b<<2))|b<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-p)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function y_(b){let r=b,c=b;do(r.x<c.x||r.x===c.x&&r.y<c.y)&&(c=r),r=r.next;while(r!==b);return c}function wp(b,r,c,p,m,_,x,S){return(m-x)*(r-S)>=(b-x)*(_-S)&&(b-x)*(p-S)>=(c-x)*(r-S)&&(c-x)*(_-S)>=(m-x)*(p-S)}function Qb(b,r){return b.next.i!==r.i&&b.prev.i!==r.i&&!function(c,p){let m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==p.i&&m.next.i!==p.i&&by(m,m.next,c,p))return!0;m=m.next}while(m!==c);return!1}(b,r)&&(Sg(b,r)&&Sg(r,b)&&function(c,p){let m=c,_=!1;const x=(c.x+p.x)/2,S=(c.y+p.y)/2;do m.y>S!=m.next.y>S&&m.next.y!==m.y&&x<(m.next.x-m.x)*(S-m.y)/(m.next.y-m.y)+m.x&&(_=!_),m=m.next;while(m!==c);return _}(b,r)&&(Vr(b.prev,b,r.prev)||Vr(b,r.prev,r))||wg(b,r)&&Vr(b.prev,b,b.next)>0&&Vr(r.prev,r,r.next)>0)}function Vr(b,r,c){return(r.y-b.y)*(c.x-r.x)-(r.x-b.x)*(c.y-r.y)}function wg(b,r){return b.x===r.x&&b.y===r.y}function by(b,r,c,p){const m=Eg(Vr(b,r,c)),_=Eg(Vr(b,r,p)),x=Eg(Vr(c,p,b)),S=Eg(Vr(c,p,r));return m!==_&&x!==S||!(m!==0||!A_(b,c,r))||!(_!==0||!A_(b,p,r))||!(x!==0||!A_(c,b,p))||!(S!==0||!A_(c,r,p))}function A_(b,r,c){return r.x<=Math.max(b.x,c.x)&&r.x>=Math.min(b.x,c.x)&&r.y<=Math.max(b.y,c.y)&&r.y>=Math.min(b.y,c.y)}function Eg(b){return b>0?1:b<0?-1:0}function Sg(b,r){return Vr(b.prev,b,b.next)<0?Vr(b,r,b.next)>=0&&Vr(b,b.prev,r)>=0:Vr(b,r,b.prev)<0||Vr(b,b.next,r)<0}function b_(b,r){const c=new x_(b.i,b.x,b.y),p=new x_(r.i,r.x,r.y),m=b.next,_=r.prev;return b.next=r,r.prev=b,c.next=m,m.prev=c,p.next=c,c.prev=p,_.next=p,p.prev=_,p}function Wb(b,r,c,p){const m=new x_(b,r,c);return p?(m.next=p.next,m.prev=p,p.next.prev=m,p.next=m):(m.prev=m,m.next=m),m}function Ep(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function x_(b,r,c){this.i=b,this.x=r,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class bc{static area(r){const c=r.length;let p=0;for(let m=c-1,_=0;_<c;m=_++)p+=r[m].x*r[_].y-r[_].x*r[m].y;return .5*p}static isClockWise(r){return bc.area(r)<0}static triangulateShape(r,c){const p=[],m=[],_=[];qb(r),xy(p,r);let x=r.length;c.forEach(qb);for(let B=0;B<c.length;B++)m.push(x),x+=c[B].length,xy(p,c[B]);const S=function(B,D,U=2){const G=D&&D.length,V=G?D[0]*U:B.length;let Q=Gb(B,0,V,U,!0);const q=[];if(!Q||Q.next===Q.prev)return q;let te,K,Z,ae,ce,Te,Ce;if(G&&(Q=function(Ie,Ke,ct,Je){const yt=[];let Ze,Pt,kt,en,xn;for(Ze=0,Pt=Ke.length;Ze<Pt;Ze++)kt=Ke[Ze]*Je,en=Ze<Pt-1?Ke[Ze+1]*Je:Ie.length,xn=Gb(Ie,kt,en,Je,!1),xn===xn.next&&(xn.steiner=!0),yt.push(y_(xn));for(yt.sort(aE),Ze=0;Ze<yt.length;Ze++)ct=oE(yt[Ze],ct);return ct}(B,D,Q,U)),B.length>80*U){te=Z=B[0],K=ae=B[1];for(let Ie=U;Ie<V;Ie+=U)ce=B[Ie],Te=B[Ie+1],ce<te&&(te=ce),Te<K&&(K=Te),ce>Z&&(Z=ce),Te>ae&&(ae=Te);Ce=Math.max(Z-te,ae-K),Ce=Ce!==0?32767/Ce:0}return tu(Q,q,U,te,K,Ce,0),q}(p,m);for(let B=0;B<S.length;B+=3)_.push(S.slice(B,B+3));return _}}function qb(b){const r=b.length;r>2&&b[r-1].equals(b[0])&&b.pop()}function xy(b,r){for(let c=0;c<r.length;c++)b.push(r[c].x),b.push(r[c].y)}class Sp extends ee{constructor(r=new Jh([new qt(.5,.5),new qt(-.5,.5),new qt(-.5,-.5),new qt(.5,-.5)]),c={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:c},r=Array.isArray(r)?r:[r];const p=this,m=[],_=[];for(let S=0,B=r.length;S<B;S++)x(r[S]);function x(S){const B=[],D=c.curveSegments!==void 0?c.curveSegments:12,U=c.steps!==void 0?c.steps:1,G=c.depth!==void 0?c.depth:1;let V=c.bevelEnabled===void 0||c.bevelEnabled,Q=c.bevelThickness!==void 0?c.bevelThickness:.2,q=c.bevelSize!==void 0?c.bevelSize:Q-.1,te=c.bevelOffset!==void 0?c.bevelOffset:0,K=c.bevelSegments!==void 0?c.bevelSegments:3;const Z=c.extrudePath,ae=c.UVGenerator!==void 0?c.UVGenerator:lE;let ce,Te,Ce,Ie,Ke,ct=!1;Z&&(ce=Z.getSpacedPoints(U),ct=!0,V=!1,Te=Z.computeFrenetFrames(U,!1),Ce=new ze,Ie=new ze,Ke=new ze),V||(K=0,Q=0,q=0,te=0);const Je=S.extractPoints(D);let yt=Je.shape;const Ze=Je.holes;if(!bc.isClockWise(yt)){yt=yt.reverse();for(let rt=0,Qe=Ze.length;rt<Qe;rt++){const lt=Ze[rt];bc.isClockWise(lt)&&(Ze[rt]=lt.reverse())}}const Pt=bc.triangulateShape(yt,Ze),kt=yt;for(let rt=0,Qe=Ze.length;rt<Qe;rt++){const lt=Ze[rt];yt=yt.concat(lt)}function en(rt,Qe,lt){return Qe||console.error("THREE.ExtrudeGeometry: vec does not exist"),rt.clone().addScaledVector(Qe,lt)}const xn=yt.length,tn=Pt.length;function Wt(rt,Qe,lt){let Se,$e,it;const Ot=rt.x-Qe.x,Ut=rt.y-Qe.y,Vt=lt.x-rt.x,mn=lt.y-rt.y,In=Ot*Ot+Ut*Ut,Qn=Ot*mn-Ut*Vt;if(Math.abs(Qn)>Number.EPSILON){const Mn=Math.sqrt(In),Yn=Math.sqrt(Vt*Vt+mn*mn),Kn=Qe.x-Ut/Mn,Gn=Qe.y+Ot/Mn,ki=((lt.x-mn/Yn-Kn)*mn-(lt.y+Vt/Yn-Gn)*Vt)/(Ot*mn-Ut*Vt);Se=Kn+Ot*ki-rt.x,$e=Gn+Ut*ki-rt.y;const oa=Se*Se+$e*$e;if(oa<=2)return new qt(Se,$e);it=Math.sqrt(oa/2)}else{let Mn=!1;Ot>Number.EPSILON?Vt>Number.EPSILON&&(Mn=!0):Ot<-Number.EPSILON?Vt<-Number.EPSILON&&(Mn=!0):Math.sign(Ut)===Math.sign(mn)&&(Mn=!0),Mn?(Se=-Ut,$e=Ot,it=Math.sqrt(In)):(Se=Ot,$e=Ut,it=Math.sqrt(In/2))}return new qt(Se/it,$e/it)}const dn=[];for(let rt=0,Qe=kt.length,lt=Qe-1,Se=rt+1;rt<Qe;rt++,lt++,Se++)lt===Qe&&(lt=0),Se===Qe&&(Se=0),dn[rt]=Wt(kt[rt],kt[lt],kt[Se]);const pn=[];let It,Qt=dn.concat();for(let rt=0,Qe=Ze.length;rt<Qe;rt++){const lt=Ze[rt];It=[];for(let Se=0,$e=lt.length,it=$e-1,Ot=Se+1;Se<$e;Se++,it++,Ot++)it===$e&&(it=0),Ot===$e&&(Ot=0),It[Se]=Wt(lt[Se],lt[it],lt[Ot]);pn.push(It),Qt=Qt.concat(It)}for(let rt=0;rt<K;rt++){const Qe=rt/K,lt=Q*Math.cos(Qe*Math.PI/2),Se=q*Math.sin(Qe*Math.PI/2)+te;for(let $e=0,it=kt.length;$e<it;$e++){const Ot=en(kt[$e],dn[$e],Se);bn(Ot.x,Ot.y,-lt)}for(let $e=0,it=Ze.length;$e<it;$e++){const Ot=Ze[$e];It=pn[$e];for(let Ut=0,Vt=Ot.length;Ut<Vt;Ut++){const mn=en(Ot[Ut],It[Ut],Se);bn(mn.x,mn.y,-lt)}}}const un=q+te;for(let rt=0;rt<xn;rt++){const Qe=V?en(yt[rt],Qt[rt],un):yt[rt];ct?(Ie.copy(Te.normals[0]).multiplyScalar(Qe.x),Ce.copy(Te.binormals[0]).multiplyScalar(Qe.y),Ke.copy(ce[0]).add(Ie).add(Ce),bn(Ke.x,Ke.y,Ke.z)):bn(Qe.x,Qe.y,0)}for(let rt=1;rt<=U;rt++)for(let Qe=0;Qe<xn;Qe++){const lt=V?en(yt[Qe],Qt[Qe],un):yt[Qe];ct?(Ie.copy(Te.normals[rt]).multiplyScalar(lt.x),Ce.copy(Te.binormals[rt]).multiplyScalar(lt.y),Ke.copy(ce[rt]).add(Ie).add(Ce),bn(Ke.x,Ke.y,Ke.z)):bn(lt.x,lt.y,G/U*rt)}for(let rt=K-1;rt>=0;rt--){const Qe=rt/K,lt=Q*Math.cos(Qe*Math.PI/2),Se=q*Math.sin(Qe*Math.PI/2)+te;for(let $e=0,it=kt.length;$e<it;$e++){const Ot=en(kt[$e],dn[$e],Se);bn(Ot.x,Ot.y,G+lt)}for(let $e=0,it=Ze.length;$e<it;$e++){const Ot=Ze[$e];It=pn[$e];for(let Ut=0,Vt=Ot.length;Ut<Vt;Ut++){const mn=en(Ot[Ut],It[Ut],Se);ct?bn(mn.x,mn.y+ce[U-1].y,ce[U-1].x+lt):bn(mn.x,mn.y,G+lt)}}}function Kt(rt,Qe){let lt=rt.length;for(;--lt>=0;){const Se=lt;let $e=lt-1;$e<0&&($e=rt.length-1);for(let it=0,Ot=U+2*K;it<Ot;it++){const Ut=xn*it,Vt=xn*(it+1);Xe(Qe+Se+Ut,Qe+$e+Ut,Qe+$e+Vt,Qe+Se+Vt)}}}function bn(rt,Qe,lt){B.push(rt),B.push(Qe),B.push(lt)}function ni(rt,Qe,lt){Le(rt),Le(Qe),Le(lt);const Se=m.length/3,$e=ae.generateTopUV(p,m,Se-3,Se-2,Se-1);_t($e[0]),_t($e[1]),_t($e[2])}function Xe(rt,Qe,lt,Se){Le(rt),Le(Qe),Le(Se),Le(Qe),Le(lt),Le(Se);const $e=m.length/3,it=ae.generateSideWallUV(p,m,$e-6,$e-3,$e-2,$e-1);_t(it[0]),_t(it[1]),_t(it[3]),_t(it[1]),_t(it[2]),_t(it[3])}function Le(rt){m.push(B[3*rt+0]),m.push(B[3*rt+1]),m.push(B[3*rt+2])}function _t(rt){_.push(rt.x),_.push(rt.y)}(function(){const rt=m.length/3;if(V){let Qe=0,lt=xn*Qe;for(let Se=0;Se<tn;Se++){const $e=Pt[Se];ni($e[2]+lt,$e[1]+lt,$e[0]+lt)}Qe=U+2*K,lt=xn*Qe;for(let Se=0;Se<tn;Se++){const $e=Pt[Se];ni($e[0]+lt,$e[1]+lt,$e[2]+lt)}}else{for(let Qe=0;Qe<tn;Qe++){const lt=Pt[Qe];ni(lt[2],lt[1],lt[0])}for(let Qe=0;Qe<tn;Qe++){const lt=Pt[Qe];ni(lt[0]+xn*U,lt[1]+xn*U,lt[2]+xn*U)}}p.addGroup(rt,m.length/3-rt,0)})(),function(){const rt=m.length/3;let Qe=0;Kt(kt,Qe),Qe+=kt.length;for(let lt=0,Se=Ze.length;lt<Se;lt++){const $e=Ze[lt];Kt($e,Qe),Qe+=$e.length}p.addGroup(rt,m.length/3-rt,1)}()}this.setAttribute("position",new Tn(m,3)),this.setAttribute("uv",new Tn(_,2)),this.computeVertexNormals()}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return function(c,p,m){if(m.shapes=[],Array.isArray(c))for(let _=0,x=c.length;_<x;_++){const S=c[_];m.shapes.push(S.uuid)}else m.shapes.push(c.uuid);return m.options=Object.assign({},p),p.extrudePath!==void 0&&(m.options.extrudePath=p.extrudePath.toJSON()),m}(this.parameters.shapes,this.parameters.options,r)}static fromJSON(r,c){const p=[];for(let _=0,x=r.shapes.length;_<x;_++){const S=c[r.shapes[_]];p.push(S)}const m=r.options.extrudePath;return m!==void 0&&(r.options.extrudePath=new vy[m.type]().fromJSON(m)),new Sp(p,r.options)}}const lE={generateTopUV:function(b,r,c,p,m){const _=r[3*c],x=r[3*c+1],S=r[3*p],B=r[3*p+1],D=r[3*m],U=r[3*m+1];return[new qt(_,x),new qt(S,B),new qt(D,U)]},generateSideWallUV:function(b,r,c,p,m,_){const x=r[3*c],S=r[3*c+1],B=r[3*c+2],D=r[3*p],U=r[3*p+1],G=r[3*p+2],V=r[3*m],Q=r[3*m+1],q=r[3*m+2],te=r[3*_],K=r[3*_+1],Z=r[3*_+2];return Math.abs(S-U)<Math.abs(x-D)?[new qt(x,1-B),new qt(D,1-G),new qt(V,1-q),new qt(te,1-Z)]:[new qt(S,1-B),new qt(U,1-G),new qt(Q,1-q),new qt(K,1-Z)]}};class Mp extends Gl{constructor(r=1,c=0){const p=(1+Math.sqrt(5))/2;super([-1,p,0,1,p,0,-1,-p,0,1,-p,0,0,-1,p,0,1,p,0,-1,-p,0,1,-p,p,0,-1,p,0,1,-p,0,-1,-p,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,c),this.type="IcosahedronGeometry",this.parameters={radius:r,detail:c}}static fromJSON(r){return new Mp(r.radius,r.detail)}}class Yf extends Gl{constructor(r=1,c=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],r,c),this.type="OctahedronGeometry",this.parameters={radius:r,detail:c}}static fromJSON(r){return new Yf(r.radius,r.detail)}}class Wu extends ee{constructor(r=.5,c=1,p=32,m=1,_=0,x=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:r,outerRadius:c,thetaSegments:p,phiSegments:m,thetaStart:_,thetaLength:x},p=Math.max(3,p);const S=[],B=[],D=[],U=[];let G=r;const V=(c-r)/(m=Math.max(1,m)),Q=new ze,q=new qt;for(let te=0;te<=m;te++){for(let K=0;K<=p;K++){const Z=_+K/p*x;Q.x=G*Math.cos(Z),Q.y=G*Math.sin(Z),B.push(Q.x,Q.y,Q.z),D.push(0,0,1),q.x=(Q.x/c+1)/2,q.y=(Q.y/c+1)/2,U.push(q.x,q.y)}G+=V}for(let te=0;te<m;te++){const K=te*(p+1);for(let Z=0;Z<p;Z++){const ae=Z+K,ce=ae,Te=ae+p+1,Ce=ae+p+2,Ie=ae+1;S.push(ce,Te,Ie),S.push(Te,Ce,Ie)}}this.setIndex(S),this.setAttribute("position",new Tn(B,3)),this.setAttribute("normal",new Tn(D,3)),this.setAttribute("uv",new Tn(U,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Wu(r.innerRadius,r.outerRadius,r.thetaSegments,r.phiSegments,r.thetaStart,r.thetaLength)}}class Kf extends ee{constructor(r=new Jh([new qt(0,.5),new qt(-.5,-.5),new qt(.5,-.5)]),c=12){super(),this.type="ShapeGeometry",this.parameters={shapes:r,curveSegments:c};const p=[],m=[],_=[],x=[];let S=0,B=0;if(Array.isArray(r)===!1)D(r);else for(let U=0;U<r.length;U++)D(r[U]),this.addGroup(S,B,U),S+=B,B=0;function D(U){const G=m.length/3,V=U.extractPoints(c);let Q=V.shape;const q=V.holes;bc.isClockWise(Q)===!1&&(Q=Q.reverse());for(let K=0,Z=q.length;K<Z;K++){const ae=q[K];bc.isClockWise(ae)===!0&&(q[K]=ae.reverse())}const te=bc.triangulateShape(Q,q);for(let K=0,Z=q.length;K<Z;K++){const ae=q[K];Q=Q.concat(ae)}for(let K=0,Z=Q.length;K<Z;K++){const ae=Q[K];m.push(ae.x,ae.y,0),_.push(0,0,1),x.push(ae.x,ae.y)}for(let K=0,Z=te.length;K<Z;K++){const ae=te[K],ce=ae[0]+G,Te=ae[1]+G,Ce=ae[2]+G;p.push(ce,Te,Ce),B+=3}}this.setIndex(p),this.setAttribute("position",new Tn(m,3)),this.setAttribute("normal",new Tn(_,3)),this.setAttribute("uv",new Tn(x,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return function(c,p){if(p.shapes=[],Array.isArray(c))for(let m=0,_=c.length;m<_;m++){const x=c[m];p.shapes.push(x.uuid)}else p.shapes.push(c.uuid);return p}(this.parameters.shapes,r)}static fromJSON(r,c){const p=[];for(let m=0,_=r.shapes.length;m<_;m++){const x=c[r.shapes[m]];p.push(x)}return new Kf(p,r.curveSegments)}}class Cp extends ee{constructor(r=1,c=32,p=16,m=0,_=2*Math.PI,x=0,S=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:r,widthSegments:c,heightSegments:p,phiStart:m,phiLength:_,thetaStart:x,thetaLength:S},c=Math.max(3,Math.floor(c)),p=Math.max(2,Math.floor(p));const B=Math.min(x+S,Math.PI);let D=0;const U=[],G=new ze,V=new ze,Q=[],q=[],te=[],K=[];for(let Z=0;Z<=p;Z++){const ae=[],ce=Z/p;let Te=0;Z===0&&x===0?Te=.5/c:Z===p&&B===Math.PI&&(Te=-.5/c);for(let Ce=0;Ce<=c;Ce++){const Ie=Ce/c;G.x=-r*Math.cos(m+Ie*_)*Math.sin(x+ce*S),G.y=r*Math.cos(x+ce*S),G.z=r*Math.sin(m+Ie*_)*Math.sin(x+ce*S),q.push(G.x,G.y,G.z),V.copy(G).normalize(),te.push(V.x,V.y,V.z),K.push(Ie+Te,1-ce),ae.push(D++)}U.push(ae)}for(let Z=0;Z<p;Z++)for(let ae=0;ae<c;ae++){const ce=U[Z][ae+1],Te=U[Z][ae],Ce=U[Z+1][ae],Ie=U[Z+1][ae+1];(Z!==0||x>0)&&Q.push(ce,Te,Ie),(Z!==p-1||B<Math.PI)&&Q.push(Te,Ce,Ie)}this.setIndex(Q),this.setAttribute("position",new Tn(q,3)),this.setAttribute("normal",new Tn(te,3)),this.setAttribute("uv",new Tn(K,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Cp(r.radius,r.widthSegments,r.heightSegments,r.phiStart,r.phiLength,r.thetaStart,r.thetaLength)}}class Jf extends Gl{constructor(r=1,c=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],r,c),this.type="TetrahedronGeometry",this.parameters={radius:r,detail:c}}static fromJSON(r){return new Jf(r.radius,r.detail)}}class Mg extends ee{constructor(r=1,c=.4,p=12,m=48,_=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:c,radialSegments:p,tubularSegments:m,arc:_},p=Math.floor(p),m=Math.floor(m);const x=[],S=[],B=[],D=[],U=new ze,G=new ze,V=new ze;for(let Q=0;Q<=p;Q++)for(let q=0;q<=m;q++){const te=q/m*_,K=Q/p*Math.PI*2;G.x=(r+c*Math.cos(K))*Math.cos(te),G.y=(r+c*Math.cos(K))*Math.sin(te),G.z=c*Math.sin(K),S.push(G.x,G.y,G.z),U.x=r*Math.cos(te),U.y=r*Math.sin(te),V.subVectors(G,U).normalize(),B.push(V.x,V.y,V.z),D.push(q/m),D.push(Q/p)}for(let Q=1;Q<=p;Q++)for(let q=1;q<=m;q++){const te=(m+1)*Q+q-1,K=(m+1)*(Q-1)+q-1,Z=(m+1)*(Q-1)+q,ae=(m+1)*Q+q;x.push(te,K,ae),x.push(K,Z,ae)}this.setIndex(x),this.setAttribute("position",new Tn(S,3)),this.setAttribute("normal",new Tn(B,3)),this.setAttribute("uv",new Tn(D,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Mg(r.radius,r.tube,r.radialSegments,r.tubularSegments,r.arc)}}class Zf extends ee{constructor(r=1,c=.4,p=64,m=8,_=2,x=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:r,tube:c,tubularSegments:p,radialSegments:m,p:_,q:x},p=Math.floor(p),m=Math.floor(m);const S=[],B=[],D=[],U=[],G=new ze,V=new ze,Q=new ze,q=new ze,te=new ze,K=new ze,Z=new ze;for(let ce=0;ce<=p;++ce){const Te=ce/p*_*Math.PI*2;ae(Te,_,x,r,Q),ae(Te+.01,_,x,r,q),K.subVectors(q,Q),Z.addVectors(q,Q),te.crossVectors(K,Z),Z.crossVectors(te,K),te.normalize(),Z.normalize();for(let Ce=0;Ce<=m;++Ce){const Ie=Ce/m*Math.PI*2,Ke=-c*Math.cos(Ie),ct=c*Math.sin(Ie);G.x=Q.x+(Ke*Z.x+ct*te.x),G.y=Q.y+(Ke*Z.y+ct*te.y),G.z=Q.z+(Ke*Z.z+ct*te.z),B.push(G.x,G.y,G.z),V.subVectors(G,Q).normalize(),D.push(V.x,V.y,V.z),U.push(ce/p),U.push(Ce/m)}}for(let ce=1;ce<=p;ce++)for(let Te=1;Te<=m;Te++){const Ce=(m+1)*(ce-1)+(Te-1),Ie=(m+1)*ce+(Te-1),Ke=(m+1)*ce+Te,ct=(m+1)*(ce-1)+Te;S.push(Ce,Ie,ct),S.push(Ie,Ke,ct)}function ae(ce,Te,Ce,Ie,Ke){const ct=Math.cos(ce),Je=Math.sin(ce),yt=Ce/Te*ce,Ze=Math.cos(yt);Ke.x=Ie*(2+Ze)*.5*ct,Ke.y=Ie*(2+Ze)*Je*.5,Ke.z=Ie*Math.sin(yt)*.5}this.setIndex(S),this.setAttribute("position",new Tn(B,3)),this.setAttribute("normal",new Tn(D,3)),this.setAttribute("uv",new Tn(U,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Zf(r.radius,r.tube,r.tubularSegments,r.radialSegments,r.p,r.q)}}class Tp extends ee{constructor(r=new yg(new ze(-1,-1,0),new ze(-1,1,0),new ze(1,1,0)),c=64,p=1,m=8,_=!1){super(),this.type="TubeGeometry",this.parameters={path:r,tubularSegments:c,radius:p,radialSegments:m,closed:_};const x=r.computeFrenetFrames(c,_);this.tangents=x.tangents,this.normals=x.normals,this.binormals=x.binormals;const S=new ze,B=new ze,D=new qt;let U=new ze;const G=[],V=[],Q=[],q=[];function te(K){U=r.getPointAt(K/c,U);const Z=x.normals[K],ae=x.binormals[K];for(let ce=0;ce<=m;ce++){const Te=ce/m*Math.PI*2,Ce=Math.sin(Te),Ie=-Math.cos(Te);B.x=Ie*Z.x+Ce*ae.x,B.y=Ie*Z.y+Ce*ae.y,B.z=Ie*Z.z+Ce*ae.z,B.normalize(),V.push(B.x,B.y,B.z),S.x=U.x+p*B.x,S.y=U.y+p*B.y,S.z=U.z+p*B.z,G.push(S.x,S.y,S.z)}}(function(){for(let K=0;K<c;K++)te(K);te(_===!1?c:0),function(){for(let K=0;K<=c;K++)for(let Z=0;Z<=m;Z++)D.x=K/c,D.y=Z/m,Q.push(D.x,D.y)}(),function(){for(let K=1;K<=c;K++)for(let Z=1;Z<=m;Z++){const ae=(m+1)*(K-1)+(Z-1),ce=(m+1)*K+(Z-1),Te=(m+1)*K+Z,Ce=(m+1)*(K-1)+Z;q.push(ae,ce,Ce),q.push(ce,Te,Ce)}}()})(),this.setIndex(q),this.setAttribute("position",new Tn(G,3)),this.setAttribute("normal",new Tn(V,3)),this.setAttribute("uv",new Tn(Q,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return r.path=this.parameters.path.toJSON(),r}static fromJSON(r){return new Tp(new vy[r.path.type]().fromJSON(r.path),r.tubularSegments,r.radius,r.radialSegments,r.closed)}}class $f extends ee{constructor(r=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:r},r!==null){const c=[],p=new Set,m=new ze,_=new ze;if(r.index!==null){const x=r.attributes.position,S=r.index;let B=r.groups;B.length===0&&(B=[{start:0,count:S.count,materialIndex:0}]);for(let D=0,U=B.length;D<U;++D){const G=B[D],V=G.start;for(let Q=V,q=V+G.count;Q<q;Q+=3)for(let te=0;te<3;te++){const K=S.getX(Q+te),Z=S.getX(Q+(te+1)%3);m.fromBufferAttribute(x,K),_.fromBufferAttribute(x,Z),w_(m,_,p)===!0&&(c.push(m.x,m.y,m.z),c.push(_.x,_.y,_.z))}}}else{const x=r.attributes.position;for(let S=0,B=x.count/3;S<B;S++)for(let D=0;D<3;D++){const U=3*S+D,G=3*S+(D+1)%3;m.fromBufferAttribute(x,U),_.fromBufferAttribute(x,G),w_(m,_,p)===!0&&(c.push(m.x,m.y,m.z),c.push(_.x,_.y,_.z))}}this.setAttribute("position",new Tn(c,3))}}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}}function w_(b,r,c){const p=`${b.x},${b.y},${b.z}-${r.x},${r.y},${r.z}`,m=`${r.x},${r.y},${r.z}-${b.x},${b.y},${b.z}`;return c.has(p)!==!0&&c.has(m)!==!0&&(c.add(p),c.add(m),!0)}var em=Object.freeze({__proto__:null,BoxGeometry:Ul,CapsuleGeometry:bp,CircleGeometry:Gu,ConeGeometry:Hu,CylinderGeometry:Yh,DodecahedronGeometry:xp,EdgesGeometry:__,ExtrudeGeometry:Sp,IcosahedronGeometry:Mp,LatheGeometry:Ap,OctahedronGeometry:Yf,PlaneGeometry:al,PolyhedronGeometry:Gl,RingGeometry:Wu,ShapeGeometry:Kf,SphereGeometry:Cp,TetrahedronGeometry:Jf,TorusGeometry:Mg,TorusKnotGeometry:Zf,TubeGeometry:Tp,WireframeGeometry:$f});class Cg extends Ss{constructor(r){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new En(0),this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.fog=r.fog,this}}class E_ extends gc{constructor(r){super(r),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class wy extends Ss{constructor(r){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new En(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new En(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=So,this.normalScale=new qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.defines={STANDARD:""},this.color.copy(r.color),this.roughness=r.roughness,this.metalness=r.metalness,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.roughnessMap=r.roughnessMap,this.metalnessMap=r.metalnessMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapIntensity=r.envMapIntensity,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class Xb extends wy{constructor(r){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new qt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Hn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(c){this.ior=(1+.4*c)/(1-.4*c)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new En(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new En(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new En(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(r)}get sheen(){return this._sheen}set sheen(r){this._sheen>0!=r>0&&this.version++,this._sheen=r}get clearcoat(){return this._clearcoat}set clearcoat(r){this._clearcoat>0!=r>0&&this.version++,this._clearcoat=r}get iridescence(){return this._iridescence}set iridescence(r){this._iridescence>0!=r>0&&this.version++,this._iridescence=r}get transmission(){return this._transmission}set transmission(r){this._transmission>0!=r>0&&this.version++,this._transmission=r}copy(r){return super.copy(r),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=r.clearcoat,this.clearcoatMap=r.clearcoatMap,this.clearcoatRoughness=r.clearcoatRoughness,this.clearcoatRoughnessMap=r.clearcoatRoughnessMap,this.clearcoatNormalMap=r.clearcoatNormalMap,this.clearcoatNormalScale.copy(r.clearcoatNormalScale),this.ior=r.ior,this.iridescence=r.iridescence,this.iridescenceMap=r.iridescenceMap,this.iridescenceIOR=r.iridescenceIOR,this.iridescenceThicknessRange=[...r.iridescenceThicknessRange],this.iridescenceThicknessMap=r.iridescenceThicknessMap,this.sheen=r.sheen,this.sheenColor.copy(r.sheenColor),this.sheenColorMap=r.sheenColorMap,this.sheenRoughness=r.sheenRoughness,this.sheenRoughnessMap=r.sheenRoughnessMap,this.transmission=r.transmission,this.transmissionMap=r.transmissionMap,this.thickness=r.thickness,this.thicknessMap=r.thicknessMap,this.attenuationDistance=r.attenuationDistance,this.attenuationColor.copy(r.attenuationColor),this.specularIntensity=r.specularIntensity,this.specularIntensityMap=r.specularIntensityMap,this.specularColor.copy(r.specularColor),this.specularColorMap=r.specularColorMap,this}}class Yb extends Ss{constructor(r){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new En(16777215),this.specular=new En(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new En(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=So,this.normalScale=new qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ci,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.specular.copy(r.specular),this.shininess=r.shininess,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class Ey extends Ss{constructor(r){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new En(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new En(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=So,this.normalScale=new qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.gradientMap=r.gradientMap,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}}class Kb extends Ss{constructor(r){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=So,this.normalScale=new qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.flatShading=r.flatShading,this}}class Sy extends Ss{constructor(r){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new En(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new En(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=So,this.normalScale=new qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ci,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class Jb extends Ss{constructor(r){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new En(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=So,this.normalScale=new qt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.defines={MATCAP:""},this.color.copy(r.color),this.matcap=r.matcap,this.map=r.map,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.flatShading=r.flatShading,this.fog=r.fog,this}}class My extends ao{constructor(r){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(r)}copy(r){return super.copy(r),this.scale=r.scale,this.dashSize=r.dashSize,this.gapSize=r.gapSize,this}}function Hl(b,r,c){return Zh(b)?new b.constructor(b.subarray(r,c!==void 0?c:b.length)):b.slice(r,c)}function nu(b,r,c){return!b||!c&&b.constructor===r?b:typeof r.BYTES_PER_ELEMENT=="number"?new r(b):Array.prototype.slice.call(b)}function Zh(b){return ArrayBuffer.isView(b)&&!(b instanceof DataView)}function S_(b){const r=b.length,c=new Array(r);for(let p=0;p!==r;++p)c[p]=p;return c.sort(function(p,m){return b[p]-b[m]}),c}function M_(b,r,c){const p=b.length,m=new b.constructor(p);for(let _=0,x=0;x!==p;++_){const S=c[_]*r;for(let B=0;B!==r;++B)m[x++]=b[S+B]}return m}function Tg(b,r,c,p){let m=1,_=b[0];for(;_!==void 0&&_[p]===void 0;)_=b[m++];if(_===void 0)return;let x=_[p];if(x!==void 0)if(Array.isArray(x))do x=_[p],x!==void 0&&(r.push(_.time),c.push.apply(c,x)),_=b[m++];while(_!==void 0);else if(x.toArray!==void 0)do x=_[p],x!==void 0&&(r.push(_.time),x.toArray(c,c.length)),_=b[m++];while(_!==void 0);else do x=_[p],x!==void 0&&(r.push(_.time),c.push(x)),_=b[m++];while(_!==void 0)}const tm={arraySlice:Hl,convertArray:nu,isTypedArray:Zh,getKeyframeOrder:S_,sortedArray:M_,flattenJSON:Tg,subclip:function(b,r,c,p,m=30){const _=b.clone();_.name=r;const x=[];for(let B=0;B<_.tracks.length;++B){const D=_.tracks[B],U=D.getValueSize(),G=[],V=[];for(let Q=0;Q<D.times.length;++Q){const q=D.times[Q]*m;if(!(q<c||q>=p)){G.push(D.times[Q]);for(let te=0;te<U;++te)V.push(D.values[Q*U+te])}}G.length!==0&&(D.times=nu(G,D.times.constructor),D.values=nu(V,D.values.constructor),x.push(D))}_.tracks=x;let S=1/0;for(let B=0;B<_.tracks.length;++B)S>_.tracks[B].times[0]&&(S=_.tracks[B].times[0]);for(let B=0;B<_.tracks.length;++B)_.tracks[B].shift(-1*S);return _.resetDuration(),_},makeClipAdditive:function(b,r=0,c=b,p=30){p<=0&&(p=30);const m=c.tracks.length,_=r/p;for(let x=0;x<m;++x){const S=c.tracks[x],B=S.ValueTypeName;if(B==="bool"||B==="string")continue;const D=b.tracks.find(function(Z){return Z.name===S.name&&Z.ValueTypeName===B});if(D===void 0)continue;let U=0;const G=S.getValueSize();S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(U=G/3);let V=0;const Q=D.getValueSize();D.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(V=Q/3);const q=S.times.length-1;let te;if(_<=S.times[0]){const Z=U,ae=G-U;te=Hl(S.values,Z,ae)}else if(_>=S.times[q]){const Z=q*G+U,ae=Z+G-U;te=Hl(S.values,Z,ae)}else{const Z=S.createInterpolant(),ae=U,ce=G-U;Z.evaluate(_),te=Hl(Z.resultBuffer,ae,ce)}B==="quaternion"&&new Fa().fromArray(te).normalize().conjugate().toArray(te);const K=D.times.length;for(let Z=0;Z<K;++Z){const ae=Z*Q+V;if(B==="quaternion")Fa.multiplyQuaternionsFlat(D.values,ae,te,0,D.values,ae);else{const ce=Q-2*V;for(let Te=0;Te<ce;++Te)D.values[ae+Te]-=te[Te]}}}return b.blendMode=Ki,b}};class xr{constructor(r,c,p,m){this.parameterPositions=r,this._cachedIndex=0,this.resultBuffer=m!==void 0?m:new c.constructor(p),this.sampleValues=c,this.valueSize=p,this.settings=null,this.DefaultSettings_={}}evaluate(r){const c=this.parameterPositions;let p=this._cachedIndex,m=c[p],_=c[p-1];e:{t:{let x;n:{i:if(!(r<m)){for(let S=p+2;;){if(m===void 0){if(r<_)break i;return p=c.length,this._cachedIndex=p,this.copySampleValue_(p-1)}if(p===S)break;if(_=m,m=c[++p],r<m)break t}x=c.length;break n}if(r>=_)break e;{const S=c[1];r<S&&(p=2,_=S);for(let B=p-2;;){if(_===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(p===B)break;if(m=_,_=c[--p-1],r>=_)break t}x=p,p=0}}for(;p<x;){const S=p+x>>>1;r<c[S]?x=S:p=S+1}if(m=c[p],_=c[p-1],_===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(m===void 0)return p=c.length,this._cachedIndex=p,this.copySampleValue_(p-1)}this._cachedIndex=p,this.intervalChanged_(p,_,m)}return this.interpolate_(p,_,r,m)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(r){const c=this.resultBuffer,p=this.sampleValues,m=this.valueSize,_=r*m;for(let x=0;x!==m;++x)c[x]=p[_+x];return c}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Zb extends xr{constructor(r,c,p,m){super(r,c,p,m),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Fc,endingEnd:Fc}}intervalChanged_(r,c,p){const m=this.parameterPositions;let _=r-2,x=r+1,S=m[_],B=m[x];if(S===void 0)switch(this.getSettings_().endingStart){case cc:_=r,S=2*c-p;break;case Ah:_=m.length-2,S=c+m[_]-m[_+1];break;default:_=r,S=p}if(B===void 0)switch(this.getSettings_().endingEnd){case cc:x=r,B=2*p-c;break;case Ah:x=1,B=p+m[1]-m[0];break;default:x=r-1,B=c}const D=.5*(p-c),U=this.valueSize;this._weightPrev=D/(c-S),this._weightNext=D/(B-p),this._offsetPrev=_*U,this._offsetNext=x*U}interpolate_(r,c,p,m){const _=this.resultBuffer,x=this.sampleValues,S=this.valueSize,B=r*S,D=B-S,U=this._offsetPrev,G=this._offsetNext,V=this._weightPrev,Q=this._weightNext,q=(p-c)/(m-c),te=q*q,K=te*q,Z=-V*K+2*V*te-V*q,ae=(1+V)*K+(-1.5-2*V)*te+(-.5+V)*q+1,ce=(-1-Q)*K+(1.5+Q)*te+.5*q,Te=Q*K-Q*te;for(let Ce=0;Ce!==S;++Ce)_[Ce]=Z*x[U+Ce]+ae*x[D+Ce]+ce*x[B+Ce]+Te*x[G+Ce];return _}}class sa extends xr{constructor(r,c,p,m){super(r,c,p,m)}interpolate_(r,c,p,m){const _=this.resultBuffer,x=this.sampleValues,S=this.valueSize,B=r*S,D=B-S,U=(p-c)/(m-c),G=1-U;for(let V=0;V!==S;++V)_[V]=x[D+V]*G+x[B+V]*U;return _}}class ar extends xr{constructor(r,c,p,m){super(r,c,p,m)}interpolate_(r){return this.copySampleValue_(r-1)}}class oo{constructor(r,c,p,m){if(r===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(c===void 0||c.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+r);this.name=r,this.times=nu(c,this.TimeBufferType),this.values=nu(p,this.ValueBufferType),this.setInterpolation(m||this.DefaultInterpolation)}static toJSON(r){const c=r.constructor;let p;if(c.toJSON!==this.toJSON)p=c.toJSON(r);else{p={name:r.name,times:nu(r.times,Array),values:nu(r.values,Array)};const m=r.getInterpolation();m!==r.DefaultInterpolation&&(p.interpolation=m)}return p.type=r.ValueTypeName,p}InterpolantFactoryMethodDiscrete(r){return new ar(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodLinear(r){return new sa(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodSmooth(r){return new Zb(this.times,this.values,this.getValueSize(),r)}setInterpolation(r){let c;switch(r){case Vn:c=this.InterpolantFactoryMethodDiscrete;break;case Ml:c=this.InterpolantFactoryMethodLinear;break;case mu:c=this.InterpolantFactoryMethodSmooth}if(c===void 0){const p="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(r===this.DefaultInterpolation)throw new Error(p);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",p),this}return this.createInterpolant=c,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Vn;case this.InterpolantFactoryMethodLinear:return Ml;case this.InterpolantFactoryMethodSmooth:return mu}}getValueSize(){return this.values.length/this.times.length}shift(r){if(r!==0){const c=this.times;for(let p=0,m=c.length;p!==m;++p)c[p]+=r}return this}scale(r){if(r!==1){const c=this.times;for(let p=0,m=c.length;p!==m;++p)c[p]*=r}return this}trim(r,c){const p=this.times,m=p.length;let _=0,x=m-1;for(;_!==m&&p[_]<r;)++_;for(;x!==-1&&p[x]>c;)--x;if(++x,_!==0||x!==m){_>=x&&(x=Math.max(x,1),_=x-1);const S=this.getValueSize();this.times=Hl(p,_,x),this.values=Hl(this.values,_*S,x*S)}return this}validate(){let r=!0;const c=this.getValueSize();c-Math.floor(c)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);const p=this.times,m=this.values,_=p.length;_===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let x=null;for(let S=0;S!==_;S++){const B=p[S];if(typeof B=="number"&&isNaN(B)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,S,B),r=!1;break}if(x!==null&&x>B){console.error("THREE.KeyframeTrack: Out of order keys.",this,S,B,x),r=!1;break}x=B}if(m!==void 0&&Zh(m))for(let S=0,B=m.length;S!==B;++S){const D=m[S];if(isNaN(D)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,S,D),r=!1;break}}return r}optimize(){const r=Hl(this.times),c=Hl(this.values),p=this.getValueSize(),m=this.getInterpolation()===mu,_=r.length-1;let x=1;for(let S=1;S<_;++S){let B=!1;const D=r[S];if(D!==r[S+1]&&(S!==1||D!==r[0]))if(m)B=!0;else{const U=S*p,G=U-p,V=U+p;for(let Q=0;Q!==p;++Q){const q=c[U+Q];if(q!==c[G+Q]||q!==c[V+Q]){B=!0;break}}}if(B){if(S!==x){r[x]=r[S];const U=S*p,G=x*p;for(let V=0;V!==p;++V)c[G+V]=c[U+V]}++x}}if(_>0){r[x]=r[_];for(let S=_*p,B=x*p,D=0;D!==p;++D)c[B+D]=c[S+D];++x}return x!==r.length?(this.times=Hl(r,0,x),this.values=Hl(c,0,x*p)):(this.times=r,this.values=c),this}clone(){const r=Hl(this.times,0),c=Hl(this.values,0),p=new this.constructor(this.name,r,c);return p.createInterpolant=this.createInterpolant,p}}oo.prototype.TimeBufferType=Float32Array,oo.prototype.ValueBufferType=Float32Array,oo.prototype.DefaultInterpolation=Ml;class xc extends oo{}xc.prototype.ValueTypeName="bool",xc.prototype.ValueBufferType=Array,xc.prototype.DefaultInterpolation=Vn,xc.prototype.InterpolantFactoryMethodLinear=void 0,xc.prototype.InterpolantFactoryMethodSmooth=void 0;class Cy extends oo{}Cy.prototype.ValueTypeName="color";class nm extends oo{}nm.prototype.ValueTypeName="number";class $b extends xr{constructor(r,c,p,m){super(r,c,p,m)}interpolate_(r,c,p,m){const _=this.resultBuffer,x=this.sampleValues,S=this.valueSize,B=(p-c)/(m-c);let D=r*S;for(let U=D+S;D!==U;D+=4)Fa.slerpFlat(_,0,x,D-S,x,D,B);return _}}class iu extends oo{InterpolantFactoryMethodLinear(r){return new $b(this.times,this.values,this.getValueSize(),r)}}iu.prototype.ValueTypeName="quaternion",iu.prototype.DefaultInterpolation=Ml,iu.prototype.InterpolantFactoryMethodSmooth=void 0;class ru extends oo{}ru.prototype.ValueTypeName="string",ru.prototype.ValueBufferType=Array,ru.prototype.DefaultInterpolation=Vn,ru.prototype.InterpolantFactoryMethodLinear=void 0,ru.prototype.InterpolantFactoryMethodSmooth=void 0;class wc extends oo{}wc.prototype.ValueTypeName="vector";class qu{constructor(r,c=-1,p,m=mf){this.name=r,this.tracks=p,this.duration=c,this.blendMode=m,this.uuid=Ua(),this.duration<0&&this.resetDuration()}static parse(r){const c=[],p=r.tracks,m=1/(r.fps||1);for(let x=0,S=p.length;x!==S;++x)c.push($h(p[x]).scale(m));const _=new this(r.name,r.duration,c,r.blendMode);return _.uuid=r.uuid,_}static toJSON(r){const c=[],p=r.tracks,m={name:r.name,duration:r.duration,tracks:c,uuid:r.uuid,blendMode:r.blendMode};for(let _=0,x=p.length;_!==x;++_)c.push(oo.toJSON(p[_]));return m}static CreateFromMorphTargetSequence(r,c,p,m){const _=c.length,x=[];for(let S=0;S<_;S++){let B=[],D=[];B.push((S+_-1)%_,S,(S+1)%_),D.push(0,1,0);const U=S_(B);B=M_(B,1,U),D=M_(D,1,U),m||B[0]!==0||(B.push(_),D.push(D[0])),x.push(new nm(".morphTargetInfluences["+c[S].name+"]",B,D).scale(1/p))}return new this(r,-1,x)}static findByName(r,c){let p=r;if(!Array.isArray(r)){const m=r;p=m.geometry&&m.geometry.animations||m.animations}for(let m=0;m<p.length;m++)if(p[m].name===c)return p[m];return null}static CreateClipsFromMorphTargetSequences(r,c,p){const m={},_=/^([\w-]*?)([\d]+)$/;for(let S=0,B=r.length;S<B;S++){const D=r[S],U=D.name.match(_);if(U&&U.length>1){const G=U[1];let V=m[G];V||(m[G]=V=[]),V.push(D)}}const x=[];for(const S in m)x.push(this.CreateFromMorphTargetSequence(S,m[S],c,p));return x}static parseAnimation(r,c){if(!r)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const p=function(U,G,V,Q,q){if(V.length!==0){const te=[],K=[];Tg(V,te,K,Q),te.length!==0&&q.push(new U(G,te,K))}},m=[],_=r.name||"default",x=r.fps||30,S=r.blendMode;let B=r.length||-1;const D=r.hierarchy||[];for(let U=0;U<D.length;U++){const G=D[U].keys;if(G&&G.length!==0)if(G[0].morphTargets){const V={};let Q;for(Q=0;Q<G.length;Q++)if(G[Q].morphTargets)for(let q=0;q<G[Q].morphTargets.length;q++)V[G[Q].morphTargets[q]]=-1;for(const q in V){const te=[],K=[];for(let Z=0;Z!==G[Q].morphTargets.length;++Z){const ae=G[Q];te.push(ae.time),K.push(ae.morphTarget===q?1:0)}m.push(new nm(".morphTargetInfluence["+q+"]",te,K))}B=V.length*x}else{const V=".bones["+c[U].name+"]";p(wc,V+".position",G,"pos",m),p(iu,V+".quaternion",G,"rot",m),p(wc,V+".scale",G,"scl",m)}}return m.length===0?null:new this(_,B,m,S)}resetDuration(){let r=0;for(let c=0,p=this.tracks.length;c!==p;++c){const m=this.tracks[c];r=Math.max(r,m.times[m.times.length-1])}return this.duration=r,this}trim(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].trim(0,this.duration);return this}validate(){let r=!0;for(let c=0;c<this.tracks.length;c++)r=r&&this.tracks[c].validate();return r}optimize(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].optimize();return this}clone(){const r=[];for(let c=0;c<this.tracks.length;c++)r.push(this.tracks[c].clone());return new this.constructor(this.name,this.duration,r,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function $h(b){if(b.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const r=function(c){switch(c.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return nm;case"vector":case"vector2":case"vector3":case"vector4":return wc;case"color":return Cy;case"quaternion":return iu;case"bool":case"boolean":return xc;case"string":return ru}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+c)}(b.type);if(b.times===void 0){const c=[],p=[];Tg(b.keys,c,p,"value"),b.times=c,b.values=p}return r.parse!==void 0?r.parse(b):new r(b.name,b.times,b.values,b.interpolation)}const os={enabled:!1,files:{},add:function(b,r){this.enabled!==!1&&(this.files[b]=r)},get:function(b,r){return this.enabled===!1?r?Promise.resolve():void 0:r?Promise.resolve(this.files[b]):this.files[b]},remove:function(b){delete this.files[b]},clear:function(){this.files={}}};class C_{constructor(r,c,p){const m=this;let _,x=!1,S=0,B=0;const D=[];this.onStart=void 0,this.onLoad=r,this.onProgress=c,this.onError=p,this.itemStart=function(U){B++,x===!1&&m.onStart!==void 0&&m.onStart(U,S,B),x=!0},this.itemEnd=function(U){S++,m.onProgress!==void 0&&m.onProgress(U,S,B),S===B&&(x=!1,m.onLoad!==void 0&&m.onLoad())},this.itemError=function(U){m.onError!==void 0&&m.onError(U)},this.resolveURL=function(U){return _?_(U):U},this.setURLModifier=function(U){return _=U,this},this.addHandler=function(U,G){return D.push(U,G),this},this.removeHandler=function(U){const G=D.indexOf(U);return G!==-1&&D.splice(G,2),this},this.getHandler=function(U){for(let G=0,V=D.length;G<V;G+=2){const Q=D[G],q=D[G+1];if(Q.global&&(Q.lastIndex=0),Q.test(U))return q}return null}}}const Ig=new C_;class dl{constructor(r){this.manager=r!==void 0?r:Ig,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,c){const p=this;return new Promise(function(m,_){p.load(r,m,c,_)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}}const pl={};class ed extends Error{constructor(r,c){super(r),this.response=c}}class Ha extends dl{constructor(r){super(r),this.responseType="text",this.useCache=!0}load(r,c,p,m){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r),(this.useCache?os.get(r,this.responseType,this.mimeType):Promise.resolve(void 0)).then(_=>{if(_!==void 0)return this.manager.itemStart(r),setTimeout(()=>{c&&c(_),this.manager.itemEnd(r)},0),_;if(pl[r]!==void 0)return void pl[r].push({onLoad:c,onProgress:p,onError:m});pl[r]=[],pl[r].push({onLoad:c,onProgress:p,onError:m});const x=new Request(r,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),S=this.mimeType,B=this.responseType;fetch(x).then(D=>{if(D.status===200||D.status===0){if(D.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||D.body===void 0||D.body.getReader===void 0)return D;const U=pl[r],G=D.body.getReader(),V=D.headers.get("Content-Length")||D.headers.get("X-File-Size"),Q=V?parseInt(V):0,q=Q!==0;let te=0;const K=new ReadableStream({start(Z){(function ae(){G.read().then(({done:ce,value:Te})=>{if(ce)Z.close();else{te+=Te.byteLength;const Ce=new ProgressEvent("progress",{lengthComputable:q,loaded:te,total:Q});for(let Ie=0,Ke=U.length;Ie<Ke;Ie++){const ct=U[Ie];ct.onProgress&&ct.onProgress(Ce)}Z.enqueue(Te),ae()}})})()}});return new Response(K)}throw new ed(`fetch for "${D.url}" responded with ${D.status}: ${D.statusText}`,D)}).then(D=>{switch(B){case"arraybuffer":return D.arrayBuffer();case"blob":return D.blob();case"document":return D.text().then(U=>new DOMParser().parseFromString(U,S));case"json":return D.json();default:if(S===void 0)return D.text();{const U=/charset="?([^;"\s]*)"?/i.exec(S),G=U&&U[1]?U[1].toLowerCase():void 0,V=new TextDecoder(G);return D.arrayBuffer().then(Q=>V.decode(Q))}}}).then(D=>{this.useCache&&os.add(r,D,this.responseType);const U=pl[r];delete pl[r];for(let G=0,V=U.length;G<V;G++){const Q=U[G];Q.onLoad&&Q.onLoad(D)}}).catch(D=>{const U=pl[r];if(U===void 0)throw this.manager.itemError(r),D;delete pl[r];for(let G=0,V=U.length;G<V;G++){const Q=U[G];Q.onError&&Q.onError(D)}this.manager.itemError(r)}).finally(()=>{this.useCache&&this.manager.itemEnd(r)}),this.useCache&&this.manager.itemStart(r)})}setResponseType(r){return this.responseType=r,this}setMimeType(r){return this.mimeType=r,this}}class Xu extends dl{constructor(r){super(r)}load(r,c,p,m){const _=this,x=new Ha(this.manager);x.setPath(this.path),x.setRequestHeader(this.requestHeader),x.setWithCredentials(this.withCredentials),x.load(r,function(S){try{c(_.parse(JSON.parse(S)))}catch(B){m?m(B):console.error(B),_.manager.itemError(r)}},p,m)}parse(r){const c=[];for(let p=0;p<r.length;p++){const m=qu.parse(r[p]);c.push(m)}return c}}class Ty extends dl{constructor(r){super(r)}load(r,c,p,m){const _=this,x=[],S=new vg,B=new Ha(this.manager);B.setPath(this.path),B.setResponseType("arraybuffer"),B.setRequestHeader(this.requestHeader),B.setWithCredentials(_.withCredentials);let D=0;function U(G){B.load(r[G],function(V){const Q=_.parse(V,!0);x[G]={width:Q.width,height:Q.height,format:Q.format,mipmaps:Q.mipmaps},D+=1,D===6&&(Q.mipmapCount===1&&(S.minFilter=Cr),S.image=x,S.format=Q.format,S.needsUpdate=!0,c&&c(S))},p,m)}if(Array.isArray(r))for(let G=0,V=r.length;G<V;++G)U(G);else B.load(r,function(G){const V=_.parse(G,!0);if(V.isCubemap){const Q=V.mipmaps.length/V.mipmapCount;for(let q=0;q<Q;q++){x[q]={mipmaps:[]};for(let te=0;te<V.mipmapCount;te++)x[q].mipmaps.push(V.mipmaps[q*V.mipmapCount+te]),x[q].format=V.format,x[q].width=V.width,x[q].height=V.height}S.image=x}else S.image.width=V.width,S.image.height=V.height,S.mipmaps=V.mipmaps;V.mipmapCount===1&&(S.minFilter=Cr),S.format=V.format,S.needsUpdate=!0,c&&c(S)},p,m);return S}}class ls extends dl{constructor(r){super(r)}load(r,c,p,m){const _=r;this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const x=this,S=os.get(r);if(S!==void 0)return x.manager.itemStart(r),setTimeout(function(){c&&c(S),x.manager.itemEnd(r)},0),S;const B=Mh("img");function D(){G(),os.add(r,this),c&&c(this),x.manager.itemEnd(r)}function U(V){G(),m&&m(V),x.manager.itemError(r),x.manager.itemEnd(r)}function G(){B.removeEventListener("load",D,!1),B.removeEventListener("error",U,!1)}return B.addEventListener("load",D,!1),B.addEventListener("error",U,!1),r.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(B.crossOrigin=this.crossOrigin),x.manager.itemStart(r),os.get(r,"blob").then(V=>{if(V!==void 0&&!V.type.startsWith("text/plain"))return V.type||(r.endsWith(".svg")||r.startsWith("data:image/svg"))&&(V=new Blob([V],{type:"image/svg+xml"})),void(B.src=URL.createObjectURL(V));const Q=new Ha(this.manager);Q.useCache=!1,Q.setPath(this.path),Q.setCrossOrigin(this.crossOrigin),Q.setResponseType("blob"),Q.load(_,function(q){q.type||(r.endsWith(".svg")||r.startsWith("data:image/svg"))&&(q=new Blob([q],{type:"image/svg+xml"})),os.add(r,q,"blob"),B.src=URL.createObjectURL(q)},p,q=>{G(),m&&m(q)})}),B}}class Iy extends dl{constructor(r){super(r)}load(r,c,p,m){const _=new np,x=new ls(this.manager);x.setCrossOrigin(this.crossOrigin),x.setPath(this.path);let S=0;function B(D){x.load(r[D],function(U){_.images[D]=U,S++,S===6&&(_.needsUpdate=!0,c&&c(_))},void 0,m)}for(let D=0;D<r.length;++D)B(D);return _}}class ex extends dl{constructor(r){super(r)}load(r,c,p,m){const _=this,x=new Vf,S=new Ha(this.manager);return S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(_.withCredentials),S.load(r,function(B){const D=_.parse(B);D&&(D.image!==void 0?x.image=D.image:D.data!==void 0&&(x.image.width=D.width,x.image.height=D.height,x.image.data=D.data,x.image.complete=!0),x.wrapS=D.wrapS!==void 0?D.wrapS:Mr,x.wrapT=D.wrapT!==void 0?D.wrapT:Mr,x.magFilter=D.magFilter!==void 0?D.magFilter:Cr,x.minFilter=D.minFilter!==void 0?D.minFilter:Cr,x.anisotropy=D.anisotropy!==void 0?D.anisotropy:1,D.colorSpace!==void 0?x.colorSpace=D.colorSpace:D.encoding!==void 0&&(x.encoding=D.encoding),D.flipY!==void 0&&(x.flipY=D.flipY),D.format!==void 0&&(x.format=D.format),D.type!==void 0&&(x.type=D.type),D.mipmaps!==void 0&&(x.mipmaps=D.mipmaps,x.minFilter=ds),D.mipmapCount===1&&(x.minFilter=Cr),D.generateMipmaps!==void 0&&(x.generateMipmaps=D.generateMipmaps),x.needsUpdate=!0,c&&c(x,D))},p,m),x}}class T_ extends dl{constructor(r){super(r)}load(r,c,p,m){const _=new pr,x=new ls(this.manager);return x.setCrossOrigin(this.crossOrigin),x.setPath(this.path),x.load(r,function(S){_.image=S,_.needsUpdate=!0,c!==void 0&&c(_)},p,m),_}}class lo extends Vi{constructor(r,c=1){super(),this.isLight=!0,this.type="Light",this.color=new En(r),this.intensity=c}dispose(){}copy(r,c){return super.copy(r,c),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const c=super.toJSON(r);return c.object.color=this.color.getHex(),c.object.intensity=this.intensity,this.groundColor!==void 0&&(c.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(c.object.distance=this.distance),this.angle!==void 0&&(c.object.angle=this.angle),this.decay!==void 0&&(c.object.decay=this.decay),this.penumbra!==void 0&&(c.object.penumbra=this.penumbra),this.shadow!==void 0&&(c.object.shadow=this.shadow.toJSON()),c}}class co extends lo{constructor(r,c,p){super(r,p),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Vi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new En(c)}copy(r,c){return super.copy(r,c),this.groundColor.copy(r.groundColor),this}}const I_=new _i,jo=new ze,P_=new ze;class Py{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new qt(512,512),this.map=null,this.mapPass=null,this.matrix=new _i,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Jm,this._frameExtents=new qt(1,1),this._viewportCount=1,this._viewports=[new Ji(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const c=this.camera,p=this.matrix;jo.setFromMatrixPosition(r.matrixWorld),c.position.copy(jo),P_.setFromMatrixPosition(r.target.matrixWorld),c.lookAt(P_),c.updateMatrixWorld(),I_.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(I_),p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(I_)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.normalBias=r.normalBias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}}class cE extends Py{constructor(){super(new xa(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(r){const c=this.camera,p=2*Io*r.angle*this.focus,m=this.mapSize.width/this.mapSize.height,_=r.distance||c.far;p===c.fov&&m===c.aspect&&_===c.far||(c.fov=p,c.aspect=m,c.far=_,c.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}}class Ry extends lo{constructor(r,c,p=0,m=Math.PI/3,_=0,x=2){super(r,c),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Vi.DEFAULT_UP),this.updateMatrix(),this.target=new Vi,this.distance=p,this.angle=m,this.penumbra=_,this.decay=x,this.map=null,this.shadow=new cE}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r,c){return super.copy(r,c),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}const im=new _i,td=new ze,uo=new ze;class uE extends Py{constructor(){super(new xa(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new qt(4,2),this._viewportCount=6,this._viewports=[new Ji(2,1,1,1),new Ji(0,1,1,1),new Ji(3,1,1,1),new Ji(1,1,1,1),new Ji(3,0,1,1),new Ji(1,0,1,1)],this._cubeDirections=[new ze(1,0,0),new ze(-1,0,0),new ze(0,0,1),new ze(0,0,-1),new ze(0,1,0),new ze(0,-1,0)],this._cubeUps=[new ze(0,1,0),new ze(0,1,0),new ze(0,1,0),new ze(0,1,0),new ze(0,0,1),new ze(0,0,-1)]}updateMatrices(r,c=0){const p=this.camera,m=this.matrix,_=r.distance||p.far;_!==p.far&&(p.far=_,p.updateProjectionMatrix()),td.setFromMatrixPosition(r.matrixWorld),p.position.copy(td),uo.copy(p.position),uo.add(this._cubeDirections[c]),p.up.copy(this._cubeUps[c]),p.lookAt(uo),p.updateMatrixWorld(),m.makeTranslation(-td.x,-td.y,-td.z),im.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),this._frustum.setFromProjectionMatrix(im)}}class Ip extends lo{constructor(r,c,p=0,m=2){super(r,c),this.isPointLight=!0,this.type="PointLight",this.distance=p,this.decay=m,this.shadow=new uE}get power(){return 4*this.intensity*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r,c){return super.copy(r,c),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}}class tx extends Py{constructor(){super(new jv(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Dy extends lo{constructor(r,c){super(r,c),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Vi.DEFAULT_UP),this.updateMatrix(),this.target=new Vi,this.shadow=new tx}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}class Pg extends lo{constructor(r,c){super(r,c),this.isAmbientLight=!0,this.type="AmbientLight"}}class By extends lo{constructor(r,c,p=10,m=10){super(r,c),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=p,this.height=m}get power(){return this.intensity*this.width*this.height*Math.PI}set power(r){this.intensity=r/(this.width*this.height*Math.PI)}copy(r){return super.copy(r),this.width=r.width,this.height=r.height,this}toJSON(r){const c=super.toJSON(r);return c.object.width=this.width,c.object.height=this.height,c}}class R_{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let r=0;r<9;r++)this.coefficients.push(new ze)}set(r){for(let c=0;c<9;c++)this.coefficients[c].copy(r[c]);return this}zero(){for(let r=0;r<9;r++)this.coefficients[r].set(0,0,0);return this}getAt(r,c){const p=r.x,m=r.y,_=r.z,x=this.coefficients;return c.copy(x[0]).multiplyScalar(.282095),c.addScaledVector(x[1],.488603*m),c.addScaledVector(x[2],.488603*_),c.addScaledVector(x[3],.488603*p),c.addScaledVector(x[4],p*m*1.092548),c.addScaledVector(x[5],m*_*1.092548),c.addScaledVector(x[6],.315392*(3*_*_-1)),c.addScaledVector(x[7],p*_*1.092548),c.addScaledVector(x[8],.546274*(p*p-m*m)),c}getIrradianceAt(r,c){const p=r.x,m=r.y,_=r.z,x=this.coefficients;return c.copy(x[0]).multiplyScalar(.886227),c.addScaledVector(x[1],1.023328*m),c.addScaledVector(x[2],1.023328*_),c.addScaledVector(x[3],1.023328*p),c.addScaledVector(x[4],.858086*p*m),c.addScaledVector(x[5],.858086*m*_),c.addScaledVector(x[6],.743125*_*_-.247708),c.addScaledVector(x[7],.858086*p*_),c.addScaledVector(x[8],.429043*(p*p-m*m)),c}add(r){for(let c=0;c<9;c++)this.coefficients[c].add(r.coefficients[c]);return this}addScaledSH(r,c){for(let p=0;p<9;p++)this.coefficients[p].addScaledVector(r.coefficients[p],c);return this}scale(r){for(let c=0;c<9;c++)this.coefficients[c].multiplyScalar(r);return this}lerp(r,c){for(let p=0;p<9;p++)this.coefficients[p].lerp(r.coefficients[p],c);return this}equals(r){for(let c=0;c<9;c++)if(!this.coefficients[c].equals(r.coefficients[c]))return!1;return!0}copy(r){return this.set(r.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(r,c=0){const p=this.coefficients;for(let m=0;m<9;m++)p[m].fromArray(r,c+3*m);return this}toArray(r=[],c=0){const p=this.coefficients;for(let m=0;m<9;m++)p[m].toArray(r,c+3*m);return r}static getBasisAt(r,c){const p=r.x,m=r.y,_=r.z;c[0]=.282095,c[1]=.488603*m,c[2]=.488603*_,c[3]=.488603*p,c[4]=1.092548*p*m,c[5]=1.092548*m*_,c[6]=.315392*(3*_*_-1),c[7]=1.092548*p*_,c[8]=.546274*(p*p-m*m)}}class su extends lo{constructor(r=new R_,c=1){super(void 0,c),this.isLightProbe=!0,this.sh=r}copy(r){return super.copy(r),this.sh.copy(r.sh),this}fromJSON(r){return this.intensity=r.intensity,this.sh.fromArray(r.sh),this}toJSON(r){const c=super.toJSON(r);return c.object.sh=this.sh.toArray(),c}}class rm extends dl{constructor(r){super(r),this.textures={}}load(r,c,p,m){const _=this,x=new Ha(_.manager);x.setPath(_.path),x.setRequestHeader(_.requestHeader),x.setWithCredentials(_.withCredentials),x.load(r,function(S){try{c(_.parse(JSON.parse(S)))}catch(B){m?m(B):console.error(B),_.manager.itemError(r)}},p,m)}parse(r){const c=this.textures;function p(x){return c[x]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",x),c[x]}const m=r.metadata&&r.metadata.version<=4.5?vi:void 0,_=rm.createMaterialFromType(r.type);if(r.uuid!==void 0&&(_.uuid=r.uuid),r.name!==void 0&&(_.name=r.name),r.color!==void 0&&_.color!==void 0&&_.color.setHex(r.color,m),r.roughness!==void 0&&(_.roughness=r.roughness),r.metalness!==void 0&&(_.metalness=r.metalness),r.sheen!==void 0&&(_.sheen=r.sheen),r.sheenColor!==void 0&&(_.sheenColor=new En().setHex(r.sheenColor,m)),r.sheenRoughness!==void 0&&(_.sheenRoughness=r.sheenRoughness),r.emissive!==void 0&&_.emissive!==void 0&&_.emissive.setHex(r.emissive,m),r.specular!==void 0&&_.specular!==void 0&&_.specular.setHex(r.specular,m),r.specularIntensity!==void 0&&(_.specularIntensity=r.specularIntensity),r.specularColor!==void 0&&_.specularColor!==void 0&&_.specularColor.setHex(r.specularColor,m),r.shininess!==void 0&&(_.shininess=r.shininess),r.clearcoat!==void 0&&(_.clearcoat=r.clearcoat),r.clearcoatRoughness!==void 0&&(_.clearcoatRoughness=r.clearcoatRoughness),r.iridescence!==void 0&&(_.iridescence=r.iridescence),r.iridescenceIOR!==void 0&&(_.iridescenceIOR=r.iridescenceIOR),r.iridescenceThicknessRange!==void 0&&(_.iridescenceThicknessRange=r.iridescenceThicknessRange),r.transmission!==void 0&&(_.transmission=r.transmission),r.thickness!==void 0&&(_.thickness=r.thickness),r.attenuationDistance!==void 0&&(_.attenuationDistance=r.attenuationDistance),r.attenuationColor!==void 0&&_.attenuationColor!==void 0&&_.attenuationColor.setHex(r.attenuationColor,m),r.fog!==void 0&&(_.fog=r.fog),r.flatShading!==void 0&&(_.flatShading=r.flatShading),r.blending!==void 0&&(_.blending=r.blending),r.combine!==void 0&&(_.combine=r.combine),r.side!==void 0&&(_.side=r.side),r.shadowSide!==void 0&&(_.shadowSide=r.shadowSide),r.opacity!==void 0&&(_.opacity=r.opacity),r.transparent!==void 0&&(_.transparent=r.transparent),r.alphaTest!==void 0&&(_.alphaTest=r.alphaTest),r.depthTest!==void 0&&(_.depthTest=r.depthTest),r.depthWrite!==void 0&&(_.depthWrite=r.depthWrite),r.colorWrite!==void 0&&(_.colorWrite=r.colorWrite),r.stencilWrite!==void 0&&(_.stencilWrite=r.stencilWrite),r.stencilWriteMask!==void 0&&(_.stencilWriteMask=r.stencilWriteMask),r.stencilFunc!==void 0&&(_.stencilFunc=r.stencilFunc),r.stencilRef!==void 0&&(_.stencilRef=r.stencilRef),r.stencilFuncMask!==void 0&&(_.stencilFuncMask=r.stencilFuncMask),r.stencilFail!==void 0&&(_.stencilFail=r.stencilFail),r.stencilZFail!==void 0&&(_.stencilZFail=r.stencilZFail),r.stencilZPass!==void 0&&(_.stencilZPass=r.stencilZPass),r.wireframe!==void 0&&(_.wireframe=r.wireframe),r.wireframeLinewidth!==void 0&&(_.wireframeLinewidth=r.wireframeLinewidth),r.wireframeLinecap!==void 0&&(_.wireframeLinecap=r.wireframeLinecap),r.wireframeLinejoin!==void 0&&(_.wireframeLinejoin=r.wireframeLinejoin),r.rotation!==void 0&&(_.rotation=r.rotation),r.linewidth!==1&&(_.linewidth=r.linewidth),r.dashSize!==void 0&&(_.dashSize=r.dashSize),r.gapSize!==void 0&&(_.gapSize=r.gapSize),r.scale!==void 0&&(_.scale=r.scale),r.polygonOffset!==void 0&&(_.polygonOffset=r.polygonOffset),r.polygonOffsetFactor!==void 0&&(_.polygonOffsetFactor=r.polygonOffsetFactor),r.polygonOffsetUnits!==void 0&&(_.polygonOffsetUnits=r.polygonOffsetUnits),r.dithering!==void 0&&(_.dithering=r.dithering),r.alphaToCoverage!==void 0&&(_.alphaToCoverage=r.alphaToCoverage),r.premultipliedAlpha!==void 0&&(_.premultipliedAlpha=r.premultipliedAlpha),r.forceSinglePass!==void 0&&(_.forceSinglePass=r.forceSinglePass),r.visible!==void 0&&(_.visible=r.visible),r.toneMapped!==void 0&&(_.toneMapped=r.toneMapped),r.userData!==void 0&&(_.userData=r.userData),r.vertexColors!==void 0&&(typeof r.vertexColors=="number"?_.vertexColors=r.vertexColors>0:_.vertexColors=r.vertexColors),r.uniforms!==void 0)for(const x in r.uniforms){const S=r.uniforms[x];switch(_.uniforms[x]={},S.type){case"t":_.uniforms[x].value=p(S.value);break;case"c":_.uniforms[x].value=new En().setHex(S.value,m);break;case"v2":_.uniforms[x].value=new qt().fromArray(S.value);break;case"v3":_.uniforms[x].value=new ze().fromArray(S.value);break;case"v4":_.uniforms[x].value=new Ji().fromArray(S.value);break;case"m3":_.uniforms[x].value=new Ai().fromArray(S.value);break;case"m4":_.uniforms[x].value=new _i().fromArray(S.value);break;default:_.uniforms[x].value=S.value}}if(r.defines!==void 0&&(_.defines=r.defines),r.vertexShader!==void 0&&(_.vertexShader=r.vertexShader),r.fragmentShader!==void 0&&(_.fragmentShader=r.fragmentShader),r.glslVersion!==void 0&&(_.glslVersion=r.glslVersion),r.extensions!==void 0)for(const x in r.extensions)_.extensions[x]=r.extensions[x];if(r.lights!==void 0&&(_.lights=r.lights),r.clipping!==void 0&&(_.clipping=r.clipping),r.size!==void 0&&(_.size=r.size),r.sizeAttenuation!==void 0&&(_.sizeAttenuation=r.sizeAttenuation),r.map!==void 0&&(_.map=p(r.map)),r.matcap!==void 0&&(_.matcap=p(r.matcap)),r.alphaMap!==void 0&&(_.alphaMap=p(r.alphaMap)),r.bumpMap!==void 0&&(_.bumpMap=p(r.bumpMap)),r.bumpScale!==void 0&&(_.bumpScale=r.bumpScale),r.normalMap!==void 0&&(_.normalMap=p(r.normalMap)),r.normalMapType!==void 0&&(_.normalMapType=r.normalMapType),r.normalScale!==void 0){let x=r.normalScale;Array.isArray(x)===!1&&(x=[x,x]),_.normalScale=new qt().fromArray(x)}return r.displacementMap!==void 0&&(_.displacementMap=p(r.displacementMap)),r.displacementScale!==void 0&&(_.displacementScale=r.displacementScale),r.displacementBias!==void 0&&(_.displacementBias=r.displacementBias),r.roughnessMap!==void 0&&(_.roughnessMap=p(r.roughnessMap)),r.metalnessMap!==void 0&&(_.metalnessMap=p(r.metalnessMap)),r.emissiveMap!==void 0&&(_.emissiveMap=p(r.emissiveMap)),r.emissiveIntensity!==void 0&&(_.emissiveIntensity=r.emissiveIntensity),r.specularMap!==void 0&&(_.specularMap=p(r.specularMap)),r.specularIntensityMap!==void 0&&(_.specularIntensityMap=p(r.specularIntensityMap)),r.specularColorMap!==void 0&&(_.specularColorMap=p(r.specularColorMap)),r.envMap!==void 0&&(_.envMap=p(r.envMap)),r.envMapIntensity!==void 0&&(_.envMapIntensity=r.envMapIntensity),r.reflectivity!==void 0&&(_.reflectivity=r.reflectivity),r.refractionRatio!==void 0&&(_.refractionRatio=r.refractionRatio),r.lightMap!==void 0&&(_.lightMap=p(r.lightMap)),r.lightMapIntensity!==void 0&&(_.lightMapIntensity=r.lightMapIntensity),r.aoMap!==void 0&&(_.aoMap=p(r.aoMap)),r.aoMapIntensity!==void 0&&(_.aoMapIntensity=r.aoMapIntensity),r.gradientMap!==void 0&&(_.gradientMap=p(r.gradientMap)),r.clearcoatMap!==void 0&&(_.clearcoatMap=p(r.clearcoatMap)),r.clearcoatRoughnessMap!==void 0&&(_.clearcoatRoughnessMap=p(r.clearcoatRoughnessMap)),r.clearcoatNormalMap!==void 0&&(_.clearcoatNormalMap=p(r.clearcoatNormalMap)),r.clearcoatNormalScale!==void 0&&(_.clearcoatNormalScale=new qt().fromArray(r.clearcoatNormalScale)),r.iridescenceMap!==void 0&&(_.iridescenceMap=p(r.iridescenceMap)),r.iridescenceThicknessMap!==void 0&&(_.iridescenceThicknessMap=p(r.iridescenceThicknessMap)),r.transmissionMap!==void 0&&(_.transmissionMap=p(r.transmissionMap)),r.thicknessMap!==void 0&&(_.thicknessMap=p(r.thicknessMap)),r.sheenColorMap!==void 0&&(_.sheenColorMap=p(r.sheenColorMap)),r.sheenRoughnessMap!==void 0&&(_.sheenRoughnessMap=p(r.sheenRoughnessMap)),_}setTextures(r){return this.textures=r,this}static createMaterialFromType(r){return new{ShadowMaterial:Cg,SpriteMaterial:oy,RawShaderMaterial:E_,ShaderMaterial:gc,PointsMaterial:_p,MeshPhysicalMaterial:Xb,MeshStandardMaterial:wy,MeshPhongMaterial:Yb,MeshToonMaterial:Ey,MeshNormalMaterial:Kb,MeshLambertMaterial:Sy,MeshDepthMaterial:hp,MeshDistanceMaterial:dp,MeshBasicMaterial:Lo,MeshMatcapMaterial:Jb,LineDashedMaterial:My,LineBasicMaterial:ao,Material:Ss}[r]}}class sm{static decodeText(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let c="";for(let p=0,m=r.length;p<m;p++)c+=String.fromCharCode(r[p]);try{return decodeURIComponent(escape(c))}catch{return c}}static extractUrlBase(r){const c=r.lastIndexOf("/");return c===-1?"./":r.slice(0,c+1)}static resolveURL(r,c){return typeof r!="string"||r===""?"":(/^https?:\/\//i.test(c)&&/^\//.test(r)&&(c=c.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:c+r)}}class Ec extends ee{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(r){return super.copy(r),this.instanceCount=r.instanceCount,this}toJSON(){const r=super.toJSON();return r.instanceCount=this.instanceCount,r.isInstancedBufferGeometry=!0,r}}class nx extends dl{constructor(r){super(r)}load(r,c,p,m){const _=this,x=new Ha(_.manager);x.setPath(_.path),x.setRequestHeader(_.requestHeader),x.setWithCredentials(_.withCredentials),x.load(r,function(S){try{c(_.parse(JSON.parse(S)))}catch(B){m?m(B):console.error(B),_.manager.itemError(r)}},p,m)}parse(r){const c={},p={};function m(G,V){if(c[V]!==void 0)return c[V];const Q=G.interleavedBuffers[V],q=function(Z,ae){if(p[ae]!==void 0)return p[ae];const ce=Z.arrayBuffers[ae],Te=new Uint32Array(ce).buffer;return p[ae]=Te,Te}(G,Q.buffer),te=yu(Q.type,q),K=new Va(te,Q.stride);return K.uuid=Q.uuid,c[V]=K,K}const _=r.isInstancedBufferGeometry?new Ec:new ee,x=r.data.index;if(x!==void 0){const G=yu(x.type,x.array);_.setIndex(new ur(G,1))}const S=r.data.attributes;for(const G in S){const V=S[G];let Q;if(V.isInterleavedBufferAttribute){const q=m(r.data,V.data);Q=new zu(q,V.itemSize,V.offset,V.normalized)}else{const q=yu(V.type,V.array);Q=new(V.isInstancedBufferAttribute?Ga:ur)(q,V.itemSize,V.normalized)}V.name!==void 0&&(Q.name=V.name),V.usage!==void 0&&Q.setUsage(V.usage),V.updateRange!==void 0&&(Q.updateRange.offset=V.updateRange.offset,Q.updateRange.count=V.updateRange.count),_.setAttribute(G,Q)}const B=r.data.morphAttributes;if(B)for(const G in B){const V=B[G],Q=[];for(let q=0,te=V.length;q<te;q++){const K=V[q];let Z;if(K.isInterleavedBufferAttribute){const ae=m(r.data,K.data);Z=new zu(ae,K.itemSize,K.offset,K.normalized)}else{const ae=yu(K.type,K.array);Z=new ur(ae,K.itemSize,K.normalized)}K.name!==void 0&&(Z.name=K.name),Q.push(Z)}_.morphAttributes[G]=Q}r.data.morphTargetsRelative&&(_.morphTargetsRelative=!0);const D=r.data.groups||r.data.drawcalls||r.data.offsets;if(D!==void 0)for(let G=0,V=D.length;G!==V;++G){const Q=D[G];_.addGroup(Q.start,Q.count,Q.materialIndex)}const U=r.data.boundingSphere;if(U!==void 0){const G=new ze;U.center!==void 0&&G.fromArray(U.center),_.boundingSphere=new Do(G,U.radius)}return r.name&&(_.name=r.name),r.userData&&(_.userData=r.userData),_}}class hE extends dl{constructor(r){super(r)}load(r,c,p,m){const _=this,x=this.path===""?sm.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||x;const S=new Ha(this.manager);S.setPath(this.path),S.setRequestHeader(this.requestHeader),S.setWithCredentials(this.withCredentials),S.load(r,function(B){let D=null;try{D=JSON.parse(B)}catch(G){return m!==void 0&&m(G),void console.error("THREE:ObjectLoader: Can't parse "+r+".",G.message)}const U=D.metadata;if(U===void 0||U.type===void 0||U.type.toLowerCase()==="geometry")return m!==void 0&&m(new Error("THREE.ObjectLoader: Can't load "+r)),void console.error("THREE.ObjectLoader: Can't load "+r);_.parse(D,c)},p,m)}async loadAsync(r,c){const p=this.path===""?sm.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||p;const m=new Ha(this.manager);m.setPath(this.path),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials);const _=await m.loadAsync(r,c),x=JSON.parse(_),S=x.metadata;if(S===void 0||S.type===void 0||S.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+r);return await this.parseAsync(x)}parse(r,c){const p=this.parseAnimations(r.animations),m=this.parseShapes(r.shapes),_=this.parseGeometries(r.geometries,m),x=this.parseImages(r.images,function(){c!==void 0&&c(D)}),S=this.parseTextures(r.textures,x),B=this.parseMaterials(r.materials,S),D=this.parseObject(r.object,_,B,S,p),U=this.parseSkeletons(r.skeletons,D);if(this.bindSkeletons(D,U),c!==void 0){let G=!1;for(const V in x)if(x[V].data instanceof HTMLImageElement){G=!0;break}G===!1&&c(D)}return D}async parseAsync(r){const c=this.parseAnimations(r.animations),p=this.parseShapes(r.shapes),m=this.parseGeometries(r.geometries,p),_=await this.parseImagesAsync(r.images),x=this.parseTextures(r.textures,_),S=this.parseMaterials(r.materials,x),B=this.parseObject(r.object,m,S,x,c),D=this.parseSkeletons(r.skeletons,B);return this.bindSkeletons(B,D),B}parseShapes(r){const c={};if(r!==void 0)for(let p=0,m=r.length;p<m;p++){const _=new Jh().fromJSON(r[p]);c[_.uuid]=_}return c}parseSkeletons(r,c){const p={},m={};if(c.traverse(function(_){_.isBone&&(m[_.uuid]=_)}),r!==void 0)for(let _=0,x=r.length;_<x;_++){const S=new Qh().fromJSON(r[_],m);p[S.uuid]=S}return p}parseGeometries(r,c){const p={};if(r!==void 0){const m=new nx;for(let _=0,x=r.length;_<x;_++){let S;const B=r[_];switch(B.type){case"BufferGeometry":case"InstancedBufferGeometry":S=m.parse(B);break;default:B.type in em?S=em[B.type].fromJSON(B,c):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${B.type}"`)}S.uuid=B.uuid,B.name!==void 0&&(S.name=B.name),B.userData!==void 0&&(S.userData=B.userData),p[B.uuid]=S}}return p}parseMaterials(r,c){const p={},m={};if(r!==void 0){const _=new rm;_.setTextures(c);for(let x=0,S=r.length;x<S;x++){const B=r[x];p[B.uuid]===void 0&&(p[B.uuid]=_.parse(B)),m[B.uuid]=p[B.uuid]}}return m}parseAnimations(r){const c={};if(r!==void 0)for(let p=0;p<r.length;p++){const m=r[p],_=qu.parse(m);c[_.uuid]=_}return c}parseImages(r,c){const p=this,m={};let _;function x(S){if(typeof S=="string"){const B=S;return function(D){return p.manager.itemStart(D),_.load(D,function(){p.manager.itemEnd(D)},void 0,function(){p.manager.itemError(D),p.manager.itemEnd(D)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(B)?B:p.resourcePath+B)}return S.data?{data:yu(S.type,S.data),width:S.width,height:S.height,complete:!0}:null}if(r!==void 0&&r.length>0){const S=new C_(c);_=new ls(S),_.setCrossOrigin(this.crossOrigin);for(let B=0,D=r.length;B<D;B++){const U=r[B],G=U.url;if(Array.isArray(G)){const V=[];for(let Q=0,q=G.length;Q<q;Q++){const te=x(G[Q]);te!==null&&(te instanceof HTMLImageElement?V.push(te):V.push(new Vf(te.data,te.width,te.height)))}m[U.uuid]=new dc(V)}else{const V=x(U.url);m[U.uuid]=new dc(V)}}}return m}async parseImagesAsync(r){const c=this,p={};let m;async function _(x){if(typeof x=="string"){const S=x,B=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(S)?S:c.resourcePath+S;return await m.loadAsync(B)}return x.data?{data:yu(x.type,x.data),width:x.width,height:x.height,complete:!0}:null}if(r!==void 0&&r.length>0){m=new ls(this.manager),m.setCrossOrigin(this.crossOrigin);for(let x=0,S=r.length;x<S;x++){const B=r[x],D=B.url;if(Array.isArray(D)){const U=[];for(let G=0,V=D.length;G<V;G++){const Q=D[G],q=await _(Q);q!==null&&(q instanceof HTMLImageElement?U.push(q):U.push(new Vf(q.data,q.width,q.height)))}p[B.uuid]=new dc(U)}else{const U=await _(B.url);p[B.uuid]=new dc(U)}}}return p}parseTextures(r,c){function p(_,x){return typeof _=="number"?_:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",_),x[_])}const m={};if(r!==void 0)for(let _=0,x=r.length;_<x;_++){const S=r[_];S.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',S.uuid),c[S.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",S.image);const B=c[S.image],D=B?B.data:void 0;let U;Array.isArray(D)?(U=new np,D.length===6&&(U.needsUpdate=!0)):(U=D&&D.data?new Vf:new pr,D&&D.complete&&(U.needsUpdate=!0)),U.source=B,U.uuid=S.uuid,S.name!==void 0&&(U.name=S.name),S.mapping!==void 0&&(U.mapping=p(S.mapping,ix)),S.channel!==void 0&&(U.channel=S.channel),S.offset!==void 0&&U.offset.fromArray(S.offset),S.repeat!==void 0&&U.repeat.fromArray(S.repeat),S.center!==void 0&&U.center.fromArray(S.center),S.rotation!==void 0&&(U.rotation=S.rotation),S.wrap!==void 0&&(U.wrapS=p(S.wrap[0],D_),U.wrapT=p(S.wrap[1],D_)),S.format!==void 0&&(U.format=S.format),S.internalFormat!==void 0&&(U.internalFormat=S.internalFormat),S.type!==void 0&&(U.type=S.type),S.colorSpace!==void 0?U.colorSpace=S.colorSpace:S.encoding!==void 0&&(U.encoding=S.encoding),S.minFilter!==void 0&&(U.minFilter=p(S.minFilter,Ly)),S.magFilter!==void 0&&(U.magFilter=p(S.magFilter,Ly)),S.anisotropy!==void 0&&(U.anisotropy=S.anisotropy),S.flipY!==void 0&&(U.flipY=S.flipY),S.generateMipmaps!==void 0&&(U.generateMipmaps=S.generateMipmaps),S.premultiplyAlpha!==void 0&&(U.premultiplyAlpha=S.premultiplyAlpha),S.unpackAlignment!==void 0&&(U.unpackAlignment=S.unpackAlignment),S.userData!==void 0&&(U.userData=S.userData),m[S.uuid]=U}return m}parseObject(r,c,p,m,_){let x;const S=r.metadata&&r.metadata.version<=4.5?vi:void 0;function B(Q){return c[Q]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Q),c[Q]}function D(Q){if(Q!==void 0){if(Array.isArray(Q)){const q=[];for(let te=0,K=Q.length;te<K;te++){const Z=Q[te];p[Z]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Z),q.push(p[Z])}return q}return p[Q]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Q),p[Q]}}function U(Q){return m[Q]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Q),m[Q]}let G,V;switch(r.type){case"Scene":x=new ul,r.background!==void 0&&(Number.isInteger(r.background)?x.background=new En().setHex(r.background,S):x.background=U(r.background)),r.environment!==void 0&&(x.environment=U(r.environment)),r.fog!==void 0&&(r.fog.type==="Fog"?x.fog=new fp(r.fog.color,r.fog.near,r.fog.far):r.fog.type==="FogExp2"&&(x.fog=new pp(r.fog.color,r.fog.density))),r.backgroundBlurriness!==void 0&&(x.backgroundBlurriness=r.backgroundBlurriness),r.backgroundIntensity!==void 0&&(x.backgroundIntensity=r.backgroundIntensity);break;case"PerspectiveCamera":x=new xa(r.fov,r.aspect,r.near,r.far),r.focus!==void 0&&(x.focus=r.focus),r.zoom!==void 0&&(x.zoom=r.zoom),r.filmGauge!==void 0&&(x.filmGauge=r.filmGauge),r.filmOffset!==void 0&&(x.filmOffset=r.filmOffset),r.view!==void 0&&(x.view=Object.assign({},r.view));break;case"OrthographicCamera":x=new jv(r.left,r.right,r.top,r.bottom,r.near,r.far),r.zoom!==void 0&&(x.zoom=r.zoom),r.view!==void 0&&(x.view=Object.assign({},r.view));break;case"AmbientLight":x=new Pg(r.color,r.intensity);break;case"DirectionalLight":x=new Dy(r.color,r.intensity);break;case"PointLight":x=new Ip(r.color,r.intensity,r.distance,r.decay);break;case"RectAreaLight":x=new By(r.color,r.intensity,r.width,r.height);break;case"SpotLight":x=new Ry(r.color,r.intensity,r.distance,r.angle,r.penumbra,r.decay);break;case"HemisphereLight":x=new co(r.color,r.groundColor,r.intensity);break;case"LightProbe":x=new su().fromJSON(r);break;case"SkinnedMesh":G=B(r.geometry),V=D(r.material),x=new Fo(G,V),r.bindMode!==void 0&&(x.bindMode=r.bindMode),r.bindMatrix!==void 0&&x.bindMatrix.fromArray(r.bindMatrix),r.skeleton!==void 0&&(x.skeleton=r.skeleton);break;case"Mesh":G=B(r.geometry),V=D(r.material),x=new Cs(G,V);break;case"InstancedMesh":G=B(r.geometry),V=D(r.material);const Q=r.count,q=r.instanceMatrix,te=r.instanceColor;x=new Ub(G,V,Q),x.instanceMatrix=new Ga(new Float32Array(q.array),16),te!==void 0&&(x.instanceColor=new Ga(new Float32Array(te.array),te.itemSize));break;case"LOD":x=new jf;break;case"Line":x=new Zi(B(r.geometry),D(r.material));break;case"LineLoop":x=new Vl(B(r.geometry),D(r.material));break;case"LineSegments":x=new jl(B(r.geometry),D(r.material));break;case"PointCloud":case"Points":x=new h_(B(r.geometry),D(r.material));break;case"Sprite":x=new ju(D(r.material));break;case"Group":x=new Is;break;case"Bone":x=new ra;break;default:x=new Vi}if(x.uuid=r.uuid,r.name!==void 0&&(x.name=r.name),r.matrix!==void 0?(x.matrix.fromArray(r.matrix),r.matrixAutoUpdate!==void 0&&(x.matrixAutoUpdate=r.matrixAutoUpdate),x.matrixAutoUpdate&&x.matrix.decompose(x.position,x.quaternion,x.scale)):(r.position!==void 0&&x.position.fromArray(r.position),r.rotation!==void 0&&x.rotation.fromArray(r.rotation),r.quaternion!==void 0&&x.quaternion.fromArray(r.quaternion),r.scale!==void 0&&x.scale.fromArray(r.scale)),r.up!==void 0&&x.up.fromArray(r.up),r.castShadow!==void 0&&(x.castShadow=r.castShadow),r.receiveShadow!==void 0&&(x.receiveShadow=r.receiveShadow),r.shadow&&(r.shadow.bias!==void 0&&(x.shadow.bias=r.shadow.bias),r.shadow.normalBias!==void 0&&(x.shadow.normalBias=r.shadow.normalBias),r.shadow.radius!==void 0&&(x.shadow.radius=r.shadow.radius),r.shadow.mapSize!==void 0&&x.shadow.mapSize.fromArray(r.shadow.mapSize),r.shadow.camera!==void 0&&(x.shadow.camera=this.parseObject(r.shadow.camera))),r.visible!==void 0&&(x.visible=r.visible),r.frustumCulled!==void 0&&(x.frustumCulled=r.frustumCulled),r.renderOrder!==void 0&&(x.renderOrder=r.renderOrder),r.userData!==void 0&&(x.userData=r.userData),r.layers!==void 0&&(x.layers.mask=r.layers),r.children!==void 0){const Q=r.children;for(let q=0;q<Q.length;q++)x.add(this.parseObject(Q[q],c,p,m,_))}if(r.animations!==void 0){const Q=r.animations;for(let q=0;q<Q.length;q++){const te=Q[q];x.animations.push(_[te])}}if(r.type==="LOD"){r.autoUpdate!==void 0&&(x.autoUpdate=r.autoUpdate);const Q=r.levels;for(let q=0;q<Q.length;q++){const te=Q[q],K=x.getObjectByProperty("uuid",te.object);K!==void 0&&x.addLevel(K,te.distance,te.hysteresis)}}return x}bindSkeletons(r,c){Object.keys(c).length!==0&&r.traverse(function(p){if(p.isSkinnedMesh===!0&&p.skeleton!==void 0){const m=c[p.skeleton];m===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",p.skeleton):p.bind(m,p.bindMatrix)}})}}const ix={UVMapping:Fr,CubeReflectionMapping:zr,CubeRefractionMapping:Sr,EquirectangularReflectionMapping:Dr,EquirectangularRefractionMapping:_r,CubeUVReflectionMapping:Oa},D_={RepeatWrapping:bo,ClampToEdgeWrapping:Mr,MirroredRepeatWrapping:Xs},Ly={NearestFilter:lr,NearestMipmapNearestFilter:Ka,NearestMipmapLinearFilter:sc,LinearFilter:Cr,LinearMipmapNearestFilter:fa,LinearMipmapLinearFilter:ds};class Sc extends dl{constructor(r){super(r),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(r){return this.options=r,this}load(r,c,p,m){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const _=this;os.get(r,"blob").then(x=>{if(x!==void 0)return _.manager.itemStart(r),void createImageBitmap(x,Object.assign(_.options,{colorSpaceConversion:"none"})).then(function(B){c&&c(B),_.manager.itemEnd(r)}).catch(function(B){m&&m(B),_.manager.itemError(r),_.manager.itemEnd(r)});const S={};S.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",S.headers=this.requestHeader,fetch(r,S).then(function(B){return B.blob()}).then(function(B){return os.add(r,B,"blob"),createImageBitmap(B,Object.assign(_.options,{colorSpaceConversion:"none"}))}).then(function(B){c&&c(B),_.manager.itemEnd(r)}).catch(function(B){m&&m(B),_.manager.itemError(r),_.manager.itemEnd(r)}),_.manager.itemStart(r)})}}let B_;class Oy{static getContext(){return B_===void 0&&(B_=new(window.AudioContext||window.webkitAudioContext)),B_}static setContext(r){B_=r}}class rx extends dl{constructor(r){super(r)}load(r,c,p,m){const _=this,x=new Ha(this.manager);function S(B){m?m(B):console.error(B),_.manager.itemError(r)}x.setResponseType("arraybuffer"),x.setPath(this.path),x.setRequestHeader(this.requestHeader),x.setWithCredentials(this.withCredentials),x.load(r,function(B){try{const D=B.slice(0);Oy.getContext().decodeAudioData(D,function(U){c(U)},S)}catch(D){S(D)}},p,m)}}class Ql extends su{constructor(r,c,p=1){super(void 0,p),this.isHemisphereLightProbe=!0;const m=new En().set(r),_=new En().set(c),x=new ze(m.r,m.g,m.b),S=new ze(_.r,_.g,_.b),B=Math.sqrt(Math.PI),D=B*Math.sqrt(.75);this.sh.coefficients[0].copy(x).add(S).multiplyScalar(B),this.sh.coefficients[1].copy(x).sub(S).multiplyScalar(D)}}class ky extends su{constructor(r,c=1){super(void 0,c),this.isAmbientLightProbe=!0;const p=new En().set(r);this.sh.coefficients[0].set(p.r,p.g,p.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const sx=new _i,ax=new _i,Pp=new _i;class dE{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new xa,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new xa,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(r){const c=this._cache;if(c.focus!==r.focus||c.fov!==r.fov||c.aspect!==r.aspect*this.aspect||c.near!==r.near||c.far!==r.far||c.zoom!==r.zoom||c.eyeSep!==this.eyeSep){c.focus=r.focus,c.fov=r.fov,c.aspect=r.aspect*this.aspect,c.near=r.near,c.far=r.far,c.zoom=r.zoom,c.eyeSep=this.eyeSep,Pp.copy(r.projectionMatrix);const p=c.eyeSep/2,m=p*c.near/c.focus,_=c.near*Math.tan(uc*c.fov*.5)/c.zoom;let x,S;ax.elements[12]=-p,sx.elements[12]=p,x=-_*c.aspect+m,S=_*c.aspect+m,Pp.elements[0]=2*c.near/(S-x),Pp.elements[8]=(S+x)/(S-x),this.cameraL.projectionMatrix.copy(Pp),x=-_*c.aspect-m,S=_*c.aspect-m,Pp.elements[0]=2*c.near/(S-x),Pp.elements[8]=(S+x)/(S-x),this.cameraR.projectionMatrix.copy(Pp)}this.cameraL.matrixWorld.copy(r.matrixWorld).multiply(ax),this.cameraR.matrixWorld.copy(r.matrixWorld).multiply(sx)}}class am{constructor(r=!0){this.autoStart=r,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Qa(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const c=Qa();r=(c-this.oldTime)/1e3,this.oldTime=c,this.elapsedTime+=r}return r}}function Qa(){return(typeof performance>"u"?Date:performance).now()}const nd=new ze,L_=new Fa,Yu=new ze,Ku=new ze;class Uy extends Vi{constructor(){super(),this.type="AudioListener",this.context=Oy.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new am}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(r){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=r,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}updateMatrixWorld(r){super.updateMatrixWorld(r);const c=this.context.listener,p=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(nd,L_,Yu),Ku.set(0,0,-1).applyQuaternion(L_),c.positionX){const m=this.context.currentTime+this.timeDelta;c.positionX.linearRampToValueAtTime(nd.x,m),c.positionY.linearRampToValueAtTime(nd.y,m),c.positionZ.linearRampToValueAtTime(nd.z,m),c.forwardX.linearRampToValueAtTime(Ku.x,m),c.forwardY.linearRampToValueAtTime(Ku.y,m),c.forwardZ.linearRampToValueAtTime(Ku.z,m),c.upX.linearRampToValueAtTime(p.x,m),c.upY.linearRampToValueAtTime(p.y,m),c.upZ.linearRampToValueAtTime(p.z,m)}else c.setPosition(nd.x,nd.y,nd.z),c.setOrientation(Ku.x,Ku.y,Ku.z,p.x,p.y,p.z)}}class ox extends Vi{constructor(r){super(),this.type="Audio",this.listener=r,this.context=r.context,this.gain=this.context.createGain(),this.gain.connect(r.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(r){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=r,this.connect(),this}setMediaElementSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(r),this.connect(),this}setMediaStreamSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(r),this.connect(),this}setBuffer(r){return this.buffer=r,this.sourceType="buffer",this.autoplay&&this.play(),this}play(r=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+r;const c=this.context.createBufferSource();return c.buffer=this.buffer,c.loop=this.loop,c.loopStart=this.loopStart,c.loopEnd=this.loopEnd,c.onended=this.onEnded.bind(this),c.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=c,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let r=1,c=this.filters.length;r<c;r++)this.filters[r-1].connect(this.filters[r]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let r=1,c=this.filters.length;r<c;r++)this.filters[r-1].disconnect(this.filters[r]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(r){return r||(r=[]),this._connected===!0?(this.disconnect(),this.filters=r.slice(),this.connect()):this.filters=r.slice(),this}setDetune(r){if(this.detune=r,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(r){return this.setFilters(r?[r]:[])}setPlaybackRate(r){if(this.hasPlaybackControl!==!1)return this.playbackRate=r,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(r){if(this.hasPlaybackControl!==!1)return this.loop=r,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(r){return this.loopStart=r,this}setLoopEnd(r){return this.loopEnd=r,this}getVolume(){return this.gain.gain.value}setVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}}const id=new ze,O_=new Fa,Ny=new ze,Ju=new ze;class au extends ox{constructor(r){super(r),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(r){return this.panner.refDistance=r,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(r){return this.panner.rolloffFactor=r,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(r){return this.panner.distanceModel=r,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(r){return this.panner.maxDistance=r,this}setDirectionalCone(r,c,p){return this.panner.coneInnerAngle=r,this.panner.coneOuterAngle=c,this.panner.coneOuterGain=p,this}updateMatrixWorld(r){if(super.updateMatrixWorld(r),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(id,O_,Ny),Ju.set(0,0,1).applyQuaternion(O_);const c=this.panner;if(c.positionX){const p=this.context.currentTime+this.listener.timeDelta;c.positionX.linearRampToValueAtTime(id.x,p),c.positionY.linearRampToValueAtTime(id.y,p),c.positionZ.linearRampToValueAtTime(id.z,p),c.orientationX.linearRampToValueAtTime(Ju.x,p),c.orientationY.linearRampToValueAtTime(Ju.y,p),c.orientationZ.linearRampToValueAtTime(Ju.z,p)}else c.setPosition(id.x,id.y,id.z),c.setOrientation(Ju.x,Ju.y,Ju.z)}}class lx{constructor(r,c=2048){this.analyser=r.context.createAnalyser(),this.analyser.fftSize=c,this.data=new Uint8Array(this.analyser.frequencyBinCount),r.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let r=0;const c=this.getFrequencyData();for(let p=0;p<c.length;p++)r+=c[p];return r/c.length}}class k_{constructor(r,c,p){let m,_,x;switch(this.binding=r,this.valueSize=p,c){case"quaternion":m=this._slerp,_=this._slerpAdditive,x=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*p),this._workIndex=5;break;case"string":case"bool":m=this._select,_=this._select,x=this._setAdditiveIdentityOther,this.buffer=new Array(5*p);break;default:m=this._lerp,_=this._lerpAdditive,x=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*p)}this._mixBufferRegion=m,this._mixBufferRegionAdditive=_,this._setIdentity=x,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(r,c){const p=this.buffer,m=this.valueSize,_=r*m+m;let x=this.cumulativeWeight;if(x===0){for(let S=0;S!==m;++S)p[_+S]=p[S];x=c}else{x+=c;const S=c/x;this._mixBufferRegion(p,_,0,S,m)}this.cumulativeWeight=x}accumulateAdditive(r){const c=this.buffer,p=this.valueSize,m=p*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(c,m,0,r,p),this.cumulativeWeightAdditive+=r}apply(r){const c=this.valueSize,p=this.buffer,m=r*c+c,_=this.cumulativeWeight,x=this.cumulativeWeightAdditive,S=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,_<1){const B=c*this._origIndex;this._mixBufferRegion(p,m,B,1-_,c)}x>0&&this._mixBufferRegionAdditive(p,m,this._addIndex*c,1,c);for(let B=c,D=c+c;B!==D;++B)if(p[B]!==p[B+c]){S.setValue(p,m);break}}saveOriginalState(){const r=this.binding,c=this.buffer,p=this.valueSize,m=p*this._origIndex;r.getValue(c,m);for(let _=p,x=m;_!==x;++_)c[_]=c[m+_%p];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const r=3*this.valueSize;this.binding.setValue(this.buffer,r)}_setAdditiveIdentityNumeric(){const r=this._addIndex*this.valueSize,c=r+this.valueSize;for(let p=r;p<c;p++)this.buffer[p]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const r=this._origIndex*this.valueSize,c=this._addIndex*this.valueSize;for(let p=0;p<this.valueSize;p++)this.buffer[c+p]=this.buffer[r+p]}_select(r,c,p,m,_){if(m>=.5)for(let x=0;x!==_;++x)r[c+x]=r[p+x]}_slerp(r,c,p,m){Fa.slerpFlat(r,c,r,c,r,p,m)}_slerpAdditive(r,c,p,m,_){const x=this._workIndex*_;Fa.multiplyQuaternionsFlat(r,x,r,c,r,p),Fa.slerpFlat(r,c,r,c,r,x,m)}_lerp(r,c,p,m,_){const x=1-m;for(let S=0;S!==_;++S){const B=c+S;r[B]=r[B]*x+r[p+S]*m}}_lerpAdditive(r,c,p,m,_){for(let x=0;x!==_;++x){const S=c+x;r[S]=r[S]+r[p+x]*m}}}const Fy="\\[\\]\\.:\\/",zy=new RegExp("["+Fy+"]","g"),rd="[^"+Fy+"]",pE="[^"+Fy.replace("\\.","")+"]",fE=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",rd)+/(WCOD+)?/.source.replace("WCOD",pE)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rd)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rd)+"$"),om=["material","materials","bones","map"];class $i{constructor(r,c,p){this.path=c,this.parsedPath=p||$i.parseTrackName(c),this.node=$i.findNode(r,this.parsedPath.nodeName),this.rootNode=r,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(r,c,p){return r&&r.isAnimationObjectGroup?new $i.Composite(r,c,p):new $i(r,c,p)}static sanitizeNodeName(r){return r.replace(/\s/g,"_").replace(zy,"")}static parseTrackName(r){const c=fE.exec(r);if(c===null)throw new Error("PropertyBinding: Cannot parse trackName: "+r);const p={nodeName:c[2],objectName:c[3],objectIndex:c[4],propertyName:c[5],propertyIndex:c[6]},m=p.nodeName&&p.nodeName.lastIndexOf(".");if(m!==void 0&&m!==-1){const _=p.nodeName.substring(m+1);om.indexOf(_)!==-1&&(p.nodeName=p.nodeName.substring(0,m),p.objectName=_)}if(p.propertyName===null||p.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+r);return p}static findNode(r,c){if(c===void 0||c===""||c==="."||c===-1||c===r.name||c===r.uuid)return r;if(r.skeleton){const p=r.skeleton.getBoneByName(c);if(p!==void 0)return p}if(r.children){const p=function(_){for(let x=0;x<_.length;x++){const S=_[x];if(S.name===c||S.uuid===c)return S;const B=p(S.children);if(B)return B}return null},m=p(r.children);if(m)return m}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(r,c){r[c]=this.targetObject[this.propertyName]}_getValue_array(r,c){const p=this.resolvedProperty;for(let m=0,_=p.length;m!==_;++m)r[c++]=p[m]}_getValue_arrayElement(r,c){r[c]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(r,c){this.resolvedProperty.toArray(r,c)}_setValue_direct(r,c){this.targetObject[this.propertyName]=r[c]}_setValue_direct_setNeedsUpdate(r,c){this.targetObject[this.propertyName]=r[c],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(r,c){this.targetObject[this.propertyName]=r[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,c){const p=this.resolvedProperty;for(let m=0,_=p.length;m!==_;++m)p[m]=r[c++]}_setValue_array_setNeedsUpdate(r,c){const p=this.resolvedProperty;for(let m=0,_=p.length;m!==_;++m)p[m]=r[c++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,c){const p=this.resolvedProperty;for(let m=0,_=p.length;m!==_;++m)p[m]=r[c++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(r,c){this.resolvedProperty[this.propertyIndex]=r[c]}_setValue_arrayElement_setNeedsUpdate(r,c){this.resolvedProperty[this.propertyIndex]=r[c],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(r,c){this.resolvedProperty[this.propertyIndex]=r[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(r,c){this.resolvedProperty.fromArray(r,c)}_setValue_fromArray_setNeedsUpdate(r,c){this.resolvedProperty.fromArray(r,c),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(r,c){this.resolvedProperty.fromArray(r,c),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(r,c){this.bind(),this.getValue(r,c)}_setValue_unbound(r,c){this.bind(),this.setValue(r,c)}bind(){let r=this.node;const c=this.parsedPath,p=c.objectName,m=c.propertyName;let _=c.propertyIndex;if(r||(r=$i.findNode(this.rootNode,c.nodeName),this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!r)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(p){let D=c.objectIndex;switch(p){case"materials":if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let U=0;U<r.length;U++)if(r[U].name===D){D=U;break}break;case"map":if("map"in r){r=r.map;break}if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);r=r.material.map;break;default:if(r[p]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[p]}if(D!==void 0){if(r[D]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[D]}}const x=r[m];if(x===void 0){const D=c.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+D+"."+m+" but it wasn't found.",r)}let S=this.Versioning.None;this.targetObject=r,r.needsUpdate!==void 0?S=this.Versioning.NeedsUpdate:r.matrixWorldNeedsUpdate!==void 0&&(S=this.Versioning.MatrixWorldNeedsUpdate);let B=this.BindingType.Direct;if(_!==void 0){if(m==="morphTargetInfluences"){if(!r.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);r.morphTargetDictionary[_]!==void 0&&(_=r.morphTargetDictionary[_])}B=this.BindingType.ArrayElement,this.resolvedProperty=x,this.propertyIndex=_}else x.fromArray!==void 0&&x.toArray!==void 0?(B=this.BindingType.HasFromToArray,this.resolvedProperty=x):Array.isArray(x)?(B=this.BindingType.EntireArray,this.resolvedProperty=x):this.propertyName=m;this.getValue=this.GetterByBindingType[B],this.setValue=this.SetterByBindingTypeAndVersioning[B][S]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}$i.Composite=class{constructor(b,r,c){const p=c||$i.parseTrackName(r);this._targetGroup=b,this._bindings=b.subscribe_(r,p)}getValue(b,r){this.bind();const c=this._targetGroup.nCachedObjects_,p=this._bindings[c];p!==void 0&&p.getValue(b,r)}setValue(b,r){const c=this._bindings;for(let p=this._targetGroup.nCachedObjects_,m=c.length;p!==m;++p)c[p].setValue(b,r)}bind(){const b=this._bindings;for(let r=this._targetGroup.nCachedObjects_,c=b.length;r!==c;++r)b[r].bind()}unbind(){const b=this._bindings;for(let r=this._targetGroup.nCachedObjects_,c=b.length;r!==c;++r)b[r].unbind()}},$i.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},$i.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},$i.prototype.GetterByBindingType=[$i.prototype._getValue_direct,$i.prototype._getValue_array,$i.prototype._getValue_arrayElement,$i.prototype._getValue_toArray],$i.prototype.SetterByBindingTypeAndVersioning=[[$i.prototype._setValue_direct,$i.prototype._setValue_direct_setNeedsUpdate,$i.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_array,$i.prototype._setValue_array_setNeedsUpdate,$i.prototype._setValue_array_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_arrayElement,$i.prototype._setValue_arrayElement_setNeedsUpdate,$i.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_fromArray,$i.prototype._setValue_fromArray_setNeedsUpdate,$i.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class lm{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ua(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const r={};this._indicesByUUID=r;for(let p=0,m=arguments.length;p!==m;++p)r[arguments[p].uuid]=p;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const c=this;this.stats={objects:{get total(){return c._objects.length},get inUse(){return this.total-c.nCachedObjects_}},get bindingsPerObject(){return c._bindings.length}}}add(){const r=this._objects,c=this._indicesByUUID,p=this._paths,m=this._parsedPaths,_=this._bindings,x=_.length;let S,B=r.length,D=this.nCachedObjects_;for(let U=0,G=arguments.length;U!==G;++U){const V=arguments[U],Q=V.uuid;let q=c[Q];if(q===void 0){q=B++,c[Q]=q,r.push(V);for(let te=0,K=x;te!==K;++te)_[te].push(new $i(V,p[te],m[te]))}else if(q<D){S=r[q];const te=--D,K=r[te];c[K.uuid]=q,r[q]=K,c[Q]=te,r[te]=V;for(let Z=0,ae=x;Z!==ae;++Z){const ce=_[Z],Te=ce[te];let Ce=ce[q];ce[q]=Te,Ce===void 0&&(Ce=new $i(V,p[Z],m[Z])),ce[te]=Ce}}else r[q]!==S&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=D}remove(){const r=this._objects,c=this._indicesByUUID,p=this._bindings,m=p.length;let _=this.nCachedObjects_;for(let x=0,S=arguments.length;x!==S;++x){const B=arguments[x],D=B.uuid,U=c[D];if(U!==void 0&&U>=_){const G=_++,V=r[G];c[V.uuid]=U,r[U]=V,c[D]=G,r[G]=B;for(let Q=0,q=m;Q!==q;++Q){const te=p[Q],K=te[G],Z=te[U];te[U]=K,te[G]=Z}}}this.nCachedObjects_=_}uncache(){const r=this._objects,c=this._indicesByUUID,p=this._bindings,m=p.length;let _=this.nCachedObjects_,x=r.length;for(let S=0,B=arguments.length;S!==B;++S){const D=arguments[S].uuid,U=c[D];if(U!==void 0)if(delete c[D],U<_){const G=--_,V=r[G],Q=--x,q=r[Q];c[V.uuid]=U,r[U]=V,c[q.uuid]=G,r[G]=q,r.pop();for(let te=0,K=m;te!==K;++te){const Z=p[te],ae=Z[G],ce=Z[Q];Z[U]=ae,Z[G]=ce,Z.pop()}}else{const G=--x,V=r[G];G>0&&(c[V.uuid]=U),r[U]=V,r.pop();for(let Q=0,q=m;Q!==q;++Q){const te=p[Q];te[U]=te[G],te.pop()}}}this.nCachedObjects_=_}subscribe_(r,c){const p=this._bindingsIndicesByPath;let m=p[r];const _=this._bindings;if(m!==void 0)return _[m];const x=this._paths,S=this._parsedPaths,B=this._objects,D=B.length,U=this.nCachedObjects_,G=new Array(D);m=_.length,p[r]=m,x.push(r),S.push(c),_.push(G);for(let V=U,Q=B.length;V!==Q;++V){const q=B[V];G[V]=new $i(q,r,c)}return G}unsubscribe_(r){const c=this._bindingsIndicesByPath,p=c[r];if(p!==void 0){const m=this._paths,_=this._parsedPaths,x=this._bindings,S=x.length-1,B=x[S];c[r[S]]=p,x[p]=B,x.pop(),_[p]=_[S],_.pop(),m[p]=m[S],m.pop()}}}class cx{constructor(r,c,p=null,m=c.blendMode){this._mixer=r,this._clip=c,this._localRoot=p,this.blendMode=m;const _=c.tracks,x=_.length,S=new Array(x),B={endingStart:Fc,endingEnd:Fc};for(let D=0;D!==x;++D){const U=_[D].createInterpolant(null);S[D]=U,U.settings=B}this._interpolantSettings=B,this._interpolants=S,this._propertyBindings=new Array(x),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Sl,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(r){return this._startTime=r,this}setLoop(r,c){return this.loop=r,this.repetitions=c,this}setEffectiveWeight(r){return this.weight=r,this._effectiveWeight=this.enabled?r:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(r){return this._scheduleFading(r,0,1)}fadeOut(r){return this._scheduleFading(r,1,0)}crossFadeFrom(r,c,p){if(r.fadeOut(c),this.fadeIn(c),p){const m=this._clip.duration,_=r._clip.duration,x=_/m,S=m/_;r.warp(1,x,c),this.warp(S,1,c)}return this}crossFadeTo(r,c,p){return r.crossFadeFrom(this,c,p)}stopFading(){const r=this._weightInterpolant;return r!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}setEffectiveTimeScale(r){return this.timeScale=r,this._effectiveTimeScale=this.paused?0:r,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(r){return this.timeScale=this._clip.duration/r,this.stopWarping()}syncWith(r){return this.time=r.time,this.timeScale=r.timeScale,this.stopWarping()}halt(r){return this.warp(this._effectiveTimeScale,0,r)}warp(r,c,p){const m=this._mixer,_=m.time,x=this.timeScale;let S=this._timeScaleInterpolant;S===null&&(S=m._lendControlInterpolant(),this._timeScaleInterpolant=S);const B=S.parameterPositions,D=S.sampleValues;return B[0]=_,B[1]=_+p,D[0]=r/x,D[1]=c/x,this}stopWarping(){const r=this._timeScaleInterpolant;return r!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(r,c,p,m){if(!this.enabled)return void this._updateWeight(r);const _=this._startTime;if(_!==null){const B=(r-_)*p;B<0||p===0?c=0:(this._startTime=null,c=p*B)}c*=this._updateTimeScale(r);const x=this._updateTime(c),S=this._updateWeight(r);if(S>0){const B=this._interpolants,D=this._propertyBindings;if(this.blendMode===Ki)for(let U=0,G=B.length;U!==G;++U)B[U].evaluate(x),D[U].accumulateAdditive(S);else for(let U=0,G=B.length;U!==G;++U)B[U].evaluate(x),D[U].accumulate(m,S)}}_updateWeight(r){let c=0;if(this.enabled){c=this.weight;const p=this._weightInterpolant;if(p!==null){const m=p.evaluate(r)[0];c*=m,r>p.parameterPositions[1]&&(this.stopFading(),m===0&&(this.enabled=!1))}}return this._effectiveWeight=c,c}_updateTimeScale(r){let c=0;if(!this.paused){c=this.timeScale;const p=this._timeScaleInterpolant;p!==null&&(c*=p.evaluate(r)[0],r>p.parameterPositions[1]&&(this.stopWarping(),c===0?this.paused=!0:this.timeScale=c))}return this._effectiveTimeScale=c,c}_updateTime(r){const c=this._clip.duration,p=this.loop;let m=this.time+r,_=this._loopCount;const x=p===$a;if(r===0)return _===-1?m:x&&(1&_)==1?c-m:m;if(p===yh){_===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(m>=c)m=c;else{if(!(m<0)){this.time=m;break e}m=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=m,this._mixer.dispatchEvent({type:"finished",action:this,direction:r<0?-1:1})}}else{if(_===-1&&(r>=0?(_=0,this._setEndings(!0,this.repetitions===0,x)):this._setEndings(this.repetitions===0,!0,x)),m>=c||m<0){const S=Math.floor(m/c);m-=c*S,_+=Math.abs(S);const B=this.repetitions-_;if(B<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,m=r>0?c:0,this.time=m,this._mixer.dispatchEvent({type:"finished",action:this,direction:r>0?1:-1});else{if(B===1){const D=r<0;this._setEndings(D,!D,x)}else this._setEndings(!1,!1,x);this._loopCount=_,this.time=m,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:S})}}else this.time=m;if(x&&(1&_)==1)return c-m}return m}_setEndings(r,c,p){const m=this._interpolantSettings;p?(m.endingStart=cc,m.endingEnd=cc):(m.endingStart=r?this.zeroSlopeAtStart?cc:Fc:Ah,m.endingEnd=c?this.zeroSlopeAtEnd?cc:Fc:Ah)}_scheduleFading(r,c,p){const m=this._mixer,_=m.time;let x=this._weightInterpolant;x===null&&(x=m._lendControlInterpolant(),this._weightInterpolant=x);const S=x.parameterPositions,B=x.sampleValues;return S[0]=_,B[0]=c,S[1]=_+r,B[1]=p,this}}const cm=new Float32Array(1);class mE extends tl{constructor(r){super(),this._root=r,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(r,c){const p=r._localRoot||this._root,m=r._clip.tracks,_=m.length,x=r._propertyBindings,S=r._interpolants,B=p.uuid,D=this._bindingsByRootAndName;let U=D[B];U===void 0&&(U={},D[B]=U);for(let G=0;G!==_;++G){const V=m[G],Q=V.name;let q=U[Q];if(q!==void 0)++q.referenceCount,x[G]=q;else{if(q=x[G],q!==void 0){q._cacheIndex===null&&(++q.referenceCount,this._addInactiveBinding(q,B,Q));continue}const te=c&&c._propertyBindings[G].binding.parsedPath;q=new k_($i.create(p,Q,te),V.ValueTypeName,V.getValueSize()),++q.referenceCount,this._addInactiveBinding(q,B,Q),x[G]=q}S[G].resultBuffer=q.buffer}}_activateAction(r){if(!this._isActiveAction(r)){if(r._cacheIndex===null){const p=(r._localRoot||this._root).uuid,m=r._clip.uuid,_=this._actionsByClip[m];this._bindAction(r,_&&_.knownActions[0]),this._addInactiveAction(r,m,p)}const c=r._propertyBindings;for(let p=0,m=c.length;p!==m;++p){const _=c[p];_.useCount++==0&&(this._lendBinding(_),_.saveOriginalState())}this._lendAction(r)}}_deactivateAction(r){if(this._isActiveAction(r)){const c=r._propertyBindings;for(let p=0,m=c.length;p!==m;++p){const _=c[p];--_.useCount==0&&(_.restoreOriginalState(),this._takeBackBinding(_))}this._takeBackAction(r)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const r=this;this.stats={actions:{get total(){return r._actions.length},get inUse(){return r._nActiveActions}},bindings:{get total(){return r._bindings.length},get inUse(){return r._nActiveBindings}},controlInterpolants:{get total(){return r._controlInterpolants.length},get inUse(){return r._nActiveControlInterpolants}}}}_isActiveAction(r){const c=r._cacheIndex;return c!==null&&c<this._nActiveActions}_addInactiveAction(r,c,p){const m=this._actions,_=this._actionsByClip;let x=_[c];if(x===void 0)x={knownActions:[r],actionByRoot:{}},r._byClipCacheIndex=0,_[c]=x;else{const S=x.knownActions;r._byClipCacheIndex=S.length,S.push(r)}r._cacheIndex=m.length,m.push(r),x.actionByRoot[p]=r}_removeInactiveAction(r){const c=this._actions,p=c[c.length-1],m=r._cacheIndex;p._cacheIndex=m,c[m]=p,c.pop(),r._cacheIndex=null;const _=r._clip.uuid,x=this._actionsByClip,S=x[_],B=S.knownActions,D=B[B.length-1],U=r._byClipCacheIndex;D._byClipCacheIndex=U,B[U]=D,B.pop(),r._byClipCacheIndex=null,delete S.actionByRoot[(r._localRoot||this._root).uuid],B.length===0&&delete x[_],this._removeInactiveBindingsForAction(r)}_removeInactiveBindingsForAction(r){const c=r._propertyBindings;for(let p=0,m=c.length;p!==m;++p){const _=c[p];--_.referenceCount==0&&this._removeInactiveBinding(_)}}_lendAction(r){const c=this._actions,p=r._cacheIndex,m=this._nActiveActions++,_=c[m];r._cacheIndex=m,c[m]=r,_._cacheIndex=p,c[p]=_}_takeBackAction(r){const c=this._actions,p=r._cacheIndex,m=--this._nActiveActions,_=c[m];r._cacheIndex=m,c[m]=r,_._cacheIndex=p,c[p]=_}_addInactiveBinding(r,c,p){const m=this._bindingsByRootAndName,_=this._bindings;let x=m[c];x===void 0&&(x={},m[c]=x),x[p]=r,r._cacheIndex=_.length,_.push(r)}_removeInactiveBinding(r){const c=this._bindings,p=r.binding,m=p.rootNode.uuid,_=p.path,x=this._bindingsByRootAndName,S=x[m],B=c[c.length-1],D=r._cacheIndex;B._cacheIndex=D,c[D]=B,c.pop(),delete S[_],Object.keys(S).length===0&&delete x[m]}_lendBinding(r){const c=this._bindings,p=r._cacheIndex,m=this._nActiveBindings++,_=c[m];r._cacheIndex=m,c[m]=r,_._cacheIndex=p,c[p]=_}_takeBackBinding(r){const c=this._bindings,p=r._cacheIndex,m=--this._nActiveBindings,_=c[m];r._cacheIndex=m,c[m]=r,_._cacheIndex=p,c[p]=_}_lendControlInterpolant(){const r=this._controlInterpolants,c=this._nActiveControlInterpolants++;let p=r[c];return p===void 0&&(p=new sa(new Float32Array(2),new Float32Array(2),1,cm),p.__cacheIndex=c,r[c]=p),p}_takeBackControlInterpolant(r){const c=this._controlInterpolants,p=r.__cacheIndex,m=--this._nActiveControlInterpolants,_=c[m];r.__cacheIndex=m,c[m]=r,_.__cacheIndex=p,c[p]=_}clipAction(r,c,p){const m=c||this._root,_=m.uuid;let x=typeof r=="string"?qu.findByName(m,r):r;const S=x!==null?x.uuid:r,B=this._actionsByClip[S];let D=null;if(p===void 0&&(p=x!==null?x.blendMode:mf),B!==void 0){const G=B.actionByRoot[_];if(G!==void 0&&G.blendMode===p)return G;D=B.knownActions[0],x===null&&(x=D._clip)}if(x===null)return null;const U=new cx(this,x,c,p);return this._bindAction(U,D),this._addInactiveAction(U,S,_),U}existingAction(r,c){const p=c||this._root,m=p.uuid,_=typeof r=="string"?qu.findByName(p,r):r,x=_?_.uuid:r,S=this._actionsByClip[x];return S!==void 0&&S.actionByRoot[m]||null}stopAllAction(){const r=this._actions;for(let c=this._nActiveActions-1;c>=0;--c)r[c].stop();return this}update(r){r*=this.timeScale;const c=this._actions,p=this._nActiveActions,m=this.time+=r,_=Math.sign(r),x=this._accuIndex^=1;for(let D=0;D!==p;++D)c[D]._update(m,r,_,x);const S=this._bindings,B=this._nActiveBindings;for(let D=0;D!==B;++D)S[D].apply(x);return this}setTime(r){this.time=0;for(let c=0;c<this._actions.length;c++)this._actions[c].time=0;return this.update(r)}getRoot(){return this._root}uncacheClip(r){const c=this._actions,p=r.uuid,m=this._actionsByClip,_=m[p];if(_!==void 0){const x=_.knownActions;for(let S=0,B=x.length;S!==B;++S){const D=x[S];this._deactivateAction(D);const U=D._cacheIndex,G=c[c.length-1];D._cacheIndex=null,D._byClipCacheIndex=null,G._cacheIndex=U,c[U]=G,c.pop(),this._removeInactiveBindingsForAction(D)}delete m[p]}}uncacheRoot(r){const c=r.uuid,p=this._actionsByClip;for(const _ in p){const x=p[_].actionByRoot[c];x!==void 0&&(this._deactivateAction(x),this._removeInactiveAction(x))}const m=this._bindingsByRootAndName[c];if(m!==void 0)for(const _ in m){const x=m[_];x.restoreOriginalState(),this._removeInactiveBinding(x)}}uncacheAction(r,c){const p=this.existingAction(r,c);p!==null&&(this._deactivateAction(p),this._removeInactiveAction(p))}}class sd{constructor(r){this.value=r}clone(){return new sd(this.value.clone===void 0?this.value:this.value.clone())}}let gE=0;class um extends tl{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:gE++}),this.name="",this.usage=el,this.uniforms=[]}add(r){return this.uniforms.push(r),this}remove(r){const c=this.uniforms.indexOf(r);return c!==-1&&this.uniforms.splice(c,1),this}setName(r){return this.name=r,this}setUsage(r){return this.usage=r,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(r){this.name=r.name,this.usage=r.usage;const c=r.uniforms;this.uniforms.length=0;for(let p=0,m=c.length;p<m;p++)this.uniforms.push(c[p].clone());return this}clone(){return new this.constructor().copy(this)}}class U_ extends Va{constructor(r,c,p=1){super(r,c),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=p}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}clone(r){const c=super.clone(r);return c.meshPerAttribute=this.meshPerAttribute,c}toJSON(r){const c=super.toJSON(r);return c.isInstancedInterleavedBuffer=!0,c.meshPerAttribute=this.meshPerAttribute,c}}class Rg{constructor(r,c,p,m,_){this.isGLBufferAttribute=!0,this.name="",this.buffer=r,this.type=c,this.itemSize=p,this.elementSize=m,this.count=_,this.version=0}set needsUpdate(r){r===!0&&this.version++}setBuffer(r){return this.buffer=r,this}setType(r,c){return this.type=r,this.elementSize=c,this}setItemSize(r){return this.itemSize=r,this}setCount(r){return this.count=r,this}}class jy{constructor(r,c,p=0,m=1/0){this.ray=new Mu(r,c),this.near=p,this.far=m,this.camera=null,this.layers=new Tu,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(r,c){this.ray.set(r,c)}setFromCamera(r,c){c.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(r.x,r.y,.5).unproject(c).sub(this.ray.origin).normalize(),this.camera=c):c.isOrthographicCamera?(this.ray.origin.set(r.x,r.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld),this.camera=c):console.error("THREE.Raycaster: Unsupported camera type: "+c.type)}intersectObject(r,c=!0,p=[]){return Zu(r,this,p,c),p.sort(N_),p}intersectObjects(r,c=!0,p=[]){for(let m=0,_=r.length;m<_;m++)Zu(r[m],this,p,c);return p.sort(N_),p}}function N_(b,r){return b.distance-r.distance}function Zu(b,r,c,p){if(b.layers.test(r.layers)&&b.raycast(r,c),p===!0){const m=b.children;for(let _=0,x=m.length;_<x;_++)Zu(m[_],r,c,!0)}}class vE{constructor(r=1,c=0,p=0){return this.radius=r,this.phi=c,this.theta=p,this}set(r,c,p){return this.radius=r,this.phi=c,this.theta=p,this}copy(r){return this.radius=r.radius,this.phi=r.phi,this.theta=r.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,c,p){return this.radius=Math.sqrt(r*r+c*c+p*p),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(r,p),this.phi=Math.acos(Hn(c/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Dg{constructor(r=1,c=0,p=0){return this.radius=r,this.theta=c,this.y=p,this}set(r,c,p){return this.radius=r,this.theta=c,this.y=p,this}copy(r){return this.radius=r.radius,this.theta=r.theta,this.y=r.y,this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,c,p){return this.radius=Math.sqrt(r*r+p*p),this.theta=Math.atan2(r,p),this.y=c,this}clone(){return new this.constructor().copy(this)}}const ad=new qt;class F_{constructor(r=new qt(1/0,1/0),c=new qt(-1/0,-1/0)){this.isBox2=!0,this.min=r,this.max=c}set(r,c){return this.min.copy(r),this.max.copy(c),this}setFromPoints(r){this.makeEmpty();for(let c=0,p=r.length;c<p;c++)this.expandByPoint(r[c]);return this}setFromCenterAndSize(r,c){const p=ad.copy(c).multiplyScalar(.5);return this.min.copy(r).sub(p),this.max.copy(r).add(p),this}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(r){return this.isEmpty()?r.set(0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y}getParameter(r,c){return c.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y)}clampPoint(r,c){return c.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,ad).distanceTo(r)}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}const hm=new ze,dm=new ze;class Vy{constructor(r=new ze,c=new ze){this.start=r,this.end=c}set(r,c){return this.start.copy(r),this.end.copy(c),this}copy(r){return this.start.copy(r.start),this.end.copy(r.end),this}getCenter(r){return r.addVectors(this.start,this.end).multiplyScalar(.5)}delta(r){return r.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(r,c){return this.delta(c).multiplyScalar(r).add(this.start)}closestPointToPointParameter(r,c){hm.subVectors(r,this.start),dm.subVectors(this.end,this.start);const p=dm.dot(dm);let m=dm.dot(hm)/p;return c&&(m=Hn(m,0,1)),m}closestPointToPoint(r,c,p){const m=this.closestPointToPointParameter(r,c);return this.delta(p).multiplyScalar(m).add(this.start)}applyMatrix4(r){return this.start.applyMatrix4(r),this.end.applyMatrix4(r),this}equals(r){return r.start.equals(this.start)&&r.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const od=new ze;class _E extends Vi{constructor(r,c){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=c,this.type="SpotLightHelper";const p=new ee,m=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let x=0,S=1,B=32;x<B;x++,S++){const D=x/B*Math.PI*2,U=S/B*Math.PI*2;m.push(Math.cos(D),Math.sin(D),1,Math.cos(U),Math.sin(U),1)}p.setAttribute("position",new Tn(m,3));const _=new ao({fog:!1,toneMapped:!1});this.cone=new jl(p,_),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const r=this.light.distance?this.light.distance:1e3,c=r*Math.tan(this.light.angle);this.cone.scale.set(c,c,r),od.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(od),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ho=new ze,Wl=new _i,z_=new _i;class yE extends jl{constructor(r){const c=ux(r),p=new ee,m=[],_=[],x=new En(0,0,1),S=new En(0,1,0);for(let B=0;B<c.length;B++){const D=c[B];D.parent&&D.parent.isBone&&(m.push(0,0,0),m.push(0,0,0),_.push(x.r,x.g,x.b),_.push(S.r,S.g,S.b))}p.setAttribute("position",new Tn(m,3)),p.setAttribute("color",new Tn(_,3)),super(p,new ao({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=r,this.bones=c,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(r){const c=this.bones,p=this.geometry,m=p.getAttribute("position");z_.copy(this.root.matrixWorld).invert();for(let _=0,x=0;_<c.length;_++){const S=c[_];S.parent&&S.parent.isBone&&(Wl.multiplyMatrices(z_,S.matrixWorld),ho.setFromMatrixPosition(Wl),m.setXYZ(x,ho.x,ho.y,ho.z),Wl.multiplyMatrices(z_,S.parent.matrixWorld),ho.setFromMatrixPosition(Wl),m.setXYZ(x+1,ho.x,ho.y,ho.z),x+=2)}p.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(r)}dispose(){this.geometry.dispose(),this.material.dispose()}}function ux(b){const r=[];b.isBone===!0&&r.push(b);for(let c=0;c<b.children.length;c++)r.push.apply(r,ux(b.children[c]));return r}class AE extends Cs{constructor(r,c,p){super(new Cp(c,4,2),new Lo({wireframe:!0,fog:!1,toneMapped:!1})),this.light=r,this.color=p,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const bE=new ze,hx=new En,Gy=new En;class dx extends Vi{constructor(r,c,p){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=p,this.type="HemisphereLightHelper";const m=new Yf(c);m.rotateY(.5*Math.PI),this.material=new Lo({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const _=m.getAttribute("position"),x=new Float32Array(3*_.count);m.setAttribute("color",new ur(x,3)),this.add(new Cs(m,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const r=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const c=r.geometry.getAttribute("color");hx.copy(this.light.color),Gy.copy(this.light.groundColor);for(let p=0,m=c.count;p<m;p++){const _=p<m/2?hx:Gy;c.setXYZ(p,_.r,_.g,_.b)}c.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),r.lookAt(bE.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Hy extends jl{constructor(r=10,c=10,p=4473924,m=8947848){p=new En(p),m=new En(m);const _=c/2,x=r/c,S=r/2,B=[],D=[];for(let G=0,V=0,Q=-S;G<=c;G++,Q+=x){B.push(-S,0,Q,S,0,Q),B.push(Q,0,-S,Q,0,S);const q=G===_?p:m;q.toArray(D,V),V+=3,q.toArray(D,V),V+=3,q.toArray(D,V),V+=3,q.toArray(D,V),V+=3}const U=new ee;U.setAttribute("position",new Tn(B,3)),U.setAttribute("color",new Tn(D,3)),super(U,new ao({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class px extends jl{constructor(r=10,c=16,p=8,m=64,_=4473924,x=8947848){_=new En(_),x=new En(x);const S=[],B=[];if(c>1)for(let U=0;U<c;U++){const G=U/c*(2*Math.PI),V=Math.sin(G)*r,Q=Math.cos(G)*r;S.push(0,0,0),S.push(V,0,Q);const q=1&U?_:x;B.push(q.r,q.g,q.b),B.push(q.r,q.g,q.b)}for(let U=0;U<p;U++){const G=1&U?_:x,V=r-r/p*U;for(let Q=0;Q<m;Q++){let q=Q/m*(2*Math.PI),te=Math.sin(q)*V,K=Math.cos(q)*V;S.push(te,0,K),B.push(G.r,G.g,G.b),q=(Q+1)/m*(2*Math.PI),te=Math.sin(q)*V,K=Math.cos(q)*V,S.push(te,0,K),B.push(G.r,G.g,G.b)}}const D=new ee;D.setAttribute("position",new Tn(S,3)),D.setAttribute("color",new Tn(B,3)),super(D,new ao({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Qy=new ze,po=new ze,Bg=new ze;class xE extends Vi{constructor(r,c,p){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=p,this.type="DirectionalLightHelper",c===void 0&&(c=1);let m=new ee;m.setAttribute("position",new Tn([-c,c,0,c,c,0,c,-c,0,-c,-c,0,-c,c,0],3));const _=new ao({fog:!1,toneMapped:!1});this.lightPlane=new Zi(m,_),this.add(this.lightPlane),m=new ee,m.setAttribute("position",new Tn([0,0,0,0,0,1],3)),this.targetLine=new Zi(m,_),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Qy.setFromMatrixPosition(this.light.matrixWorld),po.setFromMatrixPosition(this.light.target.matrixWorld),Bg.subVectors(po,Qy),this.lightPlane.lookAt(po),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(po),this.targetLine.scale.z=Bg.length()}}const Lg=new ze,Gr=new Nv;class fx extends jl{constructor(r){const c=new ee,p=new ao({color:16777215,vertexColors:!0,toneMapped:!1}),m=[],_=[],x={};function S(q,te){B(q),B(te)}function B(q){m.push(0,0,0),_.push(0,0,0),x[q]===void 0&&(x[q]=[]),x[q].push(m.length/3-1)}S("n1","n2"),S("n2","n4"),S("n4","n3"),S("n3","n1"),S("f1","f2"),S("f2","f4"),S("f4","f3"),S("f3","f1"),S("n1","f1"),S("n2","f2"),S("n3","f3"),S("n4","f4"),S("p","n1"),S("p","n2"),S("p","n3"),S("p","n4"),S("u1","u2"),S("u2","u3"),S("u3","u1"),S("c","t"),S("p","c"),S("cn1","cn2"),S("cn3","cn4"),S("cf1","cf2"),S("cf3","cf4"),c.setAttribute("position",new Tn(m,3)),c.setAttribute("color",new Tn(_,3)),super(c,p),this.type="CameraHelper",this.camera=r,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=x,this.update();const D=new En(16755200),U=new En(16711680),G=new En(43775),V=new En(16777215),Q=new En(3355443);this.setColors(D,U,G,V,Q)}setColors(r,c,p,m,_){const x=this.geometry.getAttribute("color");x.setXYZ(0,r.r,r.g,r.b),x.setXYZ(1,r.r,r.g,r.b),x.setXYZ(2,r.r,r.g,r.b),x.setXYZ(3,r.r,r.g,r.b),x.setXYZ(4,r.r,r.g,r.b),x.setXYZ(5,r.r,r.g,r.b),x.setXYZ(6,r.r,r.g,r.b),x.setXYZ(7,r.r,r.g,r.b),x.setXYZ(8,r.r,r.g,r.b),x.setXYZ(9,r.r,r.g,r.b),x.setXYZ(10,r.r,r.g,r.b),x.setXYZ(11,r.r,r.g,r.b),x.setXYZ(12,r.r,r.g,r.b),x.setXYZ(13,r.r,r.g,r.b),x.setXYZ(14,r.r,r.g,r.b),x.setXYZ(15,r.r,r.g,r.b),x.setXYZ(16,r.r,r.g,r.b),x.setXYZ(17,r.r,r.g,r.b),x.setXYZ(18,r.r,r.g,r.b),x.setXYZ(19,r.r,r.g,r.b),x.setXYZ(20,r.r,r.g,r.b),x.setXYZ(21,r.r,r.g,r.b),x.setXYZ(22,r.r,r.g,r.b),x.setXYZ(23,r.r,r.g,r.b),x.setXYZ(24,c.r,c.g,c.b),x.setXYZ(25,c.r,c.g,c.b),x.setXYZ(26,c.r,c.g,c.b),x.setXYZ(27,c.r,c.g,c.b),x.setXYZ(28,c.r,c.g,c.b),x.setXYZ(29,c.r,c.g,c.b),x.setXYZ(30,c.r,c.g,c.b),x.setXYZ(31,c.r,c.g,c.b),x.setXYZ(32,p.r,p.g,p.b),x.setXYZ(33,p.r,p.g,p.b),x.setXYZ(34,p.r,p.g,p.b),x.setXYZ(35,p.r,p.g,p.b),x.setXYZ(36,p.r,p.g,p.b),x.setXYZ(37,p.r,p.g,p.b),x.setXYZ(38,m.r,m.g,m.b),x.setXYZ(39,m.r,m.g,m.b),x.setXYZ(40,_.r,_.g,_.b),x.setXYZ(41,_.r,_.g,_.b),x.setXYZ(42,_.r,_.g,_.b),x.setXYZ(43,_.r,_.g,_.b),x.setXYZ(44,_.r,_.g,_.b),x.setXYZ(45,_.r,_.g,_.b),x.setXYZ(46,_.r,_.g,_.b),x.setXYZ(47,_.r,_.g,_.b),x.setXYZ(48,_.r,_.g,_.b),x.setXYZ(49,_.r,_.g,_.b),x.needsUpdate=!0}update(){const r=this.geometry,c=this.pointMap;Gr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Hi("c",c,r,Gr,0,0,-1),Hi("t",c,r,Gr,0,0,1),Hi("n1",c,r,Gr,-1,-1,-1),Hi("n2",c,r,Gr,1,-1,-1),Hi("n3",c,r,Gr,-1,1,-1),Hi("n4",c,r,Gr,1,1,-1),Hi("f1",c,r,Gr,-1,-1,1),Hi("f2",c,r,Gr,1,-1,1),Hi("f3",c,r,Gr,-1,1,1),Hi("f4",c,r,Gr,1,1,1),Hi("u1",c,r,Gr,.7,1.1,-1),Hi("u2",c,r,Gr,-.7,1.1,-1),Hi("u3",c,r,Gr,0,2,-1),Hi("cf1",c,r,Gr,-1,0,1),Hi("cf2",c,r,Gr,1,0,1),Hi("cf3",c,r,Gr,0,-1,1),Hi("cf4",c,r,Gr,0,1,1),Hi("cn1",c,r,Gr,-1,0,-1),Hi("cn2",c,r,Gr,1,0,-1),Hi("cn3",c,r,Gr,0,-1,-1),Hi("cn4",c,r,Gr,0,1,-1),r.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Hi(b,r,c,p,m,_,x){Lg.set(m,_,x).unproject(p);const S=r[b];if(S!==void 0){const B=c.getAttribute("position");for(let D=0,U=S.length;D<U;D++)B.setXYZ(S[D],Lg.x,Lg.y,Lg.z)}}const aa=new nl;class Og extends jl{constructor(r,c=16776960){const p=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),m=new Float32Array(24),_=new ee;_.setIndex(new ur(p,1)),_.setAttribute("position",new ur(m,3)),super(_,new ao({color:c,toneMapped:!1})),this.object=r,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(r){if(r!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&aa.setFromObject(this.object),aa.isEmpty())return;const c=aa.min,p=aa.max,m=this.geometry.attributes.position,_=m.array;_[0]=p.x,_[1]=p.y,_[2]=p.z,_[3]=c.x,_[4]=p.y,_[5]=p.z,_[6]=c.x,_[7]=c.y,_[8]=p.z,_[9]=p.x,_[10]=c.y,_[11]=p.z,_[12]=p.x,_[13]=p.y,_[14]=c.z,_[15]=c.x,_[16]=p.y,_[17]=c.z,_[18]=c.x,_[19]=c.y,_[20]=c.z,_[21]=p.x,_[22]=c.y,_[23]=c.z,m.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(r){return this.object=r,this.update(),this}copy(r,c){return super.copy(r,c),this.object=r.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class j_ extends jl{constructor(r,c=16776960){const p=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),m=new ee;m.setIndex(new ur(p,1)),m.setAttribute("position",new Tn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(m,new ao({color:c,toneMapped:!1})),this.box=r,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(r){const c=this.box;c.isEmpty()||(c.getCenter(this.position),c.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(r))}dispose(){this.geometry.dispose(),this.material.dispose()}}class V_ extends Zi{constructor(r,c=1,p=16776960){const m=p,_=new ee;_.setAttribute("position",new Tn([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),_.computeBoundingSphere(),super(_,new ao({color:m,toneMapped:!1})),this.type="PlaneHelper",this.plane=r,this.size=c;const x=new ee;x.setAttribute("position",new Tn([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),x.computeBoundingSphere(),this.add(new Cs(x,new Lo({color:m,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(r){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(r)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const G_=new ze;let kg,H_;class mx extends Vi{constructor(r=new ze(0,0,1),c=new ze(0,0,0),p=1,m=16776960,_=.2*p,x=.2*_){super(),this.type="ArrowHelper",kg===void 0&&(kg=new ee,kg.setAttribute("position",new Tn([0,0,0,0,1,0],3)),H_=new Yh(0,.5,1,5,1),H_.translate(0,-.5,0)),this.position.copy(c),this.line=new Zi(kg,new ao({color:m,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Cs(H_,new Lo({color:m,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(p,_,x)}setDirection(r){if(r.y>.99999)this.quaternion.set(0,0,0,1);else if(r.y<-.99999)this.quaternion.set(1,0,0,0);else{G_.set(r.z,0,-r.x).normalize();const c=Math.acos(r.y);this.quaternion.setFromAxisAngle(G_,c)}}setLength(r,c=.2*r,p=.2*c){this.line.scale.set(1,Math.max(1e-4,r-c),1),this.line.updateMatrix(),this.cone.scale.set(p,c,p),this.cone.position.y=r,this.cone.updateMatrix()}setColor(r){this.line.material.color.set(r),this.cone.material.color.set(r)}copy(r){return super.copy(r,!1),this.line.copy(r.line),this.cone.copy(r.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Wy extends jl{constructor(r=1){const c=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],p=new ee;p.setAttribute("position",new Tn(c,3)),p.setAttribute("color",new Tn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(p,new ao({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(r,c,p){const m=new En,_=this.geometry.attributes.color.array;return m.set(r),m.toArray(_,0),m.toArray(_,3),m.set(c),m.toArray(_,6),m.toArray(_,9),m.set(p),m.toArray(_,12),m.toArray(_,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class gx{constructor(){this.type="ShapePath",this.color=new En,this.subPaths=[],this.currentPath=null}moveTo(r,c){return this.currentPath=new Xh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(r,c),this}lineTo(r,c){return this.currentPath.lineTo(r,c),this}quadraticCurveTo(r,c,p,m){return this.currentPath.quadraticCurveTo(r,c,p,m),this}bezierCurveTo(r,c,p,m,_,x){return this.currentPath.bezierCurveTo(r,c,p,m,_,x),this}splineThru(r){return this.currentPath.splineThru(r),this}toShapes(r){function c(K,Z){const ae=Z.length;let ce=!1;for(let Te=ae-1,Ce=0;Ce<ae;Te=Ce++){let Ie=Z[Te],Ke=Z[Ce],ct=Ke.x-Ie.x,Je=Ke.y-Ie.y;if(Math.abs(Je)>Number.EPSILON){if(Je<0&&(Ie=Z[Ce],ct=-ct,Ke=Z[Te],Je=-Je),K.y<Ie.y||K.y>Ke.y)continue;if(K.y===Ie.y){if(K.x===Ie.x)return!0}else{const yt=Je*(K.x-Ie.x)-ct*(K.y-Ie.y);if(yt===0)return!0;if(yt<0)continue;ce=!ce}}else{if(K.y!==Ie.y)continue;if(Ke.x<=K.x&&K.x<=Ie.x||Ie.x<=K.x&&K.x<=Ke.x)return!0}}return ce}const p=bc.isClockWise,m=this.subPaths;if(m.length===0)return[];let _,x,S;const B=[];if(m.length===1)return x=m[0],S=new Jh,S.curves=x.curves,B.push(S),B;let D=!p(m[0].getPoints());D=r?!D:D;const U=[],G=[];let V,Q,q=[],te=0;G[te]=void 0,q[te]=[];for(let K=0,Z=m.length;K<Z;K++)x=m[K],V=x.getPoints(),_=p(V),_=r?!_:_,_?(!D&&G[te]&&te++,G[te]={s:new Jh,p:V},G[te].s.curves=x.curves,D&&te++,q[te]=[]):q[te].push({h:x,p:V[0]});if(!G[0])return function(K){const Z=[];for(let ae=0,ce=K.length;ae<ce;ae++){const Te=K[ae],Ce=new Jh;Ce.curves=Te.curves,Z.push(Ce)}return Z}(m);if(G.length>1){let K=!1,Z=0;for(let ae=0,ce=G.length;ae<ce;ae++)U[ae]=[];for(let ae=0,ce=G.length;ae<ce;ae++){const Te=q[ae];for(let Ce=0;Ce<Te.length;Ce++){const Ie=Te[Ce];let Ke=!0;for(let ct=0;ct<G.length;ct++)c(Ie.p,G[ct].p)&&(ae!==ct&&Z++,Ke?(Ke=!1,U[ct].push(Ie)):K=!0);Ke&&U[ae].push(Ie)}}Z>0&&K===!1&&(q=U)}for(let K=0,Z=G.length;K<Z;K++){S=G[K].s,B.push(S),Q=q[K];for(let ae=0,ce=Q.length;ae<ce;ae++)S.holes.push(Q[ae].h)}return B}}class wE extends Ul{constructor(r,c,p,m,_,x){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(r,c,p,m,_,x)}}class vx extends bp{constructor(r,c,p,m){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(r,c,p,m)}}class qy extends Gu{constructor(r,c,p,m){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(r,c,p,m)}}class kr extends Hu{constructor(r,c,p,m,_,x,S){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(r,c,p,m,_,x,S)}}class Rp extends Yh{constructor(r,c,p,m,_,x,S,B){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(r,c,p,m,_,x,S,B)}}class ou extends xp{constructor(r,c){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(r,c)}}class ld extends Sp{constructor(r,c){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(r,c)}}class Ug extends Mp{constructor(r,c){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(r,c)}}class EE extends Ap{constructor(r,c,p,m){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(r,c,p,m)}}class SE extends Yf{constructor(r,c){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(r,c)}}class ME extends al{constructor(r,c,p,m){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(r,c,p,m)}}class CE extends Gl{constructor(r,c,p,m){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(r,c,p,m)}}class Xy extends Wu{constructor(r,c,p,m,_,x){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(r,c,p,m,_,x)}}class Mc extends Kf{constructor(r,c){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(r,c)}}class Yy extends Cp{constructor(r,c,p,m,_,x,S){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(r,c,p,m,_,x,S)}}class Ky extends Jf{constructor(r,c){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(r,c)}}class yx extends Mg{constructor(r,c,p,m,_){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(r,c,p,m,_)}}class TE extends Zf{constructor(r,c,p,m,_,x){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(r,c,p,m,_,x)}}class $u extends Tp{constructor(r,c,p,m,_){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(r,c,p,m,_)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:O}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=O)},553:function(T,g,u){u.d(g,{_:function(){return W}});var O=u(988);const z=new WeakMap;class W extends O.aNw{constructor(Y){super(Y),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(Y){return this.decoderPath=Y,this}setDecoderConfig(Y){return this.decoderConfig=Y,this}setWorkerLimit(Y){return this.workerLimit=Y,this}load(Y,ie,oe,fe){const me=new O.hH6(this.manager);me.setPath(this.path),me.setResponseType("arraybuffer"),me.setRequestHeader(this.requestHeader),me.setWithCredentials(this.withCredentials),me.load(Y,de=>{this.parse(de,ie,fe)},oe,fe)}parse(Y,ie,oe){this.decodeDracoFile(Y,ie,null,null,O.KI_).catch(oe)}decodeDracoFile(Y,ie,oe,fe,me=O.GUF){const de={attributeIDs:oe||this.defaultAttributeIDs,attributeTypes:fe||this.defaultAttributeTypes,useUniqueIDs:!!oe,vertexColorSpace:me};return this.decodeGeometry(Y,de).then(ie)}decodeGeometry(Y,ie){const oe=JSON.stringify(ie);if(z.has(Y)){const ue=z.get(Y);if(ue.key===oe)return ue.promise;if(Y.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let fe;const me=this.workerNextTaskID++,de=Y.byteLength,Pe=this._getWorker(me,de).then(ue=>(fe=ue,new Promise((He,je)=>{fe._callbacks[me]={resolve:He,reject:je},fe.postMessage({type:"decode",id:me,taskConfig:ie,buffer:Y},[Y])}))).then(ue=>this._createGeometry(ue.geometry));return Pe.catch(()=>!0).then(()=>{fe&&me&&this._releaseTask(fe,me)}),z.set(Y,{key:oe,promise:Pe}),Pe}_createGeometry(Y){const ie=new O.u9r;Y.index&&ie.setIndex(new O.TlE(Y.index.array,1));for(let oe=0;oe<Y.attributes.length;oe++){const fe=Y.attributes[oe],me=fe.name,de=fe.array,Pe=fe.itemSize,ue=new O.TlE(de,Pe);me==="color"&&this._assignVertexColorSpace(ue,fe.vertexColorSpace),ie.setAttribute(me,ue)}return ie}_assignVertexColorSpace(Y,ie){if(ie!==O.KI_)return;const oe=new O.Ilk;for(let fe=0,me=Y.count;fe<me;fe++)oe.fromBufferAttribute(Y,fe).convertSRGBToLinear(),Y.setXYZ(fe,oe.r,oe.g,oe.b)}_loadLibrary(Y,ie){const oe=new O.hH6(this.manager);return oe.setPath(this.decoderPath),oe.setResponseType(ie),oe.setWithCredentials(this.withCredentials),new Promise((fe,me)=>{oe.load(Y,fe,void 0,me)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const Y=typeof WebAssembly!="object"||this.decoderConfig.type==="js",ie=[];return Y?ie.push(this._loadLibrary("draco_decoder.js","text")):(ie.push(this._loadLibrary("draco_wasm_wrapper.js","text")),ie.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(ie).then(oe=>{const fe=oe[0];Y||(this.decoderConfig.wasmBinary=oe[1]);const me=J,de=["/* draco decoder */",fe,"","/* worker */",me.substring(me.indexOf("{")+1,me.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([de]))}),this.decoderPending}_getWorker(Y,ie){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const fe=new Worker(this.workerSourceURL);fe._callbacks={},fe._taskCosts={},fe._taskLoad=0,fe.postMessage({type:"init",decoderConfig:this.decoderConfig}),fe.onmessage=function(me){const de=me.data;switch(de.type){case"decode":fe._callbacks[de.id].resolve(de);break;case"error":fe._callbacks[de.id].reject(de);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+de.type+'"')}},this.workerPool.push(fe)}else this.workerPool.sort(function(fe,me){return fe._taskLoad>me._taskLoad?-1:1});const oe=this.workerPool[this.workerPool.length-1];return oe._taskCosts[Y]=ie,oe._taskLoad+=ie,oe})}_releaseTask(Y,ie){Y._taskLoad-=Y._taskCosts[ie],delete Y._callbacks[ie],delete Y._taskCosts[ie]}debug(){console.log("Task load: ",this.workerPool.map(Y=>Y._taskLoad))}dispose(){for(let Y=0;Y<this.workerPool.length;++Y)this.workerPool[Y].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const J=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__2(T){var g=__webpackgi_module_cache__[T];if(g!==void 0)return g.exports;var u=__webpackgi_module_cache__[T]={id:T,exports:{}};return __webpackgi_modules__[T].call(u.exports,u,u.exports,__webpackgi_require__2),u.exports}__webpackgi_require__2.m=__webpackgi_modules__,__webpackgi_require__2.n=function(T){var g=T&&T.__esModule?function(){return T.default}:function(){return T};return __webpackgi_require__2.d(g,{a:g}),g},getProto=Object.getPrototypeOf?function(T){return Object.getPrototypeOf(T)}:function(T){return T.__proto__},__webpackgi_require__2.t=function(T,g){if(1&g&&(T=this(T)),8&g||typeof T=="object"&&T&&(4&g&&T.__esModule||16&g&&typeof T.then=="function"))return T;var u=Object.create(null);__webpackgi_require__2.r(u);var O={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var z=2&g&&T;typeof z=="object"&&!~leafPrototypes.indexOf(z);z=getProto(z))Object.getOwnPropertyNames(z).forEach(function(W){O[W]=function(){return T[W]}});return O.default=function(){return T},__webpackgi_require__2.d(u,O),u},__webpackgi_require__2.d=function(T,g){for(var u in g)__webpackgi_require__2.o(g,u)&&!__webpackgi_require__2.o(T,u)&&Object.defineProperty(T,u,{enumerable:!0,get:g[u]})},__webpackgi_require__2.f={},__webpackgi_require__2.e=function(T){return Promise.all(Object.keys(__webpackgi_require__2.f).reduce(function(g,u){return __webpackgi_require__2.f[u](T,g),g},[]))},__webpackgi_require__2.u=function(T){return T+".mjs"},__webpackgi_require__2.o=function(T,g){return Object.prototype.hasOwnProperty.call(T,g)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__2.l=function(T,g,u,O){if(inProgress[T])inProgress[T].push(g);else{var z,W;if(u!==void 0)for(var J=document.getElementsByTagName("script"),se=0;se<J.length;se++){var Y=J[se];if(Y.getAttribute("src")==T||Y.getAttribute("data-webpack")==dataWebpackPrefix+u){z=Y;break}}z||(W=!0,(z=document.createElement("script")).type="module",z.charset="utf-8",z.timeout=120,__webpackgi_require__2.nc&&z.setAttribute("nonce",__webpackgi_require__2.nc),z.setAttribute("data-webpack",dataWebpackPrefix+u),z.src=T),inProgress[T]=[g];var ie=function(fe,me){z.onerror=z.onload=null,clearTimeout(oe);var de=inProgress[T];if(delete inProgress[T],z.parentNode&&z.parentNode.removeChild(z),de&&de.forEach(function(Pe){return Pe(me)}),fe)return fe(me)},oe=setTimeout(ie.bind(null,void 0,{type:"timeout",target:z}),12e4);z.onerror=ie.bind(null,z.onerror),z.onload=ie.bind(null,z.onload),W&&document.head.appendChild(z)}},__webpackgi_require__2.r=function(T){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})},function(){var T;if(typeof import.meta.url=="string"&&(T=import.meta.url),!T)throw new Error("Automatic publicPath is not supported in this browser");T=T.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__2.p=T+"../../"}(),function(){var T={698:0};__webpackgi_require__2.f.j=function(O,z){var W=__webpackgi_require__2.o(T,O)?T[O]:void 0;if(W!==0)if(W)z.push(W[2]);else{var J=new Promise(function(ie,oe){W=T[O]=[ie,oe]});z.push(W[2]=J);var se=__webpackgi_require__2.p+__webpackgi_require__2.u(O),Y=new Error;__webpackgi_require__2.l(se,function(ie){if(__webpackgi_require__2.o(T,O)&&((W=T[O])!==0&&(T[O]=void 0),W)){var oe=ie&&(ie.type==="load"?"missing":ie.type),fe=ie&&ie.target&&ie.target.src;Y.message="Loading chunk "+O+` failed.
(`+oe+": "+fe+")",Y.name="ChunkLoadError",Y.type=oe,Y.request=fe,W[1](Y)}},"chunk-"+O,O)}};var g=function(O,z){var W,J,se=z[0],Y=z[1],ie=z[2],oe=0;if(se.some(function(fe){return T[fe]!==0})){for(W in Y)__webpackgi_require__2.o(Y,W)&&(__webpackgi_require__2.m[W]=Y[W]);ie&&ie(__webpackgi_require__2)}for(O&&O(z);oe<se.length;oe++)J=se[oe],__webpackgi_require__2.o(T,J)&&T[J]&&T[J][0](),T[J]=0},u=self.webpackChunkwebgi=self.webpackChunkwebgi||[];u.forEach(g.bind(null,0)),u.push=g.bind(null,u.push.bind(u))}(),__webpackgi_require__2.nc=void 0;var __webpackgi_exports__2={};(function(){var T;__webpackgi_require__2.d(__webpackgi_exports__2,{MWW:function(){return Dg},LY2:function(){return u.LY2},GYo:function(){return Ww},GPz:function(){return Aw},HRj:function(){return vu},li4:function(){return XT},FO5:function(){return zp},Nlh:function(){return YT},Mp4:function(){return So},QvI:function(){return Sn},PrA:function(){return Oc},JHp:function(){return K0},bGH:function(){return u.bGH},NDo:function(){return u.NDo},gSk:function(){return u.gSk},WMw:function(){return u.WMw},OTo:function(){return u.OTo},Se2:function(){return u.Se2},cum:function(){return u.cum},Mig:function(){return u.Mig},B$7:function(){return Jd},i_9:function(){return u.i_9},bBp:function(){return u.bBp},m7l:function(){return u.m7l},sYA:function(){return u.sYA},Xcj:function(){return u.Xcj},mzJ:function(){return u.mzJ},ZZA:function(){return u.ZZA},$Ph:function(){return so},T__:function(){return u.T__},HkE:function(){return u.HkE},tGC:function(){return u.tGC},g1S:function(){return xC},I$C:function(){return Am},QIH:function(){return Gv},_JE:function(){return ho},SwW:function(){return ad},ksm:function(){return Yt},jl_:function(){return Ms},b7R:function(){return gc},BDV:function(){return De},Ea_:function(){return tp},qff:function(){return Ms},tmC:function(){return yn},BON:function(){return jv},P40:function(){return Uh},wLL:function(){return z1},iHO:function(){return Pf},BbS:function(){return u.BbS},kqm:function(){return u.kqm},Hmr:function(){return u.Hmr},SJI:function(){return u.SJI},mTL:function(){return u.mTL},y8_:function(){return u.y8_},_Li:function(){return u._Li},w7U:function(){return _b},g56:function(){return Qo},bj3:function(){return El},z81:function(){return u.z81},_MY:function(){return u._MY},yEv:function(){return FR},dFZ:function(){return ll},N$j:function(){return u.N$j},_YM:function(){return u._YM},TUj:function(){return u.TUj},ZzF:function(){return u.ZzF},qzb:function(){return Fe},GQ:function(){return u.GQ},nvb:function(){return u.nvb},DvJ:function(){return u.DvJ},fQA:function(){return u.fQA},cPz:function(){return ny},TlE:function(){return u.TlE},u9r:function(){return u.u9r},s4_:function(){return u.s4_},T95:function(){return u.T95},F5w:function(){return wA},NlP:function(){return LA},$8Z:function(){return jp},YYN:function(){return wd},CtF:function(){return u.CtF},V1s:function(){return u.V1s},jOv:function(){return rs},Rki:function(){return u.Rki},pzV:function(){return JA},itZ:function(){return sa},MMq:function(){return Pd},qKx:function(){return ar},Hmi:function(){return Od},X4S:function(){return AA},vlJ:function(){return C1},nPO:function(){return ah},zcQ:function(){return c_},GH1:function(){return Vl},ROQ:function(){return u.ROQ},YN5:function(){return u.YN5},BVQ:function(){return u.BVQ},YT8:function(){return u.YT8},_DE:function(){return Bf},YGz:function(){return u.YGz},trn:function(){return u.trn},zf8:function(){return u.zf8},uWy:function(){return u.uWy},wYQ:function(){return Ql},SUY:function(){return u.SUY},Ilk:function(){return u.Ilk},R2R:function(){return u.R2R},epp:function(){return u.epp},xmJ:function(){return vc},GD$:function(){return zs},Z_g:function(){return u.Z_g},EB7:function(){return u.EB7},DqL:function(){return u.DqL},_3:function(){return u._3},b_z:function(){return u.b_z},OCn:function(){return Dc},N_j:function(){return xN},hNv:function(){return rC},_am:function(){return u._am},kB7:function(){return Hf},fY$:function(){return u.fY$},vxC:function(){return u.vxC},BtG:function(){return u.BtG},cBK:function(){return u.cBK},g8_:function(){return u.g8_},AXT:function(){return u.AXT},yj7:function(){return u.yj7},dYG:function(){return u.dYG},tm_:function(){return u.tm_},S2y:function(){return u.S2y},B02:function(){return u.B02},PeU:function(){return u.PeU},Hyl:function(){return u.Hyl},Wqd:function(){return u.Wqd},c0Q:function(){return jI},re0:function(){return VI},Xaj:function(){return u.Xaj},DUb:function(){return Is},dZ3:function(){return u.dZ3},m_w:function(){return u.m_w},fHI:function(){return u.fHI},LBq:function(){return u.LBq},Qww:function(){return Mf.Q},CGV:function(){return g.Damper},JUT:function(){return u.JUT},p3g:function(){return u.p3g},IEO:function(){return u.IEO},yxD:function(){return u.yxD},CUS:function(){return uC},A5E:function(){return u.A5E},zqG:function(){return Wl},PfX:function(){return N1},Q1o:function(){return j0},jfJ:function(){return u.jfJ},T_J:function(){return u.T_J},tEQ:function(){return u.tEQ},gb4:function(){return ee},qkB:function(){return u.qkB},cvk:function(){return Fh},HWo:function(){return zh},brP:function(){return u.brP},$YQ:function(){return u.$YQ},X8d:function(){return OA},Zdt:function(){return XS},yNB:function(){return Gi},h7x:function(){return Zi},Ox3:function(){return u.Ox3},qtn:function(){return il},cBI:function(){return u.cBI},cU9:function(){return u.cU9},ntt:function(){return u.ntt},DT1:function(){return u.DT1},Kgo:function(){return u.Kgo},ehD:function(){return u.ehD},fhJ:function(){return q0},y1s:function(){return Jc},fSK:function(){return u.fSK},Vdb:function(){return u.Vdb},l8J:function(){return u.l8J},dj0:function(){return u.dj0},QM0:function(){return u.QM0},n94:function(){return Nx},OIS:function(){return zE},q8b:function(){return Zh},TOt:function(){return u.TOt},xaN:function(){return me},Ny0:function(){return u.Ny0},NeD:function(){return ES},Zof:function(){return F1},N1Y:function(){return aA},itK:function(){return yb},eD:function(){return u.eD},jwo:function(){return u.jwo},dSO:function(){return u.dSO},Bf4:function(){return u.Bf4},USm:function(){return u.USm},pBf:function(){return u.pBf},eBg:function(){return MM},$Vf:function(){return u.$Vf},O7d:function(){return u.O7d},ksq:function(){return ni},hFL:function(){return u0},gXf:function(){return FE},hH6:function(){return u.hH6},izP:function(){return kA},kpi:function(){return sg},DwZ:function(){return Ra},kN3:function(){return JS},e62:function(){return u.e62},a$l:function(){return u.a$l},OM3:function(){return u.OM3},VzW:function(){return u.VzW},ybr:function(){return u.ybr},yo9:function(){return u.yo9},Dzq:function(){return Fo},zCA:function(){return ra},$Bt:function(){return Nu},Wzm:function(){return u.Wzm},Wl3:function(){return u.Wl3},iWj:function(){return u.iWj},DNz:function(){return uo},m1M:function(){return Ri},ylh:function(){return u.ylh},v9Y:function(){return u.v9Y},LSk:function(){return u.LSk},LHE:function(){return hr},KE0:function(){return gS},KCF:function(){return jT},a4n:function(){return $E},NKC:function(){return By},jrv:function(){return su},zIH:function(){return Ef},Hfk:function(){return Vc},png:function(){return Eu},tAj:function(){return Tl},Eb_:function(){return Sf},SJj:function(){return tx},cF0:function(){return hf},BT2:function(){return GE},_8p:function(){return yC},V5Z:function(){return ix},s5b:function(){return D_},BHZ:function(){return Ab},hkn:function(){return Co},GFY:function(){return To},w$m:function(){return u.w$m},ksN:function(){return u.ksN},j4z:function(){return u.j4z},OAl:function(){return u.OAl},VLJ:function(){return u.VLJ},C73:function(){return Yl},ZAu:function(){return u.ZAu},ibP:function(){return mc},lth:function(){return Iy},_fI:function(){return zs},hUN:function(){return Ga},cLu:function(){return u.cLu},vmT:function(){return u.vmT},Qpg:function(){return u.Qpg},So8:function(){return u.So8},eOv:function(){return XA},Wjw:function(){return u.Wjw},cJO:function(){return u.cJO},QRU:function(){return u.QRU},S3k:function(){return u.S3k},OPJ:function(){return KT},PpQ:function(){return u.PpQ},q_9:function(){return yr},ZRs:function(){return u.ZRs},oqc:function(){return u.oqc},T_x:function(){return zt},lb7:function(){return u.lb7},L5s:function(){return u.L5s},$TI:function(){return u.$TI},SPe:function(){return u.SPe},aVm:function(){return u.aVm},j87:function(){return u.j87},RNb:function(){return u.RNb},Kz5:function(){return u.Kz5},vpT:function(){return u.vpT},kB5:function(){return u.kB5},_C8:function(){return u._C8},Syv:function(){return u.Syv},NMF:function(){return u.NMF},pIN:function(){return u.pIN},eMJ:function(){return u.eMJ},rN7:function(){return zy},iUp:function(){return rd},GFd:function(){return qE},x5V:function(){return u.x5V},tUh:function(){return u.tUh},z8B:function(){return u.z8B},vcl:function(){return ls},GZb:function(){return u.GZb},p7y:function(){return u.p7y},S9g:function(){return u.S9g},Zr5:function(){return u.Zr5},vCF:function(){return u.vCF},yt0:function(){return u.yt0},uXU:function(){return u.uXU},_kC:function(){return u._kC},lk7:function(){return u.lk7},USc:function(){return YA},x12:function(){return u.x12},w_R:function(){return WE},Zzh:function(){return u.Zzh},nls:function(){return u.nls},g_z:function(){return u.g_z},U7:function(){return u.U7},FT0:function(){return u.FT0},L1_:function(){return iA},blk:function(){return u.blk},YRm:function(){return Fl},ejS:function(){return u.ejS},wUb:function(){return Ox},zOz:function(){return jh},rnI:function(){return u.rnI},wem:function(){return u.wem},lfu:function(){return u.lfu},FDw:function(){return u.FDw},lRj:function(){return u.lRj},D1R:function(){return u.D1R},qyh:function(){return u.qyh},GUF:function(){return u.GUF},EoG:function(){return u.EoG},aNw:function(){return u.aNw},Zp0:function(){return u.Zp0},lLk:function(){return u.lLk},jAl:function(){return u.jAl},uEv:function(){return u.uEv},YKA:function(){return u.YKA},cRx:function(){return u.cRx},Y8D:function(){return u.Y8D},RsA:function(){return u.RsA},Y0m:function(){return z_},F5T:function(){return u.F5T},EDU:function(){return rt},z$Q:function(){return Op},KA8:function(){return fs},ZqF:function(){return bb},XUj:function(){return Px},Me$:function(){return fd},u7G:function(){return u.u7G},PEk:function(){return _u},BG4:function(){return _t},M8C:function(){return u.M8C},Vkp:function(){return u.Vkp},yGw:function(){return u.yGw},Sm8:function(){return u.Sm8},Kj0:function(){return u.Kj0},vBJ:function(){return u.vBJ},QfV:function(){return ks},lRF:function(){return u.lRF},Lun:function(){return u.Lun},YBo:function(){return u.YBo},kaV:function(){return u.kaV},RSm:function(){return u.RSm},xoR:function(){return u.xoR},EJi:function(){return u.EJi},Wid:function(){return u.Wid},iuj:function(){return Os},IKL:function(){return u.IKL},r_:function(){return u.r_},OoA:function(){return u.OoA},qhX:function(){return u.qhX},CRe:function(){return ex},qPT:function(){return $c},M5h:function(){return u.M5h},Ns1:function(){return u.Ns1},TyD:function(){return u.TyD},vZf:function(){return u.vZf},HTd:function(){return u.HTd},aH4:function(){return u.aH4},YLQ:function(){return u.YLQ},BVF:function(){return u.BVF},MyG:function(){return u.MyG},jFi:function(){return u.jFi},aCh:function(){return u.aCh},uL9:function(){return u.uL9},TNj:function(){return jo},IFH:function(){return u.IFH},bdR:function(){return u.bdR},RPs:function(){return hl},kM_:function(){return kb},M6v:function(){return u.M6v},RvT:function(){return u.RvT},dUE:function(){return u.dUE},oe_:function(){return Lg},BuN:function(){return Gr},Tme:function(){return u.Tme},N9P:function(){return xh},tfP:function(){return wv},Gql:function(){return u.Gql},$XY:function(){return Js},O9d:function(){return xb},zEO:function(){return tl},qfx:function(){return oh},PA7:function(){return u.PA7},REq:function(){return u.REq},pQR:function(){return u.pQR},ghN:function(){return u.ghN},Hy8:function(){return u.Hy8},Wpd:function(){return u.Wpd},LgZ:function(){return u.LgZ},iWC:function(){return u.iWC},mqn:function(){return JU},SKe:function(){return Xi},iKG:function(){return u.iKG},rCq:function(){return yA},_iA:function(){return u._iA},ntZ:function(){return u.ntZ},anP:function(){return u.anP},X2e:function(){return GT},oxT:function(){return co},FCo:function(){return cu},y$t:function(){return u.y$t},cPb:function(){return u.cPb},lmx:function(){return Ti},JOQ:function(){return u.JOQ},BKK:function(){return u.BKK},_12:function(){return u._12},tJx:function(){return u.tJx},mjX:function(){return ig},cek:function(){return u.cek},qD0:function(){return Th},xG9:function(){return u.xG9},eqi:function(){return g.PointerDragHelper},wI8:function(){return qp},Sgv:function(){return ZS},woe:function(){return u.woe},UY4:function(){return u.UY4},aq0:function(){return u.aq0},ujx:function(){return u.ujx},Uol:function(){return u.Uol},JiH:function(){return p0},VYz:function(){return u.VYz},B2H:function(){return ng},_Pm:function(){return lp},EsW:function(){return na},iUV:function(){return u.iUV},tf:function(){return u.tf},ZQ6:function(){return u.ZQ6},mXe:function(){return u.mXe},_fP:function(){return u._fP},iLg:function(){return u.iLg},zbs:function(){return u.zbs},ZTh:function(){return u.ZTh},HdW:function(){return u.HdW},UZH:function(){return u.UZH},mSO:function(){return u.mSO},wk1:function(){return u.wk1},E2K:function(){return u.E2K},FUD:function(){return u.FUD},pKu:function(){return u.pKu},GG6:function(){return u.GG6},Gih:function(){return u.Gih},iiP:function(){return u.iiP},SvJ:function(){return u.SvJ},ptH:function(){return u.ptH},jZA:function(){return u.jZA},y2t:function(){return u.y2t},gi4:function(){return u.gi4},Djp:function(){return u.Djp},BG$:function(){return u.BG$},NYV:function(){return u.NYV},xJs:function(){return u.xJs},bsb:function(){return u.bsb},ekQ:function(){return u.ekQ},CaW:function(){return u.CaW},eaV:function(){return u.eaV},BFQ:function(){return u.BFQ},v3W:function(){return u.v3W},ILR:function(){return u.ILR},G_r:function(){return u.G_r},N3F:function(){return Ct},fto:function(){return u.fto},l0P:function(){return u.l0P},vCx:function(){return u.vCx},_AM:function(){return u._AM},wuA:function(){return u.wuA},av9:function(){return u.av9},CtA:function(){return u.CtA},BvQ:function(){return zf},FZJ:function(){return ju},FIo:function(){return u.FIo},zHn:function(){return u.zHn},iMs:function(){return u.iMs},T_f:function(){return u.T_f},hEm:function(){return u.hEm},D9w:function(){return u.D9w},sHH:function(){return jg},CdI:function(){return u.CdI},rkc:function(){return Bc},rpg:function(){return u.rpg},ce8:function(){return u.ce8},rOj:function(){return u.rOj},P6m:function(){return rh},JA6:function(){return ca},V4E:function(){return u.V4E},o8S:function(){return u.o8S},flB:function(){return Br},lGU:function(){return u.lGU},vuL:function(){return u.vuL},KI_:function(){return u.KI_},iLN:function(){return tg},X6w:function(){return sm},rz_:function(){return Ec},jsw:function(){return Ea},srG:function(){return js},i6Z:function(){return jf},vfv:function(){return VE},xsS:function(){return u.xsS},or:function(){return KA},EQj:function(){return os},Rnn:function(){return $S},TyN:function(){return Pm},ov0:function(){return Kv},WdD:function(){return u.WdD},Vj0:function(){return u.Vj0},jyz:function(){return u.jyz},mTM:function(){return zc},Mn1:function(){return Mo},Hlq:function(){return vi},Fi7:function(){return Xl},Tn7:function(){return u.Tn7},bnF:function(){return u.bnF},HW6:function(){return u.HW6},oa8:function(){return u.oa8},T_1:function(){return u.T_1},zHJ:function(){return $l},iDF:function(){return u.iDF},iAb:function(){return u.iAb},d4E:function(){return ym},lBg:function(){return WA},JeJ:function(){return kR},FKY:function(){return g.SimpleEventDispatcher},zlZ:function(){return hC},vkg:function(){return Ar},brh:function(){return dC},kZK:function(){return ec},puG:function(){return qA},OdW:function(){return u.OdW},_YX:function(){return u._YX},TUv:function(){return u.TUv},Hw6:function(){return u.Hw6},aLr:function(){return u.aLr},Aip:function(){return u.Aip},xo$:function(){return u.xo$},bIn:function(){return ZU},$V:function(){return u.$V},lDi:function(){return u.lDi},gti:function(){return u.gti},PMe:function(){return u.PMe},iwP:function(){return Kd},FvO:function(){return u.FvO},jyi:function(){return u.jyi},xeV:function(){return u.xeV},k74:function(){return u.k74},RlZ:function(){return u.RlZ},KhW:function(){return u.KhW},HgB:function(){return u.HgB},W2J:function(){return u.W2J},JWc:function(){return u.JWc},u37:function(){return u.u37},Z6B:function(){return u.Z6B},QZ1:function(){return u.QZ1},Ir4:function(){return u.Ir4},NwF:function(){return u.NwF},Wbm:function(){return u.Wbm},N4l:function(){return u.N4l},Jxm:function(){return NE},ej9:function(){return kp},QmN:function(){return u.QmN},Y4W:function(){return g.TYPED_ARRAYS},IOt:function(){return u.IOt},NOD:function(){return im},L5g:function(){return u.L5g},H$k:function(){return u.H$k},cuP:function(){return ha},xEZ:function(){return u.xEZ},dpR:function(){return u.dpR},wOD:function(){return cl},KNb:function(){return W0},IiN:function(){return Df},Cne:function(){return u.Cne},XvJ:function(){return u.XvJ},XZw:function(){return u.XZw},FE5:function(){return u.FE5},Mck:function(){return Xp},lVp:function(){return Rb},CJI:function(){return u.CJI},z$h:function(){return u.z$h},UlW:function(){return u.UlW},WwZ:function(){return u.WwZ},zG7:function(){return Sc},Lcc:function(){return u.Lcc},WXh:function(){return u.WXh},Vjr:function(){return xS},LuM:function(){return v1},LP5:function(){return FP},ub3:function(){return u.ub3},OV:function(){return yl},G_n:function(){return nc},xfE:function(){return u.xfE},qlB:function(){return u.qlB},lCJ:function(){return u.lCJ},WTc:function(){return u.WTc},rAo:function(){return u.rAo},LZj:function(){return X0},xWb:function(){return u.xWb},gH0:function(){return u.gH0},rBU:function(){return u.rBU},rDY:function(){return u.rDY},ywz:function(){return u.ywz},wJv:function(){return u.wJv},JQ4:function(){return u.JQ4},k0A:function(){return u.k0A},irR:function(){return u.irR},LsT:function(){return u.LsT},q5h:function(){return cb},TKh:function(){return G1},tyg:function(){return lb},Ro5:function(){return Ul},dwk:function(){return u.dwk},t0w:function(){return FA},M7$:function(){return I0},ML4:function(){return NA},FM8:function(){return u.FM8},Pa4:function(){return u.Pa4},Ltg:function(){return u.Ltg},yC1:function(){return u.yC1},lHq:function(){return pl},fO1:function(){return u.fO1},oMA:function(){return ol},JzW:function(){return T},QEt:function(){return qu},IFZ:function(){return dv},b5g:function(){return u.b5g},Ywn:function(){return u.Ywn},GVz:function(){return u.GVz},oAp:function(){return u.oAp},kFz:function(){return u.kFz},dd2:function(){return u.dd2},CP7:function(){return u.CP7},fQK:function(){return u.fQK},Wd$:function(){return sC},t1_:function(){return bM},v27:function(){return Yv},Uk6:function(){return u.Uk6},H7Z:function(){return ey},_sL:function(){return u._sL},czO:function(){return uu},Pnf:function(){return u.Pnf},c8b:function(){return u.c8b},_lf:function(){return u._lf},ad5:function(){return u.ad5},sZV:function(){return j1},TfA:function(){return zv},sKX:function(){return Vv},UdM:function(){return ta},P0y:function(){return kh},L_r:function(){return u.L_r},zC5:function(){return g.absMax},Bve:function(){return Dx},b5G:function(){return pb},UeO:function(){return Su},qCx:function(){return fR},$nx:function(){return eS},Bk6:function(){return xu},EER:function(){return Ty},y4l:function(){return uc},P39:function(){return rm},HI1:function(){return g.aesGcmDecrypt},ZYi:function(){return g.aesGcmEncrypt},wXW:function(){return Bn},r5x:function(){return Ht},MSI:function(){return Di},EUu:function(){return sN},jtH:function(){return nu},T0T:function(){return tm},gAb:function(){return T1},je_:function(){return tR},wBP:function(){return Tg},LU2:function(){return d_},wQL:function(){return aN},Zs7:function(){return Lp},sMc:function(){return g.arrayBufferToBase64},x7s:function(){return Y_},Mnd:function(){return lN},A0_:function(){return cN},d73:function(){return pm},HCD:function(){return gr},YQ8:function(){return pu},RG9:function(){return Ni},G2P:function(){return zo},XLf:function(){return dy},CGN:function(){return _g},RGi:function(){return g.base64ToArrayBuffer},mvg:function(){return Bp},Hiy:function(){return _f},XMc:function(){return Gt},N7M:function(){return We},iv:function(){return qi},n55:function(){return g.blobToDataURL},IaC:function(){return Ma},h9t:function(){return p_},yDW:function(){return f_},gJv:function(){return qh},l$g:function(){return eI},vQi:function(){return kI},$MY:function(){return Nm},wJl:function(){return Iv},Z7Y:function(){return vg},X7D:function(){return zb},BnX:function(){return hy},uZ5:function(){return Vu},zVI:function(){return Jy},Wz1:function(){return g.colorToDataUrl},DpF:function(){return mb},nNb:function(){return Oo},cqZ:function(){return kl},pKN:function(){return gw},CN8:function(){return ly},DdI:function(){return vS},rrX:function(){return vw},uqj:function(){return Ge},Z9P:function(){return nt},KlC:function(){return Qf},KVn:function(){return ot},oau:function(){return eA},aw9:function(){return xs},Aap:function(){return Yr},Dxg:function(){return g.copyProps},MjT:function(){return Ja},F7Q:function(){return mg},IFq:function(){return FM},IJl:function(){return Wf},O5A:function(){return g.createCanvasElement},wCn:function(){return g.createDiv},gGT:function(){return u_},pEc:function(){return WT},Bi6:function(){return g.createImage},fi_:function(){return Cc},TT:function(){return _s},q2Z:function(){return WU},NyK:function(){return Nd},bgu:function(){return g.createScriptFromURL},kcS:function(){return g.createStyles},rRN:function(){return CS},ivY:function(){return g.css},_s1:function(){return AN},_HO:function(){return hi},tpL:function(){return Ci},DMK:function(){return Kf},LjN:function(){return Nv},iFs:function(){return xa},qTg:function(){return g.deepAccessObject},J4G:function(){return le},Zj8:function(){return iN},Wtl:function(){return Ue},DmK:function(){return gt},Htt:function(){return oR},Nv0:function(){return qe},tCp:function(){return re},Hx7:function(){return Yi},imt:function(){return ka},US6:function(){return Ho},vZs:function(){return cy},TE$:function(){return uN},lmu:function(){return g.downloadBlob},SvO:function(){return g.downloadFile},YQY:function(){return gg},mZN:function(){return uy},VvG:function(){return Fb},omp:function(){return g.embedUrlRefs},utz:function(){return ql},TFV:function(){return Qv},hrz:function(){return g.escapeRegExp},H$s:function(){return he},JKM:function(){return Ur},jZf:function(){return OM},RjL:function(){return m1},RRI:function(){return ud},RUq:function(){return $T},_t4:function(){return Sl},YHh:function(){return $a},R8g:function(){return Tt},f1L:function(){return g.getFileHandle},Bbl:function(){return g.getFilenameFromPath},V9r:function(){return g.getKeyByValue},a95:function(){return g.getNewFileHandle},PZ2:function(){return g.getOrCall},w7A:function(){return g.getPropertyDescriptor},N6S:function(){return be},Uxp:function(){return Ve},tAz:function(){return mt},R$F:function(){return Zt},N33:function(){return tt},JFD:function(){return Ft},gw2:function(){return Lu},rfc:function(){return g.getTypedArray},wo6:function(){return g.getUrlQueryParam},V4T:function(){return nl},H4P:function(){return g.glsl},NLp:function(){return R_},swA:function(){return Oh},_Z3:function(){return Yc},ivc:function(){return Oo},rZ1:function(){return kl},CpZ:function(){return K_},dyc:function(){return g.html},MxZ:function(){return g.htmlToCanvas},btp:function(){return g.htmlToPng},mXy:function(){return g.htmlToSvg},Ej0:function(){return Nc},ep4:function(){return Ud},DQP:function(){return Za},VNr:function(){return wl},V7q:function(){return g.imageBitmapToBase64},hiB:function(){return g.imageDataToCanvas},zEk:function(){return g.imageToCanvas},qfq:function(){return g.imageUrlToImageData},piB:function(){return g.includesAll},IIc:function(){return rN},rrF:function(){return ri},naq:function(){return sr},zlD:function(){return _e},sXR:function(){return Mp},p5I:function(){return M_},wps:function(){return I1},wuo:function(){return zM},GpE:function(){return g.isPropertyWritable},F4b:function(){return Wu},NN$:function(){return Ip},t$v:function(){return Wa},tdn:function(){return xc},Y9t:function(){return Cy},GEo:function(){return h_},GGm:function(){return g.longestCommonPrefix},DH3:function(){return nn},uxM:function(){return g.makeColorSvg},zH3:function(){return g.makeColorSvgCircle},MLs:function(){return tr},xXG:function(){return cr},YM4:function(){return S_},B3r:function(){return kM},iAx:function(){return g.makeTextSvg},lDn:function(){return cn},P1O:function(){return $},iib:function(){return Dt},qf5:function(){return At},n4s:function(){return Ye},fr:function(){return ft},Z9s:function(){return ye},oaQ:function(){return fg},CD7:function(){return Gu},Rc0:function(){return xg},iPG:function(){return Sp},TIc:function(){return g.mobileAndTabletCheck},xsC:function(){return or},zOc:function(){return g.now},i8W:function(){return g.objectHasOwn},r46:function(){return bx},z2C:function(){return g.onChange},N4A:function(){return g.onChange2},hjq:function(){return g.onChange3},_X$:function(){return g.parseFileExtension},_yn:function(){return Xn},Dyg:function(){return g.pathJoin},cUc:function(){return el},zGw:function(){return Ep},Ctq:function(){return W_},$ch:function(){return hN},k5b:function(){return th},kZl:function(){return Ta},OCg:function(){return cs},Kd3:function(){return g.prettyScrollbar},YjH:function(){return gm},Ui8:function(){return bC},YD2:function(){return bp},vi9:function(){return aR},ij3:function(){return Lt},pJq:function(){return g.readFile},YPW:function(){return Zy},_tY:function(){return g.remoteWorkerURL},Bg1:function(){return YU},kon:function(){return g.replaceAll},M3g:function(){return _p},F2z:function(){return Vo},pJF:function(){return ZT},knz:function(){return u.knz},Ejo:function(){return g.safeSetProperty},BgY:function(){return Ko},qCG:function(){return ke},HD9:function(){return Fi},Rgz:function(){return uf},fEB:function(){return Yo},Udc:function(){return Um},ZQg:function(){return df},ofC:function(){return mi},yRy:function(){return g.setUrlQueryParam},_NL:function(){return EN},LCA:function(){return wo},Sy1:function(){return HP},Vs_:function(){return QP},j1w:function(){return Hd},i8J:function(){return wN},p7C:function(){return _n},ZAS:function(){return $b},ipH:function(){return dN},$TF:function(){return cR},uZI:function(){return pN},VWG:function(){return Le},pQ7:function(){return oo},STw:function(){return Xh},jc8:function(){return bh},BL_:function(){return cd},S6:function(){return bN},T8U:function(){return Kc},TD6:function(){return wa},akS:function(){return g.svgToCanvas},QKE:function(){return g.svgToPng},dKx:function(){return g.svgUrl},OvX:function(){return nR},doP:function(){return Uc},$jA:function(){return gh},T99:function(){return vh},LJS:function(){return Om},VsW:function(){return g.timeout},LZE:function(){return Mt},YMc:function(){return lR},aPg:function(){return qr},LFn:function(){return g.toTitleCase},VsX:function(){return Me},wey:function(){return la},MaE:function(){return Bi},s4x:function(){return lc},FJA:function(){return ma},vIA:function(){return Eo},Spv:function(){return Vn},w8l:function(){return yh},riG:function(){return gi},Kbh:function(){return Jo},BFq:function(){return Ml},t8K:function(){return gn},Q7n:function(){return sn},KGF:function(){return Ks},e5:function(){return bt},Rik:function(){return Zm},GZo:function(){return ip},Bds:function(){return ja},HTu:function(){return Ym},cTq:function(){return g.uploadFile},X_Y:function(){return Pv},dA8:function(){return vf},NSm:function(){return mu},bwS:function(){return fm},Lks:function(){return fN},Rvq:function(){return sR},P4F:function(){return g.verifyPermission},Pd0:function(){return Jr},Pjo:function(){return Q_},Tum:function(){return Ro},dRH:function(){return ws},RX0:function(){return Us},reQ:function(){return mN},cWm:function(){return si},NC9:function(){return g.writeFile},$Re:function(){return V1},Xo9:function(){return Q0},LNO:function(){return Cs},iZP:function(){return Rf}}),function(a){a[a.Error=-2]="Error",a[a.Destroyed=-1]="Destroyed",a[a.None=0]="None",a[a.Running=1]="Running",a[a.Paused=2]="Paused"}(T||(T={}));var g=__webpackgi_require__2(8),u=__webpackgi_require__2(988);const O={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class z{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const W=new u.iKG(-1,1,1,-1,0,1),J=new u.u9r;J.setAttribute("position",new u.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),J.setAttribute("uv",new u.a$l([0,2,0,0,2,0],2));class se{constructor(e){this._mesh=new u.Kj0(J,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,W)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Y extends z{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof u.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=u.rDY.clone(e.uniforms),this.material=new u.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new se(this.material),this.useExistingRenderTarget=!1}render(e,t,n){this.uniforms[this.textureID]&&n&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class ie extends z{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),s=e.state;let o,l;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(o=0,l=1):(o=1,l=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),s.buffers.stencil.setClear(l),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class oe extends z{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class fe{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new u.FM8);this._width=n.width,this._height=n.height,(t=new u.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Y(O),this.clock=new u.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,s=this.passes.length;i<s;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const l=this.renderer.getContext(),h=this.renderer.state.buffers.stencil;h.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),h.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}ie!==void 0&&(o instanceof ie?n=!0:o instanceof oe&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new u.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class me extends fe{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const n=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=n)}}const de=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Pe(){const a=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(de[255&a]+de[a>>8&255]+de[a>>16&255]+de[a>>24&255]+"-"+de[255&e]+de[e>>8&255]+"-"+de[e>>16&15|64]+de[e>>24&255]+"-"+de[63&t|128]+de[t>>8&255]+"-"+de[t>>16&255]+de[t>>24&255]+de[255&n]+de[n>>8&255]+de[n>>16&255]+de[n>>24&255]).toLowerCase()}function ue(a,e,t){return Math.max(e,Math.min(t,a))}function He(a,e,t){return(1-t)*a+t*e}class je{constructor(e=0,t=0){je.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ue(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*i+e.x,this.y=s*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Fe extends u.ZzF{expandByObject(e,t=!1,n=!1,i){var s;if(((s=e.userData)==null?void 0:s.bboxVisible)===!1)return this;if(!e.visible&&n)return this;if(i&&i(e))return this;if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),et.copy(e.boundingBox),et.applyMatrix4(e.matrixWorld),this.union(et);else{const l=e.geometry;if(l!==void 0)if(t&&l.attributes!=null&&l.attributes.position!==void 0){const h=l.attributes.position;for(let d=0,f=h.count;d<f;d++)pt.fromBufferAttribute(h,d).applyMatrix4(e.matrixWorld),this.expandByPoint(pt)}else l.boundingBox===null&&l.computeBoundingBox(),et.copy(l.boundingBox),et.applyMatrix4(e.matrixWorld),this.union(et)}const o=e.children;for(let l=0,h=o.length;l<h;l++)this.expandByObject(o[l],t,n,i);return this}expandByObjects(e,t=!1,n=!1,i){for(let s=0,o=e.length;s<o;s++)this.expandByObject(e[s],t,n,i);return this}getPoints(){return[new u.Pa4(this.min.x,this.min.y,this.min.z),new u.Pa4(this.min.x,this.min.y,this.max.z),new u.Pa4(this.min.x,this.max.y,this.min.z),new u.Pa4(this.min.x,this.max.y,this.max.z),new u.Pa4(this.max.x,this.min.y,this.min.z),new u.Pa4(this.max.x,this.min.y,this.max.z),new u.Pa4(this.max.x,this.max.y,this.min.z),new u.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),n=new u.TUj;for(const i of t){const s=i.project(e);n.min.min(s),n.max.max(s)}return n}}const et=new Fe,pt=new u.Pa4;function Ge(a,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!a.hasAttribute("position")||!a.hasAttribute("normal")||!a.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function n(o){if(o.normalized||o.isInterleavedBufferAttribute){const l=new Float32Array(o.count*o.itemSize);for(let h=0,d=0;h<o.count;h++)l[d++]=o.getX(h),l[d++]=o.getY(h),o.itemSize>2&&(l[d++]=o.getZ(h));return l}return o.array instanceof Float32Array?o.array:new Float32Array(o.array)}const i=a.index?a.toNonIndexed():a,s=e.generateTangents(n(i.attributes.position),n(i.attributes.normal),n(i.attributes.uv));if(t)for(let o=3;o<s.length;o+=4)s[o]*=-1;return i.setAttribute("tangent",new u.TlE(s,4)),a!==i&&a.copy(i),a}function Ye(a,e=!1){const t=a[0].index!==null,n=new Set(Object.keys(a[0].attributes)),i=new Set(Object.keys(a[0].morphAttributes)),s={},o={},l=a[0].morphTargetsRelative,h=new u.u9r;let d=0;for(let f=0;f<a.length;++f){const v=a[f];let y=0;if(t!==(v.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const w in v.attributes){if(!n.has(w))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+'. All geometries must have compatible attributes; make sure "'+w+'" attribute exists among all geometries, or in none of them.'),null;s[w]===void 0&&(s[w]=[]),s[w].push(v.attributes[w]),y++}if(y!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". Make sure all geometries have the same number of attributes."),null;if(l!==v.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const w in v.morphAttributes){if(!i.has(w))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+".  .morphAttributes must be consistent throughout all geometries."),null;o[w]===void 0&&(o[w]=[]),o[w].push(v.morphAttributes[w])}if(e){let w;if(t)w=v.index.count;else{if(v.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". The geometry must have either an index or a position attribute"),null;w=v.attributes.position.count}h.addGroup(d,w,f),d+=w}}if(t){let f=0;const v=[];for(let y=0;y<a.length;++y){const w=a[y].index;for(let E=0;E<w.count;++E)v.push(w.getX(E)+f);f+=a[y].attributes.position.count}h.setIndex(v)}for(const f in s){const v=$(s[f]);if(!v)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+f+" attribute."),null;h.setAttribute(f,v)}for(const f in o){const v=o[f][0].length;if(v===0)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[f]=[];for(let y=0;y<v;++y){const w=[];for(let M=0;M<o[f].length;++M)w.push(o[f][M][y]);const E=$(w);if(!E)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+f+" morphAttribute."),null;h.morphAttributes[f].push(E)}}return h}function $(a){let e,t,n,i=0;for(let l=0;l<a.length;++l){const h=a[l];if(h.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=h.normalized),n!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=h.array.length}const s=new e(i);let o=0;for(let l=0;l<a.length;++l)s.set(a[l].array,o),o+=a[l].array.length;return new u.TlE(s,t,n)}function le(a){return a.isInstancedInterleavedBufferAttribute||a.isInterleavedBufferAttribute?qe(a):a.isInstancedBufferAttribute?new u.lb7().copy(a):new u.TlE().copy(a)}function _e(a){let e,t=0,n=0;for(let d=0,f=a.length;d<f;++d){const v=a[d];if(e===void 0&&(e=v.array.constructor),e!==v.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=v.array.length,n+=v.itemSize}const i=new u.vpT(new e(t),n);let s=0;const o=[],l=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"];for(let d=0,f=a.length;d<f;d++){const v=a[d],y=v.itemSize,w=v.count,E=new u.kB5(i,y,s,v.normalized);o.push(E),s+=y;for(let M=0;M<w;M++)for(let P=0;P<y;P++)E[h[P]](M,v[l[P]](M))}return o}function qe(a){const e=a.data.array.constructor,t=a.count,n=a.itemSize,i=a.normalized,s=new e(t*n);let o;o=a.isInstancedInterleavedBufferAttribute?new u.lb7(s,n,i,a.meshPerAttribute):new u.TlE(s,n,i);for(let l=0;l<t;l++)o.setX(l,a.getX(l)),n>=2&&o.setY(l,a.getY(l)),n>=3&&o.setZ(l,a.getZ(l)),n>=4&&o.setW(l,a.getW(l));return o}function re(a){const e=a.attributes,t=a.morphTargets,n=new Map;for(const i in e){const s=e[i];s.isInterleavedBufferAttribute&&(n.has(s)||n.set(s,qe(s)),e[i]=n.get(s))}for(const i in t){const s=t[i];s.isInterleavedBufferAttribute&&(n.has(s)||n.set(s,qe(s)),t[i]=n.get(s))}}function he(a){let e=0;for(const n in a.attributes){const i=a.getAttribute(n);e+=i.count*i.itemSize*i.array.BYTES_PER_ELEMENT}const t=a.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function ye(a,e=1e-4){const t=e>0;e=Math.max(e,Number.EPSILON);const n={},i=a.getIndex(),s=a.getAttribute("position"),o=i?i.count:s.count;let l=0;const h=Object.keys(a.attributes),d={},f={},v=[],y=["getX","getY","getZ","getW"],w=["setX","setY","setZ","setW"];for(let L=0,R=h.length;L<R;L++){const I=h[L],N=a.attributes[I];d[I]=new u.TlE(new N.array.constructor(N.count*N.itemSize),N.itemSize,N.normalized);const j=a.morphAttributes[I];j&&(f[I]=new u.TlE(new j.array.constructor(j.count*j.itemSize),j.itemSize,j.normalized))}const E=Math.log10(1/e),M=Math.pow(10,E);for(let L=0;L<o;L++){const R=i?i.getX(L):L;let I="";for(let N=0,j=h.length;N<j&&t;N++){const H=h[N],X=a.getAttribute(H),ne=X.itemSize;for(let pe=0;pe<ne;pe++)I+=~~(X[y[pe]](R)*M)+","}if(t&&I in n)v.push(n[I]);else{for(let N=0,j=h.length;N<j;N++){const H=h[N],X=a.getAttribute(H),ne=a.morphAttributes[H],pe=X.itemSize,Ae=d[H],ve=f[H];for(let Ee=0;Ee<pe;Ee++){const xe=y[Ee],we=w[Ee];if(Ae[we](l,X[xe](R)),ne)for(let Re=0,Be=ne.length;Re<Be;Re++)ve[Re][we](l,ne[Re][xe](R))}}t&&(n[I]=l),v.push(l),l++}}const P=a.clone();for(const L in a.attributes){const R=d[L];if(P.setAttribute(L,new u.TlE(R.array.slice(0,l*R.itemSize),R.itemSize,R.normalized)),L in f)for(let I=0;I<f[L].length;I++){const N=f[L][I];P.morphAttributes[L][I]=new u.TlE(N.array.slice(0,l*N.itemSize),N.itemSize,N.normalized)}}return P.setIndex(v),P}function Me(a,e){if(e===u.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===u.z$h||e===u.UlW){let t=a.getIndex();if(t===null){const o=[],l=a.getAttribute("position");if(l===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a;for(let h=0;h<l.count;h++)o.push(h);a.setIndex(o),t=a.getIndex()}const n=t.count-2,i=[];if(e===u.z$h)for(let o=1;o<=n;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2==0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=a.clone();return s.setIndex(i),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}function nt(a){const e=new u.Pa4,t=new u.Pa4,n=new u.Pa4,i=new u.Pa4,s=new u.Pa4,o=new u.Pa4,l=new u.Pa4,h=new u.Pa4,d=new u.Pa4;function f(Oe,at,st,St,dt,ht,Nt,Bt){e.fromBufferAttribute(at,dt),t.fromBufferAttribute(at,ht),n.fromBufferAttribute(at,Nt);const rn=Oe.morphTargetInfluences;if(st&&rn){l.set(0,0,0),h.set(0,0,0),d.set(0,0,0);for(let hn=0,wn=st.length;hn<wn;hn++){const Jn=rn[hn],Fn=st[hn];Jn!==0&&(i.fromBufferAttribute(Fn,dt),s.fromBufferAttribute(Fn,ht),o.fromBufferAttribute(Fn,Nt),St?(l.addScaledVector(i,Jn),h.addScaledVector(s,Jn),d.addScaledVector(o,Jn)):(l.addScaledVector(i.sub(e),Jn),h.addScaledVector(s.sub(t),Jn),d.addScaledVector(o.sub(n),Jn)))}e.add(l),t.add(h),n.add(d)}Oe.isSkinnedMesh&&(Oe.applyBoneTransform(dt,e),Oe.applyBoneTransform(ht,t),Oe.applyBoneTransform(Nt,n)),Bt[3*dt+0]=e.x,Bt[3*dt+1]=e.y,Bt[3*dt+2]=e.z,Bt[3*ht+0]=t.x,Bt[3*ht+1]=t.y,Bt[3*ht+2]=t.z,Bt[3*Nt+0]=n.x,Bt[3*Nt+1]=n.y,Bt[3*Nt+2]=n.z}const v=a.geometry,y=a.material;let w,E,M;const P=v.index,L=v.attributes.position,R=v.morphAttributes.position,I=v.morphTargetsRelative,N=v.attributes.normal,j=v.morphAttributes.position,H=v.groups,X=v.drawRange;let ne,pe,Ae,ve,Ee,xe,we;const Re=new Float32Array(L.count*L.itemSize),Be=new Float32Array(N.count*N.itemSize);if(P!==null)if(Array.isArray(y))for(ne=0,Ae=H.length;ne<Ae;ne++)for(Ee=H[ne],xe=Math.max(Ee.start,X.start),we=Math.min(Ee.start+Ee.count,X.start+X.count),pe=xe,ve=we;pe<ve;pe+=3)w=P.getX(pe),E=P.getX(pe+1),M=P.getX(pe+2),f(a,L,R,I,w,E,M,Re),f(a,N,j,I,w,E,M,Be);else for(xe=Math.max(0,X.start),we=Math.min(P.count,X.start+X.count),ne=xe,Ae=we;ne<Ae;ne+=3)w=P.getX(ne),E=P.getX(ne+1),M=P.getX(ne+2),f(a,L,R,I,w,E,M,Re),f(a,N,j,I,w,E,M,Be);else if(Array.isArray(y))for(ne=0,Ae=H.length;ne<Ae;ne++)for(Ee=H[ne],xe=Math.max(Ee.start,X.start),we=Math.min(Ee.start+Ee.count,X.start+X.count),pe=xe,ve=we;pe<ve;pe+=3)w=pe,E=pe+1,M=pe+2,f(a,L,R,I,w,E,M,Re),f(a,N,j,I,w,E,M,Be);else for(xe=Math.max(0,X.start),we=Math.min(L.count,X.start+X.count),ne=xe,Ae=we;ne<Ae;ne+=3)w=ne,E=ne+1,M=ne+2,f(a,L,R,I,w,E,M,Re),f(a,N,j,I,w,E,M,Be);return{positionAttribute:L,normalAttribute:N,morphedPositionAttribute:new u.a$l(Re,3),morphedNormalAttribute:new u.a$l(Be,3)}}function ft(a){if(a.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),a;let e=a.groups;if(e=e.sort((o,l)=>o.materialIndex!==l.materialIndex?o.materialIndex-l.materialIndex:o.start-l.start),a.getIndex()===null){const o=a.getAttribute("position"),l=[];for(let h=0;h<o.count;h+=3)l.push(h,h+1,h+2);a.setIndex(l)}const t=a.getIndex(),n=[];for(let o=0;o<e.length;o++){const l=e[o],h=l.start,d=h+l.count;for(let f=h;f<d;f++)n.push(t.getX(f))}a.dispose(),a.setIndex(n);let i=0;for(let o=0;o<e.length;o++){const l=e[o];l.start=i,i+=l.count}let s=e[0];a.groups=[s];for(let o=1;o<e.length;o++){const l=e[o];s.materialIndex===l.materialIndex?s.count+=l.count:(s=l,a.groups.push(s))}return a}function Mt(a,e=Math.PI/3){const t=Math.cos(e),n=100*(1+1e-10),i=[new u.Pa4,new u.Pa4,new u.Pa4],s=new u.Pa4,o=new u.Pa4,l=new u.Pa4,h=new u.Pa4;function d(M){return`${~~(M.x*n)},${~~(M.y*n)},${~~(M.z*n)}`}const f=a.toNonIndexed(),v=f.attributes.position,y={};for(let M=0,P=v.count/3;M<P;M++){const L=3*M,R=i[0].fromBufferAttribute(v,L+0),I=i[1].fromBufferAttribute(v,L+1),N=i[2].fromBufferAttribute(v,L+2);s.subVectors(N,I),o.subVectors(R,I);const j=new u.Pa4().crossVectors(s,o).normalize();for(let H=0;H<3;H++){const X=d(i[H]);X in y||(y[X]=[]),y[X].push(j)}}const w=new Float32Array(3*v.count),E=new u.TlE(w,3,!1);for(let M=0,P=v.count/3;M<P;M++){const L=3*M,R=i[0].fromBufferAttribute(v,L+0),I=i[1].fromBufferAttribute(v,L+1),N=i[2].fromBufferAttribute(v,L+2);s.subVectors(N,I),o.subVectors(R,I),l.crossVectors(s,o).normalize();for(let j=0;j<3;j++){const H=y[d(i[j])];h.set(0,0,0);for(let X=0,ne=H.length;X<ne;X++){const pe=H[X];l.dot(pe)>t&&h.add(pe)}h.normalize(),E.setXYZ(L+j,h.x,h.y,h.z)}}return f.setAttribute("normal",E),f}function At(a,e=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),Ye(a,e)}function Dt(a){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),$(a)}function ot(a,e){let t,n;if(Array.isArray(a))for(const s of a){const o=ot(s,e);t===void 0||n===void 0?(t=o.min.clone(),n=o.max.clone()):(t.min(o.min),n.max(o.max))}const i=a;if(i.geometry!==void 0){const s=i.geometry.vertices;if(s===void 0&&i.geometry.attributes!==void 0&&"position"in i.geometry.attributes){const o=new u.Pa4,l=i.geometry.attributes.position;for(let h=0;h<l.count*l.itemSize;h+=l.itemSize){o.set(l.array[h],l.array[h+1],l.array[3]);const d=o.applyMatrix4(a.matrixWorld).project(e),f=new je(d.x,d.y);t===void 0||n===void 0?(t=f.clone(),n=f.clone()):(t.min(f),n.max(f))}}else for(const o of s){const l=o.clone().applyMatrix4(a.matrixWorld).project(e),h=new je(l.x,l.y);t===void 0||n===void 0?(t=h.clone(),n=h.clone()):(t.min(h),n.max(h))}}if(a.children!==void 0)for(const s of a.children){const o=ot(s,e);t===void 0||n===void 0?(t=o.min.clone(),n=o.max.clone()):(t.min(o.min),n.max(o.max))}return new u.TUj(t,n)}const Ct="rgbm-16";function Tt(a){switch(a){case u.aCh:case u.GUF:return["Linear","( value )"];case u.KI_:return["sRGB","( value )"];case Ct:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",a),["Linear","( value )"]}}function Ft(a,e){let t;return a&&a.isTexture?t=a.colorSpace:a&&a.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=a.texture.colorSpace):t=u.GUF,e&&a&&a.isTexture&&a.format===u.wk1&&a.type===u.ywz&&a.colorSpace===u.KI_&&(t=u.GUF),t}function mt(a,e){const t=Tt(e);return"vec4 "+a+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function be(a,e,t){return mt(a+"TexelToLinear",Ft(e,t))+`
`}function Ve(a,e){return mt(a+"TexelToLinear",e)+`
`}function tt(a,e){const t=Tt(e);return"vec4 "+a+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Zt(a,e,t){return tt(a,Ft(e,t))}function bt({uniforms:a,propKey:e,thisTarget:t=!1}={}){const n=!!a,i=!!e,s=t;return(o,l)=>{const h=d=>{const f=s?d:n?a:d.uniforms||d._uniforms;let v=i?e:l;s&&(v="_"+v);let y=f[v];return y||(y={value:null},f[v]=y),y};Object.defineProperty(o,l,{get(){return h(this).value},set(d){h(this).value=d,(0,g.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function cn(a,e,t=!1,n){const i=!!e,s=!!a;return(o,l)=>{const h=d=>({t:i?e:d.defines||d._defines,p:s?a:l});Object.defineProperty(o,l,{get(){const{t:d,p:f}=h(t?this:this.material);return d[f]},set(d){const{t:f,p:v}=h(t?this:this.material);if((0,g.safeSetProperty)(f,v,d,!0),typeof n=="function"){const y=[v,d];if(n.name){const w=this[n.name];w===n?n.call(this,...y):w.name===`bound ${n.name}`?w(...y):n(...y)}else n(...y)}else(0,g.safeSetProperty)(t?this:this.material,"needsUpdate",!0,!0)}})}}function hi(a){const e=new u.IEO(new Uint8Array([Math.floor(255*a.r),Math.floor(255*a.g),Math.floor(255*a.b),255]),1,1,u.wk1,u.ywz);return e.needsUpdate=!0,e.colorSpace=u.aCh,e}function Ci(a){const e=new u.IEO(new Uint8Array([Math.floor(255*a.x),Math.floor(255*a.y),Math.floor(255*a.z),Math.floor(255*a.w)]),1,1,u.wk1,u.ywz);return e.needsUpdate=!0,e}function mi(a,e,t){const n=a.userData,{backgroundRender:i,transparentRender:s,shadowMapRender:o,mainRenderPass:l,opaqueRender:h,transmissionRender:d,sceneRender:f,screenSpaceRendering:v}=n;e.backgroundRender!==void 0&&(n.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(n.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(n.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(n.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(n.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(n.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(n.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(n.screenSpaceRendering=e.screenSpaceRendering),t(),n.backgroundRender=i,n.transparentRender=s,n.shadowMapRender=o,n.mainRenderPass=l,n.opaqueRender=h,n.sceneRender=f,n.transmissionRender=d,n.screenSpaceRendering=v}function gr(a){const e=new Fe().expandByObject(a,!0,!0).getCenter(new u.Pa4);a.position.sub(e),a.updateMatrix(),a.userData.autoCentered=!0,a.userData.isCentered=!0}function Ni(a,e,t){const n=.5*new Fe().expandByObject(a,!0,!0).getSize(new u.Pa4).length();e===void 0&&(e=a.userData.autoScaleRadius||1);const i=e/n;return isFinite(i)&&(a.userData.pseudoCentered?a.children.forEach(s=>{s.scale.multiplyScalar(i)}):a.scale.multiplyScalar(i),(t||a.userData.isCentered)&&a.position.multiplyScalar(i),a.traverse(s=>{var o,l;s.isLight&&((l=(o=s.shadow)==null?void 0:o.camera)!=null&&l.right)&&(s.shadow.camera.right*=i,s.shadow.camera.left*=i,s.shadow.camera.top*=i,s.shadow.camera.bottom*=i),s.isCamera&&s.right&&(s.right*=i,s.left*=i,s.top*=i,s.bottom*=i)}),a.userData.autoScaled=!0,a.userData.autoScaleRadius=e,a.dispatchEvent({type:"objectUpdate"})),a}function qr(a,e=-1){return ye(a,e)}const Er=2,vr=3,Ya=0,Ao=1,Fr=3,zr=4,Sr=1006,Dr=3001,_r="srgb",Oa="srgb-linear",bo="display-p3";class Mr{constructor(){Mr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,s,o,l,h,d){const f=this.elements;return f[0]=e,f[1]=i,f[2]=l,f[3]=t,f[4]=s,f[5]=h,f[6]=n,f[7]=o,f[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],l=n[3],h=n[6],d=n[1],f=n[4],v=n[7],y=n[2],w=n[5],E=n[8],M=i[0],P=i[3],L=i[6],R=i[1],I=i[4],N=i[7],j=i[2],H=i[5],X=i[8];return s[0]=o*M+l*R+h*j,s[3]=o*P+l*I+h*H,s[6]=o*L+l*N+h*X,s[1]=d*M+f*R+v*j,s[4]=d*P+f*I+v*H,s[7]=d*L+f*N+v*X,s[2]=y*M+w*R+E*j,s[5]=y*P+w*I+E*H,s[8]=y*L+w*N+E*X,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],l=e[5],h=e[6],d=e[7],f=e[8];return t*o*f-t*l*d-n*s*f+n*l*h+i*s*d-i*o*h}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],l=e[5],h=e[6],d=e[7],f=e[8],v=f*o-l*d,y=l*h-f*s,w=d*s-o*h,E=t*v+n*y+i*w;if(E===0)return this.set(0,0,0,0,0,0,0,0,0);const M=1/E;return e[0]=v*M,e[1]=(i*d-f*n)*M,e[2]=(l*n-i*o)*M,e[3]=y*M,e[4]=(f*t-i*h)*M,e[5]=(i*s-l*t)*M,e[6]=w*M,e[7]=(n*h-d*t)*M,e[8]=(o*t-n*s)*M,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,o,l){const h=Math.cos(s),d=Math.sin(s);return this.set(n*h,n*d,-n*(h*o+d*l)+o+e,-i*d,i*h,-i*(-d*o+h*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(Xs.makeScale(e,t)),this}rotate(e){return this.premultiply(Xs.makeRotation(-e)),this}translate(e,t){return this.premultiply(Xs.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Xs=new Mr;function lr(a){return a<.04045?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function Ka(a){return a<.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}const z0=new Mr().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),sc=new Mr().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Cv={[Oa]:a=>a,[_r]:a=>a.convertSRGBToLinear(),[bo]:function(a){return a.convertSRGBToLinear().applyMatrix3(sc)}},Cr={[Oa]:a=>a,[_r]:a=>a.convertLinearToSRGB(),[bo]:function(a){return a.applyMatrix3(z0).convertLinearToSRGB()}},fa={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(a){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!a},get workingColorSpace(){return Oa},set workingColorSpace(a){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(a,e,t){if(this.enabled===!1||e===t||!e||!t)return a;const n=Cv[e],i=Cr[t];if(n===void 0||i===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return i(n(a))},fromWorkingColorSpace:function(a,e){return this.convert(a,this.workingColorSpace,e)},toWorkingColorSpace:function(a,e){return this.convert(a,e,this.workingColorSpace)}},cf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ds={h:0,s:0,l:0},mh={h:0,s:0,l:0};function xl(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+6*(e-a)*t:t<.5?e:t<2/3?a+6*(e-a)*(2/3-t):a}class er{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=_r){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,fa.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=fa.workingColorSpace){return this.r=e,this.g=t,this.b=n,fa.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=fa.workingColorSpace){if(e=function(s,o){return(s%o+o)%o}(e,1),t=ue(t,0,1),n=ue(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=xl(o,s,e+1/3),this.g=xl(o,s,e),this.b=xl(o,s,e-1/3)}return fa.toWorkingColorSpace(this,i),this}setStyle(e,t=_r){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],l=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=_r){const n=cf[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=lr(e.r),this.g=lr(e.g),this.b=lr(e.b),this}copyLinearToSRGB(e){return this.r=Ka(e.r),this.g=Ka(e.g),this.b=Ka(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=_r){return fa.fromWorkingColorSpace(Xr.copy(this),e),65536*Math.round(ue(255*Xr.r,0,255))+256*Math.round(ue(255*Xr.g,0,255))+Math.round(ue(255*Xr.b,0,255))}getHexString(e=_r){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=fa.workingColorSpace){fa.fromWorkingColorSpace(Xr.copy(this),t);const n=Xr.r,i=Xr.g,s=Xr.b,o=Math.max(n,i,s),l=Math.min(n,i,s);let h,d;const f=(l+o)/2;if(l===o)h=0,d=0;else{const v=o-l;switch(d=f<=.5?v/(o+l):v/(2-o-l),o){case n:h=(i-s)/v+(i<s?6:0);break;case i:h=(s-n)/v+2;break;case s:h=(n-i)/v+4}h/=6}return e.h=h,e.s=d,e.l=f,e}getRGB(e,t=fa.workingColorSpace){return fa.fromWorkingColorSpace(Xr.copy(this),t),e.r=Xr.r,e.g=Xr.g,e.b=Xr.b,e}getStyle(e=_r){fa.fromWorkingColorSpace(Xr.copy(this),e);const t=Xr.r,n=Xr.g,i=Xr.b;return e!==_r?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(ds),ds.h+=e,ds.s+=t,ds.l+=n,this.setHSL(ds.h,ds.s,ds.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ds),e.getHSL(mh);const n=He(ds.h,mh.h,t),i=He(ds.s,mh.s,t),s=He(ds.l,mh.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Xr=new er;function cr(a,e){return{type:"folder",label:e+" Sampler",hidden:()=>!a[e],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[a[e],"repeat"],onChange:a==null?void 0:a.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[a[e],"offset"],onChange:a==null?void 0:a.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[a[e],"center"],onChange:a==null?void 0:a.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[a[e],"rotation"],onChange:a==null?void 0:a.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[a[e],"colorSpace"],children:[["Linear",u.GUF],["sRGB",u.KI_]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{const t=a[e];t&&(t.needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var t;return((t=a[e])==null?void 0:t.flipY)??!1},setValue:t=>{var n;const i=a[e];if(i&&i.flipY!==t)if(i.image&&ImageBitmap&&i.image instanceof ImageBitmap){const s=i,o=i.source.data;createImageBitmap(o,{imageOrientation:"flipY"}).then(l=>{var h;o.close&&o.close(),s.flipY=t,s.source.data=l,s.source.needsUpdate=!0,s.needsUpdate=!0,(h=a==null?void 0:a.setDirty)==null||h.call(a)})}else i.flipY=t,i.needsUpdate=!0,(n=a==null?void 0:a.setDirty)==null||n.call(a)}}),()=>({type:"dropdown",label:"Wrap S",property:[a[e],"wrapS"],children:[["ClampToEdge",u.uWy],["MirroredRepeat",u.OoA],["Repeat",u.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[a[e],"wrapT"],children:[["ClampToEdge",u.uWy],["MirroredRepeat",u.OoA],["Repeat",u.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[a[e],"anisotropy"],onChange:[()=>{a[e]&&(a[e].needsUpdate=!0),a.needsUpdate=!0},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[a[e],"minFilter"],children:[["Linear",Sr],["Nearest",u.TyD],["NearestMipmapNearest",u.YLQ],["NearestMipmapLinear",u.vZf],["LinearMipmapNearest",u.qyh],["LinearMipmapLinear",u.D1R]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[a[e],"magFilter"],children:[["Linear",Sr],["Nearest",u.TyD]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]})]}}er.NAMES=cf;const Ud=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function xs(a,e,t=!0){if(!e)return a;for(const n of Object.keys(e)){if(t&&Ud.includes(n)||n.startsWith("__"))continue;const i=e[n];if(typeof a[n]=="function"||typeof i=="function")continue;const s=!i||i.isTexture||i.isObject3D||i.isMaterial;s||typeof i.clone!="function"?s||typeof i!="object"&&!Array.isArray(i)?a[n]=i:a[n]=xs(Array.isArray(i)?[]:{},i,!1):a[n]=i.clone()}return a}const wl=["appliedMaterials","uuid"];function Ja(a,e){if(e)for(const t of Object.keys(e))wl.includes(t)||t.startsWith("__")||typeof a[t]!="function"&&typeof e[t]!="function"&&(a[t]=e[t]);return a}function gh(a,e,t){const n=(t==null?void 0:t.data)??new Uint8ClampedArray(a.height*a.width*4),i=a.data instanceof Float32Array,s=a.data instanceof Uint16Array;for(let o=0;o<n.length;o++)n[o]=i?255*a.data[o]:s?255*u.A5E.fromHalfFloat(a.data[o]):a.data[o],e===u.GUF&&(n[o]=255*(0,g.LinearToSRGB)(n[o]/255));return t??new ImageData(n,a.width,a.height)}function vh(a,e,t=!1){let n;return n=a.isDataTexture?gh(a.image,a.colorSpace):a.image,Uc(n,e,t)}function Uc(a,e,t=!1){const n=document.createElement("canvas");n.width=Math.min(e,a.width),n.height=Math.floor(1+n.width*a.height/a.width);const i=n.getContext("2d");if(!i)return console.error("textureToDataUrl: could not get canvas context"),n;t===!0&&(i.translate(0,n.height),i.scale(1,-1));let s=!1;if(a.data!==void 0){const o=a;if(a.width!==n.width||a.height!==n.height){const l=document.createElement("canvas");l.width=a.width,l.height=a.height;const h=l.getContext("2d");h?(h.putImageData(o,0,0),i.drawImage(l,0,0,n.width,n.height)):(console.error("textureToDataUrl: could not get temp canvas context"),i.putImageData(o,0,0))}else i.putImageData(o,0,0),t&&(s=!0)}else i.drawImage(a,0,0,n.width,n.height);return s?(0,g.canvasFlipY)(n):n}function Om(a,e,t,n,i){return vh(a,e,t).toDataURL(n,i)}String.prototype.replaceAll||(String.prototype.replaceAll=function(a,e){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,e):this.replace(new RegExp(a,"g"),e)});const Ls=new Map;function ke(a){return(e,t)=>{const n=e.constructor;if(n===Object)throw new Error("All properties in an object are serialized by default");Ls.has(n)||Ls.set(n,[]),Ls.get(n).push([a||t,t])}}const Yo={obj:(a,e)=>Object.fromEntries(Object.entries(a).map(([t,n])=>[t,Fi(n,!1,e)])),vec4:a=>({x:a.x,y:a.y,z:a.z,w:a.w,isVector4:!0}),vec3:a=>({x:a.x,y:a.y,z:a.z,isVector3:!0}),vec2:a=>({x:a.x,y:a.y,isVector2:!0}),color:a=>({r:a.r,g:a.g,b:a.b,isColor:!0}),quat:a=>({x:a.x,y:a.y,z:a.z,w:a.w,isQuaternion:!0}),texture:(a,e)=>{var t;if(!(a!=null&&a.isTexture))throw new Error("Expected a texture");if(e!=null&&e.textures[a.uuid])return{uuid:a.uuid,resource:"textures"};if(a.isRenderTargetTexture&&!((t=a.userData)!=null&&t.serializableRenderTarget))return;const n=a.source.data,i=!a.isRenderTargetTexture&&a.userData.rootPath;i&&a.source.data&&(a.userData.__embedUrlImagePreviews?a.source.data=vh(a,16,a.flipY):a.source.data=null);const s=a.userData;a.userData={};const o={images:{}};let l=a.toJSON(e||o);return!e&&l.image&&(l.image=i&&!a.userData.__embedUrlImagePreviews?void 0:o.images[l.image]),a.userData=s,l.userData=Fi(Ja({},s),!1,e),i&&(e&&!a.userData.__embedUrlImagePreviews&&delete e.images[a.source.uuid],a.source.data=n),e!=null&&e.textures&&!l.resource&&(e.textures[l.uuid]||(e.textures[l.uuid]=l),l={uuid:l.uuid,resource:"textures"}),l},material:(a,e)=>{if(!(a!=null&&a.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[a.uuid])return{uuid:a.uuid,resource:"materials"};a.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const t=e??{textures:{},images:{}},n={},i={};for(const[o,l]of Object.entries(a))if(l!=null&&l.isTexture&&!o.startsWith("__")){const h=Yo.texture(l,t);n[o]=h,i[o]=l,a[o]=h?{isTexture:!0,toJSON:()=>h}:null}let s=a.toJSON(e);for(const[o,l]of Object.entries(i))a[o]=l,delete i[o];if(e){for(const[o,l]of Object.entries(n))l&&(s[o]=l);e!=null&&e.materials&&(e.materials[s.uuid]||(e.materials[s.uuid]=s),s={uuid:s.uuid,resource:"materials"})}else{for(const[o,l]of Object.entries(n))l&&(s[o]=l.uuid);s.textures=Object.values(t.textures),s.images=Object.values(t.images)}return s}},xo=a=>(e,t)=>{var n;return((n=t==null?void 0:t.copy)==null?void 0:n.call(t,e))??new a().copy(e)},ka={obj:(a,e,t)=>Object.assign(e,Object.fromEntries(Object.entries(a).map(([n,i])=>[n,Yi(i,e==null?void 0:e[n],!1,t)]))),vec4:xo(u.Ltg),vec3:xo(u.Pa4),vec2:xo(je),color:xo(er),quat:xo(u._fP)};function Fi(a,e,t){var n;if(typeof a=="function")return;if(Array.isArray(a))return a.map(o=>Fi(o,!1,t));if(typeof a!="object"){if(typeof a=="number"){if(a===1/0)return"Infinity";if(a===-1/0)return"-Infinity";if(isNaN(a))return"NaN"}return a}if(!a)return a;let i=a.constructor??Object;if(i===Object)return Yo.obj(a,t);if(a.isVector2)return Yo.vec2(a);if(a.isVector3)return Yo.vec3(a);if(a.isVector4)return Yo.vec4(a);if(a.isColor)return Yo.color(a);if(a.isQuaternion)return Yo.quat(a);if(a.isTexture)return Yo.texture(a,t);if(a.isMaterial)return Yo.material(a,t);if(!e&&typeof a.toJSON=="function"){const o=a.toJSON(t);return a.serializableClassId&&o&&(o.serializableClassId=a.serializableClassId),o}const s={};for(;i&&i!==Object;)(n=Ls.get(i))==null||n.forEach(([o,l])=>{const h=a[l];s[o]=Fi(h,!1,t)}),i=Object.getPrototypeOf(i);return a.serializableClassId&&(s.serializableClassId=a.serializableClassId),s}function Yi(a,e,t,n){var i,s;let o=e;if(a===void 0)return o;if(typeof e=="number"){if(a==="Infinity")return 1/0;if(a==="-Infinity")return-1/0;if(a==="NaN")return NaN;if(typeof a=="number"||!a)return a}if(Array.isArray(a)){const d=a.length;Array.isArray(o)||(o=[]);for(let f=0;f<d;f++){const v=a[f],y=o.length>f?Yi(v,o[f],!1,n):Yi(v,void 0,!1,n);o.length<=f?o.push(y):o[f]=y}return o}let l=!1;if(a&&a.resource&&typeof a.resource=="string"&&(a=(i=n[a.resource])==null?void 0:i[a.uuid],l=!0),!o&&a&&!l)if(a.serializableClassId){const d=km.get(a.serializableClassId);d&&(o=d.DataInConstructor?new d(a):new d)}else typeof a!="object"||a.constructor&&a.constructor!==Object||(o={});if(typeof o=="function")return console.error("cannot deserialize over function",o,a),o;if(a&&typeof a=="object"&&!l){if(a.isVector2)return ka.vec2(a,o);if(a.isVector3)return ka.vec3(a,o);if(a.isVector4)return ka.vec4(a,o);if(a.isColor)return ka.color(a,o);if(a.isQuaternion)return ka.quat(a,o)}if(a==null||o==null||typeof o!="object"||o.isTexture)return l&&(a?a.__useCount=a.__useCount?a.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),a;let h=o.constructor??Object;if(h===Object)return ka.obj(a,o,n);if(!t&&typeof o.fromJSON=="function")return o.isMaterial&&(Object.entries(a).forEach(([d,f])=>{var v;if(!f||!f.resource||typeof f.resource!="string")return;const y=(v=n[f.resource])==null?void 0:v[f.uuid];a[d]=y||null}),a.userData&&(a.userData=Yi(a.userData,void 0,!1,n))),o.fromJSON(a,n),o;for(;h&&h!==Object;)(s=Ls.get(h))==null||s.forEach(([d,f])=>{const v=o[f],y=Yi(a[d],v,!1,n);y!==v&&(0,g.safeSetProperty)(o,f,y,!0)}),h=Object.getPrototypeOf(h);return o}const km=new Map;function Ko(a){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=a}},km.set(a,e),e)}function uf(a,e,t,n){var i,s,o;if(e!=null&&e.extras[a.uuid])return{uuid:a.uuid,resource:"extras"};let l="";if((i=a.source)!=null&&i._sourceImgBuffer||a.userData.__sourceBuffer){const d=new Uint8Array(((s=a.source)==null?void 0:s._sourceImgBuffer)||a.userData.__sourceBuffer),f=n||a.userData.mimeType||"";l={data:Array.from(d),type:d.constructor.name,path:((o=a.userData.__sourceBlob)==null?void 0:o.name)||a.userData.rootPath||"file."+f.split("/")[1]},f&&(l.mimeType=f)}else a.userData.rootPath?l=a.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const h={uuid:a.uuid,url:l,userData:Ja({},a.userData),type:a.type,name:t||a.name};return e!=null&&e.extras?(e.extras[a.uuid]=h,{uuid:a.uuid,resource:"extras"}):h}var du=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let El=class extends g.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(a){a!==this._displayCanvasScaling&&(this._displayCanvasScaling=a,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(a){this._pipeline=a,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){const a=this._passes,e=[],t={};for(const n of a){if(n.enabled===!1)continue;const i={after:n.after??[],before:n.before??[],dependencies:new Set(n.required??[])};t[n.passId]=i}for(const[n,i]of Object.entries(t)){const s=new Set([...i.after,...i.before]);i.dependencies.forEach(o=>s.has(o)&&s.delete(o)),s.forEach(o=>{const l=t[o];if(l){if(l.dependencies.has(n))throw console.error("cyclic",n,o),"Cyclic dependency";i.dependencies.add(o)}})}for(;;){let n=!1;const i=[...Object.entries(t)];for(const[s,o]of i)if(!e.includes(s)&&(0,g.includesAll)(e,o.dependencies.values())){const l=Math.max(-1,...o.after.map(d=>e.indexOf(d))),h=Math.min(e.length,...o.before.map(d=>{const f=e.indexOf(d);return f<0?e.length:f}));if(l>=h)throw console.error(o,a,e,l,h),"Not possible";e.splice(o.after.length>0?l+1:h,0,s),n=!0,delete t[s]}if(Object.keys(t).length<1)break;if(!n)throw console.error(i,t,e),"Not possible 2"}return this.pipeline=e,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(a,e){const t=a-this._lastTime;this._lastTime=a,this.frameWaitTime-=t,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:t,time:a,renderer:this,xrFrame:e}))}get clock(){return this._composer.clock}registerPass(a,e=!0){var t;if(e)for(const n of[...this._passes])a.passId===n.passId&&this.unregisterPass(n);this._passes.push(a),(t=a.onRegister)==null||t.call(a,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(a){var e;const t=this._passes.indexOf(a);t>=0&&((e=a.onUnregister)==null||e.call(a,this),this._passes.splice(t,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:a,canvas:e,alpha:t=!0,targetOptions:n}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new u.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new u.CP7({canvas:e,antialias:!1,alpha:t,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=i=>{this.dispatchEvent({type:"contextLost",event:i})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new u.FM8(e.clientWidth,e.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=u.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=u.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=u._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(n,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new me(this._renderer,this._composerTarget),a&&this.addEventListener("animationLoop",a)}setSize(a,e,t=!1){!t&&(a?Math.abs(a-this._renderSize.width):0)+(e?Math.abs(e-this._renderSize.height):0)<.1||(a&&(this._renderSize.width=a),e&&(this._renderSize.height=e),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(n=>{const i=n,s=i.sizeMultiplier;if(s){const o=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*s);i.setSize(Math.floor(o.width),Math.floor(o.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(a,e,{viewport:t,material:n,shader:i,pass:s,clear:o=!0}={}){const l=this._composer.copyPass,{renderToScreen:h,material:d,uniforms:f,clear:v}=l;n&&(l.material=n);const y=this._renderer.getViewport(new u.Ltg),w=this._renderer.autoClear,E=this._renderer.getRenderTarget();t&&this._renderer.setViewport(new u.Ltg().fromArray(t)),this._renderer.autoClear=!1,l.uniforms=l.material.uniforms,l.renderToScreen=!1,l.clear=o,mi(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{l.render(this._renderer,e??null,{texture:a},0,!1)}),l.renderToScreen=h,l.clear=v,l.material=d,l.uniforms=f,this._renderer.autoClear=w,t&&this._renderer.setViewport(y),this._renderer.setRenderTarget(E)}clearColor({r:a,g:e,b:t,a:n,target:i,depth:s=!0,stencil:o=!0}){const l=this._renderer.getClearColor(new u.Ilk),h=this._renderer.getClearAlpha();this._renderer.setClearAlpha(n??h),this._renderer.setClearColor(new u.Ilk(a??l.r,e??l.g,t??l.b));const d=this._renderer.getRenderTarget(),f=this._renderer.getActiveCubeFace(),v=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget(i??null),this._renderer.clear(!0,s,o),this._renderer.setRenderTarget(d,f,v),this._renderer.setClearColor(l),this._renderer.setClearAlpha(h)}renderModel(a,e){this._renderer.render(a.modelObject,e.cameraObject)}renderScene(a){const e=a.activeCamera;e&&this.renderModel(a,e)}_updated(){this.dispatchEvent({type:"update"})}render(a=!0){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const t of this._passes)t.passObject.enabled&&((e=t.update)==null||e.call(t));this._composer.renderToScreen=a,this._composer.render(),this._composer.renderToScreen=!0,a&&(this._frameCount+=1,this._totalFrameCount+=1),this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(a=>a.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const a=[];for(const e of this._pipeline){const t=this._passes.find(n=>n.passId===e);t?a.push(t.passObject):console.warn("Unable to find pass: ",e)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),a.forEach(e=>this._composer.addPass(e)),this._updated()}dispose(){this._trackedTargets.forEach(a=>a.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(a){this._trackedTargets.push(a)}removeTrackedTarget(a){const e=this._trackedTargets.indexOf(a);e>=0&&this._trackedTargets.splice(e,1)}createTarget({sizeMultiplier:a,samples:e=0,colorSpace:t=u.aCh,type:n=u.ywz,format:i=u.wk1,depthBuffer:s=!0,depthTexture:o=!1,size:l,textureCount:h=1,...d}={},f=!0){this.isWebGL2||(e=0),a!==void 0&&l!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(l=l||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(a=a||1))).width=Math.floor(l.width),l.height=Math.floor(l.height);const v=o?new u.$YQ(l.width,l.height,u.ywz):void 0,y=this.createTargetCustom(h>1?{width:l.width,height:l.height,count:h}:l,{samples:e,colorSpace:t,type:n,format:i,depthBuffer:s,depthTexture:v},h>1?u.kFz:u.dd2);return this._processNewTarget(y,a,f),this._setTargetOptions(y,d),y}_processNewTarget(a,e,t){return e!==void 0&&(a.sizeMultiplier=e),t&&this.trackTarget(a),a}disposeTarget(a){if(a){if(a.isTemporary)return this.releaseTempTarget(a);this.removeTrackedTarget(a),a.dispose()}}createTargetCustom({width:a,height:e,count:t},n={},i){const s=this._processNewTarget,o=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let l=[a,e];if(t&&t>1&&l.push(t),(i==null?void 0:i.prototype)===u.oAp.prototype){if(a!==e)throw"Width and height of cube render target must be equal";l=[a]}n={format:u.wk1,minFilter:u.wem,magFilter:u.wem,generateMipmaps:!1,type:u.ywz,colorSpace:u.aCh,...n};const h=[this,...l,n];return new class extends(i??u.dd2){constructor(d,...f){super(...f),this.renderer=d,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(v=>{v.colorSpace=n.colorSpace,v.toJSON=()=>(console.warn("Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(v){console.warn("Render target texture.toJSON might be buggy."),this.source.data.url=o(this.__target,"image/png",90);const y=this.__toJSON.call(this,v);return delete this.source.data.url,y.isRenderTargetTexture=!0,y})}setSize(d,f,v){super.setSize(Math.floor(d),Math.floor(f),v)}clone(d=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const f=super.clone();return f.texture.isRenderTargetTexture=!0,s(f,this.sizeMultiplier||1,d)}}(...h)}getTempTarget(a={}){var e;const t=Nd(a);let n;return(e=this._tempTargets[t])!=null&&e.length&&(n=this._tempTargets[t].pop()),n?this._setTargetOptions(n,a):(n=this.createTarget(a),this._processNewTempTarget(n,t)),n}_processNewTempTarget(a,e){return a.isTemporary=!0,a.targetKey=e,this._tempTargets[e]===void 0&&(this._tempTargets[e]=[]),a}releaseTempTarget(a){const e=a.targetKey;if(!e||!a.isTemporary)throw"Not a temp target";this._tempTargets[e].length>this.maxTempPerKey?a.dispose():this._tempTargets[e].push(a)}updateShaderProperties(a){return this.stableNoise?a.uniforms.frameCount?a.uniforms.frameCount.value=this._totalFrameCount:console.warn("BaseRenderer: no uniform: frameCount"):a.uniforms.frameCount?a.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),a.uniforms.frameCount2&&(a.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(a,e){a.texture.minFilter=e.minFilter??u.wem,a.texture.magFilter=e.magFilter??u.wem,a.texture.generateMipmaps=e.generateMipmaps??!1,a.texture.generateMipmaps&&a.texture.minFilter===u.wem&&(a.texture.minFilter=u.FDw),a.texture.generateMipmaps||a.texture.minFilter!==u.FDw||(a.texture.minFilter=u.wem)}renderTargetToDataUrl(a,e="image/png",t=90){const n=document.createElement("canvas");n.width=a.width,n.height=a.height;const i=n.getContext("2d");if(!i)throw new Error("Unable to get 2d context");const s=i.createImageData(a.width,a.height,{colorSpace:["display-p3","srgb"].includes(a.texture.colorSpace)?a.texture.colorSpace:void 0});if(a.texture.type===u.cLu){const l=new Uint16Array(a.width*a.height*4);this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,l),gh({data:l,width:a.width,height:a.height},a.texture.colorSpace,s)}else if(a.texture.type===u.VzW){const l=new Float32Array(a.width*a.height*4);this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,l),gh({data:l,width:a.width,height:a.height},a.texture.colorSpace,s)}else this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,s.data);i.putImageData(s,0,0);const o=n.toDataURL(e,t);return n.remove(),o}renderTargetToBuffer(a){const e=a.texture.type===u.cLu?new Uint16Array(a.width*a.height*4):new Uint8Array(a.width*a.height*4);return this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,e),e}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(a){this.rendererObject.useLegacyLights=a,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(a){console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=a}get renderScale(){return this.displayCanvasScaling}set renderScale(a){this.displayCanvasScaling=a}};function Nd(a={}){var e,t;return[a.sizeMultiplier,a.samples,a.colorSpace,a.type,a.format,a.depthBuffer,a.depthTexture,(e=a.size)==null?void 0:e.width,(t=a.size)==null?void 0:t.height].join(";")}function pu(a){var e,t,n,i,s,o,l,h,d;if(!a.isMaterial&&!a.isBufferGeometry)return;const f=Array.from(a.userData.__appliedMeshes).filter(E=>!E.isInstancedMesh&&!!E.parent&&E.children.length===0&&!Array.isArray(E.material));if(f.length<2)return;const v=new Map;for(const E of f){const M=(y=E).parent.uuid+"_"+y.geometry.uuid+"_"+((e=y.material)==null?void 0:e.uuid);v.has(M)||v.set(M,[]),v.get(M).push(E),E.updateMatrix()}var y;const w=v.keys();for(const E of w){const M=v.get(E),P=M[0];if(!P||M.length<2)continue;const L=new u.SPe(P.geometry,P.material,M.length),R=P.userData;P.userData={},L.copy(P),Yr(L.userData,R);const I=P.parent;L.position.set(0,0,0),L.rotation.set(0,0,0),L.scale.set(1,1,1),L.updateMatrix();const N=new Float32Array(3*L.count),j=new Float32Array(4*L.count),H=new Float32Array(3*L.count);for(let X=0;X<M.length;X++){const ne=M[X],pe=ne.matrix;pe.determinant()<0&&(pe.elements[0]*=-1,pe.elements[1]*=-1,pe.elements[2]*=-1),L.setMatrixAt(X,pe),ne.position.toArray(N,3*X),ne.quaternion.toArray(j,4*X),ne.scale.toArray(H,3*X),ne.removeFromParent(),(i=(n=(t=ne.material)==null?void 0:t.userData)==null?void 0:n.__appliedMeshes)==null||i.delete(ne),(l=(o=(s=ne.geometry)==null?void 0:s.userData)==null?void 0:o.__appliedMeshes)==null||l.delete(ne)}(d=(h=L.material.userData)==null?void 0:h.__appliedMeshes)==null||d.add(L),L.geometry.userData.__appliedMeshes.add(L),L.sourceTrs={TRANSLATION:new u.TlE(N,3),ROTATION:new u.TlE(j,4),SCALE:new u.TlE(H,3)},L.instanceMatrix.needsUpdate=!0,I.add(L),I.setDirty()}}du([ke()],El.prototype,"stableNoise",void 0),du([ke()],El.prototype,"useLegacyLights",null),El=du([Ko("RenderManager")],El);class hf{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const n=this.writer,i=e;let s=i.sourceTrs;if(!s){const o=new Float32Array(3*i.count),l=new Float32Array(4*i.count),h=new Float32Array(3*i.count),d=new u.yGw,f=new u.Pa4,v=new u._fP,y=new u.Pa4;for(let w=0;w<i.count;w++)i.getMatrixAt(w,d),d.decompose(f,v,y),f.toArray(o,3*w),v.toArray(l,4*w),y.toArray(h,3*w);s={TRANSLATION:new u.TlE(o,3),ROTATION:new u.TlE(l,4),SCALE:new u.TlE(h,3)}}s={TRANSLATION:n.processAccessor(s.TRANSLATION),ROTATION:n.processAccessor(s.ROTATION),SCALE:n.processAccessor(s.SCALE)},i.instanceColor&&(s.COLOR=n.processAccessor(new u.TlE(i.instanceColor.array,3))),n.extensionsUsed[this.name]=!0,n.extensionsRequired[this.name]=!0,t.extensions=t.extensions||{},t.extensions[this.name]={attributes:s}}}function Fd(a,e){if(a.uiConfig)return a.uiConfig;const t={type:"folder",label:()=>a.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[a,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{a.dispatchEvent({type:"select",ui:!0,value:a,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!a.parent,value:()=>{const s=a.parent;s&&s.dispatchEvent({type:"select",ui:!0,value:s})}},{type:"input",label:"Name",property:[a,"name"],onChange:s=>{var o;s.last&&((o=a.setDirty)==null||o.call(a,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!a.isMesh,property:[a,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!a.isMesh,property:[a,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[a,"frustumCulled"]},{type:"vec3",label:"Position",property:[a,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[a,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[a,"scale"]},{type:"input",label:"Render Order",property:[a,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",a.userData.autoScaleRadius||"2",!0],value:s=>{if(!s)return;const o=parseFloat(s);Math.abs(o)>0&&Ni(a,o)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&gr(a)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(s=>({type:"button",label:"Rotate "+s+"90",value:()=>{var o;a.rotateOnAxis(new u.Pa4(s.includes("X")?1:0,s.includes("Y")?1:0,s.includes("Z")?1:0),Math.PI/2*(s.includes("-")?-1:1)),(o=a.setDirty)==null||o.call(a,{sceneUpdate:!0,refreshUi:!1})}}))},a.userData.license!==void 0?{type:"input",label:"License/Credits",property:[a.userData,"license"],limitedUi:!0}:{}]},n=a;if(n!=null&&n.isMesh&&e!==!1){const s=[()=>{const o=Object.entries(n.morphTargetDictionary||{});return o.length?{label:"Morph Targets",type:"folder",children:o.map(([l,h])=>({type:"slider",label:l,bounds:[0,1],stepSize:1e-4,property:[n.morphTargetInfluences,h],onChange:d=>{var f;(f=a.setDirty)==null||f.call(a,{sceneUpdate:d.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var o;return(o=n.geometry)==null?void 0:o.uiConfig},()=>{var o;return Array.isArray(n.material)?n.material.length<1?void 0:{label:"Materials",type:"folder",children:n.material.map(l=>l==null?void 0:l.uiConfig).filter(l=>l)}:(o=n.material)==null?void 0:o.uiConfig}];t.children.push(...s)}const i=a;if(i!=null&&i.isCamera){const s=[{type:"button",label:"Set View",value:()=>{var o;a.dispatchEvent({type:"setView",ui:!0,camera:a}),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var o;return(o=a.userData.iCamera)==null?void 0:o.isActiveCamera},value:()=>{var o;a.dispatchEvent({type:"activateMain",ui:!0,camera:a}),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var o;return!((o=a.userData.iCamera)!=null&&o.isActiveCamera)},value:()=>{var o;a.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>a.userData.autoLookAtTarget??!1,setValue:o=>{var l;a.userData.autoLookAtTarget=o,(l=t.uiRefresh)==null||l.call(t,"postFrame",!0)}}];t.children.push(...s)}return a.uiConfig=t,t}function wo(a,e,t){if(!a)return void console.warn("setupIModel: object is undefined");if(a.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",a),delete a.__disposed),a.userData||(a.userData={}),a.userData.__iModelSetup&&a.modelObject)return a;a.userData.__iModelSetup=!0;let n=[];n.push(()=>{[...a.children].forEach(f=>{var v;(v=f==null?void 0:f.dispose)==null||v.call(f),a.add(f)}),a.parent&&a.removeFromParent()}),a.isLight&&!a.assetType?(a.assetType="light",a.lightObject=a):a.isCamera?(a.assetType="camera",a.cameraObject=a):a.assetType||(a.assetType="model"),a.modelObject||(a.modelObject=a),a.setDirty||(a.setDirty=(f={})=>{a.dispatchEvent({...f,type:"objectUpdate",object:a})},a.userData.setDirty&&console.warn("userData.setDirty already defined",a.userData.setDirty,a),a.userData.setDirty=f=>{var v;console.warn("userData.setDirty is deprecated, use setDirty directly"),(v=a.setDirty)==null||v.call(a,f)}),a.addEventListener("added",f=>{var v,y;const w=((v=a.parent)==null?void 0:v.userData.parentRoot)??a.parent;w!==a.userData.parentRoot&&a.traverse(E=>{E.userData.parentRoot=w}),(y=a.setDirty)==null||y.call(a,{change:"addedToParent"})}),a.addEventListener("removed",()=>{var f;(f=a.setDirty)==null||f.call(a,{change:"removedFromParent"}),a.userData.parentRoot!==void 0&&a.traverse(v=>{v.userData.parentRoot=void 0})}),n.push(()=>{});const i=a.dispose;a.dispose=()=>{a.dispatchEvent({type:"dispose"}),i==null||i.call(a)},a.userData.dispose&&console.warn("userData.dispose already defined"),a.userData.dispose=()=>{var f;console.warn("userData.dispose is deprecated, use dispose directly"),(f=a.dispose)==null||f.call(a)};const s=a;!s.isMesh&&!s.isLine||s.userData.__meshSetup||(s.userData.__meshSetup=!0,s.setMaterial||(s.setMaterial=f=>df(s,f)),s.setGeometry||(s.setGeometry=(f,v=!1)=>Um(s,f,v),s.setGeometry(s.geometry,!0)),a.userData.setMaterial&&console.warn("userData.setMaterial already defined"),a.userData.setMaterial=f=>{var v;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(v=a.setMaterial)==null||v.call(a,f)},a.userData.setGeometry&&console.warn("userData.setGeometry already defined"),a.userData.setGeometry=(f,...v)=>{var y;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(y=a.setGeometry)==null||y.call(a,f,...v)},a.userData.__keepShadowDef||(a.castShadow=!0,a.receiveShadow=!0,a.userData.__keepShadowDef=!0),n.push(()=>{var f,v,y,w,E,M;const P=((f=s.setMaterial)==null?void 0:f.call(s,void 0))||[],L=(v=s.setGeometry)==null?void 0:v.call(s,void 0);for(const R of P)R&&R.userData&&((y=R.userData.__appliedMeshes)==null?void 0:y.size)===0&&R.userData.disposeOnIdle!==!1&&R.dispose();L&&L.userData&&((w=L.userData.__appliedMeshes)==null?void 0:w.size)===0&&L.userData.disposeOnIdle!==!1&&L.dispose(),(E=s.setMaterial)==null||E.call(s,P),(M=s.setGeometry)==null||M.call(s,L)})),a.uiConfig||a.assetType!=="model"&&a.assetType!=="camera"||(Fd(a),n.push(()=>{})),a.addEventListener("objectUpdate",({refreshUi:f})=>{var v,y;return f!==!1&&((y=(v=a.uiConfig)==null?void 0:v.uiRefresh)==null?void 0:y.call(v,"postFrame",!0,1))}),a.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(a.userData.__autoParentDispatchEvents=a.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],a.isCamera&&a.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(a.userData.parentRoot=e);const o=a.dispatchEvent;a.dispatchEvent=f=>{var v;(v=a.userData.__autoParentDispatchEvents)!=null&&v.includes(f.type)&&(f.parentDispatch=!0),f.parentDispatch&&(y=>{const w=a.userData.parentRoot??a.parent;w!=null&&w.modelObject&&w.dispatchEvent(y)})(f),o.call(a,f)};const l=a.clone;a.clone=(...f)=>{const v=a.userData;a.userData={};let y=l.call(a,...f);a.userData=v,Yr(y.userData,v);const w=a.userData.parentRoot;return w&&w.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),y=wo(y,w,t),y.userData.cloneParent=a.uuid,y};const h=a.copy;a.copy=(f,...v)=>{const y=f.userData;f.userData={};const w=h.call(a,f,...v);return f.userData=y,Yr(a.userData,f),w};const d=a.add;return a.add=(...f)=>(f.forEach(v=>wo(v,a.userData.parentRoot||a,t)),d.call(a,...f)),(a=(t==null?void 0:t(a))??a).addEventListener("dispose",()=>{n.forEach(f=>f()),n=[]}),[...a.children].forEach(f=>wo(f,a,t)),a}function df(a,e){var t,n,i,s;const o=(Array.isArray(e)?e:[e]).map(d=>d==null?void 0:d.materialObject).filter(d=>d);if(a.material==o||o.length===1&&a.material===o[0])return[];a.userData.__materialUpdater||(a.userData.__materialUpdater=()=>{a.dispatchEvent({type:"materialUpdate"})}),a.userData.__textureUpdater||(a.userData.__textureUpdater=()=>{a.dispatchEvent({type:"textureUpdate"})});const l=Array.isArray(a.material)?[...a.material]:[a.material];for(const d of l)d&&(d.removeEventListener("materialUpdate",a.userData.__materialUpdater),d.removeEventListener("textureUpdate",a.userData.__textureUpdater),(n=(t=d.userData)==null?void 0:t.__appliedMeshes)==null||n.delete(a));const h=[];for(const d of o)d.userData.__appliedMeshes||(d.userData.__appliedMeshes=new Set),h.push(d),d&&(d.addEventListener("materialUpdate",a.userData.__materialUpdater),d.addEventListener("textureUpdate",a.userData.__textureUpdater),d.userData.__appliedMeshes.add(a));return a.material=h.length!==1?h:h[0]??void 0,a.dispatchEvent({type:"materialChanged",material:e,mesh:a}),(s=(i=a.uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0),l}function Um(a,e,t=!1){var n,i,s,o,l,h;a.userData.__objectUpdater||(a.userData.__objectUpdater=v=>{a.dispatchEvent({...v,type:"objectUpdate"})});let d=a.geometry;const f=d;return(d!==e||t)&&(d&&(d.removeEventListener("geometryUpdate",a.userData.__objectUpdater),(i=(n=d.userData)==null?void 0:n.__appliedMeshes)==null||i.delete(a)),d=e,d&&!d.userData.__appliedMeshes&&(d.userData.__appliedMeshes=new Set),a.geometry=d??void 0,d&&(a.updateMorphTargets(),d.addEventListener("geometryUpdate",a.userData.__objectUpdater),(o=(s=d.userData)==null?void 0:s.__appliedMeshes)==null||o.add(a))),e&&!e.uiConfig&&(e.uiConfig=function(v){return{label:"Geometry",type:"folder",children:[{type:"input",property:[v,"uuid"],disabled:!0},{type:"input",property:[v,"name"]},{type:"button",label:"Center Geometry",value:()=>{v.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const y=new u.Pa4;v.center(y),v.userData.__appliedMeshes.forEach(w=>{w.position.sub(y),w.setDirty&&w.setDirty()})}},{type:"button",label:"Compute vertex normals",value:()=>{v.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{v.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{v.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!v.index,value:()=>{if(v.attributes.index)return;const y=parseFloat(prompt("Tolerance","-1")??"-1");qr(v,y)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!v.index,value:()=>{v.attributes.index&&v.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{v.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||v.setAttribute("uv1",v.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!v.hasAttribute("color"),value:()=>{v.hasAttribute("color")?confirm("Remove color attribute?")&&v.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!v.userData.__appliedMeshes||v.userData.__appliedMeshes.size<2,value:()=>{pu(v)}},{type:"input",label:"Mesh count",get value(){var y,w;return((w=(y=v.userData)==null?void 0:y.__appliedMeshes)==null?void 0:w.size)??0},set value(y){},disabled:!0}]}}(a.geometry)),a.dispatchEvent({type:"geometryChanged",geometry:e}),(h=(l=a.uiConfig)==null?void 0:l.uiRefresh)==null||h.call(l,"postFrame",!0),f===d?void 0:f||void 0}const Nc=["appliedMeshes"],Za=["parentRoot","iCamera","iModel"];function Yr(a,e){if(e)for(const t of Object.keys(e))Za.includes(t)||t.startsWith("__")||typeof a[t]!="function"&&typeof e[t]!="function"&&(a[t]=e[t]);return a}var ac,pf=new Uint8Array(16);function _h(){if(!ac&&!(ac=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ac(pf)}for(var zd=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,ps=[],oc=0;oc<256;++oc)ps.push((oc+256).toString(16).substr(1));var ff=function(a){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(ps[a[e+0]]+ps[a[e+1]]+ps[a[e+2]]+ps[a[e+3]]+"-"+ps[a[e+4]]+ps[a[e+5]]+"-"+ps[a[e+6]]+ps[a[e+7]]+"-"+ps[a[e+8]]+ps[a[e+9]]+"-"+ps[a[e+10]]+ps[a[e+11]]+ps[a[e+12]]+ps[a[e+13]]+ps[a[e+14]]+ps[a[e+15]]).toLowerCase();if(!function(n){return typeof n=="string"&&zd.test(n)}(t))throw TypeError("Stringified UUID is invalid");return t},Ys=function(a,e,t){var n=(a=a||{}).random||(a.rng||_h)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return ff(n)};const fu=new Map;function ma(a,e){return(t,n)=>{const i=t.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");fu.has(i)||fu.set(i,[]);const s=fu.get(i);if(!(s.findIndex(o=>o.propKey===n)<0))throw new Error(`Property ${n} already has a uiConfig decorator`);s.push({params:e||{},propKey:n,uiType:a})}}function sn(a,e){return ma("checkbox",{label:a,params:e})}function Jo(a,e){return ma("monitor",{label:a,params:e})}function gn(a,e,t,n){return ma("slider",{label:a,bounds:e,stepSize:t,params:n})}function Ks(a,e,t,n){return ma("vec",{label:a,bounds:e,stepSize:t,params:n})}function Eo(a,e,t){return ma("dropdown",{label:a,children:e,params:t})}function Bi(a,e){return ma("button",{label:a,params:e})}function gi(a,e){return ma("input",{label:a,params:e})}function lc(a,e){return ma("color",{label:a,params:e})}function yh(a,e){return ma("image",{label:a,params:e})}function Sl(a){let e=a==null?void 0:a.constructor;if(!a||!e)return[];const t=[],n=[];for(;e&&e!==Object;)n.push(e),e=Object.getPrototypeOf(e);if(!n.length){const i=typeof a=="object"?Object.keys(a):Array.isArray(a)?a.map((s,o)=>o):[];for(const s of i){const o=a[s];if(o==null)continue;const l=o==null?void 0:o.uiConfig;if(l)t.push(l);else{const h=mu(o);h==="folder"?t.push($a(s+"",o)):h&&t.push({type:h,label:s+"",property:[a,s]})}}}return n.reverse().forEach(i=>{var s;(s=fu.get(i))==null||s.forEach(({params:o,propKey:l,uiType:h})=>{let d;if(!h){const f=a[l];d=f==null?void 0:f.uiConfig,d?t.push(d):f!=null&&((h=mu(f))==="folder"?d=$a(l+"",f):h&&(d={type:h,label:l+"",property:[a,l]}))}if(d||(d={property:[a,l],type:h||"input"}),o){const f=typeof o.params=="function"?o.params(a):o.params||{};delete o.params,Object.assign(d,{...o,...f})}t.push(d)})}),t}function $a(a,e,t={},n="folder"){return{type:n,label:a,children:Sl(e),uuid:Ys(),...t}}function Vn(a,e,t="folder"){return n=>class extends n{constructor(){super(...arguments),this.uiConfig=$a(a,this,e||{},t)}}}function Ml(a,e){return Vn(a,e,"panel")}function mu(a){return a==null?null:Array.isArray(a)?"folder":typeof a=="boolean"?"checkbox":typeof a=="number"?"number":typeof a=="string"?"input":typeof a=="function"?"button":typeof a.x=="number"?"vec":typeof a.r=="number"?"color":a.isTexture?"image":typeof a=="object"?"folder":null}const Fc={type:"change"},cc={type:"start"},Ah={type:"end"};class mf extends u.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new u.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new u.Pa4(1/0,1/0,1/0),this.clampMin=new u.Pa4(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:u.RsA.ROTATE,MIDDLE:u.RsA.DOLLY,RIGHT:u.RsA.PAN},this.touches={ONE:u.QmN.ROTATE,TWO:u.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(wt){wt.addEventListener("keydown",wn),this._domElementKeyEvents=wt},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",wn),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Fc),n.update(),s=i.NONE},this.update=function(){const wt=new u.Pa4,jt=new u._fP().setFromUnitVectors(e.up,new u.Pa4(0,1,0)),on=jt.clone().invert(),li=new u.Pa4,Mi=new u._fP,pi=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const ai=n.object.position;wt.copy(ai).sub(n.target),wt.applyQuaternion(jt),l.setFromVector3(wt),n.autoRotate&&s===i.NONE&&ne(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(l.theta+=h.theta*n.dampingFactor,l.phi+=h.phi*n.dampingFactor):(l.theta+=h.theta,l.phi+=h.phi);let oi=n.minAzimuthAngle,Dn=n.maxAzimuthAngle;isFinite(oi)&&isFinite(Dn)&&(oi<-Math.PI?oi+=pi:oi>Math.PI&&(oi-=pi),Dn<-Math.PI?Dn+=pi:Dn>Math.PI&&(Dn-=pi),l.theta=oi<=Dn?Math.max(oi,Math.min(Dn,l.theta)):l.theta>(oi+Dn)/2?Math.max(oi,l.theta):Math.min(Dn,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),Math.abs(h.radius)>0&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*(1+h.radius*(n.enableDamping?n.dampingFactor:1)))),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(h.radius=0)),l.radius*=1+h.radius*(n.enableDamping?n.dampingFactor:1)),Math.abs(d-1)>1e-5&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*d)),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(d=1)),l.radius*=d);let vt=0;n.autoPushTarget&&l.radius<n.minDistance&&(vt=n.minDistance-l.radius),n.autoPullTarget&&l.radius>n.maxDistance&&(vt=n.maxDistance-l.radius),l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),n.enableDamping===!0?n.target.addScaledVector(f,n.dampingFactor):n.target.add(f),wt.setFromSpherical(l),wt.applyQuaternion(on),ai.copy(n.target).add(wt),n.target.add(wt.normalize().multiplyScalar(-vt)),ai.clamp(n.clampMin,n.clampMax),n.target.clamp(n.clampMin,n.clampMax),n.object.lookAt(n.target);let an=!1;return n.enableDamping===!0&&Math.abs(h.theta)+Math.abs(h.phi)+Math.abs(h.radius)+f.length()>.001?(h.theta*=1-n.dampingFactor,h.phi*=1-n.dampingFactor,h.radius*=1-n.dampingFactor,f.multiplyScalar(1-n.dampingFactor),an=!0):(h.set(0,0,0),f.set(0,0,0)),d=1,!!(v||an||li.distanceToSquared(n.object.position)>o||8*(1-Mi.dot(n.object.quaternion))>o)&&(n.dispatchEvent(Fc),li.copy(n.object.position),Mi.copy(n.object.quaternion),v=!1,!0)}}(),this.stopDamping=function(){h.set(0,0,0),f.set(0,0,0)},this.dispose=function(){n.domElement.removeEventListener("contextmenu",Jn),n.domElement.removeEventListener("pointerdown",Nt),n.domElement.removeEventListener("pointercancel",rn),n.domElement.removeEventListener("wheel",hn),n.domElement.removeEventListener("pointermove",Bt),n.domElement.removeEventListener("pointerup",rn),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",wn),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=i.NONE;const o=1e-6,l=new u.$V,h=new u.$V(0,0,0);let d=1;const f=new u.Pa4;let v=!1;const y=new u.FM8,w=new u.FM8,E=new u.FM8,M=new u.FM8,P=new u.FM8,L=new u.FM8,R=new u.FM8,I=new u.FM8,N=new u.FM8,j=[],H={};function X(){return n.enableDamping?1:Math.pow(.95,n.zoomSpeed)}function ne(wt){h.theta-=wt}function pe(wt){h.phi-=wt}this.rotateUp=pe,this.rotateLeft=ne;const Ae=function(){const wt=new u.Pa4;return function(jt,on){wt.setFromMatrixColumn(on,0),wt.multiplyScalar(-jt),f.add(wt)}}(),ve=function(){const wt=new u.Pa4;return function(jt,on){n.screenSpacePanning===!0?wt.setFromMatrixColumn(on,1):(wt.setFromMatrixColumn(on,0),wt.crossVectors(n.object.up,wt)),wt.multiplyScalar(jt),f.add(wt)}}(),Ee=function(){const wt=new u.Pa4;return function(jt,on){const li=n.domElement;if(n.object.isPerspectiveCamera){const Mi=n.object.position;wt.copy(Mi).sub(n.target);let pi=wt.length();pi*=Math.tan(n.object.fov/2*Math.PI/180),Ae(2*jt*pi/li.clientHeight,n.object.matrix),ve(2*on*pi/li.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(Ae(jt*(n.object.right-n.object.left)/n.object.zoom/li.clientWidth,n.object.matrix),ve(on*(n.object.top-n.object.bottom)/n.object.zoom/li.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function xe(wt,jt=0){n.object.isPerspectiveCamera?(d/=wt,h.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,h.radius-jt))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*wt)),n.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function we(wt,jt=0){n.object.isPerspectiveCamera?(d*=wt,h.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,h.radius+jt))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/wt)),n.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Re(wt){y.set(wt.clientX,wt.clientY)}function Be(wt){M.set(wt.clientX,wt.clientY)}function Oe(){if(j.length===1)y.set(j[0].pageX,j[0].pageY);else{const wt=.5*(j[0].pageX+j[1].pageX),jt=.5*(j[0].pageY+j[1].pageY);y.set(wt,jt)}}function at(){if(j.length===1)M.set(j[0].pageX,j[0].pageY);else{const wt=.5*(j[0].pageX+j[1].pageX),jt=.5*(j[0].pageY+j[1].pageY);M.set(wt,jt)}}function st(){const wt=j[0].pageX-j[1].pageX,jt=j[0].pageY-j[1].pageY,on=Math.sqrt(wt*wt+jt*jt);R.set(0,on)}function St(wt){if(j.length==1)w.set(wt.pageX,wt.pageY);else{const on=jn(wt),li=.5*(wt.pageX+on.x),Mi=.5*(wt.pageY+on.y);w.set(li,Mi)}E.subVectors(w,y).multiplyScalar(n.rotateSpeed);const jt=n.domElement;ne(2*Math.PI*E.x/jt.clientHeight),pe(2*Math.PI*E.y/jt.clientHeight),y.copy(w)}function dt(wt){if(j.length===1)P.set(wt.pageX,wt.pageY);else{const jt=jn(wt),on=.5*(wt.pageX+jt.x),li=.5*(wt.pageY+jt.y);P.set(on,li)}L.subVectors(P,M).multiplyScalar(n.panSpeed),Ee(L.x,L.y),M.copy(P)}function ht(wt){const jt=jn(wt),on=wt.pageX-jt.x,li=wt.pageY-jt.y,Mi=Math.sqrt(on*on+li*li);I.set(0,Mi),N.set(0,Math.pow(I.y/R.y,6*n.zoomSpeed)),xe(N.y),R.copy(I)}function Nt(wt){n.enabled!==!1&&(j.length===0&&(n.domElement.setPointerCapture(wt.pointerId),n.domElement.addEventListener("pointermove",Bt),n.domElement.addEventListener("pointerup",rn)),function(jt){j.push(jt)}(wt),wt.pointerType==="touch"?function(jt){switch(Fn(jt),j.length){case 1:switch(n.touches.ONE){case u.QmN.ROTATE:if(n.enableRotate===!1)return;Oe(),s=i.TOUCH_ROTATE;break;case u.QmN.PAN:if(n.enablePan===!1)return;at(),s=i.TOUCH_PAN;break;default:s=i.NONE}break;case 2:switch(n.touches.TWO){case u.QmN.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;n.enableZoom&&st(),n.enablePan&&at(),s=i.TOUCH_DOLLY_PAN;break;case u.QmN.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;n.enableZoom&&st(),n.enableRotate&&Oe(),s=i.TOUCH_DOLLY_ROTATE;break;default:s=i.NONE}break;default:s=i.NONE}s!==i.NONE&&n.dispatchEvent(cc)}(wt):function(jt){let on;switch(jt.button){case 0:on=n.mouseButtons.LEFT;break;case 1:on=n.mouseButtons.MIDDLE;break;case 2:on=n.mouseButtons.RIGHT;break;default:on=-1}switch(on){case u.RsA.DOLLY:if(n.enableZoom===!1)return;(function(li){R.set(li.clientX,li.clientY)})(jt),s=i.DOLLY;break;case u.RsA.ROTATE:if(jt.ctrlKey||jt.metaKey||jt.shiftKey){if(n.enablePan===!1)return;Be(jt),s=i.PAN}else{if(n.enableRotate===!1)return;Re(jt),s=i.ROTATE}break;case u.RsA.PAN:if(jt.ctrlKey||jt.metaKey||jt.shiftKey){if(n.enableRotate===!1)return;Re(jt),s=i.ROTATE}else{if(n.enablePan===!1)return;Be(jt),s=i.PAN}break;default:s=i.NONE}s!==i.NONE&&n.dispatchEvent(cc)}(wt))}function Bt(wt){n.enabled!==!1&&(wt.pointerType==="touch"?function(jt){switch(Fn(jt),s){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;St(jt),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;dt(jt),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;(function(on){n.enableZoom&&ht(on),n.enablePan&&dt(on)})(jt),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;(function(on){n.enableZoom&&ht(on),n.enableRotate&&St(on)})(jt),n.update();break;default:s=i.NONE}}(wt):function(jt){switch(s){case i.ROTATE:if(n.enableRotate===!1)return;(function(on){w.set(on.clientX,on.clientY),E.subVectors(w,y).multiplyScalar(n.rotateSpeed);const li=n.domElement;ne(2*Math.PI*E.x/li.clientHeight),pe(2*Math.PI*E.y/li.clientHeight),y.copy(w),n.update()})(jt);break;case i.DOLLY:if(n.enableZoom===!1)return;(function(on){I.set(on.clientX,on.clientY),N.subVectors(I,R),N.y>0?xe(X()):N.y<0&&we(X()),R.copy(I),n.update()})(jt);break;case i.PAN:if(n.enablePan===!1)return;(function(on){P.set(on.clientX,on.clientY),L.subVectors(P,M).multiplyScalar(n.panSpeed),Ee(L.x,L.y),M.copy(P),n.update()})(jt)}}(wt))}function rn(wt){(function(jt){delete H[jt.pointerId];for(let on=0;on<j.length;on++)if(j[on].pointerId==jt.pointerId)return void j.splice(on,1)})(wt),j.length===0&&(n.domElement.releasePointerCapture(wt.pointerId),n.domElement.removeEventListener("pointermove",Bt),n.domElement.removeEventListener("pointerup",rn)),n.dispatchEvent(Ah),s=i.NONE}function hn(wt){n.enabled!==!1&&n.enableZoom!==!1&&s===i.NONE&&(wt.preventDefault(),n.dispatchEvent(cc),function(jt){let on=0;switch(jt.deltaMode){case 2:on+=1*jt.deltaY;break;case 1:on+=.4*jt.deltaY;break;default:on+=.01*jt.deltaY}jt.deltaY<0?we(1,on*n.zoomSpeed):jt.deltaY>0&&xe(1,-on*n.zoomSpeed),n.update()}(wt),n.dispatchEvent(Ah))}function wn(wt){n.enabled!==!1&&n.enablePan!==!1&&function(jt){let on=!1;switch(jt.code){case n.keys.UP:jt.ctrlKey||jt.metaKey||jt.shiftKey?pe(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):Ee(0,n.keyPanSpeed),on=!0;break;case n.keys.BOTTOM:jt.ctrlKey||jt.metaKey||jt.shiftKey?pe(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):Ee(0,-n.keyPanSpeed),on=!0;break;case n.keys.LEFT:jt.ctrlKey||jt.metaKey||jt.shiftKey?ne(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):Ee(n.keyPanSpeed,0),on=!0;break;case n.keys.RIGHT:jt.ctrlKey||jt.metaKey||jt.shiftKey?ne(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):Ee(-n.keyPanSpeed,0),on=!0}on&&(jt.preventDefault(),n.update())}(wt)}function Jn(wt){n.enabled!==!1&&wt.preventDefault()}function Fn(wt){let jt=H[wt.pointerId];jt===void 0&&(jt=new u.FM8,H[wt.pointerId]=jt),jt.set(wt.pageX,wt.pageY)}function jn(wt){const jt=wt.pointerId===j[0].pointerId?j[1]:j[0];return H[jt.pointerId]}this.zoomIn=function(wt){xe(1,wt*n.zoomSpeed)},this.zoomOut=function(wt){we(1,wt*n.zoomSpeed)},n.domElement.addEventListener("contextmenu",Jn),n.domElement.addEventListener("pointerdown",Nt),n.domElement.addEventListener("pointercancel",rn),n.domElement.addEventListener("wheel",hn,{passive:!1}),this.update()}}var Ki=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Xi=class extends mf{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new u.Pa4(-1e4,-1e4,-1e4),this.clampMax=new u.Pa4(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(a){super.zoomIn(a)}zoomOut(a){super.zoomOut(a)}dispatchEvent(a){super.dispatchEvent(a)}};Ki([ke()],Xi.prototype,"type",void 0),Ki([sn()],Xi.prototype,"enabled",void 0),Ki([sn(),ke()],Xi.prototype,"dollyZoom",void 0),Ki([sn(),ke()],Xi.prototype,"enableDamping",void 0),Ki([gi(),ke()],Xi.prototype,"dampingFactor",void 0),Ki([sn(),ke()],Xi.prototype,"autoRotate",void 0),Ki([gi(),ke()],Xi.prototype,"autoRotateSpeed",void 0),Ki([sn(),ke()],Xi.prototype,"enableZoom",void 0),Ki([gi(),ke()],Xi.prototype,"zoomSpeed",void 0),Ki([gi(),ke()],Xi.prototype,"maxZoomSpeed",void 0),Ki([sn(),ke()],Xi.prototype,"enableRotate",void 0),Ki([gi(),ke()],Xi.prototype,"rotateSpeed",void 0),Ki([sn(),ke()],Xi.prototype,"enablePan",void 0),Ki([gi(),ke()],Xi.prototype,"panSpeed",void 0),Ki([gi(),ke()],Xi.prototype,"autoPushTarget",void 0),Ki([gi(),ke()],Xi.prototype,"autoPullTarget",void 0),Ki([gi(),ke()],Xi.prototype,"minDistance",void 0),Ki([gi(),ke()],Xi.prototype,"maxDistance",void 0),Ki([gi(),ke()],Xi.prototype,"minZoom",void 0),Ki([gi(),ke()],Xi.prototype,"maxZoom",void 0),Ki([gi(),ke()],Xi.prototype,"minPolarAngle",void 0),Ki([gi(),ke()],Xi.prototype,"maxPolarAngle",void 0),Ki([gi(),ke()],Xi.prototype,"minAzimuthAngle",void 0),Ki([gi(),ke()],Xi.prototype,"maxAzimuthAngle",void 0),Ki([Ks(),ke()],Xi.prototype,"clampMin",void 0),Ki([Ks(),ke()],Xi.prototype,"clampMax",void 0),Ki([ke()],Xi.prototype,"screenSpacePanning",void 0),Ki([ke()],Xi.prototype,"keyPanSpeed",void 0),Xi=Ki([Ml("Orbit Controls")],Xi);var gu=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class rs extends g.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get userData(){return this._camera.modelObject.userData}set userData(e){this._camera.modelObject.userData=e}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>0;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>0;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var n,i;const s={...e};(n=s.position)!=null&&n.isVector3&&(s.position=[s.position.x,s.position.y,s.position.z]),(i=s.target)!=null&&i.isVector3&&(s.target=[s.target.x,s.target.y,s.target.z]),Object.keys(s).forEach(o=>o!=="frustumSize"&&s[o]===void 0&&delete s[o]),Object.assign(this._options,s),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty()}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const i=this._options.type==="PerspectiveCamera"?new u.cPb:new u.iKG;i.name=this._camera.name,i.near=this._camera.modelObject.near,i.far=this._camera.modelObject.far,i.zoom=this._camera.modelObject.zoom,i.scale.copy(this._camera.modelObject.scale);const s=this._isActiveCamera;s&&this.deactivateMain(),this._camera=this._setCameraObject(i),t=this._camera.modelObject,s&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let n=this._options.aspect;if(n==="auto"&&(n=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=n),this._options.type==="OrthographicCamera"){const i=this._options.frustumSize;i!==void 0?(t.top=i/2,t.bottom=-i/2,t.left=n*i/2,t.right=-n*i/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=wo(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,t,n){super(),this._controlsMode="",this._isActiveCamera=!1,this._cameraObjectUpdate=o=>{this.setDirty(o)},this._interactionsEnabled=!0,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new u.Pa4(0,0,10),this._target=new u.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(o,l)=>{const h=new Xi(o,l.ownerDocument?l:l.documentElement);return h.screenSpacePanning=!0,h}]]),this._positionWorld=new u.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>this._camera.userData.autoNearFar??!0,setValue:o=>this._camera.userData.autoNearFar=o,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Min Near":"Near",getValue:()=>this._camera.userData.minNearPlane??.5,setValue:o=>this._camera.userData.minNearPlane=o,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Max Far":"Far",getValue:()=>this._camera.userData.maxFarPlane??1e3,setValue:o=>this._camera.userData.maxFarPlane=o,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(o=>({label:o===""?"none":o,value:o})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var o;return(o=this._controls)!=null&&o.zoomIn?{type:"button",label:"Zoom in",value:()=>{var l;(l=this._controls)==null||l.zoomIn(1)}}:{}},()=>{var o;return(o=this._controls)!=null&&o.zoomOut?{type:"button",label:"Zoom out",value:()=>{var l;(l=this._controls)==null||l.zoomOut(1)}}:{}},()=>{var o;return(o=this._controls)==null?void 0:o.uiConfig}]},this.assetType="model",this.uuid=Pe(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=n??document.body;const i={...t};this._camera=this._setCameraObject(e??(i.type==="OrthographicCamera"?new u.iKG(-1,1,1,-1):new u.cPb)),this._camera.modelObject.userData.iCamera=this;const s=e;e&&(s.isPerspectiveCamera?(i.fov=s.fov,i.focus=s.focus,i.aspect=s.aspect<=0||s.userData.autoAspect?"auto":s.aspect,i.zoom=s.zoom):s.isOrthographicCamera&&(i.left=s.left,i.right=s.right,i.top=s.top,i.bottom=s.bottom,i.zoom=s.zoom),this.near=s.near,this.far=s.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(i)}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(e=4){var t;(t=this._controls)!=null&&t.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new u.Pa4))}setControlsCtor(e,t,n=!1){n||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,t;const n=this._options.controlsMode;this._controls=((e=this._controlsCtors.get(n))==null?void 0:e(this._camera.modelObject,this._container))??void 0,this._controls||n===""||console.error("Unable to create controls with mode "+n+". Are you missing a plugin?"),(t=this._controls)==null||t.addEventListener("change",this.setDirty),this._controlsMode=this._controls?n:""}_disposeCameraControls(){var e,t;this._controlsMode,(e=this._controls)==null||e.removeEventListener("change",this.setDirty),(t=this._controls)==null||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,n;if(this._options.controlsEnabled){const i=this._options.controlsMode;this._controls?this._controlsMode===i&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=i}if(this._controls){const i=this.interactionsEnabled;this._controls.enabled=i,i&&this._camera.modelObject.up.copy(u.Tme.DEFAULT_UP)}e&&this.setDirty(),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t,"postFrame",!1,1)})}activateMain(e=!0){var t,n;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new u.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(n=(t=this._camera).setDirty)==null||n.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var t,n;const i=this.target;(n=(t=this._controls)==null?void 0:t.target)==null||n.set(i.x,i.y,i.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(i),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t,n,i,s;return(n=(t=e.uniforms.cameraPositionWorld)==null?void 0:t.value)==null||n.copy(this._positionWorld),(s=(i=e.uniforms.cameraNearFar)==null?void 0:i.value)==null||s.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){const t={};return Yr(t,this.userData),Object.assign({userData:t},Fi(this,!0,e))}fromJSON(e,t){return e.userData&&(Yr(this.userData,e.userData),delete(e={...e}).userData),Yi(e,this,!0,t),this.positionUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}gu([ke("camControls")],rs.prototype,"_controls",void 0),gu([(0,g.onChange)(rs.prototype._nearFarChanged)],rs.prototype,"near",void 0),gu([(0,g.onChange)(rs.prototype._nearFarChanged)],rs.prototype,"far",void 0),gu([ke("camOptions")],rs.prototype,"_options",void 0),gu([ke("position")],rs.prototype,"_position",void 0),gu([ke("target")],rs.prototype,"_target",void 0);var Zo=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Br extends u.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let n=this._cameras.indexOf(e);n<0&&(this._cameras.push(e),n=this._cameras.length-1),this._activeCamera=n}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get renderCamera(){return this._renderCamera??this.activeCamera}set renderCamera(e){const t=this._renderCamera;this._renderCamera=e,this.dispatchEvent({type:"renderCameraChange",lastCamera:t,camera:e})}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Fe,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new rs(new u.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=wo(new u.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new u.GQ(this.getBounds())}addModel(e,t={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(e==null?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const n=e.assetType;let i=!1;switch(n){case"model":i=e.modelObject.isCamera,i&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("Unknown asset imported",e,n)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:n=2,addToRoot:i=!1}={}){const s=e;s?(t&&!s.userData.autoScaled&&Ni(s,s.userData.autoScaleRadius||n),s.traverse(o=>{o.isMesh&&!o.userData.__keepShadowDef&&(o.castShadow=!0,o.receiveShadow=!0,o.userData.__keepShadowDef=!0)}),i?this.modelObject.add(s):this.modelRoot.add(s),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(e=>{var t;(e.dispose??((t=e.modelObject)==null?void 0:t.removeFromParent))()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var e;((e=this.environment)==null?void 0:e.mapping)===u.xfE&&(this.environment.mapping=u.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map(t=>wo(t))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);e.assetType!=="texture"&&console.warn("Environment asset not processed",e);const t=e.textureObject||e;this.environment=t}getEnvironment(){return this.environment}setBackground(e){let t;if(!e||e.assetType==="texture"||e.isTexture||e.isColor||e==="environment")t=((e==null?void 0:e.assetType)==="texture"||e.isTexture)&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);t=new u.Ilk(e)}this.background=t}setBackgroundColor(e){this.backgroundColor=e?new u.Ilk(e):null}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate||e!=null&&e.refreshScene?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var t,n,i;return e.sceneUpdate===!1&&e.refreshScene===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(i=(n=(t=this.boxHelper)==null?void 0:t.box)==null?void 0:n.copy)==null||i.call(n,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new u.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){var e;this.disposeSceneModels(),this.clear(),(e=this.environment)==null||e.dispose()}findObjectsByName(e,t){const n=[];return(t??this.modelObject).traverse(i=>{i.name===e&&n.push(i)}),n}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var n;const i=e.lightObject;i&&((n=i.children)==null||n.length,t?this.add(i):this.modelRoot.add(i))}getBounds(e=!1,t=!0,n=!0,i){return new Fe().expandByObject(this.modelObject,e,t,s=>!(!n||s.assetType!=="widget")||((i==null?void 0:i(s))??!1))}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;if(e.cameraObject.userData.autoNearFar===!1)return e.near=e.cameraObject.userData.minNearPlane??.5,void(e.far=e.cameraObject.userData.maxFarPlane??1e3);const t=this.getBounds(!1),n=e.cameraObject.getWorldPosition(new u.Pa4).sub(t.getCenter(new u.Pa4)),i=1.5*t.getSize(new u.Pa4).length()/2,s=Math.max(.1,-n.clone().normalize().dot(e.cameraObject.getWorldDirection(new u.Pa4))),o=n.length(),l=Math.max(e.cameraObject.userData.minNearPlane??.5,s*(o-i)),h=Math.min(Math.max(l+i,s*(o+i)),e.cameraObject.userData.maxFarPlane??1e3);e.near=l,e.far=h}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return Fi(this,!0,e)}fromJSON(e,t){const n=e.environment;return n!==void 0&&(this.setEnvironment(Yi(n,this.getEnvironment(),!1,t)),delete e.environment),Yi(e,this,!0,t),e.environment=n,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get minNearDistance(){return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera.userData.minNearPlane??.5}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}Zo([ke()],Br.prototype,"defaultCamera",void 0),Zo([(0,g.onChange2)(Br.prototype.setDirty),ke()],Br.prototype,"envMapIntensity",void 0),Zo([(0,g.onChange2)(Br.prototype.setDirty),ke()],Br.prototype,"fixedEnvMapDirection",void 0),Zo([(0,g.onChange2)(Br.prototype.setDirty),ke()],Br.prototype,"backgroundIntensity",void 0),Zo([ke(),(0,g.onChange)(Br.prototype._onEnvironmentChange.name)],Br.prototype,"environment",void 0),Zo([ke(),(0,g.onChange)(Br.prototype._onBackgroundChange)],Br.prototype,"background",void 0),Zo([ke(),(0,g.onChange)(Br.prototype._onBackgroundChange)],Br.prototype,"backgroundColor",void 0);function _n(a,e,t,{replaceAll:n=!1,prepend:i=!1,append:s=!1}={}){if(!a.includes(e))return console.error(`${e} not found in shader`),a;let o=t;return i?o=t+e:s&&(o=e+t),n?a.replaceAll(e,o):a.replace(e,o)}class fs{static ApplyMaterialExtensions(e,t,n,i){for(const s of n)this.ApplyMaterialExtension(e,t,s,i)}static ApplyMaterialExtension(e,t,n,i){let s=(0,g.getOrCall)(n.parsFragmentSnippet,i,e)??"";s.length&&(t.fragmentShader=_n(t.fragmentShader,this.VoidMain,`
`+s+`
`,{prepend:!0})),s=(0,g.getOrCall)(n.parsVertexSnippet,i,e)??"",s.length&&(t.vertexShader=_n(t.vertexShader,this.VoidMain,`
`+s+`
`,{prepend:!0})),n.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,n.extraUniforms)),n.extraDefines&&function(o,l){let h=!1;l.materialObject&&l.materialObject.defines===void 0&&(l.materialObject.defines={});const d=Object.entries(o);for(const[f,v]of d)v===void 0?l.materialObject.defines[f]!==void 0&&(delete l.materialObject.defines[f],h=!0):l.materialObject.defines[f]!==v&&(l.materialObject.defines[f]=v,h=!0);h&&(l.materialObject.needsUpdate=!0)}(n.extraDefines,e),n.shaderExtender&&n.shaderExtender(t,e,i),e.lastShader=t}static CacheKeyForExtensions(e,t){let n="";for(const i of t)n+=this.CacheKeyForExtension(e,i);return n}static CacheKeyForExtension(e,t){let n="";return t.customCacheKey&&(n+=t.customCacheKey),t.computeCacheKey&&(n+=t.computeCacheKey(e)),t.extraDefines&&Object.values(t.extraDefines).forEach(i=>n+=i),n}static RegisterExtensions(e,t){const n=[];if(t)for(const i of t)i.isCompatible&&i.isCompatible(e)&&(n.push(i),i.uuid||(i.uuid=Ys()),i.__setDirty||(i.__setDirty=()=>{i.updateVersion||(i.updateVersion=0),i.updateVersion++}),i.setDirty||(i.setDirty=i.__setDirty));return e.materialExtensions=n,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",i=>function(s,{object:o,renderer:l}){var h;if(s.materialExtensions)for(const d of s.materialExtensions){if((h=d.onObjectRender)==null||h.call(d,o,s,l),s.lastShader){const f=(0,g.getOrCall)(d.updaters)||[];for(const v of f)v&&v.updateShaderProperties(s.lastShader)}d.updateVersion!==s.materialObject.userData["_"+d.uuid+"_version"]&&(s.materialObject.userData["_"+d.uuid+"_version"]=d.updateVersion,s.materialObject.needsUpdate=!0)}}(e,i))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",i=>function(s,{object:o,renderer:l}){var h;if(s.materialExtensions)for(const d of s.materialExtensions)(h=d.onAfterRender)==null||h.call(d,o,s,l)}(e,i))),n}}fs.VoidMain="void main()";class So extends u.jyz{constructor(e,t=!1){super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},t&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=fs.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...fs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){fs.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+fs.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,t,n,i,s){super.onBeforeRender(e,t,n,i,s),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:s})}onAfterRender(e,t,n,i,s){super.onAfterRender(e,t,n,i,s),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:s})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class zc extends So{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class Mo extends zc{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(t=>t.id).join(";")!==e.join(";")&&(this.textures=e.map(t=>({id:t,colorSpace:u.aCh})),this.setDirty())}_setUniformTexSize(e,t){var n,i;if(!t||!e)return;const s=((n=t.image)==null?void 0:n.width)??512,o=((i=t.image)==null?void 0:i.height)??512,l=e.value;l.isVector2||console.warn("uniform is not a Vector2"),l&&Math.abs(l.x-s)+Math.abs(l.y-o)>.1&&(l.x=s,l.y=o,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,n,i,s){var o,l;this._setUniformTexSize(this.uniforms.screenSize,(o=e.getRenderTarget())==null?void 0:o.texture);for(const h of this.textures){const d=h.id,f=(l=this.uniforms[d])==null?void 0:l.value;f&&(this._setUniformTexSize(this.uniforms[d+"Size"],f),f.colorSpace!==h.colorSpace&&(h.colorSpace=f.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,t,n,i,s)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map(n=>`uniform sampler2D ${n.id}; 
`+Ve(n.id??"input",n.colorSpace??u.aCh)).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.colorSpace).join(";")}}function Xn(a,...e){const t=a.fragmentShader;return new Mo({defines:Object.assign({},a.defines),uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:t},e)}class vi extends Y{constructor(e,...t){super(e.isMaterial?e:Xn(e,...t),t.length<1?vi.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,n,i;(t=(e=this.material)==null?void 0:e.dispose)==null||t.call(e),(i=(n=this.fsQuad)==null?void 0:n.dispose)==null||i.call(n),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(t=>t==null?void 0:t.updateShaderProperties(this.material)))}render(e,t,n,i,s){this.enabled&&super.render(e,t||null,n,i,s)}}vi.DEFAULT_TEX_ID="tDiffuse",function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([sn("Enabled"),ke()],vi.prototype,"enabled",void 0);class $o extends z{constructor(e,t,n,i,s){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=s!==void 0?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new u.Ilk}render(e,t,n,i,s,o){if(!this.scene||!this.camera)return;const l=e.autoClear;let h,d;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(d=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),h=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),o){const f=e.getContext();f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,o)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),o){const f=e.getContext();f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,h),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=d),e.autoClear=l}}class Co extends vi{constructor(e,t="c = a + b;",n="",i){super({vertexShader:O.vertexShader,fragmentShader:g.glsl`
                varying vec2 vUv;
                
                ${n}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${t}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:i},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class Tv extends zc{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#glMarker mainStart
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv))<alphaTest)
#else
if(texture2D(alphaMap,vAlphaMapUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new u.FM8(.1,1e3)},alphaMap:{value:null},displacementMap:{value:null},displacementScale:{value:null},displacementBias:{value:null},displacementMapTransform:{value:new u.Vkp},alphaTest:{value:0},alphaMapTransform:{value:new u.Vkp},flags:{value:new u.Ltg(255,255,255,255)}},defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?u.LSk:u.v9Y}),this._updaters=[]}onBeforeRender(e,t,n,i,s){super.onBeforeRender(e,t,n,i,s);let o=s.material;Array.isArray(o)&&(o=o[0]),this.uniforms.alphaMap.value=(o==null?void 0:o.alphaMap)??null,this.uniforms.alphaMap.value&&e.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.uniforms.alphaTest.value=!o||!o.alphaTest||o.alphaTest<1e-7?.001:o.alphaTest,this.uniforms.displacementMap.value=(o==null?void 0:o.displacementMap)??null,this.uniforms.displacementMap.value&&e.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=(o==null?void 0:o.displacementScale)??1,this.uniforms.displacementBias.value=(o==null?void 0:o.displacementBias)??0,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(o!=null&&o.userData.matId?o==null?void 0:o.userData.matId:0)/255,this._updaters.forEach(h=>{h(s,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let l=this.uniforms.alphaMap.value?1:void 0;l!==this.defines.USE_ALPHAMAP&&(l===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=l,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),l=this.uniforms.displacementMap.value?1:void 0,l!==this.defines.USE_DISPLACEMENTMAP&&(l===void 0?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=l,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),l=o.userData.ALPHA_I_RGBA_PACKING?1:void 0,l!==this.defines.ALPHA_I_RGBA_PACKING&&(l===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=l,this.needsUpdate=!0),l=o.userData.forcedLinearDepth??void 0,l!==this.defines.FORCED_LINEAR_DEPTH&&(l===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=l,this.needsUpdate=!0),this.side=o.side??u.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const t=this._updaters.indexOf(e);t!==-1&&this._updaters.splice(t,1)}}var ga=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class Sn extends g.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=Fi(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(Yi(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e,meta:t}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,t,n;return((t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetManager"))==null?void 0:t.exportPluginPreset(this))??((n=this.toJSON)==null?void 0:n.call(this))}async importState(e){var t,n;const i=(t=this._viewer)==null?void 0:t.getPluginByType("AssetManager");i?await i.importPluginPreset(e,this):(n=this.fromJSON)==null||n.call(this,e)}storeState(e,t,n){(t=t||(window?window.localStorage:void 0))?(n===void 0&&(n=this.exportState()),n&&t.setItem(this._storeKey(e),JSON.stringify(n))):console.warn("Unable to store state")}async loadState(e,t){if(!(t=t||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const n=t.getItem(this._storeKey(e));n&&await this.importState(JSON.parse(n))}}function tr(a,e,t){return{...e,get dirty(){return e.dirty||!1},set dirty(n){(0,g.safeSetProperty)(e,"dirty",n,!0)},update(){var n,i,s;this.passObject.enabled&&((i=(n=this.passObject).updateShaderProperties)==null||i.call(n,(0,g.getOrCall)(t)),(s=e.update)==null||s.call(this))},onRegister(n){var i,s,o;this.passObject.materialExtension&&((s=(i=a.getPluginByType("AssetManager"))==null?void 0:i.materials)==null||s.registerMaterialExtension(this.passObject.materialExtension)),(o=e.onRegister)==null||o.call(this,n)},onUnregister(n){var i,s,o;this.passObject.materialExtension&&((s=(i=a.getPluginByType("AssetManager"))==null?void 0:i.materials)==null||s.unregisterMaterialExtension(this.passObject.materialExtension)),(o=e.onUnregister)==null||o.call(this,n)},dispose(){var n,i,s;(i=(n=this.passObject).dispose)==null||i.call(n),(s=e.dispose)==null||s.call(this)}}}class To extends Sn{_update(e){var t;return((t=this._pass)==null?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t;return((t=(e=this._pass)==null?void 0:e.passObject)==null?void 0:t.enabled)??this._enabledTemp}set enabled(e){var t;(t=this._pass)!=null&&t.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(n){n&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=tr(e,t),t.passObject.onDirty!==void 0&&t.passObject.onDirty.push(()=>t.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,n;this._pass&&e.renderer.unregisterPass(this._pass),(n=(t=this._pass)==null?void 0:t.dispose)==null||n.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=this.pass;return n&&(t.pass=Fi((n==null?void 0:n.passObject)??n,!1,e)),t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.pass){const n=this.pass;n&&Yi(e.pass,(n==null?void 0:n.passObject)??n,!1,t)}return this}}(function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([ke()],To.prototype,"enabled",null);const Kr=new Set,gf=new Set;class eo extends $o{constructor(e,t,n=new er(1,1,1),i=1){super(void 0,void 0,t,n,i),this.target=e}render(e,t,n,i,s){var o;const l=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel();(o=this.scene)==null||o.traverse(({material:f})=>{f&&((f.transparent&&f.userData.renderToDepth||!f.transparent&&f.transmission===0&&f.userData.renderToDepth===!1)&&(Kr.add(f),f.transparent=!f.transparent),Math.abs(f.transmission||0)>0&&f.userData.renderToDepth&&(gf.add([f,f.transmission]),f.transmission=0))}),mi(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,t,this.target,i,s)),Kr.forEach(f=>f.transparent=!f.transparent),Kr.clear(),gf.forEach(([f,v])=>f.transmission=v),gf.clear(),e.setRenderTarget(l,h,d)}}class Ri extends To{get material(){return this._material}passCtor(e){var t,n;const i=((t=this._viewer)==null?void 0:t.renderer.isWebGL2)&&this.renderFlagsBuffer,s=e.renderer.createTarget({depthBuffer:!0,samples:((n=this._viewer)==null?void 0:n.renderer.composerTarget.samples)||0,type:u.ywz,textureCount:i?2:1});return Array.isArray(s.texture)?(s.texture[0].name="gbufferDepthNormal",s.texture[1].name="gbufferFlags",this._gbufferTextures=s.texture):(s.texture.name="gbufferDepthNormal",this._gbufferTextures.push(s.texture)),this._gbufferTarget=s,this._material=new Tv(i),this._material.userData.isGBufferMaterial=!0,new eo(s,this._material)}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return ga}updateShaderProperties(e){var t;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=this.getDepthNormal()??void 0:(t=this._viewer)==null||t.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=this.getFlagsTexture()??void 0;const n=e.uniforms.tGBufferFlags.value?1:0;n!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=n,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}Ri.PluginType="GBuffer";class jd extends $o{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:u.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?u.cLu:u.ywz,format:u.wk1,minFilter:u.wem,magFilter:u.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,t=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new er(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new Co({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,t,n,i,s){var o;let l=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,n,i,s),this.needsSwap=l,void(e.userData.mainRenderPass=void 0);const h=e.userData;h||console.error("threejs is not patched?");const d=this._viewer.useGBufferDepth;let f;if(d){const y=(o=this._viewer.getPlugin(Ri))==null?void 0:o.getTarget();if(y){const w=e.properties.get(y);f=w.__webglDepthRenderbuffer||w.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let v=(y=!1)=>{super.render(e,void 0,n,i,s,f)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(l=!1,e.info&&!e.info.autoReset)throw"renderer.info.autoReset must be true";{const y=e.autoClearDepth;e.autoClearDepth=!d,mi(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},v),e.autoClearDepth=y}if(!d){const y=e.properties.get(n);f=y.__webglDepthRenderbuffer||y.__webglDepthbuffer}v=()=>{super.render(e,void 0,this.transparentTarget,i,s,f)};{const y=this.clear,w=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,mi(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},v),this.clear=y,e.autoClearDepth=w}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,i,s),l=!0);{const y=this.clear;this.clear=!1,h.transmissionRenderTarget=l?t:n,h.blurTransmissionTarget=this.blurTransmissionTarget&&h.transmissionRenderTarget.samples===0,mi(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},v),h.blurTransmissionTarget=void 0,h.transmissionRenderTarget=void 0,this.clear=y}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,i,s),l=!0)}}else{{const y=this.clear,w=e.autoClearDepth;e.autoClearDepth=!d,this.clear=!0,mi(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},v),this.clear=y,e.autoClearDepth=w}{this._viewer.renderer.blit(n.texture,t,{clear:!0});const y=this.clear;this.clear=!1,h.transmissionRenderTarget=t,h.blurTransmissionTarget=this.blurTransmissionTarget,mi(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},v),h.blurTransmissionTarget=void 0,h.transmissionRenderTarget=void 0,this.clear=y}l=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=l,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function vf(a,e){return a.multiplyScalar(a.w*e),a.w=1,a}function Iv(a,e){return vf(a,e),new er(a.x,a.y,a.z)}function Pv(a,e){const t=Math.max(a.x,Math.max(a.y,a.z));let n=Math.max(Math.min(t/e,1),0);return n=Math.ceil(255*n)/255,a.divideScalar(n*e),a.w=n,a}function Nm(a,e){return Pv(new u.Ltg(a.r,a.g,a.b,1),e)}const Fm={name:"",blending:u.bdR,side:u.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:u.k74,blendDst:u.LgZ,blendEquation:u.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:u.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:u.cum,stencilRef:0,stencilFuncMask:255,stencilFail:u.x5V,stencilZFail:u.x5V,stencilZPass:u.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},bh={...Fm,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:u.IOt,normalScale:new u.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},el={...bh,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new u.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new er(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new er(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new er(1,1,1),specularColorMap:null};class Os extends u.EJi{constructor(e){super(e),this.typeSlug=Os.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=fs.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...fs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},cr(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},cr(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},cr(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},cr(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",u.IOt],["ObjectSpace",u.PA7]].map(e=>({label:e[0],value:e[1]}))},cr(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},cr(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},cr(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},cr(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},cr(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},cr(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},cr(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},cr(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},cr(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},cr(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",u.BVF],["Always",u.Se2],["Less",u.Zr5],["LessEqual",u.vCF],["Equal",u.eD],["GreaterEqual",u.ksN],["Greater",u.w$m],["NotEqual",u.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Ya],["Normal",Ao],["Additive",u.WMw],["Subtractive",Fr],["Multiply",zr]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},cr(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},cr(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},cr(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},cr(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},cr(this,"iridescenceThicknessMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",u.Wl3],["Back",u._Li],["Double",u.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,t;return((t=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:t.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(Fi(this,!1),null,2)],{type:"application/json"});(0,g.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)==null?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const s of i)e.vertexShader=_n(e.vertexShader,s[0],"#glMarker "+s[1]+`
`+s[0]);for(const s of n)e.fragmentShader=_n(e.fragmentShader,s[0],"#glMarker "+s[1]+`
`+s[0]);fs.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+fs.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,i,s){super.onBeforeRender(e,t,n,i,s),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:s});const o=this.userData.inverseAlphaMap?1:0;o!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=o,this.needsUpdate=!0)}onAfterRender(e,t,n,i,s){super.onAfterRender(e,t,n,i,s),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:s})}copyProps(e,t=!1,n=!0){if(!t&&!["MeshStandardMaterial",Os.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const i={},s=Array.from(Object.keys(el));(0,g.copyProps)(e,i,s);const o=i.userData;delete i.userData;for(const l of Object.keys(i))i[l]===void 0&&delete i[l];if(this.setValues(i),n)for(const l of Ud)this.userData[l]!==void 0&&this.userData[l];return o&&xs(this.userData,o),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){var t,n;const i=this.userData;this.userData={};const s=super.toJSON(e);this.userData=i,s.userData={},xs(s.userData,i),s.userData.uuid=this.userData.uuid;const o=e||{textures:Object.fromEntries(((t=s.textures)==null?void 0:t.map(l=>[l.uuid,l]))||[]),images:Object.fromEntries(((n=s.images)==null?void 0:n.map(l=>[l.uuid,l]))||[])};s.userData=Fi(s.userData,!1,o),e||(Object.keys(o.textures).length>0&&(s.textures=Object.values(o.textures)),Object.keys(o.images).length>0&&(s.images=Object.values(o.images))),s.type=Os.TYPE;for(const l of Object.keys(s))s[l]===void 0&&delete s[l];return s}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Os.TypeSlug="pmat",Os.TYPE="MeshStandardMaterial2";const _f={...Fm,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:u.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class ks extends u.vBJ{constructor(e){super(e),this.typeSlug=ks.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.materialExtensions=fs.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...fs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},cr(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Ya],["Normal",Ao],["Additive",u.WMw],["Subtractive",Fr],["Multiply",zr]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},cr(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},cr(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},cr(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",u.Wl3],["Back",u._Li],["Double",u.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,t;return((t=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:t.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(Fi(this,!1),null,2)],{type:"application/json"});(0,g.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)==null?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const s of i)e.vertexShader=_n(e.vertexShader,s[0],"#glMarker "+s[1]+`
`+s[0]);for(const s of n)e.fragmentShader=_n(e.fragmentShader,s[0],"#glMarker "+s[1]+`
`+s[0]);fs.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+fs.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,i,s){super.onBeforeRender(e,t,n,i,s),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:s})}onAfterRender(e,t,n,i,s){super.onAfterRender(e,t,n,i,s),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:s})}copyProps(e,t=!1){if(!t&&!["MeshBasicMaterial",ks.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const n={},i=Array.from(Object.keys(_f));(0,g.copyProps)(e,n,i);const s=n.userData;delete n.userData;for(const o of Object.keys(n))n[o]===void 0&&delete n[o];return this.setValues(n),s&&xs(this.userData,s),this.setDirty(),this}toJSON(e){var t,n;const i=this.userData;this.userData={};const s=super.toJSON(e);this.userData=i,s.userData={},xs(s.userData,i),s.userData.uuid=this.userData.uuid;const o=e||{textures:Object.fromEntries(((t=s.textures)==null?void 0:t.map(l=>[l.uuid,l]))||[]),images:Object.fromEntries(((n=s.images)==null?void 0:n.map(l=>[l.uuid,l]))||[])};s.userData=Fi(s.userData,!1,o),e||(Object.keys(o.textures).length>0&&(s.textures=Object.values(o.textures)),Object.keys(o.images).length>0&&(s.images=Object.values(o.images))),s.type=ks.TYPE;for(const l of Object.keys(s))s[l]===void 0&&delete s[l];return s}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}ks.TypeSlug="bmat",ks.TYPE="MeshBasicMaterial2";const Vd={materialType:Os.TYPE,name:"standard",color:"#ffffff"},Gd={materialType:ks.TYPE,name:"basic",color:"#ffffff"},yf={[Os.TYPE]:Vd.name,MeshStandardMaterial:Vd.name,MeshPhysicalMaterial:Vd.name,[ks.TYPE]:Gd.name,MeshBasicMaterial:Gd.name};class vu extends g.SimpleEventDispatcher{constructor(){super(),this._templates=[Vd,Gd],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||t.assetType!=="material")return;this._refreshTextureRefs();const n=this._getMapsForMaterial(t),i=[];n.forEach(s=>{const o=s.userData.__appliedMaterials;o==null||o.delete(t),o&&s.userData.disposeOnIdle!==!1&&o.size===0&&i.push(s)}),i.forEach(s=>{s.dispose()}),this.unregisterMaterial(t)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let n=this.findMaterial(e);return n||(n=this.generateFromTemplate(e,t)),n}generateFromTemplate(e,t){const n=this.findTemplate(e);if(n)return this._generateFromTemplate(n,t??{})}generateFromTemplateType(e,t){const n=this._templates.find(i=>i.materialType===e);if(n)return this._generateFromTemplate(n,t??{})}findTemplate(e){return this._templates.find(t=>t.name===e)}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach(t=>{this._getMapsForMaterial(t).forEach(n=>{let i=n.userData.__appliedMaterials;i||(n.userData.__appliedMaterials=i=new Set),n.addEventListener("update",()=>t.dispatchEvent({type:"textureUpdate",texture:n})),i.add(t)})})}_getMapsForMaterial(e){const t=new Set;for(const n of Object.values(e))n&&n.isTexture&&t.add(n);for(const n of Object.values(e.userData??{}))n&&n.isTexture&&t.add(n);return t}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter(t=>t.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=Ys());const t=this._templates.find(n=>n.templateUUID===e.templateUUID);t?console.warn("MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(t=>t.templateUUID!==e.templateUUID)}dispose(e=!0){const t=this._materials;this._materials=[];for(const n of t)e||!n.userData.runtimeMaterial?n.dispose():this._materials.push(n)}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e,t=!1){return this._materials.filter(n=>typeof e!="string"||t?n.name.match(typeof e=="string"?"^"+e+"$":e)!==null:n.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,t){const n=this._processModel(e,t);return(0,g.safeSetProperty)(e,"modelObject",n),e}_processMaterial(e,t){var n,i;if(!e)return;if((n=e.materialObject)!=null&&n.isMaterial)return e;let s=e.mmMaterial;if(!s){const o=((i=e.userData)==null?void 0:i.uuid)||e.uuid;if(s=this.findMaterial(o),s)s.copyProps(e);else{const l=t.useSourceMaterial===!1||!e.isMaterial,h=t.materialTemplate||(l?"standard":yf[e.type]||"standard");s=this.generateFromTemplate(h,l?{}:e)}e.mmMaterial=s}return s}processMaterial(e,t){return e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),t.register!==!1&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,t,n=!0,i=!1){const s=Fi(e,!1),o=JSON.stringify(s,null,n?0:2),l=(t||e.name||"physical_material")+"."+e.typeSlug,h=new File([o],l,{type:"application/json"});return i&&(0,g.downloadFile)(h),h}applyMaterial(e,t){var n;const i=Object.getPrototypeOf(e).constructor.TYPE;let s=this.findMaterialsByName(t,!0);(!s||s.length<1)&&(s=[this.findMaterial(t)]);let o=!1;for(const l of s)if(l&&!l.userData.__isVariation&&l!==e)if(Object.getPrototypeOf(l).constructor.TYPE===i){const h=l.name;l.copyProps(e),l.name=h,o=!0}else{const h=l["__"+i]||this.generateFromTemplateType(i);if(!h)continue;const d=l.name;h.copyProps(e),h.name=d;const f=l.userData.__appliedMeshes;for(const v of[...f??[]])(n=v==null?void 0:v.setMaterial)==null||n.call(v,h),v&&(o=!0);l["__"+i]=h}return o}}class _u extends vu{_generateFromTemplate(e,t){var n,i,s,o,l;let h;const d={...e};d.customMaterialExtensions=[...d.customMaterialExtensions??[],...this._materialExtensions];const f=(t==null?void 0:t.metadata)&&(t==null?void 0:t.metadata.version)<=4.5;f&&(u.epp.enabled=!1);let v={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":t&&(0,g.copyProps)(t,d,Array.from(Object.keys(el))),(t==null?void 0:t.type)==="MeshBasicMaterial"&&(d.roughness=.9,d.metalness=0,(n=d.userData)!=null&&n.uuid&&delete d.userData.uuid),v=(i=d.userData)==null?void 0:i.uuid,v&&delete d.userData.uuid,h=new Os({customMaterialExtensions:d.customMaterialExtensions}).fromJSON(d,void 0,!0),v&&(h.uuid=v),h.userData.uuid=h.uuid,h.setDirty(),t!=null&&t.isMaterial&&t.userData!==void 0&&(t.userData.iMaterial=h);break;case"MeshBasicMaterial2":case"basic":case"unlit":t&&(0,g.copyProps)(t,d,Array.from(Object.keys(_f))),v=(s=d.userData)==null?void 0:s.uuid,v&&delete d.userData.uuid,h=new ks({customMaterialExtensions:d.customMaterialExtensions}).fromJSON(d,void 0,!0),v&&(h.uuid=v,d.userData.uuid=v),h.userData.uuid=h.uuid,h.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:v=null,t&&t.userData&&(v=t.userData,delete t.userData),h=((o=e.generator)==null?void 0:o.call(e,d,t))||void 0,t&&v&&(t.userData=v),v&&h&&(xs(h.userData,v),v!=null&&v.uuid&&(h.uuid=v.uuid),v=null),h&&(h.userData.uuid=h.uuid)}if(h){t.runtimeMaterial&&(h.userData.__runtimeMaterial=!0);const y=h;if(h.clone=()=>{y.userData.cloneId||(y.userData.cloneId="0"),y.userData.cloneCount||(y.userData.cloneCount=0),y.userData.cloneCount+=1;const w=this.generateFromTemplate(e.name);return w&&(w.copyProps(y),w.userData.cloneId=w.userData.cloneId+"_"+y.userData.cloneCount,w.userData.cloneCount=0,w.name=w.name+"_"+w.userData.cloneId,w.userData.uuid=w.uuid),w==null?void 0:w.materialObject},t){let w=this.findMaterial(t==null?void 0:t.uuid);w&&this.unregisterMaterial(w),w=this.findMaterial((l=t==null?void 0:t.materialObject)==null?void 0:l.uuid),w&&this.unregisterMaterial(w)}}return f&&(u.epp.enabled=!0),h?this.registerMaterialObject(h):void 0}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let n=e.material;if(!n&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),n=this._defaultMaterial,e.material=n),n){let i=!0;Array.isArray(n)||(n=[n],i=!1);const s=[];for(const o of n){const l=this._processMaterial(o,t);s.push(l==null?void 0:l.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(i?s:s[0]))}if(t.recursive!==!1)for(let i=0;i<e.modelObject.children.length;i++)e.modelObject.children[i]=this._processModel(e.modelObject.children[i],t);return e}}class yr{ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(t,e):t}constructor(e,t,n,i){this.cls=e,this.ext=t,this.root=n,this.onCtor=i}}class xh{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:t=!1,autoCenter:n=!1,autoScale:i=!1,autoScaleRadius:s=2,license:o=""}={}){if(this.assetType="model",this._modelObject=wo(new u.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!n||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||n||(e.userData.isCentered=!0):gr(e),this._modelObject=e;else{n&&console.error("cannot use pseudoCenter and autoCenter at the same time");const l=new Fe().expandByObject(e,!0,!0).getCenter(new u.Pa4);this._modelObject.position.copy(l).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}i&&!this._modelObject.userData.autoScaled?Ni(this._modelObject,e.userData.autoScaleRadius||s):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=o}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,n,i,s;(n=(t=this._modelObject)==null?void 0:t.setDirty)==null||n.call(t,e),(s=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i,"postFrame",!0)}setMaterial(e){var t,n;return this._modelObject.isMesh?((n=(t=this._modelObject).setMaterial)==null?void 0:n.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var n,i;if(this._modelObject.isMesh)return(i=(n=this._modelObject).setGeometry)==null?void 0:i.call(n,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Fd(this._modelObject,!1)),this._uiConfig}clone(){return new xh(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function Hd(a,e){return[a.modelObject,...a.modelObject.children].forEach(t=>{wo(t,t!==a.modelObject?a:void 0,e)}),a}class tl{constructor(){this._processors=new Map}add(e,t){var n;this._processors.has(e)||this._processors.set(e,[]),(n=this._processors.get(e))==null||n.push(t)}remove(e,t){const n=this._processors.get(e),i=(n==null?void 0:n.indexOf(t))||(n==null?void 0:n.findIndex(s=>s.process&&s.process===t.process||s.processAsync&&s.processAsync===t.processAsync));!n||!i||i<0||n.splice(i,1)}get(e){return this._processors.get(e)??[]}async process(e,t,n){var i,s;const o=this.get(e),l=t.assetType;for(const h of o)h.forAssetType===l&&(t=((i=h.process)==null?void 0:i.call(h,t,n))??t,t=await((s=h.processAsync)==null?void 0:s.call(h,t,n))??t);return t}dispose(){this._processors.clear()}}class Ar extends u.hH6{load(e,t,n,i){return super.load(e,s=>{try{if(typeof s!="string")throw new Error("Invalid JSON");t==null||t(JSON.parse(s))}catch(o){i==null||i(o)}},n,i)}}class Rv extends u.yxD{constructor(e){super(e),this.type=u.cLu}parse(e){const t=function(h,d){switch(h){case 1:console.error("THREE.RGBELoader Read Error: "+(d||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(d||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(d||""));break;default:console.error("THREE.RGBELoader: Error: "+(d||""))}return-1},n=function(h,d,f){d=d||1024;let v=h.pos,y=-1,w=0,E="",M=String.fromCharCode.apply(null,new Uint16Array(h.subarray(v,v+128)));for(;0>(y=M.indexOf(`
`))&&w<d&&v<h.byteLength;)E+=M,w+=M.length,v+=128,M+=String.fromCharCode.apply(null,new Uint16Array(h.subarray(v,v+128)));return-1<y&&(f!==!1&&(h.pos+=w+y+1),E+M.slice(0,y))},i=function(h,d,f,v){const y=h[d+3],w=Math.pow(2,y-128)/255;f[v+0]=h[d+0]*w,f[v+1]=h[d+1]*w,f[v+2]=h[d+2]*w,f[v+3]=1},s=function(h,d,f,v){const y=h[d+3],w=Math.pow(2,y-128)/255;f[v+0]=u.A5E.toHalfFloat(Math.min(h[d+0]*w,65504)),f[v+1]=u.A5E.toHalfFloat(Math.min(h[d+1]*w,65504)),f[v+2]=u.A5E.toHalfFloat(Math.min(h[d+2]*w,65504)),f[v+3]=u.A5E.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const l=function(h){const d=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,f=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,v=/^\s*FORMAT=(\S+)\s*$/,y=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,w={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let E,M;if(h.pos>=h.byteLength||!(E=n(h)))return t(1,"no header found");if(!(M=E.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(w.valid|=1,w.programtype=M[1],w.string+=E+`
`;E=n(h),E!==!1;)if(w.string+=E+`
`,E.charAt(0)!=="#"){if((M=E.match(d))&&(w.gamma=parseFloat(M[1])),(M=E.match(f))&&(w.exposure=parseFloat(M[1])),(M=E.match(v))&&(w.valid|=2,w.format=M[1]),(M=E.match(y))&&(w.valid|=4,w.height=parseInt(M[1],10),w.width=parseInt(M[2],10)),2&w.valid&&4&w.valid)break}else w.comments+=E+`
`;return 2&w.valid?4&w.valid?w:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(l!==-1){const h=l.width,d=l.height,f=function(v,y,w){const E=y;if(E<8||E>32767||v[0]!==2||v[1]!==2||128&v[2])return new Uint8Array(v);if(E!==(v[2]<<8|v[3]))return t(3,"wrong scanline width");const M=new Uint8Array(4*y*w);if(!M.length)return t(4,"unable to allocate buffer space");let P=0,L=0;const R=4*E,I=new Uint8Array(4),N=new Uint8Array(R);let j=w;for(;j>0&&L<v.byteLength;){if(L+4>v.byteLength)return t(1);if(I[0]=v[L++],I[1]=v[L++],I[2]=v[L++],I[3]=v[L++],I[0]!=2||I[1]!=2||(I[2]<<8|I[3])!=E)return t(3,"bad rgbe scanline format");let H,X=0;for(;X<R&&L<v.byteLength;){H=v[L++];const pe=H>128;if(pe&&(H-=128),H===0||X+H>R)return t(3,"bad scanline data");if(pe){const Ae=v[L++];for(let ve=0;ve<H;ve++)N[X++]=Ae}else N.set(v.subarray(L,L+H),X),X+=H,L+=H}const ne=E;for(let pe=0;pe<ne;pe++){let Ae=0;M[P]=N[pe+Ae],Ae+=E,M[P+1]=N[pe+Ae],Ae+=E,M[P+2]=N[pe+Ae],Ae+=E,M[P+3]=N[pe+Ae],P+=4}j--}return M}(o.subarray(o.pos),h,d);if(f!==-1){let v,y,w;switch(this.type){case u.VzW:w=f.length/4;const E=new Float32Array(4*w);for(let P=0;P<w;P++)i(f,4*P,E,4*P);v=E,y=u.VzW;break;case u.cLu:w=f.length/4;const M=new Uint16Array(4*w);for(let P=0;P<w;P++)s(f,4*P,M,4*P);v=M,y=u.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:h,height:d,data:v,header:l.string,gamma:l.gamma,exposure:l.exposure,type:y}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,function(s,o){switch(s.type){case u.VzW:case u.cLu:s.colorSpace=u.GUF,s.minFilter=u.wem,s.magFilter=u.wem,s.generateMipmaps=!1,s.flipY=!0}t&&t(s,o)},n,i)}}function uc(a){return new yr(class extends Rv{constructor(e){super(e),this.setDataType(Lu(a.renderer.rendererObject))}},["hdr"],!1)}class Io extends u.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Pi(t)}),this.register(function(t){return new Na(t)}),this.register(function(t){return new Dv(t)}),this.register(function(t){return new Bv(t)}),this.register(function(t){return new to(t)}),this.register(function(t){return new Si(t)}),this.register(function(t){return new zm(t)}),this.register(function(t){return new qt(t)}),this.register(function(t){return new Sh(t)}),this.register(function(t){return new Ai(t)}),this.register(function(t){return new hc(t)}),this.register(function(t){return new wh(t)}),this.register(function(t){return new yu(t)}),this.register(function(t){return new Mh(t)})}load(e,t,n,i){const s=this;let o;o=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:u.Zp0.extractUrlBase(e),this.manager.itemStart(e);const l=function(d){i?i(d):console.error(d),s.manager.itemError(e),s.manager.itemEnd(e)},h=new u.hH6(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(d){try{s.parse(d,o,function(f){t(f),s.manager.itemEnd(e)},l,e)}catch(f){l(f)}},n,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i,s){let o;const l={},h={},d=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(d.decode(new Uint8Array(e,0,4))===Af){try{l[Hn.KHR_BINARY_GLTF]=new Au(e)}catch(v){return void(i&&i(v))}o=JSON.parse(l[Hn.KHR_BINARY_GLTF].content)}else o=JSON.parse(d.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const f=new ze(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(let v=0;v<this.pluginCallbacks.length;v++){const y=this.pluginCallbacks[v](f);h[y.name]=y,l[y.name]=!0}if(o.extensionsUsed)for(let v=0;v<o.extensionsUsed.length;++v){const y=o.extensionsUsed[v],w=o.extensionsRequired||[];switch(y){case Hn.KHR_MATERIALS_UNLIT:l[y]=new Eh;break;case Hn.KHR_DRACO_MESH_COMPRESSION:l[y]=new bu(o,this.dracoLoader);break;case Hn.KHR_TEXTURE_TRANSFORM:l[y]=new bf;break;case Hn.KHR_MESH_QUANTIZATION:l[y]=new Lv;break;default:w.indexOf(y)>=0&&h[y]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}f.setExtensions(l),f.setPlugins(h),f.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,s){n.parse(e,t,i,s)})}}function Ua(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const Hn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class wh{constructor(e){this.parser=e,this.name=Hn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let l;const h=new u.Ilk(16777215);o.color!==void 0&&h.fromArray(o.color);const d=o.range!==void 0?o.range:0;switch(o.type){case"directional":l=new u.Ox3(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new u.cek(h),l.distance=d;break;case"spot":l=new u.PMe(h),l.distance=d,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,l.angle=o.spot.outerConeAngle,l.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return l.position.set(0,0,0),l.decay=2,no(l,o),o.intensity!==void 0&&(l.intensity=o.intensity),l.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(l),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],s=(i.extensions&&i.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(o){return n._getNodeRef(t.cache,s,o)})}}class Eh{constructor(){this.name=Hn.KHR_MATERIALS_UNLIT}getMaterialType(){return u.vBJ}extendParams(e,t,n){const i=[];e.color=new u.Ilk(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}s.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",s.baseColorTexture,u.KI_))}return Promise.all(i)}}class Sh{constructor(e){this.parser=e,this.name=Hn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class Pi{constructor(e){this.parser=e,this.name=Hn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?u.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const l=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new u.FM8(l,l)}return Promise.all(s)}}class hc{constructor(e){this.parser=e,this.name=Hn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?u.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class to{constructor(e){this.parser=e,this.name=Hn.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?u.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new u.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,u.KI_)),o.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),i.extras&&i.extras.sheenFactor!==void 0&&(t.sheen=i.extras.sheenFactor,delete i.extras.sheenFactor),Promise.all(s)}}class Si{constructor(e){this.parser=e,this.name=Hn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?u.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class zm{constructor(e){this.parser=e,this.name=Hn.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?u.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const l=o.attenuationColor||[1,1,1];return t.attenuationColor=new u.Ilk(l[0],l[1],l[2]),Promise.all(s)}}class qt{constructor(e){this.parser=e,this.name=Hn.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?u.EJi:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Ai{constructor(e){this.parser=e,this.name=Hn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?u.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const l=o.specularColorFactor||[1,1,1];return t.specularColor=new u.Ilk(l[0],l[1],l[2]),o.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,u.KI_)),Promise.all(s)}}class Na{constructor(e){this.parser=e,this.name=Hn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class Dv{constructor(e){this.parser=e,this.name=Hn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],l=i.images[o.source];let h=n.textureLoader;if(l.uri){const d=n.options.manager.getHandler(l.uri);d!==null&&(h=d)}return this.detectSupport().then(function(d){if(d)return n.loadTextureImage(e,o.source,h);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Bv{constructor(e){this.parser=e,this.name=Hn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],l=i.images[o.source];let h=n.textureLoader;if(l.uri){const d=n.options.manager.getHandler(l.uri);d!==null&&(h=d)}return this.detectSupport().then(function(d){if(d)return n.loadTextureImage(e,o.source,h);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class yu{constructor(e){this.name=Hn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(l){const h=i.byteOffset||0,d=i.byteLength||0,f=i.count,v=i.byteStride,y=new Uint8Array(l,h,d);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(f,v,y,i.mode,i.filter).then(function(w){return w.buffer}):o.ready.then(function(){const w=new ArrayBuffer(f*v);return o.decodeGltfBuffer(new Uint8Array(w),f,v,y,i.mode,i.filter),w})})}return null}}class Mh{constructor(e){this.name=Hn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const h of i.primitives)if(h.mode!==Tr.TRIANGLES&&h.mode!==Tr.TRIANGLE_STRIP&&h.mode!==Tr.TRIANGLE_FAN&&h.mode!==void 0)return null;const s=n.extensions[this.name].attributes,o=[],l={};for(const h in s)o.push(this.parser.getDependency("accessor",s[h]).then(d=>(l[h]=d,l[h])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(h=>{const d=h.pop(),f=d.isGroup?d.children:[d],v=h[0].count,y=[];for(const w of f){const E=new u.yGw,M=new u.Pa4,P=new u._fP,L=new u.Pa4(1,1,1),R=new u.SPe(w.geometry,w.material,v);for(let I=0;I<v;I++)l.TRANSLATION&&M.fromBufferAttribute(l.TRANSLATION,I),l.ROTATION&&P.fromBufferAttribute(l.ROTATION,I),l.SCALE&&L.fromBufferAttribute(l.SCALE,I),R.setMatrixAt(I,E.compose(M,P,L));R.sourceTrs=l;for(const I in l)I!=="TRANSLATION"&&I!=="ROTATION"&&I!=="SCALE"&&w.geometry.setAttribute(I,l[I]);u.Tme.prototype.copy.call(R,w),this.parser.assignFinalMaterial(R),y.push(R)}return d.isGroup?(d.clear(),d.add(...y),d):y[0]}))}}const Af="glTF";class Au{constructor(e){this.name=Hn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Af)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<i;){const l=s.getUint32(o,!0);o+=4;const h=s.getUint32(o,!0);if(o+=4,h===1313821514){const d=new Uint8Array(e,12+o,l);this.content=n.decode(d)}else if(h===5130562){const d=12+o;this.body=e.slice(d,d+l)}o+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class bu{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Hn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,l={},h={},d={};for(const f in o){const v=qd[f]||f.toLowerCase();l[v]=o[f]}for(const f in e.attributes){const v=qd[f]||f.toLowerCase();if(o[f]!==void 0){const y=n.accessors[e.attributes[f]],w=Po[y.componentType];d[v]=w.name,h[v]=y.normalized===!0}}return t.getDependency("bufferView",s).then(function(f){return new Promise(function(v){i.decodeDracoFile(f,function(y){for(const w in y.attributes){const E=y.attributes[w],M=h[w];M!==void 0&&(E.normalized=M)}v(y)},l,d)})})}}class bf{constructor(){this.name=Hn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Lv{constructor(){this.name=Hn.KHR_MESH_QUANTIZATION}}class jm extends u._C8{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let o=0;o!==i;o++)t[o]=n[s+o];return t}interpolate_(e,t,n,i){const s=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=2*l,d=3*l,f=i-t,v=(n-t)/f,y=v*v,w=y*v,E=e*d,M=E-d,P=-2*w+3*y,L=w-y,R=1-P,I=L-y+v;for(let N=0;N!==l;N++){const j=o[M+N+l],H=o[M+N+h]*f,X=o[E+N+l],ne=o[E+N]*f;s[N]=R*j+I*H+P*X+L*ne}return s}}const Ov=new u._fP;class kv extends jm{interpolate_(e,t,n,i){const s=super.interpolate_(e,t,n,i);return Ov.fromArray(s).normalize().toArray(s),s}}const Tr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Po={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qd={9728:u.TyD,9729:u.wem,9984:u.YLQ,9985:u.qyh,9986:u.aH4,9987:u.D1R},dc={33071:u.uWy,33648:u.OoA,10497:u.rpg},Wd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qd={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},pr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ji={CUBICSPLINE:void 0,LINEAR:u.NMF,STEP:u.Syv};function ms(a,e,t){for(const n in t.extensions)a[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function no(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Vm(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)a.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function xf(a){const e=a.extensions&&a.extensions[Hn.KHR_DRACO_MESH_COMPRESSION];let t;return t=e?"draco:"+e.bufferView+":"+e.indices+":"+Uv(e.attributes):a.indices+":"+Uv(a.attributes)+":"+a.mode,t}function Uv(a){let e="";const t=Object.keys(a).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+a[t[n]]+";";return e}function Ch(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Fa=new u.yGw;class ze{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ua,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,s=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&s<98?this.textureLoader=new u.dpR(this.options.manager):this.textureLoader=new u.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new u.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const l={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:n,userData:{}};ms(s,l,i),no(l,i),Promise.all(n._invokeAll(function(h){return h.afterRoot&&h.afterRoot(l)})).then(function(){e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const o=t[i].joints;for(let l=0,h=o.length;l<h;l++)e[o[l]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const o=e[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),s=(o,l)=>{const h=this.associations.get(o);h!=null&&this.associations.set(l,h);for(const[d,f]of o.children.entries())s(f,l.children[d])};return s(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Hn.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,o){n.load(u.Zp0.resolveURL(t.uri,i.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const o=Wd[i.type],l=Po[i.componentType],h=i.normalized===!0,d=new l(i.count*o);return Promise.resolve(new u.TlE(d,o,h))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(o){const l=o[0],h=Wd[i.type],d=Po[i.componentType],f=d.BYTES_PER_ELEMENT,v=f*h,y=i.byteOffset||0,w=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,E=i.normalized===!0;let M,P;if(w&&w!==v){const L=Math.floor(y/w),R="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+L+":"+i.count;let I=t.cache.get(R);I||(M=new d(l,L*w,i.count*w/f),I=new u.vpT(M,w/f),t.cache.add(R,I)),P=new u.kB5(I,h,y%w/f,E)}else M=l===null?new d(i.count*h):new d(l,y,i.count*h),P=new u.TlE(M,h,E);if(i.sparse!==void 0){const L=Wd.SCALAR,R=Po[i.sparse.indices.componentType],I=i.sparse.indices.byteOffset||0,N=i.sparse.values.byteOffset||0,j=new R(o[1],I,i.sparse.count*L),H=new d(o[2],N,i.sparse.count*h);l!==null&&(P=new u.TlE(P.array.slice(),P.itemSize,P.normalized));for(let X=0,ne=j.length;X<ne;X++){const pe=j[X];if(P.setX(pe,H[X*h]),h>=2&&P.setY(pe,H[X*h+1]),h>=3&&P.setZ(pe,H[X*h+2]),h>=4&&P.setW(pe,H[X*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return P})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,s=t.images[i];let o=this.textureLoader;if(s.uri){const l=n.manager.getHandler(s.uri);l!==null&&(o=l)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,n){const i=this,s=this.json,o=s.textures[e],l=s.images[t],h=(l.uri||l.bufferView)+":"+o.sampler;if(this.textureCache[h])return this.textureCache[h];const d=this.loadImageSource(t,n).then(function(f){f.name=o.name||l.name||"",f.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(f.name=l.uri);const v=(s.samplers||{})[o.sampler]||{};return f.magFilter=Qd[v.magFilter]||u.wem,f.minFilter=Qd[v.minFilter]||u.D1R,f.wrapS=dc[v.wrapS]||u.rpg,f.wrapT=dc[v.wrapT]||u.rpg,v.extras&&v.extras.uuid!==void 0&&(f.uuid=v.extras.uuid),i.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[h]=d,d}loadImageSource(e,t,n=!1,i=!1){const s=this,o=this.json,l=this.options;if(!i&&this.sourceCache[e]!==void 0)return this.sourceCache[e].then(E=>E.clone());const h=o.images[e],d=self.URL||self.webkitURL;h.uri===void 0&&h.extras&&h.extras.uri&&(h.uri=h.extras.uri);let f=h.uri||"",v=!1,y=null;if(h.bufferView===void 0||n&&f){if(h.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else f=s.getDependency("bufferView",h.bufferView).then(function(E){v=!0;const M=new Blob([E],{type:h.mimeType});return f=d.createObjectURL(M),y=M,f});const w=Promise.resolve(f).then(function(E){return new Promise(function(M,P){let L=M;t.isImageBitmapLoader===!0&&(L=function(R){const I=new u.xEZ(R);I.needsUpdate=!0,M(I)}),t.load(u.Zp0.resolveURL(E,l.path),L,void 0,function(R){t.isImageBitmapLoader===!0?(t=new u.dpR(s.options.manager),L=M,t.setCrossOrigin(s.options.crossOrigin),t.setRequestHeader(s.options.requestHeader),t.load(u.Zp0.resolveURL(E,l.path),L,void 0,P)):P(R)})})}).then(function(E){var M;if(v===!0&&d.revokeObjectURL(f),E.userData.mimeType=h.mimeType||((M=h.uri).search(/\.jpe?g($|\?)/i)>0||M.search(/^data\:image\/jpeg/)===0?"image/jpeg":M.search(/\.webp($|\?)/i)>0||M.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),E.flipY=!1,h.extras){if(h.extras.flipY!==void 0){if(t.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let P=E;const L=h.extras.flipY&&!P.flipY;createImageBitmap(P.source.data,{imageOrientation:L?"flipY":"none"}).then(function(R){P._newTex&&(P=P._newTex),P.source.data.close&&P.source.data.close(),P.source.data=R,P.source.needsUpdate=!0,P.needsUpdate=!0})}E.flipY=h.extras.flipY,E.needsUpdate=!0,delete h.extras.flipY}h.extras.uuid!==void 0&&(E.source.uuid=h.extras.uuid),h.extras.t_uuid!==void 0&&(E.uuid=h.extras.t_uuid)}return h.uri&&typeof h.uri=="string"&&v===!1&&!h.uri.startsWith("/")&&(E.userData.rootPath=u.Zp0.resolveURL(h.uri,l.path)),y&&(E.userData.__sourceBlob=y),!n&&h.uri&&h.uri!==f&&s.loadImageSource(e,t,!0,!0).then(function(P){E.source.data&&E.source.data.close&&E.source.data.close(),E.dispose(),E.source=P.source,E.source.needsUpdate=!0,E.needsUpdate=!0,E.uuid=P.uuid,E.flipY=P.flipY,E.userData=P.userData,E.setDirty&&E.setDirty(),P._newTex=E}),E}).catch(function(E){throw console.error("THREE.GLTFLoader: Couldn't load texture",f),E});return this.sourceCache[e]=w,w}assignTexture(e,t,n,i){const s=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&((o=o.clone()).channel=n.texCoord),s.extensions[Hn.KHR_TEXTURE_TRANSFORM]){const l=n.extensions!==void 0?n.extensions[Hn.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const h=s.associations.get(o);o=s.extensions[Hn.KHR_TEXTURE_TRANSFORM].extendTexture(o,l),s.associations.set(o,h)}}return i!==void 0&&(o.colorSpace=i),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+n.uuid;let h=this.cache.get(l);h||(h=new u.UY4,u.F5T.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(l,h)),n=h}else if(e.isLine){const l="LineBasicMaterial:"+n.uuid;let h=this.cache.get(l);h||(h=new u.nls,u.F5T.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,this.cache.add(l,h)),n=h}if(i||s||o){let l="ClonedMaterial:"+n.uuid+":";i&&(l+="derivative-tangents:"),s&&(l+="vertex-colors:"),o&&(l+="flat-shading:");let h=this.cache.get(l);h||(h=n.clone(),s&&(h.vertexColors=!0),o&&(h.flatShading=!0),i&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(l,h),this.associations.set(h,this.associations.get(n))),n=h}e.material=n}getMaterialType(){return u.Wid}loadMaterial(e){const t=this,n=this.json,i=this.extensions,s=n.materials[e];let o;const l={},h=[];if((s.extensions||{})[Hn.KHR_MATERIALS_UNLIT]){const f=i[Hn.KHR_MATERIALS_UNLIT];o=f.getMaterialType(),h.push(f.extendParams(l,s,t))}else{const f=s.pbrMetallicRoughness||{};if(l.color=new u.Ilk(1,1,1),l.opacity=1,Array.isArray(f.baseColorFactor)){const v=f.baseColorFactor;l.color.fromArray(v),l.opacity=v[3]}f.baseColorTexture!==void 0&&h.push(t.assignTexture(l,"map",f.baseColorTexture,u.KI_)),l.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,l.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(l,"metalnessMap",f.metallicRoughnessTexture)),h.push(t.assignTexture(l,"roughnessMap",f.metallicRoughnessTexture))),o=this._invokeOne(function(v){return v.getMaterialType&&v.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(v){return v.extendMaterialParams&&v.extendMaterialParams(e,l)})))}s.doubleSided===!0&&(l.side=u.ehD);const d=s.alphaMode||"OPAQUE";if(d==="BLEND"?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,d==="MASK"&&(l.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==u.vBJ&&(h.push(t.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new u.FM8(1,1),s.normalTexture.scale!==void 0)){const f=s.normalTexture.scale;l.normalScale.set(f,f)}return s.occlusionTexture!==void 0&&o!==u.vBJ&&(h.push(t.assignTexture(l,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==u.vBJ&&(l.emissive=new u.Ilk().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&o!==u.vBJ&&h.push(t.assignTexture(l,"emissiveMap",s.emissiveTexture,u.KI_)),Promise.all(h).then(function(){const f=new o(l);return s.name&&(f.name=s.name),no(f,s),t.associations.set(f,{materials:e}),s.extensions&&ms(i,f,s),f})}createUniqueName(e){const t=u.iUV.sanitizeNodeName(e||"");let n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function s(l){return n[Hn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(h){return wf(h,l,t)})}const o=[];for(let l=0,h=e.length;l<h;l++){const d=e[l],f=xf(d),v=i[f];if(v)o.push(v.promise);else{let y;y=d.extensions&&d.extensions[Hn.KHR_DRACO_MESH_COMPRESSION]?s(d):wf(new u.u9r,d,t),i[f]={primitive:d,promise:y},o.push(y)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,i=this.extensions,s=n.meshes[e],o=s.primitives,l=[];for(let d=0,f=o.length;d<f;d++){const v=o[d].material===void 0?((h=this.cache).DefaultMaterial===void 0&&(h.DefaultMaterial=new u.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:u.Wl3})),h.DefaultMaterial):this.getDependency("material",o[d].material);l.push(v)}var h;return l.push(t.loadGeometries(o)),Promise.all(l).then(function(d){const f=d.slice(0,d.length-1),v=d[d.length-1],y=[];for(let E=0,M=v.length;E<M;E++){const P=v[E],L=o[E];let R;const I=f[E];if(L.mode===Tr.TRIANGLES||L.mode===Tr.TRIANGLE_STRIP||L.mode===Tr.TRIANGLE_FAN||L.mode===void 0)R=s.isSkinnedMesh===!0?new u.TUv(P,I):new u.Kj0(P,I),R.isSkinnedMesh===!0&&R.normalizeSkinWeights(),L.mode===Tr.TRIANGLE_STRIP?R.geometry=Me(R.geometry,u.UlW):L.mode===Tr.TRIANGLE_FAN&&(R.geometry=Me(R.geometry,u.z$h));else if(L.mode===Tr.LINES)R=new u.ejS(P,I);else if(L.mode===Tr.LINE_STRIP)R=new u.x12(P,I);else if(L.mode===Tr.LINE_LOOP)R=new u.blk(P,I);else{if(L.mode!==Tr.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+L.mode);R=new u.woe(P,I)}Object.keys(R.geometry.morphAttributes).length>0&&Vm(R,s),R.name=t.createUniqueName(s.name||"mesh_"+e),R.geometry&&s.extras&&s.extras.isGeometryUserData?(no(R.geometry,s),L.extensions&&ms(i,R.geometry,L)):(no(R,s),L.extensions&&ms(i,R,L)),t.assignFinalMaterial(R),y.push(R)}s.extensions&&y.forEach(E=>ms(i,E,s));for(let E=0,M=y.length;E<M;E++)t.associations.set(y[E],{meshes:e,primitives:E});if(y.length===1)return y[0];const w=new u.ZAu;t.associations.set(w,{meshes:e});for(let E=0,M=y.length;E<M;E++)w.add(y[E]);return w})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return n.type==="perspective"?t=new u.cPb(u.M8C.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new u.iKG(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),no(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,s=t.joints.length;i<s;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const s=i.pop(),o=i,l=[],h=[];for(let d=0,f=o.length;d<f;d++){const v=o[d];if(v){l.push(v);const y=new u.yGw;s!==null&&y.fromArray(s.array,16*d),h.push(y)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[d])}return new u.OdW(l,h)})}loadAnimation(e){const t=this.json.animations[e],n=t.name?t.name:"animation_"+e,i=[],s=[],o=[],l=[],h=[];for(let d=0,f=t.channels.length;d<f;d++){const v=t.channels[d],y=t.samplers[v.sampler],w=v.target,E=w.node,M=t.parameters!==void 0?t.parameters[y.input]:y.input,P=t.parameters!==void 0?t.parameters[y.output]:y.output;w.node!==void 0&&(i.push(this.getDependency("node",E)),s.push(this.getDependency("accessor",M)),o.push(this.getDependency("accessor",P)),l.push(y),h.push(w))}return Promise.all([Promise.all(i),Promise.all(s),Promise.all(o),Promise.all(l),Promise.all(h)]).then(function(d){const f=d[0],v=d[1],y=d[2],w=d[3],E=d[4],M=[];for(let P=0,L=f.length;P<L;P++){const R=f[P],I=v[P],N=y[P],j=w[P],H=E[P];if(R===void 0)continue;let X;switch(R.updateMatrix(),pr[H.path]){case pr.weights:X=u.dUE;break;case pr.rotation:X=u.iLg;break;default:X=u.yC1}const ne=R.name?R.name:R.uuid,pe=j.interpolation!==void 0?Ji[j.interpolation]:u.NMF,Ae=[];pr[H.path]===pr.weights?R.traverse(function(Ee){Ee.morphTargetInfluences&&Ae.push(Ee.name?Ee.name:Ee.uuid)}):Ae.push(ne);let ve=N.array;if(N.normalized){const Ee=Ch(ve.constructor),xe=new Float32Array(ve.length);for(let we=0,Re=ve.length;we<Re;we++)xe[we]=ve[we]*Ee;ve=xe}for(let Ee=0,xe=Ae.length;Ee<xe;Ee++){const we=new X(Ae[Ee]+"."+pr[H.path],I.array,ve,pe);j.interpolation==="CUBICSPLINE"&&(we.createInterpolant=function(Re){return new(this instanceof u.iLg?kv:jm)(this.times,this.values,this.getValueSize()/3,Re)},we.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),M.push(we)}}return new u.m7l(n,void 0,M)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(s){const o=n._getNodeRef(n.meshCache,i.mesh,s);return i.weights!==void 0&&o.traverse(function(l){if(l.isMesh)for(let h=0,d=i.weights.length;h<d;h++)l.morphTargetInfluences[h]=i.weights[h]}),o})}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),s=[],o=n.children||[];for(let h=0,d=o.length;h<d;h++)s.push(t.getDependency("node",o[h]));const l=n.skin===void 0?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(s),l]).then(function(h){const d=h[0],f=h[1],v=h[2];v!==null&&d.traverse(function(y){y.isSkinnedMesh&&y.bind(v,Fa)});for(let y=0,w=f.length;y<w;y++)d.add(f[y]);return d})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?i.createUniqueName(s.name):"",l=[],h=i._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(e)});return h&&l.push(h),s.camera!==void 0&&l.push(i.getDependency("camera",s.camera).then(function(d){return i._getNodeRef(i.cameraCache,s.camera,d)})),i._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(e)}).forEach(function(d){l.push(d)}),this.nodeCache[e]=Promise.all(l).then(function(d){let f;if(f=s.isBone===!0?new u.N$j:d.length>1?new u.ZAu:d.length===1?d[0]:new u.Tme,f!==d[0])for(let v=0,y=d.length;v<y;v++)f.add(d[v]);if(s.name&&(f.userData.name=s.name,f.name=o),no(f,s),s.extensions&&ms(n,f,s),s.matrix!==void 0){const v=new u.yGw;v.fromArray(s.matrix),f.applyMatrix4(v)}else s.translation!==void 0&&f.position.fromArray(s.translation),s.rotation!==void 0&&f.quaternion.fromArray(s.rotation),s.scale!==void 0&&f.scale.fromArray(s.scale);return i.associations.has(f)||i.associations.set(f,{}),i.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,s=new u.ZAu;n.name&&(s.name=i.createUniqueName(n.name)),no(s,n),n.extensions&&ms(t,s,n);const o=n.nodes||[],l=[];for(let h=0,d=o.length;h<d;h++)l.push(i.getDependency("node",o[h]));return Promise.all(l).then(function(h){for(let d=0,f=h.length;d<f;d++)s.add(h[d]);return i.associations=(d=>{const f=new Map;for(const[v,y]of i.associations)(v instanceof u.F5T||v instanceof u.xEZ)&&f.set(v,y);return d.traverse(v=>{const y=i.associations.get(v);y!=null&&f.set(v,y)}),f})(s),s})}}function wf(a,e,t){const n=e.attributes,i=[];function s(o,l){return t.getDependency("accessor",o).then(function(h){a.setAttribute(l,h)})}for(const o in n){const l=qd[o]||o.toLowerCase();l in a.attributes||i.push(s(n[o],l))}if(e.indices!==void 0&&!a.index){const o=t.getDependency("accessor",e.indices).then(function(l){a.setIndex(l)});i.push(o)}return no(a,e),function(o,l,h){const d=l.attributes,f=new u.ZzF;if(d.POSITION===void 0)return;{const w=h.json.accessors[d.POSITION],E=w.min,M=w.max;if(E===void 0||M===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(f.set(new u.Pa4(E[0],E[1],E[2]),new u.Pa4(M[0],M[1],M[2])),w.normalized){const P=Ch(Po[w.componentType]);f.min.multiplyScalar(P),f.max.multiplyScalar(P)}}const v=l.targets;if(v!==void 0){const w=new u.Pa4,E=new u.Pa4;for(let M=0,P=v.length;M<P;M++){const L=v[M];if(L.POSITION!==void 0){const R=h.json.accessors[L.POSITION],I=R.min,N=R.max;if(I!==void 0&&N!==void 0){if(E.setX(Math.max(Math.abs(I[0]),Math.abs(N[0]))),E.setY(Math.max(Math.abs(I[1]),Math.abs(N[1]))),E.setZ(Math.max(Math.abs(I[2]),Math.abs(N[2]))),R.normalized){const j=Ch(Po[R.componentType]);E.multiplyScalar(j)}w.max(E)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}f.expandByVector(w)}o.boundingBox=f;const y=new u.aLr;f.getCenter(y.center),y.radius=f.min.distanceTo(f.max)/2,o.boundingSphere=y}(a,e,t),Promise.all(i).then(function(){return e.targets!==void 0?function(o,l,h){let d=!1,f=!1,v=!1;for(let M=0,P=l.length;M<P;M++){const L=l[M];if(L.POSITION!==void 0&&(d=!0),L.NORMAL!==void 0&&(f=!0),L.COLOR_0!==void 0&&(v=!0),d&&f&&v)break}if(!d&&!f&&!v)return Promise.resolve(o);const y=[],w=[],E=[];for(let M=0,P=l.length;M<P;M++){const L=l[M];if(d){const R=L.POSITION!==void 0?h.getDependency("accessor",L.POSITION):o.attributes.position;y.push(R)}if(f){const R=L.NORMAL!==void 0?h.getDependency("accessor",L.NORMAL):o.attributes.normal;w.push(R)}if(v){const R=L.COLOR_0!==void 0?h.getDependency("accessor",L.COLOR_0):o.attributes.color;E.push(R)}}return Promise.all([Promise.all(y),Promise.all(w),Promise.all(E)]).then(function(M){const P=M[0],L=M[1],R=M[2];return d&&(o.morphAttributes.position=P),f&&(o.morphAttributes.normal=L),v&&(o.morphAttributes.color=R),o.morphTargetsRelative=!0,o})}(a,e.targets,t):a})}class Ef extends Io{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(nl)}async preparse(e,t){for(const n of this.preparsers)e=await n.process(e,t);return e}parse(e,t,n,i,s){this.preparse.call(this,e,s||t).then(o=>o?super.parse(o,t,n,i):i&&i(new ErrorEvent("no data"))).catch(o=>{console.error(o),i&&i(o??new ErrorEvent("unknown error"))})}transform(e,t){const n=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return n&&e.animations.length>0&&(n.animations=e.animations),n==null||n.traverse(i=>{i.userData.gltfUUID&&(i.uuid=i.userData.gltfUUID,delete i.userData.gltfUUID)}),n}register(e){return super.register(e)}}const nl={key:(a,e,t)=>a.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+t)||"",async process(a,e){var t;if(typeof a=="string"||!new TextDecoder().decode(new Uint8Array(a,0,100)).includes("WebGiGLBWrapper"))return a;const n=new Au(a),i=JSON.parse(n.content||"{}");let s=n.body||a;const o=(t=i.asset)==null?void 0:t.encryption;if(!o)return s;const l=o.type,h=o.version;if(l==="aesgcm"&&h===1){const d=await(0,g.getOrCall)(this.key,o,i,e)||"";try{s=(await(0,g.aesGcmDecrypt)(new Uint8Array(s),d)).buffer}catch{throw new ErrorEvent("decryption error")}}return s}};class Cl extends u.hH6{constructor(e){super(e),this.type=u.cLu}async loadAsync(e,t){const n=await this.parseAsync(e,t,!1),i=new u.IEO(n.data,n.width,n.height,u.wk1,this.type);return i.needsUpdate=!0,i.flipY=!0,i.colorSpace=u.KI_,i.minFilter=u.wem,i.magFilter=u.wem,i.source.data.complete=!0,i}async parseAsync(e,t,n=!1){let i=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const h=await super.loadAsync(e,t);e=URL.createObjectURL(h),i=!0}const s=await(0,g.imageUrlToImageData)(e);i&&URL.revokeObjectURL(e);let o=Uint8Array;return this.type===u.cLu?o=Uint16Array:this.type===u.VzW&&(o=Uint32Array),{data:function(h,d=3,f=Uint16Array,v=!1){let y;const w=h.byteLength>>2,E=new f(w*d);for(let M=0;M<w;M++)y=Math.pow(2,h[4*M+3]-136),v?(E[M*d]=Math.min(h[4*M]*y,65504),E[M*d+1]=Math.min(h[4*M+1]*y,65504),E[M*d+2]=Math.min(h[4*M+2]*y,65504)):(E[M*d]=u.A5E.toHalfFloat(Math.min(h[4*M]*y,65504)),E[M*d+1]=u.A5E.toHalfFloat(Math.min(h[4*M+1]*y,65504)),E[M*d+2]=u.A5E.toHalfFloat(Math.min(h[4*M+2]*y,65504))),d===4&&(E[M*d+3]=u.A5E.toHalfFloat(1));return E}(s.data,4,o,n),width:s.width,height:s.height}}setDataType(e){return this.type=e,this}}class Js extends u.Gql{constructor(e){super(e),this._imageLoader=new u.S3k(e)}static async LoadRootPathTextures(e,t,n,i=!0){var s;const o=[];for(const l of Array.isArray(e)?e:Object.values(e??{})){const h=(s=l==null?void 0:l.userData)==null?void 0:s.rootPath,d=i&&l.image&&t[l.image];if(!h)continue;const f=n.importPath(h,{processImported:!1}).then(v=>{const y=v==null?void 0:v[0],w=y==null?void 0:y.source;if(!y||!w)return null;const E=new u.Hw6(w.data);return l.image&&(E.uuid=l.image),l.image=E.uuid,d||(t[E.uuid]=E),y.dispose(),E}).catch(v=>(console.error(v),delete l.userData.rootPath,null));d?l.rootPathPromise=f:o.push(f)}await Promise.allSettled(o)}parseTextures2(e,t,n){var i,s;for(const h of e){const d=(i=h==null?void 0:h.userData)==null?void 0:i.rootPath;if(d&&(!h.image||!t[h.image])){const f=new u.Hw6(this._imageLoader.load(d,n));if(!f)continue;h.image&&(f.uuid=h.image),t[f.uuid]=f,h.image=f.uuid}h.userData=Yi(h.userData,void 0,!1,{images:t})}const o=super.parseTextures(e,t),l={...o};for(const h of e)(s=h.rootPathPromise)==null||s.then(d=>{if(!d)return;const f=l[h.uuid];f.dispose(),f.source=d,f.source.needsUpdate=!0,f.needsUpdate=!0});return o}parseMaterials2(e,t,n){const i={};return e.forEach(s=>{if(!s)return;const o={...s},l=Object.keys(o);for(const d of l)if(d==="map"||d.endsWith("Map")){const f=o[d];typeof f=="string"&&(t[f]?o[d]=t[f]:(console.warn(`Texture ${f} not found`),delete o[d]))}o.userData&&(o.userData=Yi(o.userData,void 0,!1,{textures:t}),o.userData.cloneId&&o.userData.uuid!==s.uuid&&(o.userData.uuid=s.uuid));const h=n.generateFromTemplateType(o.type,o);h&&(i[s.uuid]=h)}),i}}const Jr="WEBGI_viewer";function xu(a){return new yr(Ef,["gltf","glb","data:model/gltf"],!0,(e,t)=>{if(!e)return e;const n=e,i=new Js(t.loadingManager);return n.register(pc(i,a)),n.register(jc()),n.register(Xd(i)),n.register(s=>new Yd(s)),n.register(s=>new Gm(s)),n.register(s=>new Do(s)),n.register(s=>new fc(s)),n.register(s=>{var o,l,h,d,f,v,y,w,E;const M=s.getDependency;s.getDependency=async(j,H)=>{const X=await M.call(s,j,H);if(X.userData){const ne=X.userData.gltfExtensions;delete X.userData.gltfExtensions,X.userData=Yi(X.userData,{},!1,{}),X.userData.gltfExtensions=ne}return X};const P=Ys()+".drc",L=Ys()+".ktx2",R=(h=(l=(o=s.json)==null?void 0:o.extensionsRequired)==null?void 0:l.includes)==null?void 0:h.call(l,"KHR_draco_mesh_compression");if(R){const j=t.registerFile(P);j&&n.setDRACOLoader(j)}((v=(f=(d=s.json)==null?void 0:d.extensionsUsed)==null?void 0:f.includes)==null?void 0:v.call(f,"EXT_meshopt_compression"))&&(window.MeshoptDecoder?(n.setMeshoptDecoder(window.MeshoptDecoder),s.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const N=(E=(w=(y=s.json)==null?void 0:y.extensionsUsed)==null?void 0:w.includes)==null?void 0:E.call(w,"KHR_texture_basisu");if(N){const j=t.registerFile(L);j&&(n.setKTX2Loader(j),s.options.ktx2Loader=j)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async j=>{R&&t.unregisterFile(P),N&&t.unregisterFile(L);const H=await wu(s,a,i);j.scene&&(j.scene.__importedViewerConfig=H)}}}),n})}const Ro="WEBGI_light_extras",Us="WEBGI_object3d_extras",ws="WEBGI_material_extras",jc=a=>e=>({name:"__"+Us,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(i=>{var s,o;if(!i.isObject3D)return;const l=(o=(s=i.userData)==null?void 0:s.gltfExtensions)==null?void 0:o[Us];if(!l)return void(i.isLight&&!i.isAmbientLight&&(i.castShadow=!0));const h=l.castShadow!==void 0||l.receiveShadow!==void 0;l.castShadow!==void 0&&(i.castShadow=l.castShadow),l.receiveShadow!==void 0&&(i.receiveShadow=l.receiveShadow),l.visible!==void 0&&(i.visible=l.visible),l.frustumCulled!==void 0&&(i.frustumCulled=l.frustumCulled),l.renderOrder!==void 0&&(i.renderOrder=l.renderOrder),l.layers!==void 0&&(i.layers.mask=l.layers),h&&(i.userData.__keepShadowDef=!0),delete i.userData.gltfExtensions[Us]})})}}),pc=(a,e)=>t=>({name:"__"+ws,afterRoot:async n=>{var i,s,o;const l=n.scenes||(n.scene?[n.scene]:[]);for(const h of l){const d=(s=(i=h.userData)==null?void 0:i.gltfExtensions)==null?void 0:s[ws],f=d&&await((o=e.getPlugin(Yt))==null?void 0:o.importConfigResources(d.resources||{}))||{};h.traverse(v=>{var y,w;const E=v==null?void 0:v.material;if(!(E!=null&&E.isMaterial))return;const M=(w=(y=E.userData)==null?void 0:y.gltfExtensions)==null?void 0:w[ws];M&&(M.emissiveIntensity!==void 0&&(E.emissiveIntensity=M.emissiveIntensity),M.fog!==void 0&&(E.fog=M.fog),M.flatShading!==void 0&&(E.flatShading=M.flatShading),M.blending!==void 0&&(E.blending=M.blending),M.side!==void 0&&(E.side=M.side),M.shadowSide!==void 0&&(E.shadowSide=M.shadowSide),M.depthFunc!==void 0&&(E.depthFunc=M.depthFunc),M.depthTest!==void 0&&(E.depthTest=M.depthTest),M.depthWrite!==void 0&&(E.depthWrite=M.depthWrite),M.colorWrite!==void 0&&(E.colorWrite=M.colorWrite),M.vertexColors!==void 0&&(E.vertexColors=M.vertexColors),M.alphaTest!==void 0&&(E.alphaTest=M.alphaTest),M.wireframe!==void 0&&(E.wireframe=M.wireframe),M.wireframeLinewidth!==void 0&&(E.wireframeLinewidth=M.wireframeLinewidth),M.wireframeLinecap!==void 0&&(E.wireframeLinecap=M.wireframeLinecap),M.wireframeLinejoin!==void 0&&(E.wireframeLinejoin=M.wireframeLinejoin),M.rotation!==void 0&&(E.rotation=M.rotation),M.polygonOffset!==void 0&&(E.polygonOffset=M.polygonOffset),M.polygonOffsetFactor!==void 0&&(E.polygonOffsetFactor=M.polygonOffsetFactor),M.polygonOffsetUnits!==void 0&&(E.polygonOffsetUnits=M.polygonOffsetUnits),M.dithering!==void 0&&(E.dithering=M.dithering),M.alphaToCoverage!==void 0&&(E.alphaToCoverage=M.alphaToCoverage),M.premultipliedAlpha!==void 0&&(E.premultipliedAlpha=M.premultipliedAlpha),M.toneMapped!==void 0&&(E.toneMapped=M.toneMapped),M.normalScale!==void 0&&E.normalScale!==void 0&&(Array.isArray(M.normalScale)?E.normalScale.fromArray(M.normalScale):typeof M.normalScale=="number"?E.normalScale.set(M.normalScale,M.normalScale):e.console.warn("normalScale is not an array or number",M.normalScale)),M.reflectivity!==void 0&&(E.reflectivity=M.reflectivity),Object.entries(M).forEach(([P,L])=>{P.startsWith("_")||L&&L.resource&&typeof L.resource=="string"&&(E[P]=Yi(L,E[P],!1,f))}),delete E.userData.gltfExtensions[ws])}),d&&delete h.userData.gltfExtensions[ws]}}}),Xd=a=>e=>({name:"__"+Ro,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(i=>{var s,o;if(!i.isLight)return;const l=(o=(s=i.userData)==null?void 0:s.gltfExtensions)==null?void 0:o[Ro];l&&(!i.shadow&&l.shadow&&console.error("Light has no shadow, cannot import",i,l),l.shadow&&i.shadow&&(l.shadow.bias!==void 0&&(i.shadow.bias=l.shadow.bias),l.shadow.normalBias!==void 0&&(i.shadow.normalBias=l.shadow.normalBias),l.shadow.radius!==void 0&&(i.shadow.radius=l.shadow.radius),l.shadow.mapSize!==void 0&&i.shadow.mapSize.fromArray(l.shadow.mapSize),l.shadow.camera!==void 0&&(i.shadow.camera=a.parseObject(l.shadow.camera))),delete i.userData.gltfExtensions[Ro])})})}});async function wu(a,e,t,n){var i,s,o;if(!n){const v=a.json.scenes||[];if(v.length!==1){for(const y of v)await wu(a,e,t,y);return}n=v[0]}const l=(i=n.extensions)==null?void 0:i[Jr];if(!l)return;const h=[];Object.values(l.resources).forEach(v=>{Object.values(v).forEach(y=>{y.url&&(y.url.type==="Uint16Array"&&y.url.data&&h.push(y.url),y.url.type==="Uint8Array"&&y.url.data&&h.push(y.url))})});for(const v of h){const y=v.data.image,w=a.json.images[y],E=await a.getDependency("bufferView",w.bufferView);if(w.mimeType.startsWith("image/")&&v.type==="Uint16Array"&&v.encoding==="rgbe"){const M=new Blob([E]);let P=URL.createObjectURL(M);(v.encodingVersion||1)<2&&(P="data:image/png;base64,"+btoa(await M.text())),v.data=(await new Cl().parseAsync(P,void 0,!0)).data,URL.revokeObjectURL(P),delete v.encoding,delete v.encodingVersion}else v.data=E}const d={textures:{},materials:{}},f=l.resources;if(f.textures&&a.json.textures)for(const[v,y]of[...Object.entries(f.textures)]){if(y.uuid||!v)continue;delete f.textures[v];const w=a.json.textures.findIndex(E=>{var M,P,L,R,I,N,j;return((M=E.extras)==null?void 0:M.uuid)===v||((R=(L=(P=a.json.samplers)==null?void 0:P[E.sampler])==null?void 0:L.extras)==null?void 0:R.uuid)===v||((j=(N=(I=a.json.images)==null?void 0:I[E.source])==null?void 0:N.extras)==null?void 0:j.t_uuid)===v});w>=0&&(d.textures[v]=await a.getDependency("texture",w))}if(f.materials&&a.json.materials)for(const[v,y]of[...Object.entries(f.materials)]){if(y.uuid||!v)continue;delete f.materials[v];const w=a.json.materials.findIndex(E=>{var M;return((M=E.extras)==null?void 0:M.uuid)===v});w>=0&&(d.materials[v]=await a.getDependency("material",w),d.materials[v]=(o=(s=e.getPlugin(Yt))==null?void 0:s.materials)==null?void 0:o.processMaterial(d.materials[v],{}))}return l.resources=await e.getPlugin(Yt).importConfigResources(f||{},t,d),l}const Eu="WEBGI_materials_bumpmap",Tl="WEBGI_materials_displacementmap",Vc="WEBGI_materials_alphamap",Sf="WEBGI_materials_lightmap";class Yd{constructor(e){this.parser=e,this.name=Eu}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.bumpScale!==void 0&&(t.bumpScale=o.bumpScale),o.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class Gm{constructor(e){this.parser=e,this.name=Tl}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.displacementScale!==void 0&&(t.displacementScale=o.displacementScale),o.displacementBias!==void 0&&(t.displacementBias=o.displacementBias),o.displacementTexture!==void 0&&s.push(n.assignTexture(t,"displacementMap",o.displacementTexture)),Promise.all(s)}}class Do{constructor(e){this.parser=e,this.name=Sf}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.lightMapIntensity!==void 0&&(t.lightMapIntensity=o.lightMapIntensity),o.lightMapTexture!==void 0&&s.push(n.assignTexture(t,"lightMap",o.lightMapTexture)),Promise.all(s)}}class fc{constructor(e){this.parser=e,this.name=Vc}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.alphaTexture!==void 0&&s.push(n.assignTexture(t,"alphaMap",o.alphaTexture)),Promise.all(s)}}var Mf=__webpackgi_require__2(23);function Su(){return new yr(Mf.Q,["drc"],!0)}class il extends u.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new u.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,i=e.userData;return e.userData={},super.copy(e,t),Yr(this.userData,i),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=Fi(Yr({},t),!1),this.userData={},this.children=n,i.type="DirectionalLight2",i.target=this.target.position.toArray(),Object.assign(i,Fi(this,!0,e))}fromJSON(e,t){if(e.type!=="DirectionalLight2")return null;const n=e.target,i=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,Yi(e,this,!0,t),n&&(e.target=n),i&&(i.color!==void 0&&this.color.set(i.color),i.intensity!==void 0&&(this.intensity=i.intensity),e.object=i),this}}class Kd extends u.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,i,s,o){super(e,t,n,i,s,o),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,i=e.userData;return e.userData={},super.copy(e,t),Yr(this.userData,i),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=Fi(Yr({},t),!1),this.userData={},this.children=n,i.type="SpotLight2",i.target=this.target.position.toArray(),Object.assign(i,Fi(this,!0,e))}fromJSON(e,t){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),Yi(e,this,!0,t),this):this)}}class Th extends u.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,i){super(e,t,n,i),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),Yr(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=Fi(Yr({},t),!1),this.userData={},n.type="PointLight2",Object.assign(n,Fi(this,!0,e))}fromJSON(e,t){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),Yi(e,this,!0,t),this):this}}class Jd extends u.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(e,t),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),Yr(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=Fi(Yr({},t),!1),this.userData={},n.type="AmbientLight2",Object.assign(n,Fi(this,!0,e))}fromJSON(e,t){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),Yi(e,this,!0,t),this):this}}class Mu extends u.aNw{load(e,t,n,i){const s=new u.hH6(this.manager);s.setPath(this.path),s.setResponseType("text"),s.load(e,o=>{try{t(this.parse(o))}catch(l){i?i(l):console.error(l),this.manager.itemError(e)}},n,i)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,n=null;const i=new u.Pa4(0,0,0),s=new u.Pa4(1,1,1),o=e.split(/[\n\r]+/g);let l=null,h=0;for(let v=0,y=o.length;v<y;v++){const w=o[v].trim(),E=w.split(/\s/g);switch(E[0]){case"TITLE":t=w.substring(7,w.length-1);break;case"LUT_3D_SIZE":const M=E[1];n=parseFloat(M),l=new Uint8Array(n*n*n*4);break;case"DOMAIN_MIN":i.x=parseFloat(E[1]),i.y=parseFloat(E[2]),i.z=parseFloat(E[3]);break;case"DOMAIN_MAX":s.x=parseFloat(E[1]),s.y=parseFloat(E[2]),s.z=parseFloat(E[3]);break;default:const P=parseFloat(E[0]),L=parseFloat(E[1]),R=parseFloat(E[2]);if(P>1||P<0||L>1||L<0||R>1||R<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");l[h+0]=255*P,l[h+1]=255*L,l[h+2]=255*R,l[h+3]=255,h+=4}}const d=new u.IEO;d.image.data=l,d.image.width=n,d.image.height=n*n,d.type=u.ywz,d.magFilter=u.wem,d.minFilter=u.wem,d.wrapS=u.uWy,d.wrapT=u.uWy,d.generateMipmaps=!1,d.needsUpdate=!0;const f=new u.JUT;return f.image.data=l,f.image.width=n,f.image.height=n,f.image.depth=n,f.type=u.ywz,f.magFilter=u.wem,f.minFilter=u.wem,f.wrapS=u.uWy,f.wrapT=u.uWy,f.wrapR=u.uWy,f.generateMipmaps=!1,f.needsUpdate=!0,{title:t,size:n,domainMin:i,domainMax:s,texture:d,texture3D:f}}}let _i=class{constructor({domainMax:a,domainMin:e,size:t,texture:n,texture3D:i,title:s}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=a,this.domainMin=e,this.size=t,this.texture=n,this.texture3D=i,this.title=s,this.uuid=Pe(),this.userData.__needsSourceBuffer=!0}fromJSON(a,e){return a.type!==this.type&&console.warn("type mismatch while import",a,this),console.error("not supported"),this}toJSON(a){return uf(this,a,this.texture.name)}};_i=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([Ko("LUTCubeTextureWrapper")],_i);class Ih extends Mu{parse(e){const t=super.parse(e);return new _i(t)}}var Bo={},Li=Uint8Array,Es=Uint16Array,va=Uint32Array,Zs=new Li([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gs=new Li([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ph=new Li([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zd=function(a,e){for(var t=new Es(31),n=0;n<31;++n)t[n]=e+=1<<a[n-1];var i=new va(t[30]);for(n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return[t,i]},Cu=Zd(Zs,2),Tu=Cu[0],Cf=Cu[1];Tu[28]=258,Cf[258]=28;for(var Il=Zd(gs,0),Gc=Il[0],$s=Il[1],Hc=new Es(32768),Oi=0;Oi<32768;++Oi){var Iu=(43690&Oi)>>>1|(21845&Oi)<<1;Iu=(61680&(Iu=(52428&Iu)>>>2|(13107&Iu)<<2))>>>4|(3855&Iu)<<4,Hc[Oi]=((65280&Iu)>>>8|(255&Iu)<<8)>>>1}var io=function(a,e,t){for(var n=a.length,i=0,s=new Es(e);i<n;++i)++s[a[i]-1];var o,l=new Es(e);for(i=0;i<e;++i)l[i]=l[i-1]+s[i-1]<<1;if(t){o=new Es(1<<e);var h=15-e;for(i=0;i<n;++i)if(a[i])for(var d=i<<4|a[i],f=e-a[i],v=l[a[i]-1]++<<f,y=v|(1<<f)-1;v<=y;++v)o[Hc[v]>>>h]=d}else for(o=new Es(n),i=0;i<n;++i)a[i]&&(o[i]=Hc[l[a[i]-1]++]>>>15-a[i]);return o},Pl=new Li(288);for(Oi=0;Oi<144;++Oi)Pl[Oi]=8;for(Oi=144;Oi<256;++Oi)Pl[Oi]=9;for(Oi=256;Oi<280;++Oi)Pl[Oi]=7;for(Oi=280;Oi<288;++Oi)Pl[Oi]=8;var Pu=new Li(32);for(Oi=0;Oi<32;++Oi)Pu[Oi]=5;var Qc=io(Pl,9,0),Hm=io(Pl,9,1),Qm=io(Pu,5,0),Vi=io(Pu,5,1),ea=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},ss=function(a,e,t){var n=e/8|0;return(a[n]|a[n+1]<<8)>>(7&e)&t},rl=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(7&e)},za=function(a){return(a/8|0)+(7&a&&1)},Ns=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var n=new(a instanceof Es?Es:a instanceof va?va:Li)(t-e);return n.set(a.subarray(e,t)),n},Rl=function(a,e,t){var n=a.length;if(!n||t&&!t.l&&n<5)return e||new Li(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new Li(3*n));var o=function(hn){var wn=e.length;if(hn>wn){var Jn=new Li(Math.max(2*wn,hn));Jn.set(e),e=Jn}},l=t.f||0,h=t.p||0,d=t.b||0,f=t.l,v=t.d,y=t.m,w=t.n,E=8*n;do{if(!f){t.f=l=ss(a,h,1);var M=ss(a,h+1,3);if(h+=3,!M){var P=a[(ve=za(h)+4)-4]|a[ve-3]<<8,L=ve+P;if(L>n){if(s)throw"unexpected EOF";break}i&&o(d+P),e.set(a.subarray(ve,L),d),t.b=d+=P,t.p=h=8*L;continue}if(M==1)f=Hm,v=Vi,y=9,w=5;else{if(M!=2)throw"invalid block type";var R=ss(a,h,31)+257,I=ss(a,h+10,15)+4,N=R+ss(a,h+5,31)+1;h+=14;for(var j=new Li(N),H=new Li(19),X=0;X<I;++X)H[Ph[X]]=ss(a,h+3*X,7);h+=3*I;var ne=ea(H),pe=(1<<ne)-1,Ae=io(H,ne,1);for(X=0;X<N;){var ve,Ee=Ae[ss(a,h,pe)];if(h+=15&Ee,(ve=Ee>>>4)<16)j[X++]=ve;else{var xe=0,we=0;for(ve==16?(we=3+ss(a,h,3),h+=2,xe=j[X-1]):ve==17?(we=3+ss(a,h,7),h+=3):ve==18&&(we=11+ss(a,h,127),h+=7);we--;)j[X++]=xe}}var Re=j.subarray(0,R),Be=j.subarray(R);y=ea(Re),w=ea(Be),f=io(Re,y,1),v=io(Be,w,1)}if(h>E){if(s)throw"unexpected EOF";break}}i&&o(d+131072);for(var Oe=(1<<y)-1,at=(1<<w)-1,st=h;;st=h){var St=(xe=f[rl(a,h)&Oe])>>>4;if((h+=15&xe)>E){if(s)throw"unexpected EOF";break}if(!xe)throw"invalid length/literal";if(St<256)e[d++]=St;else{if(St==256){st=h,f=null;break}var dt=St-254;if(St>264){var ht=Zs[X=St-257];dt=ss(a,h,(1<<ht)-1)+Tu[X],h+=ht}var Nt=v[rl(a,h)&at],Bt=Nt>>>4;if(!Nt)throw"invalid distance";if(h+=15&Nt,Be=Gc[Bt],Bt>3&&(ht=gs[Bt],Be+=rl(a,h)&(1<<ht)-1,h+=ht),h>E){if(s)throw"unexpected EOF";break}i&&o(d+131072);for(var rn=d+dt;d<rn;d+=4)e[d]=e[d-Be],e[d+1]=e[d+1-Be],e[d+2]=e[d+2-Be],e[d+3]=e[d+3-Be];d=rn}}t.l=f,t.p=st,t.b=d,f&&(l=1,t.m=y,t.d=v,t.n=w)}while(!l);return d==e.length?e:Ns(e,0,d)},sl=function(a,e,t){t<<=7&e;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8},Wc=function(a,e,t){t<<=7&e;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8,a[n+2]|=t>>>16},Dl=function(a,e){for(var t=[],n=0;n<a.length;++n)a[n]&&t.push({s:n,f:a[n]});var i=t.length,s=t.slice();if(!i)return[Bl,0];if(i==1){var o=new Li(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(j,H){return j.f-H.f}),t.push({s:-1,f:25001});var l=t[0],h=t[1],d=0,f=1,v=2;for(t[0]={s:-1,f:l.f+h.f,l,r:h};f!=i-1;)l=t[t[d].f<t[v].f?d++:v++],h=t[d!=f&&t[d].f<t[v].f?d++:v++],t[f++]={s:-1,f:l.f+h.f,l,r:h};var y=s[0].s;for(n=1;n<i;++n)s[n].s>y&&(y=s[n].s);var w=new Es(y+1),E=Ru(t[f-1],w,0);if(E>e){n=0;var M=0,P=E-e,L=1<<P;for(s.sort(function(j,H){return w[H.s]-w[j.s]||j.f-H.f});n<i;++n){var R=s[n].s;if(!(w[R]>e))break;M+=L-(1<<E-w[R]),w[R]=e}for(M>>>=P;M>0;){var I=s[n].s;w[I]<e?M-=1<<e-w[I]++-1:++n}for(;n>=0&&M;--n){var N=s[n].s;w[N]==e&&(--w[N],++M)}E=e}return[new Li(w),E]},Ru=function(a,e,t){return a.s==-1?Math.max(Ru(a.l,e,t+1),Ru(a.r,e,t+1)):e[a.s]=t},Rh=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new Es(++e),n=0,i=a[0],s=1,o=function(h){t[n++]=h},l=1;l<=e;++l)if(a[l]==i&&l!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=a[l]}return[t.subarray(0,n),e]},Zr=function(a,e){for(var t=0,n=0;n<e.length;++n)t+=a[n]*e[n];return t},Dh=function(a,e,t){var n=t.length,i=za(e+2);a[i]=255&n,a[i+1]=n>>>8,a[i+2]=255^a[i],a[i+3]=255^a[i+1];for(var s=0;s<n;++s)a[i+s+4]=t[s];return 8*(i+4+n)},Ss=function(a,e,t,n,i,s,o,l,h,d,f){sl(e,f++,t),++i[256];for(var v=Dl(i,15),y=v[0],w=v[1],E=Dl(s,15),M=E[0],P=E[1],L=Rh(y),R=L[0],I=L[1],N=Rh(M),j=N[0],H=N[1],X=new Es(19),ne=0;ne<R.length;++ne)X[31&R[ne]]++;for(ne=0;ne<j.length;++ne)X[31&j[ne]]++;for(var pe=Dl(X,7),Ae=pe[0],ve=pe[1],Ee=19;Ee>4&&!Ae[Ph[Ee-1]];--Ee);var xe,we,Re,Be,Oe=d+5<<3,at=Zr(i,Pl)+Zr(s,Pu)+o,st=Zr(i,y)+Zr(s,M)+o+14+3*Ee+Zr(X,Ae)+(2*X[16]+3*X[17]+7*X[18]);if(Oe<=at&&Oe<=st)return Dh(e,f,a.subarray(h,h+d));if(sl(e,f,1+(st<at)),f+=2,st<at){xe=io(y,w,0),we=y,Re=io(M,P,0),Be=M;var St=io(Ae,ve,0);for(sl(e,f,I-257),sl(e,f+5,H-1),sl(e,f+10,Ee-4),f+=14,ne=0;ne<Ee;++ne)sl(e,f+3*ne,Ae[Ph[ne]]);f+=3*Ee;for(var dt=[R,j],ht=0;ht<2;++ht){var Nt=dt[ht];for(ne=0;ne<Nt.length;++ne){var Bt=31&Nt[ne];sl(e,f,St[Bt]),f+=Ae[Bt],Bt>15&&(sl(e,f,Nt[ne]>>>5&127),f+=Nt[ne]>>>12)}}}else xe=Qc,we=Pl,Re=Qm,Be=Pu;for(ne=0;ne<l;++ne)if(n[ne]>255){Bt=n[ne]>>>18&31,Wc(e,f,xe[Bt+257]),f+=we[Bt+257],Bt>7&&(sl(e,f,n[ne]>>>23&31),f+=Zs[Bt]);var rn=31&n[ne];Wc(e,f,Re[rn]),f+=Be[rn],rn>3&&(Wc(e,f,n[ne]>>>5&8191),f+=gs[rn])}else Wc(e,f,xe[n[ne]]),f+=we[n[ne]];return Wc(e,f,xe[256]),f+we[256]},$d=new va([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Bl=new Li(0),vs=function(a,e,t,n,i,s){var o=a.length,l=new Li(n+o+5*(1+Math.ceil(o/7e3))+i),h=l.subarray(n,l.length-i),d=0;if(!e||o<8)for(var f=0;f<=o;f+=65535){var v=f+65535;v<o?d=Dh(h,d,a.subarray(f,v)):(h[f]=s,d=Dh(h,d,a.subarray(f,o)))}else{for(var y=$d[e-1],w=y>>>13,E=8191&y,M=(1<<t)-1,P=new Es(32768),L=new Es(M+1),R=Math.ceil(t/3),I=2*R,N=function(jt){return(a[jt]^a[jt+1]<<R^a[jt+2]<<I)&M},j=new va(25e3),H=new Es(288),X=new Es(32),ne=0,pe=0,Ae=(f=0,0),ve=0,Ee=0;f<o;++f){var xe=N(f),we=32767&f,Re=L[xe];if(P[we]=Re,L[xe]=we,ve<=f){var Be=o-f;if((ne>7e3||Ae>24576)&&Be>423){d=Ss(a,h,0,j,H,X,pe,Ae,Ee,f-Ee,d),Ae=ne=pe=0,Ee=f;for(var Oe=0;Oe<286;++Oe)H[Oe]=0;for(Oe=0;Oe<30;++Oe)X[Oe]=0}var at=2,st=0,St=E,dt=we-Re&32767;if(Be>2&&xe==N(f-dt))for(var ht=Math.min(w,Be)-1,Nt=Math.min(32767,f),Bt=Math.min(258,Be);dt<=Nt&&--St&&we!=Re;){if(a[f+at]==a[f+at-dt]){for(var rn=0;rn<Bt&&a[f+rn]==a[f+rn-dt];++rn);if(rn>at){if(at=rn,st=dt,rn>ht)break;var hn=Math.min(dt,rn-2),wn=0;for(Oe=0;Oe<hn;++Oe){var Jn=f-dt+Oe+32768&32767,Fn=Jn-P[Jn]+32768&32767;Fn>wn&&(wn=Fn,Re=Jn)}}}dt+=(we=Re)-(Re=P[we])+32768&32767}if(st){j[Ae++]=268435456|Cf[at]<<18|$s[st];var jn=31&Cf[at],wt=31&$s[st];pe+=Zs[jn]+gs[wt],++H[257+jn],++X[wt],ve=f+at,++ne}else j[Ae++]=a[f],++H[a[f]]}}d=Ss(a,h,s,j,H,X,pe,Ae,Ee,f-Ee,d),!s&&7&d&&(d=Dh(h,d+1,Bl))}return Ns(l,0,n+za(d)+i)},ep=function(){for(var a=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&-306674912)^t>>>1;a[e]=t}return a}(),qc=function(){var a=-1;return{p:function(e){for(var t=a,n=0;n<e.length;++n)t=ep[255&t^e[n]]^t>>>8;a=t},d:function(){return~a}}},En=function(){var a=1,e=0;return{p:function(t){for(var n=a,i=e,s=t.length,o=0;o!=s;){for(var l=Math.min(o+2655,s);o<l;++o)i+=n+=t[o];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}a=n,e=i},d:function(){return(255&(a%=65521))<<24|a>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Lr=function(a,e,t,n,i){return vs(a,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+e.mem,t,n,!i)},Lo=function(a,e){var t={};for(var n in a)t[n]=a[n];for(var n in e)t[n]=e[n];return t},Ll=function(a,e,t){for(var n=a(),i=a.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var l=n[o],h=s[o];if(typeof l=="function"){e+=";"+h+"=";var d=l.toString();if(l.prototype)if(d.indexOf("[native code]")!=-1){var f=d.indexOf(" ",8)+1;e+=d.slice(f,d.indexOf("(",f))}else for(var v in e+=d,l.prototype)e+=";"+h+".prototype."+v+"="+l.prototype[v].toString();else e+=d}else t[h]=l}return[e,t]},Tf=[],ya=function(a,e,t,n){var i;if(!Tf[t]){for(var s="",o={},l=a.length-1,h=0;h<l;++h)s=(i=Ll(a[h],s,o))[0],o=i[1];Tf[t]=Ll(a[l],s,o)}var d=Lo({},Tf[t][1]);return function(f,v,y,w,E){var M=new Worker(Bo[v]||(Bo[v]=URL.createObjectURL(new Blob([f],{type:"text/javascript"}))));return M.onerror=function(P){return E(P.error,null)},M.onmessage=function(P){return E(null,P.data)},M.postMessage(y,w),M}(Tf[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,d,function(f){var v=[];for(var y in f)(f[y]instanceof Li||f[y]instanceof Es||f[y]instanceof va)&&v.push((f[y]=new f[y].constructor(f[y])).buffer);return v}(d),n)},Ol=function(){return[Li,Es,va,Zs,gs,Ph,Tu,Gc,Hm,Vi,Hc,io,ea,ss,rl,za,Ns,Rl,sr,Xc,qm]},Bh=function(){return[Li,Es,va,Zs,gs,Ph,Cf,$s,Qc,Pl,Qm,Pu,Hc,$d,Bl,io,sl,Wc,Dl,Ru,Rh,Zr,Dh,Ss,za,Ns,vs,Lr,gt,Xc]},rr=function(){return[Xm,k,nr,qc,ep]},Lh=function(){return[ba,If]},ur=function(){return[A,nr,En]},Wm=function(){return[C]},Xc=function(a){return postMessage(a,[a.buffer])},qm=function(a){return a&&a.size&&new Li(a.size)},Du=function(a,e,t,n,i,s){var o=ya(t,n,i,function(l,h){o.terminate(),s(l,h)});return o.postMessage([a,e],e.consume?[a.buffer]:[]),function(){o.terminate()}},Aa=function(a){return a.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return a.push(e.data[0],e.data[1])}},Bu=function(a,e,t,n,i){var s,o=ya(a,n,i,function(l,h){l?(o.terminate(),e.ondata.call(e,l)):(h[1]&&o.terminate(),e.ondata.call(e,l,h[0],h[1]))});o.postMessage(t),e.push=function(l,h){if(s)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([l,s=h],[l.buffer])},e.terminate=function(){o.terminate()}},Fs=function(a,e){return a[e]|a[e+1]<<8},$r=function(a,e){return(a[e]|a[e+1]<<8|a[e+2]<<16|a[e+3]<<24)>>>0},Tn=function(a,e){return $r(a,e)+4294967296*$r(a,e+4)},nr=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},Xm=function(a,e){var t=e.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=e.level<2?4:e.level==9?2:0,a[9]=3,e.mtime!=0&&nr(a,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){a[3]=8;for(var n=0;n<=t.length;++n)a[n+10]=t.charCodeAt(n)}},ba=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var e=a[3],t=10;4&e&&(t+=a[10]|2+(a[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!a[t++]);return t+(2&e)},If=function(a){var e=a.length;return(a[e-4]|a[e-3]<<8|a[e-2]<<16|a[e-1]<<24)>>>0},k=function(a){return 10+(a.filename&&a.filename.length+1||0)},A=function(a,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=n<<6|(n?32-2*n:1)},C=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function F(a,e){return e||typeof a!="function"||(e=a,a={}),this.ondata=e,a}var ee=function(){function a(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return a.prototype.p=function(e,t){this.ondata(Lr(e,this.o,0,0,!t),t)},a.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},a}(),De=function(){return function(a,e){Bu([Bh,function(){return[Aa,ee]}],this,F.call(this,a,e),function(t){var n=new ee(t.data);onmessage=Aa(n)},6)}}();function Ue(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Du(a,e,[Bh],function(n){return Xc(gt(n.data[0],n.data[1]))},0,t)}function gt(a,e){return Lr(a,e||{},0,0)}var zt=function(){function a(e){this.s={},this.p=new Li(0),this.ondata=e}return a.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new Li(t+e.length);n.set(this.p),n.set(e,t),this.p=n},a.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Rl(this.p,this.o,this.s);this.ondata(Ns(n,t,this.s.b),this.d),this.o=Ns(n,this.s.b-32768),this.s.b=this.o.length,this.p=Ns(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(e,t){this.e(e),this.c(t)},a}(),yn=function(){return function(a){this.ondata=a,Bu([Ol,function(){return[Aa,zt]}],this,0,function(){var e=new zt;onmessage=Aa(e)},7)}}();function ri(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Du(a,e,[Ol],function(n){return Xc(sr(n.data[0],qm(n.data[1])))},1,t)}function sr(a,e){return Rl(a,e)}var zs=function(){function a(e,t){this.c=qc(),this.l=0,this.v=1,ee.call(this,e,t)}return a.prototype.push=function(e,t){ee.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Lr(e,this.o,this.v&&k(this.o),t&&8,!t);this.v&&(Xm(n,this.o),this.v=0),t&&(nr(n,n.length-8,this.c.d()),nr(n,n.length-4,this.l)),this.ondata(n,t)},a}(),Ms=function(){return function(a,e){Bu([Bh,rr,function(){return[Aa,ee,zs]}],this,F.call(this,a,e),function(t){var n=new zs(t.data);onmessage=Aa(n)},8)}}();function Oo(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Du(a,e,[Bh,rr,function(){return[kl]}],function(n){return Xc(kl(n.data[0],n.data[1]))},2,t)}function kl(a,e){e||(e={});var t=qc(),n=a.length;t.p(a);var i=Lr(a,e,k(e),8),s=i.length;return Xm(i,e),nr(i,s-8,t.d()),nr(i,s-4,n),i}var mc=function(){function a(e){this.v=1,zt.call(this,e)}return a.prototype.push=function(e,t){if(zt.prototype.e.call(this,e),this.v){var n=this.p.length>3?ba(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}zt.prototype.c.call(this,t)},a}(),tp=function(){return function(a){this.ondata=a,Bu([Ol,Lh,function(){return[Aa,zt,mc]}],this,0,function(){var e=new mc;onmessage=Aa(e)},9)}}();function Oh(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Du(a,e,[Ol,Lh,function(){return[Yc]}],function(n){return Xc(Yc(n.data[0]))},3,t)}function Yc(a,e){return Rl(a.subarray(ba(a),-8),e||new Li(If(a)))}var kh=function(){function a(e,t){this.c=En(),this.v=1,ee.call(this,e,t)}return a.prototype.push=function(e,t){ee.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e);var n=Lr(e,this.o,this.v&&2,t&&4,!t);this.v&&(A(n,this.o),this.v=0),t&&nr(n,n.length-4,this.c.d()),this.ondata(n,t)},a}(),Pf=function(){return function(a,e){Bu([Bh,ur,function(){return[Aa,ee,kh]}],this,F.call(this,a,e),function(t){var n=new kh(t.data);onmessage=Aa(n)},10)}}();function Cs(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Du(a,e,[Bh,ur,function(){return[Rf]}],function(n){return Xc(Rf(n.data[0],n.data[1]))},4,t)}function Rf(a,e){e||(e={});var t=En();t.p(a);var n=Lr(a,e,2,4);return A(n,e),nr(n,n.length-4,t.d()),n}var Ul=function(){function a(e){this.v=1,zt.call(this,e)}return a.prototype.push=function(e,t){if(zt.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}zt.prototype.c.call(this,t)},a}(),Uh=function(){return function(a){this.ondata=a,Bu([Ol,Wm,function(){return[Aa,zt,Ul]}],this,0,function(){var e=new Ul;onmessage=Aa(e)},11)}}();function ja(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Du(a,e,[Ol,Wm,function(){return[Ym]}],function(n){return Xc(Ym(n.data[0],qm(n.data[1])))},5,t)}function Ym(a,e){return Rl((C(a),a.subarray(2,-4)),e)}var j0=function(){function a(e){this.G=mc,this.I=zt,this.Z=Ul,this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new Li(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,s=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(s):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,t),this.p=null}}},a}(),gc=function(){function a(e){this.G=tp,this.I=yn,this.Z=Uh,this.ondata=e}return a.prototype.push=function(e,t){j0.prototype.push.call(this,e,t)},a}();function Nv(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?Oh(a,e,t):(15&a[0])!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?ri(a,e,t):ja(a,e,t)}function xa(a,e){return a[0]==31&&a[1]==139&&a[2]==8?Yc(a,e):(15&a[0])!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?sr(a,e):Ym(a,e)}var Nh=function(a,e,t,n){for(var i in a){var s=a[i],o=e+i;s instanceof Li?t[o]=[s,n]:Array.isArray(s)?t[o]=[s[0],Lo(n,s[1])]:Nh(s,o+"/",t,n)}},V0=typeof TextEncoder<"u"&&new TextEncoder,np=typeof TextDecoder<"u"&&new TextDecoder,G0=0;try{np.decode(Bl,{stream:!0}),G0=1}catch{}var Fv=function(a){for(var e="",t=0;;){var n=a[t++],i=(n>127)+(n>223)+(n>239);if(t+i>a.length)return[e,Ns(a,t-1)];i?i==3?(n=((15&n)<<18|(63&a[t++])<<12|(63&a[t++])<<6|63&a[t++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&i?String.fromCharCode((31&n)<<6|63&a[t++]):String.fromCharCode((15&n)<<12|(63&a[t++])<<6|63&a[t++]):e+=String.fromCharCode(n)}},N1=function(){function a(e){this.ondata=e,G0?this.t=new TextDecoder:this.p=Bl}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new Li(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=Fv(n),s=i[0],o=i[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(s,t)}},a}(),F1=function(){function a(e){this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(wa(e),this.d=t||!1)},a}();function wa(a,e){if(e){for(var t=new Li(a.length),n=0;n<a.length;++n)t[n]=a.charCodeAt(n);return t}if(V0)return V0.encode(a);var i=a.length,s=new Li(a.length+(a.length>>1)),o=0,l=function(f){s[o++]=f};for(n=0;n<i;++n){if(o+5>s.length){var h=new Li(o+8+(i-n<<1));h.set(s),s=h}var d=a.charCodeAt(n);d<128||e?l(d):d<2048?(l(192|d>>6),l(128|63&d)):d>55295&&d<57344?(l(240|(d=65536+(1047552&d)|1023&a.charCodeAt(++n))>>18),l(128|d>>12&63),l(128|d>>6&63),l(128|63&d)):(l(224|d>>12),l(128|d>>6&63),l(128|63&d))}return Ns(s,0,o)}function Kc(a,e){if(e){for(var t="",n=0;n<a.length;n+=16384)t+=String.fromCharCode.apply(null,a.subarray(n,n+16384));return t}if(np)return np.decode(a);var i=Fv(a),s=i[0];if(i[1].length)throw"invalid utf-8 data";return s}var Km=function(a){return a==1?3:a<6?2:a==9?1:0},Jm=function(a,e){return e+30+Fs(a,e+26)+Fs(a,e+28)},H0=function(a,e,t){var n=Fs(a,e+28),i=Kc(a.subarray(e+46,e+46+n),!(2048&Fs(a,e+8))),s=e+46+n,o=$r(a,e+20),l=t&&o==4294967295?ob(a,s):[o,$r(a,e+24),$r(a,e+42)],h=l[0],d=l[1],f=l[2];return[Fs(a,e+10),h,d,i,s+Fs(a,e+30)+Fs(a,e+32),f]},ob=function(a,e){for(;Fs(a,e)!=1;e+=4+Fs(a,e+2));return[Tn(a,e+12),Tn(a,e+4),Tn(a,e+20)]},al=function(a){var e=0;if(a)for(var t in a){var n=a[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},bi=function(a,e,t,n,i,s,o,l){var h=n.length,d=t.extra,f=l&&l.length,v=al(d);nr(a,e,o!=null?33639248:67324752),e+=4,o!=null&&(a[e++]=20,a[e++]=t.os),a[e]=20,e+=2,a[e++]=t.flag<<1|(s==null&&8),a[e++]=i&&8,a[e++]=255&t.compression,a[e++]=t.compression>>8;var y=new Date(t.mtime==null?Date.now():t.mtime),w=y.getFullYear()-1980;if(w<0||w>119)throw"date not in range 1980-2099";if(nr(a,e,w<<25|y.getMonth()+1<<21|y.getDate()<<16|y.getHours()<<11|y.getMinutes()<<5|y.getSeconds()>>>1),e+=4,s!=null&&(nr(a,e,t.crc),nr(a,e+4,s),nr(a,e+8,t.size)),nr(a,e+12,h),nr(a,e+14,v),e+=16,o!=null&&(nr(a,e,f),nr(a,e+6,t.attrs),nr(a,e+10,o),e+=14),a.set(n,e),e+=h,v)for(var E in d){var M=d[E],P=M.length;nr(a,e,+E),nr(a,e+2,P),a.set(M,e+4),e+=4+P}return f&&(a.set(l,e),e+=f),e},An=function(a,e,t,n,i){nr(a,e,101010256),nr(a,e+8,t),nr(a,e+10,t),nr(a,e+12,n),nr(a,e+16,i)},ta=function(){function a(e){this.filename=e,this.c=qc(),this.size=0,this.compression=0}return a.prototype.process=function(e,t){this.ondata(null,e,t)},a.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},a}(),zv=function(){function a(e,t){var n=this;t||(t={}),ta.call(this,e),this.d=new ee(t,function(i,s){n.ondata(null,i,s)}),this.compression=8,this.flag=Km(t.level)}return a.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},a.prototype.push=function(e,t){ta.prototype.push.call(this,e,t)},a}(),z1=function(){function a(e,t){var n=this;t||(t={}),ta.call(this,e),this.d=new De(t,function(i,s,o){n.ondata(i,s,o)}),this.compression=8,this.flag=Km(t.level),this.terminate=this.d.terminate}return a.prototype.process=function(e,t){this.d.push(e,t)},a.prototype.push=function(e,t){ta.prototype.push.call(this,e,t)},a}(),j1=function(){function a(e){this.ondata=e,this.u=[],this.d=1}return a.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=wa(e.filename),i=n.length,s=e.comment,o=s&&wa(s),l=i!=e.filename.length||o&&s.length!=o.length,h=i+al(e.extra)+30;if(i>65535)throw"filename too long";var d=new Li(h);bi(d,0,e,n,l);var f=[d],v=function(){for(var P=0,L=f;P<L.length;P++){var R=L[P];t.ondata(null,R,!1)}f=[]},y=this.d;this.d=0;var w=this.u.length,E=Lo(e,{f:n,u:l,o,t:function(){e.terminate&&e.terminate()},r:function(){if(v(),y){var P=t.u[w+1];P?P.r():t.d=1}y=1}}),M=0;e.ondata=function(P,L,R){if(P)t.ondata(P,L,R),t.terminate();else if(M+=L.length,f.push(L),R){var I=new Li(16);nr(I,0,134695760),nr(I,4,e.crc),nr(I,8,M),nr(I,12,e.size),f.push(I),E.c=M,E.b=h+M+16,E.crc=e.crc,E.size=e.size,y&&E.r(),y=1}else y&&v()},this.u.push(E)},a.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},a.prototype.e=function(){for(var e=0,t=0,n=0,i=0,s=this.u;i<s.length;i++)n+=46+(d=s[i]).f.length+al(d.extra)+(d.o?d.o.length:0);for(var o=new Li(n+22),l=0,h=this.u;l<h.length;l++){var d=h[l];bi(o,e,d,d.f,d.u,d.c,t,d.o),e+=46+d.f.length+al(d.extra)+(d.o?d.o.length:0),t+=d.b}An(o,e,this.u.length,n,t),this.ondata(null,o,!0),this.d=2},a.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},a}();function V1(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Nh(a,"",n,e);var i=Object.keys(n),s=i.length,o=0,l=0,h=s,d=new Array(s),f=[],v=function(){for(var M=0;M<f.length;++M)f[M]()},y=function(){var M=new Li(l+22),P=o,L=l-o;l=0;for(var R=0;R<h;++R){var I=d[R];try{var N=I.c.length;bi(M,l,I,I.f,I.u,N);var j=30+I.f.length+al(I.extra),H=l+j;M.set(I.c,H),bi(M,o,I,I.f,I.u,N,l,I.m),o+=16+j+(I.m?I.m.length:0),l=H+N}catch(X){return t(X,null)}}An(M,o,d.length,L,P),t(null,M)};s||y();for(var w=function(M){var P=i[M],L=n[P],R=L[0],I=L[1],N=qc(),j=R.length;N.p(R);var H=wa(P),X=H.length,ne=I.comment,pe=ne&&wa(ne),Ae=pe&&pe.length,ve=al(I.extra),Ee=I.level==0?0:8,xe=function(we,Re){if(we)v(),t(we,null);else{var Be=Re.length;d[M]=Lo(I,{size:j,crc:N.d(),c:Re,f:H,m:pe,u:X!=P.length||pe&&ne.length!=Ae,compression:Ee}),o+=30+X+ve+Be,l+=76+2*(X+ve)+(Ae||0)+Be,--s||y()}};if(X>65535&&xe("filename too long",null),Ee)if(j<16e4)try{xe(null,gt(R,I))}catch(we){xe(we,null)}else f.push(Ue(R,I,xe));else xe(null,R)},E=0;E<h;++E)w(E);return v}function Q0(a,e){e||(e={});var t={},n=[];Nh(a,"",t,e);var i=0,s=0;for(var o in t){var l=t[o],h=l[0],d=l[1],f=d.level==0?0:8,v=(X=wa(o)).length,y=d.comment,w=y&&wa(y),E=w&&w.length,M=al(d.extra);if(v>65535)throw"filename too long";var P=f?gt(h,d):h,L=P.length,R=qc();R.p(h),n.push(Lo(d,{size:h.length,crc:R.d(),c:P,f:X,m:w,u:v!=o.length||w&&y.length!=E,o:i,compression:f})),i+=30+v+M+L,s+=76+2*(v+M)+(E||0)+L}for(var I=new Li(s+22),N=i,j=s-i,H=0;H<n.length;++H){var X=n[H];bi(I,X.o,X,X.f,X.u,X.c.length);var ne=30+X.f.length+al(X.extra);I.set(X.c,X.o+ne),bi(I,i,X,X.f,X.u,X.c.length,X.o,X.m),i+=16+ne+(X.m?X.m.length:0)}return An(I,i,n.length,j,N),I}var lb=function(){function a(){}return a.prototype.push=function(e,t){this.ondata(null,e,t)},a.compression=0,a}(),G1=function(){function a(){var e=this;this.i=new zt(function(t,n){e.ondata(null,t,n)})}return a.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},a.compression=8,a}(),jv=function(){function a(e,t){var n=this;t<32e4?this.i=new zt(function(i,s){n.ondata(null,i,s)}):(this.i=new yn(function(i,s,o){n.ondata(i,s,o)}),this.terminate=this.i.terminate)}return a.prototype.push=function(e,t){this.i.terminate&&(e=Ns(e,0)),this.i.push(e,t)},a.compression=8,a}(),cb=function(){function a(e){this.onfile=e,this.k=[],this.o={0:lb},this.p=Bl}return a.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),s=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(s,!this.c):this.k[0].push(s),(e=e.subarray(i)).length)return this.push(e,t)}else{var o=0,l=0,h=void 0,d=void 0;this.p.length?e.length?((d=new Li(this.p.length+e.length)).set(this.p),d.set(e,this.p.length)):d=this.p:d=e;for(var f=d.length,v=this.c,y=v&&this.d,w=function(){var P,L=$r(d,l);if(L==67324752){o=1,h=l,E.d=null,E.c=0;var R=Fs(d,l+6),I=Fs(d,l+8),N=2048&R,j=8&R,H=Fs(d,l+26),X=Fs(d,l+28);if(f>l+30+H+X){var ne=[];E.k.unshift(ne),o=2;var pe,Ae=$r(d,l+18),ve=$r(d,l+22),Ee=Kc(d.subarray(l+30,l+=30+H),!N);Ae==4294967295?(P=j?[-2]:ob(d,l),Ae=P[0],ve=P[1]):j&&(Ae=-1),l+=X,E.c=Ae;var xe={name:Ee,compression:I,start:function(){if(!xe.ondata)throw"no callback";if(Ae){var we=n.o[I];if(!we)throw"unknown compression type "+I;(pe=Ae<0?new we(Ee):new we(Ee,Ae,ve)).ondata=function(at,st,St){xe.ondata(at,st,St)};for(var Re=0,Be=ne;Re<Be.length;Re++){var Oe=Be[Re];pe.push(Oe,!1)}n.k[0]==ne&&n.c?n.d=pe:pe.push(Bl,!0)}else xe.ondata(null,Bl,!0)},terminate:function(){pe&&pe.terminate&&pe.terminate()}};Ae>=0&&(xe.size=Ae,xe.originalSize=ve),E.onfile(xe)}return"break"}if(v){if(L==134695760)return h=l+=12+(v==-2&&8),o=3,E.c=0,"break";if(L==33639248)return h=l-=4,o=3,E.c=0,"break"}},E=this;l<f-4&&w()!=="break";++l);if(this.p=Bl,v<0){var M=o?d.subarray(0,h-12-(v==-2&&8)-($r(d,h-16)==134695760&&4)):d.subarray(0,l);y?y.push(M,!!o):this.k[+(o==2)].push(M)}if(2&o)return this.push(d.subarray(l),t);this.p=d.subarray(l)}if(t){if(this.c)throw"invalid zip file";this.p=null}},a.prototype.register=function(e){this.o[e.compression]=e},a}();function Zm(a,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var y=0;y<t.length;++y)t[y]()},i={},s=a.length-22;$r(a,s)!=101010256;--s)if(!s||a.length-s>65558)return void e("invalid zip file",null);var o=Fs(a,s+8);o||e(null,{});var l=o,h=$r(a,s+16),d=h==4294967295;if(d){if(s=$r(a,s-12),$r(a,s)!=101075792)return void e("invalid zip file",null);l=o=$r(a,s+32),h=$r(a,s+48)}for(var f=function(y){var w=H0(a,h,d),E=w[0],M=w[1],P=w[2],L=w[3],R=w[4],I=w[5],N=Jm(a,I);h=R;var j=function(X,ne){X?(n(),e(X,null)):(i[L]=ne,--o||e(null,i))};if(E)if(E==8){var H=a.subarray(N,N+M);if(M<32e4)try{j(null,sr(H,new Li(P)))}catch(X){j(X,null)}else t.push(ri(H,{size:P},j))}else j("unknown compression type "+E,null);else j(null,Ns(a,N,N+M))},v=0;v<l;++v)f();return n}function ip(a){for(var e={},t=a.length-22;$r(a,t)!=101010256;--t)if(!t||a.length-t>65558)throw"invalid zip file";var n=Fs(a,t+8);if(!n)return{};var i=$r(a,t+16),s=i==4294967295;if(s){if(t=$r(a,t-12),$r(a,t)!=101075792)throw"invalid zip file";n=$r(a,t+32),i=$r(a,t+48)}for(var o=0;o<n;++o){var l=H0(a,i,s),h=l[0],d=l[1],f=l[2],v=l[3],y=l[4],w=l[5],E=Jm(a,w);if(i=y,h){if(h!=8)throw"unknown compression type "+h;e[v]=sr(a.subarray(E,E+d),new Li(f))}else e[v]=Ns(a,E,E+d)}return e}class Vv extends u.hH6{load(e,t,n,i){return this.setResponseType("arraybuffer"),super.load(e,s=>{const o=ip(new Uint8Array(s)),l=new Map(Object.entries(o).map(([h,d])=>[h,new File([d],h)]));t==null||t(l)},n,i)}}class Gv extends g.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,t=!1){super(),this._processors=new tl,this._logger=console.log,this.Importers=[new yr(Ar,["json"],!1),new yr(u.hH6,["txt"],!1),new yr(Cl,["rgbe.png","hdr.png","hdrpng"],!1),new yr(u.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new yr(Ih,["cube"],!1),new yr(Vv,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new u.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(uc(e)),this.Importers.push(xu(e)),this.Importers.push(Su())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,n){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:n})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,n){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:n})}_urlModifier(e){var t;let n=decodeURI(e);const i=(t=this._rootContext)==null?void 0:t.rootUrl;n.includes("://")||!i||n.startsWith(i)||(n=i+n),n=n.replace("./",""),n=n.replace(/^(\/\/)/,"/"),n=n.replace(/\?.*$/,"");const s=this._fileDatabase.get(n);return s?s.ext?(s.objectUrl||(s.objectUrl=URL.createObjectURL(s)+"#"+n),s.objectUrl):(console.error("Unable to determine file extension",s),e):e}_createLoader(e){const t=this._getImporter(e),n=t==null?void 0:t.ctor(this);return n&&(t==null||t.ext.forEach(i=>{const s=new RegExp(i.startsWith("data:")?"^"+i+"\\/":"\\."+i+"$","i");this._loadingManager.addHandler(s,n)})),n&&(this._loaderCache.push({loader:n,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:n})),n}addEventListener(e,t){if(super.addEventListener(e,t),e==="loaderCreate")for(const n of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:n.loader})}async importFiles(e,t={}){const n=new Map;let{allowedExtensions:i}=t;if(i&&i.length<1&&(i=void 0),e.size===0)return n;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const s=[],o=[];if(e.forEach((l,h)=>{this.registerFile(h,l);const d=l.ext;d&&((i==null?void 0:i.includes(d.toLowerCase()))??1)&&(this._isRootFileExtension(d)?s.push(h):o.push(h))}),s.length>0)for(const l of s){let h=await this._importFile(l,void 0,t);h&&(h=await this.processImported(h,t)),n.set(l,h)}else for(const l of o){let h=await this._importFile(l,void 0,t);h&&(h=await this.processImported(h,t)),n.set(l,h)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((l,h)=>{this.unregisterFile(h)}),n}registerFile(e,t){var n;e=e.replace(/\?.*$/,"");const i=(t==null?void 0:t.ext)??((n=(0,g.parseFileExtension)((t==null?void 0:t.name)??e))==null?void 0:n.toLowerCase());t&&(t.ext||(t.ext=i),this._fileDatabase.set(e,t));let s=this._getLoader(e);if(s||(s=this._createLoader(t??{name:e,ext:i})),s){for(const o of this._loaderCache)if(o.loader===s){o.files.push(e);break}}return s}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t!=null&&t.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return this.Importers.find(t=>t.root&&t.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,n={},i){var s;if(t!=null&&t.__imported)return t.__imported;let o;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t);const l=this.resolveURL(e),h=e.replace(/\?.*$/,""),d=n.fileHandler??(await this._loadingManager.getHandler(h)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0));if(!d)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:l,rootUrl:u.Zp0.extractUrlBase(e),baseUrl:u.Zp0.extractUrlBase(l)},o=await d.loadAsync(e+(n.queryString?(e.includes("?")?"&":"?")+n.queryString:""),f=>{i&&i(f),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:f.loaded||void 0,totalBytes:f.total||void 0,progress:f.total>0?f.loaded/f.total:1})}),d.transform&&(o=await d.transform(o,n)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(l){return console.error("AssetImporter: Unable to import file",e,t),console.error(l),console.error(l==null?void 0:l.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:l}),t&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),t){t.__imported=o;let l=[];Array.isArray(o)?l=o:(s=o.userData)!=null&&s.rootSceneModelRoot?l.push(...o.children):l.push(o),l.forEach(h=>{var d;(d=h.addEventListener)==null||d.call(h,"dispose",()=>{t.__imported=void 0})})}if(o&&typeof o=="object"){o.__rootPath=e;const l=t||this._fileDatabase.get(e);l&&(o.__rootBlob=l)}return o}_getImporter(e,t=!1){return this.Importers.find(n=>{if(t&&!n.root)return!1;const i=n.ext.find(s=>{var o,l,h;return e.ext&&s===e.ext.toLowerCase()||((l=(o=e.name)==null?void 0:o.toLowerCase())==null?void 0:l.endsWith("."+s.toLowerCase()))||(s==null?void 0:s.startsWith("data:"))&&((h=e.name)==null?void 0:h.startsWith(s))});return!!i&&(e.ext=i,!0)})}_getLoader(e){return this._loadingManager.getHandler(e)??void 0}async importAsset(e,t={},n){var i,s,o;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const d=this._cachedAssets.find(f=>f.path===e.path);d&&Object.assign(e,d)}const h=this._cachedAssets.findIndex(d=>d.path===e.path);h>=0&&this._cachedAssets.splice(h,1),this._cachedAssets.push(e)}let l;if(e!=null&&e.preImported&&(l=await e.preImported),!t.forceImport&&l){const h=await this.processImported(l,t);let d=!1;for(const f of h){if((i=f.userData)!=null&&i.rootSceneModelRoot&&[...f.children,...f.__processedChildren||[]].find(v=>v.__disposed)){d=!0;break}if(f.__disposed){d=!0;break}}if(!d||t.reimportDisposed===!1)return h}if(e.preImported=this._importFile(t.pathOverride||e.path,typeof((s=e.file)==null?void 0:s.arrayBuffer)=="function"?e.file:void 0,t,n),l=await e.preImported,l&&(l=await this.processImported(l,t)),l){const h=[];Array.isArray(l)?h.push(...l):(o=l.userData)!=null&&o.rootSceneModelRoot?h.push(...l.children):h.push(l),h.forEach(d=>{var f;return(f=d.addEventListener)==null?void 0:f.call(d,"dispose",()=>{e!=null&&e.preImported&&(e.preImported=void 0)})})}return l}async importSingle(e,t={}){var n;return typeof e=="string"?await this.importSinglePath(e,t):(n=await this.importAsset(e,t))==null?void 0:n[0]}async importSinglePath(e,t){var n;return(n=await this.importPath(e,t))==null?void 0:n[0]}async importPath(e,t={}){const n={...t};delete n.pathOverride,delete n.forceImport,delete n.reimportDisposed,delete n.fileHandler,delete n.importedFile;const i=JSON.stringify(n);let s;return s=this._cachedAssets.find(o=>o.path===e&&o._options===i)||{path:e},s._options=i,t.importedFile&&(s.file=t.importedFile),await this.importAsset(s,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var n,i,s,o,l,h,d,f;let v=e;if(!v)return[];if(t.processImported===!1)return[v];if(Array.isArray(v)){const E=[];for(const M of v)E.push(...await this.processImported(M,t));return E}if((n=v.userData)!=null&&n.rootSceneModelRoot){if(t._rootSceneImported=!0,v.__processedChildren&&!t.forceImporterReprocess)return v.__processedChildren;if(!(v.children.length<1))return v.animations&&(v.children[0].animations||(v.children[0].animations=[]),v.children[0].animations.push(...v.animations)),v.__importedViewerConfig&&(v.children[0].__importedViewerConfig=v.__importedViewerConfig),v.userData.__importData&&(v.children[0].userData.__importData=v.userData.__importData),v.__processedChildren=await this.processImported([...v.children],t),v.__processedChildren;if(((i=v.animations)==null?void 0:i.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",v.animations),!v.__importedViewerConfig)return[];v=v.__importedViewerConfig}if((s=v.userData)!=null&&s.iModel&&(v=v.userData.iModel),(o=v.userData)!=null&&o.iMaterial&&(v=v.userData.iMaterial),v.assetImporterProcessed&&!t.forceImporterReprocess)return[v];const y=v.__rootPath,w=v.__rootBlob;if(!v.assetType){if(v.isBufferGeometry&&(v=new u.Kj0(v,new u.Wid)),v.isObject3D)if(v.isLight)v=rp(v);else{const E=[];v.traverse(M=>{M!==v&&M.isLight&&E.push(M)});for(const M of E)rp(M);v=new xh(v,t)}v.isTexture&&(v.assetType="texture",t._testDataTextureComplete&&(v.isDataTexture&&((l=v.image)!=null&&l.data)&&(v.image.complete=!0),(h=v.image)!=null&&h.complete&&(v.needsUpdate=!0)),t.generateMipmaps!==void 0&&(v.generateMipmaps=t.generateMipmaps),v.generateMipmaps||v.isRenderTargetTexture||(v.minFilter=v.minFilter===u.D1R?u.wem:v.minFilter,v.magFilter=v.magFilter===u.D1R?u.wem:v.magFilter)),v.isMaterial&&(v.assetType="material")}if(v.assetType!=null)return v.userData&&(v.userData.rootPath||!y||y.startsWith("blob:")||y.startsWith("/")||(v.userData.rootPath=y),w&&(v.userData.__sourceBlob=w,v.userData.__needsSourceBuffer&&(v.userData.__sourceBuffer=await w.arrayBuffer(),delete v.userData.__needsSourceBuffer))),v=await this._processors.process(v.assetType,v,{}),v.assetImporterProcessed=!0,[v];if(v instanceof Map)return[...(await this.importFiles(v,t)).values()].flat();if(v.type&&v.type!=="ViewerApp"&&v.type!=="ThreeViewer"){const E=this._viewer.getPluginByType(v.type);if(E){let M=v._importedResources||{};return v.resources&&(M=await((d=this._viewer.getManager())==null?void 0:d.importConfigResources(v.resources)),delete v.resources,v._importedResources=M),typeof E.fromJSON=="function"&&(await Promise.resolve(E.fromJSON(v,M)),v.assetImporterProcessed=!1),[]}}return v.plugins||v.type==="ViewerApp"||v.type==="ThreeViewer"?(v.resources=await((f=this._viewer.getManager())==null?void 0:f.importConfigResources(v.resources)),await this._viewer.getManager().importViewerConfig(v),v.assetImporterProcessed=!1,[]):(console.warn("unknown/null asset type: ",v,v.plugins),[v])}dispose(){var e;this.clearCache(),(e=this._processors)==null||e.dispose()}clearLoaderCache(){this._loaderCache.forEach(e=>{e.loader.dispose&&e.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function Lu(a){if(!a)return u.ywz;const e=a.extensions.has("EXT_color_buffer_half_float")||a.capabilities.isWebGL2&&a.extensions.has("EXT_color_buffer_float"),t=a.capabilities.isWebGL2||a.extensions.has("OES_texture_float")||a.extensions.has("WEBGL_color_buffer_float");return e?u.cLu:t?u.VzW:u.ywz}function rp(a){var e,t;if(!a.isLight||a.assetType==="light")return a;if(a.uiConfig)return console.warn("ui config already exists, not supported",a),a;let n;if(a.children.length,a.isDirectionalLight&&(n=new il),a.isAmbientLight&&(n=new Jd),a.isSpotLight&&(n=new Kd),a.isPointLight&&(n=new Th),n){(t=(e=n.lightObject).copy)==null||t.call(e,a);const i=a.parent;i!=null&&i.isObject3D&&(i.remove(a),a.dispose(),a.userData.iModel=n,i.add(n.lightObject),n.uuid=a.uuid),wo(n.lightObject,i)}else console.warn("unknown light type: ",a);return n}class W0 extends u.u7G{constructor(e){super(e)}async loadAsync(e,t){var n;const i=new u.hH6(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const s=await i.loadAsync(e,t);try{const o=JSON.parse(s);if(o.images&&this.importer){const l={};let h=o.images;Array.isArray(h)||(h=Object.values(h));for(const d of o.images){if(!d.url||!d.uuid)continue;const f=(n=await this.importer.importPath(d.url,{processImported:!1}))==null?void 0:n[0],v=f==null?void 0:f.source;if(!f||!v)continue;const y=new u.Hw6(v.data);y.uuid=d.uuid,l[y.uuid]=y,f.dispose()}return await Js.LoadRootPathTextures(o.textures,l||o.images,this.importer),this.parse(o,l)}return this.parse(o)}catch(o){throw console.error(o),this.manager.itemError(e),o}}parse(e,t){var n;let i;const s={p:new Promise(d=>{i=d})};if(e.images||e.textures){const d=new Js(this.manager);let f={};const v=M=>{i(),s.p=void 0,Object.values(f).forEach(P=>{var L;P.isTexture&&((L=P.image)!=null&&L.complete)&&(P.needsUpdate=!0)})};let y=e.images||[];Array.isArray(y)||(y=Object.values(y));const w=t||d.parseImages(y,v);let E=e.textures;Array.isArray(E)||(E=Object.values(E)),f=d.parseTextures2(E,w,v),this.setTextures(f)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const o={...e};if(Object.entries(o).forEach(([d,f])=>{f&&typeof f=="string"&&this.textures[f]&&(o[d]=this.textures[f])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?o.vertexColors=e.vertexColors>0:o.vertexColors=e.vertexColors),e.normalScale!==void 0){const d=e.normalScale;Array.isArray(d)===!1&&(o.normalScale=[d,d])}let l=e.type;l!=="MeshPhysicalMaterial"&&l!=="MeshStandardMaterial"&&l!=="PhysicalMaterial"||(l=Os.TYPE),o.userData=Yi(o.userData,void 0,!1,this);const h=((n=this.materials)==null?void 0:n.generateFromTemplateType(l,o))??super.parse(e);return this.setTextures({}),h.userData.imageLoadAwaiter=s,h}}class Yt extends g.SimpleEventDispatcher{constructor(e,t,{simpleCache:n=!1,storage:i}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(n||i)&&(n&&(u.CtF.enabled=!0),i&&window.Cache&&typeof window.Cache=="function"&&i instanceof window.Cache)){const s={...u.CtF};u.CtF.get=(o,l,h)=>l?o.startsWith("data:")||o.startsWith("blob")||o.startsWith("chrome-extension")?Promise.resolve(void 0):i.match(o).then(d=>{if(d)switch(l){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(f=>new DOMParser().parseFromString(f,h??"text/html"));case"json":return d.json();default:if(h===void 0)return d.text();{const f=/charset="?([^;"\s]*)"?/i.exec(h),v=f&&f[1]?f[1].toLowerCase():void 0,y=new TextDecoder(v);return d.arrayBuffer().then(w=>y.decode(w))}}}):s.get(o),u.CtF.add=async(o,l,h)=>{if(!h)return s.add(o,l);o.startsWith("data:")||o.startsWith("blob")||o.startsWith("chrome-extension")||(await i.match(o)&&await i.delete(o),await i.put(o,new Response(l,{status:200})))},u.CtF.remove=(o,l)=>{if(!l)return s.remove(o);i.delete(o)}}this.storage=i,this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importAsset(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importPath(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}addProcessedAssets(e,t){return e.map(n=>{var i;return(i=this._viewer)==null?void 0:i.scene.addSceneObject(n,t)})}async addAssetSingle(e,t={}){var n;return e?(n=await(typeof e=="string"?this.addFromPath:this.addAsset).call(this,e,t))==null?void 0:n[0]:void 0}async addImported(e,t={}){var n;return(n=this._importer)==null?void 0:n.processImported(e,t).then(i=>(this.addProcessedAssets(i,t),i))}async addImportedSingle(e,t={}){return this.addImported(e,t).then(n=>n==null?void 0:n[0])}_sceneUpdated(e){var t;if(e.type==="addSceneObject"){const n=e.object;n.assetType==="material"&&((t=this._materials)==null||t.processMaterial(n,{}))}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new _u,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new Gv(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(n,i)=>(Hd(n,s=>{var o;return(o=this._materials)==null?void 0:o.processModel(s,{recursive:!1})}),n)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(n,i)=>{var s;return(s=this.materials)!=null&&s.findMaterial(n.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),n.uuid=Pe(),n.userData.uuid&&(n.userData.uuid=n.uuid)),this._materials.processMaterial(n,i)}})),this._importer.Importers.push(new yr(W0,[Os.TypeSlug],!1,n=>(n&&(n.materials=this._materials),n&&(n.importer=this._importer),n)));const t=this.importViewerConfig.bind(this);this._importer.Importers.push(new yr(class extends Ar{async loadAsync(n,i){return t(await super.loadAsync(n,i))}},[Yt.ViewerTypeSlug],!0))}onRemove(e){var t,n;e===this._viewer&&((t=this._importer)==null||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(n=this._materials)==null||n.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return(t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetExporterPlugin"))==null?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,t){if(!this._viewer)return{};const n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...t},i=this._viewer.toJSON(n);return e||Object.values(n).forEach(s=>{s&&Object.values(s).forEach(o=>{o.url&&(o.url.data instanceof ArrayBuffer||Array.isArray(o.url.data))&&(o.url.type==="Uint16Array"?(o.url.data instanceof Uint16Array||(o.url.data=new Uint16Array(o.url.data)),o.url.data="data:application/octet-stream;base64,"+(0,g.arrayBufferToBase64)(o.url.data.buffer)):o.url.type==="Uint8Array"?(o.url.data instanceof Uint8Array||(o.url.data=new Uint8Array(o.url.data)),o.url.data="data:application/octet-stream;base64,"+(0,g.arrayBufferToBase64)(o.url.data.buffer)):o.url.data instanceof ArrayBuffer?o.url.data="data:application/octet-stream;base64,"+(0,g.arrayBufferToBase64)(o.url.data.buffer):console.warn("Unsupported buffer type",o.url.type))})}),i.resources=n,i}exportPluginPresets(e){var t;const n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(t=this._viewer)==null?void 0:t.serializePlugins(n,e),resources:n}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},n=e.toJSON(t);return n.resources=t,n}async importPluginPreset(e,t){var n;const i=e.type;if(!(t=t||((n=this._viewer)==null?void 0:n.getPluginByType(i))))return void console.warn(`No plugin found for type ${i} to import preset`);if(!t.fromJSON)return void console.warn(`Plugin ${i} does not support importing presets`);const s=e.resources||{};e.resources&&delete e.resources;const o=await this.importConfigResources(s);return await t.fromJSON(e,o),o&&(e.resources=o),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const n=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,n)}applyViewerConfig(e,t){var n;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const i of Object.values(t.materials))i.__useCount?delete i.__useCount:(n=this._materials)==null||n.unregisterMaterial(i);for(const i of Object.values(t.textures))i.__useCount&&delete i.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,t,n){var i,s,o;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const l={};Object.values(e).forEach(d=>{d&&Object.values(d).forEach(f=>{if(!f||!f.url||typeof f.url.data!="string")return;const v=f.url.data.match(/^data:.*;base64,(.*)$/);v!=null&&v[1]?f.url.data=(0,g.base64ToArrayBuffer)(v==null?void 0:v[1]):(f.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",f.url.type,"use base64"),f.url.data=new TextEncoder().encode(f.url.data).buffer)})}),t=t??new Js(this._importer.loadingManager),l.animations=e.animations?t.parseAnimations(e.animations):{},n&&n.animations&&(l.animations={...l.animations,...n.animations}),l.shapes=e.shapes?t.parseShapes(e.shapes):{},n&&n.shapes&&(l.shapes={...l.shapes,...n.shapes}),l.geometries=e.geometries?t.parseGeometries(e.geometries,l.shapes):{},n&&n.geometries&&(l.geometries={...l.geometries,...n.geometries}),l.images=e.images?await t.parseImagesAsync(Object.values(e.images)):{},n&&n.images&&(l.images={...l.images,...n.images}),await Js.LoadRootPathTextures(e.textures,l.images,this._importer),l.textures=e.textures?t.parseTextures2(Object.values(e.textures),l.images,()=>{Object.values(l.textures).forEach(d=>{var f;d.isTexture&&((f=d.image)!=null&&f.complete)&&(d.needsUpdate=!0)})}):{};for(const d of Object.entries(l.textures))d[1]=(i=await this._importer.processImported(d[1],{}))==null?void 0:i[0],d[1]?l.textures[d[0]]=d[1]:delete l.textures[d[0]];n&&n.textures&&(l.textures={...l.textures,...n.textures});const h=e.materials?Object.values(e.materials):[];for(const d of h)Object.entries(d).forEach(([f,v])=>{v&&v.resource&&v.uuid&&v.resource==="textures"&&(d[f]=v.uuid)});if(l.materials=t.parseMaterials2(h,l.textures,this._materials),n&&n.materials&&(l.materials={...l.materials,...n.materials}),e.object&&(l.object=t.parseObject(e.object,l.geometries,l.materials,l.textures,l.animations),e.skeletons&&(l.skeletons=t.parseSkeletons(e.skeletons,l.object),t.bindSkeletons(l.object,l.skeletons))),e.extras){l.extras=e.extras;for(const d of Object.values(e.extras))if(d.uuid&&d.url)if(typeof d.url=="string"){const f=await((s=this._importer)==null?void 0:s.importPath(d.url));(f==null?void 0:f.length)>0&&(l.extras[d.uuid]=f[0])}else if(d.url.data){const f=new File([(0,g.getTypedArray)(d.url.type,d.url.data)],d.url.path),v=await((o=this._importer)==null?void 0:o.importAsset({path:f.name,file:f}));(v==null?void 0:v.length)>0&&(l.extras[d.uuid]=v[0])}else console.warn("invalid URL type while loading extra resource")}return n&&n.extras&&(l.extras={...l.extras,...n.extras}),l.__isLoadedResources=!0,l}}Yt.PluginType="AssetManager",Yt.ViewerTypeSlug="vjson";class q0{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,t,n){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),t==null||t.addEventListener("change",this._onSelect),n&&Object.entries(n).forEach(([i,s])=>s&&this.on(i,s))}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(n=>n(t)),this}destroy(){const e=this._el,t=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),t==null||t.removeEventListener("change",this._onSelect)}_onDrop(e){var t,n;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const i=Array.from(((t=e.dataTransfer)==null?void 0:t.files)||[]),s=Array.from(((n=e.dataTransfer)==null?void 0:n.items)||[]);if(i.length!==0||s.length!==0)if(s.length>0){const o=s.map(l=>l.webkitGetAsEntry());this._loadNextEntry(new Map,o)}else this._emit("drop",{files:new Map(i.map(o=>(o.filePath=o.name,[o.filePath,o])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const t=[].slice.call(this._inputEl.files??new FileList),n=new Map;t.forEach(i=>{i.filePath=i.webkitRelativePath||i.name,n.set(i.filePath,i)}),this._emit("drop",{files:n})}_loadNextEntry(e,t){const n=t.pop();if(n)if(n.isFile)n.file(i=>{i.filePath=n.fullPath,e.set(n.fullPath,i),this._loadNextEntry(e,t)},()=>console.error("Could not load file: %s",n.fullPath));else if(n.isDirectory){const i=n.createReader(),s=o=>{o.length?(t=t.concat(o),i.readEntries(s)):this._loadNextEntry(e,t)};i.readEntries(s)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Jc extends g.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new u.Pa4(.5,.5,3)},this.dependencies=[Yt],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new q0(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var t,n,i;if(!e)return;const s=this._viewer;if(!s)return;if(this._allowedExtensions!==void 0)for(const h of e.keys())this._allowedExtensions.includes(((t=h.split(".").pop())==null?void 0:t.toLowerCase())??"")||e.delete(h);if(e.size<1)return;const o=s.getPlugin(Yt),l={type:"drop",files:e};if(this.importerParams.autoImport){const h={allowedExtensions:this.allowedExtensions,...this.importerParams};if(l.imported=await((n=o.importer)==null?void 0:n.importFiles(e,h)),this.importerParams.autoAdd){const d=[...((i=l.imported)==null?void 0:i.values())??[]].flat(2).filter(f=>!!f)??[];if(l.assets=o.addProcessedAssets(d,{...this.importerParams}),!h._rootSceneImported)for(const f of l.assets)f.modelObject&&f.modelObject.dispatchEvent({type:"select",value:f.modelObject})}}this.dispatchEvent(l)}promptForFile(){var e;(e=this._inputEl)==null||e.click()}onRemove(e){var t;(t=this._dropzone)==null||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(t=>"."+t).join(", "):"")}}Jc.PluginType="Dropzone";var Hv=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};function sp(a){return Object.getPrototypeOf(a).constructor.PluginType}class ol extends g.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:e=!1,useRgbm:t=!0,useGBufferDepth:n=!0,screenShader:i="",...s}){super(),this.console=console,this._state=T.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(v=>this.resize()):void 0,this._lastSize=new u.FM8,this._onContextRestore=v=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=v=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===Qv&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=v=>{var y;if(!v||!v.object)return;const w=v.object.__importedViewerConfig||((y=v.object.modelObject)==null?void 0:y.__importedViewerConfig);if(!w)return;const E=this.getManager();E?E.applyViewerConfig(w,w.resources):this.fromJSON(w,w.resources)},this.alert=async v=>alert(v),this.confirm=async v=>confirm(v),this.prompt=async(v,y,w=!0)=>prompt(v,y),this._useRgbm=t,this._useGBufferDepth=n,this._screenShader=i,this._canvas=s.canvas||(0,g.createCanvasElement)();let o=s.container;if(o&&!s.canvas&&o.appendChild(this._canvas),o||(o=this._canvas.parentElement??void 0),!o)throw new Error("No container.");this._container=o,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var v;const y=window.location.href,w="https://dev-sandbox.pixotronics.com/webgi/";if(!y.startsWith(w)||(0,g.getUrlQueryParam)("noUpdate")!==null)return!0;const E=(v=y.match(/\/webgi\/([0-9.a-zA-Z-]+)/))==null?void 0:v[1],M=(await(await fetch(w+"version.txt")).text()).split(`
`)[0];if(E&&E!==M){if(confirm(`New version ${M} is available, do you want to open?`)){const P=window.location.href.replace(E,M);return window.location.href=P,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const l=new rs(void 0,void 0,this._canvas);l.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var v,y;const w=d.scene.activeCamera;if(w&&w.interactionsEnabled){const E=(v=this.getPluginByType("Progressive"))==null?void 0:v.postFrameConvergedRecordingDelta();if(E!==void 0&&E===0)return;(y=w.controls)==null||y.update()}}),this.scene=new Br(l),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new El({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,colorSpace:t?Ct:u.aCh,type:t?u.ywz:u.cLu,depthBuffer:!n,generateMipmaps:!!e,minFilter:e?u.FDw:u.wem}}),this._isAntialiased=e&&this._renderer.isWebGL2;let h=!0;this._renderer.rendererObject.userData||(h=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!h;const d=this;this.renderFilter={passId:"render",passObject:new jd(this,h),update(){const v=this.passObject;v.scene=d.scene.modelObject,v.camera=d.scene.renderCamera.cameraObject}};const f={passId:"screen",after:["render"],required:["render"],passObject:H1(i)};[this.renderFilter,f].forEach(v=>this._renderer.registerPass(v)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",v=>this.setDirty(this.scene,v)),this.scene.addEventListener("sceneMaterialUpdate",v=>this.setDirty(this.scene,v)),this.scene.addEventListener("sceneUpdate",v=>{this.setDirty(this.scene,v),v.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",v=>this.setDirty(this.scene,v)),this._renderer.addEventListener("update",v=>this.setDirty(this._renderer,v)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#ffffff"),s.assetManager&&this.addPluginSync(new Yt(void 0,void 0,typeof s.assetManager=="boolean"?{}:s.assetManager)),s.dropzone&&this.addPluginSync(new Jc),this.console.log("WebGi Viewer instance initialized, version: ",ol.VERSION)}setDirty(e,t){this._needsReset=!0,e=e??this,this.dispatchEvent({...t??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;for(const t of[...Object.values(this.plugins)])this.removePlugin(t,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)==null||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:t,xrFrame:n}){var i,s;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let o=0;o<this.maxFramePerLoop;o++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const d=[this._canvas.clientWidth,this._canvas.clientHeight];if(n){const f=(s=(i=this._renderer.rendererObject.xr.getCamera())==null?void 0:i.cameras[0])==null?void 0:s.viewport;f?(f.x===0&&f.y===0||this.console.warn("x and y must be 0?"),d[0]=f.width,d[1]=f.height,this.console.log("resize for xr",d)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...d),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:n});const l=Object.values(this.plugins).filter(d=>d.dirty);l.length>0&&this.setDirty(l),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const h=this._renderer.dirty;if(h){this.dispatchEvent({type:"preRender",target:this});try{this.scene.renderCamera=this.scene.activeCamera,this._renderer.render(!0)}catch(d){this.console.error(d),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!h)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return typeof e=="string"?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...t){return this.getPlugin(e)||this.addPlugin(e,...t)}getOrAddPluginSync(e,...t){return this.getPlugin(e)||this.addPluginSync(e,...t)}async addPlugin(e,...t){let n;if(e.prototype){const s=this.getPlugin(e);if(s)return console.error(`Plugin of type ${sp(s)} already exists, no new plugin created`,s),s;n=new e(...t)}else n=e;const i=sp(n);if(!i)return this.console.error("PluginType is not defined for",n),n;for(const s of n.dependencies||[])await this.getOrAddPlugin(s);return this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, old plugin will be removed and disposed`,this.plugins[i],n),await this.removePlugin(this.plugins[i],!0)),this.plugins[i]=n,await n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}addPluginSync(e,...t){let n;if(e.prototype){const s=this.getPlugin(e);if(s)return console.error(`Plugin of type ${sp(s)} already exists, no new plugin created`,s),s;n=new e(...t)}else n=e;const i=sp(n);if(!i)return this.console.error("PluginType is not defined for",n),n;for(const s of n.dependencies||[])this.getOrAddPluginSync(s);return this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, old plugin will be removed and disposed`,this.plugins[i],n),this.removePluginSync(this.plugins[i],!0)),this.plugins[i]=n,n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}async addPlugins(e){for(const t of e)await this.addPlugin(t)}async addPluginsSync(e){for(const t of e)this.addPluginSync(t)}async removePlugin(e,t=!0){const n=sp(e);this.plugins[n]&&(await e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,t=!0){const n=sp(e);this.plugins[n]&&(e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){const t=e.userData.iCamera??new rs(e,{controlsMode:"",aspect:"auto"},this._canvas);return e.userData.autoLookAtTarget===void 0?(t.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):t.autoLookAtTarget=e.userData.autoLookAtTarget,t}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}async doOnce(e,t){return new Promise(n=>{const i=async(...s)=>{this.removeEventListener(e,i),n(await(t==null?void 0:t(...s)))};this.addEventListener(e,i)})}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,e==null||typeof e!="string"&&typeof e!="number"&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===Qv)return this.scene.setBackground("environment");!e||e!=null&&e.isTexture?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let t=this._rawBackground??this.scene.getBackground();return t?(t!=null&&t.isVector4&&(t=Iv(t,7).getHexString()),t!=null&&t.isColor?t.getHexString():this._rawBackground===Qv?this.scene.getEnvironment():t):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(Yt)}resetCamera({rootObject:e,centerOffset:t=new u.Pa4(1,1,1),targetOffset:n=new u.Pa4(0,0,0),...i}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const s=e?new Fe().expandByObject(e,!0,!0):this.scene.getBounds(!0),o=s.getCenter(new u.Pa4),l=.5*s.getSize(new u.Pa4).length();o.add(n.clone().multiplyScalar(l)),this.scene.activeCamera.position=new u.Pa4(o.x+t.x*l,o.y+t.y*l,o.z+t.z*l),this.scene.activeCamera.target=o,this.setDirty()}}async fitToView(e,t=1.5,n,i){var s;const o=this.getPluginByType("CameraViews");o?await(o==null?void 0:o.animateToFitObject(e,t,n,i,{min:(((s=this.scene.activeCamera.getControls())==null?void 0:s.minDistance)??.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e){var t;return(t=this.getManager())==null?void 0:t.addImportedSingle(e||new u.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var n,i,s,o;if(t!=null&&t.isMaterial){const l=(i=(n=this.getManager())==null?void 0:n.materials)==null?void 0:i.findMaterial(t.uuid);if(l)return l}return(o=(s=this.getManager())==null?void 0:s.materials)==null?void 0:o.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map(n=>{var i,s;if(!t||t.includes(n[1].constructor.PluginType))return n[1].serializeWithViewer!==!1?(s=(i=n[1]).toJSON)==null?void 0:s.call(i,e):void 0}).filter(n=>!!n)}deserializePlugins(e,t){return e.forEach(n=>{var i;if(!n.type)return void this.console.warn("Invalid plugin to import ",n);const s=this.getPluginByType(n.type);s&&((i=s.fromJSON)==null||i.call(s,n,t))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){const n=Object.assign({version:ol.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,t)},Fi(this,!0,e));return n.backgroundIntensity=this.scene.backgroundIntensity,n.useLegacyLights=this.renderer.useLegacyLights,n.background=n.scene.background||n.scene.backgroundColor,n.background==="environment"&&(n.background="envMapBackground"),n}fromJSON(e,t){var n,i,s,o,l;const h={...e};return h.backgroundIntensity!==void 0&&((n=h.scene)==null?void 0:n.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=h.backgroundIntensity,delete h.backgroundIntensity),h.useLegacyLights!==void 0&&((i=h.renderManager)==null?void 0:i.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=h.useLegacyLights,delete h.useLegacyLights),h.background!==void 0&&((s=h.scene)==null?void 0:s.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),h.background==="envMapBackground"?h.background="environment":typeof h.background=="number"?h.background=new er().setHex(h.background,u.GUF):typeof h.background=="string"?h.background=new er().setStyle(h.background,u.GUF):(o=h.background)!=null&&o.isColor&&(h.background=new er(h.background)),(l=h.background)!=null&&l.isColor?(this.scene.backgroundColor=h.background,this.scene.background=null):h.background?(this.scene.backgroundColor=new er("#ffffff"),h.scene.background=h.background):(this.scene.backgroundColor=null,this.scene.background=null),delete h.background),Yi(h,this,!0,t),Array.isArray(h.plugins)&&this.deserializePlugins(h.plugins,t),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,t){if(e)return await this.assetManager.addAssetSingle(e,t)}async setEnvironmentMap(e,{setBackground:t=!1,...n}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:t=!1,...n}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}ol.VERSION="0.9.0",Hv([ke("renderManager")],ol.prototype,"_renderer",void 0),Hv([ke()],ol.prototype,"scene",void 0),Hv([(0,g.onChange)(ol.prototype._renderEnabledChanged)],ol.prototype,"renderEnabled",void 0);const Qv="envMapBackground";function H1(a){return a!=null&&a.isShaderPass2?a:new vi({...O,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(a)?a[0]:(a==null?void 0:a.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(a)?a[1]:typeof a=="string"?a:(a==null?void 0:a.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class Q1 extends vi{constructor(e){super({vertexShader:O.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=u.Wl3}render(e,t,n,i,s){super.render(e,t,n,i,s),this._lastReadBuffer=n,this.needsSwap=!0}reRender(e,t,n,i){this._lastReadBuffer&&this.render(e,t,this._lastReadBuffer,n,i)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class vc extends To{get renderToScreen(){return this._renderToScreen}constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[Ri],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var n,i;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(i=(n=this.pass).update)==null||i.call(n),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}async onAdded(e){var t,n;return(n=(t=this._viewer)==null?void 0:t.screenShader)!=null&&n.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&(0,g.safeSetProperty)(e.renderer.passes.find(i=>i.passId==="screen"),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,g.safeSetProperty)(e.renderer.passes.find(t=>t.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){var t,n;const i=e.screenShader,s=["",""];this._renderToScreen&&!i.isShaderPass2&&(s[0]=Array.isArray(i)?i[0]:(i==null?void 0:i.pars)||"",s[1]=Array.isArray(i)?i[1]:typeof i=="string"?i:(i==null?void 0:i.main)||"");const o=new Q1(s);return(0,g.safeSetProperty)((n=(t=o.uiConfig)==null?void 0:t.children)==null?void 0:n.find(l=>(l==null?void 0:l.label)==="Enabled"),"hidden",!0,!0),o}_update(e){var t,n,i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((t=this._viewer)==null?void 0:t.getPlugin(Ri)),this._pass.passObject.material.uniforms.tTransparent.value=((i=(n=this._viewer)==null?void 0:n.renderFilter.passObject.transparentTarget)==null?void 0:i.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t;return((t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig)??{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}vc.PluginType="CombinedPostPlugin";var ub=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Ou extends Sn{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[vc]}get uiConfig(){var e;return(e=this._extension)==null?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),(t=e.getPlugin(vc))==null||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function Wv(a,e,t){return a&~(1<<e)|(t?1:0)<<e}function hb(a,e){return a&~(1<<e)}ub([ke("extension")],Ou.prototype,"_extension",void 0),ub([ke()],Ou.prototype,"enabled",void 0);var Zc,ku=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const X0=u.dZ3;let Nl=Zc=class{constructor(a,e=!0){this.depthTonemap=e,this.toneMapping=u.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(t,n)=>this.enabled?g.glsl`
            ${this.depthTonemap?ga:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${`int getToneMapBit(in int number){
#ifdef WebGL2Context
return(number/2)%2;
#else
return int(mod(floor(float(number)/2.),2.));
#endif
}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=a.getPlugin(vc),this._setDirty=this._setDirty.bind(this),this.depthTonemap=e}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=_n(a.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(a,e,t){if(!this.enabled)return;const{toneMapping:n,toneMappingExposure:i,outputColorSpace:s}=t;this._rendererState.toneMapping=n,this._rendererState.toneMappingExposure=i,this._rendererState.outputColorSpace=s;let o=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==o&&(e.materialObject.defines.TONEMAP_BACKGROUND=o,e.materialObject.needsUpdate=!0),o=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==o&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=o,e.materialObject.needsUpdate=!0),o=this.renderDepth?"1":"0",e.materialObject.defines.DEBUG_DEPTH!==o&&(e.materialObject.defines.DEBUG_DEPTH=o,e.materialObject.needsUpdate=!0),t.toneMapping=this.toneMapping,t.toneMappingExposure=this.exposure,t.outputColorSpace=u.KI_,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(a,e,t){t.toneMapping=this._rendererState.toneMapping,t.toneMappingExposure=this._rendererState.toneMappingExposure,t.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}};Nl.PluginType="Tonemap",ku([Eo("Mode",[["Linear",u.EoG],["Reinhard",u.CdI],["Cineon",u.YGz],["ACESFilmic",u.LY2],["Uncharted2",X0]].map(a=>({label:a[0],value:a[1]})),{limitedUi:!0}),(0,g.onChange)(Zc.prototype._setDirty),ke()],Nl.prototype,"toneMapping",void 0),ku([(0,g.onChange)(Zc.prototype._setDirty),sn("Tonemap Background",{limitedUi:!0}),ke()],Nl.prototype,"tonemapBackground",void 0),ku([(0,g.onChange)(Zc.prototype._setDirty),sn("Clip Background"),ke()],Nl.prototype,"clipBackground",void 0),ku([(0,g.onChange)(Zc.prototype._setDirty),gn("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),ke()],Nl.prototype,"exposure",void 0),ku([(0,g.onChange)(Zc.prototype._setDirty),gn("Saturation",[0,2],.01,{limitedUi:!0}),ke()],Nl.prototype,"saturation",void 0),ku([(0,g.onChange)(Zc.prototype._setDirty),gn("Contrast",[0,2],.01,{limitedUi:!0}),ke()],Nl.prototype,"contrast",void 0),ku([(0,g.onChange)(Zc.prototype._setDirty),sn("Render Depth")],Nl.prototype,"renderDepth",void 0),Nl=Zc=ku([Vn("Tonemapping")],Nl);class Df extends Ou{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}async onAdded(e){var t;await super.onAdded(e),(t=e.getPlugin(Ri))==null||t.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new Nl(e,this.depthTonemap)}get exposure(){var e;return((e=this._extension)==null?void 0:e.exposure)??1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){var e;return((e=this._extension)==null?void 0:e.saturation)??1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){var e;return((e=this._extension)==null?void 0:e.contrast)??1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){var e;return((e=this._extension)==null?void 0:e.toneMapping)??u.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,t){var n,i;if(e instanceof u.Kj0&&((n=e.material)!=null&&n.userData)){const s=((i=e.material)==null?void 0:i.userData.postTonemap)===!1?0:1;t.w=Wv(t.w,1,s)}}}Df.PluginType="Tonemap",u.WdD.tonemapping_pars_fragment=u.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var $m,qv=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let ap=$m=class{constructor(a){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?g.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=a.getPlugin(vc),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=_n(a.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}};ap.PluginType="ChromaticAberration",qv([(0,g.onChange)($m.prototype._setDirty),sn("Enable"),ke()],ap.prototype,"enabled",void 0),qv([(0,g.onChange)($m.prototype._setDirty),gn("Intensity",[0,.1],.001,{limitedUi:!0}),ke()],ap.prototype,"aberrationIntensity",void 0),ap=$m=qv([Vn("ChromaticAberration")],ap);class Bf extends Ou{constructor(){super()}generateExtension(e){return new ap(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.aberrationIntensity)??1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Bf.PluginType="ChromaticAberration";class $c extends Sn{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map(n=>(n.passId||(console.warn("no id found for pass",n),n.passId=Ys()),e.renderer.registerPass(n,!0),[n.passId,n])))}async onRemove(e){var t;if(this._passes){for(const n of[...Object.values(this._passes)]){const i=n;e.renderer.unregisterPass(i),(t=i==null?void 0:i.dispose)==null||t.call(i)}this._passes=void 0}await super.onRemove(e)}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=Object.entries(this.passes);t.passes={};for(const[i,s]of n)t.passes[i]=Fi((s==null?void 0:s.passObject)??s,!1,e);return t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.passes){const n=Object.entries(this.passes);for(const[i,s]of n)Yi(e.passes[i],(s==null?void 0:s.passObject)??s,!1,t)}return this}}var Ts=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class as extends vi{constructor(e,t,n="rgba"){super({vertexShader:O.vertexShader,fragmentShader:t+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new u.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new u.FM8}},defines:{B_SRC_ACCESSOR:n}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,n,i,s){var o,l,h,d;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((o=this.uniforms.tDiffuse.value)==null?void 0:o.image.width)||0,((l=this.uniforms.tDiffuse.value)==null?void 0:l.image.height)||0),super.render(e,t,this._target,i,s),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set(((h=this.uniforms.tDiffuse.value)==null?void 0:h.image.width)||0,((d=this.uniforms.tDiffuse.value)==null?void 0:d.image.height)||0),super.render(e,this._target,t,i,s))}}Ts([ke(),bt()],as.prototype,"smoothEnabled",void 0),Ts([ke(),bt()],as.prototype,"edgeSharpness",void 0);var ro="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",_c=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,eg=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,db=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Y0 extends vi{constructor(e,t,n){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new u.FM8(512,512)},saoData:{value:new u.Ltg},frameCount:{value:0},cameraNearFar:{value:new u.FM8(.1,1e3)},projection:{value:new u.yGw},saoBiasEpsilon:{value:new u.Pa4(1,1,1)}},vertexShader:ro,fragmentShader:`

${_c}

${n}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;bool disableAO=getSelectionBit(getGBufferFlags(vUv).a)>0?true:false;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(i,s,o)=>{i.defines.SSAO_ENABLED&&(i.fragmentShader=i.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`))},onObjectRender:(i,s,o)=>{var l,h;this.materialExtension.extraUniforms.tSSAOMap.value=(l=this._target)==null?void 0:l.texture;const d=s.materialObject,f=!d.transparent&&d.transmission<.001;let v=this.enabled&&f&&o.userData.screenSpaceRendering!==!1&&!((h=s.userData)!=null&&h.ssaoDisabled)?1:0;d.defines.SSAO_ENABLED!==v&&(d.defines.SSAO_ENABLED=v,d.needsUpdate=!0),v=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==v&&(this.materialExtension.extraUniforms.tSSAOMap.value=v,d.needsUpdate=!0)},parsFragmentSnippet:i=>{var s;return g.glsl`
             uniform sampler2D tSSAOMap;
             ${be("tSSAOMap",(s=this._target)==null?void 0:s.texture,i.capabilities.isWebGL2)}
            ${eg}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:i=>{var s,o;return this.enabled?"1":"0"+((o=(s=this._target)==null?void 0:s.texture)==null?void 0:o.colorSpace)},isCompatible:i=>{var s;return!((s=i.materialObject.userData)!=null&&s.ssaoDisabled)&&i.isMeshStandardMaterial2}},this._renderer=e,this._target=t,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new as(this._target,n,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,n,i,s){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,s),this._smoothEnabled&&this.bilateralPass.render(e,t,n,i,s))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const t=this.material.uniforms.saoBiasEpsilon.value;t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff}}db([ke()],Y0.prototype,"bilateralPass",void 0),db([ke()],Y0.prototype,"parameters",void 0);class tg extends $c{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[Yt,Ri],this.setDirty=this.setDirty.bind(this)}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var t;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[tr(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new Y0(e.renderer,this._aoTarget,((t=e.getPlugin(Ri))==null?void 0:t.getUnpackSnippet())??""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(Ri)])}},()=>[e.getPlugin(Ri),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get enabled(){var e,t;return((t=(e=this.passes.ssao)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssao)!=null&&t.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const t=this,n=t.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[n,"enabled"],onChange:t.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[n.parameters,"intensity"],onChange:t.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[n.parameters,"occlusionWorldRadius"],onChange:t.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[n.parameters,"bias"],onChange:t.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[n.parameters,"falloff"],onChange:t.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=n.material)==null?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>n.material.needsUpdate=!0,t.setDirty]},{type:"checkbox",property:[n.bilateralPass,"smoothEnabled"],onChange:t.setDirty},{type:"vec4",property:[n.bilateralPass,"edgeSharpness"],onChange:t.setDirty}]}}}tg.PluginType="SSAO";var op,Uu=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let yc=op=class extends vi{constructor(){super({vertexShader:O.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new u.FM8},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:ga+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}void main(){
#if PASS_STEP == 0 
int doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new u.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(a,e,t,n,i){const s=a.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const o=t;let l=.5,h=o.width*l,d=o.height*l;const f=[];let v=s.getTempTarget({sizeMultiplier:1,type:u.cLu});f.push(v);let y=o;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(a,v,y,n,i),y=v;let w=1;for(;w<this.bloomIterations&&(h/=2,d/=2,l/=2,!(d<2||h<2));w++){v=s.getTempTarget({sizeMultiplier:l,type:u.cLu}),f.push(v),this.material.defines.PASS_STEP=1;let M=this._weights[w];M=this._weights[w-1]!==0?this._weights[w]/this._weights[w-1]:this._weights[w],this.material.uniforms.weight.value=M,this.material.needsUpdate=!0,super.render(a,v,y,n,i),y=v}this.clear=!1;const E=a.autoClear;for(a.autoClear=!1,w-=2;w>=0;w--)v=f[w],f[w]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=u.WMw,this.material.needsUpdate=!0,a.autoClear=!1,super.render(a,v,y,n,i),this.material.blending=u.jFi,s.releaseTempTarget(y),y=v;this.clear=!0,a.autoClear=E,a.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(a,e,y,n,i)):(this.uniforms.tSource.value=o.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(a,e,y,n,i),this.uniforms.tSource.value=null),s.releaseTempTarget(y)}_updateWeights(){if(!this._weights)return;const a=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let t=0;t<this.bloomIterations;t++){let n=t*e+.1,i=1.2-n;n=Math.pow(n,this.power),i=Math.pow(i,this.power),this._weights[t]=i*(1-a)+n*a}this.setDirty()}};function pb(a){const e=a==null?void 0:a.userData;return!!e&&(e[ll.PluginType]||(e[ll.PluginType]={}),e[ll.PluginType].enable=!0,a.isMaterial&&(a.needsUpdate=!0),!0)}Uu([bt()],yc.prototype,"prefilter",void 0),Uu([gn("Threshold",[0,2]),(0,g.onChange)(op.prototype._thresholdsUpdated),ke()],yc.prototype,"threshold",void 0),Uu([gn("Soft Threshold",[0,1]),(0,g.onChange)(op.prototype._thresholdsUpdated),ke()],yc.prototype,"softThreshold",void 0),Uu([gn("Intensity",[0,3]),ke(),bt()],yc.prototype,"intensity",void 0),Uu([gn("Iterations",[0,7],1),(0,g.onChange)(op.prototype._updateWeights),ke()],yc.prototype,"bloomIterations",void 0),Uu([gn("Radius",[0,1],.01),(0,g.onChange)(op.prototype._updateWeights),ke()],yc.prototype,"radius",void 0),Uu([gn("Power",[.2,10],.01),(0,g.onChange)(op.prototype._updateWeights),ke()],yc.prototype,"power",void 0),Uu([sn("Debug")],yc.prototype,"bloomDebug",void 0),yc=op=Uu([Vn("Bloom")],yc);class ll extends To{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:Ys(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},isCompatible:e=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(e){const t={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=e.materialObject.userData[ll.PluginType])==null?void 0:n.enable)??!0},set value(n){var i;const s=e.materialObject.userData[ll.PluginType];n!==(s==null?void 0:s.enable)&&(s||pb(e.materialObject),e.materialObject.userData[ll.PluginType].enable=n,(i=t.uiRefresh)==null||i.call(t,"postFrame",!0))},onChange:this.setDirty}]};return t}passCtor(e){const t=new yc;return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),t}async onAdded(e){var t,n;await super.onAdded(e),(t=e.getPlugin(Ri))==null||t.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(Yt);(n=i==null?void 0:i.materials)==null||n.registerMaterialExtension(this.materialExtension)}updateGBuffer(e,t){var n,i;if(e instanceof u.Kj0&&((n=e.material)!=null&&n.userData)){const s=(i=e.material)==null?void 0:i.userData[ll.PluginType],o=(s==null?void 0:s.enable)===!1?0:1;t.w=Wv(t.w,2,o)}}_update(e){var t,n;return(n=e.getPlugin(Ri))==null||n.updateShaderProperties((t=this.pass)==null?void 0:t.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}ll.PluginType="Bloom";var fb="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",Lf=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const mb={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new u.FM8},cameraNearFar:{value:new u.FM8}},vertexShader:ro,fragmentShader:ga+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},W1=(Xn({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new u.FM8},direction:{value:new u.FM8}},vertexShader:ro,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),Xn({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new u.FM8},direction:{value:new u.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:ro,fragmentShader:_c+`
`+fb+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class Fh extends vi{constructor(){super(mb,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=W1,this.nearFarBlurScale=new u.FM8(.25,.25),this.focalDepthRange=new u.FM8(.5,1.5),this.crossCenter=new u.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new er(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=Xn({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:ro,fragmentShader:ga+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=Xn({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new u.FM8},direction:{value:new u.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:ro,fragmentShader:ga+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,t,n,i,s){if(!this.enabled)return;const o=e.baseRenderer,l={minFilter:u.TyD,magFilter:u.TyD,type:u.cLu,encoding:u.rnI,sizeMultiplier:.5,isAntialiased:!1,format:u.wk1,depthBuffer:!1,generateMipmaps:!1},h=o.getTempTarget(l),d=o.getTempTarget(l);if(this.computeCocMaterial.uniforms.colorTexture.value=n.texture,o.blit(void 0,h,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=h.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,d,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=d.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,h,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=h.texture,o.blit(void 0,d,{material:this.dofBlurMaterial});else{const f=o.getTempTarget(l);this.dofBlurMaterial.uniforms.cocTexture.value=h.texture,this.dofBlurMaterial.uniforms.colorTexture.value=h.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,f,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=f.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,d,{material:this.dofBlurMaterial}),o.releaseTempTarget(f)}this.material.uniforms.blurTexture.value=d.texture,this.material.uniforms.cocTexture.value=h.texture,super.render(e,t,n,i,s),o.releaseTempTarget(h),o.releaseTempTarget(d)}}Lf([ke(),bt()],Fh.prototype,"nearFarBlurScale",void 0),Lf([ke(),bt()],Fh.prototype,"focalDepthRange",void 0),Lf([bt()],Fh.prototype,"crossCenter",void 0),Lf([bt()],Fh.prototype,"crossRadius",void 0),Lf([bt()],Fh.prototype,"crossAlpha",void 0),Lf([bt()],Fh.prototype,"crossColor",void 0);class K0 extends vi{constructor(e){super({vertexShader:O.vertexShader,fragmentShader:g.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new u.Ltg(1,1,1,1)},weight2:{value:new u.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var gb=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const J0=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class na extends $c{constructor(e=2*J0.length){super(),this._lastFrames=new Map,this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=t=>{const n=t.object;(n.modelObject||n.lightObject)&&(n.modelObject||n.lightObject).traverse(i=>{var s;(s=i==null?void 0:i.shadow)!=null&&s.camera&&i.shadow.mapSize&&this.trackedJitterCameras.add([i.shadow.camera,i.shadow.mapSize])})},this._jitterCamera=t=>{var n;const i=t.target;if(this.jitter&&i.renderer.frameCount>1){const s=(l,h)=>{const d={...J0[i.renderer.frameCount%J0.length]};l.setViewOffset(h.width,h.height,d.x,d.y,h.width,h.height)},o=i.scene.activeCamera.cameraObject;s(o,{width:i.canvas.clientWidth*i.renderer.displayCanvasScaling,height:i.canvas.clientHeight*i.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(l=>s(...l)),this._hasSetOffset=!0,(n=this._viewer)==null||n.renderer.resetShadows()}},this._resetCameraJitter=t=>{const n=t.target;this._hasSetOffset&&(n.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=$a("Progressive",this),this.maxFrameCount=e}async onAdded(e){return await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrames.forEach(t=>e.renderer.disposeTarget(t)),this._lastFrames.clear(),await super.onRemove(e)}get lastFrame(){var e;return this._lastFrames.get((e=this._viewer)==null?void 0:e.scene.renderCamera.cameraObject.uuid)}getLastFrame(e){return e?this._lastFrames.get(e.cameraObject.uuid):this.lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[tr(e,{passId:"progressive",get dirty(){var n;return t.jitter&&(((n=t._viewer)==null?void 0:n.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends K0{render(n,i,s,o,l){if(t.lastFrame){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((s==null?void 0:s.texture)&&e.renderer.blit(s.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(n,i,s,o,l),e.renderer.blit(i.texture,t.lastFrame,{})}else e.console.error("lastFrame render target undefined")}},update(){if(!t.lastFrame&&e.scene.renderCamera&&t._lastFrames.set(e.scene.renderCamera.cameraObject.uuid,e.renderer.composerTarget.clone(!0)),!t.lastFrame)return void console.error("lastFrame render target undefined");let n=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(n,n,n,n),n=1-n,this.passObject.weights2.set(n,n,n,n),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var t;return(((t=this._viewer)==null?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=((t=this.lastFrame)==null?void 0:t.texture)??void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}na.PluginType="Progressive",gb([ke(),gi("Frame count")],na.prototype,"maxFrameCount",void 0),gb([ke(),sn("Jitter")],na.prototype,"jitter",void 0);class Nu extends To{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:u.wem,magFilter:u.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await(0,g.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[na],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{var t;const n=(t=this._viewer)==null?void 0:t.canvas;if(!n)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==n)return void(this.pointerEnabled=!0);const i=n.getBoundingClientRect(),s=(e.clientX-i.left)/i.width,o=(e.clientY-i.top)/i.height;this.pointerEnabled=s<0||s>1||o<0||o>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const t=this,n=e.getPlugin(na),i=new class extends K0{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=$a("Frame Fade",this)}render(s,o,l,h,d){this.needsSwap=!1;const f=t._target;if(!f||!t.pointerEnabled||!this.enabled||!t.dirty||t._fadeTimeState<.001||e.scene.renderCamera!==e.scene.activeCamera)return;t._toSaveFrame&&n.lastFrame&&(e.renderer.blit(n.lastFrame.texture,f),this._lastTime=0,t._toSaveFrame=!1),this.blendTexture=f==null?void 0:f.texture;const v=t._fadeTimeState/t._fadeTime;this.weights2.setScalar(v),this.weights2.w=1,this.weights1.setScalar(1-v),this.weights1.w=1,super.render(s,o,l,h,d),this.needsSwap=!0;const y=(0,g.now)();this._lastTime<10&&(this._lastTime=y-10);const w=y-this._lastTime;this._lastTime=y,t._fadeTimeState-=w}};return i.enabled=!0,i}setDirty(){var e;this.enabled&&((e=this._viewer)==null||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return(t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}Nu.PluginType="FrameFade";var Z0=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class zh extends To{passCtor(e){return new Fh}constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[Ri],this.enableEdit=!1,this._focalPointHit=new u.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new u.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,t=!0,n=!1){var i,s;this._focalPointHit.copy(e),t&&((s=(i=this._viewer)==null?void 0:i.getPlugin(Nu))==null||s.startTransition(this._frameFadeTime)),n&&(this._focalPointHitTime=(0,g.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e;return((e=this.pass)==null?void 0:e.passObject.focalDepthRange.y)??0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.x)??0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.y)??0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,n;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(n=(t=this._viewer)==null?void 0:t.getPlugin(Nu))==null||n.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),(t=e.getPluginByType("Picking"))==null||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return(t=e.getPluginByType("Picking"))==null||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_update(e){var t,n;if(!super._update(e))return!1;const i=(t=this.pass)==null?void 0:t.passObject;if(!i)return!1;const s=e.getPlugin(Ri);s==null||s.updateShaderProperties(i.material),i.dofBlurMaterial.uniforms.frameCount&&((n=e.renderer)==null||n.updateShaderProperties(i.dofBlurMaterial));const o=e.scene.renderCamera;if(!o)return!1;o.cameraObject.updateMatrixWorld(!0),o.updateShaderProperties(i.material),o.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),i.focalDepthRange.x=this._tempVec.length(),i.focalDepthRange.x*=o.cameraObject.getWorldDirection(new u.Pa4).dot(this._tempVec.normalize());let l=((0,g.now)()-this._focalPointHitTime)/this.crossFadeTime;if(l=1-Math.min(1,Math.max(0,l)),Math.abs(l-i.crossAlpha)>.01&&(i.crossAlpha=l,this.setDirty()),l>0){const h=this._tempVec.copy(this._focalPointHit).project(o.cameraObject).addScalar(1).divideScalar(2);i.crossCenter.set(h.x,h.y),i.computeCocMaterial.uniformsNeedUpdate=!0,i.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,t,n,i,s;if(this._uiConfig)return this._uiConfig;const o=(t=(e=this._pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig;return o?((i=(n=o.children)==null?void 0:n.map(l=>(0,g.getOrCall)(l)))==null||i.flat(2).forEach(l=>l&&(l.onChange=this.setDirty)),(s=o.children)==null||s.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=o,o):{}}}zh.PluginType="DepthOfField",Z0([ke()],zh.prototype,"enableEdit",void 0),Z0([ke("focalPoint")],zh.prototype,"_focalPointHit",void 0),Z0([ke()],zh.prototype,"crossFadeTime",void 0);var vb=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let cl=class extends Sn{addThinFilmLayer(a){return $0(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new q1(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Yt],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new u.Ltg},thinNoiseLayerFactors:{value:new u.Ltg},thinColorNoiseParams:{value:new u.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._thinFilmLayer)!=null&&t.hasThinFilm)?_c+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(a,e,t)=>{var n;if(!this.enabled||!((n=e.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm))return;const i="#glMarker beforeAccumulation";a.fragmentShader=a.fragmentShader.replace(i,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+i),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var t;const n=(t=e.materialObject.userData)==null?void 0:t._thinFilmLayer;if(!(n!=null&&n.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(n.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(n.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(n.colorNoiseParams),this._uniforms.thinFilmFactor.value=n.filmFactor;const i=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==i&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=i,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._thinFilmLayer)!=null&&t.hasThinFilm?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2||a.isDiamondMaterial,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=a.materialObject.userData._thinFilmLayer)==null?void 0:n.hasThinFilm)||!1},set value(n){var i,s;n!==((i=a.materialObject.userData._thinFilmLayer)==null?void 0:i.hasThinFilm)&&(n?$0(a.materialObject)||e.alert("Cannot add thin film."):a.materialObject.userData._thinFilmLayer&&(a.materialObject.userData._thinFilmLayer.hasThinFilm=!1,a.materialObject.needsUpdate=!0),(s=t.uiRefresh)==null||s.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var n;return!((n=a.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a;(a=this._viewer)==null||a.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,n,i,s;await super.onAdded(a);const o=a.getPlugin(Yt);(e=o==null?void 0:o.materials)==null||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),(s=(i=(n=o==null?void 0:o.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null||s.push(X1)}async onRemove(a){var e,t,n,i;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=a.getPlugin(Yt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function $0(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const t=e._thinFilmLayer;return t.hasThinFilm=!0,t.baseLayerFactors===void 0&&(t.baseLayerFactors=[.3,.6,1,.9]),t.noiseLayerFactors===void 0&&(t.noiseLayerFactors=[.7,.5,.9,.7]),t.colorNoiseParams===void 0&&(t.colorNoiseParams=[.5,.5,.5,.7]),t.filmFactor===void 0&&(t.filmFactor=.3),a.isMaterial&&(a.needsUpdate=!0),!0}cl.PluginType="ThinFilmLayerPlugin",cl.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",vb([sn("Enabled",a=>({onChange:a.setDirty})),ke()],cl.prototype,"enabled",void 0),cl=vb([Vn("ThinFilmLayer Materials")],cl);class q1{constructor(e){this.parser=e,this.name=cl.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),$0(t),t.userData._thinFilmLayer=Yi(i,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const X1=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;t.extensions=t.extensions||{};const n=Fi(e.userData._thinFilmLayer,!1);t.extensions[cl.THIN_FILM_LAYER_GLTF_EXTENSION]=n,a.extensionsUsed[cl.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class ng{async apply(e,t,n){var i,s,o,l;if(!t)return void(this.selected=void 0);let h=this.presets.find(d=>function(f,v){return(typeof f=="string"?f:f.path)===(typeof v=="string"?v:v.path)}(d,t));return h||(this.presets.push(t),h=t),this.selected=h,typeof h!="string"?(s=(i=e.getManager())==null?void 0:i.importer)==null?void 0:s.importAsset(h,n):(l=(o=e.getManager())==null?void 0:o.importer)==null?void 0:l.importPath(h,n)}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class _b extends ng{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return i&&(i.colorSpace=u.KI_,e.scene.background=i),i}}class yb extends ng{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return i&&(e.scene.environment=i),i}}class Ab extends ng{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return(0,g.safeSetProperty)(e.getPluginByType("Diamond"),"envMap",i),i}}class ig extends ng{async apply(e,t){var n,i;const s=await super.apply(e,t,{processImported:!1});return s?(i=(n=e.getManager())==null?void 0:n.importer)==null?void 0:i.processImported(s):void 0}}class bb extends ig{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const n=await super.apply(e,t);return n&&await e.alert("Material Library successfully imported."),n}}class lp extends Sn{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(t=>{var n;return{label:((n=Of(t))==null?void 0:n.split("/").pop())||"",value:Of(t)}})],getValue:()=>Of(e.selected)||"",setValue:t=>{e.apply(this._viewer,e.presets.find(n=>Of(n)===t))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,g.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,g.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,n;await super.onAdded(e),this.presetGroups.push(new _b),this.presetGroups.push(new yb),this.presetGroups.push(new Ab),this.presetGroups.push(new ig("Ground")),this.presetGroups.push(new ig("CameraViews")),this.presetGroups.push(new ig("MaterialConfiguration")),this.presetGroups.push(new bb),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(t=>[t.name,Of(t.selected)||void 0]).filter(([,t])=>t));return e.type=lp.PluginType,e}async fromJSON(e,t){var n,i;if(!super.fromJSON(e,t))return null;const s={...e};delete s.type;const o=[];for(const[l,h]of Object.entries(s)){const d=this.presetGroups.find(y=>y.name===l),f=d==null?void 0:d.presets;if(!d||!f)continue;const v=typeof h=="string"?{path:h}:h;o.push(d.apply(this._viewer,v))}return await Promise.all(o),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n,"postFrame",!0),this}async loadPresetGroups(e){var t;typeof e=="string"&&e.startsWith("http")&&(e=await fetch(e).then(async n=>n.json()));for(const[n,i]of Object.entries(e)){const s=(t=this.presetGroups.find(o=>o.name===n))==null?void 0:t.presets;s==null||s.push(...i)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(Of)]).filter(([,e])=>e.length>0))}}function Of(a){return a&&typeof a!="string"?a.path:a}lp.PluginType="PresetLibraryPlugin";var rg,Xv=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let kf=rg=class{constructor(a){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?g.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=a.getPlugin(vc),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=_n(a.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}};Xv([(0,g.onChange)(rg.prototype._setDirty),sn("Enable"),ke()],kf.prototype,"enabled",void 0),Xv([(0,g.onChange)(rg.prototype._setDirty),sn("Multiply"),ke()],kf.prototype,"grainMultiply",void 0),Xv([(0,g.onChange)(rg.prototype._setDirty),gn("Intensity",[0,20],.01,{limitedUi:!0}),ke()],kf.prototype,"grainIntensity",void 0),kf=rg=Xv([Vn("FilmicGrain")],kf);class sg extends Ou{constructor(){super()}generateExtension(e){return new kf(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.grainIntensity)??1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e;return((e=this._extension)==null?void 0:e.grainMultiply)??!1}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}sg.PluginType="FilmicGrain";class xb extends g.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){var t;(t=this._scene)==null||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,t,n,i){super(),this.hoverEnabled=!1,this._scene=e,this._camera=n??this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=i??(s=>s.userData.userSelectable!==!1&&s.userData.bboxVisible!==!1&&s.material!=null&&s.material.type!=="ShadowMaterial"),this.raycaster=new u.iMs,this.mouse=new u.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",s=>this.onPointerMove(s)),this.domElement.addEventListener("pointerleave",s=>this.onPointerLeave(s)),this.domElement.addEventListener("pointerout",s=>this.onPointerLeave(s)),this.domElement.addEventListener("pointercancel",s=>this.onPointerCancel(s)),this.domElement.addEventListener("pointerenter",s=>this.onPointerEnter(s)),this.domElement.addEventListener("pointerdown",s=>this.onPointerDown(s)),this.domElement.addEventListener("pointerup",s=>this.onPointerUp(s))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,g.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){var t;e.isPrimary!==!1&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=((t=this.checkIntersection())==null?void 0:t.intersects[0].object)??null))}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(t==null?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var e;const t=(e=this._camera)==null?void 0:e.cameraObject;if(!t)return null;this.raycaster.setFromCamera(this.mouse,t);let n=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const i=[];n=n.filter(d=>!i.includes(d.object.id)&&(i.push(d.object.id),!0));let o,l=null;const h=[];for(const d of n){for(l=d.object,o=d;!(l==null||l.visible&&this.selectionCondition(l));)l=l.parent;l!=null&&h.push(d)}if(n=h,n.length>0){if(l=n[0].object,o=n[0],this._firstHit&&l.id!==this._firstHit.id)l=o.object;else for(let d=0;d<n.length;d++)if(this.selectedObject&&this.selectedObject.id===n[d].object.id){const f=d+1;if(!(f<n.length))return null;o=n[f],l=o.object}this._firstHit=n[0].object}return l&&o&&l?{selectedObject:l,intersect:o,intersects:n,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const wb=new u.ZzF,Uf=new u.Pa4;class jh extends u.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new u.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new u.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new u.$TI(t,6,1);return this.setAttribute("instanceStart",new u.kB5(n,3,0)),this.setAttribute("instanceEnd",new u.kB5(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new u.$TI(t,6,1);return this.setAttribute("instanceColorStart",new u.kB5(n,3,0)),this.setAttribute("instanceColorEnd",new u.kB5(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new u.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new u.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),wb.setFromBufferAttribute(t),this.boundingBox.union(wb))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new u.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let s=0,o=e.count;s<o;s++)Uf.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(Uf)),Uf.fromBufferAttribute(t,s),i=Math.max(i,n.distanceToSquared(Uf));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class ey extends jh{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new u.Uk6(e))}}u.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new u.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},u.Vj0.line={uniforms:u.rDY.merge([u.rBU.common,u.rBU.fog,u.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Fl extends u.jyz{constructor(e){super({type:"LineMaterial",uniforms:u.rDY.clone(u.Vj0.line.uniforms),vertexShader:u.Vj0.line.vertexShader,fragmentShader:u.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const ty=new u.Pa4,Eb=new u.Pa4;class Yv extends u.Kj0{constructor(e=new jh,t=new Fl({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let o=0,l=0,h=t.count;o<h;o++,l+=2)ty.fromBufferAttribute(t,o),Eb.fromBufferAttribute(n,o),i[l]=l===0?0:i[l-1],i[l+1]=i[l]+ty.distanceTo(Eb);const s=new u.$TI(i,2,1);return e.setAttribute("instanceDistanceStart",new u.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new u.kB5(s,1,1)),this}}class Kv extends u.ZAu{_updater(){const e=this._object;if(e){const t=new Fe().expandByObject(e,!1);t.getCenter(this.position);const n=t.getBoundingSphere(new u.aLr).radius;this.scale.setScalar(n*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const t=new ey(e);this._geometry=t;const n=new Fl({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new u.FM8(1024,1024),dashed:!1,toneMapped:!1}),i=new Yv(t,n);i.computeLineDistances(),i.scale.set(1,1,1),i.visible=!0,this.add(i)}setVisible(e){var t;e!==this.visible&&(this.visible=e,(t=this.setDirty)==null||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)==null||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class ny extends Kv{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new u.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new Fe().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const cp=new u.iMs,ko=new u.Pa4,zl=new u.Pa4,Or=new u._fP,iy={X:new u.Pa4(1,0,0),Y:new u.Pa4(0,1,0),Z:new u.Pa4(0,0,1)},ry={type:"change"},Jv={type:"mouseDown"},Sb={type:"mouseUp",mode:null},Mb={type:"objectChange"};class Cb extends u.Tme{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new $1;this._gizmo=n,this.add(n);const i=new eE;this._plane=i,this.add(i);const s=this;function o(L,R){let I=R;Object.defineProperty(s,L,{get:function(){return I!==void 0?I:R},set:function(N){I!==N&&(I=N,i[L]=N,n[L]=N,s.dispatchEvent({type:L+"-changed",value:N}),s.dispatchEvent(ry))}}),s[L]=R,i[L]=R,n[L]=R}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const l=new u.Pa4,h=new u.Pa4,d=new u._fP,f=new u._fP,v=new u.Pa4,y=new u._fP,w=new u.Pa4,E=new u.Pa4,M=new u.Pa4,P=new u.Pa4;o("worldPosition",l),o("worldPositionStart",h),o("worldQuaternion",d),o("worldQuaternionStart",f),o("cameraPosition",v),o("cameraQuaternion",y),o("pointStart",w),o("pointEnd",E),o("rotationAxis",M),o("rotationAngle",0),o("eye",P),this._offset=new u.Pa4,this._startNorm=new u.Pa4,this._endNorm=new u.Pa4,this._cameraScale=new u.Pa4,this._parentPosition=new u.Pa4,this._parentQuaternion=new u._fP,this._parentQuaternionInv=new u._fP,this._parentScale=new u.Pa4,this._worldScaleStart=new u.Pa4,this._worldQuaternionInv=new u._fP,this._worldScale=new u.Pa4,this._positionStart=new u.Pa4,this._quaternionStart=new u._fP,this._scaleStart=new u.Pa4,this._getPointer=Y1.bind(this),this._onPointerDown=K1.bind(this),this._onPointerHover=Tb.bind(this),this._onPointerMove=J1.bind(this),this._onPointerUp=Z1.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;cp.setFromCamera(e,this.camera);const t=sy(this._gizmo.picker[this.mode],cp);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){cp.setFromCamera(e,this.camera);const t=sy(this._plane,cp,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Jv.mode=this.mode,this.dispatchEvent(Jv)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let s=this.space;if(n==="scale"?s="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(s="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;cp.setFromCamera(e,this.camera);const o=sy(this._plane,cp,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(i.position.applyQuaternion(Or.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),s==="world"&&(i.parent&&i.position.add(ko.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(ko.setFromMatrixPosition(i.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),zl.set(l,l,l)}else ko.copy(this.pointStart),zl.copy(this.pointEnd),ko.applyQuaternion(this._worldQuaternionInv),zl.applyQuaternion(this._worldQuaternionInv),zl.divide(ko),t.search("X")===-1&&(zl.x=1),t.search("Y")===-1&&(zl.y=1),t.search("Z")===-1&&(zl.z=1);i.scale.copy(this._scaleStart).multiply(zl),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(ko.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ko.copy(this.rotationAxis).cross(this.eye))*l):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(iy[t]),ko.copy(iy[t]),s==="local"&&ko.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(ko.cross(this.eye).normalize())*l),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Or.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Or.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ry),this.dispatchEvent(Mb)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Sb.mode=this.mode,this.dispatchEvent(Sb)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ry),this.dispatchEvent(Mb),this.pointStart.copy(this.pointEnd))}getRaycaster(){return cp}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Y1(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function Tb(a){if(this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a))}}function K1(a){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function J1(a){this.enabled&&this.pointerMove(this._getPointer(a))}function Z1(a){this.enabled&&(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function sy(a,e,t){const n=e.intersectObject(a,!0);for(let i=0;i<n.length;i++)if(n[i].object.visible||t)return n[i];return!1}const Zv=new u.USm,br=new u.Pa4(0,1,0),Ib=new u.Pa4(0,0,0),ay=new u.yGw,ag=new u._fP,$v=new u._fP,eu=new u.Pa4,Pb=new u.yGw,og=new u.Pa4(1,0,0),up=new u.Pa4(0,1,0),Nf=new u.Pa4(0,0,1),e_=new u.Pa4,hp=new u.Pa4,dp=new u.Pa4;class $1 extends u.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new u.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new u.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const i=t.clone();i.opacity=.5;const s=e.clone();s.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const l=e.clone();l.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const d=e.clone();d.color.setHex(65280),d.opacity=.5;const f=e.clone();f.color.setHex(255),f.opacity=.5;const v=e.clone();v.opacity=.25;const y=e.clone();y.color.setHex(16776960),y.opacity=.25,e.clone().color.setHex(16776960);const w=e.clone();w.color.setHex(7895160);const E=new u.fHI(0,.04,.1,12);E.translate(0,.05,0);const M=new u.DvJ(.08,.08,.08);M.translate(0,.04,0);const P=new u.u9r;P.setAttribute("position",new u.a$l([0,0,0,1,0,0],3));const L=new u.fHI(.0075,.0075,.5,3);function R(xe,we){const Re=new u.XvJ(xe,.0075,3,64,we*Math.PI*2);return Re.rotateY(Math.PI/2),Re.rotateX(Math.PI/2),Re}L.translate(0,.25,0);const I={X:[[new u.Kj0(E,s),[.5,0,0],[0,0,-Math.PI/2]],[new u.Kj0(E,s),[-.5,0,0],[0,0,Math.PI/2]],[new u.Kj0(L,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new u.Kj0(E,o),[0,.5,0]],[new u.Kj0(E,o),[0,-.5,0],[Math.PI,0,0]],[new u.Kj0(L,o)]],Z:[[new u.Kj0(E,l),[0,0,.5],[Math.PI/2,0,0]],[new u.Kj0(E,l),[0,0,-.5],[-Math.PI/2,0,0]],[new u.Kj0(L,l),null,[Math.PI/2,0,0]]],XYZ:[[new u.Kj0(new u.pQR(.1,0),v.clone()),[0,0,0]]],XY:[[new u.Kj0(new u.DvJ(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new u.Kj0(new u.DvJ(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new u.Kj0(new u.DvJ(.15,.15,.01),d.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},N={X:[[new u.Kj0(new u.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new u.Kj0(new u.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new u.Kj0(new u.fHI(.2,0,.6,4),n),[0,.3,0]],[new u.Kj0(new u.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new u.Kj0(new u.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new u.Kj0(new u.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new u.Kj0(new u.pQR(.2,0),n)]],XY:[[new u.Kj0(new u.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new u.Kj0(new u.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new u.Kj0(new u.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},j={START:[[new u.Kj0(new u.pQR(.01,2),i),null,null,null,"helper"]],END:[[new u.Kj0(new u.pQR(.01,2),i),null,null,null,"helper"]],DELTA:[[new u.x12(function(){const xe=new u.u9r;return xe.setAttribute("position",new u.a$l([0,0,0,1,1,1],3)),xe}(),i),null,null,null,"helper"]],X:[[new u.x12(P,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new u.x12(P,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new u.x12(P,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},H={XYZE:[[new u.Kj0(R(.5,1),w),null,[0,Math.PI/2,0]]],X:[[new u.Kj0(R(.5,.5),s)]],Y:[[new u.Kj0(R(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new u.Kj0(R(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new u.Kj0(R(.75,1),y),null,[0,Math.PI/2,0]]]},X={AXIS:[[new u.x12(P,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},ne={XYZE:[[new u.Kj0(new u.xo$(.25,10,8),n)]],X:[[new u.Kj0(new u.XvJ(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new u.Kj0(new u.XvJ(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new u.Kj0(new u.XvJ(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new u.Kj0(new u.XvJ(.75,.1,2,24),n)]]},pe={X:[[new u.Kj0(M,s),[.5,0,0],[0,0,-Math.PI/2]],[new u.Kj0(L,s),[0,0,0],[0,0,-Math.PI/2]],[new u.Kj0(M,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new u.Kj0(M,o),[0,.5,0]],[new u.Kj0(L,o)],[new u.Kj0(M,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new u.Kj0(M,l),[0,0,.5],[Math.PI/2,0,0]],[new u.Kj0(L,l),[0,0,0],[Math.PI/2,0,0]],[new u.Kj0(M,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new u.Kj0(new u.DvJ(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new u.Kj0(new u.DvJ(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new u.Kj0(new u.DvJ(.15,.15,.01),d),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new u.Kj0(new u.DvJ(.1,.1,.1),v.clone())]]},Ae={X:[[new u.Kj0(new u.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new u.Kj0(new u.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new u.Kj0(new u.fHI(.2,0,.6,4),n),[0,.3,0]],[new u.Kj0(new u.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new u.Kj0(new u.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new u.Kj0(new u.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new u.Kj0(new u.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new u.Kj0(new u.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new u.Kj0(new u.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new u.Kj0(new u.DvJ(.2,.2,.2),n),[0,0,0]]]},ve={X:[[new u.x12(P,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new u.x12(P,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new u.x12(P,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Ee(xe){const we=new u.Tme;for(const Re in xe)for(let Be=xe[Re].length;Be--;){const Oe=xe[Re][Be][0].clone(),at=xe[Re][Be][1],st=xe[Re][Be][2],St=xe[Re][Be][3],dt=xe[Re][Be][4];Oe.name=Re,Oe.tag=dt,at&&Oe.position.set(at[0],at[1],at[2]),st&&Oe.rotation.set(st[0],st[1],st[2]),St&&Oe.scale.set(St[0],St[1],St[2]),Oe.updateMatrix();const ht=Oe.geometry.clone();ht.applyMatrix4(Oe.matrix),Oe.geometry=ht,Oe.renderOrder=1/0,Oe.position.set(0,0,0),Oe.rotation.set(0,0,0),Oe.scale.set(1,1,1),we.add(Oe)}return we}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Ee(I)),this.add(this.gizmo.rotate=Ee(H)),this.add(this.gizmo.scale=Ee(pe)),this.add(this.picker.translate=Ee(N)),this.add(this.picker.rotate=Ee(ne)),this.add(this.picker.scale=Ee(Ae)),this.add(this.helper.translate=Ee(j)),this.add(this.helper.rotate=Ee(X)),this.add(this.helper.scale=Ee(ve)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:$v;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let i=0;i<n.length;i++){const s=n[i];let o;s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(o*this.size/4),s.tag!=="helper"?(s.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(s.name==="X"&&Math.abs(br.copy(og).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(br.copy(up).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(br.copy(Nf).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(br.copy(Nf).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(br.copy(og).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(br.copy(up).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):this.mode==="rotate"&&(ag.copy(t),br.copy(this.eye).applyQuaternion(Or.copy(t).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(ay.lookAt(this.eye,Ib,up)),s.name==="X"&&(Or.setFromAxisAngle(og,Math.atan2(-br.y,br.z)),Or.multiplyQuaternions(ag,Or),s.quaternion.copy(Or)),s.name==="Y"&&(Or.setFromAxisAngle(up,Math.atan2(br.x,br.z)),Or.multiplyQuaternions(ag,Or),s.quaternion.copy(Or)),s.name==="Z"&&(Or.setFromAxisAngle(Nf,Math.atan2(br.y,br.x)),Or.multiplyQuaternions(ag,Or),s.quaternion.copy(Or))),s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(l){return s.name===l}))&&(s.material.color.setHex(16776960),s.material.opacity=1)):(s.visible=!1,s.name==="AXIS"?(s.visible=!!this.axis,this.axis==="X"&&(Or.setFromEuler(Zv.set(0,0,0)),s.quaternion.copy(t).multiply(Or),Math.abs(br.copy(og).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(Or.setFromEuler(Zv.set(0,0,Math.PI/2)),s.quaternion.copy(t).multiply(Or),Math.abs(br.copy(up).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(Or.setFromEuler(Zv.set(0,Math.PI/2,0)),s.quaternion.copy(t).multiply(Or),Math.abs(br.copy(Nf).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(Or.setFromEuler(Zv.set(0,Math.PI/2,0)),br.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(ay.lookAt(Ib,br,up)),s.quaternion.multiply(Or),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),ko.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ko.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(ko),s.visible=this.dragging):(s.quaternion.copy(t),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1)))}super.updateMatrixWorld(e)}}class eE extends u.Kj0{constructor(){super(new u._12(1e5,1e5,2,2),new u.vBJ({visible:!1,wireframe:!0,side:u.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),e_.copy(og).applyQuaternion(t==="local"?this.worldQuaternion:$v),hp.copy(up).applyQuaternion(t==="local"?this.worldQuaternion:$v),dp.copy(Nf).applyQuaternion(t==="local"?this.worldQuaternion:$v),br.copy(hp),this.mode){case"translate":case"scale":switch(this.axis){case"X":br.copy(this.eye).cross(e_),eu.copy(e_).cross(br);break;case"Y":br.copy(this.eye).cross(hp),eu.copy(hp).cross(br);break;case"Z":br.copy(this.eye).cross(dp),eu.copy(dp).cross(br);break;case"XY":eu.copy(dp);break;case"YZ":eu.copy(e_);break;case"XZ":br.copy(dp),eu.copy(hp);break;case"XYZ":case"E":eu.set(0,0,0)}break;default:eu.set(0,0,0)}eu.length()===0?this.quaternion.copy(this.cameraQuaternion):(Pb.lookAt(ko.set(0,0,0),eu,br),this.quaternion.setFromRotationMatrix(Pb)),super.updateMatrixWorld(e)}}class Rb extends Cb{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(u.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var t;(t=this==null?void 0:this.object)==null||t.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",t=>{const n=e==null?void 0:e.getPlugin(Nu);n&&(n.enabled=!t.value),this._scene.activeCamera.interactionsEnabled=!t.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var Db=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Ti extends Sn{get picker(){return this._picker}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}constructor(e=ny,t=!1,n=!0,i=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=s=>{this._viewer&&(this.enabled?this.dispatchEvent(s):s.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const s=this.getSelectedObject();this.autoFocus&&s&&this.setSelectedObject(s,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=n,this.autoFocus=i}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)==null?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled||!this._picker)return;const n=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=n,(n||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new xb(e.scene,e.canvas,void 0,t=>{if(!t.material)return!1;let n=t,i=!1;for(;n;){if(!n.visible||((n.userData.iModel??n).assetType==="model"&&(i=!0),(n.userData.iModel??n).assetType==="widget")||n.userData.userSelectable===!1||n.userData.bboxVisible===!1)return!1;n=n.parent}return i}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new Rb(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",t=>{var n,i,s;this.dispatchEvent(t);const o=((n=this._picker)==null?void 0:n.selectedObject)||void 0;if(this._pickUi){const d=o==null?void 0:o.uiConfig,f=this.uiConfig;f.children=[...this._uiConfigChildren],d&&f.children.push(d),(i=f.uiRefresh)==null||i.call(f)}const l=this._widget;l&&this._enableWidget&&(o?l.attach(o):l.detach());const h=this._transformControls;h&&((s=this._viewer)!=null&&s.scene.activeCamera.controls)&&(o&&h.enabled?h.attach(o):h.detach()),e.setDirty(),this.autoFocus&&this.focusObject(o)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",t=>{t.value===void 0?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(t.value,this.autoFocus||t.focusCamera)}),e.scene.addEventListener("addSceneObject",async t=>{var n,i;const s=t.object,o=this.getSelectedObject();if(o&&(s==null?void 0:s.assetType)==="material"&&typeof(o==null?void 0:o.setMaterial)=="function"&&((n=o==null?void 0:o.modelObject)!=null&&n.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const l=o.material;if(Array.isArray(l))console.warn("Dropping on material array not yet fully supported."),o.setMaterial(s);else{let h=Array.from((l==null?void 0:l.userData.__appliedMeshes)??[]);(h.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):h.length<1)&&(h=[o]);for(const d of h)d&&((i=d.setMaterial)==null||i.call(d,s))}}}),e.scene.addEventListener("sceneUpdate",t=>{if(!t.hierarchyChanged)return;const n=this.getSelectedObject();let i=!1;n==null||n.traverseAncestors(s=>{s===e.scene.modelObject&&(i=!0)}),i||this.setSelectedObject(void 0)})}async focusObject(e){var t,n,i;const s=(t=this._viewer)==null?void 0:t.getPluginByType("CameraViews");await(s==null?void 0:s.animateToFitObject(e,1.25,1e3,"easeOut",{min:(((i=(n=this._viewer)==null?void 0:n.scene.activeCamera.getControls())==null?void 0:i.minDistance)??.5)+.5,max:50}))}enableWidget(e){var t,n,i;if(this._enableWidget=e,e){const s=((t=this._picker)==null?void 0:t.selectedObject)||void 0;s&&((n=this._widget)==null||n.attach(s))}else(i=this._widget)==null||i.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}Ti.PluginType="Picking",Db([ke()],Ti.prototype,"enabled",void 0),Db([ke()],Ti.prototype,"autoFocus",void 0);var t_,lg=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Is=t_=class extends Sn{enableCustomBump(a,e,t){var n;const i=(n=a.materialObject)==null?void 0:n.userData;if(!i)return!1;if(i._hasCustomBump===void 0){const s=i.__appliedMeshes;let o=!0;if(s)for(const{geometry:l}of s)!l||l.attributes.position&&l.attributes.normal&&l.attributes.uv||(o=!1);if(!o)return!1}return i._hasCustomBump=!0,i._customBumpScale=t??i._customBumpScale??.001,i._customBumpMap=e??i._customBumpMap,a.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new tE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Yt],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new u.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(a,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(a,e,t)=>{var n;if(!this.enabled||!e.materialObject.userData._hasCustomBump)return;((n=e.materialObject.userData)==null?void 0:n._customBumpMap)&&(a.fragmentShader=_n(a.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),a.vertexShader=_n(a.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),a.vertexShader=_n(a.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),a.defines.USE_UV="")},onObjectRender:(a,e)=>{var t;const n=e.materialObject.userData;if(!(n!=null&&n._hasCustomBump))return;const i=a;if(!i.isMesh||!i.geometry)return;const s=(t=n._customBumpMap)!=null&&t.isTexture?n._customBumpMap:null;this._uniforms.customBumpMap.value=s,this._uniforms.customBumpScale.value=s?n._customBumpScale:0,s&&(s.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(s.matrix));let o=this.enabled&&s?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=o,e.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=o,e.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=o,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t,n;return(this.enabled?"1":"0")+((e=a.materialObject.userData)!=null&&e._hasCustomBump?"1":"0")+((n=(t=a.materialObject.userData)==null?void 0:t._customBumpMap)==null?void 0:n.uuid)},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t=this.enableCustomBump,n={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return a.materialObject.userData._hasCustomBump||!1},set value(i){var s;i!==a.materialObject.userData._hasCustomBump&&(i?t(a)||e.alert("One or more geometries cannot be made anisotropic."):(a.materialObject.userData._hasCustomBump=!1,a.materialObject.needsUpdate=!0),(s=n.uiRefresh)==null||s.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!a.materialObject.userData._hasCustomBump,property:[a.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!a.materialObject.userData._hasCustomBump,property:[a.materialObject.userData,"_customBumpMap"],onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}},cr(a.materialObject.userData,"_customBumpMap")]};return n}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this.enableCustomBumpSelected=()=>{var a,e,t;const n=(t=(e=(a=this._viewer)==null?void 0:a.getPlugin(Ti))==null?void 0:e.getSelectedObject())==null?void 0:t.material;return(n==null?void 0:n.assetType)==="material"&&this.enableCustomBump(n)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,n,i,s;await super.onAdded(a);const o=a.getPlugin(Yt);(e=o==null?void 0:o.materials)==null||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),(s=(i=(n=o==null?void 0:o.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null||s.push(n_)}async onRemove(a){var e,t,n,i,s,o,l,h,d,f,v,y;(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=a.getPlugin(Yt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate);const w=(h=(l=(o=(s=a.getPlugin(Yt))==null?void 0:s.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:l.extensions)==null?void 0:h.indexOf(n_);return w!==void 0&&w!==-1&&((y=(v=(f=(d=a.getPlugin(Yt))==null?void 0:d.exporter)==null?void 0:f.getExporter("gltf","glb"))==null?void 0:v.extensions)==null||y.splice(w,1)),super.onRemove(a)}};Is.PluginType="CustomBumpMapPlugin",Is.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",lg([sn("Enabled",a=>({onChange:a.setDirty})),ke()],Is.prototype,"enabled",void 0),lg([sn("Bicubic",a=>({onChange:a.setDirty})),cn("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,t_.prototype.setDirty),ke()],Is.prototype,"bicubicFiltering",void 0),lg([Bi("Enable CustomBumpMap",a=>({hidden:()=>{var e;return!((e=a._viewer)!=null&&e.getPlugin(Ti))}}))],Is.prototype,"enableCustomBumpSelected",void 0),Is=t_=lg([Vn("CustomBumpMap Materials")],Is);class tE{constructor(e){this.parser=e,this.name=Is.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=o.customBumpScale??0;const l=o.customBumpMap;return l&&s.push(n.assignTexture(t.userData,"_customBumpMap",l).then(h=>{h.colorSpace=u.KI_})),Promise.all(s)}}const n_=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const i={index:a.processTexture(e.userData._customBumpMap)};a.applyTextureTransform(i,e.userData._customBumpMap),n.customBumpMap=i}t.extensions[Is.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=n,a.extensionsUsed[Is.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var Fu,ia=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let hr=Fu=class extends Sn{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(a){this._animationTime=Math.max(0,Math.min(a,this._animationDuration))}_wheel({deltaY:a}){this.enabled&&Math.abs(a)>.001&&(this._scrollAnimationState=-1*Math.sign(a))}_drag(a){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=a.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=a.delta.y*this._viewer.canvas.height/4)}_postFrame(){var a,e;if(!this._viewer)return;const t=this._viewer,n=this.animateOnScroll,i=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!n&&!i)return this._lastFrameTime=0,void(this._fadeDisabled&&((a=this._viewer.getPluginByType("FrameFade"))==null||a.enable(Fu.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const l=(0,g.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=l-1/30);let h=l-this._lastFrameTime;if(h*=this.animationSpeed,this._lastFrameTime=l,n&&i?h*=(0,g.absMax)(this._scrollAnimationState,this._dragAnimationState):n?h*=this._scrollAnimationState:i&&(h*=this._dragAnimationState),Math.abs(h)<1e-4)return;const d=(e=this._viewer.getPluginByType("Progressive"))==null?void 0:e.postFrameConvergedRecordingDelta();if(d&&d>0&&(h=d),d===0)return;const f=Math.abs(this.timeScale);this._animationTime+=h*(f>0?f:1)}const s=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const o=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(l=>{l.mixer.setTime(o)}),!(Math.abs(s)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:s,time:o}),t.scene.activeCamera.cameraObject.userData.__animatingCamera&&t.scene.activeCamera.setDirty(),t.scene.refreshActiveCameraNearFar(),t.renderer.resetShadows(),t.setDirty(),!this._fadeDisabled){const l=this._viewer.getPluginByType("FrameFade");l&&(l.disable(Fu.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[Yt],this._pointerDragHelper=new g.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=a=>{const e=a.object;if(e.assetType!=="model"||!e.modelObject||!this._viewer)return;let t=!1;e.modelObject.traverse(n=>{const i=n.animations;if(i.length<1)return;const s=Math.max(...i.map(h=>h.duration));(e.modelObject.userData.gltfAnim_SyncMaxDuration??this.syncMaxDuration)&&(i.forEach(h=>h.duration=s),e.modelObject.userData.gltfAnim_SyncMaxDuration=!0);const o=new u.Xcj(this._viewer.scene.modelRoot.modelObject),l=i.map(h=>o.clipAction(h).setLoop(this.loopAnimations?u.YKA:u.jAl,this.loopRepetitions));l.forEach(h=>h.clampWhenFinished=!0),this.animations.push({mixer:o,clips:i,actions:l,duration:s}),t=!0}),t&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new nE(e,this))}async onAdded(a){var e,t,n,i,s,o;(t=(e=a.getPlugin(Yt))==null?void 0:e.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),a.scene.addEventListener("addSceneObject",this._objectAdded),(o=(s=(i=(n=a.getPlugin(Yt))==null?void 0:n.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:s.extensions)==null||o.push(iE),a.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=a.canvas;let l=-1;return Object.defineProperty(a.scene.modelRoot,"currentTimelineMarker",{get:()=>l,set:h=>a.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[l=h]})}),a.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:h})=>{var d;if(!this._viewer)return;if(!h)return this._viewer.scene.activeCamera=(d=this._viewer)==null?void 0:d.scene.defaultCamera,void this._viewer.setDirty();const f=h.camera;f&&(f.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(f))}),super.onAdded(a)}async onRemove(a){for(var e,t;this.animations.length;)this.animations.pop();return a.scene.removeEventListener("addSceneObject",this._objectAdded),(t=(e=a.getPlugin(Yt))==null?void 0:e.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),a.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(a)}_onPropertyChange(a=!0){this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&a&&this.playAnimation()}onStateChange(){var a,e;(e=(a=this.uiConfig)==null?void 0:a.children)==null||e.map(t=>t&&(0,g.getOrCall)(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(a,e=!1){return this.playClips([a],e)}async playClips(a,e=!1){const t=[];return this.animations.forEach(({actions:n})=>{n.forEach(i=>{a.includes(i.getClip().name)&&t.push(i)})}),this.playAnimation(e,t)}async playAnimation(a=!1,e){var t;if(!this.enabled)return;let n=!1;this._animationState==="playing"&&(this.stopAnimation(!1),n=!0);let i=0;const s=!e;e||(e=[],this.animations.forEach(({mixer:l,actions:h,clips:d})=>{e.push(...h)})),n?this.resetAnimation():this.animationState!=="paused"&&(e.forEach(l=>{l.reset()}),this._animationTime=0);const o=Ys();this._lastAnimId=o;for(const l of e)l.setLoop(this.loopAnimations?u.YKA:u.jAl,this.loopRepetitions),l.play(),i=Math.max(i,l.getClip().duration/Math.abs(l.timeScale));if(this._animationState="playing",(t=this._viewer)==null||t.setDirty(),s){if(!isFinite(this._animationDuration))return;await new Promise((l,h)=>{const d=()=>{this.removeEventListener("checkpointEnd",d),l()};this.addEventListener("checkpointEnd",d)})}else{const l=this.loopAnimations?this.loopRepetitions:1;if(i*=l,!isFinite(i))return;await new Promise((h,d)=>{const f=v=>{v.time>=i&&(this.removeEventListener("animationStep",f),h())};this.addEventListener("animationStep",f)})}o===this._lastAnimId&&this.stopAnimation(a)}pauseAnimation(){var a;this._animationState==="playing"?(this._animationState="paused",(a=this._viewer)==null||a.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var a;this._animationState==="paused"?(this._animationState="playing",(a=this._viewer)==null||a.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(a=!1){var e,t;this._animationState="stopped",a?this.resetAnimation():(e=this._viewer)==null||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))==null||t.enable(Fu.PluginType),this._fadeDisabled=!1)}resetAnimation(){var a;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:t,clips:n})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(a=this._viewer)==null||a.setDirty()):this.stopAnimation(!0)}};hr.PluginType="GLTFAnimation",hr.AnimationMarkersExtension="WEBGI_animation_markers",ia([ke()],hr.prototype,"autoIncrementTime",void 0),ia([Jo()],hr.prototype,"animationState",null),ia([Jo()],hr.prototype,"animationTime",null),ia([Jo()],hr.prototype,"animationDuration",null),ia([(0,g.onChange2)(Fu.prototype._onPropertyChange),sn("Loop",{limitedUi:!0}),ke()],hr.prototype,"loopAnimations",void 0),ia([(0,g.onChange2)(Fu.prototype._onPropertyChange),ke()],hr.prototype,"loopRepetitions",void 0),ia([gn("Timescale",[-2,2],.01),ke()],hr.prototype,"timeScale",void 0),ia([gn("Speed",[.1,4],.1,{limitedUi:!0}),ke()],hr.prototype,"animationSpeed",void 0),ia([sn(),ke()],hr.prototype,"animateOnScroll",void 0),ia([sn(),ke()],hr.prototype,"animateOnDrag",void 0),ia([Eo("Drag Axis",[{label:"x"},{label:"y"}]),ke()],hr.prototype,"dragAxis",void 0),ia([sn(),ke()],hr.prototype,"autoplayOnLoad",void 0),ia([sn("syncMaxDuration(dev)"),ke()],hr.prototype,"syncMaxDuration",void 0),ia([(0,g.onChange)(Fu.prototype.onStateChange)],hr.prototype,"_animationState",void 0),ia([Bi("Play/Pause",a=>({label:()=>a.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],hr.prototype,"playPauseAnimation",null),ia([Bi("Stop",{limitedUi:!0})],hr.prototype,"stopAnimation",null),ia([Bi("Reset",{limitedUi:!0})],hr.prototype,"resetAnimation",null),hr=Fu=ia([Vn("GLTF Animations")],hr);class nE{constructor(e,t){this.parser=e,this.name=hr.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){let t=[];for(const v of this.parser.json.scenes||[]){if(!v.extensions)continue;const y=v.extensions[this.name];for(const w of(y==null?void 0:y.markers)||[]){const E=w.camera!==void 0?await this.parser.getDependency("camera",w.camera):void 0;w.time===void 0&&(w.time=w.frame/30,console.error("Update timeline markers plugin for correct times.")),t.push({name:w.name,frame:w.frame,time:w.time,camera:E})}}if(t.length<1)return;t=t.sort((v,y)=>v.frame-y.frame);const n=e.scene??e.scenes[0];if(!n)return;n.userData.__markers=t;const i=this.plugin.timelineMarkers,s=t.map(v=>v.time);let o=i.length;const l=t.map(v=>o++),h=Math.max(...s)+.01;i.push(...t);const d=new u.dUE(".currentTimelineMarker",s,l,2300),f=new u.m7l("animationTimelineMarker",h,[d]);f.__gltfExport=!1,e.animations.push(f)}}const iE=a=>({afterParse(e){const t=a.json.scenes[a.json.scene||0];t.extensions=t.extensions||{};const n={markers:[]},i=[];if((Array.isArray(e)?e:[e]).forEach(s=>s.traverse(o=>{o.userData.__markers&&i.push(...o.userData.__markers)})),i.sort((s,o)=>s.frame-o.frame),!(i.length<1)){for(const s of i){const o=s.camera;if(o){const l=a.nodeMap.get(o);if(l===void 0){console.warn("Camera not found in gltf export",o,a.nodeMap);continue}const h=a.json.nodes[l].camera;s.camera=h,n.markers.push(s)}}t.extensions[hr.AnimationMarkersExtension]=n,a.extensionsUsed[hr.AnimationMarkersExtension]=!0}}});var Ff=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,i_=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,pp=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,fp=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,ul=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Va extends vi{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,t,n,i=!1){super({vertexShader:ro,fragmentShader:`

${fp}
${Ff}
${_c}
${i_}
${n}

${pp}

varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!i},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new u.yGw},screenSize:{value:new u.FM8},cameraPositionWorld:{value:new u.Pa4},cameraNearFar:{value:new u.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:i?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(s,o,l)=>{var h;if(!s.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(h=this._target)==null?void 0:h.texture;const d=o.materialObject;let f=this.material.defines.SSGI_ENABLED;d.defines.SSGI_ENABLED!==f&&(d.defines.SSGI_ENABLED=f,d.needsUpdate=!0),f=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==f&&(this.materialExtension.extraUniforms.tSSGIMap.value=f,d.needsUpdate=!0);const v="vec3 totalDiffuse =";s.fragmentShader=s.fragmentShader.replace(v,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${v}`),s.fragmentShader=s.fragmentShader.replace("#include <aomap_fragment>",""),s.defines.USE_UV=""},onObjectRender:(s,o,l)=>{var h,d;const f=o.materialObject,v=!f.transparent&&f.transmission<.001,y=this.enabled&&v&&(this.renderWithCamera||this._renderer.frameCount>1)&&l.userData.screenSpaceRendering!==!1&&!((h=f.userData)!=null&&h.ssrtaoDisabled)&&!((d=f.userData)!=null&&d.ssaoDisabled)?1:0;f.defines.SSRTAO_ENABLED!==y&&(f.defines.SSRTAO_ENABLED=y,f.needsUpdate=!0)},parsFragmentSnippet:s=>{var o;return g.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${be("tSSGIMap",(o=this._target)==null?void 0:o.texture,s.capabilities.isWebGL2)}

            ${eg}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:s=>{var o,l,h,d;return this.enabled?"1":"0"+((l=(o=this._target)==null?void 0:o.texture)==null?void 0:l.colorSpace)+((d=(h=this._target)==null?void 0:h.texture)==null?void 0:d.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:s=>{var o;return!((o=s.materialObject.userData)!=null&&o.ssaoDisabled)&&s.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Sl(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=t,this.needsSwap=!0,this._giActivated=i,this.ssgiEnabled=i,this.bilateralPass=new as(this._target,n,"rgba")}render(e,t,n,i,s){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,s),this.smoothEnabled&&this.bilateralPass.render(e,t,n,i,s))}}ul([ke()],Va.prototype,"bilateralPass",void 0),ul([gn("Intensity",[0,4]),ke(),bt()],Va.prototype,"intensity",void 0),ul([gn("Power",[0,3]),ke(),bt()],Va.prototype,"power",void 0),ul([sn("Auto radius"),ke(),bt()],Va.prototype,"autoRadius",void 0),ul([gn("Object Radius",[.01,10]),ke(),bt()],Va.prototype,"objectRadius",void 0),ul([gn("Tolerance",[.1,5]),ke(),bt()],Va.prototype,"tolerance",void 0),ul([gn("Bias",[-.3,.3]),ke(),bt()],Va.prototype,"bias",void 0),ul([gn("Falloff",[1e-4,4]),ke(),bt()],Va.prototype,"falloff",void 0),ul([gn("Ray Count",[1,5],1),ke(),bt()],Va.prototype,"rayCount",void 0),ul([gn("Step count",[1,16],1),ke(),cn("RTAO_STEP_COUNT")],Va.prototype,"stepCount",void 0),ul([sn("Smooth Enabled"),ke()],Va.prototype,"smoothEnabled",void 0),ul([sn("Render with Camera")],Va.prototype,"renderWithCamera",void 0);class js extends $c{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[Yt,Ri,na],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){var t,n;await super.onAdded(e),this.enabled=this._initEnabled,(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}get enabled(){var e,t;return((t=(e=this.passes.ssrtgi)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssrtgi)!=null&&t.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,n;return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),(t=this._viewer)==null||t.getPluginByType("debug"),[tr(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Va(e.renderer,this._rtgiTarget,((n=e.getPlugin(Ri))==null?void 0:n.getUnpackSnippet())??"",!0),update:()=>{var i;const s=this.enabled;if(s){const o=(i=this._viewer)==null?void 0:i.getPluginByType("SSAO");o!=null&&o.enabled&&(o.enabled=!1)}s&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(Ri)])}},()=>[e.getPlugin(Ri),e.getPlugin(na),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var e,t,n,i;const s=((t=(e=this.passes.ssrtgi)==null?void 0:e.passObject)==null?void 0:t.uiConfig)??{};return(i=(n=s.children)==null?void 0:n.map(o=>(0,g.getOrCall)(o)))==null||i.flat(2).forEach(o=>o&&(o.onChange=this.setDirty)),s}}js.PluginType="SSGI";let zu=class extends $o{constructor(a,e,t){super(a,e,t??new oy,new er(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(a,e,t,n,i){this.enabled&&super.render(a,e,t,n,i)}};zu=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([Vn("High precision Normal Buffer")],zu);class oy extends u.RSm{constructor(){super()}onBeforeRender(e,t,n,i,s){let o=s.material;Array.isArray(o)&&(o=o[0]),this.normalMap=(o==null?void 0:o.normalMap)??null,this.bumpMap=(o==null?void 0:o.bumpMap)??null,this.bumpScale=o==null?void 0:o.bumpScale,o!=null&&o.normalScale&&this.normalScale.copy(o==null?void 0:o.normalScale),this.needsUpdate=!0,this.side=o.side??u.ehD}}class hl extends To{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:u.cLu,minFilter:u.TyD,magFilter:u.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,n=new Set,i=new Set;return new class extends zu{render(s,o,l,h,d){const f=s.getRenderTarget(),v=s.getActiveCubeFace(),y=s.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:w})=>{w&&((w.transparent&&w.userData.renderToDepth||!w.transparent&&w.transmission===0&&w.userData.renderToDepth===!1)&&(n.add(w),w.transparent=!w.transparent),Math.abs(w.transmission||0)>0&&w.userData.renderToDepth&&(i.add([w,w.transmission]),w.transmission=0))}),mi(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(s,o,t,h,d)),n.forEach(w=>w.transparent=!w.transparent),n.clear(),i.forEach(([w,E])=>w.transmission=E),i.clear(),s.setRenderTarget(f,v,y))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,n;return e.renderer.disposeTarget((n=(t=this._normalTarget)==null?void 0:t.dispose)==null?void 0:n.call(t)),super.onRemove(e)}updateShaderProperties(e){var t;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled?((t=this.getNormalBuffer())==null?void 0:t.texture)??null:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}hl.PluginType="NormalBufferPlugin";var mp=function(a,e){return mp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},mp(a,e)};function Vh(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=a}mp(a,e),a.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Gh,Hh=function(){function a(){}return a._xfnv1a=function(e){for(var t=2166136261,n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},a}(),cg=function(a){function e(t){var n=a.call(this)||this;return n.a=e._xfnv1a(t)(),n}return Vh(e,a),e.prototype.next=function(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},e}(Hh),Bb=function(a){function e(t){var n=a.call(this)||this,i=e._xfnv1a(t);return n.a=i(),n.b=i(),n.c=i(),n.d=i(),n}return Vh(e,a),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var t=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,t=t+this.d|0,this.c=this.c+t|0,(t>>>0)/4294967296},e}(Hh),r_=function(a){function e(t){var n=a.call(this)||this,i=e._xfnv1a(t);return n.a=i(),n.b=i(),n.c=i(),n.d=i(),n}return Vh(e,a),e.prototype.next=function(){var t=this.b<<9,n=5*this.a;return n=n<<7|9*(n>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(n>>>0)/4294967296},e}(Hh);(function(a){a.sfc32="sfc32",a.mulberry32="mulberry32",a.xoshiro128ss="xoshiro128ss"})(Gh||(Gh={}));var ug=function(){function a(e,t){t===void 0&&(t=Gh.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return a.prototype.next=function(){return this.generator.next()},a.prototype._initializeGenerator=function(){if(function(t){return t===null}(e=this.str)||function(t){return t===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new Bb(this.str);case"mulberry32":return new cg(this.str);case"xoshiro128ss":return new r_(this.str);default:return this.wrap()}},a.prototype.wrap=function(){return{next:function(){return Math.random()}}},a}(),hg=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class zf extends il{constructor(e,t,n,i){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new u.Pa4(10,10,10),normalDirection:new u.Pa4(.01,.98,.01).normalize(),direction:new u.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=n??{},this.randomParams=i??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,n=null){const i=new ug(e.toString()),s=new u.FM8(i.next()*Math.PI*2,Math.asin(2*i.next()-1));let o=new u.Pa4(Math.cos(s.x)*Math.cos(s.y),Math.sin(s.y),Math.sin(s.x)*Math.cos(s.y));const l=new u.FM8;for(let h=0;h<5;h++){l.set(i.next(),i.next()),o=s_(l,this._randomParams.normalDirection,.4),i.next()<Math.sqrt(t??this._randomParams.focus)&&(l.set(i.next(),i.next()),o=s_(l,this._randomParams.direction,Math.pow((n??this._randomParams.spread)/2,2)));const d=o.dot(this._randomParams.normalDirection);if(d>0&&d<.4)break}o.normalize(),o.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(o.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new u.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function s_(a,e,t){e=e.clone().normalize();const n=new u.Pa4(0,-e.z,e.y).normalize(),i=new u.Pa4().crossVectors(e,n).normalize(),s=a;s.x=2*s.x*Math.PI,s.y=1-s.y*t;const o=Math.sqrt(1-s.y*s.y);return n.multiplyScalar(Math.cos(s.x)*o).add(i.multiplyScalar(Math.sin(s.x)*o)).add(e.multiplyScalar(s.y))}hg([ke("shadowParams")],zf.prototype,"_shadowParams",void 0),hg([ke("randomParams")],zf.prototype,"_randomParams",void 0);var a_=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class ju extends Sn{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new zf("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var t,n;if(!this.enabled)return void(this.light.layers.mask=0);const i=((t=this._viewer)==null?void 0:t.renderer.frameCount)??0;this.light.randomizePosition(i<5?0:i),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(n=this._cameraHelper)==null||n.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new u.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,n;e?(t=this._viewer)==null||t.scene.setDirty():(n=this._viewer)==null||n.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}ju.PluginType="RandomizedDirectionalLight",a_([ke()],ju.prototype,"enabled",void 0),a_([ke("rdLight")],ju.prototype,"light",void 0),a_([ke()],ju.prototype,"lightLayers",void 0);var dg=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,Uo=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let No=class extends vi{constructor(a,e,t,n=!0){super({vertexShader:ro,fragmentShader:`

varying vec2 vUv;

${fp}
${Ff}
${_c}
${i_}
${t}

${pp}

${dg}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new u.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new u.yGw},cameraPositionWorld:{value:new u.Pa4},cameraNearFar:{value:new u.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:n?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(i,s,o)=>{var l,h,d;let f=this.enabled&&o.userData.screenSpaceRendering!==!1&&!((l=s.materialObject.userData)!=null&&l.ssreflDisabled)?1:0;if(s.materialObject.defines.SSR_ENABLED!==f&&(s.materialObject.defines.SSR_ENABLED=f,s.materialObject.needsUpdate=!0),!i.defines.SSR_ENABLED)return;f=this.material.defines.SSR_STEP_COUNT,s.materialObject.defines.SSR_STEP_COUNT!==f&&(s.materialObject.defines.SSR_STEP_COUNT=f,s.materialObject.needsUpdate=!0),f=this.material.defines.SSR_LOW_QUALITY_FRAMES,s.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==f&&(s.materialObject.defines.SSR_LOW_QUALITY_FRAMES=f,s.materialObject.needsUpdate=!0),f=this.material.defines.PERSPECTIVE_CAMERA,s.materialObject.defines.PERSPECTIVE_CAMERA!==f&&(s.materialObject.defines.PERSPECTIVE_CAMERA=f,s.materialObject.needsUpdate=!0),f=this.material.defines.SSR_INLINE,s.materialObject.defines.SSR_INLINE!==f&&(s.materialObject.defines.SSR_INLINE=f,s.materialObject.needsUpdate=!0),f=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,s.materialObject.defines.SSR_MASK_FRONT_RAYS!==f&&(s.materialObject.defines.SSR_MASK_FRONT_RAYS=f,s.materialObject.needsUpdate=!0),f=(h=s.materialObject.userData)!=null&&h.ssreflNonPhysical?"1":"0",s.materialObject.defines.SSR_NON_PHYSICAL!==f&&(s.materialObject.defines.SSR_NON_PHYSICAL=f,s.materialObject.needsUpdate=!0),f=((d=this._target)==null?void 0:d.texture)??null,this.materialExtension.extraUniforms.tSSRMap.value!==f&&(this.materialExtension.extraUniforms.tSSRMap.value=f,s.materialObject.needsUpdate=!0);const v="#glMarker beforeModulation";i.fragmentShader=i.fragmentShader.replace(v,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${v}`)},onObjectRender:(i,s,o)=>{var l;const h=this.enabled&&o.userData.screenSpaceRendering!==!1&&!((l=s.materialObject.userData)!=null&&l.ssreflDisabled)?1:0;s.materialObject.defines.SSR_ENABLED!==h&&(s.materialObject.defines.SSR_ENABLED=h,s.materialObject.needsUpdate=!0)},parsFragmentSnippet:(i,s)=>{var o,l;return!this.enabled||i.userData.screenSpaceRendering===!1||(o=s==null?void 0:s.materialObject.userData)!=null&&o.ssreflDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+be("tSSRMap",(l=this._target)==null?void 0:l.texture,i.capabilities.isWebGL2)+be("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,i.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${fp}
    
    #define THREE_PACKING_INCLUDED
    ${Ff}
    
    ${_c}
    ${i_}
    ${ga}
    
    ${pp}
    
    ${dg}
// #endif // SSR_INLINE
#endif
`:"")+`
${eg}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:i=>{var s,o,l;return this.enabled?"1":"0"+((o=(s=this._target)==null?void 0:s.texture)==null?void 0:o.colorSpace)+(this.enabled&&!((l=i.materialObject.userData)!=null&&l.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(h=>h+"").join(",")},isCompatible:i=>{var s;return!((s=i.materialObject.userData)!=null&&s.ssreflDisabled)&&i.isMeshStandardMaterial2}},this.intensity=1,this.boost=new u.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=a,this._target=e,this.needsSwap=!1,this._inline=n}render(a,e,t,n,i){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(a,this._target,t,n,i),this.needsSwap=!1}}};Uo([gn("Intensity",[0,4]),ke(),bt()],No.prototype,"intensity",void 0),Uo([Ks("Boost"),ke(),bt()],No.prototype,"boost",void 0),Uo([gn("Object Radius",[.01,2]),ke(),bt()],No.prototype,"objectRadius",void 0),Uo([sn("Auto radius"),ke(),bt()],No.prototype,"autoRadius",void 0),Uo([gn("Power",[0,3]),ke(),bt()],No.prototype,"power",void 0),Uo([gn("Tolerance",[.1,5]),ke(),bt()],No.prototype,"tolerance",void 0),Uo([gn("Step count",[1,32],1),ke(),cn("SSR_STEP_COUNT")],No.prototype,"stepCount",void 0),Uo([gn("Low Quality Frames",[0,4],1),ke(),cn("SSR_LOW_QUALITY_FRAMES")],No.prototype,"lowQualityFrames",void 0),Uo([sn("Ignore front rays"),ke(),cn("SSR_MASK_FRONT_RAYS")],No.prototype,"maskFrontRays",void 0),Uo([gn("Mask front rays factor",[-1,1],.01,a=>({hidden:()=>!a.maskFrontRays})),ke(),bt()],No.prototype,"maskFrontFactor",void 0),No=Uo([Vn("Screen Space Reflections")],No);class jf extends $c{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[Yt,Ri,na],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var e,t;return((t=(e=this.passes.ssr)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssr)!=null&&t.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,n;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}createPasses(e){var t;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[tr(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new No(e.renderer,this._ssrTarget,((t=e.getPlugin(Ri))==null?void 0:t.getUnpackSnippet())??"",this.inlineSSR)},()=>[e.getPlugin(Ri),e.getPlugin(na),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var e,t,n,i;const s=((t=(e=this.passes.ssr)==null?void 0:e.passObject)==null?void 0:t.uiConfig)??{};return(i=(n=s.children)==null?void 0:n.map(o=>(0,g.getOrCall)(o)))==null||i.flat(2).forEach(o=>o&&(o.onChange=this.setDirty)),s}}jf.PluginType="SSReflection";var o_=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let so=class extends Sn{makeAnisotropic(a){var e;const t=(e=a.materialObject)==null?void 0:e.userData;if(!t)return!1;if(t._isAnisotropic===void 0){const n=t.__appliedMeshes;let i=!0;if(n)for(const{geometry:s}of n)!s||s.index&&s.attributes.position&&s.attributes.normal&&s.attributes.uv||(i=!1),i&&!s.attributes.tangent&&s.computeTangents();if(!i)return!1}return t._isAnisotropic=!0,t._anisotropyFactor===void 0&&(t._anisotropyFactor=1),t._anisotropyNoise===void 0&&(t._anisotropyNoise=0),t._anisotropyDirectionMode===void 0&&(t._anisotropyDirectionMode="DIRECTION"),a.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new Lb(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Yt],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(a,e,t)=>{var n;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const i=(n=e.materialObject.userData)==null?void 0:n._anisotropyDirectionMap,s=g.glsl`
                //#if ANISOTROPY_ENABLED
                ${_c}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(i?be("anisotropyDirectionMap",i,t.capabilities.isWebGL2):"")+`
`;a.fragmentShader=_n(a.fragmentShader,"#include <common>",s,{append:!0}),a.fragmentShader=a.fragmentShader.replace("#include <lights_fragment_begin>",u.WdD.lights_fragment_begin),a.fragmentShader=_n(_n(a.fragmentShader,"IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let o=_n(u.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");o=_n(o,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),a.fragmentShader=_n(a.fragmentShader,"#include <lights_physical_pars_fragment>",o),a.fragmentShader=_n(a.fragmentShader,"#include <normal_fragment_begin>",u.WdD.normal_fragment_begin),a.fragmentShader=_n(a.fragmentShader,"#ifdef USE_NORMALMAP_TANGENTSPACE","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_TANGENT )");let l=g.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+u.WdD.lights_fragment_maps;l=_n(l,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),l=_n(l,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),a.fragmentShader=_n(a.fragmentShader,"#include <lights_fragment_maps>",l),a.defines.USE_UV="",a.vertexTangents=!0},onObjectRender:(a,e)=>{var t;const n=e.materialObject.userData;if(!(n!=null&&n._isAnisotropic))return;const i=a;if(!i.isMesh||!i.geometry)return;if(!i.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=n._anisotropyFactor,this._uniforms.anisotropyNoise.value=n._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=(t=n._anisotropyDirectionMap)!=null&&t.isTexture?n._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=n._anisotropyDirection;let s=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==s&&(e.materialObject.defines.ANISOTROPY_ENABLED=s,e.materialObject.needsUpdate=!0),s=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==s&&(e.materialObject.defines.ANISOTROPY_DEBUG=s,e.materialObject.needsUpdate=!0),s=n._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(s="CONSTANT"),s=s==="DIRECTION"?2:s==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==s&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t,n;return(this.enabled?"1":"0")+((e=a.materialObject.userData)!=null&&e._isAnisotropic?"1":"0")+((n=(t=a.materialObject.userData)==null?void 0:t._anisotropyDirectionMap)==null?void 0:n.uuid)},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>{var a;return[(a=this._viewer)==null?void 0:a.renderer]},getUiConfig:a=>{const e=this._viewer,t=this.makeAnisotropic,n={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return a.materialObject.userData._isAnisotropic||!1},set value(i){var s;i!==a.materialObject.userData._isAnisotropic&&(i?t(a)||e.alert("One or more geometries cannot be made anisotropic."):(a.materialObject.userData._isAnisotropic=!1,a.materialObject.needsUpdate=!0),(s=n.uiRefresh)==null||s.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(i=>({label:i})),onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}}]};return n}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this.makeSelectedAnisotropic=()=>{var a,e,t;const n=(t=(e=(a=this._viewer)==null?void 0:a.getPlugin(Ti))==null?void 0:e.getSelectedObject())==null?void 0:t.material;return(n==null?void 0:n.assetType)==="material"&&this.makeAnisotropic(n)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,n,i,s;await super.onAdded(a);const o=a.getPlugin(Yt);(e=o==null?void 0:o.materials)==null||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),(s=(i=(n=o==null?void 0:o.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null||s.push(rE)}async onRemove(a){var e,t,n,i;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=a.getPlugin(Yt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};so.PluginType="AnisotropyPlugin",so.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",o_([sn("Enabled",a=>({onChange:a.setDirty})),ke()],so.prototype,"enabled",void 0),o_([Bi("Make Anisotropy",a=>({hidden:()=>{var e;return!((e=a._viewer)!=null&&e.getPlugin(Ti))}}))],so.prototype,"makeSelectedAnisotropic",void 0),so=o_([Vn("Anisotropy Materials")],so);class Lb{constructor(e){this.parser=e,this.name=so.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=o.anisotropyFactor??0,t.userData._anisotropyNoise=o.anisotropyNoiseFactor??o.anisotropyNoise??0;let{anisotropyDirectionMode:l,anisotropyDirection:h}=o;return l||(l=o.anisotropyTextureMode),h||(h=o.anisotropyRotation),t.userData._anisotropyDirectionMode=l&&typeof(h==null?void 0:h.index)=="number"?l:"CONSTANT",l==="ROTATION"||l==="DIRECTION"?s.push(n.assignTexture(t.userData,"_anisotropyDirectionMap",h).then(d=>{d.colorSpace=u.KI_})):t.userData._anisotropyDirection=h??0,Promise.all(s)}afterRoot(e){var t;return(t=e.scene)==null||t.traverse(n=>{var i,s;if(!((s=(i=n.material)==null?void 0:i.userData)==null?void 0:s._isAnisotropic))return;const l=n.geometry;l.attributes.tangent||(l.computeTangents(),l.attributes.tangent.needsUpdate=!0)}),null}}const rE=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.anisotropyFactor=e.userData._anisotropyFactor||1,n.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,n.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&n.anisotropyDirectionMode!=="CONSTANT"){const i={index:a.processTexture(e.userData._anisotropyDirectionMap)};a.applyTextureTransform(i,e.userData._anisotropyDirectionMap),n.anisotropyDirection=i}else n.anisotropyDirectionMode="CONSTANT",n.anisotropyDirection=e.userData._anisotropyDirection||0;t.extensions[so.ANISOTROPY_GLTF_EXTENSION]=n,a.extensionsUsed[so.ANISOTROPY_GLTF_EXTENSION]=!0}});var l_,gp=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Fo=l_=class extends Sn{static AddFragmentClipping(a,e,t,n,i){var s;const o=(s=a.materialObject)==null?void 0:s.userData;if(!o)return!1;o._fragmentClippingExt||(o._fragmentClippingExt={});const l=o._fragmentClippingExt;return l.clipEnabled=!0,l.clipPosition===void 0&&(l.clipPosition=(e==null?void 0:e.toArray())??[0,0,0,0]),l.clipParams===void 0&&(l.clipParams=(t==null?void 0:t.toArray())??[1,0,0,0]),l.clipMode===void 0&&(l.clipMode=n??ra.Circle),l.clipInvert===void 0&&(l.clipInvert=i??!1),a.materialObject.isMaterial&&(a.needsUpdate=!0),!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new Vf(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Yt,Ri],this._plane=new u.JOQ,this._viewNormalMatrix=new u.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new u.Ltg},fragClippingParams:{value:new u.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._fragmentClippingExt)!=null&&t.clipEnabled)?eg+g.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${ra.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${ra.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${ra.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${ra.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${ra.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(a,e,t)=>{var n;this.enabled&&((n=e.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)&&(a.fragmentShader=_n(a.fragmentShader,"#glMarker mainStart",g.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${ra.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${ra.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${ra.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${ra.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${ra.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(a,e)=>{var t,n,i,s,o,l;let h=(t=e.materialObject.userData)==null?void 0:t._fragmentClippingExt;if(e.materialObject.userData.isGBufferMaterial&&a&&(h=(i=(n=a.material)==null?void 0:n.userData)==null?void 0:i._fragmentClippingExt),!(h!=null&&h.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(h.clipPosition),h.clipMode===ra.Plane){const f=(s=this._viewer)==null?void 0:s.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(h.clipParams[0],h.clipParams[1],h.clipParams[2]),this._plane.constant=h.clipParams[3],this._viewNormalMatrix.getNormalMatrix(f),this._plane.applyMatrix4(f,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(h.clipParams);((o=this._viewer)==null?void 0:o.scene.activeCamera.cameraObject)instanceof u.cPb?this._uniforms.fragClippingCamAspect.value=(l=this._viewer)==null?void 0:l.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let d=this.enabled?1:0;d=+this._defines.FRAG_CLIPPING_DEBUG,e.materialObject.defines.FRAG_CLIPPING_DEBUG!==d&&(e.materialObject.defines.FRAG_CLIPPING_DEBUG=d,e.materialObject.needsUpdate=!0),d=+h.clipMode,e.materialObject.defines.FRAG_CLIPPING_MODE!==d&&(e.materialObject.defines.FRAG_CLIPPING_MODE=d,e.materialObject.needsUpdate=!0),d=+h.clipInvert,e.materialObject.defines.FRAG_CLIPPING_INVERSE!==d&&(e.materialObject.defines.FRAG_CLIPPING_INVERSE=d,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._fragmentClippingExt)!=null&&t.clipEnabled?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2||a.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var n;return((n=a.materialObject.userData._fragmentClippingExt)==null?void 0:n.clipEnabled)||!1},setValue:n=>{var i,s;n!==((i=a.materialObject.userData._fragmentClippingExt)==null?void 0:i.clipEnabled)&&(n?l_.AddFragmentClipping(a.materialObject)||e.alert("Cannot add fragment clipping extension."):a.materialObject.userData._fragmentClippingExt&&(a.materialObject.userData._fragmentClippingExt.clipEnabled=!1,a.materialObject.needsUpdate=!0),(s=t.uiRefresh)==null||s.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(ra).map(n=>({label:n[0],value:n[1]})),hidden:()=>{var n;return!((n=a.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",bounds:[-1,1],hidden:()=>{var n;return!((n=a.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var n;return!((n=a.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,n,i,s,o,l;await super.onAdded(a);const h=a.getPlugin(Yt);(e=h==null?void 0:h.materials)==null||e.registerMaterialExtension(this.materialExtension),(t=h==null?void 0:h.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),(s=(i=(n=h==null?void 0:h.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null||s.push(Ob),(l=(o=a.getPlugin(Ri))==null?void 0:o.material)==null||l.registerMaterialExtensions([this.materialExtension])}async onRemove(a){var e,t,n,i;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=a.getPlugin(Yt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};var ra;Fo.PluginType="FragmentClippingExtensionPlugin1",Fo.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",gp([sn("Enabled",a=>({onChange:a.setDirty})),ke()],Fo.prototype,"enabled",void 0),Fo=l_=gp([Vn("FragmentClipping Materials")],Fo),function(a){a[a.Circle=0]="Circle",a[a.Ellipse=1]="Ellipse",a[a.Rectangle=2]="Rectangle",a[a.Plane=3]="Plane",a[a.Sphere=4]="Sphere"}(ra||(ra={}));class Vf{constructor(e){this.parser=e,this.name=Fo.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Fo.AddFragmentClipping(t),t.userData._fragmentClippingExt=Yi(i,t.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const Ob=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._fragmentClippingExt||!e.userData._fragmentClippingExt.clipEnabled)return;t.extensions=t.extensions||{};const n=Fi(e.userData._fragmentClippingExt,!1);t.extensions[Fo.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=n,a.extensionsUsed[Fo.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var Gf,Qh=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ga=Gf=class extends Sn{constructor(a=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new u.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=a,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var a,e,t;if(!this._viewer)return;const n=this._viewer.scene.background;if(this.enabled&&n!==this._viewer.scene.environment&&n!=="environment")if(n&&n.isDataTexture)n.mapping=u.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const o=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");o?(o.envmapBg=!0,(e=(a=o.uiConfig).uiRefresh)==null||e.call(a,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const i=(t=this._viewer.renderer.rendererObject.background.getBoxMesh2())==null?void 0:t.material,s=(i==null?void 0:i.uniforms)??u.Vj0.backgroundCube.uniforms;s.tripodHeight||(s.tripodHeight={value:1}),s.worldRadius||(s.worldRadius={value:1}),s.originPosition||(s.originPosition={value:new u.Pa4}),s.tripodHeight.value=this.tripodHeight,s.worldRadius.value=this.worldRadius,s.originPosition.value.copy(this.originPosition),i&&(!this.enabled&&i.defines.HDRi_GROUND_PROJ?delete i.defines.HDRi_GROUND_PROJ:this.enabled&&(i.defines.HDRi_GROUND_PROJ="1"),i.needsUpdate=!0),this._viewer.setDirty()}async onAdded(a){var e,t,n;await super.onAdded(a),(n=(t=(e=this._viewer)==null?void 0:e.renderer)==null?void 0:t.rendererObject)!=null&&n.background.getBoxMesh()&&a.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),u.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(u.Vj0.backgroundCube.fragmentShader=_n(u.Vj0.backgroundCube.fragmentShader,"void main() {",`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,{prepend:!0}),u.Vj0.backgroundCube.fragmentShader=_n(u.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),a.scene.addEventListener("environmentChanged",this._paramsChanged)}};Ga.PluginType="HDRiGroundPlugin",Qh([ke(),(0,g.onChange)(Gf.prototype._paramsChanged),sn("Enabled")],Ga.prototype,"enabled",void 0),Qh([ke(),(0,g.onChange)(Gf.prototype._paramsChanged),gn("World Radius",[1,1e3],.01)],Ga.prototype,"worldRadius",void 0),Qh([ke(),(0,g.onChange)(Gf.prototype._paramsChanged),gn("Tripod height",[0,50],.01)],Ga.prototype,"tripodHeight",void 0),Qh([ke(),(0,g.onChange)(Gf.prototype._paramsChanged),Ks("Origin Position",void 0,.001,a=>({onChange:a._paramsChanged}))],Ga.prototype,"originPosition",void 0),Ga=Gf=Qh([Vn("HDRi Ground")],Ga);var Ac,Wh=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ea=Ac=class extends Sn{constructor(a=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[Ri,Yt],this.materialExtension={shaderExtender:(e,t,n)=>{if(!e.defines.SSCS_ENABLED)return;const i=g.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,s=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${fp}
    
    #define THREE_PACKING_INCLUDED
    ${Ff}
    
    ${ga}
    ${_c}
    
    ${pp}

#endif
            
            `+u.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${i}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",s),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",u.WdD.lights_fragment_begin),e.fragmentShader=_n(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=_n(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,n)=>{var i;const s=t.materialObject;let o=this.enabled&&n.userData.screenSpaceRendering!==!1&&!((i=s.userData)!=null&&i.sscsDisabled)?1:0;s.defines.SSCS_ENABLED!==o&&(s.defines.SSCS_ENABLED=o,s.needsUpdate=!0),o=this._defines.SSCS_STEP_COUNT,s.defines.SSCS_STEP_COUNT!==o&&(s.defines.SSCS_STEP_COUNT=o,s.needsUpdate=!0),o=+this._defines.SSCS_DEBUG,s.defines.SSCS_DEBUG!==o&&(s.defines.SSCS_DEBUG=o,s.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...Ac._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,n,i,s;return[(e=this._viewer)==null?void 0:e.getPlugin(Ri),(t=this._viewer)==null?void 0:t.getPlugin(na),(n=this._viewer)==null?void 0:n.scene.renderCamera,(i=this._viewer)==null?void 0:i.renderer,(s=this._viewer)==null?void 0:s.scene]}},this.enabled=a,this.userData={setDirty:()=>{var e;(e=this._viewer)==null||e.setDirty()}}}async onAdded(a){var e,t;await super.onAdded(a),(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension)}async onRemove(a){var e,t;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),super.onRemove(a)}};Ea.PluginType="SSContactShadows",Ea._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new u.yGw},cameraPositionWorld:{value:new u.Pa4},cameraNearFar:{value:new u.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},Wh([sn("Enabled"),ke()],Ea.prototype,"enabled",void 0),Wh([bt({uniforms:Ac._uniforms,propKey:"sscsRadius"}),gn("Radius",[1e-4,.1],1e-4),ke()],Ea.prototype,"radius",void 0),Wh([bt({uniforms:Ac._uniforms,propKey:"sscsIntensity"}),gn("Intensity",[1e-4,1],1e-4),ke()],Ea.prototype,"intensity",void 0),Wh([bt({uniforms:Ac._uniforms,propKey:"sscsTolerance"}),gn("Tolerance",[.1,5]),ke()],Ea.prototype,"tolerance",void 0),Wh([cn("SSCS_DEBUG",void 0,!0),sn("Debug only SSCS"),ke()],Ea.prototype,"onlySSCSDebug",void 0),Wh([cn("SSCS_STEP_COUNT",void 0,!0),gn("Step count",[1,8],1),ke()],Ea.prototype,"stepCount",void 0),Ea=Ac=Wh([Vn("Screen Space Contact Shadows")],Ea);class Hf{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new u.xsS,this._mesh=new u.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new kb}dispose(){var e;(e=this._mesh.geometry)==null||e.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach(t=>{var n;return(n=this._normalsCache[t])==null?void 0:n.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(e=>e.dispose())}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}captureNormalMap(e,t,n=512){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const i=t==null?void 0:t.split(";").find(l=>this._normalsCache[l]);if(i){const l=this._normalsCache[i];return t==null||t.split(";").forEach(h=>h!==i&&(this._normalsCache[h]=l)),l.width!==n&&console.warn("last cacheKey normalMapRes mismatch, check model",n),e.userData._normalsCaptureMap=l,!1}const s=this._renderer.createTargetCustom({width:n,height:n},{minFilter:u.TyD,magFilter:u.TyD,generateMipmaps:!1,type:u.cLu},u.oAp);if(s.attachedGeometries=[],s.autoDispose=Hf.AutoDisposeTargets,!s)throw"Unable to create render target";const o=()=>{const l=new u._am(1e-4,100,s);this._scene.add(l);const h=e.userData.normalsCaptureOffsets;h.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(h.center),h.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(h.offsetMatrixInv),h.radius!==void 0&&(this._mesh.material.uniforms.radius.value=h.radius),this._mesh.geometry=e,l.update(this._renderer.rendererObject,this._scene),this._scene.remove(l),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=s};return o(),this._renderer.addEventListener("contextRestored",o),s.attachedGeometries.push(e),e.addEventListener("dispose",()=>{var l;s.attachedGeometries=((l=s.attachedGeometries)==null?void 0:l.filter(h=>h!==e))??[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",o),s.autoDispose&&!s.attachedGeometries.length&&s.dispose()}),t==null||t.split(";").forEach(l=>this._normalsCache[l]=s),s.addEventListener("dispose",()=>{t==null||t.split(";").forEach(l=>delete this._normalsCache[l]),this._renderer.removeEventListener("contextRestored",o),delete e.userData._normalsCaptureMap}),!0}}Hf.AutoDisposeTargets=!0;class kb extends u.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:u.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new u.yGw().identity()},offsetCenter:{value:new u.Pa4}}})}}var pg=__webpackgi_require__2(654);function Qf(a){const e=new u.Pa4(0,0,0),t=new u.Pa4(0,0,0),n=new u.Pa4(0,0,0),i=new u.Pa4(0,0,0),s=a.getAttribute("position"),o=a.index;if(o)for(let y=Math.max(0,a.drawRange.start),w=Math.min(o.count,a.drawRange.start+a.drawRange.count)-1;y<w/3;y+=3){const E=o.getX(y),M=o.getX(y+1),P=o.getX(y+2);t.set(s.getX(E),s.getY(E),s.getZ(E)),n.set(s.getX(M),s.getY(M),s.getZ(M)),i.set(s.getX(P),s.getY(P),s.getZ(P)),n.sub(t),i.sub(t),i.cross(n),i.normalize(),e.add(i)}else for(let y=0;y<s.count;y+=3)t.set(s.getX(y),s.getY(y),s.getZ(y)),n.set(s.getX(y+1),s.getY(y+1),s.getZ(y+1)),i.set(s.getX(y+2),s.getY(y+2),s.getZ(y+2)),n.sub(t),i.sub(t),i.cross(n),i.normalize(),e.add(i);e.normalize();let l=!1,h=0;for(;!l;){const y=h/3,w=o?o.getX(y):y,E=o?o.getX(y+1):y+1;t.set(s.getX(w),s.getY(w),s.getZ(w)),n.set(s.getX(E),s.getY(E),s.getZ(E)),t.sub(n),t.normalize();const M=e.dot(t);Math.abs(M-1)>.001&&t.length()>.5&&(l=!0),h+=3}n.crossVectors(t,e),n.normalize(),t.crossVectors(e,n),t.normalize();const d=new u.yGw;d.elements[0]=t.x,d.elements[1]=t.y,d.elements[2]=t.z,d.elements[3]=0,d.elements[4]=e.x,d.elements[5]=e.y,d.elements[6]=e.z,d.elements[7]=0,d.elements[8]=n.x,d.elements[9]=n.y,d.elements[10]=n.z,d.elements[11]=0,d.elements[12]=0,d.elements[13]=0,d.elements[14]=0,d.elements[15]=1,a.computeBoundingSphere();const f=a.boundingSphere.radius,v=new u.yGw().makeScale(f,f,f);return d.multiply(v),d}function Ub(a,e,t){const n=new u.Pa4().copy(a),i=new u.Pa4().copy(e),s=new u.Pa4().copy(t);return n.dot(i.cross(s))/6}function ao(a,e,t){const n=new u.Pa4().copy(a),i=new u.Pa4().copy(e),s=new u.Pa4().copy(t);return i.sub(n),s.sub(n),s.cross(i),.5*s.length()}function ly(a){const e=a.getAttribute("position"),t=a.getAttribute("normal");if(e.count/3>500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",e.count/3),Qf(a);const n=new u.Pa4(0,0,0),i=new u.Pa4(0,0,0),s=new u.Pa4(0,0,0),o=a.index,l=[];if(o)for(let L=Math.max(0,a.drawRange.start),R=Math.min(o.count,a.drawRange.start+a.drawRange.count)-1;L<R;L+=3){const I=o.getX(L),N=o.getX(L+1),j=o.getX(L+2);n.set(e.getX(I),e.getY(I),e.getZ(I)),i.set(e.getX(N),e.getY(N),e.getZ(N)),s.set(e.getX(j),e.getY(j),e.getZ(j)),l.push(n.toArray(),i.toArray(),s.toArray())}else for(let L=0;L<e.count;L++)n.set(e.getX(L),e.getY(L),e.getZ(L)),l.push(n.toArray());const h=function(L,R){const I=new u.Pa4;for(let ve=0;ve<L.length;ve+=3)I.x+=L[ve],I.y+=L[ve+1],I.z+=L[ve+2];I.multiplyScalar(1/(L.length/3));const N=new u.Pa4,j=new u.Pa4,H=new u.Pa4,X=new u.Pa4,ne=new u.Pa4;let pe=0,Ae=0;for(let ve=0;ve<R.length;ve+=3){N.set(R[ve][0],R[ve][1],R[ve][2]),j.set(R[ve+1][0],R[ve+1][1],R[ve+1][2]),H.set(R[ve+2][0],R[ve+2][1],R[ve+2][2]),ne.copy(N).add(j).add(H);const Ee=ao(N,j,H);ne.multiplyScalar(Ee/3),X.add(ne),pe+=Ee,Ae+=Ub(N,j,H)}return X.multiplyScalar(1/pe),{centre:I,com:X,volume:Ae,area:pe}}(e.array,l);if(h.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let L=0;L<t.count;L++)t.setX(L,-t.getX(L)),t.setY(L,-t.getY(L)),t.setZ(L,-t.getZ(L));t.needsUpdate=!0}const d=[];for(let L=0;L<e.array.length;L+=3)d.push([e.array[L],e.array[L+1],e.array[L+2]]);const f=console.log;console.log=()=>{};const v=(0,pg.getEigenVectors)(d);console.log=f;const y=new u.yGw;y.elements[0]=v[0].vector[0],y.elements[1]=v[0].vector[1],y.elements[2]=v[0].vector[2],y.elements[3]=0,y.elements[4]=v[1].vector[0],y.elements[5]=v[1].vector[1],y.elements[6]=v[1].vector[2],y.elements[7]=0,y.elements[8]=v[2].vector[0],y.elements[9]=v[2].vector[1],y.elements[10]=v[2].vector[2],y.elements[11]=0,y.elements[12]=0,y.elements[13]=0,y.elements[14]=0,y.elements[15]=1;const w=new u.Pa4;w.copy(h.com).sub(h.centre),w.normalize();const E=new u.Pa4(v[2].vector[0],v[2].vector[1],v[2].vector[2]);w.dot(E)<0&&(y.elements[4]=-v[1].vector[0],y.elements[5]=-v[1].vector[1],y.elements[6]=-v[1].vector[2],y.elements[8]=-v[2].vector[0],y.elements[9]=-v[2].vector[1],y.elements[10]=-v[2].vector[2]),a.computeBoundingSphere();const M=a.boundingSphere.radius,P=new u.yGw().makeScale(M,M,M);return y.multiply(P),y}const cy={...Fm,color:new er(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new u.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var Sa=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Gi extends u.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,n,i,s){var o,l;super.onBeforeRender(e,t,n,i,s),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((o=this.envMap)==null?void 0:o.rotation)||0)+this.envMapRotationOffset,this.extraUniformsToUpload.inverseModelMatrix.value.copy(s.matrixWorld).invert();const h=i.userData.normalsCaptureOffsets;h&&(this.extraUniformsToUpload.centerOffset.value.fromArray(h.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(h.offsetMatrix).premultiply(s.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=h.radius);const d=(l=i.userData._normalsCaptureMap)==null?void 0:l.texture;this.normalsCaptureMap!==d&&(this.normalsCaptureMap=d),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:s})}onAfterRender(e,t,n,i,s){super.onAfterRender(e,t,n,i,s),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:s})}constructor(e){super({side:u.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;
#ifdef USE_INSTANCING
uniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#endif
void main(){
#ifdef USE_INSTANCING
vWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;
#else
vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#endif
#include <beginnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef USE_INSTANCING
vModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);
#endif
}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;
#ifdef USE_INSTANCING
varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv
#else
uniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;
#define MODEL_OFFSET_MATRIX  modelOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv
#endif
#define CENTER_OFFSET  (centerOffset) 
uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(MODEL_OFFSET_MATRIX)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new u.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new u.Pa4(1,1,1)}}}),this.typeSlug=Gi.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new er(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new u.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new u.yGw().identity()},radius:{value:1},centerOffset:{value:new u.Pa4(0,0,0)},modelOffsetMatrix:{value:new u.yGw().identity()},modelOffsetMatrixInv:{value:new u.yGw().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=fs.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...fs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){fs.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+fs.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){var e;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=(e=this.uniforms.envMap.value)!=null&&e.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){return this.__envMap[this.envMapIndex]??this.__envMap[0]??null}set envMap(e){console.error("Setting separate envmap for indivisual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const t={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.envMapIndex=this.envMapIndex,t.envMapRotationOffset=this.envMapRotationOffset,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=Gi.TYPE,t.userData={},xs(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(t=>({label:"env"+(t+1),value:t}))},...Sl(this),{type:"input",label:"Mesh count",get value(){var t,n;return((n=(t=e.userData)==null?void 0:t.__appliedMeshes)==null?void 0:n.size)??0},set value(t){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(t){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{const t=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,g.downloadBlob)(t,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(t=>{var n;return(n=t.getUiConfig)==null?void 0:n.call(t,this)})].filter(t=>t),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Gi.TYPE)return console.warn("Material type is not supported",e),this;const t={},n=Array.from(Object.keys(cy));(0,g.copyProps)(e,t,n);const i=t.userData;return delete t.userData,this.setValues(t),xs(this.userData,i),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}Gi.TypeSlug="dmat",Gi.TYPE="DiamondMaterial",Sa([lc("Color",{limitedUi:!0}),bt()],Gi.prototype,"color",void 0),Sa([gn("Env Intensity",[0,5],.01,{limitedUi:!0}),bt()],Gi.prototype,"envMapIntensity",void 0),Sa([gn("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,g.onChange2)(Gi.prototype.setDirty)],Gi.prototype,"envMapRotationOffset",void 0),Sa([gn("Dispersion",[0,.1],1e-4,{limitedUi:!0}),bt({propKey:"rIndexDelta"})],Gi.prototype,"dispersion",void 0),Sa([gn("Absorption",[0,15],.01,{limitedUi:!0}),bt()],Gi.prototype,"absorptionFactor",void 0),Sa([gn("Refractive Index",[0,4],.01,{limitedUi:!0}),bt()],Gi.prototype,"refractiveIndex",void 0),Sa([bt()],Gi.prototype,"squashFactor",void 0),Sa([bt()],Gi.prototype,"geometryFactor",void 0),Sa([gn("Gamma",[.1,4],.01,{limitedUi:!0}),bt()],Gi.prototype,"gammaFactor",void 0),Sa([Ks("RGB Boost",void 0,void 0,{limitedUi:!0}),bt()],Gi.prototype,"boostFactors",void 0),Sa([gn("Transmission",[0,1],.01,{limitedUi:!0}),bt()],Gi.prototype,"transmission",void 0),Sa([gn("Reflectivity",[0,2],.01,{limitedUi:!0}),bt()],Gi.prototype,"reflectivity",void 0),Sa([cn("RAY_BOUNCES",void 0,!0),gn("Ray Bounces",[1,16],1)],Gi.prototype,"rayBounces",void 0),Sa([cn("DIA_ORIENT_ENVMAP",void 0,!0),gn("Diamond Oriented Lighting",[0,1],1)],Gi.prototype,"diamondOrientedEnvMap",void 0),Sa([bt({propKey:"tCubeMapNormals"})],Gi.prototype,"normalsCaptureMap",void 0),Sa([(0,g.onChange)(Gi.prototype.refreshEnvUniform)],Gi.prototype,"envMapIndex",void 0);var vp=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Zi extends Sn{get envMapRotation(){var e;return((e=this.envMap)==null?void 0:e.rotation)??0}set envMapRotation(e){var t;const n=[this.envMap,this.envMap2,this.envMap3];for(const i of n)i&&(i.rotation=e,(t=this._viewer)==null||t.scene.setDirty())}refreshEnvMaps(){var e,t,n;if(!this._viewer)return;const i=this.getEnvMaps(),s=((t=(e=this._viewer.getPlugin(Yt))==null?void 0:e.materials)==null?void 0:t.getMaterialsOfType(Gi.TypeSlug))||[];for(const o of s)o&&(o.envMaps=i);(n=this._viewer)==null||n.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var e;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const t=((e=this._viewer)==null?void 0:e.scene.getEnvironment())||null;return[t,t,t]},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const n=[];return e.modelObject.traverse(i=>{var s,o,l,h;const d=(o=(s=i.userData)==null?void 0:s.gltfExtensions)==null?void 0:o[Zi.DIAMOND_GLTF_EXTENSION];d&&i.geometry&&(this.prepareDiamondMesh(i,d),delete i.userData.gltfExtensions[Zi.DIAMOND_GLTF_EXTENSION]),i.material&&!n.includes(i.material)&&((h=(l=i.material.userData)==null?void 0:l.gltfExtensions)!=null&&h[Zi.DIAMOND_GLTF_EXTENSION])&&(i.material.materialObject||console.warn("material not processed",i.material),n.push(i.material))}),n.forEach(i=>{const s=i.userData.gltfExtensions[Zi.DIAMOND_GLTF_EXTENSION];s&&this._convertToDiamondMaterial(i,s)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var e,t,n;const i=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return!!Array.isArray(i)||(i==null?void 0:i.typeSlug)!==Os.TypeSlug},value:async()=>{var e,t,n,i,s,o;const l=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();if(!(l!=null&&l.material))return;const h=await((n=this._viewer)==null?void 0:n.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let d=parseInt(await((i=this._viewer)==null?void 0:i.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(d)||(d=512),d<64&&(d=64),((s=l.material.userData)==null?void 0:s.__appliedMeshes.size)>1&&await((o=this._viewer)==null?void 0:o.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(l.material,{cacheKey:h||void 0,normalMapRes:d},{}):this.makeDiamondMesh(l,{cacheKey:h||void 0,normalMapRes:d},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,t,n;const i=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return!!Array.isArray(i)||(i==null?void 0:i.typeSlug)!==Gi.TypeSlug},value:async()=>{var e,t,n,i,s,o,l,h;const d=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject(),f=d==null?void 0:d.material;if(!f)return;const v=f.userData._baseMaterial;let y=(s=(i=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:i.materials)==null?void 0:s.findMaterial(v);if(y&&!y.isDiamondMaterial||(y=(o=this._viewer)==null?void 0:o.createPhysicalMaterial({color:f.color})),y){const w=f.userData.__appliedMeshes.size>1&&await((l=this._viewer)==null?void 0:l.confirm("Convert all with this material?"))?Array.from(f.userData.__appliedMeshes):[d];for(const E of w)(h=E==null?void 0:E.setMaterial)==null||h.call(E,y)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var e,t,n,i;const s=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return!!Array.isArray(s)||(s==null?void 0:s.typeSlug)!==Gi.TypeSlug||((i=s.userData.__appliedMeshes)==null?void 0:i.size)<2},value:async()=>{var e,t;const n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();if(!n)return;const i=n.material;i&&!Array.isArray(i)&&pu(i)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var e,t,n;(e=this._viewer)==null||e.setDirty(),(n=(t=this.uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0)}async onAdded(e){var t,n,i,s,o,l,h;this._normalCapture=new Hf(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",y=>{var w,E,M,P;if((w=y.material)!=null&&w.isDiamondMaterial){const L=y.material,R=y.mesh||y.object;if(R.geometry&&!((E=this._normalCapture)!=null&&E.hasCapturedNormalMap(R))){const N=((P=(M=L==null?void 0:L.userData)==null?void 0:M.gltfExtensions)==null?void 0:P[Zi.DIAMOND_GLTF_EXTENSION])??{};N.cacheKey===void 0&&!R.userData._diamondCacheKey&&(L!=null&&L.name)&&(N.cacheKey=L.name),this.prepareDiamondMesh(R,N)}const I=this.getEnvMaps();L.envMaps=I}}),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const d=e.getPlugin(Yt);(t=d==null?void 0:d.importer)==null||t.processors.add("model",this._modelProcessor),(n=e.getPlugin(Ti))==null||n.addEventListener("selectedObjectChanged",this.refreshUi);const f=this.getEnvMaps,v=new yr(class extends Ar{async loadAsync(y,w){var E;const M=await super.loadAsync(y,w);return M.type===Gi.TYPE||M.isDiamondMaterialParameters?(M.envMap=f(),(E=d==null?void 0:d.materials)==null?void 0:E.generateFromTemplate("diamond",M)):(console.error("Invalid material type for Diamond Material.",M),null)}},[Gi.TypeSlug],!1);return(i=d==null?void 0:d.importer)==null||i.Importers.push(v),(l=(o=(s=d==null?void 0:d.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||l.push(Nb),(h=d==null?void 0:d.materials)==null||h.registerMaterialTemplate({name:"diamond",materialType:Gi.TYPE,isDiamondMaterialParameters:!0,generator:(y,w)=>{const E=!(w!=null&&w.metadata||!w.isDiamondMaterialParameters)||(w==null?void 0:w.metadata)&&(w==null?void 0:w.metadata.version)<=4.5,M=w==null?void 0:w.color;E&&typeof w.color=="number"&&(w.color=new er().setHex(w.color,u.GUF).getHex());const P=new Gi(y);return P.envMaps=this.getEnvMaps(),w&&P.copyProps(w),w.color=M,P}}),super.onAdded(e)}async onRemove(e){var t,n,i,s;return(t=this._normalCapture)==null||t.dispose(),this._normalCapture=void 0,this.offsetCache={},(i=(n=e.getPlugin(Yt))==null?void 0:n.importer)==null||i.processors.remove("model",this._modelProcessor),(s=e.getPlugin(Ti))==null||s.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:n}){var i,s;e.userData._diamondCacheKey=t??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=n??e.userData._diamondNormalMapRes,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const o=((i=this._normalCapture)==null?void 0:i.captureNormalMap(e.geometry,t,n))??[void 0,!1],l=(s=this._viewer)==null?void 0:s.getPluginByType("debug");l&&o&&(l.counters.normalsCapture||(l.counters.normalsCapture=0),l.counters.normalsCapture++,console.log("DEBUG: new normal map captured",l.counters.normalsCapture,t),l.addTexture("normal"+l.counters.normalsCapture,()=>{var h,d;return(d=(h=e.geometry)==null?void 0:h.userData._normalsCaptureMap)==null?void 0:d.texture},[40,110*l.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,n){var i;Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(s=>{s!=null&&s.isMesh&&s.geometry&&this.prepareDiamondMesh(s,t)}),this._convertToDiamondMaterial(e,n),(i=this._viewer)==null||i.setDirty()}makeDiamondMesh(e,t,n){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const i=Array.isArray(e.material)?e.material[0]:e.material,s=this._convertToDiamondMaterial(i,n,!1);e.setMaterial(s)}_convertToDiamondMaterial(e,t={isDiamond:!0},n=!0){var i,s,o;let l={...t??{}};l.isDiamond||l.isDiamondMaterialParameters?Array.isArray(l.boostFactors)&&(l.boostFactors=new u.Pa4().fromArray(l.boostFactors)):l={isDiamondMaterialParameters:!0},l.color=l.color??(e==null?void 0:e.color)??new er(1,1,1),l.name=l.name??(e==null?void 0:e.name)??"diamond";const h=(o=(s=(i=this._viewer)==null?void 0:i.getManager())==null?void 0:s.materials)==null?void 0:o.generateFromTemplate("diamond",l);if(h&&e&&!e.isDiamondMaterial&&(h.userData._baseMaterial=e.uuid),n){const d=f=>f.setMaterial??(v=>{f.material=v.materialObject});Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(f=>{d(f)(h),this.prepareDiamondMesh(f,t)})}return h}_computeOffsets(e,t,n=!1){if(e.userData.normalsCaptureOffsets){if((0,g.getUrlQueryParam)("recomputeOffsets")===null)return e.userData.normalsCaptureOffsets;console.warn("recomputeOffsets",e.userData.normalsCaptureOffsets)}e.computeBoundingBox();const i=e.boundingBox.getCenter(new u.Pa4).toArray(),s=ly(e).toArray(),o=new u.yGw().fromArray(s).invert(),l=new u.Pa4().fromArray(i).applyMatrix4(o).toArray(),h={center:i,offsetMatrix:s,offsetMatrixInv:o.toArray(),radius:1,centerOffset:l};return e.userData.normalsCaptureOffsets=h,(0,g.getUrlQueryParam)("recomputeOffsets")!==null&&console.warn("recomputeOffsets",h),h}disposeCacheMap(e){var t;(t=this._normalCapture)==null||t.disposeTarget(e)}disposeAllCacheMaps(){var e;(e=this._normalCapture)==null||e.disposeAllTargets()}}Zi.PluginType="Diamond",Zi.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",vp([(0,g.onChange)(Zi.prototype.refreshEnvMaps),ke()],Zi.prototype,"envMap",void 0),vp([(0,g.onChange)(Zi.prototype.refreshEnvMaps),ke()],Zi.prototype,"envMap2",void 0),vp([(0,g.onChange)(Zi.prototype.refreshEnvMaps),ke()],Zi.prototype,"envMap3",void 0),vp([(0,g.onChange)(Zi.prototype.refreshEnvMaps),ke()],Zi.prototype,"forceSceneEnvMap",void 0);const Nb=a=>({writeMaterial:(e,t)=>{e.isDiamondMaterial&&(t.extensions=t.extensions||{},t.extensions[Zi.DIAMOND_GLTF_EXTENSION]=e.toJSON(),a.extensionsUsed[Zi.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,t)=>{var n,i;if(!(e!=null&&e.material.isDiamondMaterial))return;t.extensions=t.extensions||{};const s={};(i=(n=e.userData)==null?void 0:n.gltfExtensions)==null||delete i[Zi.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(s.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(s.cacheKey=e.userData._diamondCacheKey),t.extensions[Zi.DIAMOND_GLTF_EXTENSION]=s,a.extensionsUsed[Zi.DIAMOND_GLTF_EXTENSION]=!0}});class c_{static async GetClonedCanvas(e,{rect:t={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:n=1,scale:i=1}){var s,o,l;const h=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");h.width=t.width*i*n,h.height=t.height*i*n,t.assumeClientRect&&(t.x*=e.width/(n*e.clientWidth),t.y*=e.height/(n*e.clientHeight),t.width*=e.width/(n*e.clientWidth),t.height*=e.height/(n*e.clientHeight));const d=h.getContext("2d");if(!d)return console.error("snapshot: cannot create context"),h;const f=e.style.background||((s=e.parentElement)==null?void 0:s.style.background)||"";if(f.includes("url")){const v=(o=/url\("(.*)"\)/gi.exec(f))==null?void 0:o[1];if(v){const y=new Image;y.src=v,await new Promise((w,E)=>{y.onload=()=>w(),y.onerror=()=>E(),y.complete&&w()}),d.drawImage(y,y.width*t.x*n/e.width,y.height*t.y*n/e.height,y.width*t.width*n/e.width,y.height*t.height*n/e.height,0,0,h.width,h.height)}}else d.fillStyle=e.style.background||((l=e.parentElement)==null?void 0:l.style.backgroundColor)||"#00000000",d.fillRect(0,0,h.width,h.height);return d==null||d.drawImage(e,t.x*n,t.y*n,t.width*n,t.height*n,0,0,h.width,h.height),this.Debug&&(document.body.appendChild(h),h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.borderWidth="2px",h.style.borderColor="#ff00ff",setTimeout(()=>h.remove(),5e3)),h}static async GetDataUrl(e,{mimeType:t="image/png",...n}){const i=await this.GetClonedCanvas(e,n),s=i.toDataURL(t);return this.Debug||i.remove(),s}static async GetImage(e,{mimeType:t="image/png",...n}={}){const i=await this.GetDataUrl(e,n);return new Promise((s,o)=>{const l=new Image;l.onload=()=>{s(l)},l.src=i})}static async GetBlob(e,t={}){const n=await this.GetClonedCanvas(e,t),i=await new Promise((s,o)=>{n.toBlob(l=>{l?s(l):o()},t.mimeType??"image/png")});return this.Debug||n.remove(),i}static async GetFile(e,t="image.png",n={}){return n.getDataUrl?await this.GetDataUrl(e,n):new File([await this.GetBlob(e,n)],t,{type:n.mimeType??"image/png",lastModified:(0,g.now)()})}}c_.Debug=!1;var jl=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Vl=class extends Sn{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(a,e={waitForProgressive:!0}){return e.getDataUrl=!1,await this._getFile(a||this.filename,e)}async getDataUrl(a={}){return a.getDataUrl=!0,await this._getFile("",a)??""}async _getFile(a,e={}){var t,n;const i=(t=this._viewer)==null?void 0:t.canvas;if(i){const s=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==s&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const o=(n=this._viewer)==null?void 0:n.getPlugin(na);if(e.waitForProgressive&&o&&e.timeout===void 0)for(;!o.isConverged(!0);)await(0,g.timeout)(64);else await(0,g.timeout)(e.timeout??200);e.displayPixelRatio=1;const l=await c_.GetFile(i,a,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=s,l}}async downloadSnapshot(a,e={waitForProgressive:!0}){const t=await this.getFile(a,e);t&&await this._downloadBlob(t,t.name)}async _downloadBlob(a,e){var t,n;const i=(t=this._viewer)==null?void 0:t.getPluginByType("FileTransferPlugin");i?await i.exportFile(a,e):(n=this._viewer)==null||n.console.error("FileTransferPlugin required to export/download file")}};Vl.PluginType="CanvasSnipper",jl([gi("Filename"),ke()],Vl.prototype,"filename",void 0),jl([Bi("Download .png",{limitedUi:!0})],Vl.prototype,"downloadSnapshot",null),Vl=jl([Vn("Image Export")],Vl);var _p=function(a){return function(e){return 1-a(1-e)}},fg=function(a){return function(e){return e<=.5?a(2*e)/2:(2-a(2*(1-e)))/2}},u_=function(a){return function(e){return Math.pow(e,a)}},Wf=function(a){return function(e){return e*e*((a+1)*e-a)}},mg=function(a){var e=Wf(a);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},h_=function(a){return a},gg=u_(2),Fb=_p(gg),uy=fg(gg),vg=function(a){return 1-Math.sin(Math.acos(a))},hy=_p(vg),zb=fg(hy),zo=Wf(1.525),_g=_p(zo),dy=fg(zo),d_=mg(1.525),qh=function(a){if(a===1||a===0)return a;var e=a*a;return a<.36363636363636365?7.5625*e:a<.7272727272727273?9.075*e-9.9*a+3.4:a<.9?12.066481994459833*e-19.63545706371191*a+8.898060941828255:10.8*a*a-20.52*a+10.72},p_=_p(qh),f_=function(a){return a<.5?.5*(1-qh(1-2*a)):.5*qh(2*a-1)+.5},jr=function(){return jr=Object.assign||function(a){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a},jr.apply(this,arguments)};function py(a,e){var t={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&e.indexOf(n)<0&&(t[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(n=Object.getOwnPropertySymbols(a);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(a,n[i])&&(t[n[i]]=a[n[i]])}return t}var m_=function(){},Vu=function(a,e,t){return Math.min(Math.max(t,a),e)},yp=.001,fy=.01,jb=10,g_=.05,Vb=1,my=12;function yg(a,e){return a*Math.sqrt(1-e*e)}var gy=["duration","bounce"],vy=["stiffness","damping","mass"];function yy(a,e){return e.some(function(t){return a[t]!==void 0})}function Xh(a){var e=a.from,t=e===void 0?0:e,n=a.to,i=n===void 0?1:n,s=a.restSpeed,o=s===void 0?2:s,l=a.restDelta,h=py(a,["from","to","restSpeed","restDelta"]),d={done:!1,value:t},f=function(N){var j=jr({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},N);if(!yy(N,vy)&&yy(N,gy)){var H=function(X){var ne,pe,Ae=X.duration,ve=Ae===void 0?800:Ae,Ee=X.bounce,xe=Ee===void 0?.25:Ee,we=X.velocity,Re=we===void 0?0:we,Be=X.mass,Oe=Be===void 0?1:Be,at=1-xe;at=Vu(g_,Vb,at),ve=Vu(fy,jb,ve/1e3),at<1?(ne=function(dt){var ht=dt*at,Nt=ht*ve,Bt=ht-Re,rn=yg(dt,at),hn=Math.exp(-Nt);return yp-Bt/rn*hn},pe=function(dt){var ht=dt*at*ve,Nt=ht*Re+Re,Bt=Math.pow(at,2)*Math.pow(dt,2)*ve,rn=Math.exp(-ht),hn=yg(Math.pow(dt,2),at);return(-ne(dt)+yp>0?-1:1)*((Nt-Bt)*rn)/hn}):(ne=function(dt){return Math.exp(-dt*ve)*((dt-Re)*ve+1)-yp},pe=function(dt){return Math.exp(-dt*ve)*(ve*ve*(Re-dt))});var st=function(dt,ht,Nt){for(var Bt=Nt,rn=1;rn<my;rn++)Bt-=dt(Bt)/ht(Bt);return Bt}(ne,pe,5/ve);if(ve*=1e3,isNaN(st))return{stiffness:100,damping:10,duration:ve};var St=Math.pow(st,2)*Oe;return{stiffness:St,damping:2*at*Math.sqrt(Oe*St),duration:ve}}(N);(j=jr(jr(jr({},j),H),{velocity:0,mass:1})).isResolvedFromDuration=!0}return j}(h),v=f.stiffness,y=f.damping,w=f.mass,E=f.velocity,M=f.duration,P=f.isResolvedFromDuration,L=Ap,R=Ap;function I(){var N=E?-E/1e3:0,j=i-t,H=y/(2*Math.sqrt(v*w)),X=Math.sqrt(v/w)/1e3;if(l!=null||(l=Math.abs(i-t)<=1?.01:.4),H<1){var ne=yg(X,H);L=function(Ae){var ve=Math.exp(-H*X*Ae);return i-ve*((N+H*X*j)/ne*Math.sin(ne*Ae)+j*Math.cos(ne*Ae))},R=function(Ae){var ve=Math.exp(-H*X*Ae);return H*X*ve*(Math.sin(ne*Ae)*(N+H*X*j)/ne+j*Math.cos(ne*Ae))-ve*(Math.cos(ne*Ae)*(N+H*X*j)-ne*j*Math.sin(ne*Ae))}}else if(H===1)L=function(Ae){return i-Math.exp(-X*Ae)*(j+(N+X*j)*Ae)};else{var pe=X*Math.sqrt(H*H-1);L=function(Ae){var ve=Math.exp(-H*X*Ae),Ee=Math.min(pe*Ae,300);return i-ve*((N+H*X*j)*Math.sinh(Ee)+pe*j*Math.cosh(Ee))/pe}}}return I(),{next:function(N){var j=L(N);if(P)d.done=N>=M;else{var H=1e3*R(N),X=Math.abs(H)<=o,ne=Math.abs(i-j)<=l;d.done=X&&ne}return d.value=d.done?i:j,d},flipTarget:function(){var N;E=-E,t=(N=[i,t])[0],i=N[1],I()}}}Xh.needsInterpolation=function(a,e){return typeof a=="string"||typeof e=="string"};var Ap=function(a){return 0},bp=function(a,e,t){var n=e-a;return n===0?1:(t-a)/n},Gu=function(a,e,t){return-t*a+t*e+a},Yh=function(a,e){return function(t){return Math.max(Math.min(t,e),a)}},Hu=function(a){return a%1?Number(a.toFixed(5)):a},Gl=/(-)?([\d]*\.?[\d])+/g,xp=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,v_=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Kh(a){return typeof a=="string"}var qf={test:function(a){return typeof a=="number"},parse:parseFloat,transform:function(a){return a}},Ag=jr(jr({},qf),{transform:Yh(0,1)}),__=(jr(jr({},qf),{default:1}),function(a,e){return function(t){return!!(Kh(t)&&v_.test(t)&&t.startsWith(a)||e&&Object.prototype.hasOwnProperty.call(t,e))}}),Jh=function(a,e,t){return function(n){var i;if(!Kh(n))return n;var s=n.match(Gl),o=s[0],l=s[1],h=s[2],d=s[3];return(i={})[a]=parseFloat(o),i[e]=parseFloat(l),i[t]=parseFloat(h),i.alpha=d!==void 0?parseFloat(d):1,i}},Gb=Yh(0,255),Qu=jr(jr({},qf),{transform:function(a){return Math.round(Gb(a))}}),tu={test:__("rgb","red"),parse:Jh("red","green","blue"),transform:function(a){var e=a.red,t=a.green,n=a.blue,i=a.alpha,s=i===void 0?1:i;return"rgba("+Qu.transform(e)+", "+Qu.transform(t)+", "+Qu.transform(n)+", "+Hu(Ag.transform(s))+")"}},Ay={test:__("#"),parse:function(a){var e="",t="",n="",i="";return a.length>5?(e=a.substr(1,2),t=a.substr(3,2),n=a.substr(5,2),i=a.substr(7,2)):(e=a.substr(1,1),t=a.substr(2,1),n=a.substr(3,1),i=a.substr(4,1),e+=e,t+=t,n+=n,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:i?parseInt(i,16)/255:1}},transform:tu.transform},sE=function(a){return{test:function(e){return Kh(e)&&e.endsWith(a)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+a}}},bg=sE("%"),Xf=(jr(jr({},bg),{parse:function(a){return bg.parse(a)/100},transform:function(a){return bg.transform(100*a)}}),{test:__("hsl","hue"),parse:Jh("hue","saturation","lightness"),transform:function(a){var e=a.hue,t=a.saturation,n=a.lightness,i=a.alpha,s=i===void 0?1:i;return"hsla("+Math.round(e)+", "+bg.transform(Hu(t))+", "+bg.transform(Hu(n))+", "+Hu(Ag.transform(s))+")"}}),aE=function(a,e,t){var n=a*a,i=e*e;return Math.sqrt(Math.max(0,t*(i-n)+n))},oE=[Ay,tu,Xf],Hb=function(a){return oE.find(function(e){return e.test(a)})},xg=function(a,e){var t=Hb(a),n=Hb(e);if(m_(t.transform===n.transform),!t||!n||t.transform!==n.transform)return function(h){return""+(h>0?e:a)};var i=t.parse(a),s=n.parse(e),o=jr({},i),l=t===Xf?Gu:aE;return function(h){for(var d in o)d!=="alpha"&&(o[d]=l(i[d],s[d],h));return o.alpha=Gu(i.alpha,s.alpha,h),t.transform(o)}},y_={test:function(a){return tu.test(a)||Ay.test(a)||Xf.test(a)},parse:function(a){return tu.test(a)?tu.parse(a):Xf.test(a)?Xf.parse(a):Ay.parse(a)},transform:function(a){return Kh(a)?a:a.hasOwnProperty("red")?tu.transform(a):Xf.transform(a)}},wp="${c}",Qb="${n}";function Vr(a){typeof a=="number"&&(a=""+a);var e=[],t=0,n=a.match(xp);n&&(t=n.length,a=a.replace(xp,wp),e.push.apply(e,n.map(y_.parse)));var i=a.match(Gl);return i&&(a=a.replace(Gl,Qb),e.push.apply(e,i.map(qf.parse))),{values:e,numColors:t,tokenised:a}}function wg(a){return Vr(a).values}function by(a){var e=Vr(a),t=e.values,n=e.numColors,i=e.tokenised,s=t.length;return function(o){for(var l=i,h=0;h<s;h++)l=l.replace(h<n?wp:Qb,h<n?y_.transform(o[h]):Hu(o[h]));return l}}var A_=function(a){return typeof a=="number"?0:a},Eg={test:function(a){var e,t,n,i;return isNaN(a)&&Kh(a)&&((t=(e=a.match(Gl))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((i=(n=a.match(xp))===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0)>0},parse:wg,createTransformer:by,getAnimatableNone:function(a){var e=wg(a);return by(a)(e.map(A_))}},Sg={x:0,y:0,z:0},b_=function(a){return typeof a=="number"},Wb=function(a,e){return function(t){return e(a(t))}},Ep=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return a.reduce(Wb)};function x_(a,e){return b_(a)?function(t){return Gu(a,e,t)}:y_.test(a)?xg(a,e):Sp(a,e)}var bc=function(a,e){var t=function(s,o,l){if(l||arguments.length===2)for(var h,d=0,f=o.length;d<f;d++)!h&&d in o||(h||(h=Array.prototype.slice.call(o,0,d)),h[d]=o[d]);return s.concat(h||Array.prototype.slice.call(o))}([],a),n=t.length,i=a.map(function(s,o){return x_(s,e[o])});return function(s){for(var o=0;o<n;o++)t[o]=i[o](s);return t}},qb=function(a,e){var t=jr(jr({},a),e),n={};for(var i in t)a[i]!==void 0&&e[i]!==void 0&&(n[i]=x_(a[i],e[i]));return function(s){for(var o in n)t[o]=n[o](s);return t}};function xy(a){for(var e=Eg.parse(a),t=e.length,n=0,i=0,s=0,o=0;o<t;o++)n||typeof e[o]=="number"?n++:e[o].hue!==void 0?s++:i++;return{parsed:e,numNumbers:n,numRGB:i,numHSL:s}}var Sp=function(a,e){var t=Eg.createTransformer(e),n=xy(a),i=xy(e);return n.numHSL===i.numHSL&&n.numRGB===i.numRGB&&n.numNumbers>=i.numNumbers?Ep(bc(n.parsed,i.parsed),t):function(s){return""+(s>0?e:a)}},lE=function(a,e){return function(t){return Gu(a,e,t)}};function Mp(a,e,t){var n=t===void 0?{}:t,i=n.clamp,s=i===void 0||i,o=n.ease,l=n.mixer,h=a.length;m_(h===e.length),m_(!o||!Array.isArray(o)||o.length===h-1),a[0]>a[h-1]&&(a=[].concat(a),e=[].concat(e),a.reverse(),e.reverse());var d=function(v,y,w){for(var E=[],M=w||(typeof(N=v[0])=="number"?lE:typeof N=="string"?y_.test(N)?xg:Sp:Array.isArray(N)?bc:typeof N=="object"?qb:void 0),P=v.length-1,L=0;L<P;L++){var R=M(v[L],v[L+1]);if(y){var I=Array.isArray(y)?y[L]:y;R=Ep(I,R)}E.push(R)}var N;return E}(e,o,l),f=h===2?function(v,y){var w=v[0],E=v[1],M=y[0];return function(P){return M(bp(w,E,P))}}(a,d):function(v,y){var w=v.length,E=w-1;return function(M){var P=0,L=!1;if(M<=v[0]?L=!0:M>=v[E]&&(P=E-1,L=!0),!L){for(var R=1;R<w&&!(v[R]>M||R===E);R++);P=R-1}var I=bp(v[P],v[P+1],M);return y[P](I)}}(a,d);return s?function(v){return f(Vu(a[0],a[h-1],v))}:f}function Yf(a,e){return a.map(function(){return e||uy}).splice(0,a.length-1)}function Wu(a){var e=a.from,t=e===void 0?0:e,n=a.to,i=n===void 0?1:n,s=a.ease,o=a.offset,l=a.duration,h=l===void 0?300:l,d={done:!1,value:t},f=Array.isArray(i)?i:[t,i],v=function(E,M){return E.map(function(P){return P*M})}(o&&o.length===f.length?o:function(E){var M=E.length;return E.map(function(P,L){return L!==0?L/(M-1):0})}(f),h);function y(){return Mp(v,f,{ease:Array.isArray(s)?s:Yf(f,s)})}var w=y();return{next:function(E){return d.value=w(E),d.done=E>=h,d},flipTarget:function(){f.reverse(),w=y()}}}function Kf(a){var e=a.velocity,t=e===void 0?0:e,n=a.from,i=n===void 0?0:n,s=a.power,o=s===void 0?.8:s,l=a.timeConstant,h=l===void 0?350:l,d=a.restDelta,f=d===void 0?.5:d,v=a.modifyTarget,y={done:!1,value:i},w=o*t,E=i+w,M=v===void 0?E:v(E);return M!==E&&(w=M-i),{next:function(P){var L=-w*Math.exp(-P/h);return y.done=!(L>f||L<-f),y.value=y.done?M:M+L,y},flipTarget:function(){}}}var Cp={keyframes:Wu,spring:Xh,decay:Kf},Jf=1/60*1e3,Mg=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},Zf=typeof window<"u"?function(a){return window.requestAnimationFrame(a)}:function(a){return setTimeout(function(){return a(Mg())},Jf)},Tp=!0,$f=!1,w_=!1,em={delta:0,timestamp:0},Cg=["read","update","preRender","render","postRender"],E_=Cg.reduce(function(a,e){return a[e]=function(t){var n=[],i=[],s=0,o=!1,l=new WeakSet,h={schedule:function(d,f,v){f===void 0&&(f=!1),v===void 0&&(v=!1);var y=v&&o,w=y?n:i;return f&&l.add(d),w.indexOf(d)===-1&&(w.push(d),y&&o&&(s=n.length)),d},cancel:function(d){var f=i.indexOf(d);f!==-1&&i.splice(f,1),l.delete(d)},process:function(d){var f;if(o=!0,n=(f=[i,n])[0],(i=f[1]).length=0,s=n.length)for(var v=0;v<s;v++){var y=n[v];y(d),l.has(y)&&(h.schedule(y),t())}o=!1}};return h}(function(){return $f=!0}),a},{}),wy=Cg.reduce(function(a,e){var t=E_[e];return a[e]=function(n,i,s){return i===void 0&&(i=!1),s===void 0&&(s=!1),$f||Kb(),t.schedule(n,i,s)},a},{}),Xb=Cg.reduce(function(a,e){return a[e]=E_[e].cancel,a},{}),Yb=function(a){return E_[a].process(em)},Ey=function(a){$f=!1,em.delta=Tp?Jf:Math.max(Math.min(a-em.timestamp,40),1),em.timestamp=a,w_=!0,Cg.forEach(Yb),w_=!1,$f&&(Tp=!1,Zf(Ey))},Kb=function(){$f=!0,Tp=!0,w_||Zf(Ey)},Sy=function(){return em},Jb=wy;function My(a,e,t){return t===void 0&&(t=0),a-e-t}var Hl=function(a){var e=function(t){var n=t.delta;return a(n)};return{start:function(){return Jb.update(e,!0)},stop:function(){return Xb.update(e)}}};function nu(a){var e,t,n,i,s,o=a.from,l=a.autoplay,h=l===void 0||l,d=a.driver,f=d===void 0?Hl:d,v=a.elapsed,y=v===void 0?0:v,w=a.repeat,E=w===void 0?0:w,M=a.repeatType,P=M===void 0?"loop":M,L=a.repeatDelay,R=L===void 0?0:L,I=a.onPlay,N=a.onStop,j=a.onComplete,H=a.onRepeat,X=a.onUpdate,ne=py(a,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),pe=ne.to,Ae=0,ve=ne.duration,Ee=!1,xe=!0,we=function(Be){if(Array.isArray(Be.to))return Wu;if(Cp[Be.type])return Cp[Be.type];var Oe=new Set(Object.keys(Be));return Oe.has("ease")||Oe.has("duration")&&!Oe.has("dampingRatio")?Wu:Oe.has("dampingRatio")||Oe.has("stiffness")||Oe.has("mass")||Oe.has("damping")||Oe.has("restSpeed")||Oe.has("restDelta")?Xh:Wu}(ne);!((t=(e=we).needsInterpolation)===null||t===void 0)&&t.call(e,o,pe)&&(s=Mp([0,100],[o,pe],{clamp:!1}),o=0,pe=100);var Re=we(jr(jr({},ne),{from:o,to:pe}));return h&&(I==null||I(),(n=f(function(Be){if(xe||(Be=-Be),y+=Be,!Ee){var Oe=Re.next(Math.max(0,y));i=Oe.value,s&&(i=s(i)),Ee=xe?Oe.done:y<=0}X==null||X(i),Ee&&(Ae===0&&(ve!=null||(ve=y)),Ae<E?function(at,st,St,dt){return dt?at>=st+St:at<=-St}(y,ve,R,xe)&&(Ae++,P==="reverse"?y=function(at,st,St,dt){return St===void 0&&(St=0),dt===void 0&&(dt=!0),dt?My(st+-at,st,St):st-(at-st)+St}(y,ve,R,xe=Ae%2==0):(y=My(y,ve,R),P==="mirror"&&Re.flipTarget()),Ee=!1,H&&H()):(n.stop(),j&&j()))})).start()),{stop:function(){N==null||N(),n.stop()}}}const Zh={linear:h_,easeIn:gg,easeOut:Fb,easeInOut:uy,circIn:vg,circOut:hy,circInOut:zb,backIn:zo,backOut:_g,backInOut:dy,anticipate:d_,bounceOut:qh,bounceIn:p_,bounceInOut:f_,easeInOutSine:function(a){return-(Math.cos(Math.PI*a)-1)/2}};function S_(a,e,t){const n=a[e],i=()=>{typeof(a==null?void 0:a.setDirty)=="function"&&a.setDirty(),t==null||t()};return n.isVector3||n.isVector2||n.isVector4?s=>{n.copy(s),i()}:s=>{a[e]=s,i()}}function M_(a){return typeof a!="boolean"}async function Tg(a,e,t,n){e in a||console.error("invalid key",e,a);const i=S_(a,e),s=a[e],o=l=>{var h;i(l),(h=t.onUpdate)==null||h.call(t,l)};if(M_(s))return typeof t.to=="function"&&(t={...t,to:t.to(s,a)}),tm({...t,from:s,onUpdate:o},n);{const{duration:l}=t;return(0,g.timeout)(l??0).then(()=>o(t.to))}}async function tm(a,e){const t=a.onComplete,n=a.onStop,i=a.onEnd;return a={...a},new Promise((s,o)=>{a.onComplete=()=>{try{t==null||t()}catch(h){return i==null||i(),void o(h)}i==null||i(),s()},a.onStop=()=>{try{n==null||n()}catch(h){return i==null||i(),void o(h)}i==null||i(),s()};const l=nu(a);e&&e.push(l)})}var xr=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Zb=1,sa=class{constructor(a,e,t,n,i){this.position=new u.Pa4,this.target=new u.Pa4,this.quaternion=new u._fP,this.up=new u.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.updateView=()=>{},this.uiConfig=$a(this.name,this),a&&(this.position=a),e&&(this.target=e),t&&(this.up=t),n&&(this.quaternion=n),i&&(this.snap=i),this.name="#view"+Zb++}_nameChanged(){var a,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(a=this.uiConfig).uiRefresh)==null||e.call(a))}};xr([ke(),Ks()],sa.prototype,"position",void 0),xr([ke(),Ks()],sa.prototype,"target",void 0),xr([ke(),Ks()],sa.prototype,"quaternion",void 0),xr([ke(),Ks()],sa.prototype,"up",void 0),xr([ke(),gi()],sa.prototype,"name",void 0),xr([yh()],sa.prototype,"snap",void 0),xr([Bi()],sa.prototype,"focusView",void 0),xr([Bi()],sa.prototype,"deleteView",void 0),xr([Bi()],sa.prototype,"updateView",void 0),sa=xr([Ko("CameraView")],sa);class ar extends Sn{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Sl(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const n=(t=this._viewer)==null?void 0:t.scene.activeCamera;if(!n)return;const i=new u.$V,s=n.position,o=n.target,l=new u._fP().setFromUnitVectors(n.cameraObject.up,new u.Pa4(0,1,0)),h=l.clone().invert(),d=s.clone().sub(o);d.applyQuaternion(l),i.setFromVector3(d),i.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,i.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,i.makeSafe(),d.setFromSpherical(i),d.applyQuaternion(h),s.copy(o).add(d),n.positionUpdated(!1),n.targetUpdated()}}async onAdded(e){await super.onAdded(e);let t=!1;e.addEventListener("preFrame",n=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,t=!0):t&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,t=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,t;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))==null||e.enable(ar.PluginType),this._fadeDisabled=!1));const n=(0,g.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=n-1/60);let i=n-this._lastFrameTime;this._lastFrameTime=n,i*=this.animateOnScroll?this._scrollAnimationState:1;const s=(t=this._viewer.getPluginByType("Progressive"))==null?void 0:t.postFrameConvergedRecordingDelta();if(s&&s>0&&(i=s),s!==0&&(i*=1e3,!(i<=0||(this._updaters.forEach(o=>{let l=i;o.time+l<0&&(l=-o.time),o.time+=l,Math.abs(l)>.001&&o.u(l)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const o=this._viewer.getPluginByType("FrameFade");o&&(o.disable(ar.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,g.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,g.timeout)(2))}async recordAllViews(e,t=!0){var n;if(!this.enabled)return;const i=(n=this._viewer)==null?void 0:n.getPluginByType("CanvasRecorder");if(i&&i.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!i.isRecording())return new Promise((s,o)=>{const l=()=>{i.removeEventListener("start",h),i.removeEventListener("stop",l),i.removeEventListener("error",d)},h=async()=>{var f;l(),e==null||e(),await this.animateAllViews();const v=await i.stopRecording();if(t){const y=await((f=this._viewer)==null?void 0:f.prompt("Canvas Recorder: Save file as","recording.mp4"));y!==null&&v&&await this._downloadBlob(v,y||"recording.mp4")}s(v)},d=async()=>{l(),o()};i.addEventListener("start",h),i.addEventListener("stop",l),i.addEventListener("error",d),i.startRecording()||console.error("cannot start recording")});console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){var e,t,n;if(!this.enabled)return;const i=(e=this._viewer)==null?void 0:e.scene.activeCamera;if(!i)return;const s=this.getCurrentCameraView(i);s.snap=await((n=(t=this._viewer)==null?void 0:t.getPlugin(Vl))==null?void 0:n.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(s)}addView(e){var t,n;this._cameraViews.push(e),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,t=!0,n){var i,s,o;if(e||(e=(i=this._viewer)==null?void 0:i.scene.activeCamera),!e)return new sa;const l=new u.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const h=e.cameraObject.matrixWorld;l.x=h.elements[4],l.y=h.elements[5],l.z=h.elements[6],l.normalize();const d=e.target.clone(),f=e.position.clone(),v=e.cameraObject.parent;v&&(t?f.applyMatrix4(v.matrixWorld):l.transformDirection(v.matrixWorld.clone().invert()));const y=t?e.cameraObject.getWorldQuaternion(new u._fP):e.cameraObject.quaternion.clone();return n?(n.position.copy(f),n.target.copy(d),n.up.copy(l),n.quaternion.copy(y)):((n=new sa(f,d,l,y,"")).focusView=async()=>n&&this.focusView(n),n.deleteView=()=>n&&this.deleteView(n),n.updateView=()=>this.getCurrentCameraView(e,t,n)),(o=(s=n.uiConfig).uiRefresh)==null||o.call(s,"postFrame",!0),n}setCurrentCameraView(e){var t;const n=(t=this._viewer)==null?void 0:t.scene.activeCamera;n&&(n.position.copy(e.position),n.target.copy(e.target),n.cameraObject.up.copy(e.up),n.cameraObject.quaternion.copy(e.quaternion),n.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){var t,n;const i=this._cameraViews.indexOf(e);i>=0&&this._cameraViews.splice(i,1),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var t;return(t=e==null?void 0:e.stop)==null?void 0:t.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await(0,g.timeout)(100)}async animateToView(e,t,n,i=!1){var s,o;const l=(s=this._viewer)==null?void 0:s.scene.activeCamera;if(!l)return;if(this._animating){this._popAnimations.forEach(w=>(w==null?void 0:w.stop)&&w.stop()),this._popAnimations=[];let y=0;for(;this._animating&&(await(0,g.timeout)(100),!(y++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),t===void 0&&(t=this.animDuration),t=Math.max(10,t);const h=typeof n=="function"?n:Zh[n||this.animEase],d=this._driver,f=[];this._popAnimations=[];const v=this._popAnimations;if(this.interpolateMode==="spherical")f.push(async function(y,w,E,M,P,L,R){const I=y.target.clone(),N=new u.Pa4,j=new u.Pa4,H=y.cameraObject.parent,X=y.cameraObject.up.clone(),ne=oo({position:y.cameraObject.getWorldPosition(new u.Pa4),up:H?X.transformDirection(H.matrixWorld):X},I),pe=oo(w,w.target),Ae=new u.$V;function ve(){y.position.copy(H?H.worldToLocal(j):j),y.target.copy(N),y.positionUpdated()}return tm({from:0,to:1,duration:E,ease:M,driver:P,onUpdate:Ee=>{Ae.phi=xc(ne.phi,pe.phi,Ee),Ae.theta=xc(ne.theta,pe.theta,Ee),Ae.radius=He(ne.radius,pe.radius,Ee),N.copy(I).lerp(w.target,Ee),j.setFromSpherical(Ae),j.add(N),ve()},onComplete:()=>{j.copy(w.position),N.copy(w.target),ve()},onStop:()=>{throw new Error("Animation Stopped")}},L)}(l,e,t,h,d,v));else if(this.interpolateMode==="linear"){f.push(tm({from:l.position.clone(),to:e.position.clone(),duration:t,ease:h,driver:d,onUpdate:E=>l.position=E,onComplete:()=>l.position=e.position,onStop:()=>{throw new Error("Animation stopped")}},v)),f.push(tm({from:l.target.clone(),to:e.target.clone(),duration:t,ease:h,driver:d,onUpdate:E=>{l.target=E,l.targetUpdated()},onComplete:()=>{l.target=e.target,l.targetUpdated()}},v));const y=l.cameraObject.quaternion.clone(),w=new u._fP;f.push(tm({from:0,to:1,duration:t,ease:h,driver:d,onUpdate:E=>{w.copy(y).slerp(e.quaternion,E),l.cameraObject.quaternion.copy(w),l.cameraObject.updateProjectionMatrix()},onComplete:()=>{l.cameraObject.quaternion.copy(e.quaternion),l.cameraObject.updateProjectionMatrix()}},v))}await Promise.allSettled(f).catch(y=>{if(i)throw y}),(o=this._viewer)==null||o.setDirty(),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,g.timeout)(10)}fromJSON(e,t){var n,i;return this._cameraViews.forEach(s=>this.deleteView(s)),super.fromJSON(e,t)?(this._cameraViews.forEach(s=>s.focusView=async()=>this.focusView(s)),this._cameraViews.forEach(s=>s.deleteView=()=>this.deleteView(s)),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n),this):null}async animateToObject(e,t=4,n,i,s={min:.5,max:5}){if(!this._viewer)return;const o=new Fe().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),l=o.getCenter(new u.Pa4),h=o.getSize(new u.Pa4).length()/2;await this.animateToTarget(Math.min(s.max,Math.max(s.min,h*t)),l,n,i)}async animateToFitObject(e,t=1.5,n=1e3,i,s={min:.5,max:50}){if(!this._viewer)return;const o=new Fe().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),l=o.getCenter(new u.Pa4),h=o.getSize(new u.Pa4);let d=this._viewer.scene.activeCamera.cameraObject,f=1;if(d.isPerspectiveCamera){const v=d.fov*(Math.PI/180),y=2*Math.atan(Math.tan(v/2)*d.aspect),w=h.z/2+Math.abs(h.x/2/Math.tan(y/2)),E=h.z/2+Math.abs(h.y/2/Math.tan(v/2));f=Math.max(w,E)}await this.animateToTarget(Math.min(s.max,Math.max(s.min,f*t)),l,n,i)}async animateToTarget(e,t,n,i){const s=this.getCurrentCameraView();s.target.copy(t);const o=new u.Pa4().subVectors(s.target,s.position).normalize();s.position.copy(o.multiplyScalar(-e).add(s.target)),await this.animateToView(s,n,i)}async _downloadBlob(e,t){var n,i;const s=(n=this._viewer)==null?void 0:n.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,t):(i=this._viewer)==null||i.console.error("FileTransferPlugin required to export/download file")}}function oo(a,e){const t=a.position.clone();t.sub(e);const n=new u.$V().setFromVector3(t);return n.makeSafe(),n}function xc(a,e,t){const n=e-a;return n>=Math.PI?a+(n-2*Math.PI)*t:n<=-Math.PI?a+(n+2*Math.PI)*t:a+n*t}function Cy(a,e,t){const n=(1-t)*Math.cos(a)+t*Math.cos(e),i=(1-t)*Math.sin(a)+t*Math.sin(e);return Math.atan2(i,n)}ar.PluginType="CameraViews",xr([ke("cameraViews")],ar.prototype,"_cameraViews",void 0),xr([(0,g.onChange)(ar.prototype._animationLoop),ke(),sn("Loop All Views",{limitedUi:!0})],ar.prototype,"viewLooping",void 0),xr([ke(),gi("View Pause Time")],ar.prototype,"viewPauseTime",void 0),xr([ke(),Eo("Ease",Object.keys(Zh).map(a=>({label:a})))],ar.prototype,"animEase",void 0),xr([ke(),gn("Duration",[10,1e4],10,{limitedUi:!0})],ar.prototype,"animDuration",void 0),xr([ke(),gn("RotationOffset",[.2,.75],.01)],ar.prototype,"rotationOffset",void 0),xr([ke(),Eo("Interpolation",["spherical","linear"].map(a=>({label:a})))],ar.prototype,"interpolateMode",void 0),xr([sn(),ke()],ar.prototype,"seekOnScroll",void 0),xr([Bi("Animate All Views",{limitedUi:!0})],ar.prototype,"animateAllViews",null),xr([Bi("Record All Views")],ar.prototype,"recordAllViews",null),xr([Bi("Add Current View")],ar.prototype,"addCurrentView",null),xr([Bi("Focus Next")],ar.prototype,"focusNext",void 0),xr([Bi("Focus Previous")],ar.prototype,"focusPrevious",void 0);const nm=new u.Pa4;function $b(a,e,t){let n=a.dot(e);n=Math.min(Math.max(n,-1),1);const i=Math.acos(n)*t;return nm.copy(a).multiplyScalar(n).sub(e).negate().normalize(),a.multiplyScalar(Math.cos(i)).add(nm.multiplyScalar(Math.sin(i)))}var iu,ru=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let wc=iu=class{constructor(a){this.enabled=!1,this.power=.5,this.bgcolor=new u.Ilk(0),this.extraUniforms={power:{value:.5},bgcolor:{value:new u.Ilk}},this.parsFragmentSnippet=(e,t)=>this.enabled?g.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=a.getPlugin(vc),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=_n(a.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}};wc.PluginType="Vignette",ru([(0,g.onChange)(iu.prototype._setDirty),sn("Enable"),ke()],wc.prototype,"enabled",void 0),ru([(0,g.onChange)(iu.prototype._setDirty),gn("Power",[.1,4],.01,{limitedUi:!0}),ke()],wc.prototype,"power",void 0),ru([(0,g.onChange)(iu.prototype._setDirty),lc("Color"),ke()],wc.prototype,"bgcolor",void 0),wc=iu=ru([Vn("Vignette")],wc);class qu extends Ou{constructor(){super()}generateExtension(e){return new wc(e)}get power(){var e;return((e=this._extension)==null?void 0:e.power)??1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e;return((e=this._extension)==null?void 0:e.bgcolor)??new u.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}qu.PluginType="Vignette";var $h=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let os=class extends Sn{constructor(){super(),this.enabled=!0,this.dependencies=[Yt],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const a=await(0,g.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(a)}async loadScenes(a){var e,t;const n=await Promise.all(a.map(async i=>await i.arrayBuffer()));for(let i=0;i<a.length;i++){const s=a[i];this.scenes.push({[s.name]:new Uint8Array(n[i])}),this.assets[s.name]={path:s.name,file:s}}(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e)}async play(){var a;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e==null||e.enabled,e&&(e.enabled=!1);const t=this._viewer.getPluginByType("FrameFade"),n=this._viewer.getPluginByType("GLTFAnimation"),i=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const s of this.scenes){if(!this._isPlaying)break;const o=Object.keys(s);n==null||n.stopAnimation(!1),await(i==null?void 0:i.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const h of o){let d=this.assets[h];d||(d={path:h,file:new File([s[h]],h)},this.assets[h]=d),await((a=this._viewer.getManager())==null?void 0:a.addAssetSingle(d,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),t&&(t.enabled=!0,await t.startTransition(1e3));const l=[(0,g.timeout)(this.minSceneTime)];n&&l.push(n.playAnimation()),i&&l.push(i.animateAllViews()),await Promise.all(l)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const a={};for(const n of this.scenes)for(const i of Object.keys(n)){const s=a[i]?i+"_":i;a[s]=n[s]}const e=Q0(a),t=new Blob([e],{type:"application/zip"});(0,g.downloadBlob)(t,"scenes.glbloop")}async onAdded(a){var e,t;await super.onAdded(a);const n=this;(t=(e=a.getManager())==null?void 0:e.importer)==null||t.Importers.push(new yr(class extends Vv{load(i,s,o,l){super.load(i,h=>{n.loadScenes([...h.values()]),s==null||s(null),(0,g.timeout)(100).then(n.play)},o,l)}},["glbloop"],!0))}};os.PluginType="SceneLoopPlugin",$h([Jo("Loaded scenes")],os.prototype,"loadedScenes",null),$h([Bi("Load Scenes")],os.prototype,"promptLoadScenes",null),$h([Jo("Playing")],os.prototype,"_isPlaying",void 0),$h([gi("Min Scene Time")],os.prototype,"minSceneTime",void 0),$h([Bi("Play")],os.prototype,"play",null),$h([Bi("Stop")],os.prototype,"stop",null),$h([Bi("Download Scenes")],os.prototype,"downloadScenes",null),os=$h([Vn("Scene Loop")],os);var C_=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ig=class extends $o{constructor(a,e,t){super(a,e,t??new dl,new u.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(a,e,t,n,i){if(!this.enabled||!this.camera)return;const s=this.overrideMaterial;s.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(a,e,t,n,i),s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value)}};C_([sn("Enabled")],Ig.prototype,"enabled",void 0),Ig=C_([Vn("Velocity Buffer (TAA)")],Ig);class dl extends u.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new u.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new u.Vkp},currentProjectionViewMatrix:{value:new u.yGw},lastProjectionViewMatrix:{value:new u.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new u.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,n,i,s){const o=this._previousWorldMatrices[s.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(o??s.matrixWorld),o?o.copy(s.matrixWorld):this._previousWorldMatrices[s.uuid]=s.matrixWorld.clone();let l=s.material;Array.isArray(l)&&(l=l[0]),this.uniforms.alphaMap.value=(l==null?void 0:l.alphaMap)??null,this.uniforms.alphaTest.value=!l||!l.alphaTest||l.alphaTest<1e-7?.001:l.alphaTest;let h=this.uniforms.alphaMap.value?1:void 0;h!==this.defines.USE_ALPHAMAP&&(h===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=h,this.needsUpdate=!0),h=l.userData.ALPHA_I_RGBA_PACKING?1:void 0,h!==this.defines.ALPHA_I_RGBA_PACKING&&(h===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=h,this.needsUpdate=!0),this.side=l.side??u.ehD}}class pl extends To{passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:u.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const n=new Set,i=new Set;return new class extends Ig{render(s,o,l,h,d){var f;if(e.renderer.frameCount>0)return;const v=s.getRenderTarget(),y=s.getActiveCubeFace(),w=s.getActiveMipmapLevel();(f=this.scene)==null||f.traverse(({material:E})=>{E&&((E.transparent&&E.userData.renderToDepth||!E.transparent&&E.transmission===0&&E.userData.renderToDepth===!1)&&(n.add(E),E.transparent=!E.transparent),Math.abs(E.transmission||0)>0&&E.userData.renderToDepth&&(i.add([E,E.transmission]),E.transmission=0))}),mi(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(s,o,t,h,d)),n.forEach(E=>E.transparent=!E.transparent),n.clear(),i.forEach(([E,M])=>E.transmission=M),i.clear(),s.setRenderTarget(v,y,w)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(t=>{var n;return e.renderer.disposeTarget((n=t==null?void 0:t.dispose)==null?void 0:n.call(t))}),super.onRemove(e)}updateShaderProperties(e){var t;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled?((t=this.getVelocityBuffer())==null?void 0:t.texture)??null:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}pl.PluginType="VelocityBuffer";var ed,Ha=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Xu=ed=class{constructor(a){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,t)=>this.enabled?`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){
#ifdef WebGL2Context
return number%2;
#else
return int(mod(float(number),2.));
#endif
}int getLUTIndex(in int number){
#ifdef WebGL2Context
return number%8;
#else
return int(mod(float(number),8.));
#endif
}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._viewer=a,this._combinedPostPlugin=a.getPlugin(vc),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const a=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let e=a?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,e,this.extraUniforms.lutSize,a),this.extraDefines.USE_LUT=this.lutMap?1:0,e=a?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,e,this.extraUniforms.lutSize1,a),this.extraDefines.USE_LUT1=this.lutMap1?1:0,e=a?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,e,this.extraUniforms.lutSize2,a),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=a,this._setDirty()}_updateLUTMap(a,e,t,n){if(a){let i=1;n==1?(e.value=a.texture3D,i=a.texture3D.image.width):a.texture&&(e.value=a.texture,i=a.texture.image.width),e.value.needsUpdate=!0,t.value=i}}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=_n(a.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function Ty(a){const e=a==null?void 0:a.userData;if(!e)return!1;e[ls.PluginType]||(e[ls.PluginType]={});const t=e[ls.PluginType];return t.enable=!0,t.index===void 0&&(t.index=0),a.isMaterial&&(a.needsUpdate=!0),!0}Ha([ke(),(0,g.onChange)(ed.prototype._updateParams),sn("Enable")],Xu.prototype,"enabled",void 0),Ha([ke(),(0,g.onChange)(ed.prototype._updateParams),sn("LUT Background")],Xu.prototype,"lutBackground",void 0),Ha([ke(),(0,g.onChange)(ed.prototype._updateParams),gn("Intensity")],Xu.prototype,"intensity",void 0),Ha([(0,g.onChange)(ed.prototype._updateParams),yh("LUT"),ke()],Xu.prototype,"lutMap",void 0),Ha([(0,g.onChange)(ed.prototype._updateParams),yh("LUT1"),ke()],Xu.prototype,"lutMap1",void 0),Ha([(0,g.onChange)(ed.prototype._updateParams),yh("LUT2"),ke()],Xu.prototype,"lutMap2",void 0),Xu=ed=Ha([Vn("LUT")],Xu);class ls extends Ou{_getUiConfig(e){var t,n;const i={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=e.materialObject.userData[ls.PluginType])==null?void 0:s.enable)??!0},set value(s){var o;const l=e.materialObject.userData[ls.PluginType];s!==(l==null?void 0:l.enable)&&(l||Ty(e.materialObject),e.materialObject.userData[ls.PluginType].enable=s,(o=i.uiRefresh)==null||o.call(i,"postFrame",!0))},onChange:(t=this._extension)==null?void 0:t.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(s=>({label:s[0],value:s[1]})),label:"index",hidden:()=>{const s=e.materialObject.userData[ls.PluginType];return!!s&&!s.enable},get value(){var s;return((s=e.materialObject.userData[ls.PluginType])==null?void 0:s.index)??0},set value(s){var o;e.materialObject.userData[ls.PluginType]||Ty(e.materialObject),e.materialObject.userData[ls.PluginType].index=s,(o=i.uiRefresh)==null||o.call(i,"postFrame",!0)},onChange:(n=this._extension)==null?void 0:n.setDirty}]};return i}constructor(){super(),this.materialExtension={uuid:Ys(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},computeCacheKey:e=>{var t;return(this.enabled?"1":"0")+((t=e.materialObject.userData[ls.PluginType])!=null&&t.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var t,n;await super.onAdded(e),(t=e.getPlugin(Ri))==null||t.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(Yt);(n=i==null?void 0:i.materials)==null||n.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new Xu(e)}updateGBuffer(e,t){var n,i;if(e instanceof u.Kj0&&((n=e.material)!=null&&n.userData)){const s=(i=e.material)==null?void 0:i.userData[ls.PluginType];if(s){const o=s.enable===!1?0:1;t.w=Wv(t.w,0,o);for(let h=0;h<3;h++)t.y=hb(t.y,h);let l=s.enable?s.index:0;l=Math.min(l,7),t.y=t.y|l}else t.w=Wv(t.w,0,1)}}}ls.PluginType="LUTPlugin1";class Iy{constructor(e){this._zee=new u.Pa4(0,0,1),this._euler=new u.USm,this._q0=new u._fP,this._q1=new u._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new u._fP,this._initQuaternionDest=new u._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=t=>{this.deviceOrientation=t},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new u.FM8;this.getQuaternion(e,this._q2);const t=new u.Pa4(0,0,1);return t.applyQuaternion(this._q2),new u.FM8(t.x,t.y)}getQuaternion(e,t){if(t||(t=new u._fP),!this.deviceOrientation)return t.identity();const n=this.deviceOrientation,i=n.alpha!==null?u.M8C.degToRad(n.alpha):0,s=n.beta!==null?u.M8C.degToRad(n.beta):0,o=n.gamma!==null?u.M8C.degToRad(n.gamma):0,l=this.screenOrientation?u.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(t,i,s,o,l,e),t}_toQuaternion(e,t,n,i,s,o){this._euler.set(n,t,-i,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const l=document.getElementById("debug");return l&&(l.textContent=s+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),o&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var e;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(e=this._viewer)==null||e.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(e=>{e=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new u._fP)}}class ex{constructor(){this._mousePos=new u.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new u.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var T_,lo=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let co=T_=class extends Sn{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new u.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new u.Pa4,this._center=new u.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var a,e;if(!this.enabled)return void((e=(a=this._object)._updateProjectionMatrixParallax)==null?void 0:e.call(a));const t=this._object,n=t.near;let i=n*Math.tan(.5*u.M8C.DEG2RAD*t.fov)/t.zoom,s=2*i,o=t.aspect*s,l=-.5*o;if(t.view!==null&&t.view.enabled){const d=t.view.fullWidth,f=t.view.fullHeight;l+=t.view.offsetX*o/d,i-=t.view.offsetY*s/f,o*=t.view.width/d,s*=t.view.height/f}l-=this._offX*n/this._focalDistance,i-=this._offY*n/this._focalDistance;const h=t.filmOffset;h!==0&&(l+=n*h/t.getFilmWidth()),t.projectionMatrix.makePerspective(l,l+o,i,i-s,n,t.far),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()},this._preFrame=a=>{this.update(a.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new g.Damper,this._yDamper=new g.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(a){var e,t,n;await super.onAdded(a),Iy.IsCompatible()?this._input=new Iy(a):this._input=new ex,a.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),a.addEventListener("preFrame",this._preFrame),(e=this._viewer)==null||e.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(t=this._viewer)==null||t.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(n=a.getPluginByType("Picking"))==null||n.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var a,e,t,n;this._object&&((a=this._object)!=null&&a._updateProjectionMatrixParallax)&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(e=this._viewer)==null?void 0:e.scene.activeCamera.cameraObject,(t=this._object)!=null&&t.isOrthographicCamera?(n=this._viewer)==null||n.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var a;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(a=this._viewer)==null||a.container.appendChild(this._indicator))}onPointerDown(a){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=a.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=a.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(a){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.interactionsEnabled=!1,this._updateFocalDistance();const e=this._object.matrixWorld.elements,t=new u.Pa4(e[0],e[1],e[2]),n=new u.Pa4(e[4],e[5],e[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let i=this.sensitivity;this.invert&&(i*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*i,a,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*i,a,1);const s=this._object;s.position.add(n.multiplyScalar(this._offY)).add(t.multiplyScalar(this._offX)),s.updateProjectionMatrix(),s.updateMatrixWorld(),this._dirty=!0}_onObjectHit(a){var e,t;a.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(a.intersects.intersect.point),a.intersects.selectedObject=null,(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var n,i;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(i=(n=this.uiConfig)==null?void 0:n.uiRefresh)==null||i.call(n,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const a=this._object,e=new u.Pa4;a.getWorldDirection(e),e.normalize(),this._focalDistance=this.focalPointHit.clone().sub(a.position).dot(e)}_onEnabledChange(){var a,e,t;if(this._viewer){if(this.enabled){if((a=this._input)==null||a.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.interactionsEnabled=!1;const n=this._viewer.getPluginByType("CameraViews"),i=n==null?void 0:n.camViews.find(s=>s.name===this.cameraView);n&&i&&n.setCurrentCameraView(i),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const n=this._object;n.updateProjectionMatrix(),n.updateMatrixWorld()}(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var a;(a=this._input)==null||a.disconnect()}};co.PluginType="ParallaxCameraControllerPlugin",lo([(0,g.onChange)(T_.prototype._onEnabledChange),ke(),sn("Enabled")],co.prototype,"enabled",void 0),lo([ke(),sn("enableEdit")],co.prototype,"enableEdit",void 0),lo([ke(),sn("Invert")],co.prototype,"invert",void 0),lo([ke(),gn("Sensitivity",[.1,2],.01)],co.prototype,"sensitivity",void 0),lo([ke("focalPoint"),Ks("Focal Point Hit",void 0,.001)],co.prototype,"focalPointHit",void 0),lo([(0,g.onChange)(T_.prototype._onDampingChange),ke(),gn("Damping",[0,1],.001)],co.prototype,"damping",void 0),lo([ke(),gi("Camera View")],co.prototype,"cameraView",void 0),co=T_=lo([Vn("Parallax Camera Controller")],co);var I_=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let jo=class extends Sn{addNoiseBumpMaterial(a){return P_(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new Py(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Yt],this._uniforms={noiseBumpParams:{value:new u.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new u.Ltg(0,1,3,0)},flakeFallOffParams:{value:new u.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._noiseBumpMat)!=null&&t.hasBump)?_c+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(a,e,t)=>{var n;if(!this.enabled||!((n=e.materialObject.userData._noiseBumpMat)!=null&&n.hasBump))return;const i="#glMarker beforeAccumulation";a.fragmentShader=a.fragmentShader.replace(i,`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif

`+i),a.defines.USE_UV="",a.extensionDerivatives=!0},onObjectRender:(a,e)=>{var t;const n=(t=e.materialObject.userData)==null?void 0:t._noiseBumpMat;if(!(n!=null&&n.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(n.bumpNoiseParams),this._uniforms.noiseBumpScale.value=n.bumpScale,this._uniforms.noiseBumpFlakeScale.value=n.flakeScale,this._uniforms.noiseFlakeClamp.value=n.flakeClamp,this._uniforms.noiseFlakeRadius.value=n.flakeRadius,n.flakeParams&&this._uniforms.flakeParams.value.copy(n.flakeParams),n.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(n.flakeFallOffParams),this._uniforms.useColorFlakes.value=n.useColorFlakes;const i=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==i&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=i,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._noiseBumpMat)!=null&&t.hasBump?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.hasBump)||!1},set value(n){var i,s;n!==((i=a.materialObject.userData._noiseBumpMat)==null?void 0:i.hasBump)&&(n?P_(a.materialObject)||e.alert("Cannot add noise bump."):a.materialObject.userData._noiseBumpMat&&(a.materialObject.userData._noiseBumpMat.hasBump=!1,a.materialObject.needsUpdate=!0),(s=t.uiRefresh)==null||s.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var n;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var i;return!((i=a.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"x"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var i;return!((i=a.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"y"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var i;return!((i=a.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"z"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var i;return!((i=a.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"w"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var i;return!((i=a.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var i;return!((i=a.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var i;return!((i=a.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=a.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var n;return!((n=a.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,n,i,s;await super.onAdded(a);const o=a.getPlugin(Yt);(e=o==null?void 0:o.materials)==null||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),(s=(i=(n=o==null?void 0:o.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null||s.push(cE)}async onRemove(a){var e,t,n,i;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=a.getPlugin(Yt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function P_(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const t=e._noiseBumpMat;return t.hasBump=!0,t.bumpNoiseParams===void 0&&(t.bumpNoiseParams=[.5,.5]),t.bumpScale===void 0&&(t.bumpScale=.05),t.flakeScale===void 0&&(t.flakeScale=.05),t.flakeClamp===void 0&&(t.flakeClamp=1),t.flakeRadius===void 0&&(t.flakeRadius=.3),t.useColorFlakes===void 0&&(t.useColorFlakes=!1),t.flakeParams===void 0&&(t.flakeParams=new u.Ltg(0,1,3,0)),t.flakeFallOffParams===void 0&&(t.flakeFallOffParams=new u.Pa4(0,1,0)),a.isMaterial&&(a.needsUpdate=!0),!0}jo.PluginType="NoiseBumpMaterialPlugin",jo.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",I_([sn("Enabled",a=>({onChange:a.setDirty})),ke()],jo.prototype,"enabled",void 0),jo=I_([Vn("NoiseBump Materials")],jo);class Py{constructor(e){this.parser=e,this.name=jo.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),P_(t),t.userData._noiseBumpMat=Yi(i,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const cE=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;t.extensions=t.extensions||{};const n=Fi(e.userData._noiseBumpMat,!1);t.extensions[jo.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=n,a.extensionsUsed[jo.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class Ry extends vi{constructor(e,t){super({vertexShader:O.vertexShader,fragmentShader:t+`
`+Ff+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new u.FM8},cameraNearFar:{value:new u.FM8},lastProjectionViewMatrix:{value:new u.yGw},currentProjectionViewMatrix:{value:new u.yGw},projection:{value:new u.yGw},inverseViewMatrix:{value:new u.yGw},jitterSample:{value:new u.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new u.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,n,i,s){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const o=this.uniforms.tVelocity.value?1:0;o!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=o,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,n,i,s),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}(function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([ke(),bt()],Ry.prototype,"feedBack",void 0);class im extends To{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[Ri],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(na))throw"Add ProgressivePlugin before TAA";const t=new Ry(e.getPlugin(na).lastFrame,e.getPlugin(Ri).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,n=this._pass.passObject;if(n.taaEnabled=t<=1&&e.scene.renderCamera===e.scene.activeCamera,!n.taaEnabled)return!1;const i=e.scene.renderCamera;return n.updateShaderProperties([e.getPlugin(Ri),i,e.getPluginByType("VelocityBuffer")]),n.target=e.getPlugin(na).lastFrame,n.updateCameraProperties(i==null?void 0:i.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){var e;return((e=this._viewer)==null?void 0:e.renderer.stableNoise)??this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){var e;const t=(e=this.pass)==null?void 0:e.passObject.uiConfig;if(t&&t.children)return t.children.includes(this._stableNoiseConfig)||t.children.push(this._stableNoiseConfig),t}}im.PluginType="TAA";var td=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let uo=class extends Sn{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=a=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const t=this._lastFsElement||((e=this._viewer)==null?void 0:e.canvas);t&&(t.style.width=this._lastSize[0],t.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(a){var e;if(this.isFullScreen())return;const t=a||((e=this._viewer)==null?void 0:e.canvas);return t?(this._lastFsElement=t,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[t.style.width,t.style.height],t.style.width="100%",t.style.height="100%",t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(a){return this.isFullScreen()?this.exit():this.enter(a)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};uo.PluginType="FullScreenPlugin",td([Bi("Enter FullScreen")],uo.prototype,"enter",null),td([Bi("Exit FullScreen")],uo.prototype,"exit",null),td([Bi("Toggle FullScreen")],uo.prototype,"toggle",null),uo=td([Vn("Full Screen")],uo);const uE=(a,e)=>{const t={};for(const n of a.mappings)for(const i of n.variants)t[e[i]]={material:null,gltfMaterialIndex:n.material};return t},Ip="KHR_materials_variants";class tx{constructor(e){this.parser=e,this.name=Ip}async afterRoot(e){const t=this.parser,n=t.json;if(!n.extensions||!n.extensions[this.name])return;const i=(s=>{const o=[],l=new Set;for(const h of s){let d=h,f=0;for(;l.has(d);)d=h+"."+ ++f;l.add(d),o.push(d)}return o})((n.extensions[this.name].variants||[]).map(s=>s.name));for(const s of e.scenes)s.traverse(o=>{const l=t.associations.get(o);if(!l||l.meshes===void 0||l.primitives===void 0)return;const h=n.meshes[l.meshes].primitives[l.primitives].extensions;h&&h[this.name]&&(o.userData._variantMaterials=uE(h[this.name],i))});await Promise.all(e.scenes.map(async s=>{const o=[];return s.traverse(l=>{return(h=l).material!==void 0&&h.userData&&h.userData._variantMaterials&&o.push((async d=>{const f=d.material,v=d.userData._variantMaterials,y=[];for(const w in v){const E=v[w];if(E.material)continue;const M=E.gltfMaterialIndex;y.push(t.getDependency("material",M).then(P=>{d.material=P,t.assignFinalMaterial(d),v[w].material=d.material}))}return Promise.all(y).then(()=>{d.material=f})})(l));var h}),s.userData.__importData||(s.userData.__importData={}),s.userData.__importData[Ip]={names:i},Promise.all(o)}))}}const Dy=a=>a.material!==void 0&&a.userData&&a.userData._variantMaterials&&!!Object.values(a.userData._variantMaterials).filter(e=>Pg(e==null?void 0:e.material)),Pg=a=>a&&a.isMaterial&&!Array.isArray(a);class By{constructor(e){this.writer=e,this.name=Ip,this.variantNames=[]}beforeParse(e){const t=new Set;for(const n of e)n.traverse(i=>{if(!Dy(i))return;const s=i.userData._variantMaterials;for(const o in s){const l=s[o];Pg(l.material)&&t.add(o)}});t.forEach(n=>this.variantNames.push(n))}writeMesh(e,t){if(!Dy(e))return;const n=e.userData,i=n._variantMaterials,s={};for(const h in i){const d=i[h].material;if(!Pg(d))continue;const f=this.variantNames.indexOf(h),v=this.writer.processMaterial(d);s[v]||(s[v]={material:v,variants:[]}),s[v].variants.push(f)}const o=Object.values(s).map(h=>h.variants.sort((d,f)=>d-f)&&h).sort((h,d)=>h.material-d.material);if(o.length===0)return;const l=Pg(n._originalMaterial)?this.writer.processMaterial(n._originalMaterial)??-1:-1;for(const h of t.primitives)l>=0&&(h.material=l),h.extensions=h.extensions||{},h.extensions[this.name]={mappings:o}}afterParse(e){if(this.variantNames.length===0)return;const t=this.writer.json;t.extensions=t.extensions||{};const n=this.variantNames.map(i=>({name:i}));t.extensions[this.name]={variants:n},this.writer.extensionsUsed[this.name]=!0}}function R_(a){return new By(a)}class su extends Sn{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Yt],this.variants={},this.selectedVariant="",this._objectAdded=e=>{var t,n;const i=e.object;(i==null?void 0:i.assetType)==="model"&&i.modelObject&&this._viewer&&(i.modelObject.traverse(s=>{var o,l,h,d,f;if(s.userData._variantMaterials)for(const w of Object.values(s.userData._variantMaterials))w!=null&&w.material&&(w.material=((h=(l=(o=this._viewer)==null?void 0:o.getManager())==null?void 0:l.materials)==null?void 0:h.processMaterial(w.material,{}))||w.material);const v=(f=(d=s.userData)==null?void 0:d.__importData)==null?void 0:f[Ip];if(!v)return;const y=v.names||[];for(const w of y)this.variants[w]||(this.variants[w]=[]),this.variants[w].push(s);delete s.userData.__importData[Ip]}),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(e=>e?{label:e}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,n,i,s;await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const o=e.getPlugin(Yt);(t=o==null?void 0:o.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),(s=(i=(n=o==null?void 0:o.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null||s.push(R_)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new tx(t))}async onRemove(e){var t,n,i,s,o,l;e.scene.removeEventListener("addSceneObject",this._objectAdded);const h=e.getPlugin(Yt);(t=h.importer)==null||t.removeEventListener("loaderCreate",this._loaderCreate);const d=(s=(i=(n=h.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null?void 0:s.indexOf(R_);return d!==void 0&&d!==-1&&((l=(o=h.exporter.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||l.splice(d,1)),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,t=!1,n,i=!0){if(!t&&!n&&this.selectedVariant===e||!e)return;n||(this.selectedVariant=e);const s=n?Array.isArray(n)?n:[n]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const o of s){const l=new Set,h=d=>{var f,v;if(!d.userData._variantMaterials||l.has(d))return;const y=e?(f=d.userData._variantMaterials[e])==null?void 0:f.material:d.userData._originalMaterial;y&&(d.userData._originalMaterial||(d.userData._originalMaterial=d.material),(v=d==null?void 0:d.setMaterial)==null||v.call(d,y)),l.add(d)};i?o.traverse(h):h(o)}}}su.PluginType="GLTFKHRMaterialVariantsPlugin",function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([(0,g.onChange)(su.prototype._variantChanged)],su.prototype,"selectedVariant",void 0);function rm(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const t=e._ssBevel;return t.hasSSBevel=!0,t.radius===void 0&&(t.radius=0),a.isMaterial&&(a.needsUpdate=!0),!0}let sm=class extends vi{constructor(a,e,t,n){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new u.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new u.Pa4(1,1,1)}},vertexShader:ro,fragmentShader:`

            ${t}

            ${_c}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(i,s,o)=>{var l,h;this.enabled&&((h=(l=s.materialObject.userData)==null?void 0:l._ssBevel)!=null&&h.hasSSBevel)&&(i.fragmentShader=_n(i.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(i,s,o)=>{var l,h;if(!this.enabled||!((h=(l=s.materialObject.userData)==null?void 0:l._ssBevel)!=null&&h.hasSSBevel))return;const d=s.materialObject,f=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==f&&(this.materialExtension.extraUniforms.tSSBevelMap.value=f,d.needsUpdate=!0)},getUiConfig:i=>{const s={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var o;return((o=i.materialObject.userData._ssBevel)==null?void 0:o.hasSSBevel)||!1},set value(o){var l,h;o!==((l=i.materialObject.userData._ssBevel)==null?void 0:l.hasSSBevel)&&(o?rm(i.materialObject)||alert("Cannot add screen space bevel."):i.materialObject.userData._ssBevel&&(i.materialObject.userData._ssBevel.hasSSBevel=!1,i.materialObject.needsUpdate=!0),(h=s.uiRefresh)==null||h.call(s,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var o;return!((o=i.materialObject.userData._ssBevel)!=null&&o.hasSSBevel)},property:[i.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return s},parsFragmentSnippet:(i,s)=>{var o,l;return this.enabled&&((l=(o=s==null?void 0:s.materialObject.userData)==null?void 0:o._ssBevel)!=null&&l.hasSSBevel)?g.glsl`
            uniform sampler2D tSSBevelMap;
            ${eg}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:i=>{var s,o;return(this.enabled?"1":"0")+((o=(s=i.materialObject.userData)==null?void 0:s._ssBevel)!=null&&o.hasSSBevel?"1":"0")},isCompatible:i=>i.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=n,this._edgeMaterial=new zc({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new u.FM8(1,1)},cameraPositionWorld:{value:new u.Pa4(1,1,1)}},vertexShader:ro,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new zc({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new u.FM8(.5,.5)},direction:{value:new u.FM8(.5,.5)}},vertexShader:ro,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(a,e,t,n,i){var s,o;if(!this.enabled)return;const l=a.baseRenderer,h={minFilter:u.wem,magFilter:u.wem,isAntialiased:!1,format:u.wk1,depthBuffer:!1,generateMipmaps:!1},d=l.getTempTarget(h);this._renderEdges(l,d),this._blurEdges(l,d),this._viewerApp.scene.renderCamera.updateShaderProperties(this.material),(s=this._viewerApp.getPlugin(Ri))==null||s.updateShaderProperties(this.material),(o=this._viewerApp.getPlugin(hl))==null||o.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=d.texture,super.render(a,this._target,d,n,i),l.releaseTempTarget(d)}_initsamples(){const a=[];return a.push(new u.FM8(-8,0).multiplyScalar(.125)),a.push(new u.FM8(-6,-4).multiplyScalar(.125)),a.push(new u.FM8(-3,-2).multiplyScalar(.125)),a.push(new u.FM8(-2,-6).multiplyScalar(.125)),a.push(new u.FM8(1,-1).multiplyScalar(.125)),a.push(new u.FM8(2,-5).multiplyScalar(.125)),a.push(new u.FM8(6,-7).multiplyScalar(.125)),a.push(new u.FM8(5,-3).multiplyScalar(.125)),a.push(new u.FM8(4,1).multiplyScalar(.125)),a.push(new u.FM8(7,4).multiplyScalar(.125)),a.push(new u.FM8(3,5).multiplyScalar(.125)),a.push(new u.FM8(0,7).multiplyScalar(.125)),a.push(new u.FM8(-1,3).multiplyScalar(.125)),a.push(new u.FM8(-4,6).multiplyScalar(.125)),a.push(new u.FM8(-7,8).multiplyScalar(.125)),a.push(new u.FM8(-5,2).multiplyScalar(.125)),a}_blurEdges(a,e){var t,n;const i={minFilter:u.wem,magFilter:u.wem,isAntialiased:!1,format:u.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},s=a.getTempTarget(i),o=((t=e.texture.image)==null?void 0:t.width)||1,l=((n=e.texture.image)==null?void 0:n.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new u.FM8(o,l),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new u.FM8(1,0),a.blit(void 0,s,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new u.FM8(o/2,l/2),this._separableBlurMaterial.uniforms.colorTexture.value=s.texture,this._separableBlurMaterial.uniforms.direction.value=new u.FM8(0,1),a.blit(void 0,e,{material:this._separableBlurMaterial}),a.releaseTempTarget(s)}_renderEdges(a,e){var t,n,i,s;const o=((t=e.texture.image)==null?void 0:t.width)||1,l=((n=e.texture.image)==null?void 0:n.height)||1;this._edgeMaterial.uniforms.screenSize.value=new u.FM8(o,l),this._viewerApp.scene.renderCamera.updateShaderProperties(this._edgeMaterial),(i=this._viewerApp.getPlugin(Ri))==null||i.updateShaderProperties(this._edgeMaterial),(s=this._viewerApp.getPlugin(hl))==null||s.updateShaderProperties(this._edgeMaterial),a.blit(void 0,e,{material:this._edgeMaterial})}};sm=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([Vn("SSBevel")],sm);class Ec extends To{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Yt,Ri,hl],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new nx(t))}passCtor(e){var t;return this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:u.cLu,minFilter:u.TyD,magFilter:u.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1,e.getPluginByType("debug"),new sm(e.renderer,this._bevelTarget,((t=e.getPlugin(Ri))==null?void 0:t.getUnpackSnippet())??"",e)}async onAdded(e){var t,n,i,s,o,l,h,d;await super.onAdded(e);const f=e.getPlugin(Yt);return(t=this.pass)!=null&&t.passObject.materialExtension&&((i=f==null?void 0:f.materials)==null||i.registerMaterialExtension((n=this.pass)==null?void 0:n.passObject.materialExtension)),(s=f==null?void 0:f.importer)==null||s.addEventListener("loaderCreate",this._loaderCreate),(h=(l=(o=f==null?void 0:f.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:l.extensions)==null||h.push(hE),(d=e.getPlugin(Ri))==null||d.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,n,i;(e=this._viewer)==null||e.setDirty(),(i=(t=this.pass)==null?void 0:(n=t.passObject.materialExtension).setDirty)==null||i.call(n)}_update(e){var t,n;let i=this.enabled;if(i&&!this._lastEnabled){const s=(t=this._viewer)==null?void 0:t.getPluginByType("NormalBufferPlugin");s&&!s.enabled&&(s.enabled=!0),s||((n=this._viewer)==null||n.console.error("SSBevelPlugin needs NormalBufferPlugin"))}return this._lastEnabled=i,i}get uiConfig(){var e,t,n,i;const s=((t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig)??{};return(i=(n=s.children)==null?void 0:n.map(o=>(0,g.getOrCall)(o)))==null||i.flat(2).forEach(o=>o&&(o.onChange=this.setDirty)),s}updateGBuffer(e,t){var n,i,s;if(e instanceof u.Kj0&&((n=e.material)!=null&&n.userData)){for(let l=3;l<8;l++)t.y=hb(t.y,l);let o=(i=e.material)!=null&&i.userData._ssBevel?(s=e.material)==null?void 0:s.userData._ssBevel.radius:0;o=Math.min(o,31),o<<=3,t.y=t.y|o}}}Ec.PluginType="SSBevelPlugin",Ec.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class nx{constructor(e){this.parser=e,this.name=Ec.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),rm(t),t.userData._ssBevel=Yi(i,t.userData._ssBevel,!1,{}),Promise.resolve()}}const hE=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;t.extensions=t.extensions||{};const n=Fi(e.userData._ssBevel,!1);t.extensions[Ec.SSBEVEL_GLTF_EXTENSION]=n,a.extensionsUsed[Ec.SSBEVEL_GLTF_EXTENSION]=!0}});class ix{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=_n(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class D_ extends Ou{generateExtension(e){return new ix}}D_.PluginType="GammaCorrection";var Ly=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Sc=class extends Sn{addTriplanarMapping(a){var e;const t=(e=a.materialObject)==null?void 0:e.userData;return!!t&&(t._triplanarMapping||(t._triplanarMapping={}),t._triplanarMapping.enable=!0,t._triplanarMapping.scaleFactor===void 0&&(t._triplanarMapping.scaleFactor=1),t._triplanarMapping.blendFactor===void 0&&(t._triplanarMapping.blendFactor=1),t._triplanarMapping.offsetFactor===void 0&&(t._triplanarMapping.offsetFactor=0),a.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new B_(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Yt],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(a,e,t)=>{var n,i;if(!this.enabled||!((i=(n=e.materialObject.userData)==null?void 0:n._triplanarMapping)!=null&&i.enable))return;const s=g.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;a.vertexShader=_n(a.vertexShader,"#include <common>",s,{prepend:!0});const o=g.glsl`
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz;
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;a.vertexShader=_n(a.vertexShader,"#include <worldpos_vertex>",o,{append:!0});const l=g.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;a.fragmentShader=_n(a.fragmentShader,"#include <common>",l,{prepend:!0});const h=g.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;a.fragmentShader=_n(a.fragmentShader,"#include <bumpmap_pars_fragment>",h);let d=_n(u.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");a.fragmentShader=_n(a.fragmentShader,"#include <map_fragment>",d),d=_n(u.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),a.fragmentShader=_n(a.fragmentShader,"#include <roughnessmap_fragment>",d),d=_n(u.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),a.fragmentShader=_n(a.fragmentShader,"#include <metalnessmap_fragment>",d),d=_n(u.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),a.fragmentShader=_n(a.fragmentShader,"#include <normal_fragment_maps>",d),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var t,n,i,s;const o=e.materialObject.userData;if(!((t=o==null?void 0:o._triplanarMapping)!=null&&t.enable))return;const l=a;l.isMesh&&l.geometry&&(this._uniforms.triplanarScale.value=(n=o._triplanarMapping)==null?void 0:n.scaleFactor,this._uniforms.triplanarBlend.value=(i=o._triplanarMapping)==null?void 0:i.blendFactor,this._uniforms.triplanarOffset.value=(s=o._triplanarMapping)==null?void 0:s.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._triplanarMapping)!=null&&t.enable?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>{var a;return[(a=this._viewer)==null?void 0:a.renderer]},getUiConfig:a=>{const e=this._viewer,t=this.addTriplanarMapping,n={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var i;return((i=a.materialObject.userData._triplanarMapping)==null?void 0:i.enable)||!1},set value(i){var s,o;i!==((s=a.materialObject.userData._triplanarMapping)==null?void 0:s.enable)&&(i?t(a)||e.alert("Cannot add Triplanar mapping."):a.materialObject.userData._triplanarMapping&&(a.materialObject.userData._triplanarMapping.enable=!1,a.materialObject.needsUpdate=!0),(o=n.uiRefresh)==null||o.call(n,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var i;return!((i=a.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[a.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var i;return!((i=a.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[a.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var i;return!((i=a.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[a.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,n,i,s;await super.onAdded(a);const o=a.getPlugin(Yt);(e=o==null?void 0:o.materials)==null||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),(s=(i=(n=o==null?void 0:o.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null||s.push(Oy)}async onRemove(a){var e,t,n,i;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=a.getPlugin(Yt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};Sc.PluginType="TriplanarUVMappingPlugin",Sc.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",Ly([sn("Enabled",a=>({onChange:a.setDirty})),ke()],Sc.prototype,"enabled",void 0),Sc=Ly([Vn("Triplanar Mapping")],Sc);class B_{constructor(e){this.parser=e,this.name=Sc.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];t.userData||(t.userData={});const s=t.userData;return s._triplanarMapping||(s._triplanarMapping={}),s._triplanarMapping.enable=!0,s._triplanarMapping.scaleFactor===void 0&&(s._triplanarMapping.scaleFactor=1),s._triplanarMapping.blendFactor===void 0&&(s._triplanarMapping.blendFactor=1),s._triplanarMapping.offsetFactor===void 0&&(s._triplanarMapping.offsetFactor=0),t.userData._triplanarMapping=Yi(i,t.userData._triplanarMapping,!1,{}),Promise.resolve()}}const Oy=a=>({writeMaterial:(e,t)=>{var n;if(!e.isMeshStandardMaterial||!((n=e.userData._triplanarMapping)!=null&&n.enable))return;t.extensions=t.extensions||{};const i=Fi(e.userData._triplanarMapping,!1);t.extensions[Sc.TRIPLANAR_GLTF_EXTENSION]=i,a.extensionsUsed[Sc.TRIPLANAR_GLTF_EXTENSION]=!0}});var rx=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ql=class extends Sn{addClearcoatTint(a){return ky(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new sx(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Yt],this._defines={},this._uniforms={ccTintColor:{value:new er},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&t.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(a,e,t)=>{var n;if(!(this.enabled&&((n=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&n.enableTint)&&e.materialObject.clearcoat>0))return;const i="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",s="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";a.fragmentShader.includes(s)&&a.fragmentShader.includes(i)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),a.fragmentShader=a.fragmentShader.replace(s,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),a.fragmentShader=a.fragmentShader.replace(i,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+i),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var t;const n=(t=e.materialObject.userData)==null?void 0:t._clearcoatTint;if(!(n!=null&&n.enableTint))return;this._uniforms.ccTintColor.value.set(n.tintColor),this._uniforms.ccThickness.value=n.thickness,this._uniforms.ccIor.value=n.ior;const i=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==i&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=i,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+((t=(e=a.materialObject.userData)==null?void 0:e._clearcoatTint)!=null&&t.enableTint?"1":"0")+(a.materialObject.clearcoat>0?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=a.materialObject.userData._clearcoatTint)==null?void 0:n.enableTint)||!1},set value(n){var i,s;n!==((i=a.materialObject.userData._clearcoatTint)==null?void 0:i.enableTint)&&(n?ky(a.materialObject)||e.alert("Cannot add clearcoat tint."):a.materialObject.userData._clearcoatTint&&(a.materialObject.userData._clearcoatTint.enableTint=!1,a.materialObject.needsUpdate=!0),(s=t.uiRefresh)==null||s.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var n;return!((n=a.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[a.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var n;return!((n=a.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[a.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var n;return!((n=a.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[a.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,n,i,s;await super.onAdded(a);const o=a.getPlugin(Yt);(e=o==null?void 0:o.materials)==null||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),(s=(i=(n=o==null?void 0:o.exporter)==null?void 0:n.getExporter("gltf","glb"))==null?void 0:i.extensions)==null||s.push(ax)}async onRemove(a){var e,t,n,i;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=a.getPlugin(Yt))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function ky(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const t=e._clearcoatTint;return t.enableTint=!0,t.tintColor===void 0&&(t.tintColor=16777215),t.thickness===void 0&&(t.thickness=.1),t.ior===void 0&&(t.ior=1.5),a.isMaterial&&(a.needsUpdate=!0),!0}Ql.PluginType="ClearcoatTintPlugin",Ql.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",rx([sn("Enabled",a=>({onChange:a.setDirty})),ke()],Ql.prototype,"enabled",void 0),Ql=rx([Vn("ClearcoatTint Materials")],Ql);class sx{constructor(e){this.parser=e,this.name=Ql.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),ky(t),Yi(i,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const ax=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;t.extensions=t.extensions||{};const n=Fi(e.userData._clearcoatTint,!1);t.extensions[Ql.CLEARCOAT_TINT_GLTF_EXTENSION]=n,a.extensionsUsed[Ql.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class Pp{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:i,msg:s,transfer:o}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(s,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class dE{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class am{constructor(e,t,n,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const Qa=[171,75,84,88,32,50,48,187,13,10,26,10];function nd(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}let L_,Yu,Ku;const Uy={env:{emscripten_notify_memory_growth:function(a){Ku=new Uint8Array(Yu.exports.memory.buffer)}}};class ox{init(){return L_||(L_=typeof fetch<"u"?fetch("data:application/wasm;base64,"+id).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Uy)).then(this._init):WebAssembly.instantiate(Buffer.from(id,"base64"),Uy).then(this._init),L_)}_init(e){Yu=e.instance,Uy.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Yu)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=Yu.exports.malloc(n);Ku.set(e,i),t=t||Number(Yu.exports.ZSTD_findDecompressedSize(i,n));const s=Yu.exports.malloc(t),o=Yu.exports.ZSTD_decompress(s,t,i,n),l=Ku.slice(s,s+o);return Yu.exports.free(i),Yu.exports.free(s),l}}const id="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",O_=new WeakMap;let Ny,Ju=0;class au extends u.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Pp,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new u.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new u.hH6(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([s,o])=>{const l=au.BasisWorker,h=["/* constants */","let _EngineFormat = "+JSON.stringify(au.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(au.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(au.BasisFormat),"/* basis_transcoder.js */",s,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([h])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const d=new Worker(this.workerSourceURL),f=this.transcoderBinary.slice(0);return d.postMessage({type:"init",config:this.workerConfig,transcoderBinary:f},[f]),d})}),Ju>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Ju++}return this.transcoderPending}load(e,t,n,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new u.hH6(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,o=>{if(O_.has(o))return O_.get(o).promise.then(t).catch(i);this.createTexture(o).then(l=>t?t(l):null).catch(i)},n,i)}_createTextureFrom(e,t){const{mipmaps:n,width:i,height:s,format:o,type:l,error:h,dfdTransferFn:d,dfdFlags:f}=e;if(l==="error")return Promise.reject(h);const v=t.layerCount>1?new u.Z_g(n,i,s,t.layerCount,o,u.ywz):new u.EB7(n,i,s,o,u.ywz);return v.minFilter=n.length===1?u.wem:u.D1R,v.magFilter=u.wem,v.generateMipmaps=!1,v.needsUpdate=!0,v.colorSpace=d===2?u.KI_:u.aCh,v.premultiplyAlpha=!!(1&f),v}async createTexture(e,t={}){const n=function(o){const l=new Uint8Array(o.buffer,o.byteOffset,Qa.length);if(l[0]!==Qa[0]||l[1]!==Qa[1]||l[2]!==Qa[2]||l[3]!==Qa[3]||l[4]!==Qa[4]||l[5]!==Qa[5]||l[6]!==Qa[6]||l[7]!==Qa[7]||l[8]!==Qa[8]||l[9]!==Qa[9]||l[10]!==Qa[10]||l[11]!==Qa[11])throw new Error("Missing KTX 2.0 identifier.");const h=new dE,d=17*Uint32Array.BYTES_PER_ELEMENT,f=new am(o,Qa.length,d,!0);h.vkFormat=f._nextUint32(),h.typeSize=f._nextUint32(),h.pixelWidth=f._nextUint32(),h.pixelHeight=f._nextUint32(),h.pixelDepth=f._nextUint32(),h.layerCount=f._nextUint32(),h.faceCount=f._nextUint32();const v=f._nextUint32();h.supercompressionScheme=f._nextUint32();const y=f._nextUint32(),w=f._nextUint32(),E=f._nextUint32(),M=f._nextUint32(),P=f._nextUint64(),L=f._nextUint64(),R=new am(o,Qa.length+d,3*v*8,!0);for(let Nt=0;Nt<v;Nt++)h.levels.push({levelData:new Uint8Array(o.buffer,o.byteOffset+R._nextUint64(),R._nextUint64()),uncompressedByteLength:R._nextUint64()});const I=new am(o,y,w,!0),N={vendorId:I._skip(4)._nextUint16(),descriptorType:I._nextUint16(),versionNumber:I._nextUint16(),descriptorBlockSize:I._nextUint16(),colorModel:I._nextUint8(),colorPrimaries:I._nextUint8(),transferFunction:I._nextUint8(),flags:I._nextUint8(),texelBlockDimension:[I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8()],bytesPlane:[I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8()],samples:[]},j=(N.descriptorBlockSize/4-6)/4;for(let Nt=0;Nt<j;Nt++){const Bt={bitOffset:I._nextUint16(),bitLength:I._nextUint8(),channelType:I._nextUint8(),samplePosition:[I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Bt.channelType?(Bt.sampleLower=I._nextInt32(),Bt.sampleUpper=I._nextInt32()):(Bt.sampleLower=I._nextUint32(),Bt.sampleUpper=I._nextUint32()),N.samples[Nt]=Bt}h.dataFormatDescriptor.length=0,h.dataFormatDescriptor.push(N);const H=new am(o,E,M,!0);for(;H._offset<M;){const Nt=H._nextUint32(),Bt=H._scan(Nt),rn=nd(Bt),hn=H._scan(Nt-Bt.byteLength);h.keyValue[rn]=rn.match(/^ktx/i)?nd(hn):hn,H._offset%4&&H._skip(4-H._offset%4)}if(L<=0)return h;const X=new am(o,P,L,!0),ne=X._nextUint16(),pe=X._nextUint16(),Ae=X._nextUint32(),ve=X._nextUint32(),Ee=X._nextUint32(),xe=X._nextUint32(),we=[];for(let Nt=0;Nt<v;Nt++)we.push({imageFlags:X._nextUint32(),rgbSliceByteOffset:X._nextUint32(),rgbSliceByteLength:X._nextUint32(),alphaSliceByteOffset:X._nextUint32(),alphaSliceByteLength:X._nextUint32()});const Re=P+X._offset,Be=Re+Ae,Oe=Be+ve,at=Oe+Ee,st=new Uint8Array(o.buffer,o.byteOffset+Re,Ae),St=new Uint8Array(o.buffer,o.byteOffset+Be,ve),dt=new Uint8Array(o.buffer,o.byteOffset+Oe,Ee),ht=new Uint8Array(o.buffer,o.byteOffset+at,xe);return h.globalData={endpointCount:ne,selectorCount:pe,imageDescs:we,endpointsData:st,selectorsData:St,tablesData:dt,extendedData:ht},h}(new Uint8Array(e));if(n.vkFormat!==0)return async function(o){const{vkFormat:l,pixelWidth:h,pixelHeight:d,pixelDepth:f}=o;if(lx[l]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const v=o.levels[0];let y,w;if(o.supercompressionScheme===0)y=v.levelData;else{if(o.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Ny||(Ny=new Promise(async M=>{const P=new ox;await P.init(),M(P)})),y=(await Ny).decode(v.levelData,v.uncompressedByteLength)}w=k_[l]===u.VzW?new Float32Array(y.buffer,y.byteOffset,y.byteLength/Float32Array.BYTES_PER_ELEMENT):k_[l]===u.cLu?new Uint16Array(y.buffer,y.byteOffset,y.byteLength/Uint16Array.BYTES_PER_ELEMENT):y;const E=f===0?new u.IEO(w,h,d):new u.JUT(w,h,d,f);return E.type=k_[l],E.format=lx[l],E.colorSpace=Fy[l]||u.aCh,E.needsUpdate=!0,Promise.resolve(E)}(n);const i=t,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e])).then(o=>this._createTextureFrom(o.data,n));return O_.set(e,{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Ju--,this}}au.BasisFormat={ETC1S:0,UASTC_4x4:1},au.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},au.EngineFormat={RGBAFormat:u.wk1,RGBA_ASTC_4x4_Format:u.ptH,RGBA_BPTC_Format:u.bsb,RGBA_ETC2_EAC_Format:u.ekQ,RGBA_PVRTC_4BPPV1_Format:u.eaV,RGBA_S3TC_DXT5_Format:u.ILR,RGB_ETC1_Format:u.fto,RGB_ETC2_Format:u.l0P,RGB_PVRTC_4BPPV1_Format:u._AM,RGB_S3TC_DXT1_Format:u.wuA},au.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );

						const buffers = [];

						for ( let i = 0; i < mipmaps.length; ++ i ) {

							buffers.push( mipmaps[ i ].data.buffer );

						}

						self.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layers = ktx2File.getLayers() || 1;
		const levels = ktx2File.getLevels();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdTransferFn = ktx2File.getDFDTransferFunc();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levels ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const mipmaps = [];

		for ( let mip = 0; mip < levels; mip ++ ) {

			const layerMips = [];

			let mipWidth, mipHeight;

			for ( let layer = 0; layer < layers; layer ++ ) {

				const levelInfo = ktx2File.getImageLevelInfo( mip, layer, 0 );
				mipWidth = levelInfo.origWidth < 4 ? levelInfo.origWidth : levelInfo.width;
				mipHeight = levelInfo.origHeight < 4 ? levelInfo.origHeight : levelInfo.height;
				const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
				const status = ktx2File.transcodeImage(
					dst,
					mip,
					layer,
					0,
					transcoderFormat,
					0,
					- 1,
					- 1,
				);

				if ( ! status ) {

					cleanup();
					throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

				}

				layerMips.push( dst );

			}

			mipmaps.push( { data: concat( layerMips ), width: mipWidth, height: mipHeight } );

		}

		cleanup();

		return { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const lx={109:u.wk1,97:u.wk1,37:u.wk1,43:u.wk1,103:u.av9,83:u.av9,16:u.av9,22:u.av9,100:u.hEm,76:u.hEm,15:u.hEm,9:u.hEm},k_={109:u.VzW,97:u.cLu,37:u.ywz,43:u.ywz,103:u.VzW,83:u.cLu,16:u.ywz,22:u.ywz,100:u.VzW,76:u.cLu,15:u.ywz,9:u.ywz},Fy={43:u.KI_,22:u.KI_,15:u.KI_},zy="KHR_texture_basisu";class rd extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Yt]}async onAdded(e){var t,n,i,s,o,l;this._importer||(this._importer=new yr(class extends au{constructor(h){super(h),this.setTranscoderPath(rd.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(h,d){const f=new Uint8Array(h.slice(0)),v=await super.createTexture(h,d);return v.source._sourceImgBuffer=f,v.userData.mimeType="image/ktx2",v.toJSON=y=>uf(v,y,v.name,"image/ktx2"),v.clone=()=>{throw new Error("ktx2 texture cloning not supported")},v}},["ktx2"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer),(l=(o=(s=(i=e.getManager())==null?void 0:i.exporter)==null?void 0:s.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||l.push(pE)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}rd.PluginType="KTX2LoadPlugin",rd.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const pE=a=>({writeTexture:(e,t)=>{if(e.userData.mimeType!=="image/ktx2")return;if(t.source!==void 0&&t.source!==null)return void console.warn("ktx2 export: source already set");const n=e.source._sourceImgBuffer||e.userData.__sourceBuffer;if(!n)return void console.warn("ktx2 export: no source buffer for ktx2");t.extensions=t.extensions||{};const i={},s=new Blob([n],{type:"image/ktx2"});i.source=a.processImageBlob(s,e),t.extensions[zy]=i,a.extensionsUsed[zy]=!0}});var fE=__webpackgi_require__2(701),om=__webpackgi_require__2.n(fE),$i=__webpackgi_require__2(236),lm=__webpackgi_require__2.n($i),cx=__webpackgi_require__2(850),cm=__webpackgi_require__2.n(cx),mE=__webpackgi_require__2(182),sd=__webpackgi_require__2.n(mE),gE=__webpackgi_require__2(213),um=__webpackgi_require__2.n(gE),U_=__webpackgi_require__2(44),Rg={};U_.Z&&U_.Z.locals&&(Rg.locals=U_.Z.locals);var jy,N_=0,Zu={};Zu.styleTagTransform=um(),Zu.setAttributes=cm(),Zu.insert=function(a,e){(e.target||document.head).appendChild(a)},Zu.domAPI=lm(),Zu.insertStyleElement=sd(),Rg.use=function(a){return Zu.options=a||{},N_++||(jy=om()(U_.Z,Zu)),Rg},Rg.unuse=function(){N_>0&&!--N_&&(jy(),jy=null)};var vE=Rg;class Dg extends Sn{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e){super(),this.enabled=!0,this.dependencies=[Yt],this._mainDiv=(0,g.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,g.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){var t,n,i,s,o,l,h,d;await super.onAdded(e),e.container.appendChild(this._mainDiv);const f=new Map;this._updateMainDiv(f),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.addEventListener("importFile",v=>{v.state!=="done"?f.set(v.path,{state:v.state,progress:v.progress?100*v.progress:void 0}):f.delete(v.path),this._updateMainDiv(f)}),(s=(i=e.getManager())==null?void 0:i.exporter)==null||s.addEventListener("exportFile",v=>{v.state!=="done"?f.set(v.obj.name,{state:v.state,progress:v.progress?100*v.progress:void 0}):f.delete(v.obj.name),this._updateMainDiv(f)}),(o=e.getPluginByType("FileTransferPlugin"))==null||o.addEventListener("transferFile",v=>{v.state!=="done"?f.set(v.path,{state:v.state,progress:v.progress?100*v.progress:void 0}):f.delete(v.path),this._updateMainDiv(f)}),(l=e.getPluginByType("MaterialConfiguratorPlugin"))==null||l.addEventListener("progress",v=>{v.state!=="done"?f.set("MatpreviewGeneration",{state:v.state,progress:0}):f.delete("MatpreviewGeneration"),this._updateMainDiv(f)}),(h=e.getPluginByType("SwitchNodePlugin"))==null||h.addEventListener("progress",v=>{v.state!=="done"?f.set("SwitchNodeGeneration",{state:v.state,progress:0}):f.delete("SwitchNodeGeneration"),this._updateMainDiv(f)}),(d=e.getPluginByType("ThemePlugin"))==null||d.addEventListener("progress",v=>{v.state!=="done"?f.set("ThemeInit",{state:v.state,progress:0}):f.delete("ThemeInit"),this._updateMainDiv(f)})}}(function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([sn("Enabled"),(0,g.onChange)(Dg.prototype._onEnabledChange),ke()],Dg.prototype,"enabled",void 0);let ad=class extends Dg{constructor(a=!0){super("LoadingBar"),this.showText=a}_updateMainDiv(a){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,t=1;a.forEach((n,i)=>{e+=n.progress??99,t+=100}),this._contentDiv.innerHTML=this.showText?(100*e/t).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/t).toFixed(0)+"%",a.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(a){vE.use({target:a.container}),await super.onAdded(a)}};ad.PluginType="AssetManagerLoadingBarPlugin",ad=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([Vn("Asset manager loading bar")],ad);var F_=__webpackgi_require__2(798),hm={};F_.Z&&F_.Z.locals&&(hm.locals=F_.Z.locals);var dm,Vy=0,od={};od.styleTagTransform=um(),od.setAttributes=cm(),od.insert=function(a,e){(e.target||document.head).appendChild(a)},od.domAPI=lm(),od.insertStyleElement=sd(),hm.use=function(a){return od.options=a||{},Vy++||(dm=om()(F_.Z,od)),hm},hm.unuse=function(){Vy>0&&!--Vy&&(dm(),dm=null)};var _E=hm;let ho=class extends Dg{constructor(){super("Popup");const a=(0,g.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});a.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(a)}_updateMainDiv(a){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";a.forEach((t,n)=>{e+=`<span class="processState">${t.state}</span>: ${(n||"").split("/").pop()} ${t.progress?" - "+t.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,a.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(a){_E.use({target:a.container}),await super.onAdded(a)}};ho.PluginType="AssetManagerBasicPopupPlugin",ho=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([Vn("Asset manager popup")],ho);class Wl extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postRender)}addTexture(e,t,n,i,s,o="postRender",l=!1){var h;this._generators.has(o)||this._generators.set(o,[]),(h=this._generators.get(o))==null||h.push({key:e,fn:t,rect:n?[...n]:void 0,frag:s||i||l?new u.jyz({vertexShader:O.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:s??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${l?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${l?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${i??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,t="postRender"){var n;this._generators.set(t,((n=this._generators.get(t))==null?void 0:n.filter(i=>i.key!==e))??[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var t;const n=this._viewer,i=n==null?void 0:n.renderer;i&&n&&((t=this._generators.get(e))==null||t.forEach(({key:s,fn:o,rect:l,frag:h})=>{const d=o(n);if(d){if(d.image&&l){const f=d.image.width/d.image.height;l[2]<1&&l[3]<1&&(l[2]=200),l[2]<1&&(l[2]=l[3]*f),l[3]<1&&(l[3]=l[2]/f)}i.blit(d,void 0,{viewport:l,clear:!1,material:h})}}))}}Wl.PluginType="debug";class z_ extends u.aNw{constructor(e){super(e)}load(e,t,n,i){const s=this,o=this.path===""?u.Zp0.extractUrlBase(e):this.path,l=new u.hH6(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(h){try{t(s.parse(h,o))}catch(d){i?i(d):console.error(d),s.manager.itemError(e)}},n,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let i={};const s=/\s+/,o={};for(let h=0;h<n.length;h++){let d=n[h];if(d=d.trim(),d.length===0||d.charAt(0)==="#")continue;const f=d.indexOf(" ");let v=f>=0?d.substring(0,f):d;v=v.toLowerCase();let y=f>=0?d.substring(f+1):"";if(y=y.trim(),v==="newmtl")i={name:y},o[y]=i;else if(v==="ka"||v==="kd"||v==="ks"||v==="ke"){const w=y.split(s,3);i[v]=[parseFloat(w[0]),parseFloat(w[1]),parseFloat(w[2])]}else i[v]=y}const l=new yE(this.resourcePath||t,this.materialOptions);return l.setCrossOrigin(this.crossOrigin),l.setManager(this.manager),l.setMaterials(o),l}}class yE{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:u.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:u.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const i=e[n],s={};t[n]=s;for(const o in i){let l=!0,h=i[o];const d=o.toLowerCase();switch(d){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(h=[h[0]/255,h[1]/255,h[2]/255]),this.options&&this.options.ignoreZeroRGBs&&h[0]===0&&h[1]===0&&h[2]===0&&(l=!1)}l&&(s[d]=h)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,n=this.materialsInfo[e],i={name:e,side:this.side};async function s(h,d){if(i[h])return;const f=t.getTextureParams(d,i);return new Promise((v,y)=>{let w=!1,E=()=>!w&&(w=!0)&&v();const M=t.loadTexture((P=t.baseUrl,typeof(L=f.url)!="string"||L===""?"":/^https?:\/\//i.test(L)?L:P+L),void 0,R=>{i[h]=R,E()},void 0,E);var P,L;setTimeout(E,50),M.repeat.copy(f.scale),M.offset.copy(f.offset),M.wrapS=t.wrap,M.wrapT=t.wrap,h!=="map"&&h!=="emissiveMap"||(M.colorSpace=u.KI_)})}const o=Array.from(Object.keys(n||{}));let l=o.includes("d")||o.includes("D");for(const h of o){const d=n[h];let f;if(d!=="")switch(h.toLowerCase()){case"kd":i.color=new u.Ilk().fromArray(d).convertSRGBToLinear();break;case"ks":i.specular=new u.Ilk().fromArray(d).convertSRGBToLinear();break;case"ke":i.emissive=new u.Ilk().fromArray(d).convertSRGBToLinear();break;case"map_kd":await s("map",d);break;case"map_ks":await s("specularMap",d);break;case"map_ke":await s("emissiveMap",d);break;case"norm":await s("normalMap",d);break;case"map_bump":case"bump":await s("bumpMap",d);break;case"map_d":await s("alphaMap",d),i.transparent=!0;break;case"ns":i.shininess=parseFloat(d);break;case"d":f=parseFloat(d),f<1&&(i.opacity=f,i.transparent=!0);break;case"tr":if(l)break;f=parseFloat(d),this.options&&this.options.invertTrProperty&&(f=1-f),f>0&&(i.opacity=1-f,i.transparent=!0)}}return this.materials[e]=new u.xoR(i),this.materials[e]}getTextureParams(e,t){const n={scale:new u.FM8(1,1),offset:new u.FM8(0,0)},i=e.split(/\s+/);let s;return s=i.indexOf("-bm"),s>=0&&(t.bumpScale=parseFloat(i[s+1]),i.splice(s,2)),s=i.indexOf("-s"),s>=0&&(n.scale.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),s=i.indexOf("-o"),s>=0&&(n.offset.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),n.url=i.join(" ").trim(),n}loadTexture(e,t,n,i,s){const o=this.manager!==void 0?this.manager:u.tEQ;let l=o.getHandler(e);l===null&&(l=new u.dpR(o)),l.setCrossOrigin&&l.setCrossOrigin(this.crossOrigin);const h=l.load(e,n,i,s);return t!==void 0&&(h.mapping=t),h}}const ux=/^[og]\s*(.+)?/,AE=/^mtllib /,bE=/^usemtl /,hx=/^usemap /,Gy=/\s+/,dx=new u.Pa4,Hy=new u.Pa4,px=new u.Pa4,Qy=new u.Pa4,po=new u.Pa4,Bg=new u.Ilk;function xE(){const a={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(i,s){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const l={index:this.materials.length,name:i||"",mtllib:Array.isArray(s)&&s.length>0?s[s.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(h){const d={index:typeof h=="number"?h:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return d.clone=this.clone.bind(d),d}};return this.materials.push(l),l},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){const s=this.currentMaterial();if(s&&s.groupEnd===-1&&(s.groupEnd=this.geometry.vertices.length/3,s.groupCount=s.groupEnd-s.groupStart,s.inherited=!1),i&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),s}},n&&n.name&&typeof n.clone=="function"){const i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const i=this.vertices,s=this.object.geometry.vertices;s.push(i[e+0],i[e+1],i[e+2]),s.push(i[t+0],i[t+1],i[t+2]),s.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const i=this.normals,s=this.object.geometry.normals;s.push(i[e+0],i[e+1],i[e+2]),s.push(i[t+0],i[t+1],i[t+2]),s.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){const i=this.vertices,s=this.object.geometry.normals;dx.fromArray(i,e),Hy.fromArray(i,t),px.fromArray(i,n),po.subVectors(px,Hy),Qy.subVectors(dx,Hy),po.cross(Qy),po.normalize(),s.push(po.x,po.y,po.z),s.push(po.x,po.y,po.z),s.push(po.x,po.y,po.z)},addColor:function(e,t,n){const i=this.colors,s=this.object.geometry.colors;i[e]!==void 0&&s.push(i[e+0],i[e+1],i[e+2]),i[t]!==void 0&&s.push(i[t+0],i[t+1],i[t+2]),i[n]!==void 0&&s.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){const i=this.uvs,s=this.object.geometry.uvs;s.push(i[e+0],i[e+1]),s.push(i[t+0],i[t+1]),s.push(i[n+0],i[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,s,o,l,h,d){const f=this.vertices.length;let v=this.parseVertexIndex(e,f),y=this.parseVertexIndex(t,f),w=this.parseVertexIndex(n,f);if(this.addVertex(v,y,w),this.addColor(v,y,w),l!==void 0&&l!==""){const E=this.normals.length;v=this.parseNormalIndex(l,E),y=this.parseNormalIndex(h,E),w=this.parseNormalIndex(d,E),this.addNormal(v,y,w)}else this.addFaceNormal(v,y,w);if(i!==void 0&&i!==""){const E=this.uvs.length;v=this.parseUVIndex(i,E),y=this.parseUVIndex(s,E),w=this.parseUVIndex(o,E),this.addUV(v,y,w),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,i=e.length;n<i;n++){const s=this.parseVertexIndex(e[n],t);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let s=0,o=e.length;s<o;s++)this.addVertexLine(this.parseVertexIndex(e[s],n));for(let s=0,o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],i))}};return a.startObject("",!1),a}class Lg extends u.aNw{constructor(e){super(e),this.materials=null}load(e,t,n,i){const s=this,o=new u.hH6(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,async function(l){try{t(await s.parse(l))}catch(h){i?i(h):console.error(h),s.manager.itemError(e)}},n,i)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new xE;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let i=[];for(let o=0,l=n.length;o<l;o++){const h=n[o].trimStart();if(h.length===0)continue;const d=h.charAt(0);if(d!=="#")if(d==="v"){const f=h.split(Gy);switch(f[0]){case"v":t.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?(Bg.setRGB(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])).convertSRGBToLinear(),t.colors.push(Bg.r,Bg.g,Bg.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":t.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if(d==="f"){const f=h.slice(1).trim().split(Gy),v=[];for(let w=0,E=f.length;w<E;w++){const M=f[w];if(M.length>0){const P=M.split("/");v.push(P)}}const y=v[0];for(let w=1,E=v.length-1;w<E;w++){const M=v[w],P=v[w+1];t.addFace(y[0],M[0],P[0],y[1],M[1],P[1],y[2],M[2],P[2])}}else if(d==="l"){const f=h.substring(1).trim().split(" ");let v=[];const y=[];if(h.indexOf("/")===-1)v=f;else for(let w=0,E=f.length;w<E;w++){const M=f[w].split("/");M[0]!==""&&v.push(M[0]),M[1]!==""&&y.push(M[1])}t.addLineGeometry(v,y)}else if(d==="p"){const f=h.slice(1).trim().split(" ");t.addPointGeometry(f)}else if((i=ux.exec(h))!==null){const f=(" "+i[0].slice(1).trim()).slice(1);t.startObject(f)}else if(bE.test(h))t.object.startMaterial(h.substring(7).trim(),t.materialLibraries);else if(AE.test(h)){t.materialLibraries.push(h.substring(7).trim());const f=h.substring(7).trim(),v=this.manager.getHandler(f);if(v){const y=await v.loadAsync(f).catch(w=>{console.warn(w)});y&&this.setMaterials(y)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(hx.test(h))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(d==="s"){if(i=h.split(" "),i.length>1){const v=i[1].trim().toLowerCase();t.object.smooth=v!=="0"&&v!=="off"}else t.object.smooth=!0;const f=t.object.currentMaterial();f&&(f.smooth=t.object.smooth)}else{if(h==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+h+'"')}}t.finalize();const s=new u.ZAu;if(s.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let o=0,l=t.objects.length;o<l;o++){const h=t.objects[o],d=h.geometry,f=h.materials,v=d.type==="Line",y=d.type==="Points";let w=!1;if(d.vertices.length===0)continue;const E=new u.u9r;E.setAttribute("position",new u.a$l(d.vertices,3)),d.normals.length>0&&E.setAttribute("normal",new u.a$l(d.normals,3)),d.colors.length>0&&(w=!0,E.setAttribute("color",new u.a$l(d.colors,3))),d.hasUVIndices===!0&&E.setAttribute("uv",new u.a$l(d.uvs,2));const M=[];for(let L=0,R=f.length;L<R;L++){const I=f[L],N=I.name+"_"+I.smooth+"_"+w;let j=t.materials[N];if(this.materials!==null)if(j=await this.materials.create(I.name),!v||!j||j instanceof u.nls){if(y&&j&&!(j instanceof u.UY4)){const H=new u.UY4({size:10,sizeAttenuation:!1});u.F5T.prototype.copy.call(H,j),H.color.copy(j.color),H.map=j.map,j=H}}else{const H=new u.nls;u.F5T.prototype.copy.call(H,j),H.color.copy(j.color),j=H}j===void 0&&(j=v?new u.nls:y?new u.UY4({size:1,sizeAttenuation:!1}):new u.xoR,j.name=I.name,j.flatShading=!I.smooth,j.vertexColors=w,t.materials[N]=j),M.push(j)}let P;if(M.length>1){for(let L=0,R=f.length;L<R;L++){const I=f[L];E.addGroup(I.groupStart,I.groupCount,L)}P=v?new u.ejS(E,M):y?new u.woe(E,M):new u.Kj0(E,M)}else P=v?new u.ejS(E,M[0]):y?new u.woe(E,M[0]):new u.Kj0(E,M[0]);P.name=h.name,s.add(P)}else if(t.vertices.length>0){const o=new u.UY4({size:1,sizeAttenuation:!1}),l=new u.u9r;l.setAttribute("position",new u.a$l(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new u.a$l(t.colors,3)),o.vertexColors=!0);const h=new u.woe(l,o);s.add(h)}return s}}class Gr extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Yt],this._importer1=new yr(Lg,["obj"],!0),this._importer2=new yr(z_,["mtl"],!1)}async onAdded(e){var t,n,i,s;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer1),(s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}Gr.PluginType="ObjMtlLoadPlugin";var fx=function(a){return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))};try{URL.revokeObjectURL(fx(""))}catch{fx=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Hi=Uint8Array,aa=Uint16Array,Og=Uint32Array,j_=new Hi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),V_=new Hi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),G_=new Hi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kg=function(a,e){for(var t=new aa(31),n=0;n<31;++n)t[n]=e+=1<<a[n-1];var i=new Og(t[30]);for(n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return[t,i]},H_=kg(j_,2),mx=H_[0],Wy=H_[1];mx[28]=258,Wy[258]=28;for(var gx=kg(V_,0),wE=gx[0],vx=gx[1],qy=new aa(32768),kr=0;kr<32768;++kr){var Rp=(43690&kr)>>>1|(21845&kr)<<1;Rp=(61680&(Rp=(52428&Rp)>>>2|(13107&Rp)<<2))>>>4|(3855&Rp)<<4,qy[kr]=((65280&Rp)>>>8|(255&Rp)<<8)>>>1}var ou=function(a,e,t){for(var n=a.length,i=0,s=new aa(e);i<n;++i)++s[a[i]-1];var o,l=new aa(e);for(i=0;i<e;++i)l[i]=l[i-1]+s[i-1]<<1;if(t){o=new aa(1<<e);var h=15-e;for(i=0;i<n;++i)if(a[i])for(var d=i<<4|a[i],f=e-a[i],v=l[a[i]-1]++<<f,y=v|(1<<f)-1;v<=y;++v)o[qy[v]>>>h]=d}else for(o=new aa(n),i=0;i<n;++i)a[i]&&(o[i]=qy[l[a[i]-1]++]>>>15-a[i]);return o},ld=new Hi(288);for(kr=0;kr<144;++kr)ld[kr]=8;for(kr=144;kr<256;++kr)ld[kr]=9;for(kr=256;kr<280;++kr)ld[kr]=7;for(kr=280;kr<288;++kr)ld[kr]=8;var Ug=new Hi(32);for(kr=0;kr<32;++kr)Ug[kr]=5;var EE=ou(ld,9,0),SE=ou(ld,9,1),ME=ou(Ug,5,0),CE=ou(Ug,5,1),Xy=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},Mc=function(a,e,t){var n=e/8|0;return(a[n]|a[n+1]<<8)>>(7&e)&t},Yy=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(7&e)},Ky=function(a){return(a/8|0)+(7&a&&1)},yx=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var n=new(a instanceof aa?aa:a instanceof Og?Og:Hi)(t-e);return n.set(a.subarray(e,t)),n},TE=function(a,e,t){var n=a.length;if(!n||t&&!t.l&&n<5)return e||new Hi(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new Hi(3*n));var o=function(hn){var wn=e.length;if(hn>wn){var Jn=new Hi(Math.max(2*wn,hn));Jn.set(e),e=Jn}},l=t.f||0,h=t.p||0,d=t.b||0,f=t.l,v=t.d,y=t.m,w=t.n,E=8*n;do{if(!f){t.f=l=Mc(a,h,1);var M=Mc(a,h+1,3);if(h+=3,!M){var P=a[(ve=Ky(h)+4)-4]|a[ve-3]<<8,L=ve+P;if(L>n){if(s)throw"unexpected EOF";break}i&&o(d+P),e.set(a.subarray(ve,L),d),t.b=d+=P,t.p=h=8*L;continue}if(M==1)f=SE,v=CE,y=9,w=5;else{if(M!=2)throw"invalid block type";var R=Mc(a,h,31)+257,I=Mc(a,h+10,15)+4,N=R+Mc(a,h+5,31)+1;h+=14;for(var j=new Hi(N),H=new Hi(19),X=0;X<I;++X)H[G_[X]]=Mc(a,h+3*X,7);h+=3*I;var ne=Xy(H),pe=(1<<ne)-1,Ae=ou(H,ne,1);for(X=0;X<N;){var ve,Ee=Ae[Mc(a,h,pe)];if(h+=15&Ee,(ve=Ee>>>4)<16)j[X++]=ve;else{var xe=0,we=0;for(ve==16?(we=3+Mc(a,h,3),h+=2,xe=j[X-1]):ve==17?(we=3+Mc(a,h,7),h+=3):ve==18&&(we=11+Mc(a,h,127),h+=7);we--;)j[X++]=xe}}var Re=j.subarray(0,R),Be=j.subarray(R);y=Xy(Re),w=Xy(Be),f=ou(Re,y,1),v=ou(Be,w,1)}if(h>E){if(s)throw"unexpected EOF";break}}i&&o(d+131072);for(var Oe=(1<<y)-1,at=(1<<w)-1,st=h;;st=h){var St=(xe=f[Yy(a,h)&Oe])>>>4;if((h+=15&xe)>E){if(s)throw"unexpected EOF";break}if(!xe)throw"invalid length/literal";if(St<256)e[d++]=St;else{if(St==256){st=h,f=null;break}var dt=St-254;if(St>264){var ht=j_[X=St-257];dt=Mc(a,h,(1<<ht)-1)+mx[X],h+=ht}var Nt=v[Yy(a,h)&at],Bt=Nt>>>4;if(!Nt)throw"invalid distance";if(h+=15&Nt,Be=wE[Bt],Bt>3&&(ht=V_[Bt],Be+=Yy(a,h)&(1<<ht)-1,h+=ht),h>E){if(s)throw"unexpected EOF";break}i&&o(d+131072);for(var rn=d+dt;d<rn;d+=4)e[d]=e[d-Be],e[d+1]=e[d+1-Be],e[d+2]=e[d+2-Be],e[d+3]=e[d+3-Be];d=rn}}t.l=f,t.p=st,t.b=d,f&&(l=1,t.m=y,t.d=v,t.n=w)}while(!l);return d==e.length?e:yx(e,0,d)},$u=function(a,e,t){t<<=7&e;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8},b=function(a,e,t){t<<=7&e;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8,a[n+2]|=t>>>16},r=function(a,e){for(var t=[],n=0;n<a.length;++n)a[n]&&t.push({s:n,f:a[n]});var i=t.length,s=t.slice();if(!i)return[B,0];if(i==1){var o=new Hi(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(j,H){return j.f-H.f}),t.push({s:-1,f:25001});var l=t[0],h=t[1],d=0,f=1,v=2;for(t[0]={s:-1,f:l.f+h.f,l,r:h};f!=i-1;)l=t[t[d].f<t[v].f?d++:v++],h=t[d!=f&&t[d].f<t[v].f?d++:v++],t[f++]={s:-1,f:l.f+h.f,l,r:h};var y=s[0].s;for(n=1;n<i;++n)s[n].s>y&&(y=s[n].s);var w=new aa(y+1),E=c(t[f-1],w,0);if(E>e){n=0;var M=0,P=E-e,L=1<<P;for(s.sort(function(j,H){return w[H.s]-w[j.s]||j.f-H.f});n<i;++n){var R=s[n].s;if(!(w[R]>e))break;M+=L-(1<<E-w[R]),w[R]=e}for(M>>>=P;M>0;){var I=s[n].s;w[I]<e?M-=1<<e-w[I]++-1:++n}for(;n>=0&&M;--n){var N=s[n].s;w[N]==e&&(--w[N],++M)}E=e}return[new Hi(w),E]},c=function(a,e,t){return a.s==-1?Math.max(c(a.l,e,t+1),c(a.r,e,t+1)):e[a.s]=t},p=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new aa(++e),n=0,i=a[0],s=1,o=function(h){t[n++]=h},l=1;l<=e;++l)if(a[l]==i&&l!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=a[l]}return[t.subarray(0,n),e]},m=function(a,e){for(var t=0,n=0;n<e.length;++n)t+=a[n]*e[n];return t},_=function(a,e,t){var n=t.length,i=Ky(e+2);a[i]=255&n,a[i+1]=n>>>8,a[i+2]=255^a[i],a[i+3]=255^a[i+1];for(var s=0;s<n;++s)a[i+s+4]=t[s];return 8*(i+4+n)},x=function(a,e,t,n,i,s,o,l,h,d,f){$u(e,f++,t),++i[256];for(var v=r(i,15),y=v[0],w=v[1],E=r(s,15),M=E[0],P=E[1],L=p(y),R=L[0],I=L[1],N=p(M),j=N[0],H=N[1],X=new aa(19),ne=0;ne<R.length;++ne)X[31&R[ne]]++;for(ne=0;ne<j.length;++ne)X[31&j[ne]]++;for(var pe=r(X,7),Ae=pe[0],ve=pe[1],Ee=19;Ee>4&&!Ae[G_[Ee-1]];--Ee);var xe,we,Re,Be,Oe=d+5<<3,at=m(i,ld)+m(s,Ug)+o,st=m(i,y)+m(s,M)+o+14+3*Ee+m(X,Ae)+(2*X[16]+3*X[17]+7*X[18]);if(Oe<=at&&Oe<=st)return _(e,f,a.subarray(h,h+d));if($u(e,f,1+(st<at)),f+=2,st<at){xe=ou(y,w,0),we=y,Re=ou(M,P,0),Be=M;var St=ou(Ae,ve,0);for($u(e,f,I-257),$u(e,f+5,H-1),$u(e,f+10,Ee-4),f+=14,ne=0;ne<Ee;++ne)$u(e,f+3*ne,Ae[G_[ne]]);f+=3*Ee;for(var dt=[R,j],ht=0;ht<2;++ht){var Nt=dt[ht];for(ne=0;ne<Nt.length;++ne){var Bt=31&Nt[ne];$u(e,f,St[Bt]),f+=Ae[Bt],Bt>15&&($u(e,f,Nt[ne]>>>5&127),f+=Nt[ne]>>>12)}}}else xe=EE,we=ld,Re=ME,Be=Ug;for(ne=0;ne<l;++ne)if(n[ne]>255){Bt=n[ne]>>>18&31,b(e,f,xe[Bt+257]),f+=we[Bt+257],Bt>7&&($u(e,f,n[ne]>>>23&31),f+=j_[Bt]);var rn=31&n[ne];b(e,f,Re[rn]),f+=Be[rn],rn>3&&(b(e,f,n[ne]>>>5&8191),f+=V_[rn])}else b(e,f,xe[n[ne]]),f+=we[n[ne]];return b(e,f,xe[256]),f+we[256]},S=new Og([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),B=new Hi(0),D=function(){var a=1,e=0;return{p:function(t){for(var n=a,i=e,s=t.length,o=0;o!=s;){for(var l=Math.min(o+2655,s);o<l;++o)i+=n+=t[o];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}a=n,e=i},d:function(){return(255&(a%=65521))<<24|a>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},U=function(a,e,t,n,i){return function(s,o,l,h,d,f){var v=s.length,y=new Hi(h+v+5*(1+Math.ceil(v/7e3))+d),w=y.subarray(h,y.length-d),E=0;if(!o||v<8)for(var M=0;M<=v;M+=65535){var P=M+65535;P<v?E=_(w,E,s.subarray(M,P)):(w[M]=f,E=_(w,E,s.subarray(M,v)))}else{for(var L=S[o-1],R=L>>>13,I=8191&L,N=(1<<l)-1,j=new aa(32768),H=new aa(N+1),X=Math.ceil(l/3),ne=2*X,pe=function(ai){return(s[ai]^s[ai+1]<<X^s[ai+2]<<ne)&N},Ae=new Og(25e3),ve=new aa(288),Ee=new aa(32),xe=0,we=0,Re=(M=0,0),Be=0,Oe=0;M<v;++M){var at=pe(M),st=32767&M,St=H[at];if(j[st]=St,H[at]=st,Be<=M){var dt=v-M;if((xe>7e3||Re>24576)&&dt>423){E=x(s,w,0,Ae,ve,Ee,we,Re,Oe,M-Oe,E),Re=xe=we=0,Oe=M;for(var ht=0;ht<286;++ht)ve[ht]=0;for(ht=0;ht<30;++ht)Ee[ht]=0}var Nt=2,Bt=0,rn=I,hn=st-St&32767;if(dt>2&&at==pe(M-hn))for(var wn=Math.min(R,dt)-1,Jn=Math.min(32767,M),Fn=Math.min(258,dt);hn<=Jn&&--rn&&st!=St;){if(s[M+Nt]==s[M+Nt-hn]){for(var jn=0;jn<Fn&&s[M+jn]==s[M+jn-hn];++jn);if(jn>Nt){if(Nt=jn,Bt=hn,jn>wn)break;var wt=Math.min(hn,jn-2),jt=0;for(ht=0;ht<wt;++ht){var on=M-hn+ht+32768&32767,li=on-j[on]+32768&32767;li>jt&&(jt=li,St=on)}}}hn+=(st=St)-(St=j[st])+32768&32767}if(Bt){Ae[Re++]=268435456|Wy[Nt]<<18|vx[Bt];var Mi=31&Wy[Nt],pi=31&vx[Bt];we+=j_[Mi]+V_[pi],++ve[257+Mi],++Ee[pi],Be=M+Nt,++xe}else Ae[Re++]=s[M],++ve[s[M]]}}E=x(s,w,f,Ae,ve,Ee,we,Re,Oe,M-Oe,E),!f&&7&E&&(E=_(w,E+1,B))}return yx(y,0,h+Ky(E)+d)}(a,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+e.mem,t,n,!i)},G=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},V=function(a,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=n<<6|(n?32-2*n:1)},Q=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function q(a,e){return TE((Q(a),a.subarray(2,-4)),e)}var te=typeof TextDecoder<"u"&&new TextDecoder;try{te.decode(B,{stream:!0})}catch{}function K(a,e,t){const n=t.length-a-1;if(e>=t[n])return n-1;if(e<=t[a])return a;let i=a,s=n,o=Math.floor((i+s)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?s=o:i=o,o=Math.floor((i+s)/2);return o}function Z(a,e){let t=1;for(let i=2;i<=a;++i)t*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=a-e;++i)n*=i;return t/n}class ae extends u.Hyl{constructor(e,t,n,i,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<n.length;++o){const l=n[o];this.controlPoints[o]=new u.Ltg(l.x,l.y,l.z,l.w)}}getPoint(e,t=new u.Pa4){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(o,l,h,d){const f=K(o,d,l),v=function(w,E,M,P){const L=[],R=[],I=[];L[0]=1;for(let N=1;N<=M;++N){R[N]=E-P[w+1-N],I[N]=P[w+N]-E;let j=0;for(let H=0;H<N;++H){const X=I[H+1],ne=R[N-H],pe=L[H]/(X+ne);L[H]=j+X*pe,j=ne*pe}L[N]=j}return L}(f,d,o,l),y=new u.Ltg(0,0,0,0);for(let w=0;w<=o;++w){const E=h[f-o+w],M=v[w],P=E.w*M;y.x+=E.x*P,y.y+=E.y*P,y.z+=E.z*P,y.w+=E.w*M}return y}(this.degree,this.knots,this.controlPoints,i);return s.w!==1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t=new u.Pa4){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=function(o,l,h,d,f){const v=function(y,w,E,M,P){const L=P<y?P:y,R=[],I=K(y,M,w),N=function(H,X,ne,pe,Ae){const ve=[];for(let Oe=0;Oe<=ne;++Oe)ve[Oe]=0;const Ee=[];for(let Oe=0;Oe<=pe;++Oe)Ee[Oe]=ve.slice(0);const xe=[];for(let Oe=0;Oe<=ne;++Oe)xe[Oe]=ve.slice(0);xe[0][0]=1;const we=ve.slice(0),Re=ve.slice(0);for(let Oe=1;Oe<=ne;++Oe){we[Oe]=X-Ae[H+1-Oe],Re[Oe]=Ae[H+Oe]-X;let at=0;for(let st=0;st<Oe;++st){const St=Re[st+1],dt=we[Oe-st];xe[Oe][st]=St+dt;const ht=xe[st][Oe-1]/xe[Oe][st];xe[st][Oe]=at+St*ht,at=dt*ht}xe[Oe][Oe]=at}for(let Oe=0;Oe<=ne;++Oe)Ee[0][Oe]=xe[Oe][ne];for(let Oe=0;Oe<=ne;++Oe){let at=0,st=1;const St=[];for(let dt=0;dt<=ne;++dt)St[dt]=ve.slice(0);St[0][0]=1;for(let dt=1;dt<=pe;++dt){let ht=0;const Nt=Oe-dt,Bt=ne-dt;Oe>=dt&&(St[st][0]=St[at][0]/xe[Bt+1][Nt],ht=St[st][0]*xe[Nt][Bt]);const rn=Oe-1<=Bt?dt-1:ne-Oe;for(let wn=Nt>=-1?1:-Nt;wn<=rn;++wn)St[st][wn]=(St[at][wn]-St[at][wn-1])/xe[Bt+1][Nt+wn],ht+=St[st][wn]*xe[Nt+wn][Bt];Oe<=Bt&&(St[st][dt]=-St[at][dt-1]/xe[Bt+1][Oe],ht+=St[st][dt]*xe[Oe][Bt]),Ee[dt][Oe]=ht;const hn=at;at=st,st=hn}}let Be=ne;for(let Oe=1;Oe<=pe;++Oe){for(let at=0;at<=ne;++at)Ee[Oe][at]*=Be;Be*=ne-Oe}return Ee}(I,M,y,L,w),j=[];for(let H=0;H<E.length;++H){const X=E[H].clone(),ne=X.w;X.x*=ne,X.y*=ne,X.z*=ne,j[H]=X}for(let H=0;H<=L;++H){const X=j[I-y].clone().multiplyScalar(N[H][0]);for(let ne=1;ne<=y;++ne)X.add(j[I-y+ne].clone().multiplyScalar(N[H][ne]));R[H]=X}for(let H=L+1;H<=P+1;++H)R[H]=new u.Ltg(0,0,0);return R}(o,l,h,d,f);return function(y){const w=y.length,E=[],M=[];for(let L=0;L<w;++L){const R=y[L];E[L]=new u.Pa4(R.x,R.y,R.z),M[L]=R.w}const P=[];for(let L=0;L<w;++L){const R=E[L].clone();for(let I=1;I<=L;++I)R.sub(P[L-I].clone().multiplyScalar(Z(L,I)*M[I]));P[L]=R.divideScalar(M[0])}return P}(v)}(this.degree,this.knots,this.controlPoints,i,1);return n.copy(s[1]).normalize(),n}}let ce,Te,Ce;class Ie extends u.aNw{constructor(e){super(e)}load(e,t,n,i){const s=this,o=s.path===""?u.Zp0.extractUrlBase(e):s.path,l=new u.hH6(this.manager);l.setPath(s.path),l.setResponseType("arraybuffer"),l.setRequestHeader(s.requestHeader),l.setWithCredentials(s.withCredentials),l.load(e,function(h){try{t(s.parse(h,o))}catch(d){i?i(d):console.error(d),s.manager.itemError(e)}},n,i)}parse(e,t){if(function(s){const o="Kaydara FBX Binary  \0";return s.byteLength>=o.length&&o===Kt(s,0,o.length)}(e))ce=new Ze().parse(e);else{const s=Kt(e);if(!function(o){const l=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let h=0;function d(f){const v=o[f-1];return o=o.slice(h+f),h++,v}for(let f=0;f<l.length;++f)if(d(1)===l[f])return!1;return!0}(s))throw new Error("THREE.FBXLoader: Unknown format.");if(en(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+en(s));ce=new yt().parse(s)}const n=new u.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),i=new Ke(n,this.manager).parse(ce);return ce=null,Te=null,Ce=null,i}}class Ke{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Te=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),s=new ct().parse(i);return this.parseScene(i,s,n),Ce}parseConnections(){const e=new Map;return"Connections"in ce&&ce.Connections.connections.forEach(function(t){const n=t[0],i=t[1],s=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:i,relationship:s};e.get(n).parents.push(o),e.has(i)||e.set(i,{parents:[],children:[]});const l={ID:n,relationship:s};e.get(i).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in ce.Objects){const n=ce.Objects.Video;for(const i in n){const s=n[i];if(e[parseInt(i)]=s.RelativeFilename||s.Filename,"Content"in s){const o=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,l=typeof s.Content=="string"&&s.Content!=="";if(o||l){const h=this.parseImage(n[i]);t[s.RelativeFilename||s.Filename]=h}}}}for(const n in e){const i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(i){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if(typeof t=="string")return"data:"+s+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in ce.Objects){const n=ce.Objects.Texture;for(const i in n){const s=this.parseTexture(n[i],e);t.set(parseInt(i),s)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,s=e.WrapModeV,o=i!==void 0?i.value:0,l=s!==void 0?s.value:0;if(n.wrapS=o===0?u.rpg:u.uWy,n.wrapT=l===0?u.rpg:u.uWy,"Scaling"in e){const h=e.Scaling.value;n.repeat.x=h[0],n.repeat.y=h[1]}if("Translation"in e){const h=e.Translation.value;n.offset.x=h[0],n.offset.y=h[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,s=Te.get(e.id).children;let o;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(n=t[s[0].ID],n.indexOf("blob:")!==0&&n.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const l=e.FileName.slice(-3).toLowerCase();if(l==="tga"){const h=this.manager.getHandler(".tga");h===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new u.xEZ):(h.setPath(this.textureLoader.path),o=h.load(n))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new u.xEZ):o=this.textureLoader.load(n);return this.textureLoader.setPath(i),o}parseMaterials(e){const t=new Map;if("Material"in ce.Objects){const n=ce.Objects.Material;for(const i in n){const s=this.parseMaterial(n[i],e);s!==null&&t.set(parseInt(i),s)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!Te.has(n))return null;const o=this.parseParameters(e,t,n);let l;switch(s.toLowerCase()){case"phong":l=new u.xoR;break;case"lambert":l=new u.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),l=new u.xoR}return l.setValues(o),l.name=i,l}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new u.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(i.color=new u.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new u.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(i.emissive=new u.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new u.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new u.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());const s=this;return Te.get(n).children.forEach(function(o){const l=o.relationship;switch(l){case"Bump":i.bumpMap=s.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":i.aoMap=s.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=s.getTexture(t,o.ID),i.map!==void 0&&(i.map.colorSpace=u.KI_);break;case"DisplacementColor":i.displacementMap=s.getTexture(t,o.ID);break;case"EmissiveColor":i.emissiveMap=s.getTexture(t,o.ID),i.emissiveMap!==void 0&&(i.emissiveMap.colorSpace=u.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=s.getTexture(t,o.ID);break;case"ReflectionColor":i.envMap=s.getTexture(t,o.ID),i.envMap!==void 0&&(i.envMap.mapping=u.dSO,i.envMap.colorSpace=u.KI_);break;case"SpecularColor":i.specularMap=s.getTexture(t,o.ID),i.specularMap!==void 0&&(i.specularMap.colorSpace=u.KI_);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=s.getTexture(t,o.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l)}}),i}getTexture(e,t){return"LayeredTexture"in ce.Objects&&t in ce.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Te.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in ce.Objects){const n=ce.Objects.Deformer;for(const i in n){const s=n[i],o=Te.get(parseInt(i));if(s.attrType==="Skin"){const l=this.parseSkeleton(o,n);l.ID=i,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=o.parents[0].ID,e[i]=l}else if(s.attrType==="BlendShape"){const l={id:i};l.rawTargets=this.parseMorphTargets(o,n),l.id=i,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=l}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(i){const s=t[i.ID];if(s.attrType!=="Cluster")return;const o={ID:i.ID,indices:[],weights:[],transformLink:new u.yGw().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const s=e.children[i],o=t[s.ID],l={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;l.geoID=Te.get(parseInt(s.ID)).children.filter(function(h){return h.relationship===void 0})[0].ID,n.push(l)}return n}parseScene(e,t,n){Ce=new u.ZAu;const i=this.parseModels(e.skeletons,t,n),s=ce.Objects.Model,o=this;i.forEach(function(h){const d=s[h.ID];o.setLookAtProperties(h,d),Te.get(h.ID).parents.forEach(function(f){const v=i.get(f.ID);v!==void 0&&v.add(h)}),h.parent===null&&Ce.add(h)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),Ce.traverse(function(h){if(h.userData.transformData){h.parent&&(h.userData.transformData.parentMatrix=h.parent.matrix,h.userData.transformData.parentMatrixWorld=h.parent.matrixWorld);const d=It(h.userData.transformData);h.applyMatrix4(d),h.updateWorldMatrix()}});const l=new Je().parse();Ce.children.length===1&&Ce.children[0].isGroup&&(Ce.children[0].animations=l,Ce=Ce.children[0]),Ce.animations=l}parseModels(e,t,n){const i=new Map,s=ce.Objects.Model;for(const o in s){const l=parseInt(o),h=s[o],d=Te.get(l);let f=this.buildSkeleton(d,e,l,h.attrName);if(!f){switch(h.attrType){case"Camera":f=this.createCamera(d);break;case"Light":f=this.createLight(d);break;case"Mesh":f=this.createMesh(d,t,n);break;case"NurbsCurve":f=this.createCurve(d,t);break;case"LimbNode":case"Root":f=new u.N$j;break;default:f=new u.ZAu}f.name=h.attrName?u.iUV.sanitizeNodeName(h.attrName):"",f.ID=l}this.getTransformData(f,h),i.set(l,f)}return i}buildSkeleton(e,t,n,i){let s=null;return e.parents.forEach(function(o){for(const l in t){const h=t[l];h.rawBones.forEach(function(d,f){if(d.ID===o.ID){const v=s;s=new u.N$j,s.matrixWorld.copy(d.transformLink),s.name=i?u.iUV.sanitizeNodeName(i):"",s.ID=n,h.bones[f]=s,v!==null&&s.add(v)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(i){const s=ce.Objects.NodeAttribute[i.ID];s!==void 0&&(n=s)}),n===void 0)t=new u.Tme;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let l=window.innerWidth,h=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(l=n.AspectWidth.value,h=n.AspectHeight.value);const d=l/h;let f=45;n.FieldOfView!==void 0&&(f=n.FieldOfView.value);const v=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new u.cPb(f,d,s,o),v!==null&&t.setFocalLength(v);break;case 1:t=new u.iKG(-l/2,l/2,h/2,-h/2,s,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new u.Tme}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){const s=ce.Objects.NodeAttribute[i.ID];s!==void 0&&(n=s)}),n===void 0)t=new u.Tme;else{let i;i=n.LightType===void 0?0:n.LightType.value;let s=16777215;n.Color!==void 0&&(s=new u.Ilk().fromArray(n.Color.value).convertSRGBToLinear());let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let l=0;n.FarAttenuationEnd!==void 0&&(l=n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?0:n.FarAttenuationEnd.value);const h=1;switch(i){case 0:t=new u.cek(s,o,l,h);break;case 1:t=new u.Ox3(s,o);break;case 2:let d=Math.PI/3;n.InnerAngle!==void 0&&(d=u.M8C.degToRad(n.InnerAngle.value));let f=0;n.OuterAngle!==void 0&&(f=u.M8C.degToRad(n.OuterAngle.value),f=Math.max(f,1)),t=new u.PMe(s,o,l,d,f,h);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new u.cek(s,o)}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,s=null,o=null;const l=[];return e.children.forEach(function(h){t.has(h.ID)&&(s=t.get(h.ID)),n.has(h.ID)&&l.push(n.get(h.ID))}),l.length>1?o=l:l.length>0?o=l[0]:(o=new u.xoR({color:13421772}),l.push(o)),"color"in s.attributes&&l.forEach(function(h){h.vertexColors=!0}),s.FBX_Deformer?(i=new u.TUv(s,o),i.normalizeSkinWeights()):i=new u.Kj0(s,o),i}createCurve(e,t){const n=e.children.reduce(function(s,o){return t.has(o.ID)&&(s=t.get(o.ID)),s},null),i=new u.nls({color:3342591,linewidth:1});return new u.x12(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Qt(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&Te.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const i=ce.Objects.Model[n.ID];if("Lcl_Translation"in i){const s=i.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),Ce.add(e.target)):e.lookAt(new u.Pa4().fromArray(s))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const s in e){const o=e[s];Te.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const h=l.ID;Te.get(h).parents.forEach(function(d){n.has(d.ID)&&n.get(d.ID).bind(new u.OdW(o.bones),i[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ce.Objects){const t=ce.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(s){e[s.Node]=new u.yGw().fromArray(s.Matrix.a)}):e[i.Node]=new u.yGw().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in ce&&"AmbientColor"in ce.GlobalSettings){const e=ce.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){const s=new u.Ilk(t,n,i).convertSRGBToLinear();Ce.add(new u.Mig(s,1))}}}}class ct{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in ce.Objects){const n=ce.Objects.Geometry;for(const i in n){const s=Te.get(parseInt(i)),o=this.parseGeometry(s,n[i],e);t.set(parseInt(i),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,s=[],o=e.parents.map(function(v){return ce.Objects.Model[v.ID]});if(o.length===0)return;const l=e.children.reduce(function(v,y){return i[y.ID]!==void 0&&(v=i[y.ID]),v},null);e.children.forEach(function(v){n.morphTargets[v.ID]!==void 0&&s.push(n.morphTargets[v.ID])});const h=o[0],d={};"RotationOrder"in h&&(d.eulerOrder=Qt(h.RotationOrder.value)),"InheritType"in h&&(d.inheritType=parseInt(h.InheritType.value)),"GeometricTranslation"in h&&(d.translation=h.GeometricTranslation.value),"GeometricRotation"in h&&(d.rotation=h.GeometricRotation.value),"GeometricScaling"in h&&(d.scale=h.GeometricScaling.value);const f=It(d);return this.genGeometry(t,l,s,f)}genGeometry(e,t,n,i){const s=new u.u9r;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),l=this.genBuffers(o),h=new u.a$l(l.vertex,3);if(h.applyMatrix4(i),s.setAttribute("position",h),l.colors.length>0&&s.setAttribute("color",new u.a$l(l.colors,3)),t&&(s.setAttribute("skinIndex",new u.qlB(l.weightsIndices,4)),s.setAttribute("skinWeight",new u.a$l(l.vertexWeights,4)),s.FBX_Deformer=t),l.normal.length>0){const d=new u.Vkp().getNormalMatrix(i),f=new u.a$l(l.normal,3);f.applyNormalMatrix(d),s.setAttribute("normal",f)}if(l.uvs.forEach(function(d,f){const v=f===0?"uv":`uv${f}`;s.setAttribute(v,new u.a$l(l.uvs[f],2))}),o.material&&o.material.mappingType!=="AllSame"){let d=l.materialIndex[0],f=0;if(l.materialIndex.forEach(function(v,y){v!==d&&(s.addGroup(f,y-f,d),d=v,f=y)}),s.groups.length>0){const v=s.groups[s.groups.length-1],y=v.start+v.count;y!==l.materialIndex.length&&s.addGroup(y,l.materialIndex.length-y,d)}s.groups.length===0&&s.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(s,e,n,i),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,s){i.indices.forEach(function(o,l){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:s,weight:i.weights[l]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,s=!1,o=[],l=[],h=[],d=[],f=[],v=[];const y=this;return e.vertexIndices.forEach(function(w,E){let M,P=!1;w<0&&(w^=-1,P=!0);let L=[],R=[];if(o.push(3*w,3*w+1,3*w+2),e.color){const I=Wt(E,n,w,e.color);h.push(I[0],I[1],I[2])}if(e.skeleton){if(e.weightTable[w]!==void 0&&e.weightTable[w].forEach(function(I){R.push(I.weight),L.push(I.id)}),R.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const I=[0,0,0,0],N=[0,0,0,0];R.forEach(function(j,H){let X=j,ne=L[H];N.forEach(function(pe,Ae,ve){if(X>pe){ve[Ae]=X,X=pe;const Ee=I[Ae];I[Ae]=ne,ne=Ee}})}),L=I,R=N}for(;R.length<4;)R.push(0),L.push(0);for(let I=0;I<4;++I)f.push(R[I]),v.push(L[I])}if(e.normal){const I=Wt(E,n,w,e.normal);l.push(I[0],I[1],I[2])}e.material&&e.material.mappingType!=="AllSame"&&(M=Wt(E,n,w,e.material)[0],M<0&&(y.negativeMaterialIndices=!0,M=0)),e.uv&&e.uv.forEach(function(I,N){const j=Wt(E,n,w,I);d[N]===void 0&&(d[N]=[]),d[N].push(j[0]),d[N].push(j[1])}),i++,P&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),y.genFace(t,e,o,M,l,h,d,f,v,i),n++,i=0,o=[],l=[],h=[],d=[],f=[],v=[])}),t}genFace(e,t,n,i,s,o,l,h,d,f){for(let v=2;v<f;v++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(v-1)]]),e.vertex.push(t.vertexPositions[n[3*(v-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(v-1)+2]]),e.vertex.push(t.vertexPositions[n[3*v]]),e.vertex.push(t.vertexPositions[n[3*v+1]]),e.vertex.push(t.vertexPositions[n[3*v+2]]),t.skeleton&&(e.vertexWeights.push(h[0]),e.vertexWeights.push(h[1]),e.vertexWeights.push(h[2]),e.vertexWeights.push(h[3]),e.vertexWeights.push(h[4*(v-1)]),e.vertexWeights.push(h[4*(v-1)+1]),e.vertexWeights.push(h[4*(v-1)+2]),e.vertexWeights.push(h[4*(v-1)+3]),e.vertexWeights.push(h[4*v]),e.vertexWeights.push(h[4*v+1]),e.vertexWeights.push(h[4*v+2]),e.vertexWeights.push(h[4*v+3]),e.weightsIndices.push(d[0]),e.weightsIndices.push(d[1]),e.weightsIndices.push(d[2]),e.weightsIndices.push(d[3]),e.weightsIndices.push(d[4*(v-1)]),e.weightsIndices.push(d[4*(v-1)+1]),e.weightsIndices.push(d[4*(v-1)+2]),e.weightsIndices.push(d[4*(v-1)+3]),e.weightsIndices.push(d[4*v]),e.weightsIndices.push(d[4*v+1]),e.weightsIndices.push(d[4*v+2]),e.weightsIndices.push(d[4*v+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(v-1)]),e.colors.push(o[3*(v-1)+1]),e.colors.push(o[3*(v-1)+2]),e.colors.push(o[3*v]),e.colors.push(o[3*v+1]),e.colors.push(o[3*v+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[3*(v-1)]),e.normal.push(s[3*(v-1)+1]),e.normal.push(s[3*(v-1)+2]),e.normal.push(s[3*v]),e.normal.push(s[3*v+1]),e.normal.push(s[3*v+2])),t.uv&&t.uv.forEach(function(y,w){e.uvs[w]===void 0&&(e.uvs[w]=[]),e.uvs[w].push(l[w][0]),e.uvs[w].push(l[w][1]),e.uvs[w].push(l[w][2*(v-1)]),e.uvs[w].push(l[w][2*(v-1)+1]),e.uvs[w].push(l[w][2*v]),e.uvs[w].push(l[w][2*v+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;n.forEach(function(o){o.rawTargets.forEach(function(l){const h=ce.Objects.Geometry[l.geoID];h!==void 0&&s.genMorphGeometry(e,t,h,i,l.name)})})}genMorphGeometry(e,t,n,i,s){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=n.Vertices!==void 0?n.Vertices.a:[],h=n.Indexes!==void 0?n.Indexes.a:[],d=3*e.attributes.position.count,f=new Float32Array(d);for(let E=0;E<h.length;E++){const M=3*h[E];f[M]=l[3*E],f[M+1]=l[3*E+1],f[M+2]=l[3*E+2]}const v={vertexIndices:o,vertexPositions:f},y=this.genBuffers(v),w=new u.a$l(y.vertex,3);w.name=s||n.attrName,w.applyMatrix4(i),e.morphAttributes.position.push(w)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:s,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let s=[];return n==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:i,indices:s,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let s=[];n==="IndexToDirect"&&(s=e.ColorIndex.a);for(let o=0,l=new u.Ilk;o<i.length;o+=4)l.fromArray(i,o).convertSRGBToLinear().toArray(i,o);return{dataSize:4,buffer:i,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,s=[];for(let o=0;o<i.length;++o)s.push(o);return{dataSize:1,buffer:i,indices:s,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new u.u9r;const n=t-1,i=e.KnotVector.a,s=[],o=e.Points.a;for(let f=0,v=o.length;f<v;f+=4)s.push(new u.Ltg().fromArray(o,f));let l,h;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){l=n,h=i.length-1-l;for(let f=0;f<n;++f)s.push(s[f])}const d=new ae(n,i,s,l,h).getPoints(12*s.length);return new u.u9r().setFromPoints(d)}}class Je{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const i=t[n],s=this.addClip(i);e.push(s)}return e}parseClips(){if(ce.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=ce.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:i.id,attr:i.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=ce.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(xn),values:t[n].KeyValueFloat.a},s=Te.get(i.id);if(s!==void 0){const o=s.parents[0].ID,l=s.parents[0].relationship;l.match(/X/)?e.get(o).curves.x=i:l.match(/Y/)?e.get(o).curves.y=i:l.match(/Z/)?e.get(o).curves.z=i:l.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=i)}}}parseAnimationLayers(e){const t=ce.Objects.AnimationLayer,n=new Map;for(const i in t){const s=[],o=Te.get(parseInt(i));o!==void 0&&(o.children.forEach(function(l,h){if(e.has(l.ID)){const d=e.get(l.ID);if(d.curves.x!==void 0||d.curves.y!==void 0||d.curves.z!==void 0){if(s[h]===void 0){const f=Te.get(l.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID;if(f!==void 0){const v=ce.Objects.Model[f.toString()];if(v===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",l);const y={modelName:v.attrName?u.iUV.sanitizeNodeName(v.attrName):"",ID:v.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ce.traverse(function(w){w.ID===v.id&&(y.transform=w.matrix,w.userData.transformData&&(y.eulerOrder=w.userData.transformData.eulerOrder))}),y.transform||(y.transform=new u.yGw),"PreRotation"in v&&(y.preRotation=v.PreRotation.value),"PostRotation"in v&&(y.postRotation=v.PostRotation.value),s[h]=y}}s[h]&&(s[h][d.attr]=d)}else if(d.curves.morph!==void 0){if(s[h]===void 0){const f=Te.get(l.ID).parents.filter(function(P){return P.relationship!==void 0})[0].ID,v=Te.get(f).parents[0].ID,y=Te.get(v).parents[0].ID,w=Te.get(y).parents[0].ID,E=ce.Objects.Model[w],M={modelName:E.attrName?u.iUV.sanitizeNodeName(E.attrName):"",morphName:ce.Objects.Deformer[f].attrName};s[h]=M}s[h][d.attr]=d}}}),n.set(parseInt(i),s))}return n}parseAnimStacks(e){const t=ce.Objects.AnimationStack,n={};for(const i in t){const s=Te.get(parseInt(i)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);n[i]={name:t[i].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new u.m7l(e.name,-1,t)}generateTracks(e){const t=[];let n=new u.Pa4,i=new u._fP,s=new u.Pa4;if(e.transform&&e.transform.decompose(n,i,s),n=n.toArray(),i=new u.USm().setFromQuaternion(i,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,n,i){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,n);return new u.yC1(e+"."+i,s,o)}generateRotationTrack(e,t,n,i,s,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(u.M8C.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(u.M8C.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(u.M8C.degToRad));const l=this.getTimesForAllAxes(t),h=this.getKeyframeTrackValues(l,t,n);i!==void 0&&((i=i.map(u.M8C.degToRad)).push(o),i=new u.USm().fromArray(i),i=new u._fP().setFromEuler(i)),s!==void 0&&((s=s.map(u.M8C.degToRad)).push(o),s=new u.USm().fromArray(s),s=new u._fP().setFromEuler(s).invert());const d=new u._fP,f=new u.USm,v=[];for(let y=0;y<h.length;y+=3)f.set(h[y],h[y+1],h[y+2],o),d.setFromEuler(f),i!==void 0&&d.premultiply(i),s!==void 0&&d.multiply(s),d.toArray(v,y/3*4);return new u.iLg(e+".quaternion",l,v)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(s){return s/100}),i=Ce.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new u.dUE(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let s=1;s<t.length;s++){const o=t[s];o!==i&&(t[n]=o,i=o,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const i=n,s=[];let o=-1,l=-1,h=-1;return e.forEach(function(d){if(t.x&&(o=t.x.times.indexOf(d)),t.y&&(l=t.y.times.indexOf(d)),t.z&&(h=t.z.times.indexOf(d)),o!==-1){const f=t.x.values[o];s.push(f),i[0]=f}else s.push(i[0]);if(l!==-1){const f=t.y.values[l];s.push(f),i[1]=f}else s.push(i[1]);if(h!==-1){const f=t.z.values[h];s.push(f),i[2]=f}else s.push(i[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,s=Math.abs(i);if(s>=180){const o=s/180,l=i/o;let h=n+l;const d=e.times[t-1],f=(e.times[t]-d)/o;let v=d+f;const y=[],w=[];for(;v<e.times[t];)y.push(v),v+=f,w.push(h),h+=l;e.times=bn(e.times,t,y),e.values=bn(e.values,t,w)}}}}class yt{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new kt,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,s){const o=i.match(/^[\s\t]*;/),l=i.match(/^[\s\t]*$/);if(o||l)return;const h=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),d=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=i.match("^\\t{"+(t.currentIndent-1)+"}}");h?t.parseNodeBegin(i,h):d?t.parseNodeProperty(i,d,n[++s]):f?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(h){return h.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},o=this.parseNodeAttr(i),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in l?(n==="PoseNode"?l.PoseNode.push(s):l[n].id!==void 0&&(l[n]={},l[n][l[n].id]=l[n]),o.id!==""&&(l[n][o.id]=s)):typeof o.id=="number"?(l[n]={},l[n][o.id]=s):n!=="Properties70"&&(l[n]=n==="PoseNode"?[s]:s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name!=="Properties70"){if(i==="C"){const l=s.split(",").slice(1),h=parseInt(l[0]),d=parseInt(l[1]);let f=s.split(",").slice(3);f=f.map(function(v){return v.trim().replace(/^"/,"")}),i="connections",s=[h,d],function(v,y){for(let w=0,E=v.length,M=y.length;w<M;w++,E++)v[E]=y[w]}(s,f),o[i]===void 0&&(o[i]=[])}i==="Node"&&(o.id=s),i in o&&Array.isArray(o[i])?o[i].push(s):i!=="a"?o[i]=s:o.a=s,this.setCurrentProp(o,i),i==="a"&&s.slice(-1)!==","&&(o.a=un(s))}else this.parseNodeSpecialProperty(e,i,s)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=un(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=i[0],o=i[1],l=i[2],h=i[3];let d=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":d=parseFloat(d);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":d=un(d)}this.getPrevNode()[s]={type:o,type2:l,flag:h,value:d},this.setCurrentProp(this.getPrevNode(),s)}}class Ze{parse(e){const t=new Pt(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new kt;for(;!this.endOfContent(t);){const s=this.parseNode(t,n);s!==null&&i.add(s.name,s)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),l=e.getString(o);if(i===0)return null;const h=[];for(let y=0;y<s;y++)h.push(this.parseProperty(e));const d=h.length>0?h[0]:"",f=h.length>1?h[1]:"",v=h.length>2?h[2]:"";for(n.singleProperty=s===1&&e.getOffset()===i;i>e.getOffset();){const y=this.parseNode(e,t);y!==null&&this.parseSubNode(l,n,y)}return n.propertyList=h,typeof d=="number"&&(n.id=d),f!==""&&(n.attrName=f),v!==""&&(n.attrType=v),l!==""&&(n.name=l),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(s,o){o!==0&&i.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(i){t[i]=n[i]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],s=n.propertyList[1];const o=n.propertyList[2],l=n.propertyList[3];let h;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),h=s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[i]={type:s,type2:o,flag:l,value:h}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const l=q(new Uint8Array(e.getArrayBuffer(o))),h=new Pt(l.buffer);switch(t){case"b":case"c":return h.getBooleanArray(i);case"d":return h.getFloat64Array(i);case"f":return h.getFloat32Array(i);case"i":return h.getInt32Array(i);case"l":return h.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Pt{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class kt{add(e,t){this[e]=t}}function en(a){const e=a.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function xn(a){return a/46186158e3}const tn=[];function Wt(a,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=a;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const s=i*n.dataSize,o=s+n.dataSize;return function(l,h,d,f){for(let v=d,y=0;v<f;v++,y++)l[y]=h[v];return l}(tn,n.buffer,s,o)}const dn=new u.USm,pn=new u.Pa4;function It(a){const e=new u.yGw,t=new u.yGw,n=new u.yGw,i=new u.yGw,s=new u.yGw,o=new u.yGw,l=new u.yGw,h=new u.yGw,d=new u.yGw,f=new u.yGw,v=new u.yGw,y=new u.yGw,w=a.inheritType?a.inheritType:0;if(a.translation&&e.setPosition(pn.fromArray(a.translation)),a.preRotation){const Ae=a.preRotation.map(u.M8C.degToRad);Ae.push(a.eulerOrder||u.USm.DEFAULT_ORDER),t.makeRotationFromEuler(dn.fromArray(Ae))}if(a.rotation){const Ae=a.rotation.map(u.M8C.degToRad);Ae.push(a.eulerOrder||u.USm.DEFAULT_ORDER),n.makeRotationFromEuler(dn.fromArray(Ae))}if(a.postRotation){const Ae=a.postRotation.map(u.M8C.degToRad);Ae.push(a.eulerOrder||u.USm.DEFAULT_ORDER),i.makeRotationFromEuler(dn.fromArray(Ae)),i.invert()}a.scale&&s.scale(pn.fromArray(a.scale)),a.scalingOffset&&l.setPosition(pn.fromArray(a.scalingOffset)),a.scalingPivot&&o.setPosition(pn.fromArray(a.scalingPivot)),a.rotationOffset&&h.setPosition(pn.fromArray(a.rotationOffset)),a.rotationPivot&&d.setPosition(pn.fromArray(a.rotationPivot)),a.parentMatrixWorld&&(v.copy(a.parentMatrix),f.copy(a.parentMatrixWorld));const E=t.clone().multiply(n).multiply(i),M=new u.yGw;M.extractRotation(f);const P=new u.yGw;P.copyPosition(f);const L=P.clone().invert().multiply(f),R=M.clone().invert().multiply(L),I=s,N=new u.yGw;if(w===0)N.copy(M).multiply(E).multiply(R).multiply(I);else if(w===1)N.copy(M).multiply(R).multiply(E).multiply(I);else{const Ae=new u.yGw().scale(new u.Pa4().setFromMatrixScale(v)).clone().invert(),ve=R.clone().multiply(Ae);N.copy(M).multiply(E).multiply(ve).multiply(I)}const j=d.clone().invert(),H=o.clone().invert();let X=e.clone().multiply(h).multiply(d).multiply(t).multiply(n).multiply(i).multiply(j).multiply(l).multiply(o).multiply(s).multiply(H);const ne=new u.yGw().copyPosition(X),pe=f.clone().multiply(ne);return y.copyPosition(pe),X=y.clone().multiply(N),X.premultiply(f.invert()),X}function Qt(a){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(a=a||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[a]}function un(a){return a.split(",").map(function(e){return parseFloat(e)})}function Kt(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=a.byteLength),new TextDecoder().decode(new Uint8Array(a,e,t))}function bn(a,e,t){return a.slice(0,e).concat(t).concat(a.slice(e))}class ni extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Yt],this._importer=new yr(Ie,["fbx"],!0)}async onAdded(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var t,n,i,s;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&((s=(i=e.getManager())==null?void 0:i.importer)==null||s.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1))}}ni.PluginType="FBXLoadPlugin";const Xe=new u.cPb(45,1,.1,1e3);function Le(a,e,t,n=7,i=new u.Pa4(0,0,1.5)){t=t??a.scene.modelObject;const s=new Fe().expandByObject(t??e,!0,!0),o=s.getCenter(new u.Pa4),l=s.getSize(new u.Pa4);Xe.position.copy(o).add(i.clone().multiplyScalar(Math.max(l.x,l.y,l.z))),Xe.lookAt(o),e&&e.traverseVisible(f=>{f.layers.enable(n)}),n>0?Xe.layers.set(n):Xe.layers.enableAll();const h=e==null?void 0:e.visible;e&&(e.visible=!0),a.renderer.rendererObject.setRenderTarget(null),a.renderer.rendererObject.render(t,Xe);const d=a.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=h,e.traverseVisible(f=>{f.layers.disable(n)}),Xe.layers.enableAll()),a.setDirty(),d}class _t{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new u.Kj0(new u.xo$(1)),cube:new u.Kj0(new u.DvJ(1,1,1)),cylinder:new u.Kj0(new u.fHI(.5,.5,1))};const t=new u.xsS;this._channel=7;const n=new u.vmT(16777215,4473924,1);n.position.set(0,10,0),n.layers.set(this._channel),t.add(n),this._lights.push(n),this._scene=t}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t="sphere"){const n=this.shapes[t]||new u.Kj0(new u.xo$(1));n.material=e.materialObject,n.geometry.attributes.tangent||n.geometry.computeTangents(),this._scene.add(n),this._scene.environment=this.viewer.scene.getEnvironment();const i=n.material.envMapIntensity;typeof i=="number"&&(n.material.envMapIntensity=Math.max(i,2));const s=Le(this.viewer,n,this._scene,this._channel,new u.Pa4(0,0,1.5));return typeof i=="number"&&(n.material.envMapIntensity=i),this._scene.remove(n),n.material=void 0,s}}class rt extends Sn{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e))},this.dependencies=[Yt],this.variations=[],this._selectedMaterial=()=>{var e,t;return((t=(e=this._picking)==null?void 0:e.getSelectedObject())==null?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(bh).filter(t=>t.endsWith("Map"))].map(t=>({label:t,value:t}))},...((e=this.getSelectedVariation())==null?void 0:e.materials.map(t=>t.uiConfig?Object.assign(t.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(t.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(t)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(t=>this.applyVariation(t,t.materials[0].uuid))}}]}]}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),this._previewGenerator=new _t(this._viewer),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)}async onRemove(e){var t,n;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(n=this._picking)==null||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation((e=this._selectedMaterial())==null?void 0:e.uuid)||this.findVariation((t=this._selectedMaterial())==null?void 0:t.name)}applyVariation(e,t){var n,i;const s=e.materials.find(l=>l.uuid===t),o=(i=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:i.materials;return!!o&&!!s&&o.applyMaterial(s,e.uuid)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var t;const n=(t=e==null?void 0:e.clone)==null?void 0:t.call(e);if(e&&n){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i||this.variations.push(i={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),i.materials.push(n),this.refreshUi()}}}rt.PluginType="MaterialConfiguratorBasePlugin",function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([ke()],rt.prototype,"variations",void 0);class Qe{static _initialize(){this._inited=!0,(0,g.createStyles)(g.css`
  .customContextGrid {
    background: #28223C;
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(e,t,n,i,s,o,l){var h;this._inited||this._initialize();const d=(0,g.mobileAndTabletCheck)(),f=d?.15:.25,v=d?1.5:2.5,y=(0,g.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${t} </div>
            `});y.style.top=s+"px",y.style.left=i+"px",y.style.gap=f+"rem",y.style.width=(v+f)*n-f+"rem",y.dataset.tag=e;for(const w of o){const E=(0,g.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${w.image}" class="customContextGridItemImage">
            `});E.style.width=v+"rem",E.style.height=v+"rem",y.appendChild(E),E.onclick=()=>{var M;return(M=w.onClick)==null?void 0:M.call(w,w.id)},l(E,w)}return(h=this.Elements)==null||h.push(y),y}static RemoveAll(e){if(e){const t=this.Elements.filter(n=>n.dataset.tag===e);for(const n of t)n.remove();this.Elements=this.Elements.filter(n=>n.dataset.tag!==e)}else{for(const t of this.Elements)t.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=(0,g.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const n of this.Elements)n.remove();this._container.innerHTML="";let t=20;e.appendChild(this._container);for(const n of this.Elements)n.style.top=t+"px",this._container.appendChild(n),t+=n.clientHeight+20}}function lt(a){if(a==null)return window;if(a.toString()!=="[object Window]"){var e=a.ownerDocument;return e&&e.defaultView||window}return a}function Se(a){return a instanceof lt(a).Element||a instanceof Element}function $e(a){return a instanceof lt(a).HTMLElement||a instanceof HTMLElement}function it(a){return typeof ShadowRoot<"u"&&(a instanceof lt(a).ShadowRoot||a instanceof ShadowRoot)}Qe.Elements=[],Qe._inited=!1,Qe._container=document.createElement("div");var Ot=Math.max,Ut=Math.min,Vt=Math.round;function mn(){var a=navigator.userAgentData;return a!=null&&a.brands?a.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function In(){return!/^((?!chrome|android).)*safari/i.test(mn())}function Qn(a,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=a.getBoundingClientRect(),i=1,s=1;e&&$e(a)&&(i=a.offsetWidth>0&&Vt(n.width)/a.offsetWidth||1,s=a.offsetHeight>0&&Vt(n.height)/a.offsetHeight||1);var o=(Se(a)?lt(a):window).visualViewport,l=!In()&&t,h=(n.left+(l&&o?o.offsetLeft:0))/i,d=(n.top+(l&&o?o.offsetTop:0))/s,f=n.width/i,v=n.height/s;return{width:f,height:v,top:d,right:h+f,bottom:d+v,left:h,x:h,y:d}}function Mn(a){var e=lt(a);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Yn(a){return a?(a.nodeName||"").toLowerCase():null}function Kn(a){return((Se(a)?a.ownerDocument:a.document)||window.document).documentElement}function Gn(a){return Qn(Kn(a)).left+Mn(a).scrollLeft}function ki(a){return lt(a).getComputedStyle(a)}function oa(a){var e=ki(a),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function wi(a,e,t){t===void 0&&(t=!1);var n,i,s=$e(e),o=$e(e)&&function(v){var y=v.getBoundingClientRect(),w=Vt(y.width)/v.offsetWidth||1,E=Vt(y.height)/v.offsetHeight||1;return w!==1||E!==1}(e),l=Kn(e),h=Qn(a,o,t),d={scrollLeft:0,scrollTop:0},f={x:0,y:0};return(s||!s&&!t)&&((Yn(e)!=="body"||oa(l))&&(d=(n=e)!==lt(n)&&$e(n)?{scrollLeft:(i=n).scrollLeft,scrollTop:i.scrollTop}:Mn(n)),$e(e)?((f=Qn(e,!0)).x+=e.clientLeft,f.y+=e.clientTop):l&&(f.x=Gn(l))),{x:h.left+d.scrollLeft-f.x,y:h.top+d.scrollTop-f.y,width:h.width,height:h.height}}function Qi(a){var e=Qn(a),t=a.offsetWidth,n=a.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:a.offsetLeft,y:a.offsetTop,width:t,height:n}}function Wi(a){return Yn(a)==="html"?a:a.assignedSlot||a.parentNode||(it(a)?a.host:null)||Kn(a)}function eh(a){return["html","body","#document"].indexOf(Yn(a))>=0?a.ownerDocument.body:$e(a)&&oa(a)?a:eh(Wi(a))}function Rt(a,e){var t;e===void 0&&(e=[]);var n=eh(a),i=n===((t=a.ownerDocument)==null?void 0:t.body),s=lt(n),o=i?[s].concat(s.visualViewport||[],oa(n)?n:[]):n,l=e.concat(o);return i?l:l.concat(Rt(Wi(o)))}function Dp(a){return["table","td","th"].indexOf(Yn(a))>=0}function Ng(a){return $e(a)&&ki(a).position!=="fixed"?a.offsetParent:null}function Vs(a){for(var e=lt(a),t=Ng(a);t&&Dp(t)&&ki(t).position==="static";)t=Ng(t);return t&&(Yn(t)==="html"||Yn(t)==="body"&&ki(t).position==="static")?e:t||function(n){var i=/firefox/i.test(mn());if(/Trident/i.test(mn())&&$e(n)&&ki(n).position==="fixed")return null;var s=Wi(n);for(it(s)&&(s=s.host);$e(s)&&["html","body"].indexOf(Yn(s))<0;){var o=ki(s);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||i&&o.willChange==="filter"||i&&o.filter&&o.filter!=="none")return s;s=s.parentNode}return null}(a)||e}var la="top",Ma="bottom",Vo="right",Wa="left",pm="auto",Bp=[la,Ma,Vo,Wa],cd="start",ql="end",Jy="clippingParents",Q_="viewport",th="popper",Zy="reference",fm=Bp.reduce(function(a,e){return a.concat([e+"-"+cd,e+"-"+ql])},[]),W_=[].concat(Bp,[pm]).reduce(function(a,e){return a.concat([e,e+"-"+cd,e+"-"+ql])},[]),We="beforeRead",Lt="read",Ht="afterRead",Gt="beforeMain",nn="main",Bn="afterMain",qi="beforeWrite",si="write",Di="afterWrite",or=[We,Lt,Ht,Gt,nn,Bn,qi,si,Di];function zi(a){var e=new Map,t=new Set,n=[];function i(s){t.add(s.name),[].concat(s.requires||[],s.requiresIfExists||[]).forEach(function(o){if(!t.has(o)){var l=e.get(o);l&&i(l)}}),n.push(s)}return a.forEach(function(s){e.set(s.name,s)}),a.forEach(function(s){t.has(s.name)||i(s)}),n}var Ui={placement:"bottom",modifiers:[],strategy:"absolute"};function Ca(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function Ta(a){a===void 0&&(a={});var e=a,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,s=i===void 0?Ui:i;return function(o,l,h){h===void 0&&(h=s);var d,f,v={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ui,s),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},y=[],w=!1,E={state:v,setOptions:function(P){var L=typeof P=="function"?P(v.options):P;M(),v.options=Object.assign({},s,v.options,L),v.scrollParents={reference:Se(o)?Rt(o):o.contextElement?Rt(o.contextElement):[],popper:Rt(l)};var R,I,N=function(j){var H=zi(j);return or.reduce(function(X,ne){return X.concat(H.filter(function(pe){return pe.phase===ne}))},[])}((R=[].concat(n,v.options.modifiers),I=R.reduce(function(j,H){var X=j[H.name];return j[H.name]=X?Object.assign({},X,H,{options:Object.assign({},X.options,H.options),data:Object.assign({},X.data,H.data)}):H,j},{}),Object.keys(I).map(function(j){return I[j]})));return v.orderedModifiers=N.filter(function(j){return j.enabled}),v.orderedModifiers.forEach(function(j){var H=j.name,X=j.options,ne=X===void 0?{}:X,pe=j.effect;if(typeof pe=="function"){var Ae=pe({state:v,name:H,instance:E,options:ne});y.push(Ae||function(){})}}),E.update()},forceUpdate:function(){if(!w){var P=v.elements,L=P.reference,R=P.popper;if(Ca(L,R)){v.rects={reference:wi(L,Vs(R),v.options.strategy==="fixed"),popper:Qi(R)},v.reset=!1,v.placement=v.options.placement,v.orderedModifiers.forEach(function(pe){return v.modifiersData[pe.name]=Object.assign({},pe.data)});for(var I=0;I<v.orderedModifiers.length;I++)if(v.reset!==!0){var N=v.orderedModifiers[I],j=N.fn,H=N.options,X=H===void 0?{}:H,ne=N.name;typeof j=="function"&&(v=j({state:v,options:X,name:ne,instance:E})||v)}else v.reset=!1,I=-1}}},update:(d=function(){return new Promise(function(P){E.forceUpdate(),P(v)})},function(){return f||(f=new Promise(function(P){Promise.resolve().then(function(){f=void 0,P(d())})})),f}),destroy:function(){M(),w=!0}};if(!Ca(o,l))return E;function M(){y.forEach(function(P){return P()}),y=[]}return E.setOptions(h).then(function(P){!w&&h.onFirstUpdate&&h.onFirstUpdate(P)}),E}}var _s=Ta(),nh={passive:!0},Ur={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(a){var e=a.state,t=a.instance,n=a.options,i=n.scroll,s=i===void 0||i,o=n.resize,l=o===void 0||o,h=lt(e.elements.popper),d=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&d.forEach(function(f){f.addEventListener("scroll",t.update,nh)}),l&&h.addEventListener("resize",t.update,nh),function(){s&&d.forEach(function(f){f.removeEventListener("scroll",t.update,nh)}),l&&h.removeEventListener("resize",t.update,nh)}},data:{}};function fr(a){return a.split("-")[0]}function Go(a){return a.split("-")[1]}function ys(a){return["top","bottom"].indexOf(a)>=0?"x":"y"}function ci(a){var e,t=a.reference,n=a.element,i=a.placement,s=i?fr(i):null,o=i?Go(i):null,l=t.x+t.width/2-n.width/2,h=t.y+t.height/2-n.height/2;switch(s){case la:e={x:l,y:t.y-n.height};break;case Ma:e={x:l,y:t.y+t.height};break;case Vo:e={x:t.x+t.width,y:h};break;case Wa:e={x:t.x-n.width,y:h};break;default:e={x:t.x,y:t.y}}var d=s?ys(s):null;if(d!=null){var f=d==="y"?"height":"width";switch(o){case cd:e[d]=e[d]-(t[f]/2-n[f]/2);break;case ql:e[d]=e[d]+(t[f]/2-n[f]/2)}}return e}var cs={name:"popperOffsets",enabled:!0,phase:"read",fn:function(a){var e=a.state,t=a.name;e.modifiersData[t]=ci({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},$y={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ax(a){var e,t=a.popper,n=a.popperRect,i=a.placement,s=a.variation,o=a.offsets,l=a.position,h=a.gpuAcceleration,d=a.adaptive,f=a.roundOffsets,v=a.isFixed,y=o.x,w=y===void 0?0:y,E=o.y,M=E===void 0?0:E,P=typeof f=="function"?f({x:w,y:M}):{x:w,y:M};w=P.x,M=P.y;var L=o.hasOwnProperty("x"),R=o.hasOwnProperty("y"),I=Wa,N=la,j=window;if(d){var H=Vs(t),X="clientHeight",ne="clientWidth";H===lt(t)&&ki(H=Kn(t)).position!=="static"&&l==="absolute"&&(X="scrollHeight",ne="scrollWidth"),(i===la||(i===Wa||i===Vo)&&s===ql)&&(N=Ma,M-=(v&&H===j&&j.visualViewport?j.visualViewport.height:H[X])-n.height,M*=h?1:-1),i!==Wa&&(i!==la&&i!==Ma||s!==ql)||(I=Vo,w-=(v&&H===j&&j.visualViewport?j.visualViewport.width:H[ne])-n.width,w*=h?1:-1)}var pe,Ae=Object.assign({position:l},d&&$y),ve=f===!0?function(Ee){var xe=Ee.x,we=Ee.y,Re=window.devicePixelRatio||1;return{x:Vt(xe*Re)/Re||0,y:Vt(we*Re)/Re||0}}({x:w,y:M}):{x:w,y:M};return w=ve.x,M=ve.y,h?Object.assign({},Ae,((pe={})[N]=R?"0":"",pe[I]=L?"0":"",pe.transform=(j.devicePixelRatio||1)<=1?"translate("+w+"px, "+M+"px)":"translate3d("+w+"px, "+M+"px, 0)",pe)):Object.assign({},Ae,((e={})[N]=R?M+"px":"",e[I]=L?w+"px":"",e.transform="",e))}var eA={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(a){var e=a.state,t=a.options,n=t.gpuAcceleration,i=n===void 0||n,s=t.adaptive,o=s===void 0||s,l=t.roundOffsets,h=l===void 0||l,d={placement:fr(e.placement),variation:Go(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Ax(Object.assign({},d,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:h})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Ax(Object.assign({},d,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:h})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},Lp={name:"applyStyles",enabled:!0,phase:"write",fn:function(a){var e=a.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},s=e.elements[t];$e(s)&&Yn(s)&&(Object.assign(s.style,n),Object.keys(i).forEach(function(o){var l=i[o];l===!1?s.removeAttribute(o):s.setAttribute(o,l===!0?"":l)}))})},effect:function(a){var e=a.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],s=e.attributes[n]||{},o=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]).reduce(function(l,h){return l[h]="",l},{});$e(i)&&Yn(i)&&(Object.assign(i.style,o),Object.keys(s).forEach(function(l){i.removeAttribute(l)}))})}},requires:["computeStyles"]},bx={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(a){var e=a.state,t=a.options,n=a.name,i=t.offset,s=i===void 0?[0,0]:i,o=W_.reduce(function(f,v){return f[v]=function(y,w,E){var M=fr(y),P=[Wa,la].indexOf(M)>=0?-1:1,L=typeof E=="function"?E(Object.assign({},w,{placement:y})):E,R=L[0],I=L[1];return R=R||0,I=(I||0)*P,[Wa,Vo].indexOf(M)>=0?{x:I,y:R}:{x:R,y:I}}(v,e.rects,s),f},{}),l=o[e.placement],h=l.x,d=l.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=h,e.modifiersData.popperOffsets.y+=d),e.modifiersData[n]=o}},IE={left:"right",right:"left",bottom:"top",top:"bottom"};function q_(a){return a.replace(/left|right|bottom|top/g,function(e){return IE[e]})}var PE={start:"end",end:"start"};function xx(a){return a.replace(/start|end/g,function(e){return PE[e]})}function wx(a,e){var t=e.getRootNode&&e.getRootNode();if(a.contains(e))return!0;if(t&&it(t)){var n=e;do{if(n&&a.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function X_(a){return Object.assign({},a,{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height})}function Ex(a,e,t){return e===Q_?X_(function(n,i){var s=lt(n),o=Kn(n),l=s.visualViewport,h=o.clientWidth,d=o.clientHeight,f=0,v=0;if(l){h=l.width,d=l.height;var y=In();(y||!y&&i==="fixed")&&(f=l.offsetLeft,v=l.offsetTop)}return{width:h,height:d,x:f+Gn(n),y:v}}(a,t)):Se(e)?function(n,i){var s=Qn(n,!1,i==="fixed");return s.top=s.top+n.clientTop,s.left=s.left+n.clientLeft,s.bottom=s.top+n.clientHeight,s.right=s.left+n.clientWidth,s.width=n.clientWidth,s.height=n.clientHeight,s.x=s.left,s.y=s.top,s}(e,t):X_(function(n){var i,s=Kn(n),o=Mn(n),l=(i=n.ownerDocument)==null?void 0:i.body,h=Ot(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),d=Ot(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),f=-o.scrollLeft+Gn(n),v=-o.scrollTop;return ki(l||s).direction==="rtl"&&(f+=Ot(s.clientWidth,l?l.clientWidth:0)-h),{width:h,height:d,x:f,y:v}}(Kn(a)))}function mr(a){return Object.assign({},{top:0,right:0,bottom:0,left:0},a)}function Sx(a,e){return e.reduce(function(t,n){return t[n]=a,t},{})}function Ho(a,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?a.placement:n,s=t.strategy,o=s===void 0?a.strategy:s,l=t.boundary,h=l===void 0?Jy:l,d=t.rootBoundary,f=d===void 0?Q_:d,v=t.elementContext,y=v===void 0?th:v,w=t.altBoundary,E=w!==void 0&&w,M=t.padding,P=M===void 0?0:M,L=mr(typeof P!="number"?P:Sx(P,Bp)),R=y===th?Zy:th,I=a.rects.popper,N=a.elements[E?R:y],j=function(xe,we,Re,Be){var Oe=we==="clippingParents"?function(dt){var ht=Rt(Wi(dt)),Nt=["absolute","fixed"].indexOf(ki(dt).position)>=0&&$e(dt)?Vs(dt):dt;return Se(Nt)?ht.filter(function(Bt){return Se(Bt)&&wx(Bt,Nt)&&Yn(Bt)!=="body"}):[]}(xe):[].concat(we),at=[].concat(Oe,[Re]),st=at[0],St=at.reduce(function(dt,ht){var Nt=Ex(xe,ht,Be);return dt.top=Ot(Nt.top,dt.top),dt.right=Ut(Nt.right,dt.right),dt.bottom=Ut(Nt.bottom,dt.bottom),dt.left=Ot(Nt.left,dt.left),dt},Ex(xe,st,Be));return St.width=St.right-St.left,St.height=St.bottom-St.top,St.x=St.left,St.y=St.top,St}(Se(N)?N:N.contextElement||Kn(a.elements.popper),h,f,o),H=Qn(a.elements.reference),X=ci({reference:H,element:I,strategy:"absolute",placement:i}),ne=X_(Object.assign({},I,X)),pe=y===th?ne:H,Ae={top:j.top-pe.top+L.top,bottom:pe.bottom-j.bottom+L.bottom,left:j.left-pe.left+L.left,right:pe.right-j.right+L.right},ve=a.modifiersData.offset;if(y===th&&ve){var Ee=ve[i];Object.keys(Ae).forEach(function(xe){var we=[Vo,Ma].indexOf(xe)>=0?1:-1,Re=[la,Ma].indexOf(xe)>=0?"y":"x";Ae[xe]+=Ee[Re]*we})}return Ae}var ud={name:"flip",enabled:!0,phase:"main",fn:function(a){var e=a.state,t=a.options,n=a.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,s=i===void 0||i,o=t.altAxis,l=o===void 0||o,h=t.fallbackPlacements,d=t.padding,f=t.boundary,v=t.rootBoundary,y=t.altBoundary,w=t.flipVariations,E=w===void 0||w,M=t.allowedAutoPlacements,P=e.options.placement,L=fr(P),R=h||(L!==P&&E?function(dt){if(fr(dt)===pm)return[];var ht=q_(dt);return[xx(dt),ht,xx(ht)]}(P):[q_(P)]),I=[P].concat(R).reduce(function(dt,ht){return dt.concat(fr(ht)===pm?function(Nt,Bt){Bt===void 0&&(Bt={});var rn=Bt,hn=rn.placement,wn=rn.boundary,Jn=rn.rootBoundary,Fn=rn.padding,jn=rn.flipVariations,wt=rn.allowedAutoPlacements,jt=wt===void 0?W_:wt,on=Go(hn),li=on?jn?fm:fm.filter(function(ai){return Go(ai)===on}):Bp,Mi=li.filter(function(ai){return jt.indexOf(ai)>=0});Mi.length===0&&(Mi=li);var pi=Mi.reduce(function(ai,oi){return ai[oi]=Ho(Nt,{placement:oi,boundary:wn,rootBoundary:Jn,padding:Fn})[fr(oi)],ai},{});return Object.keys(pi).sort(function(ai,oi){return pi[ai]-pi[oi]})}(e,{placement:ht,boundary:f,rootBoundary:v,padding:d,flipVariations:E,allowedAutoPlacements:M}):ht)},[]),N=e.rects.reference,j=e.rects.popper,H=new Map,X=!0,ne=I[0],pe=0;pe<I.length;pe++){var Ae=I[pe],ve=fr(Ae),Ee=Go(Ae)===cd,xe=[la,Ma].indexOf(ve)>=0,we=xe?"width":"height",Re=Ho(e,{placement:Ae,boundary:f,rootBoundary:v,altBoundary:y,padding:d}),Be=xe?Ee?Vo:Wa:Ee?Ma:la;N[we]>j[we]&&(Be=q_(Be));var Oe=q_(Be),at=[];if(s&&at.push(Re[ve]<=0),l&&at.push(Re[Be]<=0,Re[Oe]<=0),at.every(function(dt){return dt})){ne=Ae,X=!1;break}H.set(Ae,at)}if(X)for(var st=function(dt){var ht=I.find(function(Nt){var Bt=H.get(Nt);if(Bt)return Bt.slice(0,dt).every(function(rn){return rn})});if(ht)return ne=ht,"break"},St=E?3:1;St>0&&st(St)!=="break";St--);e.placement!==ne&&(e.modifiersData[n]._skip=!0,e.placement=ne,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function mm(a,e,t){return Ot(a,Ut(e,t))}var gm={name:"preventOverflow",enabled:!0,phase:"main",fn:function(a){var e=a.state,t=a.options,n=a.name,i=t.mainAxis,s=i===void 0||i,o=t.altAxis,l=o!==void 0&&o,h=t.boundary,d=t.rootBoundary,f=t.altBoundary,v=t.padding,y=t.tether,w=y===void 0||y,E=t.tetherOffset,M=E===void 0?0:E,P=Ho(e,{boundary:h,rootBoundary:d,padding:v,altBoundary:f}),L=fr(e.placement),R=Go(e.placement),I=!R,N=ys(L),j=N==="x"?"y":"x",H=e.modifiersData.popperOffsets,X=e.rects.reference,ne=e.rects.popper,pe=typeof M=="function"?M(Object.assign({},e.rects,{placement:e.placement})):M,Ae=typeof pe=="number"?{mainAxis:pe,altAxis:pe}:Object.assign({mainAxis:0,altAxis:0},pe),ve=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Ee={x:0,y:0};if(H){if(s){var xe,we=N==="y"?la:Wa,Re=N==="y"?Ma:Vo,Be=N==="y"?"height":"width",Oe=H[N],at=Oe+P[we],st=Oe-P[Re],St=w?-ne[Be]/2:0,dt=R===cd?X[Be]:ne[Be],ht=R===cd?-ne[Be]:-X[Be],Nt=e.elements.arrow,Bt=w&&Nt?Qi(Nt):{width:0,height:0},rn=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},hn=rn[we],wn=rn[Re],Jn=mm(0,X[Be],Bt[Be]),Fn=I?X[Be]/2-St-Jn-hn-Ae.mainAxis:dt-Jn-hn-Ae.mainAxis,jn=I?-X[Be]/2+St+Jn+wn+Ae.mainAxis:ht+Jn+wn+Ae.mainAxis,wt=e.elements.arrow&&Vs(e.elements.arrow),jt=wt?N==="y"?wt.clientTop||0:wt.clientLeft||0:0,on=(xe=ve==null?void 0:ve[N])!=null?xe:0,li=Oe+jn-on,Mi=mm(w?Ut(at,Oe+Fn-on-jt):at,Oe,w?Ot(st,li):st);H[N]=Mi,Ee[N]=Mi-Oe}if(l){var pi,ai=N==="x"?la:Wa,oi=N==="x"?Ma:Vo,Dn=H[j],vt=j==="y"?"height":"width",an=Dn+P[ai],On=Dn-P[oi],Xt=[la,Wa].indexOf(L)!==-1,ei=(pi=ve==null?void 0:ve[j])!=null?pi:0,Nr=Xt?an:Dn-X[vt]-ne[vt]-ei+Ae.altAxis,ts=Xt?Dn+X[vt]+ne[vt]-ei-Ae.altAxis:On,Bs=w&&Xt?function(qa,yo,Ba){var ui=mm(qa,yo,Ba);return ui>Ba?Ba:ui}(Nr,Dn,ts):mm(w?Nr:an,Dn,w?ts:On);H[j]=Bs,Ee[j]=Bs-Dn}e.modifiersData[n]=Ee}},requiresIfExists:["offset"]},Y_={name:"arrow",enabled:!0,phase:"main",fn:function(a){var e,t=a.state,n=a.name,i=a.options,s=t.elements.arrow,o=t.modifiersData.popperOffsets,l=fr(t.placement),h=ys(l),d=[Wa,Vo].indexOf(l)>=0?"height":"width";if(s&&o){var f=function(ne,pe){return mr(typeof(ne=typeof ne=="function"?ne(Object.assign({},pe.rects,{placement:pe.placement})):ne)!="number"?ne:Sx(ne,Bp))}(i.padding,t),v=Qi(s),y=h==="y"?la:Wa,w=h==="y"?Ma:Vo,E=t.rects.reference[d]+t.rects.reference[h]-o[h]-t.rects.popper[d],M=o[h]-t.rects.reference[h],P=Vs(s),L=P?h==="y"?P.clientHeight||0:P.clientWidth||0:0,R=E/2-M/2,I=f[y],N=L-v[d]-f[w],j=L/2-v[d]/2+R,H=mm(I,j,N),X=h;t.modifiersData[n]=((e={})[X]=H,e.centerOffset=H-j,e)}},effect:function(a){var e=a.state,t=a.options.element,n=t===void 0?"[data-popper-arrow]":t;n!=null&&(typeof n!="string"||(n=e.elements.popper.querySelector(n)))&&wx(e.elements.popper,n)&&(e.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ia(a,e,t){return t===void 0&&(t={x:0,y:0}),{top:a.top-e.height-t.y,right:a.right-e.width+t.x,bottom:a.bottom-e.height+t.y,left:a.left-e.width-t.x}}function hd(a){return[la,Vo,Ma,Wa].some(function(e){return a[e]>=0})}var K_={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(a){var e=a.state,t=a.name,n=e.rects.reference,i=e.rects.popper,s=e.modifiersData.preventOverflow,o=Ho(e,{elementContext:"reference"}),l=Ho(e,{altBoundary:!0}),h=Ia(o,n),d=Ia(l,i,s),f=hd(h),v=hd(d);e.modifiersData[t]={referenceClippingOffsets:h,popperEscapeOffsets:d,isReferenceHidden:f,hasPopperEscaped:v},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":f,"data-popper-escaped":v})}},Cc=Ta({defaultModifiers:[Ur,cs,eA,Lp,bx,ud,gm,Y_,K_]}),Tc="tippy-box",tA="tippy-content",fo="tippy-backdrop",vm="tippy-arrow",Mx="tippy-svg-arrow",dd={passive:!0,capture:!0},GM=function(){return document.body};function RE(a,e,t){if(Array.isArray(a)){var n=a[e];return n??(Array.isArray(t)?t[e]:t)}return a}function DE(a,e){var t={}.toString.call(a);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function HM(a,e){return typeof a=="function"?a.apply(void 0,e):a}function QM(a,e){return e===0?a:function(n){clearTimeout(t),t=setTimeout(function(){a(n)},e)};var t}function Fg(a){return[].concat(a)}function WM(a,e){a.indexOf(e)===-1&&a.push(e)}function Cx(a){return[].slice.call(a)}function qM(a){return Object.keys(a).reduce(function(e,t){return a[t]!==void 0&&(e[t]=a[t]),e},{})}function J_(){return document.createElement("div")}function Tx(a){return["Element","Fragment"].some(function(e){return DE(a,e)})}function BE(a,e){a.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function XM(a,e){a.forEach(function(t){t&&t.setAttribute("data-state",e)})}function LE(a,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){a[n](i,t)})}function YM(a,e){for(var t=e;t;){var n;if(a.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var pd={isTouch:!1},KM=0;function xR(){pd.isTouch||(pd.isTouch=!0,window.performance&&document.addEventListener("mousemove",JM))}function JM(){var a=performance.now();a-KM<20&&(pd.isTouch=!1,document.removeEventListener("mousemove",JM)),KM=a}function wR(){var a,e=document.activeElement;if((a=e)&&a._tippy&&a._tippy.reference===a){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var ER=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),ih=Object.assign({appendTo:GM,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),SR=Object.keys(ih);function ZM(a){var e=(a.plugins||[]).reduce(function(t,n){var i,s=n.name,o=n.defaultValue;return s&&(t[s]=a[s]!==void 0?a[s]:(i=ih[s])!=null?i:o),t},{});return Object.assign({},a,e)}function $M(a,e){var t=Object.assign({},e,{content:HM(e.content,[a])},e.ignoreAttributes?{}:function(n,i){return(i?Object.keys(ZM(Object.assign({},ih,{plugins:i}))):SR).reduce(function(s,o){var l=(n.getAttribute("data-tippy-"+o)||"").trim();if(!l)return s;if(o==="content")s[o]=l;else try{s[o]=JSON.parse(l)}catch{s[o]=l}return s},{})}(a,e.plugins));return t.aria=Object.assign({},ih.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var MR=function(){return"innerHTML"};function OE(a,e){a[MR()]=e}function eC(a){var e=J_();return a===!0?e.className=vm:(e.className=Mx,Tx(a)?e.appendChild(a):OE(e,a)),e}function tC(a,e){Tx(e.content)?(OE(a,""),a.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?OE(a,e.content):a.textContent=e.content)}function kE(a){var e=a.firstElementChild,t=Cx(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(tA)}),arrow:t.find(function(n){return n.classList.contains(vm)||n.classList.contains(Mx)}),backdrop:t.find(function(n){return n.classList.contains(fo)})}}function nC(a){var e=J_(),t=J_();t.className=Tc,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=J_();function i(s,o){var l=kE(e),h=l.box,d=l.content,f=l.arrow;o.theme?h.setAttribute("data-theme",o.theme):h.removeAttribute("data-theme"),typeof o.animation=="string"?h.setAttribute("data-animation",o.animation):h.removeAttribute("data-animation"),o.inertia?h.setAttribute("data-inertia",""):h.removeAttribute("data-inertia"),h.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?h.setAttribute("role",o.role):h.removeAttribute("role"),s.content===o.content&&s.allowHTML===o.allowHTML||tC(d,a.props),o.arrow?f?s.arrow!==o.arrow&&(h.removeChild(f),h.appendChild(eC(o.arrow))):h.appendChild(eC(o.arrow)):f&&h.removeChild(f)}return n.className=tA,n.setAttribute("data-state","hidden"),tC(n,a.props),e.appendChild(t),t.appendChild(n),i(a.props,a.props),{popper:e,onUpdate:i}}nC.$$tippy=!0;var CR=1,Ix=[],UE=[];function TR(a,e){var t,n,i,s,o,l,h,d,f=$M(a,Object.assign({},ih,ZM(qM(e)))),v=!1,y=!1,w=!1,E=!1,M=[],P=QM(wt,f.interactiveDebounce),L=CR++,R=(d=f.plugins).filter(function(vt,an){return d.indexOf(vt)===an}),I={id:L,reference:a,popper:J_(),popperInstance:null,props:f,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:R,clearDelayTimeouts:function(){clearTimeout(t),clearTimeout(n),cancelAnimationFrame(i)},setProps:function(vt){if(!I.state.isDestroyed){Oe("onBeforeUpdate",[I,vt]),Fn();var an=I.props,On=$M(a,Object.assign({},an,qM(vt),{ignoreAttributes:!0}));I.props=On,Jn(),an.interactiveDebounce!==On.interactiveDebounce&&(St(),P=QM(wt,On.interactiveDebounce)),an.triggerTarget&&!On.triggerTarget?Fg(an.triggerTarget).forEach(function(Xt){Xt.removeAttribute("aria-expanded")}):On.triggerTarget&&a.removeAttribute("aria-expanded"),st(),Be(),H&&H(an,On),I.popperInstance&&(Mi(),ai().forEach(function(Xt){requestAnimationFrame(Xt._tippy.popperInstance.forceUpdate)})),Oe("onAfterUpdate",[I,vt])}},setContent:function(vt){I.setProps({content:vt})},show:function(){var vt=I.state.isVisible,an=I.state.isDestroyed,On=!I.state.isEnabled,Xt=pd.isTouch&&!I.props.touch,ei=RE(I.props.duration,0,ih.duration);if(!(vt||an||On||Xt||Ee().hasAttribute("disabled")||(Oe("onShow",[I],!1),I.props.onShow(I)===!1))){if(I.state.isVisible=!0,ve()&&(j.style.visibility="visible"),Be(),Bt(),I.state.isMounted||(j.style.transition="none"),ve()){var Nr=we();BE([Nr.box,Nr.content],0)}var ts,Bs,qa;l=function(){var yo;if(I.state.isVisible&&!E){if(E=!0,j.offsetHeight,j.style.transition=I.props.moveTransition,ve()&&I.props.animation){var Ba=we(),ui=Ba.box,bl=Ba.content;BE([ui,bl],ei),XM([ui,bl],"visible")}at(),st(),WM(UE,I),(yo=I.popperInstance)==null||yo.forceUpdate(),Oe("onMount",[I]),I.props.animation&&ve()&&function(af,Ne){hn(af,function(){I.state.isShown=!0,Oe("onShown",[I])})}(ei)}},Bs=I.props.appendTo,qa=Ee(),(ts=I.props.interactive&&Bs===GM||Bs==="parent"?qa.parentNode:HM(Bs,[qa])).contains(j)||ts.appendChild(j),I.state.isMounted=!0,Mi()}},hide:function(){var vt=!I.state.isVisible,an=I.state.isDestroyed,On=!I.state.isEnabled,Xt=RE(I.props.duration,1,ih.duration);if(!(vt||an||On)&&(Oe("onHide",[I],!1),I.props.onHide(I)!==!1)){if(I.state.isVisible=!1,I.state.isShown=!1,E=!1,v=!1,ve()&&(j.style.visibility="hidden"),St(),rn(),Be(!0),ve()){var ei=we(),Nr=ei.box,ts=ei.content;I.props.animation&&(BE([Nr,ts],Xt),XM([Nr,ts],"hidden"))}at(),st(),I.props.animation?ve()&&function(Bs,qa){hn(Bs,function(){!I.state.isVisible&&j.parentNode&&j.parentNode.contains(j)&&qa()})}(Xt,I.unmount):I.unmount()}},hideWithInteractivity:function(vt){xe().addEventListener("mousemove",P),WM(Ix,P),P(vt)},enable:function(){I.state.isEnabled=!0},disable:function(){I.hide(),I.state.isEnabled=!1},unmount:function(){I.state.isVisible&&I.hide(),I.state.isMounted&&(pi(),ai().forEach(function(vt){vt._tippy.unmount()}),j.parentNode&&j.parentNode.removeChild(j),UE=UE.filter(function(vt){return vt!==I}),I.state.isMounted=!1,Oe("onHidden",[I]))},destroy:function(){I.state.isDestroyed||(I.clearDelayTimeouts(),I.unmount(),Fn(),delete a._tippy,I.state.isDestroyed=!0,Oe("onDestroy",[I]))}};if(!f.render)return I;var N=f.render(I),j=N.popper,H=N.onUpdate;j.setAttribute("data-tippy-root",""),j.id="tippy-"+I.id,I.popper=j,a._tippy=I,j._tippy=I;var X=R.map(function(vt){return vt.fn(I)}),ne=a.hasAttribute("aria-expanded");return Jn(),st(),Be(),Oe("onCreate",[I]),f.showOnCreate&&oi(),j.addEventListener("mouseenter",function(){I.props.interactive&&I.state.isVisible&&I.clearDelayTimeouts()}),j.addEventListener("mouseleave",function(){I.props.interactive&&I.props.trigger.indexOf("mouseenter")>=0&&xe().addEventListener("mousemove",P)}),I;function pe(){var vt=I.props.touch;return Array.isArray(vt)?vt:[vt,0]}function Ae(){return pe()[0]==="hold"}function ve(){var vt;return!((vt=I.props.render)==null||!vt.$$tippy)}function Ee(){return h||a}function xe(){var vt,an,On=Ee().parentNode;return On&&(an=Fg(On)[0])!=null&&(vt=an.ownerDocument)!=null&&vt.body?an.ownerDocument:document}function we(){return kE(j)}function Re(vt){return I.state.isMounted&&!I.state.isVisible||pd.isTouch||s&&s.type==="focus"?0:RE(I.props.delay,vt?0:1,ih.delay)}function Be(vt){vt===void 0&&(vt=!1),j.style.pointerEvents=I.props.interactive&&!vt?"":"none",j.style.zIndex=""+I.props.zIndex}function Oe(vt,an,On){var Xt;On===void 0&&(On=!0),X.forEach(function(ei){ei[vt]&&ei[vt].apply(ei,an)}),On&&(Xt=I.props)[vt].apply(Xt,an)}function at(){var vt=I.props.aria;if(vt.content){var an="aria-"+vt.content,On=j.id;Fg(I.props.triggerTarget||a).forEach(function(Xt){var ei=Xt.getAttribute(an);if(I.state.isVisible)Xt.setAttribute(an,ei?ei+" "+On:On);else{var Nr=ei&&ei.replace(On,"").trim();Nr?Xt.setAttribute(an,Nr):Xt.removeAttribute(an)}})}}function st(){!ne&&I.props.aria.expanded&&Fg(I.props.triggerTarget||a).forEach(function(vt){I.props.interactive?vt.setAttribute("aria-expanded",I.state.isVisible&&vt===Ee()?"true":"false"):vt.removeAttribute("aria-expanded")})}function St(){xe().removeEventListener("mousemove",P),Ix=Ix.filter(function(vt){return vt!==P})}function dt(vt){if(!pd.isTouch||!w&&vt.type!=="mousedown"){var an=vt.composedPath&&vt.composedPath()[0]||vt.target;if(!I.props.interactive||!YM(j,an)){if(Fg(I.props.triggerTarget||a).some(function(On){return YM(On,an)})){if(pd.isTouch||I.state.isVisible&&I.props.trigger.indexOf("click")>=0)return}else Oe("onClickOutside",[I,vt]);I.props.hideOnClick===!0&&(I.clearDelayTimeouts(),I.hide(),y=!0,setTimeout(function(){y=!1}),I.state.isMounted||rn())}}}function ht(){w=!0}function Nt(){w=!1}function Bt(){var vt=xe();vt.addEventListener("mousedown",dt,!0),vt.addEventListener("touchend",dt,dd),vt.addEventListener("touchstart",Nt,dd),vt.addEventListener("touchmove",ht,dd)}function rn(){var vt=xe();vt.removeEventListener("mousedown",dt,!0),vt.removeEventListener("touchend",dt,dd),vt.removeEventListener("touchstart",Nt,dd),vt.removeEventListener("touchmove",ht,dd)}function hn(vt,an){var On=we().box;function Xt(ei){ei.target===On&&(LE(On,"remove",Xt),an())}if(vt===0)return an();LE(On,"remove",o),LE(On,"add",Xt),o=Xt}function wn(vt,an,On){On===void 0&&(On=!1),Fg(I.props.triggerTarget||a).forEach(function(Xt){Xt.addEventListener(vt,an,On),M.push({node:Xt,eventType:vt,handler:an,options:On})})}function Jn(){var vt;Ae()&&(wn("touchstart",jn,{passive:!0}),wn("touchend",jt,{passive:!0})),(vt=I.props.trigger,vt.split(/\s+/).filter(Boolean)).forEach(function(an){if(an!=="manual")switch(wn(an,jn),an){case"mouseenter":wn("mouseleave",jt);break;case"focus":wn(ER?"focusout":"blur",on);break;case"focusin":wn("focusout",on)}})}function Fn(){M.forEach(function(vt){var an=vt.node,On=vt.eventType,Xt=vt.handler,ei=vt.options;an.removeEventListener(On,Xt,ei)}),M=[]}function jn(vt){var an,On=!1;if(I.state.isEnabled&&!li(vt)&&!y){var Xt=((an=s)==null?void 0:an.type)==="focus";s=vt,h=vt.currentTarget,st(),!I.state.isVisible&&DE(vt,"MouseEvent")&&Ix.forEach(function(ei){return ei(vt)}),vt.type==="click"&&(I.props.trigger.indexOf("mouseenter")<0||v)&&I.props.hideOnClick!==!1&&I.state.isVisible?On=!0:oi(vt),vt.type==="click"&&(v=!On),On&&!Xt&&Dn(vt)}}function wt(vt){var an=vt.target,On=Ee().contains(an)||j.contains(an);if(vt.type!=="mousemove"||!On){var Xt=ai().concat(j).map(function(ei){var Nr,ts=(Nr=ei._tippy.popperInstance)==null?void 0:Nr.state;return ts?{popperRect:ei.getBoundingClientRect(),popperState:ts,props:f}:null}).filter(Boolean);(function(ei,Nr){var ts=Nr.clientX,Bs=Nr.clientY;return ei.every(function(qa){var yo=qa.popperRect,Ba=qa.popperState,ui=qa.props.interactiveBorder,bl=Ba.placement.split("-")[0],af=Ba.modifiersData.offset;if(!af)return!0;var Ne=bl==="bottom"?af.top.y:0,ut=bl==="top"?af.bottom.y:0,xt=bl==="right"?af.left.x:0,Jt=bl==="left"?af.right.x:0,ln=yo.top-Bs+Ne>ui,Et=Bs-yo.bottom-ut>ui,$t=yo.left-ts+xt>ui,Nn=ts-yo.right-Jt>ui;return ln||Et||$t||Nn})})(Xt,vt)&&(St(),Dn(vt))}}function jt(vt){li(vt)||I.props.trigger.indexOf("click")>=0&&v||(I.props.interactive?I.hideWithInteractivity(vt):Dn(vt))}function on(vt){I.props.trigger.indexOf("focusin")<0&&vt.target!==Ee()||I.props.interactive&&vt.relatedTarget&&j.contains(vt.relatedTarget)||Dn(vt)}function li(vt){return!!pd.isTouch&&Ae()!==vt.type.indexOf("touch")>=0}function Mi(){pi();var vt=I.props,an=vt.popperOptions,On=vt.placement,Xt=vt.offset,ei=vt.getReferenceClientRect,Nr=vt.moveTransition,ts=ve()?kE(j).arrow:null,Bs=ei?{getBoundingClientRect:ei,contextElement:ei.contextElement||Ee()}:a,qa=[{name:"offset",options:{offset:Xt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Nr}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(yo){var Ba=yo.state;if(ve()){var ui=we().box;["placement","reference-hidden","escaped"].forEach(function(bl){bl==="placement"?ui.setAttribute("data-placement",Ba.placement):Ba.attributes.popper["data-popper-"+bl]?ui.setAttribute("data-"+bl,""):ui.removeAttribute("data-"+bl)}),Ba.attributes.popper={}}}}];ve()&&ts&&qa.push({name:"arrow",options:{element:ts,padding:3}}),qa.push.apply(qa,(an==null?void 0:an.modifiers)||[]),I.popperInstance=Cc(Bs,j,Object.assign({},an,{placement:On,onFirstUpdate:l,modifiers:qa}))}function pi(){I.popperInstance&&(I.popperInstance.destroy(),I.popperInstance=null)}function ai(){return Cx(j.querySelectorAll("[data-tippy-root]"))}function oi(vt){I.clearDelayTimeouts(),vt&&Oe("onTrigger",[I,vt]),Bt();var an=Re(!0),On=pe(),Xt=On[0],ei=On[1];pd.isTouch&&Xt==="hold"&&ei&&(an=ei),an?t=setTimeout(function(){I.show()},an):I.show()}function Dn(vt){if(I.clearDelayTimeouts(),Oe("onUntrigger",[I,vt]),I.state.isVisible){if(!(I.props.trigger.indexOf("mouseenter")>=0&&I.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(vt.type)>=0&&v)){var an=Re(!1);an?n=setTimeout(function(){I.state.isVisible&&I.hide()},an):i=requestAnimationFrame(function(){I.hide()})}}else rn()}}function Z_(a,e){e===void 0&&(e={});var t=ih.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",xR,dd),window.addEventListener("blur",wR);var n,i=Object.assign({},e,{plugins:t}),s=(n=a,Tx(n)?[n]:function(o){return DE(o,"NodeList")}(n)?Cx(n):Array.isArray(n)?n:Cx(document.querySelectorAll(n))).reduce(function(o,l){var h=l&&TR(l,i);return h&&o.push(h),o},[]);return Tx(a)?s[0]:s}Z_.defaultProps=ih,Z_.setDefaultProps=function(a){Object.keys(a).forEach(function(e){ih[e]=a[e]})},Z_.currentInput=pd;var IR=Object.assign({},Lp,{effect:function(a){var e=a.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow)}}),PR=function(a,e){var t;e===void 0&&(e={});var n,i=a,s=[],o=[],l=e.overrides,h=[],d=!1;function f(){o=i.map(function(H){return Fg(H.props.triggerTarget||H.reference)}).reduce(function(H,X){return H.concat(X)},[])}function v(){s=i.map(function(H){return H.reference})}function y(H){i.forEach(function(X){H?X.enable():X.disable()})}function w(H){return i.map(function(X){var ne=X.setProps;return X.setProps=function(pe){ne(pe),X.reference===n&&H.setProps(pe)},function(){X.setProps=ne}})}function E(H,X){var ne=o.indexOf(X);if(X!==n){n=X;var pe=(l||[]).concat("content").reduce(function(Ae,ve){return Ae[ve]=i[ne].props[ve],Ae},{});H.setProps(Object.assign({},pe,{getReferenceClientRect:typeof pe.getReferenceClientRect=="function"?pe.getReferenceClientRect:function(){var Ae;return(Ae=s[ne])==null?void 0:Ae.getBoundingClientRect()}}))}}y(!1),v(),f();var M,P,L,R={fn:function(){return{onDestroy:function(){y(!0)},onHidden:function(){n=null},onClickOutside:function(H){H.props.showOnCreate&&!d&&(d=!0,n=null)},onShow:function(H){H.props.showOnCreate&&!d&&(d=!0,E(H,s[0]))},onTrigger:function(H,X){E(H,X.currentTarget)}}}},I=Z_(J_(),Object.assign({},(M=e,P=["overrides"],L=Object.assign({},M),P.forEach(function(H){delete L[H]}),L),{plugins:[R].concat(e.plugins||[]),triggerTarget:o,popperOptions:Object.assign({},e.popperOptions,{modifiers:[].concat(((t=e.popperOptions)==null?void 0:t.modifiers)||[],[IR])})})),N=I.show;I.show=function(H){if(N(),!n&&H==null)return E(I,s[0]);if(!n||H!=null){if(typeof H=="number")return s[H]&&E(I,s[H]);if(i.indexOf(H)>=0){var X=H.reference;return E(I,X)}return s.indexOf(H)>=0?E(I,H):void 0}},I.showNext=function(){var H=s[0];if(!n)return I.show(0);var X=s.indexOf(n);I.show(s[X+1]||H)},I.showPrevious=function(){var H=s[s.length-1];if(!n)return I.show(H);var X=s.indexOf(n),ne=s[X-1]||H;I.show(ne)};var j=I.setProps;return I.setProps=function(H){l=H.overrides||l,j(H)},I.setInstances=function(H){y(!0),h.forEach(function(X){return X()}),i=H,y(!1),v(),f(),h=w(I),I.setProps({triggerTarget:o})},h=w(I),I};Z_.setDefaultProps({render:nC});var _m=Z_;class fl{static _initialize(){this._inited=!0,(0,g.createStyles)(g.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&e.button===0&&this.Remove()})}static Create(e,t,n){this._inited||this._initialize(),this.Element&&this.Remove();const i=(0,g.createDiv)({id:"customContextMenu",addToBody:!1});i.style.top=n+"px",i.style.left=t+"px";for(const[s,o]of Object.entries(e)){const l=(0,g.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:s});i.appendChild(l),l.onclick=o}return this.Element=i,i}static Remove(){var e;(e=this.Element)==null||e.remove(),this.Element=void 0}}fl.Element=void 0,fl._inited=!1;class Op extends rt{async _refreshUi(){var e;if(!await super._refreshUi())return!1;Qe.RemoveAll(Op.PluginType);for(const t of this.variations)Qe.Create(Op.PluginType,t.title,5,20,0,t.materials.map(n=>{let i;if(t.preview.startsWith("generate:"))i=this._previewGenerator.generate(n,t.preview.split(":")[1]);else{const s=n[t.preview]||"#ff00ff";i=s.image?(0,g.imageBitmapToBase64)(s.image,100):void 0,i||(i=(0,g.makeColorSvgCircle)(s!=null&&s.isColor?s.getHexString():s))}return{id:n.uuid,image:i,onClick:s=>this.applyVariation(t,s),tooltip:n.name||n.uuid}}),(n,i)=>{_m(n,{placement:"bottom",content:i.tooltip}),n.oncontextmenu=s=>{s.preventDefault(),s.stopPropagation();const o=fl.Create({Remove:()=>{t.materials=t.materials.filter(l=>l.uuid!==i.id),this.refreshUi(),fl.Remove()}},s.clientX,s.clientY);document.body.appendChild(o)}});return Qe.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}Op.PluginType="MaterialConfiguratorPlugin";class NE extends Sn{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[Yt],this.variations=[],this._selectedSwitchNode=()=>{var e;const t=(e=this._picking)==null?void 0:e.getSelectedObject();if(!t)return;const n=this.variations.map(s=>s.name);let i;return t.traverseAncestors(s=>{i||s.name&&n.includes(s.name)&&(i=s)}),i},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var t,n;await super.onAdded(e),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",()=>{var i,s;(s=(i=this.uiConfig).uiRefresh)==null||s.call(i)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer&&this.enabled){for(const i of this.variations){if(!i.name)continue;const s=this._viewer.scene.getObjectByName(i.name);if(!s||s.children.length<1)return;i.selected||(i.selected=s.children[0].name||s.children[0].uuid);for(const o of s.children)o.userData.__oldVisible=o.visible,o.visible=(o.name||o.uuid)===i.selected}this._isVisibleChanged=!0}}),e.addEventListener("postRender",()=>{if(this._viewer&&this._isVisibleChanged){for(const i of this.variations){if(!i.name)continue;const s=this._viewer.scene.getObjectByName(i.name);if(!s||s.children.length<1)return;for(const o of s.children){if(o.userData.__oldVisible===void 0)return;o.visible=o.userData.__oldVisible,delete o.userData.__oldVisible}}this._isVisibleChanged=!1}}),this.addEventListener("deserialize",async()=>{this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(t=(e=this.uiConfig).uiRefresh)==null||t.call(e),!0)}}(function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([ke()],NE.prototype,"variations",void 0);class kp extends NE{_refreshUi(){var e;if(!super._refreshUi())return!1;Qe.RemoveAll(kp.PluginType);for(const t of this.variations){const n=this._viewer.scene.getObjectByName(t.name);n?(n.children.length<1&&console.warn("SwitchNode does not have enough children",t),Qe.Create(kp.PluginType,t.title,Math.min(5,n.children.length),20,0,n.children.map(i=>{const s=t.camView,o=new u.Pa4((s.includes("right")?1:0)-(s.includes("left")?1:0),(s.includes("top")?1:0)-(s.includes("bottom")?1:0),(s.includes("front")?1:0)-(s.includes("back")?1:0));t.camDistance||(t.camDistance=1);const l=Le(this._viewer,i,void 0,7,o.multiplyScalar(.5*t.camDistance));return{id:i.uuid,image:l,onClick:()=>{var h;t.selected=i.name||i.uuid,(h=this._viewer)==null||h.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:i.name||i.uuid}}),(i,s)=>_m(i,{placement:"bottom",content:s.tooltip}))):console.warn("no object found for variation, skipping",t)}return Qe.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}kp.PluginType="SwitchNodePlugin";class Px extends Sn{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0))},this.dependencies=[Yt],this._selectedObject=()=>{var e;return((e=this._picking)==null?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())==null?void 0:e.material)||void 0}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),this._previewGenerator=new _t(this._viewer),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,n;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(n=this._picking)==null||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}Px.PluginType="MaterialLibraryBasePlugin",function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([sn("Enabled")],Px.prototype,"enabled",void 0);class fd extends Px{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:Ys(),children:[...Sl(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Yt).materials.getAllMaterials().map(e=>({label:e.name||e.uuid,value:e.uuid}))||[]]],getValue:()=>{var e;return(e=this._selectedMaterial())==null?void 0:e.uuid},setValue:e=>{var t,n,i,s,o;const l=(i=(n=(t=this._viewer)==null?void 0:t.getPlugin(Yt))==null?void 0:n.materials)==null?void 0:i.findMaterial(e);if(l)if(this.replaceMaterial)(o=(s=this._selectedObject())==null?void 0:s.setMaterial)==null||o.call(s,l);else{const h=this._selectedMaterial();if(h){const d=h.name,f=h.uuid;h.copyProps(l),h.name=d,h.uuid=f,h.userData.uuid&&(h.userData.uuid=f)}}this._refreshUi()}})]}}async _refreshUi(){var e,t,n;if(!await super._refreshUi())return!1;const i=[Os.TypeSlug,Gi.TypeSlug],s=(t=(e=this._viewer)==null?void 0:e.getPlugin(Yt))==null?void 0:t.materials,o=i.map(l=>[l,s==null?void 0:s.getMaterialsOfType(l)]);Qe.RemoveAll(fd.PluginType);for(const[l,h]of o)Qe.Create(fd.PluginType,l,5,20,0,h==null?void 0:h.filter(d=>!d.userData.__runtimeMaterial).map(d=>{let f;const v="generate:sphere";if(v.startsWith("generate:"))f=this._previewGenerator.generate(d,v.split(":")[1]);else{const y=d[v]||"#ff00ff";f=y.image?(0,g.imageBitmapToBase64)(y.image,100):void 0,f||(f=(0,g.makeColorSvg)(y))}return{id:d.uuid,image:f,onClick:y=>{const w=s==null?void 0:s.findMaterial(y);if(w){const E=w.userData.__appliedMeshes;if(E!=null&&E.size){const M=E.keys().next().value;M.dispatchEvent({type:"select",value:M})}}},tooltip:d.name||d.uuid}}),(d,f)=>_m(d,{placement:"bottom",content:f.tooltip}));return Qe.RebuildUi((n=this._viewer)==null?void 0:n.container),!0}}fd.PluginType="MaterialLibraryPlugin",function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([sn("Replace Material")],fd.prototype,"replaceMaterial",void 0);class FE extends u.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,t){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",g.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([bt({propKey:"tLastThis"})],FE.prototype,"lastFrameTexture",void 0);var zg=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Xl extends g.SimpleEventDispatcher{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(n,i)=>g.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(n,i,s)=>{this.groundMapMode==="aoMap"?n.fragmentShader=_n(n.fragmentShader,"#include <aomap_fragment>",_n(u.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?n.fragmentShader=_n(n.fragmentShader,"#include <map_fragment>",_n(u.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(n.fragmentShader=_n(n.fragmentShader,"#include <alphamap_fragment>",_n(u.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),n.fragmentShader=_n(n.fragmentShader,"#include <output_fragment>",g.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&s.capabilities.isWebGL2&&(n.fragmentShader=_n(n.fragmentShader,"#include <output_fragment>",g.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(n,i)=>{i.materialObject.userData.gMapMode!==this.groundMapMode&&(i.materialObject.userData.gMapMode=this.groundMapMode,i.materialObject.needsUpdate=!0)},isCompatible:n=>n.isMeshStandardMaterial2},this._viewer=e;const t=new zf(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new u.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new u.Pa4(10,10,10),normalDirection:new u.Pa4(0,1,0)});t.shadow.camera.updateProjectionMatrix(),t.layers.disableAll(),t.layers.set(this._lightLayer),this._light=t,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new FE({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:u.jFi}),this._shadowBlurMat=new zc({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new u.FM8(.5,.5)},direction:{value:new u.FM8(.5,.5)}},vertexShader:ro,fragmentShader:`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,n;(t=(e=this.materialExtension)==null?void 0:e.setDirty)==null||t.call(e),(n=this._viewer)==null||n.setDirty()}fromJSON(e,t){return Yi(e,this,!0,t),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(!e||++this._frameNumber>this.maxFrameNumber)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:u.ywz,depthBuffer:!1,size:new u.FM8(t,t),sizeMultiplier:void 0,colorSpace:u.aCh,format:u.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const n=this._viewer.renderer.rendererObject,i=n.shadowMap,s=i.type,o=i.needsUpdate,l=i.autoUpdate;i.type=u._MY,i.needsUpdate=!0,i.autoUpdate=!1;const h=this._viewer.scene,d=new u.S9g;d.disableAll(),h.modelObject.traverse(E=>{E.isLight&&E!==this._light.lightObject&&(E.userData.__gp_layers=E.layers,E.layers=d)});const f=h.activeCamera.cameraObject;if(f.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";f.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),mi(n,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(h)),f.layers.disable(this._lightLayer);const v=f.layers.mask;f.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const y=this._viewer.renderer.getTempTarget({type:u.ywz,depthBuffer:!1,size:new u.FM8(t,t),colorSpace:u.aCh,format:u.wk1}),w=y.texture.colorSpace;y.texture.colorSpace=u.aCh,this._viewer.renderer.blit(this._target.texture,y,{clear:!0});{const E=e.material,M=e.frustumCulled,P=n.getRenderTarget(),L=n.getActiveCubeFace(),R=n.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,n.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=y.texture,this._shadowMat.needsUpdate=!0,mi(n,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(h)),n.setRenderTarget(P,L,R),e.frustumCulled=M,e.material=E,this.smoothShadow&&this._applySmoothFilter(this._target,y)}return y.texture.colorSpace=w,this._viewer.renderer.releaseTempTarget(y),e.layers.disable(this._lightLayer),f.layers.mask=v,h.modelObject.traverse(E=>{E.isLight&&E!==this._light.lightObject&&(E.layers=E.userData.__gp_layers,delete E.userData.__gp_layers)}),i.type=s,i.needsUpdate=o,i.autoUpdate=l,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,n,i;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((t=this._target)==null?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((n=this._target)==null?void 0:n.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((i=this._target)==null?void 0:i.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,t){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,t,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=t.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(t.width,t.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}zg([ke("randomizedLight")],Xl.prototype,"_light",void 0),zg([(0,g.onChange)(Xl.prototype.reset),ke()],Xl.prototype,"maxFrameNumber",void 0),zg([(0,g.onChange)(Xl.prototype.reset),ke()],Xl.prototype,"smoothShadow",void 0),zg([(0,g.onChange)(Xl.prototype._groundMapModeChanged),ke()],Xl.prototype,"groundMapMode",void 0),zg([ke(),(0,g.onChange)(Xl.prototype._alphaVignetteChanged)],Xl.prototype,"alphaVignette",void 0),zg([ke(),(0,g.onChange)(Xl.prototype._alphaVignetteChanged)],Xl.prototype,"alphaVignetteAxis",void 0),zg([ke()],Xl.prototype,"maxBakeCount",void 0);var iC=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class jg extends u.Kj0{_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,(t=(e=this.materialExtension)==null?void 0:e.setDirty)==null||t.call(e)}constructor(e,t,n=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new u.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(P,L,R)=>{if(this.enabled){P.vertexShader=P.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const I="#glMarker beforeModulation";P.fragmentShader=P.fragmentShader.replace(I,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+I)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?fb+`
`+_c+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:P=>this.enabled+" "+P.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(P,{materialObject:L})=>{L.userData.__lastTransparent!==L.transparent&&(L.needsUpdate=!0,L.userData.__lastTransparent=L.transparent)},isCompatible:P=>P.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const i=new u.JOQ,s=new u.Pa4,o=new u.Pa4,l=new u.Pa4,h=new u.yGw,d=new u.Pa4(0,0,-1),f=new u.Ltg,v=new u.Pa4,y=new u.Pa4,w=new u.Ltg,E=new u.yGw,M=new u.cPb;u.M8C.isPowerOfTwo(t.texture.image.width)&&u.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(P,L,R)=>{if(!this.enabled||!P.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const I=R.view?Object.assign({},R.view):null;if(I&&R.clearViewOffset&&R.clearViewOffset(),o.setFromMatrixPosition(this.matrixWorld),l.setFromMatrixPosition(R.matrixWorld),h.extractRotation(this.matrixWorld),s.set(0,0,1),s.applyMatrix4(h),v.subVectors(o,l),v.dot(s)>0)return;v.reflect(s).negate(),v.add(o),h.extractRotation(R.matrixWorld),d.set(0,0,-1),d.applyMatrix4(h),d.add(l),y.subVectors(o,d),y.reflect(s).negate(),y.add(o),M.position.copy(v),M.up.set(0,1,0),M.up.applyMatrix4(h),M.up.reflect(s),M.lookAt(y),M.far=2,M.near=0,M.updateMatrixWorld(),M.projectionMatrix.copy(R.projectionMatrix),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(M.projectionMatrix),E.multiply(M.matrixWorldInverse),E.multiply(this.matrixWorld),i.setFromNormalAndCoplanarPoint(s,o),i.applyMatrix4(M.matrixWorldInverse),f.set(i.normal.x,i.normal.y,i.normal.z,i.constant);const N=M.projectionMatrix;w.x=(Math.sign(f.x)+N.elements[8])/N.elements[0],w.y=(Math.sign(f.y)+N.elements[9])/N.elements[5],w.z=-1,w.w=(1+N.elements[10])/N.elements[14],f.multiplyScalar(2/f.dot(w)),N.elements[2]=f.x,N.elements[6]=f.y,N.elements[10]=f.z+1-n,N.elements[14]=f.w,this.visible=!1;const j=P.getRenderTarget(),H=P.xr.enabled,X=P.shadowMap.autoUpdate;P.xr.enabled=!1,P.shadowMap.autoUpdate=!1,P.setRenderTarget(this._renderTarget),P.state.buffers.depth.setMask(!0),P.autoClear===!1&&P.clear();const ne=L.background;this.transparentReflectionBackground&&(L.background=null);const pe=!this.transparentReflectionBackground;ne!=null&&ne.isTexture&&pe&&(ne.userData||(ne.userData={}),ne.userData.flipX=!ne.userData.flipX),mi(P,{shadowMapRender:!1,backgroundRender:pe,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>P.render(L,M)),ne!=null&&ne.isTexture&&pe&&(ne.userData.flipX=!ne.userData.flipX||void 0),this.transparentReflectionBackground&&(L.background=ne),P.xr.enabled=H,P.shadowMap.autoUpdate=X,P.setRenderTarget(j),I!=null&&I.enabled&&R.setViewOffset&&R.setViewOffset(I.fullWidth,I.fullHeight,I.offsetX,I.offsetY,I.width,I.height);const Ae=R.viewport;Ae!==void 0&&P.state.viewport(Ae),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=E,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new u.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=E}getRenderTarget(){return this._renderTarget}}iC([(0,g.onChange)(jg.prototype._updateExtension)],jg.prototype,"enabled",void 0),iC([(0,g.onChange)(jg.prototype._updateExtension)],jg.prototype,"reflectorModePhysical",void 0),jg.prototype.isReflector=!0;var Vg=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Qo extends Sn{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Yt],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new u._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new u.Kj0(this._geometry)}async onAdded(e){var t,n;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Yt);const i=this._createMesh();i.userData.physicsMass=0,this._iMesh=await((t=this._manager)==null?void 0:t.addImportedSingle(i,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(n=this._iMesh)==null?void 0:n.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,n,i;return this._removeMaterial(),this._geometry.dispose(),(t=this._material)==null||t.dispose(),(i=(n=this._iMesh)==null?void 0:n.dispose)==null||i.call(n),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){(e==null?void 0:e.geometryChanged)!==!1&&(e==null?void 0:e.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const t=(e=this._viewer)==null?void 0:e.scene.activeCamera.controls;t&&(t.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=t.maxPolarAngle),t.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(t.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,t,n;if(!this._mesh||!this._viewer)return;let i=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,i=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const s=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const o=s.getCenter(new u.Pa4).sub(new u.Pa4(0,s.getSize(new u.Pa4).y/2+this.yOffset,0));i=i||o.clone().sub(this._mesh.position).length()>1e-4,i&&this._mesh.position.copy(o)}i=i||Math.abs(this._mesh.scale.x-this.size)>1e-4,i&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new u.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(t=(e=this._mesh).setDirty)==null||t.call(e)),this._transformNeedRefresh=!1}else i&&((n=this._viewer)==null||n.scene.setDirty())}_refreshMaterial(){var e,t,n,i;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const s=this._material??((t=(e=this._manager)==null?void 0:e.materials)==null?void 0:t.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215}));let o=!1;return s!==this._material&&(this._removeMaterial(),s&&(this._material=s),(n=this._material)!=null&&n.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(((i=this._mesh)==null?void 0:i.setMaterial)??(h=>{this._mesh&&(this._mesh.material=h.materialObject)}))(this._material)),o=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),o}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)==null?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}Vg([ke("material")],Qo.prototype,"_material",void 0),Vg([(0,g.onChange)(Qo.prototype.refreshTransform),ke()],Qo.prototype,"visible",void 0),Vg([(0,g.onChange2)(Qo.prototype._onSceneUpdate),ke()],Qo.prototype,"size",void 0),Vg([(0,g.onChange2)(Qo.prototype._onSceneUpdate),ke()],Qo.prototype,"yOffset",void 0),Vg([(0,g.onChange)(Qo.prototype._refreshOptions2),ke()],Qo.prototype,"renderToDepth",void 0),Vg([(0,g.onChange)(Qo.prototype._refreshOptions2),ke()],Qo.prototype,"tonemapGround",void 0),Vg([(0,g.onChange)(Qo.prototype._refreshCameraLimits),ke()],Qo.prototype,"limitCameraAboveGround",void 0);var Rx=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Yl extends Qo{get shadowBaker(){return this._shadowBaker}bakeShadows(){var e;(e=this._shadowBaker)==null||e.reset()}constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=t,t&&this.dependencies.push(Wl),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new jg(this._geometry,this._viewer.renderer.createTarget({type:u.ywz,format:u.wk1,colorSpace:u.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:u.D1R,magFilter:u.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...n)=>{var i,s,o,l,h;let d=(s=(i=this._viewer)==null?void 0:i.getPluginByType("SSReflection"))==null?void 0:s.passes.ssr.passObject;d&&!d.enabled&&(d=void 0),d&&(d.enabled=!1);let f=(h=(l=(o=this._viewer)==null?void 0:o.getPluginByType("SSBevelPlugin"))==null?void 0:l.pass)==null?void 0:h.passObject;f&&!f.enabled&&(f=void 0),f&&(f.enabled=!1),t(...n),d&&(d.enabled=!0),f&&(f.enabled=!0)},e}async onAdded(e){var t,n;await super.onAdded(e),this._showDebug&&((t=e.getPlugin(Wl))==null||t.addTexture("bake_ground_1",()=>{var i,s;return(s=(i=this._shadowBaker)==null?void 0:i.light.shadow.map)==null?void 0:s.texture},[100,100,200,200]),(n=e.getPlugin(Wl))==null||n.addTexture("bake_ground_2",()=>{var i,s;return(s=(i=this._shadowBaker)==null?void 0:i.target)==null?void 0:s.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,n,i;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((t=(e=this._material).unregisterMaterialExtensions)==null||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const s=this._mesh.materialExtension;s||console.warn("unable to find the extension to unregister"),(i=(n=this._material).unregisterMaterialExtensions)==null||i.call(n,[s]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),e.geometryChanged!==!1&&this.autoBakeShadows&&((t=this._shadowBaker)==null||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Xl(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,t,n,i;if(!this._viewer)return!1;const s=super._refreshMaterial();if(!this._material)return s;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const o=this._mesh.materialExtension;o.updaters=[this._viewer.scene,this._viewer.renderer],(t=(e=this._material).registerMaterialExtensions)==null||t.call(e,[o]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((i=(n=this._material).registerMaterialExtensions)==null||i.call(n,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),s}_extraUiConfig(){var e,t,n,i,s,o,l,h,d,f,v,y,w,E,M,P,L,R,I,N,j,H,X,ne,pe,Ae,ve,Ee,xe,we;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var Re,Be;return(Be=(Re=this._uiConfig)==null?void 0:Re.uiRefresh)==null?void 0:Be.call(Re,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var Re;return!((Re=this._shadowBaker)!=null&&Re.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(Re=>({label:Re,value:Re})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)==null?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(t=this._shadowBaker)==null?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(i=(n=this._shadowBaker)==null?void 0:n.light)==null?void 0:i.shadowParams,"enabled"],onChange:[(o=(s=this._shadowBaker)==null?void 0:s.light)==null?void 0:o.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(h=(l=this._shadowBaker)==null?void 0:l.light)==null?void 0:h.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(f=(d=this._shadowBaker)==null?void 0:d.light)==null?void 0:f.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(y=(v=this._shadowBaker)==null?void 0:v.light)==null?void 0:y.randomParams,"distanceScale"],onChange:[(E=(w=this._shadowBaker)==null?void 0:w.light)==null?void 0:E.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(P=(M=this._shadowBaker)==null?void 0:M.light)==null?void 0:P.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(R=(L=this._shadowBaker)==null?void 0:L.light)==null?void 0:R.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(N=(I=this._shadowBaker)==null?void 0:I.light)==null?void 0:N.shadowParams,"radius"],onChange:[(H=(j=this._shadowBaker)==null?void 0:j.light)==null?void 0:H.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(ne=(X=this._shadowBaker)==null?void 0:X.light)==null?void 0:ne.shadowParams,"frustumSize"],onChange:[(Ae=(pe=this._shadowBaker)==null?void 0:pe.light)==null?void 0:Ae.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(Ee=(ve=this._shadowBaker)==null?void 0:ve.light)==null?void 0:Ee.shadowParams,"bias"],onChange:[(we=(xe=this._shadowBaker)==null?void 0:xe.light)==null?void 0:we.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}Yl.PluginType="Ground",Rx([(0,g.onChange)(Yl.prototype.refreshOptions),ke()],Yl.prototype,"bakedShadows",void 0),Rx([(0,g.onChange)(Yl.prototype.refreshOptions),ke()],Yl.prototype,"groundReflection",void 0),Rx([(0,g.onChange)(Yl.prototype.refreshOptions),ke()],Yl.prototype,"physicalReflections",void 0),Rx([ke("shadowBaker")],Yl.prototype,"_shadowBaker",void 0);class RR extends u.yxD{constructor(e){super(e),this.type=u.cLu}parse(e){const j=Math.pow(2.7182818,2.2),H={l:0,c:0,lc:0};function X(Ne,ut,xt,Jt,ln){for(;xt<Ne;)ut=ut<<8|oi(Jt,ln),xt+=8;xt-=Ne,H.l=ut>>xt&(1<<Ne)-1,H.c=ut,H.lc=xt}const ne=new Array(59);function pe(Ne){return 63&Ne}function Ae(Ne){return Ne>>6}const ve={c:0,lc:0};function Ee(Ne,ut,xt,Jt){Ne=Ne<<8|oi(xt,Jt),ut+=8,ve.c=Ne,ve.lc=ut}const xe={c:0,lc:0};function we(Ne,ut,xt,Jt,ln,Et,$t,Nn,ti){if(Ne==ut){Jt<8&&(Ee(xt,Jt,ln,Et),xt=ve.c,Jt=ve.lc);let ii=xt>>(Jt-=8);if(ii=new Uint8Array([ii])[0],Nn.value+ii>ti)return!1;const Zn=$t[Nn.value-1];for(;ii-- >0;)$t[Nn.value++]=Zn}else{if(!(Nn.value<ti))return!1;$t[Nn.value++]=Ne}xe.c=xt,xe.lc=Jt}function Re(Ne){return 65535&Ne}function Be(Ne){const ut=Re(Ne);return ut>32767?ut-65536:ut}const Oe={a:0,b:0};function at(Ne,ut){const xt=Be(Ne),Jt=Be(ut),ln=xt+(1&Jt)+(Jt>>1),Et=ln,$t=ln-Jt;Oe.a=Et,Oe.b=$t}function st(Ne,ut){const xt=Re(Ne),Jt=Re(ut),ln=xt-(Jt>>1)&65535,Et=Jt+ln-32768&65535;Oe.a=Et,Oe.b=ln}function St(Ne,ut,xt,Jt,ln,Et,$t){const Nn=$t<16384,ti=xt>ln?ln:xt;let ii,Zn,yi=1;for(;yi<=ti;)yi<<=1;for(yi>>=1,ii=yi,yi>>=1;yi>=1;){Zn=0;const zn=Zn+Et*(ln-ii),kn=Et*yi,fi=Et*ii,vn=Jt*yi,qn=Jt*ii;let $n,xi,ns,Rr;for(;Zn<=zn;Zn+=fi){let Wn=Zn;const Ei=Zn+Jt*(xt-ii);for(;Wn<=Ei;Wn+=qn){const ji=Wn+vn,La=Wn+kn,rc=La+vn;Nn?(at(Ne[Wn+ut],Ne[La+ut]),$n=Oe.a,ns=Oe.b,at(Ne[ji+ut],Ne[rc+ut]),xi=Oe.a,Rr=Oe.b,at($n,xi),Ne[Wn+ut]=Oe.a,Ne[ji+ut]=Oe.b,at(ns,Rr),Ne[La+ut]=Oe.a,Ne[rc+ut]=Oe.b):(st(Ne[Wn+ut],Ne[La+ut]),$n=Oe.a,ns=Oe.b,st(Ne[ji+ut],Ne[rc+ut]),xi=Oe.a,Rr=Oe.b,st($n,xi),Ne[Wn+ut]=Oe.a,Ne[ji+ut]=Oe.b,st(ns,Rr),Ne[La+ut]=Oe.a,Ne[rc+ut]=Oe.b)}if(xt&yi){const ji=Wn+kn;Nn?at(Ne[Wn+ut],Ne[ji+ut]):st(Ne[Wn+ut],Ne[ji+ut]),$n=Oe.a,Ne[ji+ut]=Oe.b,Ne[Wn+ut]=$n}}if(ln&yi){let Wn=Zn;const Ei=Zn+Jt*(xt-ii);for(;Wn<=Ei;Wn+=qn){const ji=Wn+vn;Nn?at(Ne[Wn+ut],Ne[ji+ut]):st(Ne[Wn+ut],Ne[ji+ut]),$n=Oe.a,Ne[ji+ut]=Oe.b,Ne[Wn+ut]=$n}}ii=yi,yi>>=1}return Zn}function dt(Ne,ut,xt,Jt,ln,Et){const $t=xt.value,Nn=ai(ut,xt),ti=ai(ut,xt);xt.value+=4;const ii=ai(ut,xt);if(xt.value+=4,Nn<0||Nn>=65537||ti<0||ti>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Zn=new Array(65537),yi=new Array(16384);if(function(zn){for(let kn=0;kn<16384;kn++)zn[kn]={},zn[kn].len=0,zn[kn].lit=0,zn[kn].p=null}(yi),function(zn,kn,fi,vn,qn,$n){const xi=kn;let ns=0,Rr=0;for(;vn<=qn;vn++){if(xi.value-kn.value>fi)return!1;X(6,ns,Rr,zn,xi);const Wn=H.l;if(ns=H.c,Rr=H.lc,$n[vn]=Wn,Wn==63){if(xi.value-kn.value>fi)throw new Error("Something wrong with hufUnpackEncTable");X(8,ns,Rr,zn,xi);let Ei=H.l+6;if(ns=H.c,Rr=H.lc,vn+Ei>qn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Ei--;)$n[vn++]=0;vn--}else if(Wn>=59){let Ei=Wn-59+2;if(vn+Ei>qn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Ei--;)$n[vn++]=0;vn--}}(function(Wn){for(let ji=0;ji<=58;++ji)ne[ji]=0;for(let ji=0;ji<65537;++ji)ne[Wn[ji]]+=1;let Ei=0;for(let ji=58;ji>0;--ji){const La=Ei+ne[ji]>>1;ne[ji]=Ei,Ei=La}for(let ji=0;ji<65537;++ji){const La=Wn[ji];La>0&&(Wn[ji]=La|ne[La]++<<6)}})($n)}(Ne,xt,Jt-(xt.value-$t),Nn,ti,Zn),ii>8*(Jt-(xt.value-$t)))throw new Error("Something wrong with hufUncompress");(function(zn,kn,fi,vn){for(;kn<=fi;kn++){const qn=Ae(zn[kn]),$n=pe(zn[kn]);if(qn>>$n)throw new Error("Invalid table entry");if($n>14){const xi=vn[qn>>$n-14];if(xi.len)throw new Error("Invalid table entry");if(xi.lit++,xi.p){const ns=xi.p;xi.p=new Array(xi.lit);for(let Rr=0;Rr<xi.lit-1;++Rr)xi.p[Rr]=ns[Rr]}else xi.p=new Array(1);xi.p[xi.lit-1]=kn}else if($n){let xi=0;for(let ns=1<<14-$n;ns>0;ns--){const Rr=vn[(qn<<14-$n)+xi];if(Rr.len||Rr.p)throw new Error("Invalid table entry");Rr.len=$n,Rr.lit=kn,xi++}}}})(Zn,Nn,ti,yi),function(zn,kn,fi,vn,qn,$n,xi,ns,Rr){let Wn=0,Ei=0;const ji=xi,La=Math.trunc(vn.value+(qn+7)/8);for(;vn.value<La;)for(Ee(Wn,Ei,fi,vn),Wn=ve.c,Ei=ve.lc;Ei>=14;){const Xa=kn[Wn>>Ei-14&16383];if(Xa.len)Ei-=Xa.len,we(Xa.lit,$n,Wn,Ei,fi,vn,ns,Rr,ji),Wn=xe.c,Ei=xe.lc;else{if(!Xa.p)throw new Error("hufDecode issues");let of;for(of=0;of<Xa.lit;of++){const Mv=pe(zn[Xa.p[of]]);for(;Ei<Mv&&vn.value<La;)Ee(Wn,Ei,fi,vn),Wn=ve.c,Ei=ve.lc;if(Ei>=Mv&&Ae(zn[Xa.p[of]])==(Wn>>Ei-Mv&(1<<Mv)-1)){Ei-=Mv,we(Xa.p[of],$n,Wn,Ei,fi,vn,ns,Rr,ji),Wn=xe.c,Ei=xe.lc;break}}if(of==Xa.lit)throw new Error("hufDecode issues")}}const rc=8-qn&7;for(Wn>>=rc,Ei-=rc;Ei>0;){const Xa=kn[Wn<<14-Ei&16383];if(!Xa.len)throw new Error("hufDecode issues");Ei-=Xa.len,we(Xa.lit,$n,Wn,Ei,fi,vn,ns,Rr,ji),Wn=xe.c,Ei=xe.lc}}(Zn,yi,Ne,xt,ii,ti,Et,ln,{value:0})}function ht(Ne){for(let ut=1;ut<Ne.length;ut++){const xt=Ne[ut-1]+Ne[ut]-128;Ne[ut]=xt}}function Nt(Ne,ut){let xt=0,Jt=Math.floor((Ne.length+1)/2),ln=0;const Et=Ne.length-1;for(;!(ln>Et||(ut[ln++]=Ne[xt++],ln>Et));)ut[ln++]=Ne[Jt++]}function Bt(Ne){let ut=Ne.byteLength;const xt=new Array;let Jt=0;const ln=new DataView(Ne);for(;ut>0;){const Et=ln.getInt8(Jt++);if(Et<0){const $t=-Et;ut-=$t+1;for(let Nn=0;Nn<$t;Nn++)xt.push(ln.getUint8(Jt++))}else{const $t=Et;ut-=2;const Nn=ln.getUint8(Jt++);for(let ti=0;ti<$t+1;ti++)xt.push(Nn)}}return xt}function rn(Ne,ut,xt){let Jt,ln=1;for(;ln<64;)Jt=ut[Ne.value],Jt==65280?ln=64:Jt>>8==255?ln+=255&Jt:(xt[ln]=Jt,ln++),Ne.value++}function hn(Ne){const ut=.5*Math.cos(.7853975),xt=.5*Math.cos(3.14159/16),Jt=.5*Math.cos(3.14159/8),ln=.5*Math.cos(3*3.14159/16),Et=.5*Math.cos(.981746875),$t=.5*Math.cos(3*3.14159/8),Nn=.5*Math.cos(1.374445625),ti=new Array(4),ii=new Array(4),Zn=new Array(4),yi=new Array(4);for(let zn=0;zn<8;++zn){const kn=8*zn;ti[0]=Jt*Ne[kn+2],ti[1]=$t*Ne[kn+2],ti[2]=Jt*Ne[kn+6],ti[3]=$t*Ne[kn+6],ii[0]=xt*Ne[kn+1]+ln*Ne[kn+3]+Et*Ne[kn+5]+Nn*Ne[kn+7],ii[1]=ln*Ne[kn+1]-Nn*Ne[kn+3]-xt*Ne[kn+5]-Et*Ne[kn+7],ii[2]=Et*Ne[kn+1]-xt*Ne[kn+3]+Nn*Ne[kn+5]+ln*Ne[kn+7],ii[3]=Nn*Ne[kn+1]-Et*Ne[kn+3]+ln*Ne[kn+5]-xt*Ne[kn+7],Zn[0]=ut*(Ne[kn+0]+Ne[kn+4]),Zn[3]=ut*(Ne[kn+0]-Ne[kn+4]),Zn[1]=ti[0]+ti[3],Zn[2]=ti[1]-ti[2],yi[0]=Zn[0]+Zn[1],yi[1]=Zn[3]+Zn[2],yi[2]=Zn[3]-Zn[2],yi[3]=Zn[0]-Zn[1],Ne[kn+0]=yi[0]+ii[0],Ne[kn+1]=yi[1]+ii[1],Ne[kn+2]=yi[2]+ii[2],Ne[kn+3]=yi[3]+ii[3],Ne[kn+4]=yi[3]-ii[3],Ne[kn+5]=yi[2]-ii[2],Ne[kn+6]=yi[1]-ii[1],Ne[kn+7]=yi[0]-ii[0]}for(let zn=0;zn<8;++zn)ti[0]=Jt*Ne[16+zn],ti[1]=$t*Ne[16+zn],ti[2]=Jt*Ne[48+zn],ti[3]=$t*Ne[48+zn],ii[0]=xt*Ne[8+zn]+ln*Ne[24+zn]+Et*Ne[40+zn]+Nn*Ne[56+zn],ii[1]=ln*Ne[8+zn]-Nn*Ne[24+zn]-xt*Ne[40+zn]-Et*Ne[56+zn],ii[2]=Et*Ne[8+zn]-xt*Ne[24+zn]+Nn*Ne[40+zn]+ln*Ne[56+zn],ii[3]=Nn*Ne[8+zn]-Et*Ne[24+zn]+ln*Ne[40+zn]-xt*Ne[56+zn],Zn[0]=ut*(Ne[zn]+Ne[32+zn]),Zn[3]=ut*(Ne[zn]-Ne[32+zn]),Zn[1]=ti[0]+ti[3],Zn[2]=ti[1]-ti[2],yi[0]=Zn[0]+Zn[1],yi[1]=Zn[3]+Zn[2],yi[2]=Zn[3]-Zn[2],yi[3]=Zn[0]-Zn[1],Ne[0+zn]=yi[0]+ii[0],Ne[8+zn]=yi[1]+ii[1],Ne[16+zn]=yi[2]+ii[2],Ne[24+zn]=yi[3]+ii[3],Ne[32+zn]=yi[3]-ii[3],Ne[40+zn]=yi[2]-ii[2],Ne[48+zn]=yi[1]-ii[1],Ne[56+zn]=yi[0]-ii[0]}function wn(Ne){for(let ut=0;ut<64;++ut){const xt=Ne[0][ut],Jt=Ne[1][ut],ln=Ne[2][ut];Ne[0][ut]=xt+1.5747*ln,Ne[1][ut]=xt-.1873*Jt-.4682*ln,Ne[2][ut]=xt+1.8556*Jt}}function Jn(Ne,ut,xt){for(let ln=0;ln<64;++ln)ut[xt+ln]=u.A5E.toHalfFloat((Jt=Ne[ln])<=1?Math.sign(Jt)*Math.pow(Math.abs(Jt),2.2):Math.sign(Jt)*Math.pow(j,Math.abs(Jt)-1));var Jt}function Fn(Ne){return new DataView(Ne.array.buffer,Ne.offset.value,Ne.size)}function jn(Ne){const ut=Ne.viewer.buffer.slice(Ne.offset.value,Ne.offset.value+Ne.size),xt=new Uint8Array(Bt(ut)),Jt=new Uint8Array(xt.length);return ht(xt),Nt(xt,Jt),new DataView(Jt.buffer)}function wt(Ne){const ut=q(Ne.array.slice(Ne.offset.value,Ne.offset.value+Ne.size)),xt=new Uint8Array(ut.length);return ht(ut),Nt(ut,xt),new DataView(xt.buffer)}function jt(Ne){const ut=Ne.viewer,xt={value:Ne.offset.value},Jt=new Uint16Array(Ne.width*Ne.scanlineBlockSize*(Ne.channels*Ne.type)),ln=new Uint8Array(8192);let Et=0;const $t=new Array(Ne.channels);for(let fi=0;fi<Ne.channels;fi++)$t[fi]={},$t[fi].start=Et,$t[fi].end=$t[fi].start,$t[fi].nx=Ne.width,$t[fi].ny=Ne.lines,$t[fi].size=Ne.type,Et+=$t[fi].nx*$t[fi].ny*$t[fi].size;const Nn=ei(ut,xt),ti=ei(ut,xt);if(ti>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Nn<=ti)for(let fi=0;fi<ti-Nn+1;fi++)ln[fi+Nn]=Dn(ut,xt);const ii=new Uint16Array(65536),Zn=function(fi,vn){let qn=0;for(let xi=0;xi<65536;++xi)(xi==0||fi[xi>>3]&1<<(7&xi))&&(vn[qn++]=xi);const $n=qn-1;for(;qn<65536;)vn[qn++]=0;return $n}(ln,ii),yi=ai(ut,xt);dt(Ne.array,ut,xt,yi,Jt,Et);for(let fi=0;fi<Ne.channels;++fi){const vn=$t[fi];for(let qn=0;qn<$t[fi].size;++qn)St(Jt,vn.start+qn,vn.nx,vn.size,vn.ny,vn.nx*vn.size,Zn)}(function(fi,vn,qn){for(let $n=0;$n<qn;++$n)vn[$n]=fi[vn[$n]]})(ii,Jt,Et);let zn=0;const kn=new Uint8Array(Jt.buffer.byteLength);for(let fi=0;fi<Ne.lines;fi++)for(let vn=0;vn<Ne.channels;vn++){const qn=$t[vn],$n=qn.nx*qn.size,xi=new Uint8Array(Jt.buffer,qn.end*2,$n*2);kn.set(xi,zn),zn+=$n*2,qn.end+=$n}return new DataView(kn.buffer)}function on(Ne){const ut=q(Ne.array.slice(Ne.offset.value,Ne.offset.value+Ne.size)),xt=Ne.lines*Ne.channels*Ne.width,Jt=Ne.type==1?new Uint16Array(xt):new Uint32Array(xt);let ln=0,Et=0;const $t=new Array(4);for(let Nn=0;Nn<Ne.lines;Nn++)for(let ti=0;ti<Ne.channels;ti++){let ii=0;switch(Ne.type){case 1:$t[0]=ln,$t[1]=$t[0]+Ne.width,ln=$t[1]+Ne.width;for(let Zn=0;Zn<Ne.width;++Zn)ii+=ut[$t[0]++]<<8|ut[$t[1]++],Jt[Et]=ii,Et++;break;case 2:$t[0]=ln,$t[1]=$t[0]+Ne.width,$t[2]=$t[1]+Ne.width,ln=$t[2]+Ne.width;for(let Zn=0;Zn<Ne.width;++Zn)ii+=ut[$t[0]++]<<24|ut[$t[1]++]<<16|ut[$t[2]++]<<8,Jt[Et]=ii,Et++}}return new DataView(Jt.buffer)}function li(Ne){const ut=Ne.viewer,xt={value:Ne.offset.value},Jt=new Uint8Array(Ne.width*Ne.lines*(Ne.channels*Ne.type*2)),ln={version:vt(ut,xt),unknownUncompressedSize:vt(ut,xt),unknownCompressedSize:vt(ut,xt),acCompressedSize:vt(ut,xt),dcCompressedSize:vt(ut,xt),rleCompressedSize:vt(ut,xt),rleUncompressedSize:vt(ut,xt),rleRawSize:vt(ut,xt),totalAcUncompressedCount:vt(ut,xt),totalDcUncompressedCount:vt(ut,xt),acCompression:vt(ut,xt)};if(ln.version<2)throw new Error("EXRLoader.parse: "+Ba.compression+" version "+ln.version+" is unsupported");const Et=new Array;let $t=ei(ut,xt)-2;for(;$t>0;){const vn=Mi(ut.buffer,xt),qn=Dn(ut,xt),$n=qn>>2&3,xi=new Int8Array([(qn>>4)-1])[0],ns=Dn(ut,xt);Et.push({name:vn,index:xi,type:ns,compression:$n}),$t-=vn.length+3}const Nn=Ba.channels,ti=new Array(Ne.channels);for(let vn=0;vn<Ne.channels;++vn){const qn=ti[vn]={},$n=Nn[vn];qn.name=$n.name,qn.compression=0,qn.decoded=!1,qn.type=$n.pixelType,qn.pLinear=$n.pLinear,qn.width=Ne.width,qn.height=Ne.lines}const ii={idx:new Array(3)};for(let vn=0;vn<Ne.channels;++vn){const qn=ti[vn];for(let $n=0;$n<Et.length;++$n){const xi=Et[$n];qn.name==xi.name&&(qn.compression=xi.compression,xi.index>=0&&(ii.idx[xi.index]=vn),qn.offset=vn)}}let Zn,yi,zn;if(ln.acCompressedSize>0)switch(ln.acCompression){case 0:Zn=new Uint16Array(ln.totalAcUncompressedCount),dt(Ne.array,ut,xt,ln.acCompressedSize,Zn,ln.totalAcUncompressedCount);break;case 1:const vn=q(Ne.array.slice(xt.value,xt.value+ln.totalAcUncompressedCount));Zn=new Uint16Array(vn.buffer),xt.value+=ln.totalAcUncompressedCount}if(ln.dcCompressedSize>0){const vn={array:Ne.array,offset:xt,size:ln.dcCompressedSize};yi=new Uint16Array(wt(vn).buffer),xt.value+=ln.dcCompressedSize}ln.rleRawSize>0&&(zn=Bt(q(Ne.array.slice(xt.value,xt.value+ln.rleCompressedSize)).buffer),xt.value+=ln.rleCompressedSize);let kn=0;const fi=new Array(ti.length);for(let vn=0;vn<fi.length;++vn)fi[vn]=new Array;for(let vn=0;vn<Ne.lines;++vn)for(let qn=0;qn<ti.length;++qn)fi[qn].push(kn),kn+=ti[qn].width*Ne.type*2;(function(vn,qn,$n,xi,ns,Rr){let Wn=new DataView(Rr.buffer);const Ei=$n[vn.idx[0]].width,ji=$n[vn.idx[0]].height,La=Math.floor(Ei/8),rc=Math.ceil(Ei/8),Xa=Math.ceil(ji/8),of=Ei-8*(rc-1),Mv=ji-8*(Xa-1),SN={value:0},jM=new Array(3),rb=new Array(3),sb=new Array(3),fh=new Array(3),L1=new Array(3);for(let is=0;is<3;++is)L1[is]=qn[vn.idx[is]],jM[is]=is<1?0:jM[is-1]+rc*Xa,rb[is]=new Float32Array(64),sb[is]=new Uint16Array(64),fh[is]=new Uint16Array(64*rc);for(let is=0;is<Xa;++is){let U0=8;is==Xa-1&&(U0=Mv);let N0=8;for(let wr=0;wr<rc;++wr){wr==rc-1&&(N0=of);for(let Wr=0;Wr<3;++Wr)sb[Wr].fill(0),sb[Wr][0]=ns[jM[Wr]++],rn(SN,xi,sb[Wr]),Ln=sb[Wr],(Un=rb[Wr])[0]=Xt(Ln[0]),Un[1]=Xt(Ln[1]),Un[2]=Xt(Ln[5]),Un[3]=Xt(Ln[6]),Un[4]=Xt(Ln[14]),Un[5]=Xt(Ln[15]),Un[6]=Xt(Ln[27]),Un[7]=Xt(Ln[28]),Un[8]=Xt(Ln[2]),Un[9]=Xt(Ln[4]),Un[10]=Xt(Ln[7]),Un[11]=Xt(Ln[13]),Un[12]=Xt(Ln[16]),Un[13]=Xt(Ln[26]),Un[14]=Xt(Ln[29]),Un[15]=Xt(Ln[42]),Un[16]=Xt(Ln[3]),Un[17]=Xt(Ln[8]),Un[18]=Xt(Ln[12]),Un[19]=Xt(Ln[17]),Un[20]=Xt(Ln[25]),Un[21]=Xt(Ln[30]),Un[22]=Xt(Ln[41]),Un[23]=Xt(Ln[43]),Un[24]=Xt(Ln[9]),Un[25]=Xt(Ln[11]),Un[26]=Xt(Ln[18]),Un[27]=Xt(Ln[24]),Un[28]=Xt(Ln[31]),Un[29]=Xt(Ln[40]),Un[30]=Xt(Ln[44]),Un[31]=Xt(Ln[53]),Un[32]=Xt(Ln[10]),Un[33]=Xt(Ln[19]),Un[34]=Xt(Ln[23]),Un[35]=Xt(Ln[32]),Un[36]=Xt(Ln[39]),Un[37]=Xt(Ln[45]),Un[38]=Xt(Ln[52]),Un[39]=Xt(Ln[54]),Un[40]=Xt(Ln[20]),Un[41]=Xt(Ln[22]),Un[42]=Xt(Ln[33]),Un[43]=Xt(Ln[38]),Un[44]=Xt(Ln[46]),Un[45]=Xt(Ln[51]),Un[46]=Xt(Ln[55]),Un[47]=Xt(Ln[60]),Un[48]=Xt(Ln[21]),Un[49]=Xt(Ln[34]),Un[50]=Xt(Ln[37]),Un[51]=Xt(Ln[47]),Un[52]=Xt(Ln[50]),Un[53]=Xt(Ln[56]),Un[54]=Xt(Ln[59]),Un[55]=Xt(Ln[61]),Un[56]=Xt(Ln[35]),Un[57]=Xt(Ln[36]),Un[58]=Xt(Ln[48]),Un[59]=Xt(Ln[49]),Un[60]=Xt(Ln[57]),Un[61]=Xt(Ln[58]),Un[62]=Xt(Ln[62]),Un[63]=Xt(Ln[63]),hn(rb[Wr]);wn(rb);for(let Wr=0;Wr<3;++Wr)Jn(rb[Wr],fh[Wr],64*wr)}let kc=0;for(let wr=0;wr<3;++wr){const Wr=$n[vn.idx[wr]].type;for(let lf=8*is;lf<8*is+U0;++lf){kc=L1[wr][lf];for(let ab=0;ab<La;++ab){const kd=64*ab+8*(7&lf);Wn.setUint16(kc+0*2*Wr,fh[wr][kd+0],!0),Wn.setUint16(kc+1*2*Wr,fh[wr][kd+1],!0),Wn.setUint16(kc+2*2*Wr,fh[wr][kd+2],!0),Wn.setUint16(kc+3*2*Wr,fh[wr][kd+3],!0),Wn.setUint16(kc+4*2*Wr,fh[wr][kd+4],!0),Wn.setUint16(kc+5*2*Wr,fh[wr][kd+5],!0),Wn.setUint16(kc+6*2*Wr,fh[wr][kd+6],!0),Wn.setUint16(kc+7*2*Wr,fh[wr][kd+7],!0),kc+=8*2*Wr}}if(La!=rc)for(let lf=8*is;lf<8*is+U0;++lf){const ab=L1[wr][lf]+8*La*2*Wr,kd=64*La+8*(7&lf);for(let O1=0;O1<N0;++O1)Wn.setUint16(ab+O1*2*Wr,fh[wr][kd+O1],!0)}}}var Ln,Un;const mR=new Uint16Array(Ei);Wn=new DataView(Rr.buffer);for(let is=0;is<3;++is){$n[vn.idx[is]].decoded=!0;const U0=$n[vn.idx[is]].type;if($n[is].type==2)for(let N0=0;N0<ji;++N0){const kc=L1[is][N0];for(let wr=0;wr<Ei;++wr)mR[wr]=Wn.getUint16(kc+wr*2*U0,!0);for(let wr=0;wr<Ei;++wr)Wn.setFloat32(kc+wr*2*U0,Xt(mR[wr]),!0)}}})(ii,fi,ti,Zn,yi,Jt);for(let vn=0;vn<ti.length;++vn){const qn=ti[vn];if(!qn.decoded){if(qn.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let $n=0,xi=0;for(let ns=0;ns<Ne.lines;++ns){let Rr=fi[vn][$n];for(let Wn=0;Wn<qn.width;++Wn){for(let Ei=0;Ei<2*qn.type;++Ei)Jt[Rr++]=zn[xi+Ei*qn.width*qn.height];xi++}$n++}}}}return new DataView(Jt.buffer)}function Mi(Ne,ut){const xt=new Uint8Array(Ne);let Jt=0;for(;xt[ut.value+Jt]!=0;)Jt+=1;const ln=new TextDecoder().decode(xt.slice(ut.value,ut.value+Jt));return ut.value=ut.value+Jt+1,ln}function pi(Ne,ut){const xt=Ne.getInt32(ut.value,!0);return ut.value=ut.value+4,xt}function ai(Ne,ut){const xt=Ne.getUint32(ut.value,!0);return ut.value=ut.value+4,xt}function oi(Ne,ut){const xt=Ne[ut.value];return ut.value=ut.value+1,xt}function Dn(Ne,ut){const xt=Ne.getUint8(ut.value);return ut.value=ut.value+1,xt}const vt=function(Ne,ut){let xt;return xt="getBigInt64"in DataView.prototype?Number(Ne.getBigInt64(ut.value,!0)):Ne.getUint32(ut.value+4,!0)+Number(Ne.getUint32(ut.value,!0)<<32),ut.value+=8,xt};function an(Ne,ut){const xt=Ne.getFloat32(ut.value,!0);return ut.value+=4,xt}function On(Ne,ut){return u.A5E.toHalfFloat(an(Ne,ut))}function Xt(Ne){const ut=(31744&Ne)>>10,xt=1023&Ne;return(Ne>>15?-1:1)*(ut?ut===31?xt?NaN:1/0:Math.pow(2,ut-15)*(1+xt/1024):xt/1024*6103515625e-14)}function ei(Ne,ut){const xt=Ne.getUint16(ut.value,!0);return ut.value+=2,xt}function Nr(Ne,ut){return Xt(ei(Ne,ut))}function ts(Ne,ut,xt,Jt,ln){return Jt==="string"||Jt==="stringvector"||Jt==="iccProfile"?function(Et,$t,Nn){const ti=new TextDecoder().decode(new Uint8Array(Et).slice($t.value,$t.value+Nn));return $t.value=$t.value+Nn,ti}(ut,xt,ln):Jt==="chlist"?function(Et,$t,Nn,ti){const ii=Nn.value,Zn=[];for(;Nn.value<ii+ti-1;){const yi=Mi($t,Nn),zn=pi(Et,Nn),kn=Dn(Et,Nn);Nn.value+=3;const fi=pi(Et,Nn),vn=pi(Et,Nn);Zn.push({name:yi,pixelType:zn,pLinear:kn,xSampling:fi,ySampling:vn})}return Nn.value+=1,Zn}(Ne,ut,xt,ln):Jt==="chromaticities"?function(Et,$t){return{redX:an(Et,$t),redY:an(Et,$t),greenX:an(Et,$t),greenY:an(Et,$t),blueX:an(Et,$t),blueY:an(Et,$t),whiteX:an(Et,$t),whiteY:an(Et,$t)}}(Ne,xt):Jt==="compression"?function(Et,$t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Dn(Et,$t)]}(Ne,xt):Jt==="box2i"?function(Et,$t){return{xMin:ai(Et,$t),yMin:ai(Et,$t),xMax:ai(Et,$t),yMax:ai(Et,$t)}}(Ne,xt):Jt==="lineOrder"?function(Et,$t){return["INCREASING_Y"][Dn(Et,$t)]}(Ne,xt):Jt==="float"?an(Ne,xt):Jt==="v2f"?function(Et,$t){return[an(Et,$t),an(Et,$t)]}(Ne,xt):Jt==="v3f"?function(Et,$t){return[an(Et,$t),an(Et,$t),an(Et,$t)]}(Ne,xt):Jt==="int"?pi(Ne,xt):Jt==="rational"?function(Et,$t){return[pi(Et,$t),ai(Et,$t)]}(Ne,xt):Jt==="timecode"?function(Et,$t){return[ai(Et,$t),ai(Et,$t)]}(Ne,xt):Jt==="preview"?(xt.value+=ln,"skipped"):void(xt.value+=ln)}const Bs=new DataView(e),qa=new Uint8Array(e),yo={value:0},Ba=function(Ne,ut,xt){const Jt={};if(Ne.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Jt.version=Ne.getUint8(4);const ln=Ne.getUint8(5);Jt.spec={singleTile:!!(2&ln),longName:!!(4&ln),deepFormat:!!(8&ln),multiPart:!!(16&ln)},xt.value=8;let Et=!0;for(;Et;){const $t=Mi(ut,xt);if($t==0)Et=!1;else{const Nn=Mi(ut,xt),ti=ts(Ne,ut,xt,Nn,ai(Ne,xt));ti===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Nn}'.`):Jt[$t]=ti}}if(-5&ln)throw console.error("EXRHeader:",Jt),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Jt}(Bs,e,yo),ui=function(Ne,ut,xt,Jt,ln){const Et={size:0,viewer:ut,array:xt,offset:Jt,width:Ne.dataWindow.xMax-Ne.dataWindow.xMin+1,height:Ne.dataWindow.yMax-Ne.dataWindow.yMin+1,channels:Ne.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:Ne.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:u.GUF};switch(Ne.compression){case"NO_COMPRESSION":Et.lines=1,Et.uncompress=Fn;break;case"RLE_COMPRESSION":Et.lines=1,Et.uncompress=jn;break;case"ZIPS_COMPRESSION":Et.lines=1,Et.uncompress=wt;break;case"ZIP_COMPRESSION":Et.lines=16,Et.uncompress=wt;break;case"PIZ_COMPRESSION":Et.lines=32,Et.uncompress=jt;break;case"PXR24_COMPRESSION":Et.lines=16,Et.uncompress=on;break;case"DWAA_COMPRESSION":Et.lines=32,Et.uncompress=li;break;case"DWAB_COMPRESSION":Et.lines=256,Et.uncompress=li;break;default:throw new Error("EXRLoader.parse: "+Ne.compression+" is unsupported")}if(Et.scanlineBlockSize=Et.lines,Et.type==1)switch(ln){case u.VzW:Et.getter=Nr,Et.inputSize=2;break;case u.cLu:Et.getter=ei,Et.inputSize=2}else{if(Et.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Et.type+" for "+Ne.compression+".");switch(ln){case u.VzW:Et.getter=an,Et.inputSize=4;break;case u.cLu:Et.getter=On,Et.inputSize=4}}Et.blockCount=(Ne.dataWindow.yMax+1)/Et.scanlineBlockSize;for(let Nn=0;Nn<Et.blockCount;Nn++)vt(ut,Jt);Et.outputChannels=Et.channels==3?4:Et.channels;const $t=Et.width*Et.height*Et.outputChannels;switch(ln){case u.VzW:Et.byteArray=new Float32Array($t),Et.channels<Et.outputChannels&&Et.byteArray.fill(1,0,$t);break;case u.cLu:Et.byteArray=new Uint16Array($t),Et.channels<Et.outputChannels&&Et.byteArray.fill(15360,0,$t);break;default:console.error("THREE.EXRLoader: unsupported type: ",ln)}return Et.bytesPerLine=Et.width*Et.inputSize*Et.channels,Et.outputChannels==4?(Et.format=u.wk1,Et.colorSpace=u.GUF):(Et.format=u.hEm,Et.colorSpace=u.aCh),Et}(Ba,Bs,qa,yo,this.type),bl={value:0},af={R:0,G:1,B:2,A:3,Y:0};for(let Ne=0;Ne<ui.height/ui.scanlineBlockSize;Ne++){const ut=ai(Bs,yo);ui.size=ai(Bs,yo),ui.lines=ut+ui.scanlineBlockSize>ui.height?ui.height-ut:ui.scanlineBlockSize;const xt=ui.size<ui.lines*ui.bytesPerLine?ui.uncompress(ui):Fn(ui);yo.value+=ui.size;for(let Jt=0;Jt<ui.scanlineBlockSize;Jt++){const ln=Jt+Ne*ui.scanlineBlockSize;if(ln>=ui.height)break;for(let Et=0;Et<ui.channels;Et++){const $t=af[Ba.channels[Et].name];for(let Nn=0;Nn<ui.width;Nn++){bl.value=(Jt*(ui.channels*ui.width)+Et*ui.width+Nn)*ui.inputSize;const ti=(ui.height-1-ln)*(ui.width*ui.outputChannels)+Nn*ui.outputChannels+$t;ui.byteArray[ti]=ui.getter(xt,bl)}}}}return{header:Ba,width:ui.width,height:ui.height,data:ui.byteArray,format:ui.format,colorSpace:ui.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,function(s,o){s.colorSpace=o.colorSpace,s.minFilter=u.wem,s.magFilter=u.wem,s.generateMipmaps=!1,s.flipY=!1,t&&t(s,o)},n,i)}}class zE extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Yt]}async onAdded(e){var t,n;this._importer||(this._importer=new yr(class extends RR{constructor(i){super(i),this.setDataType(Lu(e.renderer.rendererObject))}},["exr"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}zE.PluginType="EXRLoadPlugin";const jE=new WeakMap;class DR extends u.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const s=new u.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),this.url=e,s.load(e,o=>{if(jE.has(o))return jE.get(o).promise.then(t).catch(i);this.decodeObjects(o,e).then(l=>{l.userData.warnings=this.warnings,this.warnings=[],t(l)}).catch(l=>i(l))},n,i)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let n,i;const s=e.byteLength,o=this._getWorker(s).then(l=>(n=l,i=this.workerNextTaskID++,new Promise((h,d)=>{n._callbacks[i]={resolve:h,reject:d},n.postMessage({type:"decode",id:i,buffer:e},[e])}))).then(l=>this._createGeometry(l.data)).catch(l=>{throw l});return o.catch(()=>!0).then(()=>{n&&i&&this._releaseTask(n,i)}),jE.set(e,{url:t,promise:o}),o}parse(e,t,n){this.decodeObjects(e,"").then(i=>{i.userData.warnings=this.warnings,t(i)}).catch(i=>n(i))}_compareMaterials(e){if(this.materials.includes(e))return e;const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;const n=JSON.stringify(t);for(let i=0;i<this.materials.length;i++){const s=this.materials[i],o={};if(o.name=s.name,o.color={},o.color.r=s.color.r,o.color.g=s.color.g,o.color.b=s.color.b,o.type=s.type,JSON.stringify(o)===n)return s}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new u.Wid({color:new u.Ilk(1,1,1),metalness:.8,name:"default",side:u.ehD});const t=e.diffuseColor,n=new u.Ilk(t.r/255,t.g/255,t.b/255);t.r===0&&t.g===0&&t.b===0&&(n.r=1,n.g=1,n.b=1);const i=new u.Wid({color:n,name:e.name,side:u.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),s=new u.dpR;for(let o=0;o<e.textures.length;o++){const l=e.textures[o];if(l.image!==null){const h=s.load(l.image);switch(l.type){case"Diffuse":i.map=h;break;case"Bump":i.bumpMap=h;break;case"Transparency":i.alphaMap=h,i.transparent=!0;break;case"Emap":i.envMap=h}h.wrapS=l.wrapU===0?u.rpg:u.uWy,h.wrapT=l.wrapV===0?u.rpg:u.uWy,h.repeat.set(l.repeat[0],l.repeat[1])}}return i}_createGeometry(e){const t=new u.Tme,n=[],i=[],s=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.strings=e.strings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let o=e.objects;const l=e.materials;for(let h=0;h<o.length;h++){const d=o[h],f=d.attributes;switch(d.objectType){case"InstanceDefinition":i.push(d);break;case"InstanceReference":s.push(d);break;default:let v;if(f.materialIndex>=0){const w=l[f.materialIndex];let E=this._createMaterial(w);E=this._compareMaterials(E),v=this._createObject(d,E)}else{const w=this._createMaterial();v=this._createObject(d,w)}if(v===void 0)continue;const y=e.layers[f.layerIndex];v.visible=!y||y.visible,f.isInstanceDefinitionObject?n.push(v):t.add(v)}}for(let h=0;h<i.length;h++){const d=i[h];o=[];for(let f=0;f<d.attributes.objectIds.length;f++){const v=d.attributes.objectIds[f];for(let y=0;y<n.length;y++)v===n[y].userData.attributes.id&&o.push(n[y])}for(let f=0;f<s.length;f++){const v=s[f];if(v.geometry.parentIdefId===d.attributes.id){const y=v.geometry.xform.array,w=new u.yGw;if(w.set(...y),o.length===1){const E=o[0].clone(!0);if(E.name=v.attributes.name||E.name,E.applyMatrix4(w),v.attributes.materialIndex>=0&&v.attributes.materialIndex!==o[0].userData.attributes.materialIndex){const M=l[v.attributes.materialIndex],P=this._createMaterial(M);E.material=this._compareMaterials(P)}if(E.userData.defAttributes=E.userData.attributes,E.userData.defObjectType=E.userData.objectType,E.userData.attributes={...E.userData.attributes,...v.attributes},E.userData.objectType=v.objectType,v.attributes.layerIndex!==void 0){const M=e.layers[v.attributes.layerIndex];E.visible=M?M.visible:E.visible}t.add(E)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const E=new u.Tme;E.applyMatrix4(w);for(let M=0;M<o.length;M++)E.add(o[M].clone(!0));t.add(E)}}}}return t.userData.materials=this.materials,t}_createObject(e,t){const n=new u.s4_,i=e.attributes;let s,o,l,h;switch(e.objectType){case"Point":case"PointSet":s=n.parse(e.geometry),s.attributes.hasOwnProperty("color")?o=new u.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(l=i.drawColor,h=new u.Ilk(l.r/255,l.g/255,l.b/255),o=new u.UY4({color:h,sizeAttenuation:!1,size:2})),o=this._compareMaterials(o);const d=new u.woe(s,o);return d.userData.attributes=i,d.userData.objectType=e.objectType,i.name&&(d.name=i.name),d;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;s=n.parse(e.geometry),s.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),t===null&&(t=this._createMaterial(),t=this._compareMaterials(t));const f=new u.Kj0(s,t);return f.castShadow=i.castsShadows,f.receiveShadow=i.receivesShadows,f.userData.attributes=i,f.userData.objectType=e.objectType,i.name&&(f.name=i.name,s.name=i.name),f;case"Curve":s=n.parse(e.geometry),l=i.drawColor,h=new u.Ilk(l.r/255,l.g/255,l.b/255),o=new u.nls({color:h}),o=this._compareMaterials(o);const v=new u.x12(s,o);return v.userData.attributes=i,v.userData.objectType=e.objectType,i.name&&(v.name=i.name),v;case"TextDot":s=e.geometry;const y=document.createElement("canvas").getContext("2d"),w=`${s.fontHeight}px ${s.fontFace}`;y.font=w;const E=y.measureText(s.text).width+10,M=s.fontHeight+10,P=window.devicePixelRatio;y.canvas.width=E*P,y.canvas.height=M*P,y.canvas.style.width=E+"px",y.canvas.style.height=M+"px",y.setTransform(P,0,0,P,0,0),y.font=w,y.textBaseline="middle",y.textAlign="center",h=i.drawColor,y.fillStyle=`rgba(${h.r},${h.g},${h.b},${h.a})`,y.fillRect(0,0,E,M),y.fillStyle="white",y.fillText(s.text,E/2,M/2);const L=new u.ROQ(y.canvas);L.minFilter=u.wem,L.wrapS=u.uWy,L.wrapT=u.uWy,o=new u.xeV({map:L,depthTest:!1});const R=new u.jyi(o);return R.position.set(s.point[0],s.point[1],s.point[2]),R.scale.set(E/10,M/10,1),R.userData.attributes=i,R.userData.objectType=e.objectType,i.name&&(R.name=i.name),R;case"Light":let I;switch(s=e.geometry,s.lightStyle.name){case"LightStyle_WorldPoint":I=new u.cek,I.castShadow=i.castsShadows,I.position.set(s.location[0],s.location[1],s.location[2]),I.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":I=new u.PMe,I.castShadow=i.castsShadows,I.position.set(s.location[0],s.location[1],s.location[2]),I.target.position.set(s.direction[0],s.direction[1],s.direction[2]),I.angle=s.spotAngleRadians,I.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":I=new u.T_f;const N=Math.abs(s.width[2]),j=Math.abs(s.length[0]);I.position.set(s.location[0]-j/2,s.location[1],s.location[2]-N/2),I.height=j,I.width=N,I.lookAt(s.direction[0],s.direction[1],s.direction[2]);break;case"LightStyle_WorldDirectional":I=new u.Ox3,I.castShadow=i.castsShadows,I.position.set(s.location[0],s.location[1],s.location[2]),I.target.position.set(s.direction[0],s.direction[1],s.direction[2]),I.shadow.normalBias=.1}return I&&(I.intensity=s.intensity,l=s.diffuse,h=new u.Ilk(l.r/255,l.g/255,l.b/255),I.color=h,I.userData.attributes=i,I.userData.objectType=e.objectType),I}}_initLibrary(){if(!this.libraryPending){const e=new u.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise((s,o)=>{e.load("rhino3dm.js",s,void 0,o)}),n=new u.hH6(this.manager);n.setPath(this.libraryPath),n.setResponseType("arraybuffer");const i=new Promise((s,o)=>{n.load("rhino3dm.wasm",s,void 0,o)});this.libraryPending=Promise.all([t,i]).then(([s,o])=>{this.libraryConfig.wasmBinary=o;const l=BR,h=["/* rhino3dm.js */",s,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([h]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",libraryConfig:this.libraryConfig}),n.onmessage=i=>{const s=i.data;switch(s.type){case"warning":this.warnings.push(s.data),console.warn(s.data);break;case"decode":n._callbacks[s.id].resolve(s);break;case"error":n._callbacks[s.id].reject(s);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,i){return n._taskLoad>i._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const BR=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				// console.log(message)
				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count(); i ++ ) {

			const _material = doc.materials().get( i );
			const _pbrMaterial = _material.physicallyBased();

			let material = extractProperties( _material );

			const textures = [];

			for ( let j = 0; j < textureTypes.length; j ++ ) {

				const _texture = _material.getTexture( textureTypes[ j ] );
				if ( _texture ) {

					let textureType = textureTypes[ j ].constructor.name;
					textureType = textureType.substring( 12, textureType.length );
					const texture = { type: textureType };

					const image = doc.getEmbeddedFileAsBase64( _texture.fileName );

					texture.wrapU = _texture.wrapU;
					texture.wrapV = _texture.wrapV;
					texture.wrapW = _texture.wrapW;
					const uvw = _texture.uvwTransform.toFloatArray( true );
					texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

					if ( image ) {

						texture.image = 'data:image/png;base64,' + image;

					} else {

						self.postMessage( { type: 'warning', id: taskID, data: {
							message: \`THREE.3DMLoader: Image for \${textureType} texture not embedded in file.\`,
							type: 'missing resource'
						}

						} );

						texture.image = null;

					}

					textures.push( texture );

					_texture.delete();

				}

			}

			material.textures = textures;

			if ( _pbrMaterial.supported ) {

				for ( let j = 0; j < pbrTextureTypes.length; j ++ ) {

					const _texture = _material.getTexture( pbrTextureTypes[ j ] );
					if ( _texture ) {

						const image = doc.getEmbeddedFileAsBase64( _texture.fileName );
						let textureType = pbrTextureTypes[ j ].constructor.name;
						textureType = textureType.substring( 12, textureType.length );
						const texture = { type: textureType, image: 'data:image/png;base64,' + image };
						textures.push( texture );

						_texture.delete();

					}

				}

				const pbMaterialProperties = extractProperties( _material.physicallyBased() );

				material = Object.assign( pbMaterialProperties, material );

			}

			materials.push( material );

			_material.delete();
			_pbrMaterial.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count(); i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count(); i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count(); i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count(); i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		//console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count();

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings };

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;var $_,nA=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class ca extends DR{constructor(e){super(e),this.materials=[],this.setLibraryPath(ca.LIBRARY_PATH)}_createMaterial(e){return ca.ImportMaterials?super._createMaterial(e):this.materials[0]||new u.Wid({color:new u.Ilk(1,1,1),metalness:.8,name:"default",side:u.ehD})}async loadAsync(e,t){const n=await super.loadAsync(e,t);n.rotateX(-Math.PI/2),n.userData.materials&&delete n.userData.materials;const i=n.userData.layers;return n.traverse(s=>{var o,l,h,d;const f=(o=s.userData.attributes)==null?void 0:o.castsShadows,v=(l=s.userData.attributes)==null?void 0:l.receivesShadows;s.castShadow=f,s.receiveShadow=v;const y=((h=s.userData.attributes)==null?void 0:h.layerIndex)??((d=s.userData.defAttributes)==null?void 0:d.layerIndex),w=i[y];w&&(s.userData.rhinoLayer=w),s.userData.rhino3dmRoot=n.uuid,this._hideLineMesh(s),this._useInstancedMesh(s),this._useMaterialSource(s,w)}),this.materials=[],n}_useMaterialSource(e,t){var n,i,s,o,l;if(!ca.ImportMaterials)return;const h=e;if(((n=h.material)==null?void 0:n.name)==="default"||ca.ForceLayerMaterials){const d=((i=h.userData.attributes)==null?void 0:i.materialSource)||((s=h.userData.defAttributes)==null?void 0:s.materialSource),f=((o=h.userData.attributes)==null?void 0:o.colorSource)||((l=h.userData.defAttributes)==null?void 0:l.colorSource);if(!ca.ForceLayerMaterials&&!d&&!f)return;ca.ForceLayerMaterials||(d==null?void 0:d.value)===0||(d==null?void 0:d.value)===1&&(f==null?void 0:f.value)===0?t&&(h.material=this._compareMaterials(this._createMaterial({diffuseColor:t.color,name:t.name,transparency:0,textures:[]}))):(d==null?void 0:d.value)===3||(d==null?void 0:d.value)===1&&(f==null?void 0:f.value)===3?h.traverseAncestors(v=>{v!=null&&v.material&&(h.material=v.material)}):d&&d.value!==1&&console.warn("Unknown material source",d,h,h.userData.attributes)}}_useInstancedMesh(e){if(!ca.ReplaceWithInstancedMesh||e.children.length<=0)return;const t=e.children,n=t.map(s=>s.geometry);n.filter((s,o)=>n.indexOf(s)===o).forEach(s=>{var o;const l=t.filter(d=>d.geometry===s),h=l.length>0?l.filter(d=>d.material===l[0].material):[];if(h.length>1){const d=new u.SPe(s,h[0].material,h.length);d.userData={...h[0].userData},d.userData.instanceUserData=[],d.userData.attributes=d.userData.defAttributes||d.userData.attributes,d.userData.defAttributes&&delete d.userData.defAttributes,d.name=((o=d.userData.attributes)==null?void 0:o.name)||h[0].name,h.forEach((f,v)=>{d.setMatrixAt(v,f.matrix),e.remove(f),d.userData.instanceUserData.push(f.userData)}),e.add(d)}})}_hideLineMesh(e){if(!ca.HideLineMesh||e.children.length<=0)return;const t=[];e.traverse(n=>{n&&(n.isLine||n.isLineSegments||n.isPoints)&&t.push(n)}),t.forEach(n=>{n.userData.visible_3dm=n.visible,n.visible=!1})}}ca.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",ca.ImportMaterials=!0,ca.ForceLayerMaterials=!1,ca.ReplaceWithInstancedMesh=!1,ca.HideLineMesh=!1;let rh=$_=class extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Yt],this._importer=new yr(ca,["3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1}_refresh(){ca.ImportMaterials=this.importMaterials,ca.ForceLayerMaterials=this.forceLayerMaterials,ca.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,ca.HideLineMesh=this.hideLineMesh}async onAdded(a){var e,t;(t=(e=a.getManager())==null?void 0:e.importer)==null||t.Importers.push(this._importer),this._refresh()}async onDispose(a){}async onRemove(a){var e,t;(t=(e=a.getManager())==null?void 0:e.importer)!=null&&t.Importers&&a.getManager().importer.Importers.splice(a.getManager().importer.Importers.indexOf(this._importer),1)}};rh.PluginType="Rhino3dmLoadPlugin",nA([(0,g.onChange)($_.prototype._refresh),sn()],rh.prototype,"importMaterials",void 0),nA([(0,g.onChange)($_.prototype._refresh),sn()],rh.prototype,"forceLayerMaterials",void 0),nA([(0,g.onChange)($_.prototype._refresh),sn()],rh.prototype,"replaceWithInstancedMesh",void 0),nA([(0,g.onChange)($_.prototype._refresh),sn()],rh.prototype,"hideLineMesh",void 0),rh=$_=nA([Vn("Rhino 3dm loader")],rh);class LR extends u.aNw{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new u.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(s.parse(l))}catch(h){i?i(h):console.error(h),s.manager.itemError(e)}},n,i)}parse(e){function t(s,o,l){for(let h=0,d=s.length;h<d;h++)if(s[h]!==o.getUint8(l+h))return!1;return!0}const n=function(s){if(typeof s=="string"){const o=new Uint8Array(s.length);for(let l=0;l<s.length;l++)o[l]=255&s.charCodeAt(l);return o.buffer||o}return s}(e);return function(s){const o=new DataView(s);if(84+50*o.getUint32(80,!0)===o.byteLength)return!0;const l=[115,111,108,105,100];for(let h=0;h<5;h++)if(t(l,o,h))return!1;return!0}(n)?function(s){const o=new DataView(s),l=o.getUint32(80,!0);let h,d,f,v,y,w,E,M,P=!1;for(let N=0;N<70;N++)o.getUint32(N,!1)==1129270351&&o.getUint8(N+4)==82&&o.getUint8(N+5)==61&&(P=!0,v=new Float32Array(3*l*3),y=o.getUint8(N+6)/255,w=o.getUint8(N+7)/255,E=o.getUint8(N+8)/255,M=o.getUint8(N+9)/255);const L=new u.u9r,R=new Float32Array(3*l*3),I=new Float32Array(3*l*3);for(let N=0;N<l;N++){const j=84+50*N,H=o.getFloat32(j,!0),X=o.getFloat32(j+4,!0),ne=o.getFloat32(j+8,!0);if(P){const pe=o.getUint16(j+48,!0);32768&pe?(h=y,d=w,f=E):(h=(31&pe)/31,d=(pe>>5&31)/31,f=(pe>>10&31)/31)}for(let pe=1;pe<=3;pe++){const Ae=j+12*pe,ve=3*N*3+3*(pe-1);R[ve]=o.getFloat32(Ae,!0),R[ve+1]=o.getFloat32(Ae+4,!0),R[ve+2]=o.getFloat32(Ae+8,!0),I[ve]=H,I[ve+1]=X,I[ve+2]=ne,P&&(v[ve]=h,v[ve+1]=d,v[ve+2]=f)}}return L.setAttribute("position",new u.TlE(R,3)),L.setAttribute("normal",new u.TlE(I,3)),P&&(L.setAttribute("color",new u.TlE(v,3)),L.hasColors=!0,L.alpha=M),L}(n):function(s){const o=new u.u9r,l=/solid([\s\S]*?)endsolid/g,h=/facet([\s\S]*?)endfacet/g;let d=0;const f=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,v=new RegExp("vertex"+f+f+f,"g"),y=new RegExp("normal"+f+f+f,"g"),w=[],E=[],M=new u.Pa4;let P,L=0,R=0,I=0;for(;(P=l.exec(s))!==null;){R=I;const N=P[0];for(;(P=h.exec(N))!==null;){let X=0,ne=0;const pe=P[0];for(;(P=y.exec(pe))!==null;)M.x=parseFloat(P[1]),M.y=parseFloat(P[2]),M.z=parseFloat(P[3]),ne++;for(;(P=v.exec(pe))!==null;)w.push(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])),E.push(M.x,M.y,M.z),X++,I++;ne!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+d),X!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+d),d++}const j=R,H=I-R;o.addGroup(j,H,L),L++}return o.setAttribute("position",new u.a$l(w,3)),o.setAttribute("normal",new u.a$l(E,3)),o}(typeof(i=e)!="string"?new TextDecoder().decode(i):i);var i}}class VE extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Yt]}async onAdded(e){var t,n;this._importer||(this._importer=new yr(LR,["stl"],!0)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}VE.PluginType="STLLoadPlugin";class GE extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Yt]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}GE.PluginType="GLTFMeshOptPlugin";class rC extends ol{constructor(e){super(e)}async initialize({caching:e=!0,ground:t=!0,bloom:n=!0,depthTonemap:i=!0,enableDrop:s=!1,importPopup:o=!1,debug:l=!1}={}){return l&&await this.addPlugin(Wl),this.getPlugin(Yt)||this.addPluginSync(Yt,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await this.addPlugin(ad,!0),await Dx(this,{ground:t,bloom:n,depthTonemap:i,enableDrop:s,importPopup:o}),await this.addPlugin(Op),await this.addPlugin(kp),await this.addPlugin(fd),this}}async function Dx(a,{ground:e=!0,bloom:t=!0,depthTonemap:n=!0,enableDrop:i=!1,importPopup:s=!1}={}){await a.getOrAddPlugin(Yt),s&&await a.getOrAddPlugin(ho),await a.getOrAddPlugin(Ri),await a.getOrAddPlugin(uo),i&&await a.getOrAddPlugin(Jc),await a.addPlugin(new na(32)),await a.getOrAddPlugin(vc),await a.getOrAddPlugin(Bf),await a.addPlugin(new Df(n||!a.useRgbm)),await a.getOrAddPlugin(ls),await a.getOrAddPlugin(qu),await a.getOrAddPlugin(sg),await a.getOrAddPlugin(D_),await a.getOrAddPlugin(jf),await a.getOrAddPlugin(tg),await a.getOrAddPlugin(Zi),await a.getOrAddPlugin(Nu),await a.getOrAddPlugin(hr),await a.getOrAddPlugin(so),await a.getOrAddPlugin(Sc),await a.getOrAddPlugin(cl),await a.getOrAddPlugin(Fo),await a.getOrAddPlugin(jo),await a.getOrAddPlugin(Is),await a.getOrAddPlugin(Ql),await a.getOrAddPlugin(su),await a.getOrAddPlugin(pl,!1),await a.getOrAddPlugin(im),await a.getOrAddPlugin(ar),await a.getOrAddPlugin(ju,!1),await a.getOrAddPlugin(Ga,!1),await a.getOrAddPlugin(zh,!1),await a.getOrAddPlugin(Ea,!1),await a.getOrAddPlugin(js,!1),await a.getOrAddPlugin(hl,!1),await a.getOrAddPlugin(Ec,!1),await a.getOrAddPlugin(rd),await a.getOrAddPlugin(Gr),await a.getOrAddPlugin(ni),await a.getOrAddPlugin(rh),await a.getOrAddPlugin(VE),await a.getOrAddPlugin(zE),await a.getOrAddPlugin(GE),await a.getOrAddPlugin(lp),await a.getOrAddPlugin(os),await a.getOrAddPlugin(co),t&&await a.getOrAddPlugin(ll),e&&await a.getOrAddPlugin(Yl),a.renderer.refreshPipeline()}let OR=0;class sC extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=OR++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),t=document.createElement("style");t.textContent=g.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.shadowRoot.append(t,this.wrapper),this._initialized=!0,this._initialize(e).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){e!=null&&e._lastState&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),e!=null&&e.__models&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=(e==null?void 0:e.canvas)||(0,g.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=e??new rC({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var e,t;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((e=this.canvas)==null||e.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((t=this.canvas)==null||t.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,t,n){this.refreshAll()}clearViewer(){var e,t;(e=this.viewer)==null||e.scene.disposeSceneModels(),(t=this.viewer)==null||t.scene.setEnvironment(null),Object.values(this._models).forEach(async n=>n.then(i=>i.forEach(s=>s.dispose&&s.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const t=[e],n=[],i=[],s=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const l of t)!this._models[l]&&l&&(this._models[l]=this.viewer.getManager().importer.importPath(l,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const o=this.viewer.scene.environment;o?this._environmentFromSource=o:this.viewer.scene.environment=s;for(const[l,h]of Object.entries(this._models))t.includes(l)?n.push(h.then(d=>[l,d])):i.push(h);await Promise.all([Promise.all(n).then(async l=>Promise.all(l.map(async h=>(this._models[h[0]]=this.viewer.getManager().importer.processImported(h[1]),this._models[h[0]])))).then(l=>{for(const h of l)for(const d of h)d&&d.assetType==="model"&&this.viewer.scene.addSceneObject(d)}),Promise.all(i).then(l=>{for(const h of l)for(const d of h)d&&d.assetType==="model"&&d.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),n=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(n&&n.assetType!=="texture"||await this.viewer.scene.setEnvironment(n),t==null||t.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}addEventListener(e,t,n){super.addEventListener(e,t,n),e==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",sC);class ym{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){var t;this._basePath=(e==null?void 0:e.basePath)??"",this._assets=((t=e==null?void 0:e.assets)==null?void 0:t.map(n=>this._resolveAsset(n)))??[]}find(e){return this._assets.find(e)??void 0}_resolveAsset(e){return{...e,path:(0,g.pathJoin)([this._basePath,e.path])}}}class kR extends g.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const n=t.find(i=>{var s;return i&&(e.test(i.path)||e.test(((s=i.file)==null?void 0:s.name)??""))});if(n)return n}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}const aC=new u.Pa4,oC=new u.Pa4,mo=new u.Ltg,go=new u.Ltg,md=new u.Ltg,HE=new u.Pa4,QE=new u.yGw,vo=new u.Zzh,lC=new u.Pa4,Bx=new u.ZzF,Lx=new u.aLr,gd=new u.Ltg;let vd,Gg;function cC(a,e,t){return gd.set(0,0,-e,1).applyMatrix4(a.projectionMatrix),gd.multiplyScalar(1/gd.w),gd.x=Gg/t.width,gd.y=Gg/t.height,gd.applyMatrix4(a.projectionMatrixInverse),gd.multiplyScalar(1/gd.w),Math.abs(Math.max(gd.x,gd.y))}class Ox extends u.Kj0{constructor(e=new jh,t=new Fl({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let o=0,l=0,h=t.count;o<h;o++,l+=2)aC.fromBufferAttribute(t,o),oC.fromBufferAttribute(n,o),i[l]=l===0?0:i[l-1],i[l+1]=i[l]+aC.distanceTo(oC);const s=new u.$TI(i,2,1);return e.setAttribute("instanceDistanceStart",new u.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new u.kB5(s,1,1)),this}raycast(e,t){const n=this.material.worldUnits,i=e.camera;i!==null||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;vd=e.ray;const o=this.matrixWorld,l=this.geometry,h=this.material;let d,f;Gg=h.linewidth+s,l.boundingSphere===null&&l.computeBoundingSphere(),Lx.copy(l.boundingSphere).applyMatrix4(o),d=n?.5*Gg:cC(i,Math.max(i.near,Lx.distanceToPoint(vd.origin)),h.resolution),Lx.radius+=d,vd.intersectsSphere(Lx)!==!1&&(l.boundingBox===null&&l.computeBoundingBox(),Bx.copy(l.boundingBox).applyMatrix4(o),f=n?.5*Gg:cC(i,Math.max(i.near,Bx.distanceToPoint(vd.origin)),h.resolution),Bx.expandByScalar(f),vd.intersectsBox(Bx)!==!1&&(n?function(v,y){const w=v.matrixWorld,E=v.geometry,M=E.attributes.instanceStart,P=E.attributes.instanceEnd;for(let L=0,R=Math.min(E.instanceCount,M.count);L<R;L++){vo.start.fromBufferAttribute(M,L),vo.end.fromBufferAttribute(P,L),vo.applyMatrix4(w);const I=new u.Pa4,N=new u.Pa4;vd.distanceSqToSegment(vo.start,vo.end,N,I),N.distanceTo(I)<.5*Gg&&y.push({point:N,pointOnLine:I,distance:vd.origin.distanceTo(N),object:v,face:null,faceIndex:L,uv:null,uv1:null})}}(this,t):function(v,y,w){const E=y.projectionMatrix,M=v.material.resolution,P=v.matrixWorld,L=v.geometry,R=L.attributes.instanceStart,I=L.attributes.instanceEnd,N=Math.min(L.instanceCount,R.count),j=-y.near;vd.at(1,md),md.w=1,md.applyMatrix4(y.matrixWorldInverse),md.applyMatrix4(E),md.multiplyScalar(1/md.w),md.x*=M.x/2,md.y*=M.y/2,md.z=0,HE.copy(md),QE.multiplyMatrices(y.matrixWorldInverse,P);for(let H=0,X=N;H<X;H++){if(mo.fromBufferAttribute(R,H),go.fromBufferAttribute(I,H),mo.w=1,go.w=1,mo.applyMatrix4(QE),go.applyMatrix4(QE),mo.z>j&&go.z>j)continue;if(mo.z>j){const Ee=mo.z-go.z,xe=(mo.z-j)/Ee;mo.lerp(go,xe)}else if(go.z>j){const Ee=go.z-mo.z,xe=(go.z-j)/Ee;go.lerp(mo,xe)}mo.applyMatrix4(E),go.applyMatrix4(E),mo.multiplyScalar(1/mo.w),go.multiplyScalar(1/go.w),mo.x*=M.x/2,mo.y*=M.y/2,go.x*=M.x/2,go.y*=M.y/2,vo.start.copy(mo),vo.start.z=0,vo.end.copy(go),vo.end.z=0;const ne=vo.closestPointToPointParameter(HE,!0);vo.at(ne,lC);const pe=u.M8C.lerp(mo.z,go.z,ne),Ae=pe>=-1&&pe<=1,ve=HE.distanceTo(lC)<.5*Gg;if(Ae&&ve){vo.start.fromBufferAttribute(R,H),vo.end.fromBufferAttribute(I,H),vo.start.applyMatrix4(P),vo.end.applyMatrix4(P);const Ee=new u.Pa4,xe=new u.Pa4;vd.distanceSqToSegment(vo.start,vo.end,xe,Ee),w.push({point:xe,pointOnLine:Ee,distance:vd.origin.distanceTo(xe),object:v,face:null,faceIndex:H,uv:null,uv1:null})}}}(this,i,t)))}}class iA extends jh{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setColors(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class WE extends Ox{constructor(e=new iA,t=new Fl({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class UR extends u.DqL{constructor(e){super(e)}parse(e,t){const n=new NR(e,1);return{mipmaps:n.mipmaps(t),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:n.numberOfFaces===6,mipmapCount:n.numberOfMipmapLevels}}}class NR{constructor(e,t){this.arrayBuffer=e;const n=new Uint8Array(this.arrayBuffer,0,12);if(n[0]!==171||n[1]!==75||n[2]!==84||n[3]!==88||n[4]!==32||n[5]!==49||n[6]!==49||n[7]!==187||n[8]!==13||n[9]!==10||n[10]!==26||n[11]!==10)return void console.error("texture missing KTX identifier");const i=Uint32Array.BYTES_PER_ELEMENT,s=new DataView(this.arrayBuffer,12,13*i),o=s.getUint32(0,!0)===67305985;this.glType=s.getUint32(1*i,o),this.glTypeSize=s.getUint32(2*i,o),this.glFormat=s.getUint32(3*i,o),this.glInternalFormat=s.getUint32(4*i,o),this.glBaseInternalFormat=s.getUint32(5*i,o),this.pixelWidth=s.getUint32(6*i,o),this.pixelHeight=s.getUint32(7*i,o),this.pixelDepth=s.getUint32(8*i,o),this.numberOfArrayElements=s.getUint32(9*i,o),this.numberOfFaces=s.getUint32(10*i,o),this.numberOfMipmapLevels=s.getUint32(11*i,o),this.bytesOfKeyValueData=s.getUint32(12*i,o),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let n=64+this.bytesOfKeyValueData,i=this.pixelWidth,s=this.pixelHeight;const o=e?this.numberOfMipmapLevels:1;for(let l=0;l<o;l++){const h=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(let d=0;d<this.numberOfFaces;d++){const f=new Uint8Array(this.arrayBuffer,n,h);t.push({data:f,width:i,height:s}),n+=h,n+=3-(h+3)%4}i=Math.max(1,.5*i),s=Math.max(1,.5*s)}return t}}class qE extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Yt]}async onAdded(e){var t,n;this._importer||(this._importer=new yr(UR,["ktx"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}qE.PluginType="KTXLoadPlugin";class FR extends u.hH6{constructor(e){super(e),this.responseType="blob"}}class uC extends u.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,n,i){return super.load(e,s=>{try{t==null||t((0,g.blobToDataURL)(s))}catch(o){i==null||i(o)}},n,i)}}class hC{async parseAsync(e,t){return new Blob([JSON.stringify(e,null,t.jsonSpaces??2)],{type:"application/json"})}}class dC{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}const pC={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class kx{constructor(){this.pluginCallbacks=[],this.register(function(e){return new jR(e)}),this.register(function(e){return new VR(e)}),this.register(function(e){return new QR(e)}),this.register(function(e){return new WR(e)}),this.register(function(e){return new qR(e)}),this.register(function(e){return new XR(e)}),this.register(function(e){return new GR(e)}),this.register(function(e){return new HR(e)}),this.register(function(e){return new YR(e)}),this.register(function(e){return new KR(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i,s){const o=s||new _C,l=[];for(let h=0,d=this.pluginCallbacks.length;h<d;h++)l.push(this.pluginCallbacks[h](o));o.setPlugins(l),o.write(e,t,i).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(i,s){n.parse(e,i,s,t)})}}const XE=5120,YE=5121,KE=5122,JE=5123,ZE="KHR_mesh_quantization",Ic={};Ic[u.TyD]=9728,Ic[u.YLQ]=9984,Ic[u.aH4]=9986,Ic[u.wem]=9729,Ic[u.qyh]=9985,Ic[u.D1R]=9987,Ic[u.uWy]=33071,Ic[u.rpg]=10497,Ic[u.OoA]=33648;const fC={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},zR=new u.Ilk;function rA(a,e){return a.length===e.length&&a.every(function(t,n){return t===e[n]})}function mC(a){return 4*Math.ceil(a/4)}function Ux(a,e=0){const t=mC(a.byteLength);if(t!==a.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(a)),e!==0)for(let i=a.byteLength;i<t;i++)n[i]=e;return n.buffer}return a}function gC(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function vC(a,e){if(a.toBlob!==void 0)return new Promise(n=>a.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),a.convertToBlob({type:e,quality:t})}class _C{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,s=i.buffers,o=i.json;n=i.options;const l=i.extensionsUsed,h=i.extensionsRequired,d=new Blob(s,{type:"application/octet-stream"}),f=Object.keys(l),v=Object.keys(h);if(f.length>0&&(o.extensionsUsed=f),v.length>0&&(o.extensionsRequired=v),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=d.size),n.binary===!0){const y=new FileReader;y.readAsArrayBuffer(d),y.onloadend=function(){const w=Ux(y.result),E=new DataView(new ArrayBuffer(8));E.setUint32(0,w.byteLength,!0),E.setUint32(4,5130562,!0);const M=Ux((P=JSON.stringify(o),new TextEncoder().encode(P).buffer),32);var P;const L=new DataView(new ArrayBuffer(8));L.setUint32(0,M.byteLength,!0),L.setUint32(4,1313821514,!0);const R=new ArrayBuffer(12),I=new DataView(R);I.setUint32(0,1179937895,!0),I.setUint32(4,2,!0);const N=12+L.byteLength+M.byteLength+E.byteLength+w.byteLength;I.setUint32(8,N,!0);const j=new Blob([R,L,M,E,w],{type:"application/octet-stream"}),H=new FileReader;H.readAsArrayBuffer(j),H.onloadend=function(){t(H.result)}}}else if(o.buffers&&o.buffers.length>0){const y=new FileReader;y.readAsDataURL(d),y.onloadend=function(){const w=y.result;o.buffers[0].uri=w,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,i=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&s.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in s.gltfExtensions)t.extensions[o]=s.gltfExtensions[o],i[o]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(t.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+s.message),console.warn({...e.userData})}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new u.Pa4;for(let n=0,i=e.count;n<i;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),i=new u.Pa4;for(let s=0,o=n.count;s<o;s++)i.fromBufferAttribute(n,s),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),n.setXYZ(s,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const i={};t.offset.x===0&&t.offset.y===0||(i.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(i.rotation=t.rotation,n=!0),t.repeat.x===1&&t.repeat.y===1||(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(y){return y.colorSpace===u.KI_?function(w){return w<.04045?.0773993808*w:Math.pow(.9478672986*w+.0521327014,2.4)}:function(w){return w}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const i=e?e.image:null,s=t?t.image:null,o=Math.max(i?i.width:0,s?s.width:0),l=Math.max(i?i.height:0,s?s.height:0),h=gC();h.width=o,h.height=l;const d=h.getContext("2d");d.fillStyle="#00ffff",d.fillRect(0,0,o,l);const f=d.getImageData(0,0,o,l);if(i){d.drawImage(i,0,0,o,l);const y=n(e),w=d.getImageData(0,0,o,l).data;for(let E=2;E<w.length;E+=4)f.data[E]=256*y(w[E]/256)}if(s){d.drawImage(s,0,0,o,l);const y=n(t),w=d.getImageData(0,0,o,l).data;for(let E=1;E<w.length;E+=4)f.data[E]=256*y(w[E]/256)}d.putImageData(f,0,0);const v=(e||t).clone();return v.source=new u.Hw6(h),v.colorSpace=u.aCh,v.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),v}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,i,s){const o=this.json;let l;switch(o.bufferViews||(o.bufferViews=[]),t){case XE:case YE:l=1;break;case KE:case JE:l=2;break;default:l=4}const h=mC(i*e.itemSize*l),d=new DataView(new ArrayBuffer(h));let f=0;for(let y=n;y<n+i;y++)for(let w=0;w<e.itemSize;w++){let E;e.itemSize>4?E=e.array[y*e.itemSize+w]:(w===0?E=e.getX(y):w===1?E=e.getY(y):w===2?E=e.getZ(y):w===3&&(E=e.getW(y)),e.normalized===!0&&(E=u.M8C.normalize(E,e.array))),t===5126?d.setFloat32(f,E,!0):t===5124?d.setInt32(f,E,!0):t===5125?d.setUint32(f,E,!0):t===KE?d.setInt16(f,E,!0):t===JE?d.setUint16(f,E,!0):t===XE?d.setInt8(f,E):t===YE&&d.setUint8(f,E),f+=l}const v={buffer:this.processBuffer(d.buffer),byteOffset:this.byteOffset,byteLength:h};return s!==void 0&&(v.target=s),s===34962&&(v.byteStride=e.itemSize*l),this.byteOffset+=h,o.bufferViews.push(v),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(i){const s=new FileReader;s.readAsArrayBuffer(e),s.onloadend=function(){const o=Ux(s.result),l={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,i(n.bufferViews.push(l)-1)}})}processBufferViewImageBuffer(e){const t=this,n=t.json;n.bufferViews||(n.bufferViews=[]),e=Ux(e);const i={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};return t.byteOffset+=e.byteLength,n.bufferViews.push(i)-1}processAccessor(e,t,n,i){const s=this.json;let o;if(e.array.constructor===Float32Array)o=5126;else if(e.array.constructor===Int32Array)o=5124;else if(e.array.constructor===Uint32Array)o=5125;else if(e.array.constructor===Int16Array)o=KE;else if(e.array.constructor===Uint16Array)o=JE;else if(e.array.constructor===Int8Array)o=XE;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=YE}if(n===void 0&&(n=0),i===void 0&&(i=e.count),i===0)return null;const l=function(v,y,w){const E={min:new Array(v.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(v.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let M=y;M<y+w;M++)for(let P=0;P<v.itemSize;P++){let L;v.itemSize>4?L=v.array[M*v.itemSize+P]:(P===0?L=v.getX(M):P===1?L=v.getY(M):P===2?L=v.getZ(M):P===3&&(L=v.getW(M)),v.normalized===!0&&(L=u.M8C.normalize(L,v.array))),E.min[P]=Math.min(E.min[P],L),E.max[P]=Math.max(E.max[P],L)}return E}(e,n,i);let h;t!==void 0&&(h=e===t.index?34963:34962);const d=this.processBufferView(e,o,n,i,h),f={bufferView:d.id,byteOffset:d.byteOffset,componentType:o,count:i,max:l.max,min:l.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(f.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(f)-1}processImage(e,t,n,i="image/png",s=void 0,o=void 0){if(e!==null){const l=this,h=l.cache,d=l.json,f=l.options,v=l.pending;h.images.has(e)||h.images.set(e,{});const y=h.images.get(e),w=i+":flipY/"+n.toString()+(s||o?";"+s+";"+o:"");if(y[w]!==void 0)return y[w];d.images||(d.images=[]);const E={mimeType:i},M=gC();M.width=Math.min(s||e.width,f.maxTextureSize),M.height=Math.min(o||e.height,f.maxTextureSize);const P=M.getContext("2d");if(n===!0&&(P.translate(0,M.height),P.scale(1,-1)),e.data!==void 0){t!==u.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>f.maxTextureSize||e.height>f.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const R=new Uint8ClampedArray(e.height*e.width*4);for(let I=0;I<R.length;I+=4)R[I+0]=e.data[I+0],R[I+1]=e.data[I+1],R[I+2]=e.data[I+2],R[I+3]=e.data[I+3];P.putImageData(new ImageData(R,e.width,e.height),0,0)}else P.drawImage(e,0,0,M.width,M.height);f.binary===!0?v.push(vC(M,i).then(R=>l.processBufferViewImage(R)).then(R=>{E.bufferView=R})):M.toDataURL!==void 0?E.uri=M.toDataURL(i):v.push(vC(M,i).then(R=>new FileReader().readAsDataURL(R)).then(R=>{E.uri=R}));const L=d.images.push(E)-1;return y[w]=L,L}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Ic[e.magFilter],minFilter:Ic[e.minFilter],wrapS:Ic[e.wrapS],wrapT:Ic[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let i=e.userData.mimeType;i==="image/webp"&&(i="image/png"),i==="image/jpg"&&(i="image/jpeg");const s={sampler:this.processSampler(e),source:!i||["image/jpeg","image/png"].includes(i)?this.processImage(e.image,e.format,e.flipY,i):null};e.name&&(s.name=e.name),this._invokeAll(function(l){l.writeTexture&&l.writeTexture(e,s)}),s.source===null&&console.error("GLTFExporter: Unsupported mime type: "+i+". Cannot export texture.",e);const o=n.textures.push(s)-1;return t.textures.set(e,o),o}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(rA(s,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const l=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),h={index:this.processTexture(l),channel:l.channel};this.applyTextureTransform(h,l),i.pbrMetallicRoughness.metallicRoughnessTexture=h}if(e.map){const l={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(l,e.map),i.pbrMetallicRoughness.baseColorTexture=l}if(e.emissive){const l=e.emissive;if(Math.max(l.r,l.g,l.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const h={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(h,e.emissiveMap),i.emissiveTexture=h}}if(e.normalMap){const l={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(l.scale=e.normalScale.x),this.applyTextureTransform(l,e.normalMap),i.normalTexture=l}if(e.aoMap){const l={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(l.strength=e.aoMapIntensity),this.applyTextureTransform(l,e.aoMap),i.occlusionTexture=l}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===u.ehD&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(l){l.writeMaterial&&l.writeMaterial(e,i)});const o=n.materials.push(i)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let I=0,N=e.material.length;I<N;I++)i.push(e.material[I].uuid);else i.push(e.material.uuid);const s=i.join(":");if(t.meshes.has(s))return t.meshes.get(s);const o=e.geometry;let l;l=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const h={},d={},f=[],v=[],y={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},w=o.getAttribute("normal");w===void 0||this.isNormalizedNormalAttribute(w)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(w)));let E=null;for(let I in o.attributes){if(I.slice(0,5)==="morph")continue;const N=o.attributes[I];if(I=y[I]||I.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(I)||(I="_"+I),t.attributes.has(this.getUID(N))){d[I]=t.attributes.get(this.getUID(N));continue}E=null;const j=N.array;I!=="JOINTS_0"||j instanceof Uint16Array||j instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),E=new u.TlE(new Uint16Array(j),N.itemSize,N.normalized));const H=this.processAccessor(E||N,o);H!==null&&(I.startsWith("_")||this.detectMeshQuantization(I,N),d[I]=H,t.attributes.set(this.getUID(N),H))}if(w!==void 0&&o.setAttribute("normal",w),Object.keys(d).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const I=[],N=[],j={};if(e.morphTargetDictionary!==void 0)for(const H in e.morphTargetDictionary)j[e.morphTargetDictionary[H]]=H;for(let H=0;H<e.morphTargetInfluences.length;++H){const X={};let ne=!1;for(const pe in o.morphAttributes){if(pe!=="position"&&pe!=="normal"){ne||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),ne=!0);continue}const Ae=o.morphAttributes[pe][H],ve=pe.toUpperCase(),Ee=o.attributes[pe];if(t.attributes.has(this.getUID(Ae,!0))){X[ve]=t.attributes.get(this.getUID(Ae,!0));continue}const xe=Ae.clone();if(!o.morphTargetsRelative)for(let we=0,Re=Ae.count;we<Re;we++)for(let Be=0;Be<Ae.itemSize;Be++)Be===0&&xe.setX(we,Ae.getX(we)-Ee.getX(we)),Be===1&&xe.setY(we,Ae.getY(we)-Ee.getY(we)),Be===2&&xe.setZ(we,Ae.getZ(we)-Ee.getZ(we)),Be===3&&xe.setW(we,Ae.getW(we)-Ee.getW(we));X[ve]=this.processAccessor(xe,o),t.attributes.set(this.getUID(Ee,!0),X[ve])}v.push(X),I.push(e.morphTargetInfluences[H]),e.morphTargetDictionary!==void 0&&N.push(j[H])}h.weights=I,N.length>0&&(h.extras={},h.extras.targetNames=N)}const M=Array.isArray(e.material);if(M&&o.groups.length===0)return null;const P=M?e.material:[e.material],L=M?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let I=0,N=L.length;I<N;I++){const j={mode:l,attributes:d};if(this.serializeUserData(o,j),v.length>0&&(j.targets=v),o.index!==null){let X=this.getUID(o.index);L[I].start===void 0&&L[I].count===void 0||(X+=":"+L[I].start+":"+L[I].count),t.attributes.has(X)?j.indices=t.attributes.get(X):(j.indices=this.processAccessor(o.index,o,L[I].start,L[I].count),t.attributes.set(X,j.indices)),j.indices===null&&delete j.indices}const H=this.processMaterial(P[L[I].materialIndex]);H!==null&&(j.material=H),f.push(j)}h.primitives=f,n.meshes||(n.meshes=[]),this._invokeAll(function(I){I.writeMesh&&I.writeMesh(e,h)});const R=n.meshes.push(h)-1;return t.meshes.set(s,R),R}detectMeshQuantization(e,t){if(this.extensionsUsed[ZE])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const i=e.split("_",1)[0];pC[i]&&pC[i].includes(n)&&(this.extensionsUsed[ZE]=!0,this.extensionsRequired[ZE]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:u.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const n=this.json,i=this.nodeMap;n.animations||(n.animations=[]);const s=(e=kx.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,o=[],l=[];for(let h=0;h<s.length;++h){const d=s[h],f=u.iUV.parseTrackName(d.name);let v=u.iUV.findNode(t,f.nodeName);const y=fC[f.propertyName];if(f.objectName==="bones"&&(v=v.isSkinnedMesh===!0?v.skeleton.getBoneByName(f.objectIndex):void 0),!v||!y)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',d.name),null;const w=1;let E,M=d.values.length/d.times.length;y===fC.morphTargetInfluences&&(M/=v.morphTargetInfluences.length),d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(E="CUBICSPLINE",M/=3):E=d.getInterpolation()===u.Syv?"STEP":"LINEAR",l.push({input:this.processAccessor(new u.TlE(d.times,w)),output:this.processAccessor(new u.TlE(d.values,M)),interpolation:E}),o.push({sampler:l.length-1,target:{node:i.get(v),path:y}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:l,channels:o}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],s=e.skeleton;if(s===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const l=[],h=new Float32Array(16*s.bones.length),d=new u.yGw;for(let f=0;f<s.bones.length;++f)l.push(n.get(s.bones[f])),d.copy(s.boneInverses[f]),d.multiply(e.bindMatrix).toArray(h,16*f);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new u.TlE(h,16)),joints:l,skeleton:n.get(o)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const s={};if(n.trs){const l=e.quaternion.toArray(),h=e.position.toArray(),d=e.scale.toArray();rA(l,[0,0,0,1])||(s.rotation=l),rA(h,[0,0,0])||(s.translation=h),rA(d,[1,1,1])||(s.scale=d)}else e.matrixAutoUpdate&&e.updateMatrix(),rA(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(s.matrix=e.matrix.elements);if(e.name!==""&&(s.name=String(e.name)),this.serializeUserData(e,s),e.isMesh||e.isLine||e.isPoints){const l=this.processMesh(e);l!==null&&(s.mesh=l)}else e.isCamera&&(s.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const l=[];for(let h=0,d=e.children.length;h<d;h++){const f=e.children[h];if(f.visible||n.onlyVisible===!1){const v=this.processNode(f);v!==null&&l.push(v)}}l.length>0&&(s.children=l)}this._invokeAll(function(l){l.writeNode&&l.writeNode(e,s)});const o=t.nodes.push(s)-1;return i.set(e,o),o}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const s=[];for(let o=0,l=e.children.length;o<l;o++){const h=e.children[o];if(h.visible||n.onlyVisible===!1){const d=this.processNode(h);d!==null&&s.push(d)}}s.length>0&&(i.nodes=s),this.serializeUserData(e,i)}processObjects(e){const t=new u.xsS;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const n=[];for(let i=0;i<e.length;i++)e[i]instanceof u.xsS?this.processScene(e[i]):n.push(e[i]);n.length>0&&this.processObjects(n);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class jR{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,i=n.json,s=n.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},s[this.name]=!0);const l=i.extensions[this.name].lights;l.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:l.length-1}}}class VR{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class GR{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(o,e.clearcoatMap),s.clearcoatTexture=o}if(s.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(o,e.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(o,e.clearcoatNormalMap),s.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class HR{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(o,e.iridescenceMap),s.iridescenceTexture=o}if(s.iridescenceIor=e.iridescenceIOR,s.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(o,e.iridescenceThicknessMap),s.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class QR{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.transmissionFactor=e.transmission,e.transmissionMap){const o={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(o,e.transmissionMap),s.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class WR{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.thicknessFactor=e.thickness,e.thicknessMap){const o={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(o,e.thicknessMap),s.thicknessTexture=o}s.attenuationDistance=e.attenuationDistance,s.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class qR{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class XR{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(zR)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,i=n.extensionsUsed,s={};if(e.specularIntensityMap){const o={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(o,e.specularIntensityMap),s.specularTexture=o}if(e.specularColorMap){const o={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(o,e.specularColorMap),s.specularColorTexture=o}s.specularFactor=e.specularIntensity,s.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class YR{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const n=this.writer,i=n.extensionsUsed,s={};if(e.sheenRoughnessMap){const o={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(o,e.sheenRoughnessMap),s.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(o,e.sheenColorMap),s.sheenColorTexture=o}s.sheenRoughnessFactor=e.sheenRoughness,s.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,i[this.name]=!0}}class KR{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}kx.Utils={GLTFWriter:_C,insertKeyframe:function(a,e){const n=a.getValueSize(),i=new a.TimeBufferType(a.times.length+1),s=new a.ValueBufferType(a.values.length+n),o=a.createInterpolant(new a.ValueBufferType(n));let l;if(a.times.length===0){i[0]=e;for(let h=0;h<n;h++)s[h]=0;l=0}else if(e<a.times[0]){if(Math.abs(a.times[0]-e)<.001)return 0;i[0]=e,i.set(a.times,1),s.set(o.evaluate(e),0),s.set(a.values,n),l=0}else if(e>a.times[a.times.length-1]){if(Math.abs(a.times[a.times.length-1]-e)<.001)return a.times.length-1;i[i.length-1]=e,i.set(a.times,0),s.set(a.values,0),s.set(o.evaluate(e),a.values.length),l=i.length-1}else for(let h=0;h<a.times.length;h++){if(Math.abs(a.times[h]-e)<.001)return h;if(a.times[h]<e&&a.times[h+1]>e){i.set(a.times.slice(0,h+1),0),i[h+1]=e,i.set(a.times.slice(h+1),h+2),s.set(a.values.slice(0,(h+1)*n),0),s.set(o.evaluate(e),(h+1)*n),s.set(a.values.slice((h+1)*n),(h+2)*n),l=h+1;break}}return a.times=i,a.values=s,l},mergeMorphTargetTracks:function(a,e){const t=[],n={},i=a.tracks;for(let s=0;s<i.length;++s){let o=i[s];const l=u.iUV.parseTrackName(o.name),h=u.iUV.findNode(e,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(u.NMF)}const d=h.morphTargetInfluences.length,f=h.morphTargetDictionary[l.propertyIndex];if(f===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let v;if(n[h.uuid]===void 0){v=o.clone();const w=new v.ValueBufferType(d*v.times.length);for(let E=0;E<v.times.length;E++)w[E*d+f]=v.values[E];v.name=(l.nodeName||"")+".morphTargetInfluences",v.values=w,n[h.uuid]=v,t.push(v);continue}const y=o.createInterpolant(new o.ValueBufferType(1));v=n[h.uuid];for(let w=0;w<v.times.length;w++)v.values[w*d+f]=y.evaluate(v.times[w]);for(let w=0;w<o.times.length;w++){const E=this.insertKeyframe(v,o.times[w]);v.values[E*d+f]=o.values[w]}}return a.tracks=t,a}};class yC extends kx.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new u.Wid}serializeUserData(e,t){const n=e.userData,i={};n.__disposed&&console.error("Serializing a disposed object",e),Object.entries(n).forEach(([o,l])=>{(!l||typeof l=="function"||l.isObject3D||l.isTexture||l.isMaterial||l.assetType!=null||o.startsWith("_")||o!=="uuid"&&(Nc.includes(o)||Za.includes(o)||Ud.includes(o)))&&(i[o]=l,delete n[o])});const s=Fi(n,!1);Object.entries(i).forEach(([o,l])=>{n[o]=l,delete i[o]}),e.userData=s,super.serializeUserData(e,t),e.userData=n}processObjects(e){var t;e.length===1&&((t=e[0])!=null&&t.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const n=super.processMaterial(t);if(n===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return n;const i=JSON.stringify(this.json.materials[n]),s=JSON.parse(i);this.serializeUserData(e,s),this._invokeAll(l=>{l.writeMaterial&&l.writeMaterial(e,s)});const o=this.json.materials.push(s)-1;return this.cache.materials.set(e,o),o}processImageBlob(e,t){if(!e)return-1;const n=this.cache,i=this.options,s=this.pending,o=this.json,l=t.image;n.images.has(l)||n.images.set(l,{});const h=n.images.get(l),d=e.type+":flipY/"+t.flipY.toString();if(h[d]!==void 0)return h[d];o.images||(o.images=[]);const f={mimeType:e.type};i.binary===!0?s.push(new Promise(y=>{this.processBufferViewImage(e).then(w=>{f.bufferView=w,y()})})):s.push((0,g.blobToDataURL)(e).then(y=>{f.uri=y}));const v=o.images.push(f)-1;return h[d]=v,v}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);const i=e.source.data,s=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const o=super.processTexture(e),l=n.textures[o];if(!l)return console.error("No texture def",o,e),o;const h=n.images?n.images[l.source]:null;if(h&&(h.extras||(h.extras={}),e.source&&(h.extras.uuid=e.source.uuid),h.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=i,e.userData.mimeType=s,!l)return console.error("textureDef is null",o,e),o;if(l.source>=0){const d=this.json.images[l.source];d.uri?console.warn("uri already set",d.uri):(d.uri=e.userData.rootPath,d.mimeType=s,d.extras||(d.extras={}),d.extras.flipY=e.flipY,d.extras.uri=e.userData.rootPath)}else l.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,s)}return l.source<0&&console.error("textureDef.source cannot be saved",l,e),o}processImage(e,t,n,i="image/png"){return e?super.processImage(e,t,n,i,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,n,i="image/png"){const s=this.cache,o=this.json;s.images.has(e)||s.images.set(e,{});const l=s.images.get(e),h=i+":flipY/"+n.toString();if(l[h]!==void 0)return l[h];o.images||(o.images=[]);const d={mimeType:i,uri:t,extras:{flipY:n}},f=o.images.push(d)-1;return l[h]=f,f}}function JR(a,e){(e=e??document.createElement("script")).type=a.type||"text/javascript",e.text=a.text;for(let t=0;t<a.attributes.length;t++){const n=a.attributes[t];e.setAttribute(n.name,n.value)}return e}function AC(a,e=0){const t=(n=a.byteLength,4*Math.ceil(n/4));var n;if(t!==a.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(a)),e!==0)for(let s=a.byteLength;s<t;s++)i[s]=e;return i.buffer}return a}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,e){const t=new Uint8Array(this);e==null&&(e=t.length);const n=new ArrayBuffer(e-a),i=new Uint8Array(n);for(let s=0;s<i.length;s++)i[s]=t[s+a];return n});class $E extends kx{register(e){return super.register(e)}async parseAsync(e,t){if(!e)throw new Error("No object to export");const n=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((i,s)=>this.parse(e,i,s,t));if(n&&typeof n=="object"&&!n.byteLength)return new Blob([JSON.stringify(n,(i,s)=>i.startsWith("__")?void 0:s,t.jsonSpaces??2)],{type:"model/gltf+json"});if(n){let i=null;return t.encrypt&&(!t.encryptKey&&window.prompt&&(t.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),t.encryptKey?i=function(s,o){const l=AC(s),h=new DataView(new ArrayBuffer(8));h.setUint32(0,l.byteLength,!0),h.setUint32(4,5130562,!0);const d=AC(new TextEncoder().encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}})).buffer,32),f=new DataView(new ArrayBuffer(8));f.setUint32(0,d.byteLength,!0),f.setUint32(4,1313821514,!0);const v=new ArrayBuffer(12),y=new DataView(v);y.setUint32(0,1179937895,!0),y.setUint32(4,2,!0);const w=12+f.byteLength+d.byteLength+h.byteLength+l.byteLength;y.setUint32(8,w,!0);const E=new Blob([v,f,d,h,l],{type:"application/octet-stream"});return E.ext="glb",E}(await(0,g.aesGcmEncrypt)(new Uint8Array(n),t.encryptKey)):console.warn("GLTF Export: encryption key not provided, skipping encryption")),i||(i=new Blob([n],{type:"model/gltf+binary"})),i}throw new Error("GLTFExporter2.parse() failed")}parse(e,t,n,i={}){const s={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!i.embedUrlImages&&i.externalImagesInExtras||!1,embedUrlImages:i.embedUrlImages??!1,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:i};return i.exportExt==="glb"&&(s.binary=!0),i.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(o=>o.traverse(l=>{l.uuid&&(l.userData.gltfUUID=l.uuid)})),(Array.isArray(e)?e:[e]).forEach(o=>o.traverse(l=>{if(l.animations)for(const h of l.animations)h.__gltfExport===!1||s.animations.includes(h)||s.animations.push(...l.animations)})),super.parse(e,o=>{i.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(l=>l.traverse(h=>{delete h.userData.gltfUUID})),t(Object.assign(o,{__isGLTFOutput:!0}))},n,s,new yC)}}function bC(a,e){const t=a.getPlugin(Yt).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&t.resources.textures&&[...Object.entries(t.resources.textures)].forEach(([i,s])=>{e.json.textures.find(l=>{var h,d,f,v,y;return((h=l.extras)==null?void 0:h.uuid)===i||((f=(d=e.json.samplers[l.sampler])==null?void 0:d.extras)==null?void 0:f.uuid)===i||((y=(v=e.json.images[l.source])==null?void 0:v.extras)==null?void 0:y.t_uuid)===i})&&(s.image&&t.resources.images&&t.resources.images[s.image]&&delete t.resources.images[s.image],t.resources.textures[i]={})}),e.json.materials&&t.resources.materials&&[...Object.entries(t.resources.materials)].forEach(([i,s])=>{e.json.materials.find(o=>{var l;return((l=o.extras)==null?void 0:l.uuid)===i})&&(t.resources.materials[i]={})});const n=[];Object.values(t.resources).forEach(i=>{i&&Object.values(i).forEach(s=>{s.url&&(s.url.type==="Uint16Array"&&s.url.data?(s.url.data instanceof Uint16Array||(s.url.data=new Uint16Array(s.url.data)),n.push(s.url)):s.url.type==="Uint8Array"&&s.url.data&&(s.url.data instanceof Uint8Array||(s.url.data=new Uint8Array(s.url.data)),n.push(s.url)))})});for(const i of n){let s="application/octet-stream";if(i.mimeType&&(s=i.mimeType),e.options.exporterOptions.encodeUint16Rgbe&&i.type==="Uint16Array"&&i.width>0&&i.height>0){const d=ZR(i.data,4),f=new ImageData(d,i.width,i.height),v=u.PpQ.getDataURL(f,!0).split(",")[1],y=2;s="image/png",y===1||(i.data=Uint8Array.from(atob(v),w=>w.charCodeAt(0))),i.encoding="rgbe",i.encodingVersion=y}e.json.images||(e.json.images=[]);const o={mimeType:s},l=e.json.images.push(o)-1,h=i.data;o.bufferView=e.processBufferViewImageBuffer(h),i.data={image:l}}return t}function ZR(a,e=3,t){let n,i,s,o,l;const h=a.byteLength/(2*e)|0;t=t||new Uint8ClampedArray(4*h);for(let d=0;d<h;d++){n=a[d*e],i=a[d*e+1],s=a[d*e+2],o=Math.max(Math.max(n,i),s);const f=Math.ceil(Math.log2(o));l=Math.pow(2,f-8),t[4*d]=n/l|0,t[4*d+1]=i/l|0,t[4*d+2]=s/l|0,t[4*d+3]=f+128}return t}function eS(a,e,t=$E,n){if(!e)return;const i=a.Exporters.findIndex(o=>o.ext.includes("gltf")||o.ext.includes("glb")),s=[];i>=0?(s.push(...a.Exporters[i].extensions??[]),a.Exporters.splice(i,1)):(s.push(tD),s.push(eD),s.push($R),s.push(o=>new hf(o)),s.push(o=>new nD(o)),s.push(o=>new iD(o)),s.push(o=>new rD(o)),s.push(o=>new sD(o))),a.Exporters.push({ctor:()=>{const o=new t;return s.forEach(l=>o.register(l)),o.register(l=>({afterParse:h=>{var d,f;if(h=Array.isArray(h)?h[0]:h,!((d=h==null?void 0:h.userData)!=null&&d.rootSceneModelRoot)||((f=h==null?void 0:h.userData)==null?void 0:f.__exportViewerConfig)===!1)return;const v=l.json.scenes[l.json.scene||0];v.extensions||(v.extensions={}),v.extensions[Jr]=bC(e,l),l.extensionsUsed[Jr]=!0}})),n==null||n(o),o},ext:["gltf","glb"],extensions:s})}const $R=a=>({writeNode:(e,t)=>{if(!(e!=null&&e.isLight))return;t.extensions||(t.extensions={});const n={};e.shadow&&(n.shadow=e.shadow.toJSON()),Object.keys(n).length>0&&(t.extensions[Ro]=n,a.extensionsUsed[Ro]=!0)}}),eD=a=>({writeNode:(e,t)=>{if(!(e!=null&&e.isObject3D))return;t.extensions||(t.extensions={});const n={};e.castShadow!==void 0&&(n.castShadow=e.castShadow),e.receiveShadow!==void 0&&(n.receiveShadow=e.receiveShadow),e.visible===!1&&(n.visible=!1),e.frustumCulled===!1&&(n.frustumCulled=!1),e.renderOrder!==0&&(n.renderOrder=e.renderOrder),e.layers.mask!==1&&(n.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),Object.keys(n).length>0&&(t.extensions[Us]=n,a.extensionsUsed[Us]=!0)}}),tD=a=>({writeMaterial(e,t){if(!(e!=null&&e.isMaterial))return;t.extensions||(t.extensions={});const n={};e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.side!==void 0&&e.side!==u.ehD&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.vertexColors!==void 0&&(n.vertexColors=e.vertexColors),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.normalScale!==void 0&&(n.normalScale=[e.normalScale.x,e.normalScale.y]);const i=this.materialExternalResources[e.uuid];i&&Object.entries(i).forEach(([s,o])=>{var l;s.startsWith("_")||(o!=null&&o.userData&&(o.userData.__embedUrlImagePreviews=(l=a.options.exporterOptions)==null?void 0:l.embedUrlImagePreviews),n[s]=Fi(o,!1,this.serializedMeta),o!=null&&o.userData&&delete o.userData.__embedUrlImagePreviews)}),Object.keys(n).length>0&&(t.extensions[ws]=n,a.extensionsUsed[ws]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!a.options.externalImagesInExtras)return;const t=[];(Array.isArray(e)?e:[e]).forEach(n=>{n==null||n.traverse(i=>{var s;i&&((s=i.material)!=null&&s.isMaterial)&&t.push(i.material)})}),t.forEach(n=>{n&&(this.materialExternalResources[n.uuid]||(this.materialExternalResources[n.uuid]={}),this.materialExternalResources[n.uuid].__materialRef=n,Object.entries(n).forEach(([i,s])=>{i.startsWith("_")||s&&s.isTexture&&s.userData.rootPath&&(s.userData.rootPath.startsWith("http")||s.userData.rootPath.startsWith("data:"))&&(n[i]=null,this.materialExternalResources[n.uuid][i]=s)}))})},afterParse(e){const t=Object.values(this.materialExternalResources);if(t.length<1)return;t.forEach(i=>{const s=i.__materialRef;s&&(Object.entries(i).forEach(([o,l])=>{o.startsWith("_")||l&&(s[o]=l)}),delete this.materialExternalResources[s.uuid])});const n=a.json.scenes[a.json.scene||0];n.extensions||(n.extensions={}),n.extensions[ws]={resources:this.serializedMeta},a.extensionsUsed[ws]=!0}});class nD{constructor(e){this.writer=e,this.name=Eu}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.bumpScale=e.bumpScale,e.bumpMap){const o={index:n.processTexture(e.bumpMap)};n.applyTextureTransform(o,e.bumpMap),s.bumpTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class iD{constructor(e){this.writer=e,this.name=Tl}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.displacementScale=e.displacementScale,s.displacementBias=e.displacementBias,e.displacementMap){const o={index:n.processTexture(e.displacementMap)};n.applyTextureTransform(o,e.displacementMap),s.displacementTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class rD{constructor(e){this.writer=e,this.name=Sf}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.lightMapIntensity=e.lightMapIntensity,e.lightMap){const o={index:n.processTexture(e.lightMap)};n.applyTextureTransform(o,e.lightMap),s.lightMapTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class sD{constructor(e){this.writer=e,this.name=Vc}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const n=this.writer,i=n.extensionsUsed,s={};if(e.alphaMap){const o={index:n.processTexture(e.alphaMap)};n.applyTextureTransform(o,e.alphaMap),s.alphaTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}const aD=new TextEncoder;class oD{parse(e,t,n){if(!function(h,d){if(d.isWebGLRenderTarget&&(!h||!h.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!d||!d.isWebGLRenderTarget&&!d.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const f=d.isWebGLRenderTarget?d.texture:d;return f.type!==u.VzW&&f.type!==u.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):f.format===u.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,t))return;const i=function(h,d={}){const f=h.isTexture?h:h.texture,v=h.isWebGLRenderTarget?h.width:h.image.width,y=h.isWebGLRenderTarget?h.height:h.image.height,w=f.type,E=f.format,M=f.colorSpace,P=d.compression!==void 0?d.compression:3,L=(d.type!==void 0?d.type:u.cLu)===u.VzW?2:1,R={0:1,2:1,3:16}[P];return{width:v,height:y,type:w,format:E,colorSpace:M,compression:P,blockLines:R,dataType:L,dataSize:2*L,numBlocks:Math.ceil(y/R),numInputChannels:4,numOutputChannels:4,flipY:h.isDataTexture&&h.flipY}}(t,n),s=function(h,d,f){if(d.isDataTexture)return d.image.data;let v;return v=f.type===u.VzW?new Float32Array(f.width*f.height*f.numInputChannels):new Uint16Array(f.width*f.height*f.numInputChannels),h.readRenderTargetPixels(d,0,0,f.width,f.height,v),v}(e,t,i),o=function(h,d){const f=d.width,v=d.height,y={r:0,g:0,b:0,a:0},w={value:0},E=d.numOutputChannels==4?1:0,M=d.type==u.VzW?fD:pD,P=d.dataType==1?hD:tS,L=new Uint8Array(d.width*d.height*d.numOutputChannels*d.dataSize),R=new DataView(L.buffer);for(let I=0;I<v;++I)for(let N=0;N<f;++N){const j=I*f*4+4*N,H=M(h,j),X=M(h,j+1),ne=M(h,j+2),pe=M(h,j+3),Ae=(d.flipY?I:v-I-1)*f*(3+E)*d.dataSize;uD(y,H,X,ne,pe),w.value=Ae+N*d.dataSize,P(R,y.a,w),w.value=Ae+E*f*d.dataSize+N*d.dataSize,P(R,y.b,w),w.value=Ae+(1+E)*f*d.dataSize+N*d.dataSize,P(R,y.g,w),w.value=Ae+(2+E)*f*d.dataSize+N*d.dataSize,P(R,y.r,w)}return L}(s,i),l=function(h,d){let f,v,y=0;const w={data:new Array,totalSize:0},E=d.width*d.numOutputChannels*d.blockLines*d.dataSize;switch(d.compression){case 0:f=lD;break;case 2:case 3:f=cD}d.compression!==0&&(v=new Uint8Array(E));for(let M=0;M<d.numBlocks;++M){const P=f(h.subarray(E*M,E*(M+1)),v);y+=P.length,w.data.push({dataChunk:P,size:P.length})}return w.totalSize=y,w}(o,i);return function(h,d){const f=8*d.numBlocks,v=259+18*d.numOutputChannels,y={value:v+f},w=new Uint8Array(v+f+h.totalSize+8*d.numBlocks),E=new DataView(w.buffer);(function(M,P,L){const R={value:0},I=new DataView(M.buffer);ir(I,20000630,R),ir(I,2,R),ua(I,"compression",R),ua(I,"compression",R),ir(I,1,R),sA(I,L.compression,R),ua(I,"screenWindowCenter",R),ua(I,"v2f",R),ir(I,8,R),ir(I,0,R),ir(I,0,R),ua(I,"screenWindowWidth",R),ua(I,"float",R),ir(I,4,R),tS(I,1,R),ua(I,"pixelAspectRatio",R),ua(I,"float",R),ir(I,4,R),tS(I,1,R),ua(I,"lineOrder",R),ua(I,"lineOrder",R),ir(I,1,R),sA(I,0,R),ua(I,"dataWindow",R),ua(I,"box2i",R),ir(I,16,R),ir(I,0,R),ir(I,0,R),ir(I,L.width-1,R),ir(I,L.height-1,R),ua(I,"displayWindow",R),ua(I,"box2i",R),ir(I,16,R),ir(I,0,R),ir(I,0,R),ir(I,L.width-1,R),ir(I,L.height-1,R),ua(I,"channels",R),ua(I,"chlist",R),ir(I,18*L.numOutputChannels+1,R),ua(I,"A",R),ir(I,L.dataType,R),R.value+=4,ir(I,1,R),ir(I,1,R),ua(I,"B",R),ir(I,L.dataType,R),R.value+=4,ir(I,1,R),ir(I,1,R),ua(I,"G",R),ir(I,L.dataType,R),R.value+=4,ir(I,1,R),ir(I,1,R),ua(I,"R",R),ir(I,L.dataType,R),R.value+=4,ir(I,1,R),ir(I,1,R),sA(I,0,R),sA(I,0,R);let N=R.value+8*L.numBlocks;for(let j=0;j<P.data.length;++j)dD(I,N,R),N+=P.data[j].size+8})(w,h,d);for(let M=0;M<h.data.length;++M){const P=h.data[M].dataChunk,L=h.data[M].size;ir(E,M*d.blockLines,y),ir(E,L,y),w.set(P,y.value),y.value+=L}return w}(l,i)}}function lD(a){return a}function cD(a,e){let t=0,n=Math.floor((a.length+1)/2),i=0;const s=a.length-1;for(;!(i>s||(e[t++]=a[i++],i>s));)e[n++]=a[i++];let o=e[0];for(let l=1;l<e.length;l++){const h=e[l]-o+384;o=e[l],e[l]=h}return function(l,h){h||(h={});var d=D();d.p(l);var f=U(l,h,2,4);return V(f,h),G(f,f.length-4,d.d()),f}(e)}function uD(a,e,t,n,i){a.r=e,a.g=t,a.b=n,a.a=i}function sA(a,e,t){a.setUint8(t.value,e),t.value+=1}function ir(a,e,t){a.setUint32(t.value,e,!0),t.value+=4}function hD(a,e,t){a.setUint16(t.value,u.A5E.toHalfFloat(e),!0),t.value+=2}function tS(a,e,t){a.setFloat32(t.value,e,!0),t.value+=4}function dD(a,e,t){a.setBigUint64(t.value,BigInt(e),!0),t.value+=8}function ua(a,e,t){const n=aD.encode(e+"\0");for(let i=0;i<n.length;++i)sA(a,n[i],t)}function pD(a,e){return function(t){const n=(31744&t)>>10,i=1023&t;return(t>>15?-1:1)*(n?n===31?i?NaN:1/0:Math.pow(2,n-15)*(1+i/1024):i/1024*6103515625e-14)}(a[e])}function fD(a,e){return a[e]}class Nx extends oD{async parseAsync(e,t){const n=this.parse(e.renderer.rendererObject,e,t);return new Blob([n],{type:"image/x-exr"})}}class xC extends g.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find(t=>t.ext.some(n=>e.includes(n)))}constructor(e,t={}){super(),this._processors=new tl,this.Exporters=[{ctor:()=>new hC,ext:["json"]},{ctor:()=>new dC,ext:["txt","text"]},{ctor:()=>new Nx,ext:["exr"]}],this._cachedParsers=[],eS(this,e)}async exportObject(e,t={}){var n,i;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");(n=e==null?void 0:e.userData)!=null&&n.rootSceneModelRoot&&t.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const s=[];e.assetType==="model"&&e.modelObject.traverse(l=>{l.userData.excludeFromExport&&l.visible&&(l.visible=!1,s.push(l))});const o=await this._exportFile(e,t);return e.assetType==="model"&&s.forEach(l=>l.visible=!0),(i=e==null?void 0:e.userData)!=null&&i.rootSceneModelRoot&&t.viewerConfig===!1&&delete e.userData.__exportViewerConfig,o}async _exportFile(e,t={}){let n;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const i=await this.processBeforeExport(e,t),s=t.exportExt??(i==null?void 0:i.typeExt)??(i==null?void 0:i.ext);if(!i||!s)throw new Error(`Unable to preprocess before export ${s}`);const o=this._getParser(s);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const l=await o.parseAsync(i.obj,{exportExt:i.ext??s,...t});l.ext=i.ext,n=l}catch(i){return console.error("AssetExporter: Unable to Export file",e),console.error(i),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:i})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),n}_createParser(e){const t=this.Exporters.find(i=>i.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const n=t==null?void 0:t.ctor(this);if(!n)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:n}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:n}),n}_getParser(e){var t;return((t=this._cachedParsers.find(n=>n.ext.includes(e)))==null?void 0:t.parser)??this._createParser(e)}async processBeforeExport(e,t={}){if(e.assetType!=null&&e.assetType!=="renderTarget"&&(e=await this._processors.process(e.assetType,e,t)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)==null||e.dispose()}}var aA;(function(a){a[a.EDGEBREAKER=1]="EDGEBREAKER",a[a.SEQUENTIAL=0]="SEQUENTIAL"})(aA||(aA={}));class Am extends Sn{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:aA.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new xC(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(t,n)=>{var i;return n.convertMeshToIndexed&&((i=t.modelObject)==null||i.traverse(s=>{var o;s.geometry&&(s.geometry.attributes.index||((o=s.setGeometry)==null||o.call(s,qr(s.geometry))))})),t}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,n;return(n=this.exporter)==null?void 0:n.exportObject((t=this._viewer)==null?void 0:t.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,t){var n,i;const s=(n=this._viewer)==null?void 0:n.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,t):(i=this._viewer)==null||i.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",n=>{var i;typeof((i=n.plugin)==null?void 0:i.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const t=Object.entries(e.plugins).filter(([n,i])=>typeof(i==null?void 0:i.toJSON)=="function"&&(i==null?void 0:i.serializeWithViewer)!==!1).map(([n,i])=>({label:n,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(aA).map(([n,i])=>({label:n,value:i}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(n=>({label:n}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(n=>({type:"slider",label:n,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,n]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach(n=>{var i;n.value=!1,(i=n.uiRefresh)==null||i.call(n)})}},{type:"button",label:"Select all",value:()=>{t.forEach(n=>{var i;n.value=!0,(i=n.uiRefresh)==null||i.call(n)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(Yt).exportPluginPresets(t.filter(i=>!!i.value).map(i=>(0,g.getOrCall)(i.label)||"")),null,2)],{type:"application/json"});n&&await this._downloadBlob(n,this.exportOptions.name+"."+Yt.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(Yt).exportViewerConfig(!1),null,2)],{type:"application/json"});n&&await this._downloadBlob(n,this.exportOptions.name+"."+Yt.ViewerTypeSlug)}}]}]}}}Am.PluginType="AssetExporterPlugin",function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([ke()],Am.prototype,"exportOptions",void 0);class nS{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners[e];if(n!==void 0){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){const n=t.slice(0);for(let i=0,s=n.length;i<s;i++)n[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class e0 extends nS{constructor(e,t,n,i={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=i,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class mD extends nS{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let n=this.listParentEdges(e);return t&&(n=n.filter(i=>t(i.getParent()))),n.forEach(i=>i.dispose()),this}createEdge(e,t,n,i){return this._registerEdge(new e0(e,t,n,i))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function oA(){return oA=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},oA.apply(this,arguments)}function iS(a){return a instanceof e0}function lA(a){return Array.isArray(a)&&a[0]instanceof e0}function cA(a){return!!(function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype}(a)&&function(e){for(const t in e)return e[t]}(a)instanceof e0)}const Ir=Symbol("attributes"),t0=Symbol("immutableKeys");class rS extends nS{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Ir]=void 0,this[t0]=void 0,this.graph=e,this[t0]=new Set,this[Ir]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const i=e[n];if(i instanceof rS){const s=this.graph.createEdge(n,this,i);s.addEventListener("dispose",()=>i.dispose()),this[t0].add(n),t[n]=s}else t[n]=i}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[Ir]){const i=this[Ir][n];if(iS(i)){const s=i;s.getChild()===e&&this.setRef(n,t,s.getAttributes())}else if(lA(i)){const s=i.find(o=>o.getChild()===e);if(s){const o=s.getAttributes();this.removeRef(n,e).addRef(n,t,o)}}else if(cA(i)){const s=i;for(const o in s){const l=s[o];l.getChild()===e&&this.setRefMap(n,o,t,l.getAttributes())}}}return this}get(e){return this[Ir][e]}set(e,t){return this[Ir][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[Ir][e];return t?t.getChild():null}setRef(e,t,n){if(this[t0].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const i=this[Ir][e];if(i&&i.dispose(),!t)return this;const s=this.graph.createEdge(e,this,t,n);return s.addEventListener("dispose",()=>{delete this[Ir][e],this.dispatchEvent({type:"change",attribute:e})}),this[Ir][e]=s,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Ir][e].map(t=>t.getChild())}addRef(e,t,n){const i=this.graph.createEdge(e,this,t,n),s=this[Ir][e];return s.push(i),i.addEventListener("dispose",()=>{const o=s.filter(l=>l!==i);s.length=0;for(const l of o)s.push(l);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[Ir][e].filter(n=>n.getChild()===t).forEach(n=>n.dispose()),this}listRefMapKeys(e){return Object.keys(this[Ir][e])}listRefMapValues(e){return Object.values(this[Ir][e]).map(t=>t.getChild())}getRefMap(e,t){const n=this[Ir][e];return n[t]?n[t].getChild():null}setRefMap(e,t,n,i){const s=this[Ir][e],o=s[t];if(o&&o.dispose(),!n)return this;i=Object.assign(i||{},{key:t});const l=this.graph.createEdge(e,this,n,oA({},i,{key:t}));return l.addEventListener("dispose",()=>{delete s[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),s[t]=l,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(oA({},e,{target:this})),this.graph.dispatchEvent(oA({},e,{target:this,type:`node:${e.type}`})),this}}const wC="@glb.bin";var fn,Fx,Pc,As,Hg;(function(a){a.ACCESSOR="Accessor",a.ANIMATION="Animation",a.ANIMATION_CHANNEL="AnimationChannel",a.ANIMATION_SAMPLER="AnimationSampler",a.BUFFER="Buffer",a.CAMERA="Camera",a.MATERIAL="Material",a.MESH="Mesh",a.PRIMITIVE="Primitive",a.PRIMITIVE_TARGET="PrimitiveTarget",a.NODE="Node",a.ROOT="Root",a.SCENE="Scene",a.SKIN="Skin",a.TEXTURE="Texture",a.TEXTURE_INFO="TextureInfo"})(fn||(fn={})),function(a){a.INTERLEAVED="interleaved",a.SEPARATE="separate"}(Fx||(Fx={})),function(a){a.ARRAY_BUFFER="ARRAY_BUFFER",a.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",a.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",a.OTHER="OTHER",a.SPARSE="SPARSE"}(Pc||(Pc={})),function(a){a[a.R=4096]="R",a[a.G=256]="G",a[a.B=16]="B",a[a.A=1]="A"}(As||(As={})),function(a){a.GLTF="GLTF",a.GLB="GLB"}(Hg||(Hg={}));const zx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var jx,sS,aS=typeof Float32Array<"u"?Float32Array:Array;function oS(a){return Math.hypot(a[0],a[1],a[2])}function gD(a,e,t){var n=e[0],i=e[1],s=e[2],o=t[3]*n+t[7]*i+t[11]*s+t[15];return a[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/(o=o||1),a[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/o,a[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/o,a}function vD(a,e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of a.listPrimitives()){const i=n.getAttribute("POSITION");if(!i)continue;let s=[0,0,0],o=[0,0,0];for(let l=0;l<i.getCount();l++)s=i.getElement(l,s),o=gD(o,s,e),lS(o,t)}return t}function lS(a,e){for(let t=0;t<3;t++)e.min[t]=Math.min(a[t],e.min[t]),e.max[t]=Math.max(a[t],e.max[t])}Math.hypot||(Math.hypot=function(){for(var a=0,e=arguments.length;e--;)a+=arguments[e]*arguments[e];return Math.sqrt(a)}),jx=new aS(3),aS!=Float32Array&&(jx[0]=0,jx[1]=0,jx[2]=0);class Ii{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const s of e)t+=s.byteLength;const n=new Uint8Array(t);let i=0;for(const s of e)n.set(s,i),i+=s.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const i=new Uint8Array(n);if(i.set(e),t!==0)for(let s=e.byteLength;s<n;s++)i[s]=t;return i}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Kl{static hexToFactor(e,t){e=Math.floor(e);const n=t;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[n,i,s]=this.convertLinearToSRGB(e,t);return 255*n<<16^255*i<<8^255*s<<0}static convertSRGBToLinear(e,t){const n=e,i=t;for(let s=0;s<3;s++)i[s]=n[s]<.04045?.0773993808*n[s]:Math.pow(.9478672986*n[s]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const n=e,i=t;for(let s=0;s<3;s++)i[s]=n[s]<.0031308?12.92*n[s]:1.055*Math.pow(n[s],.41666)-.055;return t}}class Vx{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Ii.decodeText(e.slice(12,16))===Vx.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}Vx.PNG_FRIED_CHUNK_NAME="CgBI";class _d{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let n=0;const i=this.getSize(e,t);if(!i)return null;for(;i[0]>1||i[1]>1;)n+=i[0]*i[1]*4,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}function _D(a,e){if(e>a.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(a.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return a}_d.impls={"image/jpeg":new class{match(a){return a.length>=3&&a[0]===255&&a[1]===216&&a[2]===255}getSize(a){let e,t,n=new DataView(a.buffer,a.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),_D(n,e),t=n.getUint8(e+1),t===192||t===193||t===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(a.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(a){return 3}},"image/png":new Vx};class n0{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return _d.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function EC(a){return Object.prototype.toString.call(a)==="[object Object]"}function Qg(a){if(EC(a)===!1)return!1;const e=a.constructor;if(e===void 0)return!0;const t=e.prototype;return EC(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}(function(a){a[a.SILENT=4]="SILENT",a[a.ERROR=3]="ERROR",a[a.WARN=2]="WARN",a[a.INFO=1]="INFO",a[a.DEBUG=0]="DEBUG"})(sS||(sS={}));class Rc{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Rc.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Rc.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Rc.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Rc.Verbosity.ERROR&&console.error(e)}}function yD(a,e,t){var n=e[0],i=e[1],s=e[2],o=e[3],l=e[4],h=e[5],d=e[6],f=e[7],v=e[8],y=e[9],w=e[10],E=e[11],M=e[12],P=e[13],L=e[14],R=e[15],I=t[0],N=t[1],j=t[2],H=t[3];return a[0]=I*n+N*l+j*v+H*M,a[1]=I*i+N*h+j*y+H*P,a[2]=I*s+N*d+j*w+H*L,a[3]=I*o+N*f+j*E+H*R,a[4]=(I=t[4])*n+(N=t[5])*l+(j=t[6])*v+(H=t[7])*M,a[5]=I*i+N*h+j*y+H*P,a[6]=I*s+N*d+j*w+H*L,a[7]=I*o+N*f+j*E+H*R,a[8]=(I=t[8])*n+(N=t[9])*l+(j=t[10])*v+(H=t[11])*M,a[9]=I*i+N*h+j*y+H*P,a[10]=I*s+N*d+j*w+H*L,a[11]=I*o+N*f+j*E+H*R,a[12]=(I=t[12])*n+(N=t[13])*l+(j=t[14])*v+(H=t[15])*M,a[13]=I*i+N*h+j*y+H*P,a[14]=I*s+N*d+j*w+H*L,a[15]=I*o+N*f+j*E+H*R,a}Rc.Verbosity=sS,Rc.DEFAULT_INSTANCE=new Rc(Rc.Verbosity.INFO);class Hr{static identity(e){return e}static eq(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(Math.abs(e[i]-t[i])>n)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return Hr.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return Hr.encodeNormalizedInt(e,t)}static decompose(e,t,n,i){let s=oS([e[0],e[1],e[2]]);const o=oS([e[4],e[5],e[6]]),l=oS([e[8],e[9],e[10]]);var h,d,f,v,y,w,E,M,P,L,R,I,N,j,H,X,ne;((d=(h=e)[0])*(E=h[5])-(f=h[1])*(w=h[4]))*((I=h[10])*(ne=h[15])-(N=h[11])*(X=h[14]))-(d*(M=h[6])-(v=h[2])*w)*((R=h[9])*ne-N*(H=h[13]))+(d*(P=h[7])-(y=h[3])*w)*(R*X-I*H)+(f*M-v*E)*((L=h[8])*ne-N*(j=h[12]))-(f*P-y*E)*(L*X-I*j)+(v*P-y*M)*(L*H-R*j)<0&&(s=-s),t[0]=e[12],t[1]=e[13],t[2]=e[14];const pe=e.slice(),Ae=1/s,ve=1/o,Ee=1/l;pe[0]*=Ae,pe[1]*=Ae,pe[2]*=Ae,pe[4]*=ve,pe[5]*=ve,pe[6]*=ve,pe[8]*=Ee,pe[9]*=Ee,pe[10]*=Ee,function(xe,we){var Re=new aS(3);(function(jn,wt){var jt=wt[4],on=wt[5],li=wt[6],Mi=wt[8],pi=wt[9],ai=wt[10];jn[0]=Math.hypot(wt[0],wt[1],wt[2]),jn[1]=Math.hypot(jt,on,li),jn[2]=Math.hypot(Mi,pi,ai)})(Re,we);var Be=1/Re[0],Oe=1/Re[1],at=1/Re[2],st=we[0]*Be,St=we[1]*Oe,dt=we[2]*at,ht=we[4]*Be,Nt=we[5]*Oe,Bt=we[6]*at,rn=we[8]*Be,hn=we[9]*Oe,wn=we[10]*at,Jn=st+Nt+wn,Fn=0;Jn>0?(Fn=2*Math.sqrt(Jn+1),xe[3]=.25*Fn,xe[0]=(Bt-hn)/Fn,xe[1]=(rn-dt)/Fn,xe[2]=(St-ht)/Fn):st>Nt&&st>wn?(Fn=2*Math.sqrt(1+st-Nt-wn),xe[3]=(Bt-hn)/Fn,xe[0]=.25*Fn,xe[1]=(St+ht)/Fn,xe[2]=(rn+dt)/Fn):Nt>wn?(Fn=2*Math.sqrt(1+Nt-st-wn),xe[3]=(rn-dt)/Fn,xe[0]=(St+ht)/Fn,xe[1]=.25*Fn,xe[2]=(Bt+hn)/Fn):(Fn=2*Math.sqrt(1+wn-st-Nt),xe[3]=(St-ht)/Fn,xe[0]=(rn+dt)/Fn,xe[1]=(Bt+hn)/Fn,xe[2]=.25*Fn)}(n,pe),i[0]=s,i[1]=o,i[2]=l}static compose(e,t,n,i){const s=i,o=t[0],l=t[1],h=t[2],d=t[3],f=o+o,v=l+l,y=h+h,w=o*f,E=o*v,M=o*y,P=l*v,L=l*y,R=h*y,I=d*f,N=d*v,j=d*y,H=n[0],X=n[1],ne=n[2];return s[0]=(1-(P+R))*H,s[1]=(E+j)*H,s[2]=(M-N)*H,s[3]=0,s[4]=(E-j)*X,s[5]=(1-(w+R))*X,s[6]=(L+I)*X,s[7]=0,s[8]=(M+N)*ne,s[9]=(L-I)*ne,s[10]=(1-(w+P))*ne,s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}}function AD(a,e){if(!!a!=!!e)return!1;const t=a.getChild(),n=e.getChild();return t===n||t.equals(n)}function bD(a,e){if(!!a!=!!e||a.length!==e.length)return!1;for(let t=0;t<a.length;t++){const n=a[t],i=e[t];if(n.getChild()!==i.getChild()&&!n.getChild().equals(i.getChild()))return!1}return!0}function xD(a,e){if(!!a!=!!e)return!1;const t=Object.keys(a),n=Object.keys(e);if(t.length!==n.length)return!1;for(const i in a){const s=a[i],o=e[i];if(!!s!=!!o)return!1;const l=s.getChild(),h=o.getChild();if(l!==h&&!l.equals(h))return!1}return!0}function SC(a,e){if(a===e)return!0;if(!!a!=!!e||!a||!e||a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(a[t]!==e[t])return!1;return!0}function MC(a,e){if(a===e)return!0;if(!!a!=!!e)return!1;if(!Qg(a)||!Qg(e))return a===e;const t=a,n=e;let i,s=0,o=0;for(i in t)s++;for(i in n)o++;if(s!==o)return!1;for(i in t){const l=t[i],h=n[i];if(Gx(l)&&Gx(h)){if(!SC(l,h))return!1}else if(Qg(l)&&Qg(h)){if(!MC(l,h))return!1}else if(l!==h)return!1}return!0}function Gx(a){return Array.isArray(a)||ArrayBuffer.isView(a)}const CC="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",TC=new Set,wD=function(){let a="";for(let e=0;e<6;e++)a+=CC.charAt(Math.floor(Math.random()*CC.length));return a};class uA{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return n0.basename(new URL(e,"https://null.example").pathname)}static extension(e){return n0.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),i=t.split("/");n.pop();for(let s=0;s<i.length;s++)i[s]!=="."&&(i[s]===".."?n.pop():n.push(i[s]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}uA.DEFAULT_INIT={},uA.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Up=a=>a,ED=new Set;class cS extends rS{constructor(e,t=""){super(e),this[Ir].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,Up)}copy(e,t=Up){for(const n in this[Ir]){const i=this[Ir][n];if(i instanceof e0)this[t0].has(n)||i.dispose();else if(lA(i))for(const s of i)s.dispose();else if(cA(i))for(const s in i)i[s].dispose()}for(const n in e[Ir]){const i=this[Ir][n],s=e[Ir][n];if(s instanceof e0)this[t0].has(n)?i.getChild().copy(t(s.getChild()),t):this.setRef(n,t(s.getChild()),s.getAttributes());else if(lA(s))for(const o of s)this.addRef(n,t(o.getChild()),o.getAttributes());else if(cA(s))for(const o in s){const l=s[o];this.setRefMap(n,o,t(l.getChild()),l.getAttributes())}else this[Ir][n]=Qg(s)?JSON.parse(JSON.stringify(s)):Array.isArray(s)||s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.slice():s}return this}equals(e,t=ED){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[Ir]){if(t.has(n))continue;const i=this[Ir][n],s=e[Ir][n];if(iS(i)||iS(s)){if(!AD(i,s))return!1}else if(lA(i)||lA(s)){if(!bD(i,s))return!1}else if(cA(i)||cA(s)){if(!xD(i,s))return!1}else if(Qg(i)||Qg(s)){if(!MC(i,s))return!1}else if(Gx(i)||Gx(s)){if(!SC(i,s))return!1}else if(i!==s)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class ml extends cS{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class Pn extends ml{constructor(...e){super(...e),this.i=Hr.identity,this.o=Hr.identity}init(){this.propertyType=fn.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Pn.Type.SCALAR,componentType:Pn.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=Up){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Pn.Type.SCALAR:return 1;case Pn.Type.VEC2:return 2;case Pn.Type.VEC3:return 3;case Pn.Type.VEC4:case Pn.Type.MAT2:return 4;case Pn.Type.MAT3:return 9;case Pn.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Pn.ComponentType.BYTE:case Pn.ComponentType.UNSIGNED_BYTE:return 1;case Pn.ComponentType.SHORT:case Pn.ComponentType.UNSIGNED_SHORT:return 2;case Pn.ComponentType.UNSIGNED_INT:case Pn.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMin(e){const t=this.get("array"),n=this.getCount(),i=this.getElementSize();for(let s=0;s<i;s++)e[s]=1/0;for(let s=0;s<n*i;s+=i)for(let o=0;o<i;o++){const l=t[s+o];Number.isFinite(l)&&(e[o]=Math.min(e[o],l))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMax(e){const t=this.get("array"),n=this.getCount(),i=this.getElementSize();for(let s=0;s<i;s++)e[s]=-1/0;for(let s=0;s<n*i;s+=i)for(let o=0;o<i;o++){const l=t[s+o];Number.isFinite(l)&&(e[o]=Math.max(e[o],l))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Pn.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>Hr.decodeNormalizedInt(t,this.get("componentType")),this.i=t=>Hr.encodeNormalizedInt(t,this.get("componentType"))):(this.o=Hr.identity,this.i=Hr.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const n=this.getElementSize(),i=this.get("array");for(let s=0;s<n;s++)t[s]=this.o(i[e*n+s]);return t}setElement(e,t){const n=this.getElementSize(),i=this.get("array");for(let s=0;s<n;s++)i[e*n+s]=this.i(t[s]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return Pn.ComponentType.FLOAT;case Uint32Array:return Pn.ComponentType.UNSIGNED_INT;case Uint16Array:return Pn.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Pn.ComponentType.UNSIGNED_BYTE;case Int16Array:return Pn.ComponentType.SHORT;case Int8Array:return Pn.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Pn.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}Pn.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},Pn.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class IC extends ml{init(){this.propertyType=fn.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class uS extends ml{init(){this.propertyType=fn.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}uS.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class i0 extends ml{init(){this.propertyType=fn.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:i0.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Pc.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Pc.OTHER})}}i0.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class PC extends ml{init(){this.propertyType=fn.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Wg extends ml{init(){this.propertyType=fn.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Wg.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Wg.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Ps extends cS{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Ps.EXTENSION_NAME=void 0;class Qr extends ml{init(){this.propertyType=fn.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Qr.WrapMode.REPEAT,wrapT:Qr.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Qr.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Qr.MagFilter={NEAREST:9728,LINEAR:9729},Qr.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Hx,G:Qx,B:Wx,A:SD}=As;class qg extends ml{init(){this.propertyType=fn.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:qg.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Qr(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Qr(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Qr(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Qr(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Qr(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Kl.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Kl.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Hx|Qx|Wx|SD})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Kl.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Kl.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Hx|Qx|Wx})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Hx|Qx|Wx})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Hx})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Qx|Wx})}}qg.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class RC extends ml{init(){this.propertyType=fn.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class DC extends ml{constructor(...e){super(...e),this.u=null}init(){this.propertyType=fn.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=Up){if(t===Up)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Hr.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),i=this.get("scale").slice();return Hr.decompose(e,t,n,i),this.set("translation",t).set("rotation",n).set("scale",i)}getWorldTranslation(){const e=[0,0,0];return Hr.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Hr.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Hr.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let i=this;i!=null;i=i.u)e.push(i);let t;const n=e.pop().getMatrix();for(;t=e.pop();)yD(n,n,t.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[Ir].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===fn.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class Xg extends ml{init(){this.propertyType=fn.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Xg.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Pc.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Pc.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Xg.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class MD extends cS{init(){this.propertyType=fn.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Pc.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Jl(){return(Jl=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a}).apply(this,arguments)}class BC extends ml{init(){this.propertyType=fn.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=Up){if(t===Up)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class LC extends ml{init(){this.propertyType=fn.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Pc.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class OC extends ml{init(){this.propertyType=fn.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||_d.extensionToMimeType(n0.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=_d.extensionToMimeType(n0.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Ii.assertView(e))}getSize(){const e=this.get("image");return e?_d.getSize(e,this.getMimeType()):null}}class kC extends ml{init(){this.propertyType=fn.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",t=>{this.l(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Up){if(t===Up)throw new Error("Root cannot be copied.");this.set("asset",Jl({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Jl({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const i=e.getExtension(n);this.setExtension(n,t(i))}return this}l(e){return e instanceof BC?this.addRef("scenes",e):e instanceof DC?this.addRef("nodes",e):e instanceof Wg?this.addRef("cameras",e):e instanceof LC?this.addRef("skins",e):e instanceof RC?this.addRef("meshes",e):e instanceof qg?this.addRef("materials",e):e instanceof OC?this.addRef("textures",e):e instanceof IC?this.addRef("animations",e):e instanceof Pn?this.addRef("accessors",e):e instanceof PC&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class r0{static fromGraph(e){return r0.m.get(e)||null}constructor(){this.v=new mD,this.T=new kC(this.v),this.M=Rc.DEFAULT_INSTANCE,r0.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new r0().setLogger(this.M).merge(this)}merge(e){for(const s of e.getRoot().listExtensionsUsed()){const o=this.createExtension(s.constructor);s.isRequired()&&o.setRequired(!0)}const t=new Set,n=new Map;t.add(e.T),n.set(e.T,this.T);for(const s of e.v.listEdges())for(const o of[s.getParent(),s.getChild()]){if(t.has(o))continue;let l;l=o.propertyType===fn.TEXTURE_INFO?o:new o.constructor(this.v),n.set(o,l),t.add(o)}const i=s=>{const o=n.get(s);if(!o)throw new Error("Could resolve property.");return o};for(const s of t){const o=n.get(s);if(!o)throw new Error("Could resolve property.");o.propertyType!==fn.TEXTURE_INFO&&o.copy(s,i)}return this}async transform(...e){const t=e.map(n=>n.name);for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===t)||new e(this)}createScene(e=""){return new BC(this.v,e)}createNode(e=""){return new DC(this.v,e)}createCamera(e=""){return new Wg(this.v,e)}createSkin(e=""){return new LC(this.v,e)}createMesh(e=""){return new RC(this.v,e)}createPrimitive(){return new Xg(this.v)}createPrimitiveTarget(e=""){return new MD(this.v,e)}createMaterial(e=""){return new qg(this.v,e)}createTexture(e=""){return new OC(this.v,e)}createAnimation(e=""){return new IC(this.v,e)}createAnimationChannel(e=""){return new uS(this.v,e)}createAnimationSampler(e=""){return new i0(this.v,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new Pn(this.v,e).setBuffer(t)}createBuffer(e=""){return new PC(this.v,e)}}r0.m=new WeakMap;class es{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=n=>{const i=n,s=i.target;s instanceof Ps&&s.extensionName===this.extensionName&&(i.type==="node:create"&&this.I(s),i.type==="node:dispose"&&this.N(s))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}es.EXTENSION_NAME=void 0;class CD{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const n=this.jsonDoc.json.textures[t.index];if(n.sampler===void 0)return;const i=this.jsonDoc.json.samplers[n.sampler];i.magFilter!==void 0&&e.setMagFilter(i.magFilter),i.minFilter!==void 0&&e.setMinFilter(i.minFilter),i.wrapS!==void 0&&e.setWrapS(i.wrapS),i.wrapT!==void 0&&e.setWrapT(i.wrapT)}}const UC={logger:Rc.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function qx(a,e){const t=e.bufferViews[a.bufferView],n=e.jsonDoc.json.bufferViews[a.bufferView],i=zx[a.componentType],s=Pn.getElementSize(a.type),o=i.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==s*o)return function(h,d){const f=d.bufferViews[h.bufferView],v=d.jsonDoc.json.bufferViews[h.bufferView],y=zx[h.componentType],w=Pn.getElementSize(h.type),E=y.BYTES_PER_ELEMENT,M=h.byteOffset||0,P=new y(h.count*w),L=new DataView(f.buffer,f.byteOffset,f.byteLength),R=v.byteStride;for(let I=0;I<h.count;I++)for(let N=0;N<w;N++){const j=M+I*R+N*E;let H;switch(h.componentType){case Pn.ComponentType.FLOAT:H=L.getFloat32(j,!0);break;case Pn.ComponentType.UNSIGNED_INT:H=L.getUint32(j,!0);break;case Pn.ComponentType.UNSIGNED_SHORT:H=L.getUint16(j,!0);break;case Pn.ComponentType.UNSIGNED_BYTE:H=L.getUint8(j);break;case Pn.ComponentType.SHORT:H=L.getInt16(j,!0);break;case Pn.ComponentType.BYTE:H=L.getInt8(j);break;default:throw new Error(`Unexpected componentType "${h.componentType}".`)}P[I*w+N]=H}return P}(a,e);const l=t.byteOffset+(a.byteOffset||0);return new i(t.buffer.slice(l,l+a.count*s*o))}var hA;(function(a){a[a.ARRAY_BUFFER=34962]="ARRAY_BUFFER",a[a.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(hA||(hA={}));class yd{constructor(e,t,n){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=t,this.options=n;const i=e.getRoot(),s=i.listBuffers().length,o=i.listTextures().length;this.bufferURIGenerator=new NC(s>1,()=>n.basename||"buffer"),this.imageURIGenerator=new NC(o>1,l=>function(h,d){const f=h.getGraph().listParentEdges(d).find(v=>v.getParent()!==h.getRoot());return f?f.getName().replace(/texture$/i,""):""}(e,l)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},i=JSON.stringify(n);this.samplerDefIndexMap.has(i)||(this.samplerDefIndexMap.set(i,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const s={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(i)},o=JSON.stringify(s);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(s));const l={index:this.textureDefIndexMap.get(o)};return t.getTexCoord()!==0&&(l.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(l.extras=t.getExtras()),this.textureInfoDefMap.set(t,l),l}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.O.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===Hg.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const i=_d.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,i),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.C.get(e);if(t)return t;if(e.getSparse())return Pc.SPARSE;for(const n of this.O.getGraph().listParentEdges(e)){const{usage:i}=n.getAttributes();if(i)return i;n.getParent().propertyType!==fn.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Pc.OTHER}addAccessorToUsageGroup(e,t){const n=this.C.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this.C.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,n]of Array.from(this.C.entries()))e[n]=e[n]||[],e[n].push(t);return e}}yd.BufferViewTarget=hA,yd.BufferViewUsage=Pc,yd.USAGE_TO_TARGET={[Pc.ARRAY_BUFFER]:hA.ARRAY_BUFFER,[Pc.ELEMENT_ARRAY_BUFFER]:hA.ELEMENT_ARRAY_BUFFER};class NC{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:Xx}=yd,{UNSIGNED_INT:TD,UNSIGNED_SHORT:ID,UNSIGNED_BYTE:PD}=Pn.ComponentType;var Yx;(function(a){a[a.JSON=1313821514]="JSON",a[a.BIN=5130562]="BIN"})(Yx||(Yx={}));class RD{constructor(){this.M=Rc.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=Fx.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=FC(t)?this.P(t):{json:JSON.parse(Ii.decodeText(t)),resources:{}};return await this.L(n,this.dirname(e)),this.j(n),n}async readJSON(e){return e=this.D(e),this.j(e),(class{static read(t,n=UC){const i=Jl({},UC,n),{json:s}=t,o=new r0().setLogger(i.logger);this.validate(t,i);const l=new CD(t),h=s.asset,d=o.getRoot().getAsset();h.copyright&&(d.copyright=h.copyright),h.extras&&(d.extras=h.extras),s.extras!==void 0&&o.getRoot().setExtras(Jl({},s.extras));const f=s.extensionsUsed||[],v=s.extensionsRequired||[];for(const I of i.extensions)if(f.includes(I.EXTENSION_NAME)){const N=o.createExtension(I).setRequired(v.includes(I.EXTENSION_NAME));for(const j of N.readDependencies)N.install(j,i.dependencies[j])}const y=s.buffers||[];o.getRoot().listExtensionsUsed().filter(I=>I.prereadTypes.includes(fn.BUFFER)).forEach(I=>I.preread(l,fn.BUFFER)),l.buffers=y.map(I=>{const N=o.createBuffer(I.name);return I.extras&&N.setExtras(I.extras),I.uri&&I.uri.indexOf("__")!==0&&N.setURI(I.uri),N}),l.bufferViewBuffers=(s.bufferViews||[]).map((I,N)=>{if(!l.bufferViews[N]){const j=t.json.buffers[I.buffer];l.bufferViews[N]=Ii.toView(j.uri?t.resources[j.uri]:t.resources["@glb.bin"],I.byteOffset||0,I.byteLength)}return l.buffers[I.buffer]});const w=s.accessors||[];l.accessors=w.map(I=>{const N=o.createAccessor(I.name,l.bufferViewBuffers[I.bufferView]).setType(I.type);return I.extras&&N.setExtras(I.extras),I.normalized!==void 0&&N.setNormalized(I.normalized),I.bufferView===void 0||N.setArray(qx(I,l)),N});const E=s.images||[],M=s.textures||[];o.getRoot().listExtensionsUsed().filter(I=>I.prereadTypes.includes(fn.TEXTURE)).forEach(I=>I.preread(l,fn.TEXTURE)),l.textures=E.map(I=>{const N=o.createTexture(I.name);if(I.extras&&N.setExtras(I.extras),I.bufferView!==void 0){const j=s.bufferViews[I.bufferView],H=t.json.buffers[j.buffer],X=j.byteOffset||0,ne=(H.uri?t.resources[H.uri]:t.resources["@glb.bin"]).slice(X,X+j.byteLength);N.setImage(ne)}else I.uri!==void 0&&(N.setImage(t.resources[I.uri]),I.uri.indexOf("__")!==0&&N.setURI(I.uri));if(I.mimeType!==void 0)N.setMimeType(I.mimeType);else if(I.uri){const j=n0.extension(I.uri);N.setMimeType(_d.extensionToMimeType(j))}return N}),l.materials=(s.materials||[]).map(I=>{const N=o.createMaterial(I.name);I.extras&&N.setExtras(I.extras),I.alphaMode!==void 0&&N.setAlphaMode(I.alphaMode),I.alphaCutoff!==void 0&&N.setAlphaCutoff(I.alphaCutoff),I.doubleSided!==void 0&&N.setDoubleSided(I.doubleSided);const j=I.pbrMetallicRoughness||{};if(j.baseColorFactor!==void 0&&N.setBaseColorFactor(j.baseColorFactor),I.emissiveFactor!==void 0&&N.setEmissiveFactor(I.emissiveFactor),j.metallicFactor!==void 0&&N.setMetallicFactor(j.metallicFactor),j.roughnessFactor!==void 0&&N.setRoughnessFactor(j.roughnessFactor),j.baseColorTexture!==void 0){const H=j.baseColorTexture;N.setBaseColorTexture(l.textures[M[H.index].source]),l.setTextureInfo(N.getBaseColorTextureInfo(),H)}if(I.emissiveTexture!==void 0){const H=I.emissiveTexture;N.setEmissiveTexture(l.textures[M[H.index].source]),l.setTextureInfo(N.getEmissiveTextureInfo(),H)}if(I.normalTexture!==void 0){const H=I.normalTexture;N.setNormalTexture(l.textures[M[H.index].source]),l.setTextureInfo(N.getNormalTextureInfo(),H),I.normalTexture.scale!==void 0&&N.setNormalScale(I.normalTexture.scale)}if(I.occlusionTexture!==void 0){const H=I.occlusionTexture;N.setOcclusionTexture(l.textures[M[H.index].source]),l.setTextureInfo(N.getOcclusionTextureInfo(),H),I.occlusionTexture.strength!==void 0&&N.setOcclusionStrength(I.occlusionTexture.strength)}if(j.metallicRoughnessTexture!==void 0){const H=j.metallicRoughnessTexture;N.setMetallicRoughnessTexture(l.textures[M[H.index].source]),l.setTextureInfo(N.getMetallicRoughnessTextureInfo(),H)}return N});const P=s.meshes||[];o.getRoot().listExtensionsUsed().filter(I=>I.prereadTypes.includes(fn.PRIMITIVE)).forEach(I=>I.preread(l,fn.PRIMITIVE)),l.meshes=P.map(I=>{const N=o.createMesh(I.name);return I.extras&&N.setExtras(I.extras),I.weights!==void 0&&N.setWeights(I.weights),(I.primitives||[]).forEach(j=>{const H=o.createPrimitive();j.extras&&H.setExtras(j.extras),j.material!==void 0&&H.setMaterial(l.materials[j.material]),j.mode!==void 0&&H.setMode(j.mode);for(const[ne,pe]of Object.entries(j.attributes||{}))H.setAttribute(ne,l.accessors[pe]);j.indices!==void 0&&H.setIndices(l.accessors[j.indices]);const X=I.extras&&I.extras.targetNames||[];(j.targets||[]).forEach((ne,pe)=>{const Ae=X[pe]||pe.toString(),ve=o.createPrimitiveTarget(Ae);for(const[Ee,xe]of Object.entries(ne))ve.setAttribute(Ee,l.accessors[xe]);H.addTarget(ve)}),N.addPrimitive(H)}),N}),l.cameras=(s.cameras||[]).map(I=>{const N=o.createCamera(I.name).setType(I.type);if(I.extras&&N.setExtras(I.extras),I.type===Wg.Type.PERSPECTIVE){const j=I.perspective;N.setYFov(j.yfov),N.setZNear(j.znear),j.zfar!==void 0&&N.setZFar(j.zfar),j.aspectRatio!==void 0&&N.setAspectRatio(j.aspectRatio)}else{const j=I.orthographic;N.setZNear(j.znear).setZFar(j.zfar).setXMag(j.xmag).setYMag(j.ymag)}return N});const L=s.nodes||[];o.getRoot().listExtensionsUsed().filter(I=>I.prereadTypes.includes(fn.NODE)).forEach(I=>I.preread(l,fn.NODE)),l.nodes=L.map(I=>{const N=o.createNode(I.name);if(I.extras&&N.setExtras(I.extras),I.translation!==void 0&&N.setTranslation(I.translation),I.rotation!==void 0&&N.setRotation(I.rotation),I.scale!==void 0&&N.setScale(I.scale),I.matrix!==void 0){const j=[0,0,0],H=[0,0,0,1],X=[1,1,1];Hr.decompose(I.matrix,j,H,X),N.setTranslation(j),N.setRotation(H),N.setScale(X)}return I.weights!==void 0&&N.setWeights(I.weights),N}),l.skins=(s.skins||[]).map(I=>{const N=o.createSkin(I.name);I.extras&&N.setExtras(I.extras),I.inverseBindMatrices!==void 0&&N.setInverseBindMatrices(l.accessors[I.inverseBindMatrices]),I.skeleton!==void 0&&N.setSkeleton(l.nodes[I.skeleton]);for(const j of I.joints)N.addJoint(l.nodes[j]);return N}),L.map((I,N)=>{const j=l.nodes[N];(I.children||[]).forEach(H=>j.addChild(l.nodes[H])),I.mesh!==void 0&&j.setMesh(l.meshes[I.mesh]),I.camera!==void 0&&j.setCamera(l.cameras[I.camera]),I.skin!==void 0&&j.setSkin(l.skins[I.skin])}),l.animations=(s.animations||[]).map(I=>{const N=o.createAnimation(I.name);I.extras&&N.setExtras(I.extras);const j=(I.samplers||[]).map(H=>{const X=o.createAnimationSampler().setInput(l.accessors[H.input]).setOutput(l.accessors[H.output]).setInterpolation(H.interpolation||i0.Interpolation.LINEAR);return H.extras&&X.setExtras(H.extras),N.addSampler(X),X});return(I.channels||[]).forEach(H=>{const X=o.createAnimationChannel().setSampler(j[H.sampler]).setTargetPath(H.target.path);H.target.node!==void 0&&X.setTargetNode(l.nodes[H.target.node]),H.extras&&X.setExtras(H.extras),N.addChannel(X)}),N});const R=s.scenes||[];return o.getRoot().listExtensionsUsed().filter(I=>I.prereadTypes.includes(fn.SCENE)).forEach(I=>I.preread(l,fn.SCENE)),l.scenes=R.map(I=>{const N=o.createScene(I.name);return I.extras&&N.setExtras(I.extras),(I.nodes||[]).map(j=>l.nodes[j]).forEach(j=>N.addChild(j)),N}),s.scene!==void 0&&o.getRoot().setDefaultScene(l.scenes[s.scene]),o.getRoot().listExtensionsUsed().forEach(I=>I.read(l)),w.forEach((I,N)=>{const j=l.accessors[N],H=!!I.sparse,X=!I.bufferView&&!j.getArray();(H||X)&&j.setSparse(!0).setArray(function(ne,pe){const Ae=zx[ne.componentType],ve=Pn.getElementSize(ne.type);let Ee;Ee=ne.bufferView!==void 0?qx(ne,pe):new Ae(ne.count*ve);const xe=ne.sparse;if(!xe)return Ee;const we=xe.count,Re=Jl({},ne,xe.indices,{count:we,type:"SCALAR"}),Be=Jl({},ne,xe.values,{count:we}),Oe=qx(Re,pe),at=qx(Be,pe);for(let st=0;st<Re.count;st++)for(let St=0;St<ve;St++)Ee[Oe[st]*ve+St]=at[st*ve+St];return Ee}(I,l))}),o}static validate(t,n){const i=t.json;if(i.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${i.asset.version}".`);if(i.extensionsRequired){for(const s of i.extensionsRequired)if(!n.extensions.find(o=>o.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(i.extensionsUsed)for(const s of i.extensionsUsed)n.extensions.find(o=>o.EXTENSION_NAME===s)||n.logger.warn(`Missing optional extension, "${s}".`)}}).read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const t=this.P(Ii.assertView(e));this.j(t);const n=t.json;if(n.buffers&&n.buffers.some(i=>function(s,o){return o.uri!==void 0&&!(o.uri in s.resources)}(t,i)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(i=>function(s,o){return o.uri!==void 0&&!(o.uri in s.resources)&&o.bufferView===void 0}(t,i)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Ii.assertView(e)))}async writeJSON(e,t={}){if(t.format===Hg.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return(class{static write(n,i){const s=n.getRoot(),o={asset:Jl({generator:"glTF-Transform v3.2.1"},s.getAsset()),extras:Jl({},s.getExtras())},l={json:o,resources:{}},h=new yd(n,l,i),d=i.logger||Rc.DEFAULT_INSTANCE,f=new Set(i.extensions.map(R=>R.EXTENSION_NAME)),v=n.getRoot().listExtensionsUsed().filter(R=>f.has(R.extensionName)),y=n.getRoot().listExtensionsRequired().filter(R=>f.has(R.extensionName));v.length<n.getRoot().listExtensionsUsed().length&&d.warn("Some extensions were not registered for I/O, and will not be written.");for(const R of v)for(const I of R.writeDependencies)R.install(I,i.dependencies[I]);function w(R,I,N,j){const H=[];let X=0;for(const pe of R){const Ae=h.createAccessorDef(pe);Ae.bufferView=o.bufferViews.length;const ve=pe.getArray(),Ee=Ii.pad(Ii.toView(ve));Ae.byteOffset=X,X+=Ee.byteLength,H.push(Ee),h.accessorIndexMap.set(pe,o.accessors.length),o.accessors.push(Ae)}const ne={buffer:I,byteOffset:N,byteLength:Ii.concat(H).byteLength};return j&&(ne.target=j),o.bufferViews.push(ne),{buffers:H,byteLength:X}}function E(R,I,N){const j=R[0].getCount();let H=0;for(const Ae of R){const ve=h.createAccessorDef(Ae);ve.bufferView=o.bufferViews.length,ve.byteOffset=H;const Ee=Ae.getElementSize(),xe=Ae.getComponentSize();H+=Ii.padNumber(Ee*xe),h.accessorIndexMap.set(Ae,o.accessors.length),o.accessors.push(ve)}const X=j*H,ne=new ArrayBuffer(X),pe=new DataView(ne);for(let Ae=0;Ae<j;Ae++){let ve=0;for(const Ee of R){const xe=Ee.getElementSize(),we=Ee.getComponentSize(),Re=Ee.getComponentType(),Be=Ee.getArray();for(let Oe=0;Oe<xe;Oe++){const at=Ae*H+ve+Oe*we,st=Be[Ae*xe+Oe];switch(Re){case Pn.ComponentType.FLOAT:pe.setFloat32(at,st,!0);break;case Pn.ComponentType.BYTE:pe.setInt8(at,st);break;case Pn.ComponentType.SHORT:pe.setInt16(at,st,!0);break;case Pn.ComponentType.UNSIGNED_BYTE:pe.setUint8(at,st);break;case Pn.ComponentType.UNSIGNED_SHORT:pe.setUint16(at,st,!0);break;case Pn.ComponentType.UNSIGNED_INT:pe.setUint32(at,st,!0);break;default:throw new Error("Unexpected component type: "+Re)}}ve+=Ii.padNumber(xe*we)}}return o.bufferViews.push({buffer:I,byteOffset:N,byteLength:X,byteStride:H,target:yd.BufferViewTarget.ARRAY_BUFFER}),{byteLength:X,buffers:[new Uint8Array(ne)]}}function M(R,I,N){const j=[];let H=0;const X=new Map;let ne=-1/0;for(const Re of R){const Be=h.createAccessorDef(Re);o.accessors.push(Be),h.accessorIndexMap.set(Re,o.accessors.length-1);const Oe=[],at=[],st=[],St=new Array(Re.getElementSize()).fill(0);for(let Bt=0,rn=Re.getCount();Bt<rn;Bt++)if(Re.getElement(Bt,st),!Hr.eq(st,St,0)){ne=Math.max(Bt,ne),Oe.push(Bt);for(let hn=0;hn<st.length;hn++)at.push(st[hn])}const dt=Oe.length,ht={accessorDef:Be,count:dt};if(X.set(Re,ht),dt===0)continue;if(dt>Re.getCount()/3){const Bt=(100*Oe.length/Re.getCount()).toFixed(1);d.warn(`Sparse accessor with many non-zero elements (${Bt}%) may increase file size.`)}const Nt=zx[Re.getComponentType()];ht.indices=Oe,ht.values=new Nt(at)}if(!Number.isFinite(ne))return{buffers:j,byteLength:H};const pe=ne<255?Uint8Array:ne<65535?Uint16Array:Uint32Array,Ae=ne<255?PD:ne<65535?ID:TD,ve={buffer:I,byteOffset:N+H,byteLength:0};for(const Re of R){const Be=X.get(Re);if(Be.count===0)continue;Be.indicesByteOffset=ve.byteLength;const Oe=Ii.pad(Ii.toView(new pe(Be.indices)));j.push(Oe),H+=Oe.byteLength,ve.byteLength+=Oe.byteLength}o.bufferViews.push(ve);const Ee=o.bufferViews.length-1,xe={buffer:I,byteOffset:N+H,byteLength:0};for(const Re of R){const Be=X.get(Re);if(Be.count===0)continue;Be.valuesByteOffset=xe.byteLength;const Oe=Ii.pad(Ii.toView(Be.values));j.push(Oe),H+=Oe.byteLength,xe.byteLength+=Oe.byteLength}o.bufferViews.push(xe);const we=o.bufferViews.length-1;for(const Re of R){const Be=X.get(Re);Be.count!==0&&(Be.accessorDef.sparse={count:Be.count,indices:{bufferView:Ee,byteOffset:Be.indicesByteOffset,componentType:Ae},values:{bufferView:we,byteOffset:Be.valuesByteOffset}})}return{buffers:j,byteLength:H}}const P=new Map;for(const R of n.getGraph().listEdges()){if(R.getParent()===s)continue;const I=R.getChild();if(I instanceof Pn){const N=P.get(I)||[];N.push(R),P.set(I,N)}}if(o.accessors=[],o.bufferViews=[],o.samplers=[],o.textures=[],o.images=s.listTextures().map((R,I)=>{const N=h.createPropertyDef(R);R.getMimeType()&&(N.mimeType=R.getMimeType());const j=R.getImage();return j&&h.createImageData(N,j,R),h.imageIndexMap.set(R,I),N}),v.filter(R=>R.prewriteTypes.includes(fn.ACCESSOR)).forEach(R=>R.prewrite(h,fn.ACCESSOR)),s.listAccessors().forEach(R=>{const I=h.accessorUsageGroupedByParent,N=h.accessorParents;if(h.accessorIndexMap.has(R))return;const j=P.get(R)||[],H=h.getAccessorUsage(R);if(h.addAccessorToUsageGroup(R,H),I.has(H)){const X=j[0].getParent(),ne=N.get(X)||new Set;ne.add(R),N.set(X,ne)}}),v.filter(R=>R.prewriteTypes.includes(fn.BUFFER)).forEach(R=>R.prewrite(h,fn.BUFFER)),(s.listAccessors().length>0||s.listTextures().length>0||h.otherBufferViews.size>0)&&s.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");o.buffers=[],s.listBuffers().forEach((R,I)=>{const N=h.createPropertyDef(R),j=h.accessorUsageGroupedByParent,H=h.accessorParents,X=R.listParents().filter(xe=>xe instanceof Pn),ne=new Set(X),pe=[],Ae=o.buffers.length;let ve=0;const Ee=h.listAccessorUsageGroups();for(const xe in Ee)if(j.has(xe))for(const we of Array.from(H.values())){const Re=Array.from(we).filter(Be=>ne.has(Be)).filter(Be=>h.getAccessorUsage(Be)===xe);if(Re.length)if(xe!==Xx.ARRAY_BUFFER||i.vertexLayout===Fx.INTERLEAVED){const Be=xe===Xx.ARRAY_BUFFER?E(Re,Ae,ve):w(Re,Ae,ve);ve+=Be.byteLength,pe.push(...Be.buffers)}else for(const Be of Re){const Oe=E([Be],Ae,ve);ve+=Oe.byteLength,pe.push(...Oe.buffers)}}else{const we=Ee[xe].filter(Oe=>ne.has(Oe));if(!we.length)continue;const Re=xe===Xx.ELEMENT_ARRAY_BUFFER?yd.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,Be=xe===Xx.SPARSE?M(we,Ae,ve):w(we,Ae,ve,Re);ve+=Be.byteLength,pe.push(...Be.buffers)}if(h.imageBufferViews.length&&I===0){for(let xe=0;xe<h.imageBufferViews.length;xe++)if(o.bufferViews[o.images[xe].bufferView].byteOffset=ve,ve+=h.imageBufferViews[xe].byteLength,pe.push(h.imageBufferViews[xe]),ve%8){const we=8-ve%8;ve+=we,pe.push(new Uint8Array(we))}}if(h.otherBufferViews.has(R))for(const xe of h.otherBufferViews.get(R))o.bufferViews.push({buffer:Ae,byteOffset:ve,byteLength:xe.byteLength}),h.otherBufferViewsIndexMap.set(xe,o.bufferViews.length-1),ve+=xe.byteLength,pe.push(xe);if(ve){let xe;i.format===Hg.GLB?xe="@glb.bin":(xe=h.bufferURIGenerator.createURI(R,"bin"),N.uri=xe),N.byteLength=ve,l.resources[xe]=Ii.concat(pe)}o.buffers.push(N),h.bufferIndexMap.set(R,I)}),s.listAccessors().find(R=>!R.getBuffer())&&d.warn("Skipped writing one or more Accessors: no Buffer assigned."),o.materials=s.listMaterials().map((R,I)=>{const N=h.createPropertyDef(R);if(R.getAlphaMode()!==qg.AlphaMode.OPAQUE&&(N.alphaMode=R.getAlphaMode()),R.getAlphaMode()===qg.AlphaMode.MASK&&(N.alphaCutoff=R.getAlphaCutoff()),R.getDoubleSided()&&(N.doubleSided=!0),N.pbrMetallicRoughness={},Hr.eq(R.getBaseColorFactor(),[1,1,1,1])||(N.pbrMetallicRoughness.baseColorFactor=R.getBaseColorFactor()),Hr.eq(R.getEmissiveFactor(),[0,0,0])||(N.emissiveFactor=R.getEmissiveFactor()),R.getRoughnessFactor()!==1&&(N.pbrMetallicRoughness.roughnessFactor=R.getRoughnessFactor()),R.getMetallicFactor()!==1&&(N.pbrMetallicRoughness.metallicFactor=R.getMetallicFactor()),R.getBaseColorTexture()){const j=R.getBaseColorTexture(),H=R.getBaseColorTextureInfo();N.pbrMetallicRoughness.baseColorTexture=h.createTextureInfoDef(j,H)}if(R.getEmissiveTexture()){const j=R.getEmissiveTexture(),H=R.getEmissiveTextureInfo();N.emissiveTexture=h.createTextureInfoDef(j,H)}if(R.getNormalTexture()){const j=R.getNormalTexture(),H=R.getNormalTextureInfo(),X=h.createTextureInfoDef(j,H);R.getNormalScale()!==1&&(X.scale=R.getNormalScale()),N.normalTexture=X}if(R.getOcclusionTexture()){const j=R.getOcclusionTexture(),H=R.getOcclusionTextureInfo(),X=h.createTextureInfoDef(j,H);R.getOcclusionStrength()!==1&&(X.strength=R.getOcclusionStrength()),N.occlusionTexture=X}if(R.getMetallicRoughnessTexture()){const j=R.getMetallicRoughnessTexture(),H=R.getMetallicRoughnessTextureInfo();N.pbrMetallicRoughness.metallicRoughnessTexture=h.createTextureInfoDef(j,H)}return h.materialIndexMap.set(R,I),N}),o.meshes=s.listMeshes().map((R,I)=>{const N=h.createPropertyDef(R);let j=null;return N.primitives=R.listPrimitives().map(H=>{const X={attributes:{}};X.mode=H.getMode();const ne=H.getMaterial();ne&&(X.material=h.materialIndexMap.get(ne)),Object.keys(H.getExtras()).length&&(X.extras=H.getExtras());const pe=H.getIndices();pe&&(X.indices=h.accessorIndexMap.get(pe));for(const Ae of H.listSemantics())X.attributes[Ae]=h.accessorIndexMap.get(H.getAttribute(Ae));for(const Ae of H.listTargets()){const ve={};for(const Ee of Ae.listSemantics())ve[Ee]=h.accessorIndexMap.get(Ae.getAttribute(Ee));X.targets=X.targets||[],X.targets.push(ve)}return H.listTargets().length&&!j&&(j=H.listTargets().map(Ae=>Ae.getName())),X}),R.getWeights().length&&(N.weights=R.getWeights()),j&&(N.extras=N.extras||{},N.extras.targetNames=j),h.meshIndexMap.set(R,I),N}),o.cameras=s.listCameras().map((R,I)=>{const N=h.createPropertyDef(R);if(N.type=R.getType(),N.type===Wg.Type.PERSPECTIVE){N.perspective={znear:R.getZNear(),zfar:R.getZFar(),yfov:R.getYFov()};const j=R.getAspectRatio();j!==null&&(N.perspective.aspectRatio=j)}else N.orthographic={znear:R.getZNear(),zfar:R.getZFar(),xmag:R.getXMag(),ymag:R.getYMag()};return h.cameraIndexMap.set(R,I),N}),o.nodes=s.listNodes().map((R,I)=>{const N=h.createPropertyDef(R);return Hr.eq(R.getTranslation(),[0,0,0])||(N.translation=R.getTranslation()),Hr.eq(R.getRotation(),[0,0,0,1])||(N.rotation=R.getRotation()),Hr.eq(R.getScale(),[1,1,1])||(N.scale=R.getScale()),R.getWeights().length&&(N.weights=R.getWeights()),h.nodeIndexMap.set(R,I),N}),o.skins=s.listSkins().map((R,I)=>{const N=h.createPropertyDef(R),j=R.getInverseBindMatrices();j&&(N.inverseBindMatrices=h.accessorIndexMap.get(j));const H=R.getSkeleton();return H&&(N.skeleton=h.nodeIndexMap.get(H)),N.joints=R.listJoints().map(X=>h.nodeIndexMap.get(X)),h.skinIndexMap.set(R,I),N}),s.listNodes().forEach((R,I)=>{const N=o.nodes[I],j=R.getMesh();j&&(N.mesh=h.meshIndexMap.get(j));const H=R.getCamera();H&&(N.camera=h.cameraIndexMap.get(H));const X=R.getSkin();X&&(N.skin=h.skinIndexMap.get(X)),R.listChildren().length>0&&(N.children=R.listChildren().map(ne=>h.nodeIndexMap.get(ne)))}),o.animations=s.listAnimations().map((R,I)=>{const N=h.createPropertyDef(R),j=new Map;return N.samplers=R.listSamplers().map((H,X)=>{const ne=h.createPropertyDef(H);return ne.input=h.accessorIndexMap.get(H.getInput()),ne.output=h.accessorIndexMap.get(H.getOutput()),ne.interpolation=H.getInterpolation(),j.set(H,X),ne}),N.channels=R.listChannels().map(H=>{const X=h.createPropertyDef(H);return X.sampler=j.get(H.getSampler()),X.target={node:h.nodeIndexMap.get(H.getTargetNode()),path:H.getTargetPath()},X}),h.animationIndexMap.set(R,I),N}),o.scenes=s.listScenes().map((R,I)=>{const N=h.createPropertyDef(R);return N.nodes=R.listChildren().map(j=>h.nodeIndexMap.get(j)),h.sceneIndexMap.set(R,I),N});const L=s.getDefaultScene();return L&&(o.scene=s.listScenes().indexOf(L)),o.extensionsUsed=v.map(R=>R.extensionName),o.extensionsRequired=y.map(R=>R.extensionName),v.forEach(R=>R.write(h)),function(R){const I=[];for(const N in R){const j=R[N];(Array.isArray(j)&&j.length===0||j===null||j===""||j&&typeof j=="object"&&Object.keys(j).length===0)&&I.push(N)}for(const N of I)delete R[N]}(o),l}}).write(e,{format:t.format||Hg.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.U,dependencies:Jl({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:Hg.GLB}),i=new Uint32Array([1179937895,2,12]),s=JSON.stringify(t),o=Ii.pad(Ii.encodeText(s),32),l=Ii.toView(new Uint32Array([o.byteLength,1313821514])),h=Ii.concat([l,o]);i[i.length-1]+=h.byteLength;const d=Object.values(n)[0];if(!d||!d.byteLength)return Ii.concat([Ii.toView(i),h]);const f=Ii.pad(d,0),v=Ii.toView(new Uint32Array([f.byteLength,5130562])),y=Ii.concat([v,f]);return i[i.length-1]+=y.byteLength,Ii.concat([Ii.toView(i),h,y])}async L(e,t){var n=this;const i=[...e.json.images||[],...e.json.buffers||[]].map(async function(s){const o=s.uri;if(!o||o.match(/data:/))return Promise.resolve();e.resources[o]=await n.readURI(n.resolve(t,o),"view"),n.lastReadBytes+=e.resources[o].byteLength});await Promise.all(i)}j(e){function t(n){if(n.uri){if(n.uri in e.resources)Ii.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const i=`__${function(){for(let s=0;s<999;s++){const o=wD();if(!TC.has(o))return TC.add(o),o}return""}()}.${n0.extension(n.uri)}`;e.resources[i]=Ii.createBufferFromDataURI(n.uri),n.uri=i}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(n)}),(e.json.buffers||[]).forEach(t)}D(e){const{images:t,buffers:n}=e.json;return e={json:Jl({},e.json),resources:Jl({},e.resources)},t&&(e.json.images=t.map(i=>Jl({},i))),n&&(e.json.buffers=n.map(i=>Jl({},i))),e}P(e){if(!FC(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==Yx.JSON)throw new Error("Missing required GLB JSON chunk.");const n=t[0],i=Ii.decodeText(Ii.toView(e,20,n)),s=JSON.parse(i),o=20+n;if(e.byteLength<=o)return{json:s,resources:{}};const l=new Uint32Array(e.buffer,e.byteOffset+o,2);if(l[1]!==Yx.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:s,resources:{"@glb.bin":Ii.toView(e,o+8,l[0])}}}}function FC(a){if(a.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(a.buffer,a.byteOffset,3);return e[0]===1179937895&&e[1]===2}class DD extends RD{constructor(e=uA.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,t){const n=await fetch(e,this.k);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return uA.resolve(e,t)}dirname(e){return uA.dirname(e)}}const BD=64;class LD{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class dA{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const gl=[171,75,84,88,32,50,48,187,13,10,26,10];function zC(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}function hS(a){const e=new Uint8Array(a.buffer,a.byteOffset,gl.length);if(e[0]!==gl[0]||e[1]!==gl[1]||e[2]!==gl[2]||e[3]!==gl[3]||e[4]!==gl[4]||e[5]!==gl[5]||e[6]!==gl[6]||e[7]!==gl[7]||e[8]!==gl[8]||e[9]!==gl[9]||e[10]!==gl[10]||e[11]!==gl[11])throw new Error("Missing KTX 2.0 identifier.");const t=new LD,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new dA(a,gl.length,n,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32();const s=i._nextUint32();t.supercompressionScheme=i._nextUint32();const o=i._nextUint32(),l=i._nextUint32(),h=i._nextUint32(),d=i._nextUint32(),f=i._nextUint64(),v=i._nextUint64(),y=3*s*8,w=new dA(a,gl.length+n,y,!0);for(let at=0;at<s;at++)t.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+w._nextUint64(),w._nextUint64()),uncompressedByteLength:w._nextUint64()});const E=new dA(a,o,l,!0),M={vendorId:E._skip(4)._nextUint16(),descriptorType:E._nextUint16(),versionNumber:E._nextUint16(),descriptorBlockSize:E._nextUint16(),colorModel:E._nextUint8(),colorPrimaries:E._nextUint8(),transferFunction:E._nextUint8(),flags:E._nextUint8(),texelBlockDimension:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],bytesPlane:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],samples:[]},P=(M.descriptorBlockSize/4-6)/4;for(let at=0;at<P;at++){const st={bitOffset:E._nextUint16(),bitLength:E._nextUint8(),channelType:E._nextUint8(),samplePosition:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};st.channelType&BD?(st.sampleLower=E._nextInt32(),st.sampleUpper=E._nextInt32()):(st.sampleLower=E._nextUint32(),st.sampleUpper=E._nextUint32()),M.samples[at]=st}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(M);const L=new dA(a,h,d,!0);for(;L._offset<d;){const at=L._nextUint32(),st=L._scan(at),St=zC(st),dt=L._scan(at-st.byteLength);t.keyValue[St]=St.match(/^ktx/i)?zC(dt):dt,L._offset%4&&L._skip(4-L._offset%4)}if(v<=0)return t;const R=new dA(a,f,v,!0),I=R._nextUint16(),N=R._nextUint16(),j=R._nextUint32(),H=R._nextUint32(),X=R._nextUint32(),ne=R._nextUint32(),pe=[];for(let at=0;at<s;at++)pe.push({imageFlags:R._nextUint32(),rgbSliceByteOffset:R._nextUint32(),rgbSliceByteLength:R._nextUint32(),alphaSliceByteOffset:R._nextUint32(),alphaSliceByteLength:R._nextUint32()});const Ae=f+R._offset,ve=Ae+j,Ee=ve+H,xe=Ee+X,we=new Uint8Array(a.buffer,a.byteOffset+Ae,j),Re=new Uint8Array(a.buffer,a.byteOffset+ve,H),Be=new Uint8Array(a.buffer,a.byteOffset+Ee,X),Oe=new Uint8Array(a.buffer,a.byteOffset+xe,ne);return t.globalData={endpointCount:I,selectorCount:N,imageDescs:pe,endpointsData:we,selectorsData:Re,tablesData:Be,extendedData:Oe},t}class jC extends Ps{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[fn.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}jC.EXTENSION_NAME="EXT_mesh_gpu_instancing";const Yg="EXT_mesh_gpu_instancing";class VC extends es{constructor(...e){super(...e),this.extensionName=Yg,this.provideTypes=[fn.NODE],this.prewriteTypes=[fn.ACCESSOR]}createInstancedMesh(){return new jC(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,n)=>{if(!t.extensions||!t.extensions[Yg])return;const i=t.extensions[Yg],s=this.createInstancedMesh();for(const o in i.attributes)s.setAttribute(o,e.accessors[i.attributes[o]]);e.nodes[n].setExtension(Yg,s)}),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const i=n.getExtension(Yg);if(i){const s=e.nodeIndexMap.get(n),o=t.json.nodes[s],l={attributes:{}};i.listSemantics().forEach(h=>{const d=i.getAttribute(h);l.attributes[h]=e.accessorIndexMap.get(d)}),o.extensions=o.extensions||{},o.extensions[Yg]=l}}),this}}function bm(){return(bm=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a}).apply(this,arguments)}var pA,s0,Gs;VC.EXTENSION_NAME=Yg,function(a){a.QUANTIZE="quantize",a.FILTER="filter"}(pA||(pA={})),function(a){a.ATTRIBUTES="ATTRIBUTES",a.TRIANGLES="TRIANGLES",a.INDICES="INDICES"}(s0||(s0={})),function(a){a.NONE="NONE",a.OCTAHEDRAL="OCTAHEDRAL",a.QUATERNION="QUATERNION",a.EXPONENTIAL="EXPONENTIAL"}(Gs||(Gs={}));const{BYTE:OD,SHORT:GC,FLOAT:kD}=Pn.ComponentType,{encodeNormalizedInt:HC,decodeNormalizedInt:dS}=Hr;function UD(a,e,t,n){const{filter:i,bits:s}=n,o={array:a.getArray(),byteStride:a.getElementSize()*a.getComponentSize(),componentType:a.getComponentType(),normalized:a.getNormalized()};if(t!==s0.ATTRIBUTES)return o;if(i!==Gs.NONE){let l=a.getNormalized()?function(h){const d=h.getComponentType(),f=h.getArray(),v=new Float32Array(f.length);for(let y=0;y<f.length;y++)v[y]=dS(f[y],d);return v}(a):new Float32Array(o.array);switch(i){case Gs.EXPONENTIAL:o.byteStride=4*a.getElementSize(),o.componentType=kD,o.normalized=!1,o.array=e.encodeFilterExp(l,a.getCount(),o.byteStride,s);break;case Gs.OCTAHEDRAL:o.byteStride=s>8?8:4,o.componentType=s>8?GC:OD,o.normalized=!0,l=a.getElementSize()===3?function(h){const d=new Float32Array(4*h.length/3);for(let f=0,v=h.length/3;f<v;f++)d[4*f]=h[3*f],d[4*f+1]=h[3*f+1],d[4*f+2]=h[3*f+2];return d}(l):l,o.array=e.encodeFilterOct(l,a.getCount(),o.byteStride,s);break;case Gs.QUATERNION:o.byteStride=8,o.componentType=GC,o.normalized=!0,o.array=e.encodeFilterQuat(l,a.getCount(),o.byteStride,s);break;default:throw new Error("Invalid filter.")}o.min=a.getMin([]),o.max=a.getMax([]),a.getNormalized()&&(o.min=o.min.map(h=>dS(h,a.getComponentType())),o.max=o.max.map(h=>dS(h,a.getComponentType()))),o.normalized&&(o.min=o.min.map(h=>HC(h,o.componentType)),o.max=o.max.map(h=>HC(h,o.componentType)))}else o.byteStride%4&&(o.array=function(l,h){const d=Ii.padNumber(l.BYTES_PER_ELEMENT*h)/l.BYTES_PER_ELEMENT,f=new l.constructor(l.length/h*d);for(let v=0;v*h<l.length;v++)for(let y=0;y<h;y++)f[v*d+y]=l[v*h+y];return f}(o.array,a.getElementSize()),o.byteStride=o.array.byteLength/a.getCount());return o}function ND(a,e){return e===yd.BufferViewUsage.ELEMENT_ARRAY_BUFFER?a.listParents().some(t=>t instanceof Xg&&t.getMode()===Xg.Mode.TRIANGLES)?s0.TRIANGLES:s0.INDICES:s0.ATTRIBUTES}function FD(a,e){const t=e.getGraph().listParentEdges(a).filter(n=>!(n.getParent()instanceof kC));for(const n of t){const i=n.getName(),s=n.getAttributes().key||"";if(i==="indices")return{filter:Gs.NONE};if(i==="attributes"){if(s==="POSITION")return{filter:Gs.NONE};if(s==="TEXCOORD_0")return{filter:Gs.NONE};if(s==="NORMAL")return{filter:Gs.OCTAHEDRAL,bits:8};if(s==="TANGENT")return{filter:Gs.OCTAHEDRAL,bits:8};if(s.startsWith("JOINTS_"))return{filter:Gs.NONE};if(s.startsWith("WEIGHTS_"))return{filter:Gs.NONE}}if(i==="output"){const o=QC(a);return o==="rotation"?{filter:Gs.QUATERNION,bits:16}:o==="translation"||o==="scale"?{filter:Gs.EXPONENTIAL,bits:12}:{filter:Gs.NONE}}if(i==="input")return{filter:Gs.NONE};if(i==="inverseBindMatrices")return{filter:Gs.NONE}}return{filter:Gs.NONE}}function QC(a){for(const e of a.listParents())if(e instanceof i0){for(const t of e.listParents())if(t instanceof uS)return t.getTargetPath()}return null}const vl="EXT_meshopt_compression",WC={method:pA.QUANTIZE};class pS extends es{constructor(...e){super(...e),this.extensionName=vl,this.prereadTypes=[fn.BUFFER,fn.PRIMITIVE],this.prewriteTypes=[fn.BUFFER,fn.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=WC,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=bm({},WC,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${vl}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${vl}]: Missing WASM support.`)}return t===fn.BUFFER?this._prereadBuffers(e):t===fn.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,i)=>{if(!n.extensions||!n.extensions[vl])return;const s=n.extensions[vl],o=s.byteOffset||0,l=s.byteLength||0,h=s.count,d=s.byteStride,f=new Uint8Array(h*d),v=t.json.buffers[s.buffer],y=Ii.toView(v.uri?t.resources[v.uri]:t.resources[wC],o,l);this._decoder.decodeGltfBuffer(f,h,d,y,s.mode,s.filter),e.bufferViews[i]=f})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{var i;n.extensions&&n.extensions[vl]&&(i=t.json.buffers[n.buffer]).extensions&&i.extensions.EXT_meshopt_compression&&i.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[vl].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const i of t.listParents())i instanceof Pn&&i.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===fn.ACCESSOR?this._prewriteAccessors(e):t===fn.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,i=this._encoderOptions,s=this.document.createBuffer(),o=this.document.getRoot().listBuffers().indexOf(s);this._encoderFallbackBuffer=s,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const l of this.document.getRoot().listAccessors()){if(QC(l)==="weights"||l.getSparse())continue;const h=e.getAccessorUsage(l),d=ND(l,h),f=i.method===pA.FILTER?FD(l,this.document):{filter:Gs.NONE},v=UD(l,n,d,f),{array:y,byteStride:w}=v,E=l.getBuffer();if(!E)throw new Error(`${vl}: Missing buffer for accessor.`);const M=this.document.getRoot().listBuffers().indexOf(E),P=[h,d,f.filter,w,M].join(":");let L=this._encoderBufferViews[P],R=this._encoderBufferViewData[P],I=this._encoderBufferViewAccessors[P];L&&R||(I=this._encoderBufferViewAccessors[P]=[],R=this._encoderBufferViewData[P]=[],L=this._encoderBufferViews[P]={buffer:o,target:yd.USAGE_TO_TARGET[h],byteOffset:0,byteLength:0,byteStride:h===yd.BufferViewUsage.ARRAY_BUFFER?w:void 0,extensions:{[vl]:{buffer:M,byteOffset:0,byteLength:0,mode:d,filter:f.filter!==Gs.NONE?f.filter:void 0,byteStride:w,count:0}}});const N=e.createAccessorDef(l);N.componentType=v.componentType,N.normalized=v.normalized,N.byteOffset=L.byteLength,N.min&&v.min&&(N.min=v.min),N.max&&v.max&&(N.max=v.max),e.accessorIndexMap.set(l,t.accessors.length),t.accessors.push(N),I.push(N),R.push(new Uint8Array(y.buffer,y.byteOffset,y.byteLength)),L.byteLength+=y.byteLength,L.extensions.EXT_meshopt_compression.count+=l.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const i=this._encoderBufferViews[n],s=this._encoderBufferViewData[n],o=this.document.getRoot().listBuffers()[i.extensions[vl].buffer],l=e.otherBufferViews.get(o)||[],{count:h,byteStride:d,mode:f}=i.extensions[vl],v=Ii.concat(s),y=t.encodeGltfBuffer(v,h,d,f),w=Ii.pad(y);i.extensions[vl].byteLength=y.byteLength,s.length=0,s.push(w),l.push(w),e.otherBufferViews.set(o,l)}}write(e){let t=0;for(const o in this._encoderBufferViews){const l=this._encoderBufferViews[o],h=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[o][0]),d=this._encoderBufferViewAccessors[o];for(const y of d)y.bufferView=h;const f=e.jsonDoc.json.bufferViews[h],v=f.byteOffset||0;Object.assign(f,l),f.byteOffset=t,f.extensions[vl].byteOffset=v,t+=Ii.padNumber(l.byteLength)}const n=this._encoderFallbackBuffer,i=e.bufferIndexMap.get(n),s=e.jsonDoc.json.buffers[i];return s.byteLength=t,s.extensions={[vl]:{fallback:!0}},n.dispose(),this}}pS.EXTENSION_NAME=vl,pS.EncoderMethod=pA;const fA="EXT_texture_avif";class zD{match(e){return e.length>=12&&Ii.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=XC(t,0);if(!n)return null;let i=n.end;for(;n=XC(t,i);)if(n.type==="meta")i=n.start+4;else if(n.type==="iprp"||n.type==="ipco")i=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;i=n.end}return null}getChannels(e){return 4}}class qC extends es{constructor(...e){super(...e),this.extensionName=fA,this.prereadTypes=[fn.TEXTURE]}static register(){_d.registerFormat("image/avif",new zD)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[fA]&&(t.source=t.extensions[fA].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(s=>{s.source===i&&(s.extensions=s.extensions||{},s.extensions[fA]={source:s.source},delete s.source)})}}),this}}function XC(a,e){if(a.byteLength<4+e)return null;const t=a.getUint32(e);return a.byteLength<t+e||t<8?null:{type:Ii.decodeText(new Uint8Array(a.buffer,a.byteOffset+e+4,4)),start:e+8,end:e+t}}qC.EXTENSION_NAME=fA;const mA="EXT_texture_webp";class jD{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Ii.decodeText(e.slice(0,4)),n=Ii.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const i=new DataView(e.buffer,e.byteOffset);let s=12;for(;s<i.byteLength;){const o=Ii.decodeText(new Uint8Array([i.getUint8(s),i.getUint8(s+1),i.getUint8(s+2),i.getUint8(s+3)])),l=i.getUint32(s+4,!0);if(o==="VP8 ")return[16383&i.getInt16(s+14,!0),16383&i.getInt16(s+16,!0)];if(o==="VP8L"){const h=i.getUint8(s+9),d=i.getUint8(s+10),f=i.getUint8(s+11);return[1+((63&d)<<8|h),1+((15&i.getUint8(s+12))<<10|f<<2|(192&d)>>6)]}s+=8+l+l%2}return null}getChannels(e){return 4}}class YC extends es{constructor(...e){super(...e),this.extensionName=mA,this.prereadTypes=[fn.TEXTURE]}static register(){_d.registerFormat("image/webp",new jD)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[mA]&&(t.source=t.extensions[mA].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(s=>{s.source===i&&(s.extensions=s.extensions||{},s.extensions[mA]={source:s.source},delete s.source)})}}),this}}YC.EXTENSION_NAME=mA;const KC="KHR_draco_mesh_compression";let Pa,JC,ZC,Zl;function VD(a,e){const t=new Pa.DecoderBuffer;try{if(t.Init(e,e.length),a.GetEncodedGeometryType(t)!==Pa.TRIANGULAR_MESH)throw new Error(`[${KC}] Unknown geometry type.`);const n=new Pa.Mesh;if(!a.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${KC}] Decoding failure.`);return n}finally{Pa.destroy(t)}}function GD(a,e){const t=3*e.num_faces();let n,i;if(e.num_points()<=65534){const s=t*Uint16Array.BYTES_PER_ELEMENT;n=Pa._malloc(s),a.GetTrianglesUInt16Array(e,s,n),i=new Uint16Array(Pa.HEAPU16.buffer,n,t).slice()}else{const s=t*Uint32Array.BYTES_PER_ELEMENT;n=Pa._malloc(s),a.GetTrianglesUInt32Array(e,s,n),i=new Uint32Array(Pa.HEAPU32.buffer,n,t).slice()}return Pa._free(n),i}function HD(a,e,t,n){const i=ZC[n.componentType],s=JC[n.componentType],o=t.num_components(),l=e.num_points()*o,h=l*s.BYTES_PER_ELEMENT,d=Pa._malloc(h);a.GetAttributeDataArrayForAllPoints(e,t,i,h,d);const f=new s(Pa.HEAPF32.buffer,d,l).slice();return Pa._free(d),f}var gA,lu;(function(a){a[a.EDGEBREAKER=1]="EDGEBREAKER",a[a.SEQUENTIAL=0]="SEQUENTIAL"})(gA||(gA={})),function(a){a.POSITION="POSITION",a.NORMAL="NORMAL",a.COLOR="COLOR",a.TEX_COORD="TEX_COORD",a.GENERIC="GENERIC"}(lu||(lu={}));const $C={[lu.POSITION]:14,[lu.NORMAL]:10,[lu.COLOR]:8,[lu.TEX_COORD]:12,[lu.GENERIC]:12},eT={decodeSpeed:5,encodeSpeed:5,method:gA.EDGEBREAKER,quantizationBits:$C,quantizationVolume:"mesh"};function QD(a,e=eT){const t=bm({},eT,e);t.quantizationBits=bm({},$C,e.quantizationBits);const n=new Zl.Encoder,i=new Zl.MeshBuilder,s=new Zl.Mesh,o={},l=new Zl.DracoInt8Array,h=a.listTargets().length>0;let d=!1;for(const P of a.listSemantics()){const L=a.getAttribute(P);if(L.getSparse()){d=!0;continue}const R=WD(P),I=qD(i,L.getComponentType(),s,Zl[R],L.getCount(),L.getElementSize(),L.getArray());if(I===-1)throw new Error(`Error compressing "${P}" attribute.`);if(o[P]=I,t.quantizationVolume==="mesh"||P!=="POSITION")n.SetAttributeQuantization(Zl[R],t.quantizationBits[R]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:N}=t,j=Math.max(N.max[0]-N.min[0],N.max[1]-N.min[1],N.max[2]-N.min[2]);n.SetAttributeExplicitQuantization(Zl[R],t.quantizationBits[R],L.getElementSize(),N.min,j)}}}const f=a.getIndices();if(!f)throw new Kx("Primitive must have indices.");i.AddFacesToMesh(s,f.getCount()/3,f.getArray()),n.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),n.SetTrackEncodedProperties(!0),n.SetEncodingMethod(t.method===gA.SEQUENTIAL||h||d?Zl.MESH_SEQUENTIAL_ENCODING:Zl.MESH_EDGEBREAKER_ENCODING);const v=n.EncodeMeshToDracoBuffer(s,l);if(v<=0)throw new Kx("Error applying Draco compression.");const y=new Uint8Array(v);for(let P=0;P<v;++P)y[P]=l.GetValue(P);const w=a.getAttribute("POSITION").getCount(),E=n.GetNumberOfEncodedPoints(),M=3*n.GetNumberOfEncodedFaces();if((h||d)&&E!==w)throw new Kx('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return Zl.destroy(l),Zl.destroy(s),Zl.destroy(i),Zl.destroy(n),{numVertices:E,numIndices:M,data:y,attributeIDs:o}}function WD(a){return a==="POSITION"?lu.POSITION:a==="NORMAL"?lu.NORMAL:a.startsWith("COLOR_")?lu.COLOR:a.startsWith("TEXCOORD_")?lu.TEX_COORD:lu.GENERIC}function qD(a,e,t,n,i,s,o){switch(e){case Pn.ComponentType.UNSIGNED_BYTE:return a.AddUInt8Attribute(t,n,i,s,o);case Pn.ComponentType.BYTE:return a.AddInt8Attribute(t,n,i,s,o);case Pn.ComponentType.UNSIGNED_SHORT:return a.AddUInt16Attribute(t,n,i,s,o);case Pn.ComponentType.SHORT:return a.AddInt16Attribute(t,n,i,s,o);case Pn.ComponentType.UNSIGNED_INT:return a.AddUInt32Attribute(t,n,i,s,o);case Pn.ComponentType.FLOAT:return a.AddFloatAttribute(t,n,i,s,o);default:throw new Error(`Unexpected component type, "${e}".`)}}class Kx extends Error{}const Hs="KHR_draco_mesh_compression";class vA extends es{constructor(...e){super(...e),this.extensionName=Hs,this.prereadTypes=[fn.PRIMITIVE],this.prewriteTypes=[fn.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,Pa=this._decoderModule,JC={[Pn.ComponentType.FLOAT]:Float32Array,[Pn.ComponentType.UNSIGNED_INT]:Uint32Array,[Pn.ComponentType.UNSIGNED_SHORT]:Uint16Array,[Pn.ComponentType.UNSIGNED_BYTE]:Uint8Array,[Pn.ComponentType.SHORT]:Int16Array,[Pn.ComponentType.BYTE]:Int8Array},ZC={[Pn.ComponentType.FLOAT]:Pa.DT_FLOAT32,[Pn.ComponentType.UNSIGNED_INT]:Pa.DT_UINT32,[Pn.ComponentType.UNSIGNED_SHORT]:Pa.DT_UINT16,[Pn.ComponentType.UNSIGNED_BYTE]:Pa.DT_UINT8,[Pn.ComponentType.SHORT]:Pa.DT_INT16,[Pn.ComponentType.BYTE]:Pa.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,Zl=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Hs}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,i=new Map;try{const s=n.json.meshes||[];for(const o of s)for(const l of o.primitives){if(!l.extensions||!l.extensions[Hs])continue;const h=l.extensions[Hs];let[d,f]=i.get(h.bufferView)||[];if(!f||!d){const v=n.json.bufferViews[h.bufferView],y=n.json.buffers[v.buffer],w=Ii.toView(y.uri?n.resources[y.uri]:n.resources[wC],v.byteOffset||0,v.byteLength);d=new this._decoderModule.Decoder,f=VD(d,w),i.set(h.bufferView,[d,f]),t.debug(`[${Hs}] Decompressed ${w.byteLength} bytes.`)}for(const v in l.attributes){const y=e.jsonDoc.json.accessors[l.attributes[v]],w=d.GetAttributeByUniqueId(f,h.attributes[v]),E=HD(d,f,w,y);e.accessors[l.attributes[v]].setArray(E)}l.indices!==void 0&&e.accessors[l.indices].setArray(GD(d,f))}}finally{for(const[s,o]of Array.from(i.values()))this._decoderModule.destroy(s),this._decoderModule.destroy(o)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Hs}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Hs}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const i=function(l){const h=l.getLogger(),d=new Set,f=new Set;for(const P of l.getRoot().listMeshes())for(const L of P.listPrimitives())L.getIndices()?L.getMode()!==Xg.Mode.TRIANGLES?(f.add(L),h.warn(`[${Hs}] Skipping Draco compression on non-TRIANGLES primitive.`)):d.add(L):(f.add(L),h.warn(`[${Hs}] Skipping Draco compression on non-indexed primitive.`));const v=l.getRoot().listAccessors(),y=new Map;for(let P=0;P<v.length;P++)y.set(v[P],P);const w=new Map,E=new Set,M=new Map;for(const P of Array.from(d)){let L=tT(P,y);if(E.has(L))M.set(P,L);else{if(w.has(P.getIndices())){const R=P.getIndices(),I=R.clone();y.set(I,l.getRoot().listAccessors().length-1),P.swap(R,I)}for(const R of P.listAttributes())if(w.has(R)){const I=R.clone();y.set(I,l.getRoot().listAccessors().length-1),P.swap(R,I)}L=tT(P,y),E.add(L),M.set(P,L),w.set(P.getIndices(),L);for(const R of P.listAttributes())w.set(R,L)}}for(const P of Array.from(w.keys())){const L=new Set(P.listParents().map(R=>R.propertyType));if(L.size!==2||!L.has(fn.PRIMITIVE)||!L.has(fn.ROOT))throw new Error(`[${Hs}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const P of Array.from(d)){const L=M.get(P),R=P.getIndices();if(w.get(R)!==L||P.listAttributes().some(I=>w.get(I)!==L))throw new Error(`[${Hs}] Draco primitives must share all, or no, accessors.`)}for(const P of Array.from(f)){const L=P.getIndices();if(w.has(L)||P.listAttributes().some(R=>w.has(R)))throw new Error(`[${Hs}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return M}(this.document),s=new Map;let o="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Hs}]: quantizationVolume=scene requires exactly 1 scene.`):o=function(l){const h={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},d=l.propertyType===fn.NODE?[l]:l.listChildren();for(const f of d)f.traverse(v=>{const y=v.getMesh();if(!y)return;const w=vD(y,v.getWorldMatrix());lS(w.min,h),lS(w.max,h)});return h}(this.document.getRoot().listScenes().pop()));for(const l of Array.from(i.keys())){const h=i.get(l);if(!h)throw new Error("Unexpected primitive.");if(s.has(h)){s.set(h,s.get(h));continue}const d=l.getIndices(),f=e.jsonDoc.json.accessors;let v;try{v=QD(l,bm({},this._encoderOptions,{quantizationVolume:o}))}catch(E){if(E instanceof Kx){n.warn(`[${Hs}]: ${E.message} Skipping primitive compression.`);continue}throw E}s.set(h,v);const y=e.createAccessorDef(d);y.count=v.numIndices,e.accessorIndexMap.set(d,f.length),f.push(y);for(const E of l.listSemantics()){const M=l.getAttribute(E);if(v.attributeIDs[E]===void 0)continue;const P=e.createAccessorDef(M);P.count=v.numVertices,e.accessorIndexMap.set(M,f.length),f.push(P)}const w=l.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(w)||e.otherBufferViews.set(w,[]),e.otherBufferViews.get(w).push(v.data)}return n.debug(`[${Hs}] Compressed ${i.size} primitives.`),e.extensionData[Hs]={primitiveHashMap:i,primitiveEncodingMap:s},this}write(e){const t=e.extensionData[Hs];for(const n of this.document.getRoot().listMeshes()){const i=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let s=0;s<n.listPrimitives().length;s++){const o=n.listPrimitives()[s],l=i.primitives[s],h=t.primitiveHashMap.get(o);if(!h)continue;const d=t.primitiveEncodingMap.get(h);d&&(l.extensions=l.extensions||{},l.extensions[Hs]={bufferView:e.otherBufferViewsIndexMap.get(d.data),attributes:d.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(i=>i!==Hs),n.extensionsRequired=(n.extensionsRequired||[]).filter(i=>i!==Hs)}return this}}function tT(a,e){const t=[],n=a.getIndices();t.push(e.get(n));for(const i of a.listAttributes())t.push(e.get(i));return t.sort().join("|")}vA.EXTENSION_NAME=Hs,vA.EncoderMethod=gA;class a0 extends Ps{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[fn.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:a0.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Kl.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return Kl.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}a0.EXTENSION_NAME="KHR_lights_punctual",a0.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const Ad="KHR_lights_punctual";class nT extends es{constructor(...e){super(...e),this.extensionName=Ad}createLight(e=""){return new a0(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Ad])return this;const n=(t.json.extensions[Ad].lights||[]).map(i=>{var s,o;const l=this.createLight().setName(i.name||"").setType(i.type);return i.color!==void 0&&l.setColor(i.color),i.intensity!==void 0&&l.setIntensity(i.intensity),i.range!==void 0&&l.setRange(i.range),((s=i.spot)==null?void 0:s.innerConeAngle)!==void 0&&l.setInnerConeAngle(i.spot.innerConeAngle),((o=i.spot)==null?void 0:o.outerConeAngle)!==void 0&&l.setOuterConeAngle(i.spot.outerConeAngle),l});return t.json.nodes.forEach((i,s)=>{i.extensions&&i.extensions[Ad]&&e.nodes[s].setExtension(Ad,n[i.extensions[Ad].light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],i=new Map;for(const s of this.properties){const o=s,l={type:o.getType()};Hr.eq(o.getColor(),[1,1,1])||(l.color=o.getColor()),o.getIntensity()!==1&&(l.intensity=o.getIntensity()),o.getRange()!=null&&(l.range=o.getRange()),o.getName()&&(l.name=o.getName()),o.getType()===a0.Type.SPOT&&(l.spot={innerConeAngle:o.getInnerConeAngle(),outerConeAngle:o.getOuterConeAngle()}),n.push(l),i.set(o,n.length-1)}return this.document.getRoot().listNodes().forEach(s=>{const o=s.getExtension(Ad);if(o){const l=e.nodeIndexMap.get(s),h=t.json.nodes[l];h.extensions=h.extensions||{},h.extensions[Ad]={light:i.get(o)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[Ad]={lights:n},this}}nT.EXTENSION_NAME=Ad;const{R:XD,G:YD}=As;class iT extends Ps{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Qr(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:XD|YD})}}iT.EXTENSION_NAME="KHR_materials_anisotropy";const Kg="KHR_materials_anisotropy";class rT extends es{constructor(...e){super(...e),this.extensionName=Kg}createAnisotropy(){return new iT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[Kg]){const o=this.createAnisotropy();e.materials[s].setExtension(Kg,o);const l=i.extensions[Kg];if(l.anisotropyStrength!==void 0&&o.setAnisotropyStrength(l.anisotropyStrength),l.anisotropyRotation!==void 0&&o.setAnisotropyRotation(l.anisotropyRotation),l.anisotropyTexture!==void 0){const h=l.anisotropyTexture;o.setAnisotropyTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getAnisotropyTextureInfo(),h)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Kg);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Kg]={};if(i.getAnisotropyStrength()>0&&(l.anisotropyStrength=i.getAnisotropyStrength()),i.getAnisotropyRotation()!==0&&(l.anisotropyRotation=i.getAnisotropyRotation()),i.getAnisotropyTexture()){const h=i.getAnisotropyTexture(),d=i.getAnisotropyTextureInfo();l.anisotropyTexture=e.createTextureInfoDef(h,d)}}}),this}}rT.EXTENSION_NAME=Kg;const{R:sT,G:aT,B:KD}=As;class oT extends Ps{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Qr(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Qr(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Qr(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:sT})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:aT})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:sT|aT|KD})}}oT.EXTENSION_NAME="KHR_materials_clearcoat";const Jg="KHR_materials_clearcoat";class lT extends es{constructor(...e){super(...e),this.extensionName=Jg}createClearcoat(){return new oT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[Jg]){const o=this.createClearcoat();e.materials[s].setExtension(Jg,o);const l=i.extensions[Jg];if(l.clearcoatFactor!==void 0&&o.setClearcoatFactor(l.clearcoatFactor),l.clearcoatRoughnessFactor!==void 0&&o.setClearcoatRoughnessFactor(l.clearcoatRoughnessFactor),l.clearcoatTexture!==void 0){const h=l.clearcoatTexture;o.setClearcoatTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getClearcoatTextureInfo(),h)}if(l.clearcoatRoughnessTexture!==void 0){const h=l.clearcoatRoughnessTexture;o.setClearcoatRoughnessTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getClearcoatRoughnessTextureInfo(),h)}if(l.clearcoatNormalTexture!==void 0){const h=l.clearcoatNormalTexture;o.setClearcoatNormalTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getClearcoatNormalTextureInfo(),h),h.scale!==void 0&&o.setClearcoatNormalScale(h.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Jg);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Jg]={clearcoatFactor:i.getClearcoatFactor(),clearcoatRoughnessFactor:i.getClearcoatRoughnessFactor()};if(i.getClearcoatTexture()){const h=i.getClearcoatTexture(),d=i.getClearcoatTextureInfo();l.clearcoatTexture=e.createTextureInfoDef(h,d)}if(i.getClearcoatRoughnessTexture()){const h=i.getClearcoatRoughnessTexture(),d=i.getClearcoatRoughnessTextureInfo();l.clearcoatRoughnessTexture=e.createTextureInfoDef(h,d)}if(i.getClearcoatNormalTexture()){const h=i.getClearcoatNormalTexture(),d=i.getClearcoatNormalTextureInfo();l.clearcoatNormalTexture=e.createTextureInfoDef(h,d),i.getClearcoatNormalScale()!==1&&(l.clearcoatNormalTexture.scale=i.getClearcoatNormalScale())}}}),this}}lT.EXTENSION_NAME=Jg;class cT extends Ps{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}cT.EXTENSION_NAME="KHR_materials_emissive_strength";const Zg="KHR_materials_emissive_strength";class uT extends es{constructor(...e){super(...e),this.extensionName=Zg}createEmissiveStrength(){return new cT(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Zg]){const i=this.createEmissiveStrength();e.materials[n].setExtension(Zg,i);const s=t.extensions[Zg];s.emissiveStrength!==void 0&&i.setEmissiveStrength(s.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Zg);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[Zg]={emissiveStrength:i.getEmissiveStrength()}}}),this}}uT.EXTENSION_NAME=Zg;class hT extends Ps{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}hT.EXTENSION_NAME="KHR_materials_ior";const $g="KHR_materials_ior";class dT extends es{constructor(...e){super(...e),this.extensionName=$g}createIOR(){return new hT(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[$g]){const i=this.createIOR();e.materials[n].setExtension($g,i);const s=t.extensions[$g];s.ior!==void 0&&i.setIOR(s.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension($g);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[$g]={ior:i.getIOR()}}}),this}}dT.EXTENSION_NAME=$g;const{R:JD,G:ZD}=As;class pT extends Ps{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Qr(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Qr(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:JD})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:ZD})}}pT.EXTENSION_NAME="KHR_materials_iridescence";const ev="KHR_materials_iridescence";class fT extends es{constructor(...e){super(...e),this.extensionName=ev}createIridescence(){return new pT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[ev]){const o=this.createIridescence();e.materials[s].setExtension(ev,o);const l=i.extensions[ev];if(l.iridescenceFactor!==void 0&&o.setIridescenceFactor(l.iridescenceFactor),l.iridescenceIor!==void 0&&o.setIridescenceIOR(l.iridescenceIor),l.iridescenceThicknessMinimum!==void 0&&o.setIridescenceThicknessMinimum(l.iridescenceThicknessMinimum),l.iridescenceThicknessMaximum!==void 0&&o.setIridescenceThicknessMaximum(l.iridescenceThicknessMaximum),l.iridescenceTexture!==void 0){const h=l.iridescenceTexture;o.setIridescenceTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getIridescenceTextureInfo(),h)}if(l.iridescenceThicknessTexture!==void 0){const h=l.iridescenceThicknessTexture;o.setIridescenceThicknessTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getIridescenceThicknessTextureInfo(),h)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(ev);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[ev]={};if(i.getIridescenceFactor()>0&&(l.iridescenceFactor=i.getIridescenceFactor()),i.getIridescenceIOR()!==1.3&&(l.iridescenceIor=i.getIridescenceIOR()),i.getIridescenceThicknessMinimum()!==100&&(l.iridescenceThicknessMinimum=i.getIridescenceThicknessMinimum()),i.getIridescenceThicknessMaximum()!==400&&(l.iridescenceThicknessMaximum=i.getIridescenceThicknessMaximum()),i.getIridescenceTexture()){const h=i.getIridescenceTexture(),d=i.getIridescenceTextureInfo();l.iridescenceTexture=e.createTextureInfoDef(h,d)}if(i.getIridescenceThicknessTexture()){const h=i.getIridescenceThicknessTexture(),d=i.getIridescenceThicknessTextureInfo();l.iridescenceThicknessTexture=e.createTextureInfoDef(h,d)}}}),this}}fT.EXTENSION_NAME=ev;const{R:mT,G:gT,B:vT,A:_T}=As;class yT extends Ps{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Qr(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Qr(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Kl.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Kl.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:mT|gT|vT|_T})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:mT|gT|vT|_T})}}yT.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const tv="KHR_materials_pbrSpecularGlossiness";class AT extends es{constructor(...e){super(...e),this.extensionName=tv}createPBRSpecularGlossiness(){return new yT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[tv]){const o=this.createPBRSpecularGlossiness();e.materials[s].setExtension(tv,o);const l=i.extensions[tv];if(l.diffuseFactor!==void 0&&o.setDiffuseFactor(l.diffuseFactor),l.specularFactor!==void 0&&o.setSpecularFactor(l.specularFactor),l.glossinessFactor!==void 0&&o.setGlossinessFactor(l.glossinessFactor),l.diffuseTexture!==void 0){const h=l.diffuseTexture;o.setDiffuseTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getDiffuseTextureInfo(),h)}if(l.specularGlossinessTexture!==void 0){const h=l.specularGlossinessTexture;o.setSpecularGlossinessTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getSpecularGlossinessTextureInfo(),h)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(tv);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[tv]={diffuseFactor:i.getDiffuseFactor(),specularFactor:i.getSpecularFactor(),glossinessFactor:i.getGlossinessFactor()};if(i.getDiffuseTexture()){const h=i.getDiffuseTexture(),d=i.getDiffuseTextureInfo();l.diffuseTexture=e.createTextureInfoDef(h,d)}if(i.getSpecularGlossinessTexture()){const h=i.getSpecularGlossinessTexture(),d=i.getSpecularGlossinessTextureInfo();l.specularGlossinessTexture=e.createTextureInfoDef(h,d)}}}),this}}AT.EXTENSION_NAME=tv;const{R:$D,G:eB,B:tB,A:nB}=As;class bT extends Ps{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Qr(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Qr(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Kl.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Kl.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:$D|eB|tB})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:nB})}}bT.EXTENSION_NAME="KHR_materials_sheen";const nv="KHR_materials_sheen";class xT extends es{constructor(...e){super(...e),this.extensionName=nv}createSheen(){return new bT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[nv]){const o=this.createSheen();e.materials[s].setExtension(nv,o);const l=i.extensions[nv];if(l.sheenColorFactor!==void 0&&o.setSheenColorFactor(l.sheenColorFactor),l.sheenRoughnessFactor!==void 0&&o.setSheenRoughnessFactor(l.sheenRoughnessFactor),l.sheenColorTexture!==void 0){const h=l.sheenColorTexture;o.setSheenColorTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getSheenColorTextureInfo(),h)}if(l.sheenRoughnessTexture!==void 0){const h=l.sheenRoughnessTexture;o.setSheenRoughnessTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getSheenRoughnessTextureInfo(),h)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(nv);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[nv]={sheenColorFactor:i.getSheenColorFactor(),sheenRoughnessFactor:i.getSheenRoughnessFactor()};if(i.getSheenColorTexture()){const h=i.getSheenColorTexture(),d=i.getSheenColorTextureInfo();l.sheenColorTexture=e.createTextureInfoDef(h,d)}if(i.getSheenRoughnessTexture()){const h=i.getSheenRoughnessTexture(),d=i.getSheenRoughnessTextureInfo();l.sheenRoughnessTexture=e.createTextureInfoDef(h,d)}}}),this}}xT.EXTENSION_NAME=nv;const{R:iB,G:rB,B:sB,A:aB}=As;class wT extends Ps{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Qr(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Qr(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Kl.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Kl.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:aB})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:iB|rB|sB})}}wT.EXTENSION_NAME="KHR_materials_specular";const iv="KHR_materials_specular";class ET extends es{constructor(...e){super(...e),this.extensionName=iv}createSpecular(){return new wT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[iv]){const o=this.createSpecular();e.materials[s].setExtension(iv,o);const l=i.extensions[iv];if(l.specularFactor!==void 0&&o.setSpecularFactor(l.specularFactor),l.specularColorFactor!==void 0&&o.setSpecularColorFactor(l.specularColorFactor),l.specularTexture!==void 0){const h=l.specularTexture;o.setSpecularTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getSpecularTextureInfo(),h)}if(l.specularColorTexture!==void 0){const h=l.specularColorTexture;o.setSpecularColorTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getSpecularColorTextureInfo(),h)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(iv);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[iv]={};if(i.getSpecularFactor()!==1&&(l.specularFactor=i.getSpecularFactor()),Hr.eq(i.getSpecularColorFactor(),[1,1,1])||(l.specularColorFactor=i.getSpecularColorFactor()),i.getSpecularTexture()){const h=i.getSpecularTexture(),d=i.getSpecularTextureInfo();l.specularTexture=e.createTextureInfoDef(h,d)}if(i.getSpecularColorTexture()){const h=i.getSpecularColorTexture(),d=i.getSpecularColorTextureInfo();l.specularColorTexture=e.createTextureInfoDef(h,d)}}}),this}}ET.EXTENSION_NAME=iv;const{R:oB}=As;class ST extends Ps{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Qr(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:oB})}}ST.EXTENSION_NAME="KHR_materials_transmission";const rv="KHR_materials_transmission";class MT extends es{constructor(...e){super(...e),this.extensionName=rv}createTransmission(){return new ST(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[rv]){const o=this.createTransmission();e.materials[s].setExtension(rv,o);const l=i.extensions[rv];if(l.transmissionFactor!==void 0&&o.setTransmissionFactor(l.transmissionFactor),l.transmissionTexture!==void 0){const h=l.transmissionTexture;o.setTransmissionTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getTransmissionTextureInfo(),h)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(rv);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[rv]={transmissionFactor:i.getTransmissionFactor()};if(i.getTransmissionTexture()){const h=i.getTransmissionTexture(),d=i.getTransmissionTextureInfo();l.transmissionTexture=e.createTextureInfoDef(h,d)}}}),this}}MT.EXTENSION_NAME=rv;class CT extends Ps{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[fn.MATERIAL]}}CT.EXTENSION_NAME="KHR_materials_unlit";const o0="KHR_materials_unlit";class TT extends es{constructor(...e){super(...e),this.extensionName=o0}createUnlit(){return new CT(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{t.extensions&&t.extensions[o0]&&e.materials[n].setExtension(o0,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(o0)){const i=e.materialIndexMap.get(n),s=t.json.materials[i];s.extensions=s.extensions||{},s.extensions[o0]={}}}),this}}TT.EXTENSION_NAME=o0;class IT extends Ps{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}IT.EXTENSION_NAME="KHR_materials_variants";class PT extends Ps{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[fn.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}PT.EXTENSION_NAME="KHR_materials_variants";class fS extends Ps{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}fS.EXTENSION_NAME="KHR_materials_variants";const bd="KHR_materials_variants";class RT extends es{constructor(...e){super(...e),this.extensionName=bd}createMappingList(){return new PT(this.document.getGraph())}createVariant(e=""){return new fS(this.document.getGraph(),e)}createMapping(){return new IT(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof fS)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[bd])return this;const n=(t.json.extensions[bd].variants||[]).map(i=>this.createVariant().setName(i.name||""));return(t.json.meshes||[]).forEach((i,s)=>{const o=e.meshes[s];(i.primitives||[]).forEach((l,h)=>{if(!l.extensions||!l.extensions[bd])return;const d=this.createMappingList(),f=l.extensions[bd];for(const v of f.mappings){const y=this.createMapping();v.material!==void 0&&y.setMaterial(e.materials[v.material]);for(const w of v.variants||[])y.addVariant(n[w]);d.addMapping(y)}o.listPrimitives()[h].setExtension(bd,d)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const i=[],s=new Map;for(const o of n)s.set(o,i.length),i.push(e.createPropertyDef(o));for(const o of this.document.getRoot().listMeshes()){const l=e.meshIndexMap.get(o);o.listPrimitives().forEach((h,d)=>{const f=h.getExtension(bd);if(!f)return;const v=e.jsonDoc.json.meshes[l].primitives[d],y=f.listMappings().map(w=>{const E=e.createPropertyDef(w),M=w.getMaterial();return M&&(E.material=e.materialIndexMap.get(M)),E.variants=w.listVariants().map(P=>s.get(P)),E});v.extensions=v.extensions||{},v.extensions[bd]={mappings:y}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[bd]={variants:i},this}}RT.EXTENSION_NAME=bd;const{G:lB}=As;class DT extends Ps{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[fn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Qr(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:lB})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Kl.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",Kl.hexToFactor(e,t))}}DT.EXTENSION_NAME="KHR_materials_volume";const sv="KHR_materials_volume";class BT extends es{constructor(...e){super(...e),this.extensionName=sv}createVolume(){return new DT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[sv]){const o=this.createVolume();e.materials[s].setExtension(sv,o);const l=i.extensions[sv];if(l.thicknessFactor!==void 0&&o.setThicknessFactor(l.thicknessFactor),l.attenuationDistance!==void 0&&o.setAttenuationDistance(l.attenuationDistance),l.attenuationColor!==void 0&&o.setAttenuationColor(l.attenuationColor),l.thicknessTexture!==void 0){const h=l.thicknessTexture;o.setThicknessTexture(e.textures[n[h.index].source]),e.setTextureInfo(o.getThicknessTextureInfo(),h)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(sv);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[sv]={};if(i.getThicknessFactor()>0&&(l.thicknessFactor=i.getThicknessFactor()),Number.isFinite(i.getAttenuationDistance())&&(l.attenuationDistance=i.getAttenuationDistance()),Hr.eq(i.getAttenuationColor(),[1,1,1])||(l.attenuationColor=i.getAttenuationColor()),i.getThicknessTexture()){const h=i.getThicknessTexture(),d=i.getThicknessTextureInfo();l.thicknessTexture=e.createTextureInfoDef(h,d)}}}),this}}BT.EXTENSION_NAME=sv;const LT="KHR_mesh_quantization";class OT extends es{constructor(...e){super(...e),this.extensionName=LT}read(e){return this}write(e){return this}}OT.EXTENSION_NAME=LT;const _A="KHR_texture_basisu";class cB{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=hS(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=hS(e).dataFormatDescriptor[0];if(t.colorModel===163)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===166)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=hS(e),n=this.getChannels(e)>3;let i=0;for(let s=0;s<t.levels.length;s++){const o=t.levels[s];i+=o.uncompressedByteLength?o.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,s)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,s)))/4)*(n?16:8)}return i}}class kT extends es{constructor(...e){super(...e),this.extensionName=_A,this.prereadTypes=[fn.TEXTURE]}static register(){_d.registerFormat("image/ktx2",new cB)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions[_A]&&(t.source=t.extensions[_A].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const i=e.imageIndexMap.get(n);t.json.textures.forEach(s=>{s.source===i&&(s.extensions=s.extensions||{},s.extensions[_A]={source:s.source},delete s.source)})}}),this}}kT.EXTENSION_NAME=_A;class UT extends Ps{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[fn.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}UT.EXTENSION_NAME="KHR_texture_transform";const av="KHR_texture_transform";class NT extends es{constructor(...e){super(...e),this.extensionName=av}createTransform(){return new UT(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[av])continue;const i=this.createTransform(),s=n.extensions[av];s.offset!==void 0&&i.setOffset(s.offset),s.rotation!==void 0&&i.setRotation(s.rotation),s.scale!==void 0&&i.setScale(s.scale),s.texCoord!==void 0&&i.setTexCoord(s.texCoord),t.setExtension(av,i)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,i]of t){const s=n.getExtension(av);if(!s)continue;i.extensions=i.extensions||{};const o={},l=Hr.eq;l(s.getOffset(),[0,0])||(o.offset=s.getOffset()),s.getRotation()!==0&&(o.rotation=s.getRotation()),l(s.getScale(),[1,1])||(o.scale=s.getScale()),s.getTexCoord()!=null&&(o.texCoord=s.getTexCoord()),i.extensions[av]=o}return this}}NT.EXTENSION_NAME=av;const uB=[fn.ROOT,fn.SCENE,fn.NODE,fn.MESH,fn.MATERIAL,fn.TEXTURE,fn.ANIMATION];class FT extends Ps{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=uB}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",bm({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=bm({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return bm({"@context":mS(this.get("context"))},mS(this.get("properties")))}fromJSONLD(e){const t=(e=mS(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function mS(a){return JSON.parse(JSON.stringify(a))}FT.EXTENSION_NAME="KHR_xmp_json_ld";const Np="KHR_xmp_json_ld";class zT extends es{constructor(...e){super(...e),this.extensionName=Np}createPacket(){return new FT(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[Np];if(!n||!n.packets)return this;const i=e.jsonDoc.json,s=this.document.getRoot(),o=n.packets.map(d=>this.createPacket().fromJSONLD(d)),l=[[i.asset],i.scenes,i.nodes,i.meshes,i.materials,i.images,i.animations],h=[[s],s.listScenes(),s.listNodes(),s.listMeshes(),s.listMaterials(),s.listTextures(),s.listAnimations()];for(let d=0;d<l.length;d++){const f=l[d]||[];for(let v=0;v<f.length;v++){const y=f[v];y.extensions&&y.extensions[Np]&&h[d][v].setExtension(Np,o[y.extensions[Np].packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const i of this.properties){n.push(i.toJSONLD());for(const s of i.listParents()){let o;switch(s.propertyType){case fn.ROOT:o=t.asset;break;case fn.SCENE:o=t.scenes[e.sceneIndexMap.get(s)];break;case fn.NODE:o=t.nodes[e.nodeIndexMap.get(s)];break;case fn.MESH:o=t.meshes[e.meshIndexMap.get(s)];break;case fn.MATERIAL:o=t.materials[e.materialIndexMap.get(s)];break;case fn.TEXTURE:o=t.images[e.imageIndexMap.get(s)];break;case fn.ANIMATION:o=t.animations[e.animationIndexMap.get(s)];break;default:o=null,this.document.getLogger().warn(`[${Np}]: Unsupported parent property, "${s.propertyType}"`)}o&&(o.extensions=o.extensions||{},o.extensions[Np]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[Np]={packets:n}),this}}zT.EXTENSION_NAME=Np;const hB=[VC,pS,qC,YC,vA,nT,rT,lT,uT,dT,fT,AT,ET,xT,MT,TT,RT,BT,OT,kT,NT,zT];class jT extends $E{constructor(e){super(),this._loadedLibs=!1,e=e||{method:vA.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new DD().registerExtensions(hB).registerExtensions([VT,nw,Zx,$x,ew,iw,rw,sw,aw,ow,lw,cw,uw,dw,hw,pw,tw]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,dracoOptions:n,...i}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,i);await this._loadLibs();const s={...i};t&&(s.externalImagesInExtras=!0);const o=await new Promise((y,w)=>this.parse(e,y,w,s)),l=await super.parseAsync(o,s);if(!t)return l;if(!o)throw new Error("GLTFDracoExporter: gltf is null");let h=o;const d=h.byteLength||1/0,f=await(typeof h!="object"||h.byteLength?this._io.readBinary(new Uint8Array(h)):this._io.readJSON({json:h,resources:{}}));if(f.createExtension(vA).setRequired(!0).setEncoderOptions({...this._encoderOptions,...n??{}}),s.exportExt==="glb")h=await this._io.writeBinary(f),isFinite(d)&&console.log("DRACO Compression ratio: "+(h.byteLength/d).toFixed(5));else{const y=await this._io.writeJSON(f);h=y.json,Object.values(y.resources).filter(w=>w).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),h.resources=y.resources)}h.__isGLTFOutput=!0;const v=await super.parseAsync(h,s);if(!v)throw new Error("GLTFDracoExporter: blob is null");return v.ext="glb",v.__uncompressed=l,v}}class gS extends Sn{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Yt,Am]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer,n=e.getManager().exporter;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(i,s,o){eS(i,s,jT,l=>{const h=Ys()+".drc",d=l;d.loader=o.registerFile(h),d.loader.setDecoderConfig({type:"js"}),d.loader.preload(!0,!0)})})(n,e,t)}}gS.PluginType="GLTFDracoExportPlugin";class dB extends Ps{constructor(){super(...arguments),this.extensionName=Jr,this.parentTypes=[fn.SCENE],this.propertyType="ViewerJSON"}init(){}}class VT extends es{constructor(){super(...arguments),this.extensionName=Jr,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},(t=e.jsonDoc.json.scenes)==null||t.forEach((n,i)=>{if(n.extensions&&n.extensions[Jr]){const s=new dB(this.document.getGraph());e.scenes[i].setExtension(Jr,s),this._viewerConfig=n.extensions[Jr]}}),this}write(e){return this.document.getRoot().listScenes().forEach(t=>{var n;if(t.getExtension(Jr)){const i=(n=e.jsonDoc.json.scenes)==null?void 0:n[e.jsonDoc.json.scene||0];i&&Object.keys(this._viewerConfig).length>0&&(i.extensions=i.extensions||{},i.extensions[Jr]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}VT.EXTENSION_NAME=Jr;class Jx extends Ps{addTexture(e,t,n,i=4369){this.setRef(e,n,{channels:i}),this.textures[e]=[t,n]}constructor(e,t,n){super(e,t),this.parentTypes=[fn.MATERIAL,fn.MESH,fn.NODE,fn.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=n}init(){}}class Wo extends es{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((s,o)=>{var l;if(s.extensions&&s.extensions[this.extensionName]){const h=new Jx(this.document.getGraph(),"",this.extensionName);e.materials[o].setExtension(this.extensionName,h);const d={...s.extensions[this.extensionName]};for(const[f,v]of Object.entries(d))if(typeof(v==null?void 0:v.index)=="number"){const y=v,w=(l=i[y.index])==null?void 0:l.source;if(typeof w!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",y);continue}const E=e.textures[w],M=new Qr(this.document.getGraph()),P=this.textureChannels[f]??4369;h.addTexture(f,M,E,P),e.setTextureInfo(M,y),delete d[f]}h.setExtras(d)}}),(t.json.meshes||[]).forEach((s,o)=>{if(s.extensions&&s.extensions[this.extensionName]){const l=new Jx(this.document.getGraph(),"",this.extensionName);e.meshes[o].setExtension(this.extensionName,l);const h=s.extensions[this.extensionName];l.setExtras(h)}}),(t.json.nodes||[]).forEach((s,o)=>{if(s.extensions&&s.extensions[this.extensionName]){const l=new Jx(this.document.getGraph(),"",this.extensionName);e.nodes[o].setExtension(this.extensionName,l);const h=s.extensions[this.extensionName];l.setExtras(h)}}),(t.json.scenes||[]).forEach((s,o)=>{if(s.extensions&&s.extensions[this.extensionName]){const l=new Jx(this.document.getGraph(),"",this.extensionName);e.scenes[o].setExtension(this.extensionName,l);const h=s.extensions[this.extensionName];l.setExtras(h)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const s=e.materialIndexMap.get(n),o=t.json.materials[s];o.extensions=o.extensions||{};const l={...i.getExtras()};for(const[h,d]of Object.entries(i.textures)){const f=d[0],v=d[1];v&&(l[h]=e.createTextureInfoDef(v,f))}o.extensions[this.extensionName]=l}}),this.document.getRoot().listMeshes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const s=e.meshIndexMap.get(n),o=t.json.meshes[s];o.extensions=o.extensions||{},o.extensions[this.extensionName]=i.getExtras()}}),this.document.getRoot().listNodes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const s=e.nodeIndexMap.get(n),o=t.json.nodes[s];o.extensions=o.extensions||{},o.extensions[this.extensionName]=i.getExtras()}}),this.document.getRoot().listScenes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const s=e.jsonDoc.json.scene||0,o=t.json.scenes[s];if(!o)return;o.extensions=o.extensions||{},o.extensions[this.extensionName]=i.getExtras()}}),this}}class Zx extends Wo{constructor(){super(...arguments),this.extensionName=Zx.EXTENSION_NAME,this.textureChannels={bumpTexture:As.R}}}Zx.EXTENSION_NAME=Eu;class $x extends Wo{constructor(){super(...arguments),this.extensionName=$x.EXTENSION_NAME,this.textureChannels={lightMapTexture:As.R|As.G|As.B}}}$x.EXTENSION_NAME=Sf;class ew extends Wo{constructor(){super(...arguments),this.extensionName=ew.EXTENSION_NAME,this.textureChannels={alphaTexture:As.G}}}ew.EXTENSION_NAME=Vc;class tw extends Wo{constructor(){super(...arguments),this.extensionName=tw.EXTENSION_NAME,this.textureChannels={displacementTexture:As.R}}}tw.EXTENSION_NAME=Tl;class nw extends Wo{constructor(){super(...arguments),this.extensionName=nw.EXTENSION_NAME}}nw.EXTENSION_NAME=Zi.DIAMOND_GLTF_EXTENSION;class iw extends Wo{constructor(){super(...arguments),this.extensionName=iw.EXTENSION_NAME}}iw.EXTENSION_NAME=hr.AnimationMarkersExtension;class rw extends Wo{constructor(){super(...arguments),this.extensionName=rw.EXTENSION_NAME,this.textureChannels={anisotropyDirection:As.R|As.G|As.B}}}rw.EXTENSION_NAME=so.ANISOTROPY_GLTF_EXTENSION;class sw extends Wo{constructor(){super(...arguments),this.extensionName=sw.EXTENSION_NAME,this.textureChannels={customBumpMap:As.R|As.G|As.B}}}sw.EXTENSION_NAME=Is.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class aw extends Wo{constructor(){super(...arguments),this.extensionName=aw.EXTENSION_NAME}}aw.EXTENSION_NAME=Ro;class ow extends Wo{constructor(){super(...arguments),this.extensionName=ow.EXTENSION_NAME}}ow.EXTENSION_NAME=Us;class lw extends Wo{constructor(){super(...arguments),this.extensionName=lw.EXTENSION_NAME}}lw.EXTENSION_NAME=ws;class cw extends Wo{constructor(){super(...arguments),this.extensionName=cw.EXTENSION_NAME}}cw.EXTENSION_NAME=Ql.CLEARCOAT_TINT_GLTF_EXTENSION;class uw extends Wo{constructor(){super(...arguments),this.extensionName=uw.EXTENSION_NAME}}uw.EXTENSION_NAME=cl.THIN_FILM_LAYER_GLTF_EXTENSION;class hw extends Wo{constructor(){super(...arguments),this.extensionName=hw.EXTENSION_NAME}}hw.EXTENSION_NAME=Sc.TRIPLANAR_GLTF_EXTENSION;class dw extends Wo{constructor(){super(...arguments),this.extensionName=dw.EXTENSION_NAME}}dw.EXTENSION_NAME=Ec.SSBEVEL_GLTF_EXTENSION;class pw extends Wo{constructor(){super(...arguments),this.extensionName=pw.EXTENSION_NAME}}pw.EXTENSION_NAME=jo.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class GT extends g.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}GT.PluginType="PMREMGenerator";const HT=new u.Pa4,pB=new u._fP,QT=new u.Pa4;class fB extends u.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const xd=new u.yGw,mB=new u.yGw;class gB{constructor(e={}){const t=this;let n,i,s,o;const l={camera:{fov:0,style:""},objects:new WeakMap},h=e.element!==void 0?e.element:document.createElement("div");h.style.overflow="hidden",this.domElement=h;const d=document.createElement("div");d.style.transformOrigin="0 0",d.style.pointerEvents="none",h.appendChild(d);const f=document.createElement("div");function v(M){return Math.abs(M)<1e-10?0:M}function y(M){const P=M.elements;return"matrix3d("+v(P[0])+","+v(-P[1])+","+v(P[2])+","+v(P[3])+","+v(P[4])+","+v(-P[5])+","+v(P[6])+","+v(P[7])+","+v(P[8])+","+v(-P[9])+","+v(P[10])+","+v(P[11])+","+v(P[12])+","+v(-P[13])+","+v(P[14])+","+v(P[15])+")"}function w(M){const P=M.elements;return"translate(-50%,-50%)matrix3d("+v(P[0])+","+v(P[1])+","+v(P[2])+","+v(P[3])+","+v(-P[4])+","+v(-P[5])+","+v(-P[6])+","+v(-P[7])+","+v(P[8])+","+v(P[9])+","+v(P[10])+","+v(P[11])+","+v(P[12])+","+v(P[13])+","+v(P[14])+","+v(P[15])+")"}function E(M,P,L,R){if(M.isCSS3DObject){const I=M.visible===!0&&M.layers.test(L.layers)===!0;if(M.element.style.display=I===!0?"":"none",I===!0){let N;M.onBeforeRender(t,P,L),M.isCSS3DSprite?(xd.copy(L.matrixWorldInverse),xd.transpose(),M.rotation2D!==0&&xd.multiply(mB.makeRotationZ(M.rotation2D)),M.matrixWorld.decompose(HT,pB,QT),xd.setPosition(HT),xd.scale(QT),xd.elements[3]=0,xd.elements[7]=0,xd.elements[11]=0,xd.elements[15]=1,N=w(xd)):N=w(M.matrixWorld);const j=M.element,H=l.objects.get(M);if(H===void 0||H.style!==N){j.style.transform=N;const X={style:N};l.objects.set(M,X)}j.parentNode!==f&&f.appendChild(j),M.onAfterRender(t,P,L)}}for(let I=0,N=M.children.length;I<N;I++)E(M.children[I],P,L)}f.style.transformStyle="preserve-3d",d.appendChild(f),this.getSize=function(){return{width:n,height:i}},this.render=function(M,P){const L=P.projectionMatrix.elements[5]*o;let R,I;l.camera.fov!==L&&(d.style.perspective=P.isPerspectiveCamera?L+"px":"",l.camera.fov=L),P.view&&P.view.enabled?(d.style.transform=`translate( ${-P.view.offsetX*(n/P.view.width)}px, ${-P.view.offsetY*(i/P.view.height)}px )`,d.style.transform+=`scale( ${P.view.fullWidth/P.view.width}, ${P.view.fullHeight/P.view.height} )`):d.style.transform="",M.matrixWorldAutoUpdate===!0&&M.updateMatrixWorld(),P.parent===null&&P.matrixWorldAutoUpdate===!0&&P.updateMatrixWorld(),P.isOrthographicCamera&&(R=-(P.right+P.left)/2,I=(P.top+P.bottom)/2);const N=P.view&&P.view.enabled?P.view.height/P.view.fullHeight:1,j=P.isOrthographicCamera?`scale( ${N} )scale(`+L+")translate("+v(R)+"px,"+v(I)+"px)"+y(P.matrixWorldInverse):`scale( ${N} )translateZ(`+L+"px)"+y(P.matrixWorldInverse),H=j+"translate("+s+"px,"+o+"px)";l.camera.style!==H&&(f.style.transform=H,l.camera.style=H),E(M,M,P)},this.setSize=function(M,P){n=M,i=P,s=n/2,o=i/2,h.style.width=M+"px",h.style.height=P+"px",d.style.width=M+"px",d.style.height=P+"px",f.style.width=M+"px",f.style.height=P+"px"}}}var fw,mw=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let wd=fw=class extends Sn{constructor(a=!0){super(),this._scene=new u.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,t,n,i,s;const o=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();if(!(o!=null&&o.geometry))return void await((n=this._viewer)==null?void 0:n.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const l=await((i=this._viewer)==null?void 0:i.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!l)return;const h=await((s=this._viewer)==null?void 0:s.prompt("Width: Enter the width for the object.","512",!1))||"512";h&&this.attachIFrame(o,l,parseInt(h))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)==null||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=a,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const a=this._viewer;a&&this._renderer&&(a.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",a.canvas):this._renderer.domElement.appendChild(a.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new gB;const a=this._viewer.renderer.rendererObject.getSize(new u.FM8);this._renderer.setSize(a.width,a.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const t=this._viewer.renderer.rendererObject.getSize(new u.FM8);this._renderer.setSize(t.width,t.height)})}async onAdded(a){await super.onAdded(a);let e=!0,t=!0;a.addEventListener("postFrame",s=>{var o,l;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(t&&this._trackers.forEach(h=>{var d,f;let v=!0;const y=h.modelObj.material.side;if(y!==u.ehD){const w=new u.Pa4(0,0,1).applyQuaternion(h.cssObj.quaternion),E=(f=(d=this._viewer)==null?void 0:d.scene.activeCamera)==null?void 0:f.cameraObject,M=w.dot(E.getWorldDirection(new u.Pa4));v=y===u._Li?M>0:M<0}h.cssObj.element.style.visibility=v?"visible":"hidden"}),this._trackers.filter(h=>h.dirty).forEach(h=>this._syncProperties(h)),(l=this._renderer)==null||l.render(this._scene,(o=a.scene.activeCamera)==null?void 0:o.cameraObject),e=!1))}),a.addEventListener("update",s=>{this.enabled&&(e=this._trackers.length>0)}),a.scene.addEventListener("sceneUpdate",s=>{this.enabled&&(this._trackers.forEach(o=>o.dirty=!0),e=this._trackers.length>0)}),a.scene.addEventListener("activeCameraUpdate",s=>{this.enabled&&(e=this._trackers.length>0,t=!0)});let n=!1;const i=new u.iMs;a.container.addEventListener("mousemove",s=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const o=this._viewer.canvas.getBoundingClientRect(),l=(s.clientX-o.x)/o.width*2-1,h=-(s.clientY-o.y)/o.height*2+1;i.setFromCamera({x:l,y:h},this._viewer.scene.activeCamera.cameraObject);const d=this._trackers.map(v=>v.modelObj),f=i.intersectObjects(d,!1);if(console.log(f),f.length)return this._viewer.canvas.style.pointerEvents="none",n=!0,void console.log(this._viewer.canvas.style.pointerEvents);n&&(this._viewer.canvas.style.pointerEvents="auto",n=!1)})}attachIFrame(a,e,t){const n=vw(a.modelObject),i=WT(e,t,t*n.y/n.x,()=>{var s;return(s=a.setDirty)==null?void 0:s.call(a)});return this.attachCSS3DObject(i,a),i}attachCSS3DObject(a,e){var t,n,i,s,o;if(this._trackers.push({cssObj:a,modelObj:e.modelObject,dirty:!0}),a.element&&(this._resizeObserver.observe(a.element),a.element.__isCSS3DObjectElement=!0,console.log(a.element,a.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const l=(t=this._viewer)==null?void 0:t.createMaterial("basic",{opacity:0,color:new u.Ilk("black"),blending:u.jFi,side:u.Wl3});if(!l)throw"cannot create mat";l.userData.forcedLinearDepth=0,(n=e.setMaterial)==null||n.call(e,l),gw(e.modelObject),vS(e.modelObject),vw(e.modelObject),this._scene.add(a),(s=(i=this.uiConfig)==null?void 0:i.uiRefresh)==null||s.call(i),(o=e.setDirty)==null||o.call(e)}_syncProperties(a){const e=a.modelObj,t=a.cssObj;e.updateMatrixWorld();const n=a.cssObj.element.clientWidth<1.5?0:(a.cssObj.element.clientWidth-1.5)/vw(e).x,i=gw(e);t.quaternion.setFromUnitVectors(new u.Pa4(0,0,1),i),t.position.copy(vS(e)),t.scale.set(1,1,1).multiplyScalar(1/n),t.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld),a.dirty=!1}async onDispose(a){return this._resizeObserver.disconnect(),super.onDispose(a)}};function WT(a,e,t,n){const i=document.createElement("div");i.style.width=e.toString()+"px",i.style.height=t.toString()+"px",i.style.backgroundColor="transparent";const s=document.createElement("iframe",{is:"x-frame-bypass"});s.style.width="100%",s.style.height="100%",s.style.border="0px";const o=()=>{var l;try{s.contentWindow.name}catch(h){(typeof h=="string"?h:((l=h==null?void 0:h.toString)==null?void 0:l.call(h))??"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(h)}n(),s.removeEventListener("load",o)};return s.addEventListener("load",o),s.src=a,i.appendChild(s),new fB(i)}function gw(a){if(a.geometry.userData.geometryNormal)return a.geometry.userData.geometryNormal;const e=a.geometry.attributes.normal,t=new u.Pa4,n=new u.Pa4;for(let i=0,s=e.count;i<s;i++)t.fromBufferAttribute(e,i),n.add(t);return n.normalize(),a.geometry.userData.geometryNormal=n,n}function vS(a){if(a.geometry.userData.geometryCenter)return a.geometry.userData.geometryCenter;const e=a.geometry;if(!e)return new u.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const t=e.boundingBox.getCenter(new u.Pa4);return a.geometry.userData.geometryCenter=t,t}function vw(a,e=new u.Pa4(0,0,1)){if(a.geometry.userData.geometrySize)return a.geometry.userData.geometrySize;const t=a.geometry;if(!t)return new u.Pa4(0,0,0);const n=t.clone();n.applyMatrix4(new u.yGw().makeRotationFromQuaternion(new u._fP().setFromUnitVectors(e,gw(a)).invert())),n.computeBoundingBox();const i=n.boundingBox.getSize(new u.Pa4);return a.geometry.userData.geometrySize=i,n.dispose(),i}wd.PluginType="CSS3DRenderer",mw([sn("Enabled"),(0,g.onChange)(fw.prototype._refreshEnabled),ke()],wd.prototype,"enabled",void 0),mw([sn("Over canvas"),(0,g.onChange)(fw.prototype._refreshCanvasInDOM),ke()],wd.prototype,"overCanvas",void 0),mw([Bi("Attach iframe")],wd.prototype,"attachIFrameToSelected",void 0),wd=fw=mw([Vn("CSS3D Renderer")],wd);class vB extends $o{constructor(e,t,n,i=new u.Ilk(1,1,1),s=1){super(void 0,void 0,n,i,s),this.target=t,this._getSelectedObject=e}render(e,t,n,i,s){const o=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=this._getSelectedObject();if(d)this._renderSelectedObject(e,d,t,i,s);else{e.setRenderTarget(this.target);const f=new u.Ilk;e.getClearColor(f),e.setClearColor(new u.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(f)}e.setRenderTarget(o,l,h)}_renderSelectedObject(e,t,n,i,s){if(!this.camera)return;t.traverse(h=>{h.layers.enable(6)});const o=this.camera.layers.mask;this.camera.layers.set(6);const l=e.userData;l||console.error("threejs is not patched?"),l.transmissionRenderTarget=n,mi(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(e,n,this.target,i,s)),l.transmissionRenderTarget=void 0,t.traverse(h=>{h.layers.disable(6)}),this.camera.layers.mask=o}}var Fp,xm=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let sh=Fp=class{constructor(a,e){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new u.Ilk(15305317),this.debugOutline=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new u.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new u.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(t,n)=>this.enabled?g.glsl`
            ${ga}
            ${`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`}
        `:"",this._combinedPostPlugin=a.getPlugin(vc),this._pickingPlugin=a.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),e&&(this.extraUniforms.outlineBuffer.value=e.texture),this._enable()}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=_n(a.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var a;(a=this.__setDirty)==null||a.call(this),this._setDirty()}_enable(){var a;(a=this._pickingPlugin)==null||a.enableWidget(!this.enabled),this._setDirty()}};sh.PluginType="Outline",xm([(0,g.onChange)(Fp.prototype._enable),sn("Enable"),ke()],sh.prototype,"enabled",void 0),xm([(0,g.onChange)(Fp.prototype._setDirty),sn("Highlight"),ke()],sh.prototype,"enableHighlight",void 0),xm([(0,g.onChange)(Fp.prototype._setDirty),sn("DynamicSelection"),ke()],sh.prototype,"enableDynamicSelection",void 0),xm([(0,g.onChange)(Fp.prototype._setDirty),gn("Intensity",[0,2],.001,{limitedUi:!0}),ke()],sh.prototype,"outlineIntensity",void 0),xm([(0,g.onChange)(Fp.prototype._setDirty),gn("Transparency",[0,1],.01,{limitedUi:!0}),ke()],sh.prototype,"highlightTransparency",void 0),xm([(0,g.onChange)(Fp.prototype._setDirty),lc("Color"),ke()],sh.prototype,"outlineColor",void 0),xm([(0,g.onChange)(Fp.prototype._setDirty),sn("Debug")],sh.prototype,"debugOutline",void 0),sh=Fp=xm([Vn("Outline")],sh);class yA extends Ou{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new sh(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const t=e==null?void 0:e.getPluginByType("Picking"),n=new u.jyz({uniforms:{cameraNearFar:{value:new u.FM8(.1,100)}},vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:u.ehD}),i=tr(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new vB(()=>t==null?void 0:t.getSelectedObject(),this._outlineTarget,n),update(){e.scene.renderCamera.updateShaderProperties(this.passObject.overrideMaterial),i.passObject.scene=e.scene.modelObject,i.passObject.camera=e.scene.renderCamera.cameraObject}});e.renderer.registerPass(i),t==null||t.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(t!=null&&t.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",s=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const o=t==null?void 0:t.getSelectedObject();o&&this._extension.enableDynamicSelection?s.target!==e.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=o?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,t,n){return Tg(this._extension,"transparency",{from:e,to:t,duration:n,onComplete:()=>{this._animationCallBack=null}})}}yA.PluginType="Outline";const _w=.2,_B=Math.PI/24,qT=new u.FM8,yw=(a,e,t)=>{let n=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let i=0;i<=12;++i)a.push(e+.17*Math.cos(n),t+.17*Math.sin(n),0,e+_w*Math.cos(n),t+_w*Math.sin(n),0),n+=_B};class XT extends u.Kj0{constructor(e,t,n=!1){super(((h,d)=>{const f=new u.u9r,v=[],y=[],w=h.getSize(new u.Pa4),E=w.x/2,M=(d?w.y:w.z)/2;yw(y,E,M),yw(y,-E,M),yw(y,-E,-M),yw(y,E,-M);const P=y.length/3;for(let R=0;R<P-2;R+=2)v.push(R,R+1,R+3,R,R+3,R+2);const L=P-2;return v.push(L,L+1,1,L,1,0),f.setAttribute("position",new u.a$l(y,3)),f.setIndex(v),f})(e,n)),this.boundingSize=new u.Pa4,this._raycaster=new u.iMs,this._camera=t,this._placeOnWall=n;const i=this.material;i.side=u.Wl3,i.color=new er(16711935),i.opacity=0,this.userData.bboxVisible=!1;const s=e.getSize(this.boundingSize),o=s.x/2,l=(n?s.y:s.z)/2;this.hitPlane=new u.Kj0(new u._12(2*(o+_w),2*(l+_w))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),n?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,n){qT.set(t,-n),this.hitPlane.visible=!0;const i=this._positionAndNormalFromPoint(qT,this.hitPlane);return this.hitPlane.visible=!1,i==null?null:i.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const i=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),i}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:n}=this.hitPlane;t.dispose(),n.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)==null||e.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const n=this._raycaster.intersectObject(t,!0);if(n.length===0)return null;const i=n[0];return i.face==null?null:i.uv==null?{position:i.point,normal:i.face.normal,uv:null}:(i.face.normal.applyNormalMatrix(new u.Vkp().getNormalMatrix(i.object.matrixWorld)),{position:i.point,normal:i.face.normal,uv:i.uv})}}const _S=new u.Pa4;class YT{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new u.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new u.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new u.Pa4,this._hitMatrix=new u.yGw,this.xDamper=new g.Damper,this.yDamper=new g.Damper,this.zDamper=new g.Damper,this.yawDamper=new g.Damper,this.scaleDamper=new g.Damper,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(t==null)return;const n=this.frame.getHitTestResultsForTransientInput(t),i=this.presentedScene,s=this.placementBox;if(n.length===1){this.inputSource=e.inputSource;const{axes:o}=this.inputSource.gamepad||{axes:[0,0]},l=s.getHit(i,o[0],o[1]);s.show=!0,l!=null?(this.isTranslating=!0,this.lastDragPosition.copy(l),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*o[0])}else if(n.length===2){s.show=!0,this.isTwoFingering=!0;const{separation:o}=this.fingerPolar(n);this.firstRatio=o/i.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,n){var i;this.transientHitTestSource=await((i=e.requestHitTestSourceForTransientInput)==null?void 0:i.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=n,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var t;const n=(t=this.xr)==null?void 0:t.getReferenceSpace(),i=n?e.getPose(n):null;return i?(this._hitMatrix.fromArray(i.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,n=t.position,i=t.rotation.y,s=this.placementBox,o=Math.max(s.boundingSize.x,s.boundingSize.y,s.boundingSize.z)/2,l=this.goalPosition,h=t.scale.x;if(!l.equals(n)||this.goalScale!==h){let{x:d,y:f,z:v}=n;d=this.xDamper.update(d,l.x,e,o),f=this.yDamper.update(f,l.y,e,o),v=this.zDamper.update(v,l.z,e,o),n.set(d,f,v);const y=this.scaleDamper.update(h,this.goalScale,e,1);if(t.scale.set(y,y,y),!this.isTranslating){const w=l.y-f;this.placementComplete&&!this.placeOnWall?s.offsetHeight=w/y:w===0&&(this.placementComplete=!0,s.show=!1)}}s.updateOpacity(e),t.rotation.y=this.yawDamper.update(i,this.goalYaw,e,Math.PI)}processInput(e){var t;this.frame=e;const n=this.transientHitTestSource;if(!n||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=e.getHitTestResultsForTransientInput(n),s=this.presentedScene,o=s.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{const{separation:l,deltaYaw:h}=this.fingerPolar(i);if(this.placeOnWall||(this.goalYaw+=h),!s.userData.__scaleDisabled){const d=l/this.firstRatio;this.goalScale=d<1.3&&d>.7692307692307692?1:d}}else if(i.length!==2)if(this.isRotating&&((t=this.inputSource)!=null&&t.gamepad)){const l=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=l-this.lastAngle,this.lastAngle=l}else this.isTranslating&&(console.log("translating"),i.forEach(l=>{if(l.inputSource!==this.inputSource)return;let h=null;if(l.results.length>0&&(h=this.getHitPoint(l.results[0])),h==null&&(h=this.getTouchLocation()),h!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const d=h.y-this.lastDragPosition.y;if(d<0){this.placementBox.offsetHeight=d/o;const f=_S.copy(this.xr.getCamera().position),v=-d/(f.y-h.y);f.multiplyScalar(v),h.multiplyScalar(1-v).add(f)}}this.goalPosition.add(h),this.lastDragPosition.copy(h)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:l}=this.fingerPolar(i);this.firstRatio=l/o}}getTouchLocation(){var e;const{axes:t}=this.inputSource.gamepad??{axes:[0,0]},n=this.placementBox.getExpandedHit(this.presentedScene,t[0],t[1]);return n!=null&&(_S.copy(n).sub((e=this.xr)==null?void 0:e.getCamera().position),_S.length()>10)?null:n}fingerPolar(e){var t,n,i,s;const o=((n=(t=e[0].inputSource)==null?void 0:t.gamepad)==null?void 0:n.axes)??[0,0],l=((s=(i=e[1].inputSource)==null?void 0:i.gamepad)==null?void 0:s.axes)??[0,0],h=l[0]-o[0],d=l[1]-o[1],f=Math.atan2(d,h);let v=this.lastAngle-f;return v>Math.PI?v-=2*Math.PI:v<-Math.PI&&(v+=2*Math.PI),this.lastAngle=f,{separation:Math.sqrt(h*h+d*d),deltaYaw:v}}}class yB{constructor(e,t,n,i,s){this.xrLight=e,this.renderer=t,this.lightProbe=n,this.xrWebGLBinding=null,this.estimationStartCallback=s,this.frameCallback=this.onXRFrame.bind(this);const o=t.xr.getSession();if(i&&"XRWebGLBinding"in window){const l=new u.oAp(16);e.environment=l.texture;const h=t.getContext();switch(o.preferredReflectionFormat){case"srgba8":h.getExtension("EXT_sRGB");break;case"rgba16f":h.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(o,h),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}o.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const n=t.getLightEstimate(this.lightProbe);if(n){this.xrLight.lightProbe.sh.fromArray(n.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const i=Math.max(1,Math.max(n.primaryLightIntensity.x,Math.max(n.primaryLightIntensity.y,n.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(n.primaryLightIntensity.x/i,n.primaryLightIntensity.y/i,n.primaryLightIntensity.z/i),this.xrLight.directionalLight.intensity=i,this.xrLight.directionalLight.position.copy(n.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class AB extends u.ZAu{constructor(e,t=!0){super(),this.lightProbe=new u.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new u.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let n=null,i=!1;e.xr.addEventListener("sessionstart",()=>{const s=e.xr.getSession();"requestLightProbe"in s&&s.requestLightProbe({reflectionFormat:s.preferredReflectionFormat}).then(o=>{n=new yB(this,e,o,t,()=>{i=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{n&&(n.dispose(),n=null),i&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{n&&(n.dispose(),n=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var l0=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let zp=class extends Sn{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new YT,this.dependencies=[Ri],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var a;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):((a=this._xrManager)==null||a.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const a=this._xrManager.getCamera(),e=a.cameras[0]||a,t=this._viewer.scene.activeCamera;t.cameraObject.projectionMatrix.copy(e.projectionMatrix),t.cameraObject.projectionMatrixInverse.copy(t.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var a,e;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const t=this._viewer.renderer,n=(e=(a=this._xrManager)==null?void 0:a.getCamera())==null?void 0:e.cameras[0].viewport;n?t.rendererObject.setViewport(n):console.warn("no viewport for ar camera"),this._viewer.getPlugin(Ri).updateShaderProperties(c0.material),c0.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,mi(t.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{c0.render(t.rendererObject,null,t.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._preFrame=({xrFrame:a,deltaTime:e})=>{var t,n;if(this.dirty=!!a&&((t=this._xrManager)==null?void 0:t.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!a)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const i=this._xrManager.getReferenceSpace(),s=a.getViewerPose(i);if(s==null&&this._frameCount,s==null||((n=this._viewer)==null?void 0:n.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const o=this._viewer.scene.activeCamera;this._xrManager.updateCamera(o.cameraObject),o.setDirty(),this.moveToFloor(a),this._touchInputHelper.processInput(a),this._touchInputHelper.moveScene(e),this._updateShadow()},this._preXRState={viewerBg:null,modelScale:new u.Pa4(1,1,1),modelPosition:new u.Pa4,modelRotation:new u._fP,cameraPosition:new u.Pa4(0,0,5),cameraTarget:new u.Pa4,cameraUp:new u.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new u.yGw,cameraAutoNearFar:void 0,groundOffset:new u.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new u.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.getBackground(!0);const a=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera;a.updateMatrix(),a.updateMatrixWorld(!0),this._preXRState.modelScale.copy(a.scale),this._preXRState.modelPosition.copy(a.position),this._preXRState.modelRotation.copy(a.quaternion),this._preXRState.cameraPosition.copy(e.position),this._preXRState.cameraTarget.copy(e.target),this._preXRState.cameraUp.copy(e.cameraObject.up),e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=e.cameraObject.fov,this._preXRState.cameraAspect=e.cameraObject.aspect),this._preXRState.cameraZoom=e.cameraObject.zoom,this._preXRState.cameraNear=e.cameraObject.near,this._preXRState.cameraFar=e.cameraObject.far,this._preXRState.cameraAutoNearFar=e.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(e.cameraObject.projectionMatrix);const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(this._preXRState.groundOffset.subVectors(a.position,t.mesh.modelObject.position),this._preXRState.groundScale=t.mesh.modelObject.scale.x,this._preXRState.groundRotation=t.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=t.renderToDepth,this._preXRState.groundShadowBaker=t.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const a=20*Math.PI/180,e=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(a),z:-Math.cos(a)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var t,n;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const i=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((n=(t=this._xrSession).requestHitTestSource)==null?void 0:n.call(t,{space:i,offsetRay:e}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.useTotalFrameCount=!1,this._restorePreXRState())},this._onSessionStarted=async a=>{a.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new AB(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(a),this._xrSession=a},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(a){await super.onAdded(a);const e=a.renderer.rendererObject.xr;if(e.enabled=!0,e.cameraAutoUpdate=!1,this._xrManager=e,this._touchInputHelper.xr=e,!this.domOverlay){const t=document.getElementById("tweakpaneUiContainer");this.domOverlay=t?{root:t}:void 0}if(a.addEventListener("preRender",this._preRender),a.addEventListener("postRender",this._postRender),a.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return a.console.error("XR not supported in insecure context, try https://"),this.enabled=!1,void(e.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(t=>{if(!t)throw new Error("AR not supported")}).catch(t=>{a.console.error("AR not supported:",t),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var a,e;if(!this._viewer)return;const t=this._viewer.scene.modelRoot,n=(e=(a=this._viewer.getPluginByType("Ground"))==null?void 0:a.mesh)==null?void 0:e.modelObject;n&&(n.rotation.z=this._viewer.scene.modelRoot.rotation.y,n.position.copy(this._preXRState.groundOffset).multiplyScalar(t.modelObject.scale.x).sub(t.modelObject.position).negate(),n.scale.setScalar(t.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(a){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const e=a.getHitTestResults(this._hitTestSource);if(!e.length)return;const t=e[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const n=this._touchInputHelper.getHitPoint(t);if(!n)return;this._placementBox.show=!0;const i=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(n),i.position.copy(n),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var a,e;const t=this._viewer.scene.modelRoot,n=this._viewer.scene.activeCamera,i=(a=this._xrManager)==null?void 0:a.getCamera(),s=i.cameras[0]||i;this._removePlacementBox();const o=this._viewer.scene.getBounds(!0,!0);o.getSize(new u.Pa4).length()>.01&&(this._placementBox=new XT(o,i,this.placeOnWall),t.add(this._placementBox),this._placementBox.show=!1);const l=i.getWorldDirection(new u.Pa4);t.rotation.y=Math.atan2(-l.x,-l.z)-0,n.cameraObject.zoom=s.zoom,n.cameraObject.near=s.near,n.cameraObject.far=s.far,n.cameraObject.userData.autoNearFar=!1,n.cameraObject.isPerspectiveCamera?(n.cameraObject.fov=s.fov,n.cameraObject.aspect=s.viewport.width/s.viewport.height):console.warn("Perspective camera required."),n.cameraObject.updateProjectionMatrix();const h=t.userData.arScale||1;t.scale.set(h,h,h),t.position.copy(i.position).add(l.multiplyScalar(5)),t.visible=!0;const d=(e=this._viewer)==null?void 0:e.getPluginByType("Ground");d!=null&&d.mesh&&(d.shadowBaker.enabled=!1,d.renderToDepth=!1)}_restorePreXRState(){if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const a=this._viewer.scene.modelRoot;a.scale.copy(this._preXRState.modelScale),a.position.copy(this._preXRState.modelPosition),a.quaternion.copy(this._preXRState.modelRotation),a.updateMatrix(),a.updateMatrixWorld(!0),a.visible=!0;const e=this._viewer.scene.activeCamera;e.position.copy(this._preXRState.cameraPosition),e.target.copy(this._preXRState.cameraTarget),e.cameraObject.up.copy(this._preXRState.cameraUp),e.cameraObject.near=this._preXRState.cameraNear,e.cameraObject.far=this._preXRState.cameraFar,e.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(e.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(e.cameraObject.aspect=this._preXRState.cameraAspect)),e.positionUpdated(!1),e.targetUpdated(!0),e.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),e.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),e.cameraObject.updateMatrixWorld(!0),e.cameraObject.updateProjectionMatrix();const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(t.mesh.modelObject.position.subVectors(a.position,this._preXRState.groundOffset),t.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),t.mesh.modelObject.rotation.z=this._preXRState.groundRotation,t.renderToDepth=this._preXRState.groundRenderToDepth,t.shadowBaker.enabled=this._preXRState.groundShadowBaker,t.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};zp.PluginType="WEBXR_ARPlugin",l0([sn("Light Estimate")],zp.prototype,"estimateLighting",void 0),l0([sn("Place on Wall")],zp.prototype,"placeOnWall",void 0),l0([gn("Resilution scale",[.1,1],.1)],zp.prototype,"xrResolutionScale",void 0),l0([Bi("Enter AR")],zp.prototype,"enterAR",void 0),l0([Bi("Exit AR")],zp.prototype,"exitAR",void 0),zp=l0([Vn("WebXR AR")],zp);const c0=new vi({vertexShader:O.vertexShader,fragmentShader:`
        ${ga}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...O.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});c0.renderToScreen=!1,c0.useExistingRenderTarget=!0,c0.clear=!1;class Aw extends g.SimpleEventDispatcher{get state(){return this._state}setState(e,t){this._state=e,this.dispatchEvent({type:e,...t})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=n=>{n.data&&n.data.size>0&&this._currentRecording.push(n.data)},this._canvas=e,t==null||t.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(t||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()})}}class KT extends Aw{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async e=>{const t=await(e==null?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._frameCount=0,this.setState("recording")}).catch(e=>{this._onerror({detail:e})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob(t=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t])},e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const t=[];for(const n of e){const i=await this._imgDirectory.getFileHandle(n[0],{create:!0});t.push((0,g.writeFile)(i,n[1]))}await Promise.all(t)}}class AA extends Aw{_setOptions(e){var t;super._setOptions(e),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=AA.GetSupportedMimeTypes([],["h264"],!0)??AA.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!((t=this.options.mimeType)!=null&&t.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(e,t),this._resumeSyncTime=0,this._onstop=n=>{var i;if(this._recorder&&this._currentRecording.length>0){const s=new Blob(this._currentRecording,{type:this.options.mimeType});(i=this._recordingCallback)==null||i.call(this,s)}this._recorder=void 0,this.setState("stopped")},this._onstart=n=>{var i;this._frameCount=0,this.options.stepMode&&((i=this._recorder)==null||i.pause()),this.setState("recording")},this._onresume=n=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const i=()=>{var o;this.state==="recording"&&((o=this._recorder)==null||o.pause())},s=Math.min(this._resumeSyncTime-(0,g.now)(),0)+1e3/this.options.frameRate;s>0?(0,g.timeout)(s).then(i):i()},this._onerror=n=>{this.setState("error",{error:n}),this._console.error(n),this._recorder=void 0}}start(){var e,t,n;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const i={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(e=i.mimeType)==null?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const s=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),o=(t=s.getVideoTracks())==null?void 0:t[0];this._track=o,this._recorder=new window.MediaRecorder(s,i),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((n=this._recorder)==null||n.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,g.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter(l=>!e||e.length<1||e.includes(l)),s=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(l=>!t||t.length<1||t.includes(l)),o=[];return i.forEach(l=>{const h=`video/${l}`;s.forEach(d=>{[`${h};codecs=${d}`,`${h};codecs:${d}`,`${h};codecs=${d.toUpperCase()}`,`${h};codecs:${d.toUpperCase()}`,`${h}`].forEach(f=>{MediaRecorder.isTypeSupported(f)&&o.push(f)})})}),n?o.length>0?o[0]:void 0:o}}class u0 extends Aw{constructor(e,t){super(e,t),this._workerRunning=!1,this.worker=new Worker((0,g.remoteWorkerURL)(u0.LIBRARY_PATH+"ffmpeg-worker-mp4.js",u0.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=n=>{var i;const s=n.data;switch(s.type){case"stdout":case"stderr":if(s.data.indexOf("frame=")===0){const o=parseInt(s.data.split("frame=")[1].split("fps")[0].trim()),l=this._frameCount,h=Math.round(o/l*100);this.dispatchEvent({type:"encode-progress",progress:h,frame:o,totalFrames:l})}console.log(s.data+`
`);break;case"exit":console.log("Process exited with code "+s.data),parseInt(s.data);break;case"done":if(s.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(i=this._recordingCallback)==null||i.call(this,new Blob([s.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const t=this.options.frameRate.toString(),n=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",t,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",n,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob(t=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:t}})},"image/jpeg",90)}pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}}u0.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var yS=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class ah extends Sn{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!1,this.mimeType="image/jpeg",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var e,t,n;if(this.convergeMode&&((e=this._recorder)!=null&&e.isRecording())){const i=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((n=(t=this._viewer)==null?void 0:t.getPluginByType("Progressive"))==null?void 0:n.isConverged())||!1,i&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,t,n;if((e=this._recorder)!=null&&e.isRecording()&&(!this.convergeMode||(n=(t=this._viewer)==null?void 0:t.getPluginByType("Progressive"))!=null&&n.isConverged(!0))){const i=()=>{var s;return(s=this._recorder)==null?void 0:s.requestFrame()};this.convergeMode?(0,g.timeout)(1).then(i):i()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e;(e=this.uiConfig.children)==null||e.map(t=>(0,g.getOrCall)(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t)})},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map(e=>({label:e[0],value:e[1]}))},{type:"input",disabled:!0,label:"State",getValue:()=>{var e;return((e=this.recorder)==null?void 0:e.state)??"not initialized"}},{type:"button",label:()=>{var e;return(e=this.recorder)!=null&&e.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var e;(e=this.recorder)!=null&&e.isRecording()?this.stopRecording().then(async t=>{if(t){const n=t.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(t,n)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var e,t;return!!((e=this.recorder)!=null&&e.isRecording())||!((t=this._viewer)!=null&&t.getPluginByType("CameraViews"))},value:()=>{var e,t;(t=(e=this._viewer)==null?void 0:e.getPluginByType("CameraViews"))==null||t.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var e,t,n,i;return!!((e=this.recorder)!=null&&e.isRecording())||!((t=this._viewer)!=null&&t.getPluginByType("CameraViews"))||!((i=(n=this._viewer)==null?void 0:n.getPluginByType("GLTFAnimation"))!=null&&i.animations.length)},value:()=>{var e,t,n,i;const s=((t=(e=this._viewer)==null?void 0:e.getPluginByType("GLTFAnimation"))==null?void 0:t.animationState)==="playing";(i=(n=this._viewer)==null?void 0:n.getPluginByType("CameraViews"))==null||i.recordAllViews(()=>{var o,l;(l=(o=this._viewer)==null?void 0:o.getPluginByType("GLTFAnimation"))==null||l.playAnimation()}).then(()=>{var o,l;s||((l=(o=this._viewer)==null?void 0:o.getPluginByType("GLTFAnimation"))==null||l.stopAnimation())})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var e,t,n;return!!((e=this.recorder)!=null&&e.isRecording())||!((n=(t=this._viewer)==null?void 0:t.getPluginByType("GLTFAnimation"))!=null&&n.animations.length)},value:async()=>{var e,t;if((e=this.recorder)!=null&&e.isRecording())return;const n=(t=this._viewer)==null?void 0:t.getPluginByType("GLTFAnimation");if(!n)return;let i=!1;n.loopAnimations&&(i=!0),i&&(n.loopAnimations=!1);const s=await this.record(async()=>n.playAnimation());if(i&&(n.loopAnimations=!0),s){const o=s.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(s,o)}}},{type:"button",limitedUi:!0,label:"Record 360 animation",hidden:()=>{var e;return!!((e=this.recorder)!=null&&e.isRecording())},value:async()=>{var e;if((e=this.recorder)!=null&&e.isRecording()||!this._viewer)return;const t=await this._viewer.prompt("Enter duration in seconds","5",!0);if(t===null)return;const n=parseFloat(t||"5");if(!isFinite(n)||n<=0)return;const i=await this.recordCamera360(n);if(i){const s=i.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(i,s)}}}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var e;return((e=this._recorder)==null?void 0:e.isRecording())??!1}refreshRecorderOptions(){if(!this._viewer)return;let e="image";this.mimeType==="video/mp4"?e="ffmpeg.js":this.mimeType==="auto"?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){var t;await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(t=e.canvas.parentElement)==null||t.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){var t,n;this.dirty=e,(t=this._viewer)==null||t.setDirty(),(n=this.uiConfig.children)==null||n.map(i=>(0,g.getOrCall)(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)==null?void 0:s.call(i)})}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(t=this._recorder)==null||t.dispose(),Object.values(this._recorders).forEach(n=>{n==null||n.dispose()}),super.onRemove(e)}async record(e,t){var n;if(this.enabled&&!((n=this._recorder)!=null&&n.isRecording()))return await new Promise((i,s)=>{const o=()=>{this.removeEventListener("start",l),this.removeEventListener("stop",o),this.removeEventListener("error",h)},l=async()=>{o(),t==null||t(),await e(),i()},h=async()=>{o(),s()};this.addEventListener("start",l),this.addEventListener("stop",o),this.addEventListener("error",h),this.startRecording()}),await this.stopRecording()}startRecording(){var e;return!!this.enabled&&((e=this.recorder)==null?void 0:e.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if((e=this.recorder)!=null&&e.isRecording())return new Promise((t,n)=>{var i;return(i=this.recorder)==null?void 0:i.stop(t)})}async _downloadBlob(e,t){var n,i,s;const o=await((n=this._viewer)==null?void 0:n.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),l=(i=this._viewer)==null?void 0:i.getPluginByType("FileTransferPlugin");l?await l.exportFile(e,o||"recording.mp4"):(s=this._viewer)==null||s.console.error("FileTransferPlugin required to export/download file")}async recordCamera360(e){var t;if((t=this.recorder)!=null&&t.isRecording()||!this._viewer)return;const n=this._viewer.scene.activeCamera;let i=n.interactionsEnabled;for(;!i;)this._viewer.setDirty(),await this._viewer.doOnce("postFrame"),this._viewer.console.warn("interactions are already disabled by something, waiting..."),i=n.interactionsEnabled;i&&(n.interactionsEnabled=!1);const s=n.target.clone(),o=n.position.clone().sub(s),l=await this._viewer.getPluginByType("PopmotionPlugin");if(!l)return void console.error("Popmotion plugin not found");const h=new u.$V().setFromVector3(o);n.position.setFromSpherical(h).add(s),n.positionUpdated(!0);const d=n.autoLookAtTarget;n.autoLookAtTarget=!0;const f=await this.record(async()=>l.animate({from:h.theta,to:h.theta+2*Math.PI,duration:1e3*e,ease:Zh.linear,onUpdate:v=>{h.theta=v,n.position.setFromSpherical(h).add(s),n.positionUpdated(!0)}}).promise);return n.autoLookAtTarget=d,n.position.copy(o).add(s),n.positionUpdated(!0),i&&(n.interactionsEnabled=!0),f}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let t;return t=e==="canvas-media"?new AA(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):e==="ffmpeg.js"?new u0(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new KT(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),t.addEventListener("starting",()=>this._stateChange(!1)),t.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),t.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),t.addEventListener("paused",()=>this._stateChange(!1)),t.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),t.addEventListener("encode-progress",n=>{this.dispatchEvent({...n})}),this._recorders[e]=t,t}}ah.PluginType="CanvasRecorder",yS([(0,g.onChange)(ah.prototype.refreshRecorderOptions),ke()],ah.prototype,"convergeMode",void 0),yS([(0,g.onChange)(ah.prototype.refreshRecorderOptions),ke()],ah.prototype,"mimeType",void 0),yS([(0,g.onChange)(ah.prototype.refreshRecorderOptions),ke()],ah.prototype,"videoFrameRate",void 0);var bw=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const AS=new u.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});AS.depthTest=!1;const bS=new u.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});bS.depthTest=!1;class Dc extends Qo{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new u.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(Wl)}async onAdded(e){const t=e.renderer.createTarget({type:u.ywz,format:u.wk1,colorSpace:u.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:u.wem,magFilter:u.wem});t.texture.name="groundContactDepthTexture";const n=new u.lRF({depthPacking:u.z81});n.onBeforeCompile=function(s){s.uniforms.opacity.value=1,s.fragmentShader=`
						${s.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const i=new eo(t,n,new u.Ilk(0,0,0),0);this._depthPass=i,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:u.ywz,format:u.wk1,colorSpace:u.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:u.wem,magFilter:u.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(AS.uniforms.h.value=t*this.blurAmount/256,bS.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:AS,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:bS,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new u.Pa4)),this.shadowCamera.setRotationFromEuler(new u.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const t=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)==null?void 0:e.target.texture)||null,t&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),t}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function JT(a,e,t,n){a.traverse(i=>{i&&(i.userData.cloneRotI=e,i.userData.rotationCount=t,i.userData.rotationAxis=n,i.addEventListener("beforeRender",s=>function(o,l){var h;l&&((h=l.map)!=null&&h.isTexture)&&(l.extraUniformsToUpload||(l.extraUniformsToUpload={}),l.extraUniformsToUpload.uvTransform||(l.extraUniformsToUpload.uvTransform={value:new u.Vkp}),l.extraUniformsToUpload.uvTransform.value.setUvTransform(l.map.offset.x*l.map.repeat.x*o.userData.cloneRotI/(o.userData.rotationCount||1),l.map.offset.y*l.map.repeat.y*o.userData.cloneRotI/(o.userData.rotationCount||1),l.map.repeat.x,l.map.repeat.y,l.map.rotation,l.map.center.x,l.map.center.y))}(i,s.material)))})}function ZT(a,e,t,n="x"){if(a.userData.rotationCount>1&&!a.userData.rotationRoot)return a;const i=a.parent;if(!i)throw new Error("No parent");if(a.userData.cloneParent){const o=a.userData.cloneParent;if(!(a=i.children.find(l=>o===l.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",o,i),a}let s=i.children.filter(o=>{var l;return((l=o.userData)==null?void 0:l.cloneParent)===a.uuid}).sort((o,l)=>o.userData.cloneRotI-l.userData.cloneRotI);if(a.userData.rotationCount===e&&e===s.length&&t===void 0&&a.userData.rotationAxis===n)return a;if(t==null&&(t=a.userData.rotationSkips??[]),t!==a.userData.rotationSkips&&(a.userData.rotationSkips=[...t]),JT(a,0,e,n),a.userData.rotationRoot=!0,a.visible=!0,e<=s.length){for(let o=e-1;o<s.length;o++)i.remove(s[o]),s[o].traverse(l=>l.userData={__disposed:!0});s=s.slice(0,e)}for(let o=1;o<e;o++){const l=o<=s.length?s[o-1]:a.clone();l.rotation.copy(a.rotation),l.rotation[n]+=o/e*Math.PI*2,JT(l,o,e,n),o>s.length&&i.add(l),l.visible=!t.includes(o)}return a.visible=!t.includes(0),a}Dc.PluginType="ContactShadowGroundPlugin",bw([(0,g.onChange)(Dc.prototype.refreshOptions),ke()],Dc.prototype,"contactShadows",void 0),bw([ke(),(0,g.onChange)(Dc.prototype._setDirty)],Dc.prototype,"blurAmount",void 0),bw([ke(),(0,g.onChange)(Dc.prototype._refreshShadowCameraFrustum)],Dc.prototype,"shadowScale",void 0),bw([ke(),(0,g.onChange)(Dc.prototype._refreshShadowCameraFrustum)],Dc.prototype,"shadowHeight",void 0);var h0,bA=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let oh=h0=class extends Sn{async onAdded(a){var e;await super.onAdded(a),(e=a.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}_selectedObjectChanged(){var a,e,t,n,i,s,o;if(!this.enabled)return;const l=(e=(a=this._viewer)==null?void 0:a.getPluginByType("Picking"))==null?void 0:e.getSelectedObject();if(!l)return void((n=(t=this.uiConfig).uiRefresh)==null?void 0:n.call(t,"postFrame",!0));const h=l.userData.rotationRoot?l.userData.rotationCount??1:1;this.rotations=h,this.skips=((i=l.userData.rotationSkips)==null?void 0:i.join(","))??"",this.axis=l.userData.rotationAxis||"x",(o=(s=this.uiConfig).uiRefresh)==null||o.call(s,"postFrame",!0)}_paramsChanged(){var a,e,t,n,i,s;if(!this.enabled)return;const o=(e=(a=this._viewer)==null?void 0:a.getPluginByType("Picking"))==null?void 0:e.getSelectedObject();if(o){if(this.rotations>1||o.userData.rotationCount){const l=o.userData.rotationCount,h=ZT(o,this.rotations,this.skips.split(",").map(f=>parseInt(f)).filter(f=>isFinite(f)),this.axis),d=h==null?void 0:h.userData.rotationCount;if(d&&d!==l){const f=[];h==null||h.traverseAncestors(v=>{f.push(v)});for(const v of f)if(v.userData.autoScaled){Ni(v),(t=this._viewer)==null||t.resetCamera({rootObject:v,centerOffset:new u.Pa4(4,4,4)});break}}o.parent&&!o.userData.__disposed||((i=(n=this._viewer)==null?void 0:n.getPluginByType("Picking"))==null||i.setSelectedObject(h,!0))}(s=this._viewer)==null||s.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};oh.PluginType="ObjectRotationPlugin",bA([ke(),sn("Enabled"),(0,g.onChange)(h0.prototype._paramsChanged)],oh.prototype,"enabled",void 0),bA([gn("Rotation Count",[1,100],1,a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!a.rotations}})),(0,g.onChange)(h0.prototype._paramsChanged)],oh.prototype,"rotations",void 0),bA([Eo("Axis",["x","y","z"].map(a=>({label:a})),a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!a.rotations}})),(0,g.onChange)(h0.prototype._paramsChanged)],oh.prototype,"axis",void 0),bA([gi("Rotation Skips",a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!a.rotations}})),(0,g.onChange)(h0.prototype._paramsChanged)],oh.prototype,"skips",void 0),oh=h0=bA([Vn("Object Rotations")],oh);var ov,d0=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let cu=ov=class extends Sn{constructor(a=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,n)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const i of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=_n(e.fragmentShader,`#include <${i}>`,u.WdD[i].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=_n(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=_n(e.fragmentShader,"#include <normal_fragment_maps>",_n(_n(u.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+((t=e.materialObject.bumpMap)==null?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},n)=>{if(this.enabled)for(const[i,s]of Object.entries(this._defines)){const o=typeof s=="number"?s:s?1:0;t.defines[i]!==o&&(t.defines[i]=o,t.needsUpdate=!0)}}},this.dependencies=[Yt],this.enabled=a,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var a,e,t;(e=(a=this._bumpMapExtension)==null?void 0:a.setDirty)==null||e.call(a),(t=this._viewer)==null||t.setDirty()}async onAdded(a){var e,t;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.registerMaterialExtension(this._bumpMapExtension),super.onAdded(a)}async onRemove(a){var e,t;return(t=(e=a.getPlugin(Yt))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(a)}};cu.PluginType="ReliefParallaxMapping",d0([(0,g.onChange)(ov.prototype._updateExtension),ke(),sn("Enabled")],cu.prototype,"enabled",void 0),d0([(0,g.onChange)(ov.prototype._updateExtension),sn("Debug Normals")],cu.prototype,"debugNormals",void 0),d0([(0,g.onChange)(ov.prototype._updateExtension),sn("Debug Hit Height")],cu.prototype,"debugHitHeight",void 0),d0([cn("PARALLAX_MAP_STEPS",void 0,!0,ov.prototype._updateExtension),gn("Step count",[1,32],1),ke()],cu.prototype,"stepCount",void 0),d0([cn("PARALLAX_MAP_B_STEPS",void 0,!0,ov.prototype._updateExtension),gn("Binary search steps",[1,8],1),ke()],cu.prototype,"binaryStepCount",void 0),cu=ov=d0([Vn("Parallax Mapping")],cu);class xS extends u.u9r{constructor(e,t,n=32,i=64,s=!1,o=new u.FM8(1,1),l="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:n,tubularSegments:i,closed:s,primary:l,shapeScale:o.clone()};const h=t.computeFrenetFrames(i,s);this.frames=h;const d=new u.Pa4,f=new u.Pa4,v=new u.Pa4,y=new u.FM8;let w=new u.Pa4;const E=[],M=[],P=[],L=e.getSpacedPoints(n);for(const N of L)N.multiply(o);(function(){for(let N=0;N<i;N++)I(N);I(s===!1?i:0),function(){for(let N=0;N<=i;N++)for(let j=0;j<=n;j++)y.x=N/i,y.y=j/n,M.push(y.x,y.y)}(),function(){const N=l==="shape",j=N?n:i,H=N?i:n;for(let X=1;X<=j;X++)for(let ne=1;ne<=H;ne++){const[pe,Ae]=N?[ne,X]:[X,ne],ve=(n+1)*(pe-1)+(Ae-1),Ee=(n+1)*pe+(Ae-1),xe=(n+1)*pe+Ae,we=(n+1)*(pe-1)+Ae;P.push(ve,Ee,we),P.push(Ee,xe,we)}}()})(),this.setIndex(P),this.setAttribute("position",new u.a$l(E,3)),this.setAttribute("uv",new u.a$l(M,2)),this.computeVertexNormals();const R=this.attributes.normal;function I(N){w=t.getPointAt(N/i,w);const j=h.normals[N],H=h.binormals[N];for(let X=0;X<=n;X++){const ne=L[X%n];f.set(0,0,0).addScaledVector(j,ne.x).addScaledVector(H,ne.y),d.copy(w).add(f),E.push(d.x,d.y,d.z)}}(function(){for(let j=1;j<n;j++){const H=j+i*(n+1);f.fromBufferAttribute(R,j),v.fromBufferAttribute(R,H),f.add(v).normalize(),R.setXYZ(j,f.x,f.y,f.z),R.setXYZ(H,f.x,f.y,f.z)}for(let j=1;j<i;j++){const H=j*(n+1),X=H+n;f.fromBufferAttribute(R,H),v.fromBufferAttribute(R,X),f.add(v).normalize(),R.setXYZ(H,f.x,f.y,f.z),R.setXYZ(X,f.x,f.y,f.z)}f.fromBufferAttribute(R,0),v.fromBufferAttribute(R,n),f.add(v);const N=i*(n+1);v.fromBufferAttribute(R,N),f.add(v),v.fromBufferAttribute(R,N+n),f.add(v),f.normalize(),R.setXYZ(0,f.x,f.y,f.z),R.setXYZ(n,f.x,f.y,f.z),R.setXYZ(N,f.x,f.y,f.z),R.setXYZ(N+n,f.x,f.y,f.z),R.needsUpdate=!0})()}createSplits(e){this.clearGroups();const t=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,n=this.index.count,i=[...e,1].sort((l,h)=>l-h);let s=0,o=0;for(const l of i){const h=Math.round(t*l)*n/t;this.addGroup(s,h-s,o++),s=h}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var wS,wm=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let $l=wS=class extends Sn{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new u.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var a,e;const t=(e=(a=this._viewer)==null?void 0:a.getPlugin(Ti))==null?void 0:e.getSelectedObject();if(!t)return;let n=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!n)return;n=parseFloat(n);const i=new ES(0,0,n,n,0,2*Math.PI,!0,0);await this.extrudeObject(t,i)}}async onAdded(a){await super.onAdded(a)}static CreateCurve(a,e){if(a==="circle")return new ES(0,0,e.radius??1,e.radius??1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(a,e,t=this.shapeSegments,n=this.tubularSegments,i=this.shapeScale,s=this.materialSplits.split(",").map(l=>parseFloat(l.trim())),o=this.horizontalSplits){var l,h,d,f,v,y,w,E;if(a.userData.isExtrudedTube,a.userData._extrudeSource){const N=a.userData._extrudeSource;if(a=(l=a.parent)==null?void 0:l.children.find(j=>N===j.uuid),!a)return void console.warn("Could not find extrude source with uuid",N)}if(a.userData.extrudedObject){const N=a.userData.extrudedObject,j=(h=a.parent)==null?void 0:h.children.find(H=>N===H.uuid);j&&(j.removeFromParent(),j.geometry.dispose(),j.geometry=null,j.material=null),delete a.userData.extrudedObject}const M=a.geometry;if(!M)return void((d=this._viewer)==null?void 0:d.alert("Extrude: No geometry to extrude"));const P=[a.material];let L;try{const N=wS.ConvertGeometryToFlatShape(M);L=new xS(N,e,t,n,!0,i,o?"shape":"path"),L.computeBoundingBox(),L.createSplits(s)}catch(N){return void((f=this._viewer)==null?void 0:f.alert(typeof N=="string"?N:N==null?void 0:N.message))}P[0].color.set(16777215);for(let N=P.length;N<L.groups.length;N++){const j=P[0].clone();P.push(j),j.color.set(16777215*Math.random())}const R=new u.Kj0(L,P);R.userData._extrudeSource=a.uuid,R.userData.isExtrudedTube=!0,a.visible=!1,a.userData.bboxVisible=!1,R.name=a.name+"_extruded";const I=await((w=(y=(v=this._viewer)==null?void 0:v.getManager())==null?void 0:y.importer)==null?void 0:w.processImportedSingle(R,{autoCenter:!1,autoScale:!1}));I&&((E=a.parent)==null||E.add(I.modelObject),a.userData.extrudedObject=I.modelObject.uuid,I.dispatchEvent({type:"select",ui:!0,value:I}))}static ExtrudeShape(a,e,t,n,i,s,o,l){const h=new xS(a,n,e,t,!0,new u.FM8(i,s),l?"shape":"path");h.computeBoundingBox(),h.createSplits(o);const d=new u.Kj0(h,[]);return d.userData.isExtrudedTube=!0,d}static ConvertGeometryToFlatShape(a,e=!0){if(a.userData.__planarShape)return a.userData.__planarShape;let t=a.attributes.position;if(!t)throw"no position attribute";if(t.count>500)throw"too large to extrude";const n=a;t=n.attributes.position,n.boundingBox||n.computeBoundingBox();const i=n.boundingBox.getSize(new u.Pa4),s=i.x<.001?"x":i.y<.001?"y":i.z<.001?"z":null;if(!s)throw"geometry is not axis aligned not planar";let o=[];for(let h=0;h<t.count;h++){const d=new u.FM8;s==="x"?d.set(t.getY(h),t.getZ(h)):s==="y"?d.set(t.getX(h),t.getZ(h)):d.set(t.getX(h),t.getY(h)),o.push(d)}if(e){let h=0;for(let d=0;d<o.length;d++)(o[d].x<o[h].x||o[d].x===o[h].x&&o[d].y<o[h].y)&&(h=d);h!==0&&(o=o.slice(h).concat(o.slice(0,h)))}const l=new u.bnF(o);return a.userData.__planarShape=l,l}};$l.PluginType="ShapeTubeExtrudePlugin",wm([sn("Enabled")],$l.prototype,"enabled",void 0),wm([gn("Shape Segments (X)",[1,100],1,a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],$l.prototype,"shapeSegments",void 0),wm([gn("Tube Segments (Y)",[1,100],1,a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],$l.prototype,"tubularSegments",void 0),wm([Ks("Shape scale",[.01,10],.01,a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],$l.prototype,"shapeScale",void 0),wm([gi("Material Splits",a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],$l.prototype,"materialSplits",void 0),wm([sn("Horizontal Splits",a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],$l.prototype,"horizontalSplits",void 0),wm([Bi("Extrude Circle Tube",a=>({hidden:()=>{var e,t;return!((t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))!=null&&t.getSelectedObject())}}))],$l.prototype,"extrudeCirceTube",void 0),$l=wS=wm([Vn("Extrude Tube Shapes")],$l);class ES extends u.Ny0{getPoint(e,t){return super.getPoint(e,t||new u.Pa4)}}class p0 extends Sn{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var t,n;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))==null||t.enable(p0.PluginType),this._fadeDisabled=!1));const i=(0,g.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=i-1/60);let s=i-this._lastFrameTime;this._lastFrameTime=i;const o=(n=this._viewer.getPluginByType("Progressive"))==null?void 0:n.postFrameConvergedRecordingDelta();if(o&&o>0&&(s=o),o!==0&&(s*=1e3,!(s<=.001)&&(this._updaters.forEach(l=>{let h=s;l.time+h<0&&(h=-l.time),l.time+=h,Math.abs(h)>.001&&l.u(h)}),!this._fadeDisabled&&this.disableFrameFade))){const l=this._viewer.getPluginByType("FrameFade");l&&(l.disable(p0.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=t=>({start:()=>this._updaters.push({u:t,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(n=>n.u===t),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=Ys(),n={id:t,options:e,stop:()=>{var i,s,o;(i=this.animations[t])!=null&&i._stop?(o=(s=this.animations[t])==null?void 0:s._stop)==null||o.call(s):console.warn("Animation not started")}};return this.animations[t]=n,n.promise=new Promise((i,s)=>{const o={driver:this.defaultDriver,...e,onComplete:()=>{var h;try{(h=e.onComplete)==null||h.call(e)}catch(d){return void s(d)}i()},onStop:()=>{var h;try{(h=e.onStop)==null||h.call(e)}catch(d){return void s(d)}i()}},l=nu(o);this.animations[t]._stop=l.stop,this.animations[t].options=o}).then(()=>(delete this.animations[t],t)),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}p0.PluginType="PopmotionPlugin";var SS,lh,us=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const qo=a=>({onChange:e=>{e.last&&a.onChange()}});let ha=SS=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(a){Object.assign(this,a)}reset(){const a=this.onChange;Object.assign(this,new SS),this.onChange=a}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};us([gi("Text",qo)],ha.prototype,"text",void 0),us([gn("Font Size",[2,400],1,qo)],ha.prototype,"fontSize",void 0),us([gn("Width",[2,4096],1,qo)],ha.prototype,"width",void 0),us([gn("Height",[2,4096],1,qo)],ha.prototype,"height",void 0),us([gn("X Offset",[-1024,1024],1,qo)],ha.prototype,"xOffset",void 0),us([gn("Y Offset",[-1024,1024],1,qo)],ha.prototype,"yOffset",void 0),us([gn("V-Width",[2,4096],1,qo)],ha.prototype,"boxWidth",void 0),us([gn("V-Height",[2,4096],1,qo)],ha.prototype,"boxHeight",void 0),us([Eo("Text Anchor",["start","middle","end"].map(a=>({label:a})),qo)],ha.prototype,"textAnchor",void 0),us([gi("Font",qo)],ha.prototype,"fontFamily",void 0),us([gi("Font Url",qo)],ha.prototype,"fontPath",void 0),us([sn("Mask Text",qo)],ha.prototype,"maskText",void 0),us([sn("Inner Shadow",qo)],ha.prototype,"innerShadow",void 0),us([lc("Text Color",qo)],ha.prototype,"textColor",void 0),us([lc("BG Fill",qo)],ha.prototype,"bgFillColor",void 0),us([lc("SVG BG",qo)],ha.prototype,"svgBackground",void 0),ha=SS=us([Vn("Text SVG Options")],ha);const $T={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},xA=a=>({hidden:()=>{const e=a.getSelected();return!e||!e.userData[ec.PluginType]}});let ec=lh=class extends Sn{async onAdded(a){var e;await super.onAdded(a),(e=a.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var a,e;return(e=(a=this._viewer)==null?void 0:a.getPluginByType("Picking"))==null?void 0:e.getSelectedObject()},this.options=new ha,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var a,e,t,n,i,s;if(!this.enabled)return;const o=this.getSelected();if(!o)return void((e=(a=this.uiConfig).uiRefresh)==null?void 0:e.call(a,"postFrame",!0));const l=o.userData[lh.PluginType];if(!l)return this.options.reset(),this._lastMeta=void 0,void((n=(t=this.uiConfig).uiRefresh)==null?void 0:n.call(t,"postFrame",!0));this._lastMeta!==l&&(this.options.set(l),this._lastMeta=l),(s=(i=this.uiConfig).uiRefresh)==null||s.call(i,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const a=this.getSelected();a&&a.isMesh&&a.userData[lh.PluginType]&&this.updateText(a,this.options.toJSON())}async addTextToSelected(){var a;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[lh.PluginType]||!e.material.map||await((a=this._viewer)==null?void 0:a.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(a,e){return this.updateText(a,Object.assign(this.options.toJSON(),e))}async updateText(a,e){var t,n;if(!a.isMesh)return;if(!a.material)return void console.error("updateText: no material on mesh");let i=a.userData[lh.PluginType];i||(a.userData[lh.PluginType]=i={}),Object.assign(i,e);const s=a.material;s.map&&(s.map._isSimpleTextTexture&&s.map.dispose(),s.map=void 0),s.alphaMap&&(s.alphaMap._isSimpleTextTexture&&s.alphaMap.dispose(),s.alphaMap=void 0),s.bumpMap&&(s.bumpMap._isSimpleTextTexture&&s.bumpMap.dispose(),s.bumpMap=void 0);const o=await this.makeTextSvg(i);this.applyToMap&&(s.map=o),this.applyToAlphaMap&&(s.alphaMap=o,s.transparent=!0),this.applyToBumpMap&&(s.bumpMap=o),s.userData.inverseAlphaMap=this.inverseAlphaMap,s.setDirty(),s.needsUpdate=!0,(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}async makeTextSvg(a){const e=a.fontFamily||"Arial",t=a.fontPath||this.fonts[e]||"";let n=a.style;if(t.length>0){const o=t.split("?")[0].split(".").pop()||"woff";n+=`
`+(t.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${t}) format(${$T[o]||o});
            }`:"")}let i=function({text:o="Custom Text",svgBackground:l="#ffffff",xOffset:h=0,yOffset:d=0,width:f=1024,height:v=1024,boxWidth:y=1024,boxHeight:w=1024,fontFamily:E="",fontSize:M=32,maskText:P=!0,innerShadow:L=!0,bgFillColor:R="#000000",textColor:I="#ffffff",textAnchor:N="middle",style:j=""}){return`
<svg style="background-color:${l}" width="${f}" height="${v}" viewBox="0 0 ${y} ${w}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${j}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${N}; font-size: ${M}px; font-family: ${E||"Arial"}">
        <defs>

`+(P?`
<mask id="textMask">
<text style="fill:white; font-size: ${M}px;" x="${h+y/2}" y="${w/2+d+M/4}" > ${o} </text>
</mask>
`:"")+`

`+(L?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(P?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${y}" height="${w}" style="fill:${R}"/>
        <text style="${L?"filter: url(#innerShadow);":""} fill:${I};" x="${h+y/2}" y="${w/2+d+M/4}"> ${o} </text>

`+(P?`
        </g>
`:"")+`

    </g>
</svg>
`}({...a,fontFamily:e,style:n});i=await(0,g.embedUrlRefs)(i,async o=>this._getAssetData(o)),i=(0,g.svgUrl)(i);const s=await this._viewer.getManager().importer.importSinglePath(i,{generateMipmaps:!1,minFilter:u.wem});return s._isSimpleTextTexture=!0,s.flipY=!1,s.needsUpdate=!0,s}async _getAssetData(a){var e,t;if(a.startsWith("http://www.w3.org"))return a;const n=(t=(e=this._viewer)==null?void 0:e.getManager())==null?void 0:t.importer;if(!n)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new uC(n.loadingManager),processImported:!1};try{return await n.importPath(a,this._assetLoadOptions)}catch(i){return console.error(i),""}}};ec.PluginType="SimpleTextPlugin",us([ma(void 0,{params:xA})],ec.prototype,"options",void 0),us([sn("Apply Map",xA),(0,g.onChange)(lh.prototype._paramsChanged)],ec.prototype,"applyToMap",void 0),us([sn("Apply Bump Map",xA),(0,g.onChange)(lh.prototype._paramsChanged)],ec.prototype,"applyToBumpMap",void 0),us([sn("Apply Alpha Map",xA),(0,g.onChange)(lh.prototype._paramsChanged)],ec.prototype,"applyToAlphaMap",void 0),us([sn("Invert Alpha Map",xA),(0,g.onChange)(lh.prototype._paramsChanged)],ec.prototype,"inverseAlphaMap",void 0),us([Bi("Add Text",a=>({hidden:()=>!a.getSelected()}))],ec.prototype,"addTextToSelected",null),ec=lh=us([Vn("Simple Text")],ec);class MS{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class bB{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class Ed{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new Ed;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,n=new Array;for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new Ed),this.front.build(t)),n.length&&(this.back||(this.back=new Ed),this.back.build(n))}}class tc{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new tc(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(new tc().copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),n=t.x,i=t.y,s=t.z,o=e.x,l=e.y,h=e.z;return this.x=i*h-s*l,this.y=s*o-n*h,this.z=n*l-i*o,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new u.Pa4(this.x,this.y,this.z)}}class lv{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new lv(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,n,i,s){let o=0;const l=[];for(let h=0;h<e.vertices.length;h++){const d=this.normal.dot(e.vertices[h].pos)-this.w,f=d<-lv.EPSILON?2:d>lv.EPSILON?1:0;o|=f,l.push(f)}switch(o){case 0:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case 1:i.push(e);break;case 2:s.push(e);break;case 3:{const h=[],d=[];for(let f=0;f<e.vertices.length;f++){const v=(f+1)%e.vertices.length,y=l[f],w=l[v],E=e.vertices[f],M=e.vertices[v];if(y!=2&&h.push(E),y!=1&&d.push(y!=2?E.clone():E),(y|w)==3){const P=(this.w-this.normal.dot(E.pos))/this.normal.dot(new tc().copy(M.pos).sub(E.pos)),L=E.interpolate(M,P);h.push(L),d.push(L.clone())}}h.length>=3&&i.push(new f0(h,e.shared)),d.length>=3&&s.push(new f0(d,e.shared));break}}}static fromPoints(e,t,n){const i=new tc().copy(t).sub(e).cross(new tc().copy(n).sub(e)).normalize();return new lv(i.clone(),i.dot(e))}}lv.EPSILON=1e-5;class f0{constructor(e,t){this.vertices=e,this.shared=t,this.plane=lv.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new f0(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class xw{constructor(e,t,n,i){this.pos=new tc().copy(e),this.normal=new tc().copy(t),this.uv=new tc().copy(n),this.uv.z=0,i&&(this.color=new tc().copy(i))}clone(){return new xw(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new xw(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class Rs{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new Rs;return t.polygons=e,t}static fromGeometry(e,t){let n=[];const i=e.attributes.position,s=e.attributes.normal,o=e.attributes.uv,l=e.attributes.color,h=e.groups;let d;if(e.index)d=e.index.array;else{d=new Array(i.array.length/i.itemSize|0);for(let v=0;v<d.length;v++)d[v]=v}const f=d.length/3|0;n=new Array(f);for(let v=0,y=0,w=d.length;v<w;v+=3,y++){const E=new Array(3);for(let M=0;M<3;M++){const P=d[v+M],L=3*P,R=2*P,I=i.array[L],N=i.array[L+1],j=i.array[L+2],H=s.array[L],X=s.array[L+1],ne=s.array[L+2],pe=o==null?void 0:o.array[R],Ae=o==null?void 0:o.array[R+1];E[M]=new xw(new tc(I,N,j),new tc(H,X,ne),new tc(pe,Ae,0),l&&new tc(l.array[R],l.array[R+1],l.array[R+2]))}if(t===void 0&&h&&h.length>0)for(const M of h)v>=M.start&&v<M.start+M.count&&(n[y]=new f0(E,M.materialIndex));else n[y]=new f0(E,t)}return Rs.fromPolygons(n.filter(v=>!isNaN(v.plane.normal.x)))}static toGeometry(e,t){let n=0;const i=e.polygons;for(const w of i)n+=w.vertices.length-2;const s=new u.u9r,o=new MS(3*n*3),l=new MS(3*n*3),h=new bB(2*n*3);let d;const f=[],v=[];for(const w of i){const E=w.vertices,M=E.length;w.shared!==void 0&&(f[w.shared]||(f[w.shared]=[])),M&&E[0].color!==void 0&&(d||(d=new MS(3*n*3)));for(let P=3;P<=M;P++)(w.shared===void 0?v:f[w.shared]).push(o.top/3,o.top/3+1,o.top/3+2),o.write(E[0].pos),o.write(E[P-2].pos),o.write(E[P-1].pos),l.write(E[0].normal),l.write(E[P-2].normal),l.write(E[P-1].normal),h&&(h.write(E[0].uv),h.write(E[P-2].uv),h.write(E[P-1].uv)),d&&(d.write(E[0].color),d.write(E[P-2].color),d.write(E[P-1].color))}s.setAttribute("position",new u.TlE(o.array,3)),s.setAttribute("normal",new u.TlE(l.array,3)),h&&s.setAttribute("uv",new u.TlE(h.array,2)),d&&s.setAttribute("color",new u.TlE(d.array,3));for(let w=0;w<f.length;w++)f[w]===void 0&&(f[w]=[]);if(f.length){let w=[],E=0;for(let M=0;M<f.length;M++)s.addGroup(E,f[M].length,M),E+=f[M].length,w=w.concat(f[M]);s.addGroup(E,v.length,f.length),w=w.concat(v),s.setIndex(w)}const y=new u.yGw().copy(t).invert();return s.applyMatrix4(y),s.computeBoundingSphere(),s.computeBoundingBox(),s}static fromMesh(e,t){const n=Rs.fromGeometry(e.geometry,t),i=new u.Pa4,s=new u.Vkp;s.getNormalMatrix(e.matrix);for(let o=0;o<n.polygons.length;o++){const l=n.polygons[o];for(let h=0;h<l.vertices.length;h++){const d=l.vertices[h];d.pos.copy(i.copy(d.pos.toVector3()).applyMatrix4(e.matrix)),d.normal.copy(i.copy(d.normal.toVector3()).applyMatrix3(s))}}return n}static toMesh(e,t,n){const i=Rs.toGeometry(e,t),s=new u.Kj0(i,n);return s.matrix.copy(t),s.matrix.decompose(s.position,s.quaternion,s.scale),s.rotation.setFromQuaternion(s.quaternion),s.updateMatrixWorld(),s.castShadow=s.receiveShadow=!0,s}static union(e,t){const n=Rs.fromMesh(e),i=Rs.fromMesh(t);return Rs.toMesh(n.union(i),e.matrix,e.material)}static subtract(e,t){const n=Rs.fromMesh(e),i=Rs.fromMesh(t);return Rs.toMesh(n.subtract(i),e.matrix,e.material)}static intersect(e,t){const n=Rs.fromMesh(e),i=Rs.fromMesh(t);return Rs.toMesh(n.intersect(i),e.matrix,e.material)}clone(){const e=new Rs;return e.polygons=this.polygons.map(t=>t.clone()).filter(t=>Number.isFinite(t.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new Ed(this.clone().polygons),n=new Ed(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),Rs.fromPolygons(t.allPolygons())}subtract(e){const t=new Ed(this.clone().polygons),n=new Ed(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),Rs.fromPolygons(t.allPolygons())}intersect(e){const t=new Ed(this.clone().polygons),n=new Ed(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),Rs.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return Rs.toMesh(this,e,t)}toGeometry(e){return Rs.toGeometry(this,e)}}var m0=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const CS=["union","subtract","intersect"];class jp extends Sn{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Ti],this.rootMesh=new u.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(t=e.getPlugin(Ti))==null||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,t;const n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();n&&n.geometry&&(n.userData._isCSGMesh||(n.userData.csgBrush||(n.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,g.downloadBlob)(e,"csg."+e.ext)}async exportObject(){var e,t;const n=(t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetExporterPlugin"))==null?void 0:t.exporter;if(!n||!this.rootObject)return;const i=this.rootMesh.visible;this.rootMesh.visible=!0;const s=await n.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=i,s}_updateSelectedProperties(){var e,t;const n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();n&&n.userData.csgBrush&&(n.userData.csgBrush.enabled=this.csgSelectedEnabled,n.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,t,n,i,s,o;const l=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();l&&(this.csgSelectedEnabled=((n=l.userData.csgBrush)==null?void 0:n.enabled)??!1,this.csgSelectedOperation=((i=l.userData.csgBrush)==null?void 0:i.operation)??"union"),(o=(s=this.uiConfig)==null?void 0:s.uiRefresh)==null||o.call(s,"postFrame",!0)}_preFrame(){var e,t;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const n=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)==null||e.modelObject.updateMatrixWorld(!0),(this.rootMesh.userData.dispose??this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(n)),this.rootMesh&&!this.rootMesh.parent&&((t=this.rootObject)==null||t.modelObject.add(this.rootMesh)),this.showResult?(n.forEach(i=>{i[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(n.forEach(i=>{i[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const t=[];return(e=this._viewer)==null||e.scene.traverse(n=>{var i;n.isMesh&&n.geometry&&((i=n.userData.csgBrush)!=null&&i.enabled)&&t.push([n,n.userData.csgBrush.operation])}),t}_sceneUpdate(e){var t,n;(n=(t=e==null?void 0:e.object)==null?void 0:t.userData)!=null&&n._isCSGMesh||(this._csgNeedsUpdate=!0)}}m0([sn("Show Result",a=>({onChange:()=>{var e;return(e=a._viewer)==null?void 0:e.setDirty()}}))],jp.prototype,"showResult",void 0),m0([Bi("Make CSG Brush",a=>({hidden:()=>{var e,t;const n=(t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();return!(n!=null&&n.userData)||!!n.userData.csgBrush||n.userData._isCSGMesh}}))],jp.prototype,"makeSelectedCSGBrush",null),m0([sn("Enabled",a=>({hidden:()=>{var e,t;const n=(t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();return!n||!n.userData.csgBrush},onChange:a._updateSelectedProperties}))],jp.prototype,"csgSelectedEnabled",void 0),m0([Eo("Operation",CS.map(a=>({label:a})),a=>({hidden:()=>{var e,t;const n=(t=(e=a._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();return!n||!n.userData.csgBrush},onChange:a._updateSelectedProperties}))],jp.prototype,"csgSelectedOperation",void 0),m0([Bi("Refresh CSG")],jp.prototype,"refreshCSG",null),m0([Bi("Export Result",a=>({hidden:()=>{var e;return!((e=a._viewer)!=null&&e.getPluginByType("AssetExporterPlugin"))}}))],jp.prototype,"downloadObject",null);function eI(a,e){let t=new Rs;const n=a.map(s=>s[0].material).flatMap(s=>s);a.forEach(([s,o])=>{if(!CS.includes(o))return void console.error(`Unknown operation ${o}`);s.updateMatrix(),s.updateMatrixWorld();const l=s.matrix;s.matrix=s.matrixWorld;let h=0;h=Array.isArray(s.material)?void 0:n.indexOf(s.material),t=t[o](Rs.fromMesh(s,h)),s.matrix=l});const i=t.toMesh(e??new u.yGw().identity(),n);return i.userData._isCSGMesh=!0,i.geometry.groups=i.geometry.groups.filter(s=>s.count>0),i}let wA=class extends jp{_buildCSGMesh(a){return eI(a)}};wA.PluginType="CSGPluginBSP",wA=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([Vn("CSG Plugin (BSP)")],wA);const tI=0,nI=1,iI=3,rI=4;class Vp{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,i=-1/0;for(let s=0,o=e.length;s<o;s++){const l=e[s][t];n=l<n?l:n,i=l>i?l:i}this.min=n,this.max=i}setFromPoints(e,t){let n=1/0,i=-1/0;for(let s=0,o=t.length;s<o;s++){const l=t[s],h=e.dot(l);n=h<n?h:n,i=h>i?h:i}this.min=n,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}Vp.prototype.setFromBox=function(){const a=new u.Pa4;return function(e,t){const n=t.min,i=t.max;let s=1/0,o=-1/0;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let d=0;d<=1;d++){a.x=n.x*l+i.x*(1-l),a.y=n.y*h+i.y*(1-h),a.z=n.z*d+i.z*(1-d);const f=e.dot(a);s=Math.min(f,s),o=Math.max(f,o)}this.min=s,this.max=o}}();const xB=function(){const a=new u.Pa4,e=new u.Pa4,t=new u.Pa4;return function(n,i,s){const o=n.start,l=a,h=i.start,d=e;t.subVectors(o,h),a.subVectors(n.end,n.start),e.subVectors(i.end,i.start);const f=t.dot(d),v=d.dot(l),y=d.dot(d),w=t.dot(l),E=l.dot(l)*y-v*v;let M,P;M=E!==0?(f*v-w*y)/E:0,P=(f+M*v)/y,s.x=M,s.y=P}}(),TS=function(){const a=new u.FM8,e=new u.Pa4,t=new u.Pa4;return function(n,i,s,o){xB(n,i,a);let l=a.x,h=a.y;if(l>=0&&l<=1&&h>=0&&h<=1)return n.at(l,s),void i.at(h,o);if(l>=0&&l<=1)return h<0?i.at(0,o):i.at(1,o),void n.closestPointToPoint(o,!0,s);if(h>=0&&h<=1)return l<0?n.at(0,s):n.at(1,s),void i.closestPointToPoint(s,!0,o);{let d,f;d=l<0?n.start:n.end,f=h<0?i.start:i.end;const v=e,y=t;return n.closestPointToPoint(f,!0,e),i.closestPointToPoint(d,!0,t),v.distanceToSquared(f)<=y.distanceToSquared(d)?(s.copy(v),void o.copy(f)):(s.copy(d),void o.copy(y))}}}(),wB=function(){const a=new u.Pa4,e=new u.Pa4,t=new u.JOQ,n=new u.Zzh;return function(i,s){const{radius:o,center:l}=i,{a:h,b:d,c:f}=s;if(n.start=h,n.end=d,n.closestPointToPoint(l,!0,a).distanceTo(l)<=o||(n.start=h,n.end=f,n.closestPointToPoint(l,!0,a).distanceTo(l)<=o)||(n.start=d,n.end=f,n.closestPointToPoint(l,!0,a).distanceTo(l)<=o))return!0;const v=s.getPlane(t);if(Math.abs(v.distanceToPoint(l))<=o){const y=v.projectPoint(l,e);if(s.containsPoint(y))return!0}return!1}}(),EB=1e-15;function g0(a){return Math.abs(a)<EB}class Sd extends u.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new u.Pa4),this.satBounds=new Array(4).fill().map(()=>new Vp),this.points=[this.a,this.b,this.c],this.sphere=new u.aLr,this.plane=new u.JOQ,this.needsUpdate=!0}intersectsSphere(e){return wB(e,this)}update(){const e=this.a,t=this.b,n=this.c,i=this.points,s=this.satAxes,o=this.satBounds,l=s[0],h=o[0];this.getNormal(l),h.setFromPoints(l,i);const d=s[1],f=o[1];d.subVectors(e,t),f.setFromPoints(d,i);const v=s[2],y=o[2];v.subVectors(t,n),y.setFromPoints(v,i);const w=s[3],E=o[3];w.subVectors(n,e),E.setFromPoints(w,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(l,e),this.needsUpdate=!1}}Sd.prototype.closestPointToSegment=function(){const a=new u.Pa4,e=new u.Pa4,t=new u.Zzh;return function(n,i=null,s=null){const{start:o,end:l}=n,h=this.points;let d,f=1/0;for(let v=0;v<3;v++){const y=(v+1)%3;t.start.copy(h[v]),t.end.copy(h[y]),TS(t,n,a,e),d=a.distanceToSquared(e),d<f&&(f=d,i&&i.copy(a),s&&s.copy(e))}return this.closestPointToPoint(o,a),d=o.distanceToSquared(a),d<f&&(f=d,i&&i.copy(a),s&&s.copy(o)),this.closestPointToPoint(l,a),d=l.distanceToSquared(a),d<f&&(f=d,i&&i.copy(a),s&&s.copy(l)),Math.sqrt(f)}}(),Sd.prototype.intersectsTriangle=function(){const a=new Sd,e=new Array(3),t=new Array(3),n=new Vp,i=new Vp,s=new u.Pa4,o=new u.Pa4,l=new u.Pa4,h=new u.Pa4,d=new u.Zzh,f=new u.Zzh,v=new u.Zzh;return function(y,w=null,E=!1){this.needsUpdate&&this.update(),y.isExtendedTriangle?y.needsUpdate&&y.update():(a.copy(y),a.update(),y=a);const M=this.plane,P=y.plane;if(Math.abs(M.normal.dot(P.normal))>1-1e-10){const L=this.satBounds,R=this.satAxes;t[0]=y.a,t[1]=y.b,t[2]=y.c;for(let j=0;j<4;j++){const H=L[j],X=R[j];if(n.setFromPoints(X,t),H.isSeparated(n))return!1}const I=y.satBounds,N=y.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let j=0;j<4;j++){const H=I[j],X=N[j];if(n.setFromPoints(X,e),H.isSeparated(n))return!1}for(let j=0;j<4;j++){const H=R[j];for(let X=0;X<4;X++){const ne=N[X];if(s.crossVectors(H,ne),n.setFromPoints(s,e),i.setFromPoints(s,t),n.isSeparated(i))return!1}}return w&&(E||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),w.start.set(0,0,0),w.end.set(0,0,0)),!0}{const L=this.points;let R=!1,I=0;for(let ve=0;ve<3;ve++){const Ee=L[ve],xe=L[(ve+1)%3];d.start.copy(Ee),d.end.copy(xe),d.delta(o);const we=R?f.start:f.end,Re=g0(P.distanceToPoint(Ee));if(g0(P.normal.dot(o))&&Re){f.copy(d),I=2;break}if((P.intersectLine(d,we)||Re)&&!g0(we.distanceTo(xe))){if(I++,R)break;R=!0}}if(I===1&&y.containsPoint(f.end))return w&&(w.start.copy(f.end),w.end.copy(f.end)),!0;if(I!==2)return!1;const N=y.points;let j=!1,H=0;for(let ve=0;ve<3;ve++){const Ee=N[ve],xe=N[(ve+1)%3];d.start.copy(Ee),d.end.copy(xe),d.delta(l);const we=j?v.start:v.end,Re=g0(M.distanceToPoint(Ee));if(g0(M.normal.dot(l))&&Re){v.copy(d),H=2;break}if((M.intersectLine(d,we)||Re)&&!g0(we.distanceTo(xe))){if(H++,j)break;j=!0}}if(H===1&&this.containsPoint(v.end))return w&&(w.start.copy(v.end),w.end.copy(v.end)),!0;if(H!==2)return!1;if(f.delta(o),v.delta(l),o.dot(l)<0){let ve=v.start;v.start=v.end,v.end=ve}const X=f.start.dot(o),ne=f.end.dot(o),pe=v.start.dot(o),Ae=v.end.dot(o);return(X===Ae||pe===ne||ne<pe!=X<Ae)&&(w&&(h.subVectors(f.start,v.start),h.dot(o)>0?w.start.copy(f.start):w.start.copy(v.start),h.subVectors(f.end,v.end),h.dot(o)<0?w.end.copy(f.end):w.end.copy(v.end)),!0)}}}(),Sd.prototype.distanceToPoint=function(){const a=new u.Pa4;return function(e){return this.closestPointToPoint(e,a),e.distanceTo(a)}}(),Sd.prototype.distanceToTriangle=function(){const a=new u.Pa4,e=new u.Pa4,t=["a","b","c"],n=new u.Zzh,i=new u.Zzh;return function(s,o=null,l=null){const h=o||l?n:null;if(this.intersectsTriangle(s,h))return(o||l)&&(o&&h.getCenter(o),l&&h.getCenter(l)),0;let d=1/0;for(let f=0;f<3;f++){let v;const y=t[f],w=s[y];this.closestPointToPoint(w,a),v=w.distanceToSquared(a),v<d&&(d=v,o&&o.copy(a),l&&l.copy(w));const E=this[y];s.closestPointToPoint(E,a),v=E.distanceToSquared(a),v<d&&(d=v,o&&o.copy(E),l&&l.copy(a))}for(let f=0;f<3;f++){const v=t[f],y=t[(f+1)%3];n.set(this[v],this[y]);for(let w=0;w<3;w++){const E=t[w],M=t[(w+1)%3];i.set(s[E],s[M]),TS(n,i,a,e);const P=a.distanceToSquared(e);P<d&&(d=P,o&&o.copy(a),l&&l.copy(e))}}return Math.sqrt(d)}}();const v0=1e-14,_0=1e-10,Gp=new u.Zzh,Qs=new u.Zzh,Hp=new u.Pa4,sI=new u.Pa4,EA=new u.JOQ,SB=new Sd;function SA(a){return a.a.distanceToSquared(a.b)<v0||a.a.distanceToSquared(a.c)<v0||a.b.distanceToSquared(a.c)<v0}class MB{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new u.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class CB{constructor(){this.trianglePool=new MB,this.triangles=[],this.normal=new u.Pa4}initialize(e){const{triangles:t,trianglePool:n,normal:i}=this;if(t.length=0,n.clear(),Array.isArray(e))for(let s=0,o=e.length;s<o;s++){const l=e[s];if(s===0)l.getNormal(i);else if(Math.abs(1-l.getNormal(Hp).dot(i))>v0)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const h=n.getTriangle();h.copy(l),t.push(h)}else{e.getNormal(i);const s=n.getTriangle();s.copy(e),t.push(s)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getPlane(EA),Math.abs(1-Math.abs(EA.normal.dot(t)))<_0){const i=[e.a,e.b,e.c];for(let s=0;s<3;s++){const o=(s+1)%3,l=i[s],h=i[o];Hp.subVectors(h,l).normalize(),sI.crossVectors(t,Hp),EA.setFromNormalAndCoplanarPoint(sI,l),this.splitByPlane(EA,e,s)}for(let s=0,o=n.length;s<o;s++)n[s].coplanarCount=0}else this.splitByPlane(EA,e)}splitByPlane(e,t=null,n=-1){const{triangles:i,trianglePool:s}=this;let o=null;t!==null&&(o=SB,o.copy(t),o.needsUpdate=!0);for(let l=0,h=i.length;l<h;l++){const d=i[l],{a:f,b:v,c:y}=d;if(o&&!o.intersectsTriangle(d,Gp,!0))continue;let w=0,E=-1,M=0,P=!1;const L=[f,v,y];for(let R=0;R<3;R++){const I=(R+1)%3;Gp.start.copy(L[R]),Gp.end.copy(L[I]);const N=e.distanceToPoint(Gp.start),j=e.distanceToPoint(Gp.end);if(Math.abs(N)<_0&&Math.abs(j)<_0){P=!0;break}if(Math.abs(N)<_0)continue;N>0&&M++;let H=!!e.intersectLine(Gp,Hp);!H&&Math.abs(j)<_0&&(Hp.copy(Gp.end),H=!0),!H||Hp.distanceTo(Gp.start)<v0||(Hp.distanceTo(Gp.end)<v0&&(E=R),w===0?Qs.start.copy(Hp):Qs.end.copy(Hp),w++)}if(!P)if(w===2&&Qs.distance()>_0)if(E!==-1){E=(E+1)%3;let R=0;R===E&&(R=(R+1)%3);let I=R+1;I===E&&(I=(I+1)%3);const N=s.getTriangle();N.a.copy(L[I]),N.b.copy(Qs.end),N.c.copy(Qs.start),SA(N)||i.push(N),d.a.copy(L[R]),d.b.copy(Qs.start),d.c.copy(Qs.end),SA(d)&&(i.splice(l,1),l--,h--)}else{const R=L.findIndex(X=>M>=2?e.distanceToPoint(X)<0:e.distanceToPoint(X)>0);if(R===0){let X=Qs.start;Qs.start=Qs.end,Qs.end=X}else if(R===-1)continue;const I=(R+1)%3,N=(R+2)%3,j=s.getTriangle(),H=s.getTriangle();L[I].distanceToSquared(Qs.start)<L[N].distanceToSquared(Qs.end)?(j.a.copy(L[I]),j.b.copy(Qs.start),j.c.copy(Qs.end),H.a.copy(L[I]),H.b.copy(L[N]),H.c.copy(Qs.start)):(j.a.copy(L[N]),j.b.copy(Qs.start),j.c.copy(Qs.end),H.a.copy(L[I]),H.b.copy(L[N]),H.c.copy(Qs.end)),d.a.copy(L[R]),d.b.copy(Qs.end),d.c.copy(Qs.start),SA(j)||i.push(j),SA(H)||i.push(H),SA(d)&&(i.splice(l,1),l--,h--)}else w===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function aI(){return typeof SharedArrayBuffer<"u"}function TB(a){if(a.buffer instanceof SharedArrayBuffer)return a;const e=a.constructor,t=a.buffer,n=new SharedArrayBuffer(t.byteLength),i=new Uint8Array(t);return new Uint8Array(n).set(i,0),new e(n)}class oI{constructor(e,t=500){const n=aI()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new n(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:n,expansionFactor:i}=this;e===null&&(e=~~(n.length*i));const s=new t(e);s.set(n,0),this.array=s}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let i=0,s=e.length;i<s;i++)t[n+i]=e[i];this.length+=e.length}clear(){this.length=0}}class IB{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let i=0;for(let s=0;s<t;s++)i+=n[s][e].length;return i}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const i={};t.push(i);for(const s in n)i[s]=new oI(n[s].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:n}=this,i=n[0][e];if(i){if(i.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let s=0,o=n.length;s<o;s++)n[s][e]=new oI(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const n in t)t[n].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}class PB{constructor(e){this.triangle=new u.CJI().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new u.CJI().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class lI{constructor(){this.data={}}addTriangleIntersection(e,t,n,i){const{data:s}=this;s[e]||(s[e]=new PB(t)),s[e].addTriangle(n,i)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(e!==null)e in t&&n.push(t[e].triangle);else for(const i in t)n.push(t[i].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(n=>parseInt(n)):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,i=new Set,s=[],o=l=>{if(n[l])if(t!==null)n[l].intersects[t]&&s.push(n[l].intersects[t]);else{const h=n[l].intersects;for(const d in h)i.has(d)||(i.add(d),s.push(h[d]))}};if(e!==null)o(e);else for(const l in n)o(l);return s}reset(){this.data={}}}class RB{constructor(){this.enabled=!1,this.triangleIntersectsA=new lI,this.triangleIntersectsB=new lI,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,i){const{triangleIntersectsA:s,triangleIntersectsB:o}=this;s.addTriangleIntersection(e,t,n,i),o.addTriangleIntersection(n,i,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class cI{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:i}=this;n[e]||(n[e]=[],i.push(e)),n[e].push(t)}}const Em=new u.zHn,uI=new u.yGw,_l=new u.CJI,Qp=new u.Pa4,hI=new u.Ltg,dI=new u.Ltg,pI=new u.Ltg,IS=new u.Ltg,ww=new u.Ltg,Ew=new u.Ltg,PS=new u.Zzh,RS=new u.Pa4,DS=1e-8,DB=1e-15,Sw=-1,Mw=1,fI=-2,BS=2,Cw=0,Tw=1,LS=2;let Iw=null;function mI(a){Iw=a}function gI(a,e){function t(){return Math.random()-.5}a.getNormal(RS),Em.direction.copy(RS),a.getMidpoint(Em.origin);let n=0,i=1/0;for(let s=0;s<3;s++){Em.direction.x+=t()*DS,Em.direction.y+=t()*DS,Em.direction.z+=t()*DS,Em.direction.multiplyScalar(-1);const o=e.raycastFirst(Em,u.ehD);if(o&&Em.direction.dot(o.face.normal)>0&&n++,o!==null&&(i=Math.min(i,o.distance)),i<=DB)return o.face.normal.dot(RS)>0?BS:fI;if(n/3>.5||(s-n+1)/3>.5)break}return n/3>.5?Sw:Mw}function BB(a,e,t,n,i,s,o=!1){const l=t.attributes,h=t.index,d=3*a,f=h.getX(d+0),v=h.getX(d+1),y=h.getX(d+2);for(const w in s){const E=l[w],M=s[w];if(!(w in l))throw new Error(`CSG Operations: Attribute ${w} not available on geometry.`);const P=E.itemSize;w==="position"?(_l.a.fromBufferAttribute(E,f).applyMatrix4(n),_l.b.fromBufferAttribute(E,v).applyMatrix4(n),_l.c.fromBufferAttribute(E,y).applyMatrix4(n),OS(_l.a,_l.b,_l.c,e,3,M,o)):w==="normal"?(_l.a.fromBufferAttribute(E,f).applyNormalMatrix(i),_l.b.fromBufferAttribute(E,v).applyNormalMatrix(i),_l.c.fromBufferAttribute(E,y).applyNormalMatrix(i),o&&(_l.a.multiplyScalar(-1),_l.b.multiplyScalar(-1),_l.c.multiplyScalar(-1)),OS(_l.a,_l.b,_l.c,e,3,M,o,!0)):(hI.fromBufferAttribute(E,f),dI.fromBufferAttribute(E,v),pI.fromBufferAttribute(E,y),OS(hI,dI,pI,e,P,M,o))}}function LB(a,e,t,n,i,s,o,l=!1){kS(a,n,i,s,o,l),kS(l?t:e,n,i,s,o,l),kS(l?e:t,n,i,s,o,l)}function vI(a,e,t=!1){switch(a){case tI:if(e===Mw||e===BS&&!t)return Tw;break;case nI:if(t){if(e===Sw)return Cw}else if(e===Mw||e===fI)return Tw;break;case iI:if(e===Sw)return Cw;if(e===Mw)return Tw;break;case rI:if(e===Sw||e===BS&&!t)return Tw;break;default:throw new Error(`Unrecognized CSG operation enum "${a}".`)}return LS}function OS(a,e,t,n,i,s,o=!1,l=!1){const h=d=>{s.push(d.x),i>1&&s.push(d.y),i>2&&s.push(d.z),i>3&&s.push(d.w)};IS.set(0,0,0,0).addScaledVector(a,n.a.x).addScaledVector(e,n.a.y).addScaledVector(t,n.a.z),ww.set(0,0,0,0).addScaledVector(a,n.b.x).addScaledVector(e,n.b.y).addScaledVector(t,n.b.z),Ew.set(0,0,0,0).addScaledVector(a,n.c.x).addScaledVector(e,n.c.y).addScaledVector(t,n.c.z),l&&(IS.normalize(),ww.normalize(),Ew.normalize()),h(IS),o?(h(Ew),h(ww)):(h(ww),h(Ew))}function kS(a,e,t,n,i,s=!1){for(const o in i){const l=e[o],h=i[o];if(!(o in e))throw new Error(`CSG Operations: Attribute ${o} no available on geometry.`);const d=l.itemSize;o==="position"?(Qp.fromBufferAttribute(l,a).applyMatrix4(t),h.push(Qp.x,Qp.y,Qp.z)):o==="normal"?(Qp.fromBufferAttribute(l,a).applyNormalMatrix(n),s&&Qp.multiplyScalar(-1),h.push(Qp.x,Qp.y,Qp.z)):(h.push(l.getX(a)),d>1&&h.push(l.getY(a)),d>2&&h.push(l.getZ(a)),d>3&&h.push(l.getW(a)))}}const Sm=new u.yGw,Pw=new u.Vkp,cv=new u.CJI,Rw=new u.CJI,Dw=new u.CJI,Bw=new u.CJI;function OB(a){for(const e of a)return e}function _I(a,e,t,n,i,s,o,l=0){const h=a.matrixWorld.determinant()<0;Sm.copy(e.matrixWorld).invert().multiply(a.matrixWorld),Pw.getNormalMatrix(a.matrixWorld).multiplyScalar(h?-1:1);const d=a.geometry.groupIndices,f=a.geometry.index,v=a.geometry.attributes.position,y=e.geometry.boundsTree,w=e.geometry.index,E=e.geometry.attributes.position,M=t.ids,P=t.intersectionSet;for(let L=0,R=M.length;L<R;L++){const I=M[L],N=l===-1?0:d[I]+l,j=o.getGroupSet(N),H=3*I,X=f.getX(H+0),ne=f.getX(H+1),pe=f.getX(H+2);cv.a.fromBufferAttribute(v,X).applyMatrix4(Sm),cv.b.fromBufferAttribute(v,ne).applyMatrix4(Sm),cv.c.fromBufferAttribute(v,pe).applyMatrix4(Sm),s.initialize(cv);const Ae=P[I];for(let Ee=0,xe=Ae.length;Ee<xe;Ee++){const we=3*Ae[Ee],Re=w.getX(we+0),Be=w.getX(we+1),Oe=w.getX(we+2);Rw.a.fromBufferAttribute(E,Re),Rw.b.fromBufferAttribute(E,Be),Rw.c.fromBufferAttribute(E,Oe),s.splitByTriangle(Rw)}const ve=s.triangles;for(let Ee=0,xe=ve.length;Ee<xe;Ee++){const we=ve[Ee],Re=vI(n,gI(we,y),i);if(Re!==LS){cv.getBarycoord(we.a,Bw.a),cv.getBarycoord(we.b,Bw.b),cv.getBarycoord(we.c,Bw.c);const Be=Re===Cw;BB(I,Bw,a.geometry,a.matrixWorld,Pw,j,h!==Be)}}}return M.length}function yI(a,e,t,n,i,s,o=0){const l=a.matrixWorld.determinant()<0;Sm.copy(e.matrixWorld).invert().multiply(a.matrixWorld),Pw.getNormalMatrix(a.matrixWorld).multiplyScalar(l?-1:1);const h=e.geometry.boundsTree,d=a.geometry.groupIndices,f=a.geometry.index,v=a.geometry.attributes,y=v.position,w=[],E=a.geometry.halfEdges,M=new Set;for(let P=0,L=f.count/3;P<L;P++)P in t.intersectionSet||M.add(P);for(;M.size>0;){const P=OB(M);M.delete(P),w.push(P);const L=3*P,R=f.getX(L+0),I=f.getX(L+1),N=f.getX(L+2);Dw.a.fromBufferAttribute(y,R).applyMatrix4(Sm),Dw.b.fromBufferAttribute(y,I).applyMatrix4(Sm),Dw.c.fromBufferAttribute(y,N).applyMatrix4(Sm);const j=vI(n,gI(Dw,h),i);for(;w.length>0;){const H=w.pop(),X=o===-1?0:d[H]+o,ne=s.getGroupSet(X);for(let we=0;we<3;we++){const Re=E.getSiblingTriangleIndex(H,we);Re!==-1&&M.has(Re)&&(w.push(Re),M.delete(Re))}if(j===LS)continue;const pe=3*H,Ae=f.getX(pe+0),ve=f.getX(pe+1),Ee=f.getX(pe+2),xe=j===Cw;LB(Ae,ve,Ee,v,a.matrixWorld,Pw,ne,xe!==l)}}}const AI=0,kB=1,UB=2,US=1.25,bI=1,NS=65535,NB=Math.pow(2,-24);class Lw{constructor(){}}function Md(a,e,t){return t.min.x=e[a],t.min.y=e[a+1],t.min.z=e[a+2],t.max.x=e[a+3],t.max.y=e[a+4],t.max.z=e[a+5],t}function xI(a){let e=-1,t=-1/0;for(let n=0;n<3;n++){const i=a[n+3]-a[n];i>t&&(t=i,e=n)}return e}function wI(a,e){e.set(a)}function EI(a,e,t){let n,i;for(let s=0;s<3;s++){const o=s+3;n=a[s],i=e[s],t[s]=n<i?n:i,n=a[o],i=e[o],t[o]=n>i?n:i}}function Ow(a,e,t){for(let n=0;n<3;n++){const i=e[a+2*n],s=e[a+2*n+1],o=i-s,l=i+s;o<t[n]&&(t[n]=o),l>t[n+3]&&(t[n+3]=l)}}function MA(a){const e=a[3]-a[0],t=a[4]-a[1],n=a[5]-a[2];return 2*(e*t+t*n+n*e)}function FS(a,e,t,n,i=null){let s=1/0,o=1/0,l=1/0,h=-1/0,d=-1/0,f=-1/0,v=1/0,y=1/0,w=1/0,E=-1/0,M=-1/0,P=-1/0;const L=i!==null;for(let R=6*e,I=6*(e+t);R<I;R+=6){const N=a[R+0],j=a[R+1],H=N-j,X=N+j;H<s&&(s=H),X>h&&(h=X),L&&N<v&&(v=N),L&&N>E&&(E=N);const ne=a[R+2],pe=a[R+3],Ae=ne-pe,ve=ne+pe;Ae<o&&(o=Ae),ve>d&&(d=ve),L&&ne<y&&(y=ne),L&&ne>M&&(M=ne);const Ee=a[R+4],xe=a[R+5],we=Ee-xe,Re=Ee+xe;we<l&&(l=we),Re>f&&(f=Re),L&&Ee<w&&(w=Ee),L&&Ee>P&&(P=Ee)}n[0]=s,n[1]=o,n[2]=l,n[3]=h,n[4]=d,n[5]=f,L&&(i[0]=v,i[1]=y,i[2]=w,i[3]=E,i[4]=M,i[5]=P)}const Wp=32,FB=(a,e)=>a.candidate-e.candidate,Mm=new Array(Wp).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),kw=new Float32Array(6);class Cd{constructor(e,t,n){this.isOrientedBox=!0,this.min=new u.Pa4,this.max=new u.Pa4,this.matrix=new u.yGw,this.invMatrix=new u.yGw,this.points=new Array(8).fill().map(()=>new u.Pa4),this.satAxes=new Array(3).fill().map(()=>new u.Pa4),this.satBounds=new Array(3).fill().map(()=>new Vp),this.alignedSatBounds=new Array(3).fill().map(()=>new Vp),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Cd.prototype.update=function(){const a=this.matrix,e=this.min,t=this.max,n=this.points;for(let h=0;h<=1;h++)for(let d=0;d<=1;d++)for(let f=0;f<=1;f++){const v=n[1*h|2*d|4*f];v.x=h?t.x:e.x,v.y=d?t.y:e.y,v.z=f?t.z:e.z,v.applyMatrix4(a)}const i=this.satBounds,s=this.satAxes,o=n[0];for(let h=0;h<3;h++){const d=s[h],f=i[h],v=n[1<<h];d.subVectors(o,v),f.setFromPoints(d,n)}const l=this.alignedSatBounds;l[0].setFromPointsField(n,"x"),l[1].setFromPointsField(n,"y"),l[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Cd.prototype.intersectsBox=function(){const a=new Vp;return function(e){this.needsUpdate&&this.update();const t=e.min,n=e.max,i=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(a.min=t.x,a.max=n.x,o[0].isSeparated(a)||(a.min=t.y,a.max=n.y,o[1].isSeparated(a))||(a.min=t.z,a.max=n.z,o[2].isSeparated(a)))return!1;for(let l=0;l<3;l++){const h=s[l],d=i[l];if(a.setFromBox(h,e),d.isSeparated(a))return!1}return!0}}(),Cd.prototype.intersectsTriangle=function(){const a=new Sd,e=new Array(3),t=new Vp,n=new Vp,i=new u.Pa4;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(a.copy(s),a.update(),s=a);const o=this.satBounds,l=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let v=0;v<3;v++){const y=o[v],w=l[v];if(t.setFromPoints(w,e),y.isSeparated(t))return!1}const h=s.satBounds,d=s.satAxes,f=this.points;for(let v=0;v<3;v++){const y=h[v],w=d[v];if(t.setFromPoints(w,f),y.isSeparated(t))return!1}for(let v=0;v<3;v++){const y=l[v];for(let w=0;w<4;w++){const E=d[w];if(i.crossVectors(y,E),t.setFromPoints(i,e),n.setFromPoints(i,f),t.isSeparated(n))return!1}}return!0}}(),Cd.prototype.closestPointToPoint=function(a,e){return this.needsUpdate&&this.update(),e.copy(a).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},Cd.prototype.distanceToPoint=function(){const a=new u.Pa4;return function(e){return this.closestPointToPoint(e,a),e.distanceTo(a)}}(),Cd.prototype.distanceToBox=function(){const a=["x","y","z"],e=new Array(12).fill().map(()=>new u.Zzh),t=new Array(12).fill().map(()=>new u.Zzh),n=new u.Pa4,i=new u.Pa4;return function(s,o=0,l=null,h=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(l||h)&&(s.getCenter(i),this.closestPointToPoint(i,n),s.closestPointToPoint(n,i),l&&l.copy(n),h&&h.copy(i)),0;const d=o*o,f=s.min,v=s.max,y=this.points;let w=1/0;for(let M=0;M<8;M++){const P=y[M];i.copy(P).clamp(f,v);const L=P.distanceToSquared(i);if(L<w&&(w=L,l&&l.copy(P),h&&h.copy(i),L<d))return Math.sqrt(L)}let E=0;for(let M=0;M<3;M++)for(let P=0;P<=1;P++)for(let L=0;L<=1;L++){const R=(M+1)%3,I=(M+2)%3,N=1<<M|P<<R|L<<I,j=y[P<<R|L<<I],H=y[N];e[E].set(j,H);const X=a[M],ne=a[R],pe=a[I],Ae=t[E],ve=Ae.start,Ee=Ae.end;ve[X]=f[X],ve[ne]=P?f[ne]:v[ne],ve[pe]=L?f[pe]:v[ne],Ee[X]=v[X],Ee[ne]=P?f[ne]:v[ne],Ee[pe]=L?f[pe]:v[ne],E++}for(let M=0;M<=1;M++)for(let P=0;P<=1;P++)for(let L=0;L<=1;L++){i.x=M?v.x:f.x,i.y=P?v.y:f.y,i.z=L?v.z:f.z,this.closestPointToPoint(i,n);const R=i.distanceToSquared(n);if(R<w&&(w=R,l&&l.copy(n),h&&h.copy(i),R<d))return Math.sqrt(R)}for(let M=0;M<12;M++){const P=e[M];for(let L=0;L<12;L++){const R=t[L];TS(P,R,n,i);const I=n.distanceToSquared(i);if(I<w&&(w=I,l&&l.copy(n),h&&h.copy(i),I<d))return Math.sqrt(I)}}return Math.sqrt(w)}}();const Uw=new u.Pa4,Nw=new u.Pa4,Fw=new u.Pa4,SI=new u.FM8,MI=new u.FM8,CI=new u.FM8,TI=new u.Pa4;function II(a,e,t,n,i){const s=3*n,o=a.index.getX(s),l=a.index.getX(s+1),h=a.index.getX(s+2),d=function(f,v,y,w,E,M,P){Uw.fromBufferAttribute(v,w),Nw.fromBufferAttribute(v,E),Fw.fromBufferAttribute(v,M);const L=function(R,I,N,j,H,X){let ne;return ne=X===u._Li?R.intersectTriangle(j,N,I,!0,H):R.intersectTriangle(I,N,j,X!==u.ehD,H),ne===null?null:{distance:R.origin.distanceTo(H),point:H.clone()}}(f,Uw,Nw,Fw,TI,P);if(L){y&&(SI.fromBufferAttribute(y,w),MI.fromBufferAttribute(y,E),CI.fromBufferAttribute(y,M),L.uv=u.CJI.getUV(TI,Uw,Nw,Fw,SI,MI,CI,new u.FM8));const R={a:w,b:E,c:M,normal:new u.Pa4,materialIndex:0};u.CJI.getNormal(Uw,Nw,Fw,R.normal),L.face=R,L.faceIndex=w}return L}(t,a.attributes.position,a.attributes.uv,o,l,h,e);return d?(d.faceIndex=n,i&&i.push(d),d):null}function Td(a,e,t,n){const i=a.a,s=a.b,o=a.c;let l=e,h=e+1,d=e+2;t&&(l=t.getX(e),h=t.getX(e+1),d=t.getX(e+2)),i.x=n.getX(l),i.y=n.getY(l),i.z=n.getZ(l),s.x=n.getX(h),s.y=n.getY(h),s.z=n.getZ(h),o.x=n.getX(d),o.y=n.getY(d),o.z=n.getZ(d)}function PI(a,e,t,n,i,s,o){const l=t.index,h=t.attributes.position;for(let d=a,f=e+a;d<f;d++)if(Td(o,3*d,l,h),o.needsUpdate=!0,n(o,d,i,s))return!0;return!1}class RI{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Cm(a,e){return e[a+15]===65535}function y0(a,e){return e[a+6]}function CA(a,e){return e[a+14]}function TA(a){return a+8}function IA(a,e){return e[a+6]}const A0=new u.ZzF,zw=new u.Pa4,zB=["x","y","z"];function zS(a,e,t,n,i){let s=2*a,o=b0,l=Tm,h=Im;if(Cm(s,l))(function(d,f,v,y,w,E){for(let M=y,P=y+w;M<P;M++)II(d,f,v,M,E)})(e,t,n,y0(a,h),CA(s,l),i);else{const d=TA(a);jw(d,o,n,zw)&&zS(d,e,t,n,i);const f=IA(a,h);jw(f,o,n,zw)&&zS(f,e,t,n,i)}}function jS(a,e,t,n){let i=2*a,s=b0,o=Tm,l=Im;if(Cm(i,o))return function(h,d,f,v,y){let w=1/0,E=null;for(let M=v,P=v+y;M<P;M++){const L=II(h,d,f,M);L&&L.distance<w&&(E=L,w=L.distance)}return E}(e,t,n,y0(a,l),CA(i,o));{const h=function(M,P){return P[M+7]}(a,l),d=zB[h],f=n.direction[d]>=0;let v,y;f?(v=TA(a),y=IA(a,l)):(v=IA(a,l),y=TA(a));const w=jw(v,s,n,zw)?jS(v,e,t,n):null;if(w){const M=w.point[d];if(f?M<=s[y+h]:M>=s[y+h+3])return w}const E=jw(y,s,n,zw)?jS(y,e,t,n):null;return w&&E?w.distance<=E.distance?w:E:w||E||null}}const jB=function(){let a,e;const t=[],n=new RI(()=>new u.ZzF);return function(...s){a=n.getPrimitive(),e=n.getPrimitive(),t.push(a,e);const o=i(...s);n.releasePrimitive(a),n.releasePrimitive(e),t.pop(),t.pop();const l=t.length;return l>0&&(e=t[l-1],a=t[l-2]),o};function i(s,o,l,h,d=null,f=0,v=0){function y(R){let I=2*R,N=Tm,j=Im;for(;!Cm(I,N);)I=2*(R=TA(R));return y0(R,j)}function w(R){let I=2*R,N=Tm,j=Im;for(;!Cm(I,N);)I=2*(R=IA(R,j));return y0(R,j)+CA(I,N)}let E=2*s,M=b0,P=Tm,L=Im;if(Cm(E,P)){const R=y0(s,L),I=CA(E,P);return Md(s,M,a),h(R,I,!1,v,f+s,a)}{const R=TA(s),I=IA(s,L);let N,j,H,X,ne=R,pe=I;if(d&&(H=a,X=e,Md(ne,M,H),Md(pe,M,X),N=d(H),j=d(X),j<N)){ne=I,pe=R;const we=N;N=j,j=we,H=X}H||(H=a,Md(ne,M,H));const Ae=l(H,Cm(2*ne,P),N,v+1,f+ne);let ve;if(Ae===2){const we=y(ne);ve=h(we,w(ne)-we,!0,v+1,f+ne,H)}else ve=Ae&&i(ne,o,l,h,d,f,v+1);if(ve)return!0;X=e,Md(pe,M,X);const Ee=l(X,Cm(2*pe,P),j,v+1,f+pe);let xe;if(Ee===2){const we=y(pe);xe=h(we,w(pe)-we,!0,v+1,f+pe,X)}else xe=Ee&&i(pe,o,l,h,d,f,v+1);return!!xe}}}(),VB=function(){const a=new Sd,e=new Sd,t=new u.yGw,n=new Cd,i=new Cd;return function s(o,l,h,d,f=null){let v=2*o,y=b0,w=Tm,E=Im;if(f===null&&(h.boundingBox||h.computeBoundingBox(),n.set(h.boundingBox.min,h.boundingBox.max,d),f=n),!Cm(v,w)){const M=o+8,P=E[o+6];return Md(M,y,A0),f.intersectsBox(A0)&&s(M,l,h,d,f)?!0:(Md(P,y,A0),!(!f.intersectsBox(A0)||!s(P,l,h,d,f)))}{const M=l,P=M.index,L=M.attributes.position,R=h.index,I=h.attributes.position,N=y0(o,E),j=CA(v,w);if(t.copy(d).invert(),h.boundsTree)return Md(o,y,i),i.matrix.copy(t),i.needsUpdate=!0,h.boundsTree.shapecast({intersectsBounds:X=>i.intersectsBox(X),intersectsTriangle:X=>{X.a.applyMatrix4(d),X.b.applyMatrix4(d),X.c.applyMatrix4(d),X.needsUpdate=!0;for(let ne=3*N,pe=3*(j+N);ne<pe;ne+=3)if(Td(e,ne,P,L),e.needsUpdate=!0,X.intersectsTriangle(e))return!0;return!1}});for(let H=3*N,X=j+3*N;H<X;H+=3){Td(a,H,P,L),a.a.applyMatrix4(t),a.b.applyMatrix4(t),a.c.applyMatrix4(t),a.needsUpdate=!0;for(let ne=0,pe=R.count;ne<pe;ne+=3)if(Td(e,ne,R,I),e.needsUpdate=!0,a.intersectsTriangle(e))return!0}}}}();function jw(a,e,t,n){return Md(a,e,A0),t.intersectBox(A0,n)}const VS=[];let Vw,b0,Tm,Im;function PA(a){Vw&&VS.push(Vw),Vw=a,b0=new Float32Array(a),Tm=new Uint16Array(a),Im=new Uint32Array(a)}function Gw(){Vw=null,b0=null,Tm=null,Im=null,VS.length&&PA(VS.pop())}const GS=Symbol("skip tree generation"),HS=new u.ZzF,QS=new u.ZzF,x0=new u.yGw,uv=new Cd,RA=new Cd,DA=new u.Pa4,Hw=new u.Pa4,GB=new u.Pa4,HB=new u.Pa4,QB=new u.Pa4,DI=new u.ZzF,Id=new RI(()=>new Sd);class BA{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),BA.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,i=e._roots,s=n.getIndex();let o;return o=t.cloneBuffers?{roots:i.map(l=>l.slice()),index:s.array.slice()}:{roots:i,index:s.array},o}static deserialize(e,t,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),BA.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});n={setIndex:!0,...n};const{index:i,roots:s}=e,o=new BA(t,{...n,[GS]:!0});if(o._roots=s,n.setIndex){const l=t.getIndex();if(l===null){const h=new u.TlE(e.index,1,!1);t.setIndex(h)}else l.array!==i&&(l.array.set(i),l.needsUpdate=!0)}return o}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:AI,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[GS]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[GS]||(this._roots=function(n,i){const s=function(w,E){function M(we){pe&&pe(we/Ae)}function P(we,Re,Be,Oe=null,at=0){if(!ve&&at>=j&&(ve=!0,H&&(console.warn(`MeshBVH: Max depth of ${j} reached when generating BVH. Consider increasing maxDepth.`),console.warn(w))),Be<=X||at>=j)return M(Re+Be),we.offset=Re,we.count=Be,we;const st=function(dt,ht,Nt,Bt,rn,hn){let wn=-1,Jn=0;if(hn===AI)wn=xI(ht),wn!==-1&&(Jn=(ht[wn]+ht[wn+3])/2);else if(hn===kB)wn=xI(dt),wn!==-1&&(Jn=function(Fn,jn,wt,jt){let on=0;for(let li=jn,Mi=jn+wt;li<Mi;li++)on+=Fn[6*li+2*jt];return on/wt}(Nt,Bt,rn,wn));else if(hn===UB){const Fn=MA(dt);let jn=US*rn;const wt=6*Bt,jt=6*(Bt+rn);for(let on=0;on<3;on++){const li=ht[on],Mi=(ht[on+3]-li)/Wp;if(rn<Wp/4){const pi=[...Mm];pi.length=rn;let ai=0;for(let Dn=wt;Dn<jt;Dn+=6,ai++){const vt=pi[ai];vt.candidate=Nt[Dn+2*on],vt.count=0;const{bounds:an,leftCacheBounds:On,rightCacheBounds:Xt}=vt;for(let ei=0;ei<3;ei++)Xt[ei]=1/0,Xt[ei+3]=-1/0,On[ei]=1/0,On[ei+3]=-1/0,an[ei]=1/0,an[ei+3]=-1/0;Ow(Dn,Nt,an)}pi.sort(FB);let oi=rn;for(let Dn=0;Dn<oi;Dn++){const vt=pi[Dn];for(;Dn+1<oi&&pi[Dn+1].candidate===vt.candidate;)pi.splice(Dn+1,1),oi--}for(let Dn=wt;Dn<jt;Dn+=6){const vt=Nt[Dn+2*on];for(let an=0;an<oi;an++){const On=pi[an];vt>=On.candidate?Ow(Dn,Nt,On.rightCacheBounds):(Ow(Dn,Nt,On.leftCacheBounds),On.count++)}}for(let Dn=0;Dn<oi;Dn++){const vt=pi[Dn],an=vt.count,On=rn-vt.count,Xt=vt.leftCacheBounds,ei=vt.rightCacheBounds;let Nr=0;an!==0&&(Nr=MA(Xt)/Fn);let ts=0;On!==0&&(ts=MA(ei)/Fn);const Bs=bI+US*(Nr*an+ts*On);Bs<jn&&(wn=on,jn=Bs,Jn=vt.candidate)}}else{for(let oi=0;oi<Wp;oi++){const Dn=Mm[oi];Dn.count=0,Dn.candidate=li+Mi+oi*Mi;const vt=Dn.bounds;for(let an=0;an<3;an++)vt[an]=1/0,vt[an+3]=-1/0}for(let oi=wt;oi<jt;oi+=6){let Dn=~~((Nt[oi+2*on]-li)/Mi);Dn>=Wp&&(Dn=Wp-1);const vt=Mm[Dn];vt.count++,Ow(oi,Nt,vt.bounds)}const pi=Mm[Wp-1];wI(pi.bounds,pi.rightCacheBounds);for(let oi=Wp-2;oi>=0;oi--){const Dn=Mm[oi],vt=Mm[oi+1];EI(Dn.bounds,vt.rightCacheBounds,Dn.rightCacheBounds)}let ai=0;for(let oi=0;oi<Wp-1;oi++){const Dn=Mm[oi],vt=Dn.count,an=Dn.bounds,On=Mm[oi+1].rightCacheBounds;vt!==0&&(ai===0?wI(an,kw):EI(an,kw,kw)),ai+=vt;let Xt=0,ei=0;ai!==0&&(Xt=MA(kw)/Fn);const Nr=rn-ai;Nr!==0&&(ei=MA(On)/Fn);const ts=bI+US*(Xt*ai+ei*Nr);ts<jn&&(wn=on,jn=ts,Jn=Dn.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${hn} used.`);return{axis:wn,pos:Jn}}(we.boundingData,Oe,I,Re,Be,ne);if(st.axis===-1)return M(Re+Be),we.offset=Re,we.count=Be,we;const St=function(dt,ht,Nt,Bt,rn){let hn=Nt,wn=Nt+Bt-1;const Jn=rn.pos,Fn=2*rn.axis;for(;;){for(;hn<=wn&&ht[6*hn+Fn]<Jn;)hn++;for(;hn<=wn&&ht[6*wn+Fn]>=Jn;)wn--;if(!(hn<wn))return hn;for(let jn=0;jn<3;jn++){let wt=dt[3*hn+jn];dt[3*hn+jn]=dt[3*wn+jn],dt[3*wn+jn]=wt;let jt=ht[6*hn+2*jn+0];ht[6*hn+2*jn+0]=ht[6*wn+2*jn+0],ht[6*wn+2*jn+0]=jt;let on=ht[6*hn+2*jn+1];ht[6*hn+2*jn+1]=ht[6*wn+2*jn+1],ht[6*wn+2*jn+1]=on}hn++,wn--}}(N,I,Re,Be,st);if(St===Re||St===Re+Be)M(Re+Be),we.offset=Re,we.count=Be;else{we.splitAxis=st.axis;const dt=new Lw,ht=Re,Nt=St-Re;we.left=dt,dt.boundingData=new Float32Array(6),FS(I,ht,Nt,dt.boundingData,R),P(dt,ht,Nt,R,at+1);const Bt=new Lw,rn=St,hn=Be-Nt;we.right=Bt,Bt.boundingData=new Float32Array(6),FS(I,rn,hn,Bt.boundingData,R),P(Bt,rn,hn,R,at+1)}return we}(function(we,Re){if(!we.index){const Be=we.attributes.position.count,Oe=Re.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let at;at=Be>65535?new Uint32Array(new Oe(4*Be)):new Uint16Array(new Oe(2*Be)),we.setIndex(new u.TlE(at,1));for(let st=0;st<Be;st++)at[st]=st}})(w,E);const L=new Float32Array(6),R=new Float32Array(6),I=function(we,Re){const Be=we.attributes.position,Oe=we.index.array,at=Oe.length/3,st=new Float32Array(6*at),St=Be.normalized,dt=Be.array,ht=Be.offset||0;let Nt=3;Be.isInterleavedBufferAttribute&&(Nt=Be.data.stride);const Bt=["getX","getY","getZ"];for(let rn=0;rn<at;rn++){const hn=3*rn,wn=6*rn;let Jn,Fn,jn;St?(Jn=Oe[hn+0],Fn=Oe[hn+1],jn=Oe[hn+2]):(Jn=Oe[hn+0]*Nt+ht,Fn=Oe[hn+1]*Nt+ht,jn=Oe[hn+2]*Nt+ht);for(let wt=0;wt<3;wt++){let jt,on,li;St?(jt=Be[Bt[wt]](Jn),on=Be[Bt[wt]](Fn),li=Be[Bt[wt]](jn)):(jt=dt[Jn+wt],on=dt[Fn+wt],li=dt[jn+wt]);let Mi=jt;on<Mi&&(Mi=on),li<Mi&&(Mi=li);let pi=jt;on>pi&&(pi=on),li>pi&&(pi=li);const ai=(pi-Mi)/2,oi=2*wt;st[wn+oi+0]=Mi+ai,st[wn+oi+1]=ai+(Math.abs(Mi)+ai)*NB,Mi<Re[wt]&&(Re[wt]=Mi),pi>Re[wt+3]&&(Re[wt+3]=pi)}}return st}(w,L),N=w.index.array,j=E.maxDepth,H=E.verbose,X=E.maxLeafTris,ne=E.strategy,pe=E.onProgress,Ae=w.index.count/3;let ve=!1;const Ee=[],xe=function(we){if(!we.groups||!we.groups.length)return[{offset:0,count:we.index.count/3}];const Re=[],Be=new Set;for(const at of we.groups)Be.add(at.start),Be.add(at.start+at.count);const Oe=Array.from(Be.values()).sort((at,st)=>at-st);for(let at=0;at<Oe.length-1;at++){const st=Oe[at],St=Oe[at+1];Re.push({offset:st/3,count:(St-st)/3})}return Re}(w);if(xe.length===1){const we=xe[0],Re=new Lw;Re.boundingData=L,function(Be,Oe,at,st){let St=1/0,dt=1/0,ht=1/0,Nt=-1/0,Bt=-1/0,rn=-1/0;for(let hn=6*Oe,wn=6*(Oe+at);hn<wn;hn+=6){const Jn=Be[hn+0];Jn<St&&(St=Jn),Jn>Nt&&(Nt=Jn);const Fn=Be[hn+2];Fn<dt&&(dt=Fn),Fn>Bt&&(Bt=Fn);const jn=Be[hn+4];jn<ht&&(ht=jn),jn>rn&&(rn=jn)}st[0]=St,st[1]=dt,st[2]=ht,st[3]=Nt,st[4]=Bt,st[5]=rn}(I,we.offset,we.count,R),P(Re,we.offset,we.count,R),Ee.push(Re)}else for(let we of xe){const Re=new Lw;Re.boundingData=new Float32Array(6),FS(I,we.offset,we.count,Re.boundingData,R),P(Re,we.offset,we.count,R),Ee.push(Re)}return Ee}(n,i);let o,l,h;const d=[],f=i.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let w=0;w<s.length;w++){const E=s[w],M=new f(32*v(E));o=new Float32Array(M),l=new Uint32Array(M),h=new Uint16Array(M),y(0,E),d.push(M)}return d;function v(w){return w.count?1:1+v(w.left)+v(w.right)}function y(w,E){const M=w/4,P=w/2,L=!!E.count,R=E.boundingData;for(let I=0;I<6;I++)o[M+I]=R[I];if(L){const I=E.offset,N=E.count;return l[M+6]=I,h[P+14]=N,h[P+15]=NS,w+32}{const I=E.left,N=E.right,j=E.splitAxis;let H;if(H=y(w+32,I),H/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return l[M+6]=H/4,H=y(H,N),l[M+7]=j,H}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new u.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,i=t.attributes.position;let s,o,l,h,d=0;const f=this._roots;for(let y=0,w=f.length;y<w;y++)s=f[y],o=new Uint32Array(s),l=new Uint16Array(s),h=new Float32Array(s),v(0,d),d+=s.byteLength;function v(y,w,E=!1){const M=2*y;if(l[M+15]===NS){const P=o[y+6];let L=1/0,R=1/0,I=1/0,N=-1/0,j=-1/0,H=-1/0;for(let X=3*P,ne=3*(P+l[M+14]);X<ne;X++){const pe=n[X],Ae=i.getX(pe),ve=i.getY(pe),Ee=i.getZ(pe);Ae<L&&(L=Ae),Ae>N&&(N=Ae),ve<R&&(R=ve),ve>j&&(j=ve),Ee<I&&(I=Ee),Ee>H&&(H=Ee)}return(h[y+0]!==L||h[y+1]!==R||h[y+2]!==I||h[y+3]!==N||h[y+4]!==j||h[y+5]!==H)&&(h[y+0]=L,h[y+1]=R,h[y+2]=I,h[y+3]=N,h[y+4]=j,h[y+5]=H,!0)}{const P=y+8,L=o[y+6],R=P+w,I=L+w;let N=E,j=!1,H=!1;e?N||(j=e.has(R),H=e.has(I),N=!j&&!H):(j=!0,H=!0);const X=N||H;let ne=!1;(N||j)&&(ne=v(P,w,N));let pe=!1;X&&(pe=v(L,w,N));const Ae=ne||pe;if(Ae)for(let ve=0;ve<3;ve++){const Ee=P+ve,xe=L+ve,we=h[Ee],Re=h[Ee+3],Be=h[xe],Oe=h[xe+3];h[y+ve]=we<Be?we:Be,h[y+ve+3]=Re>Oe?Re:Oe}return Ae}}}traverse(e,t=0){const n=this._roots[t],i=new Uint32Array(n),s=new Uint16Array(n);(function o(l,h=0){const d=2*l,f=s[d+15]===NS;if(f){const v=i[l+6],y=s[d+14];e(h,f,new Float32Array(n,4*l,6),v,y)}else{const v=l+8,y=i[l+6],w=i[l+7];e(h,f,new Float32Array(n,4*l,6),w)||(o(v,h+1),o(y,h+1))}})(0)}raycast(e,t=u.Wl3){const n=this._roots,i=this.geometry,s=[],o=t.isMaterial,l=Array.isArray(t),h=i.groups,d=o?t.side:t;for(let f=0,v=n.length;f<v;f++){const y=l?t[h[f].materialIndex].side:d,w=s.length;if(PA(n[f]),zS(0,i,y,e,s),Gw(),l){const E=h[f].materialIndex;for(let M=w,P=s.length;M<P;M++)s[M].face.materialIndex=E}}return s}raycastFirst(e,t=u.Wl3){const n=this._roots,i=this.geometry,s=t.isMaterial,o=Array.isArray(t);let l=null;const h=i.groups,d=s?t.side:t;for(let f=0,v=n.length;f<v;f++){const y=o?t[h[f].materialIndex].side:d;PA(n[f]);const w=jS(0,i,y,e);Gw(),w!=null&&(l==null||w.distance<l.distance)&&(l=w,o&&(w.face.materialIndex=h[f].materialIndex))}return l}intersectsGeometry(e,t){const n=this.geometry;let i=!1;for(const s of this._roots)if(PA(s),i=VB(0,n,e,t),Gw(),i)break;return i}shapecast(e,t,n){const i=this.geometry;if(e instanceof Function){if(t){const y=t;t=(w,E,M,P)=>{const L=3*E;return y(w,L,L+1,L+2,M,P)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const s=Id.getPrimitive();let{boundsTraverseOrder:o,intersectsBounds:l,intersectsRange:h,intersectsTriangle:d}=e;if(h&&d){const y=h;h=(w,E,M,P,L)=>!!y(w,E,M,P,L)||PI(w,E,i,d,M,P,s)}else h||(h=d?(y,w,E,M)=>PI(y,w,i,d,E,M,s):(y,w,E)=>E);let f=!1,v=0;for(const y of this._roots){if(PA(y),f=jB(0,i,l,h,o,v),Gw(),f)break;v+=y.byteLength}return Id.releasePrimitive(s),f}bvhcast(e,t,n){let{intersectsRanges:i,intersectsTriangles:s}=n;const o=this.geometry.index,l=this.geometry.attributes.position,h=e.geometry.index,d=e.geometry.attributes.position;x0.copy(t).invert();const f=Id.getPrimitive(),v=Id.getPrimitive();if(s){let w=function(E,M,P,L,R,I,N,j){for(let H=P,X=P+L;H<X;H++){Td(v,3*H,h,d),v.a.applyMatrix4(t),v.b.applyMatrix4(t),v.c.applyMatrix4(t),v.needsUpdate=!0;for(let ne=E,pe=E+M;ne<pe;ne++)if(Td(f,3*ne,o,l),f.needsUpdate=!0,s(f,v,ne,H,R,I,N,j))return!0}return!1};if(i){const E=i;i=function(M,P,L,R,I,N,j,H){return!!E(M,P,L,R,I,N,j,H)||w(M,P,L,R,I,N,j,H)}}else i=w}e.getBoundingBox(QS),QS.applyMatrix4(t);const y=this.shapecast({intersectsBounds:w=>QS.intersectsBox(w),intersectsRange:(w,E,M,P,L,R)=>(HS.copy(R),HS.applyMatrix4(x0),e.shapecast({intersectsBounds:I=>HS.intersectsBox(I),intersectsRange:(I,N,j,H,X)=>i(w,E,I,N,P,L,H,X)}))});return Id.releasePrimitive(f),Id.releasePrimitive(v),y}intersectsBox(e,t){return uv.set(e.min,e.max,t),uv.needsUpdate=!0,this.shapecast({intersectsBounds:n=>uv.intersectsBox(n),intersectsTriangle:n=>uv.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},i={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),uv.set(e.boundingBox.min,e.boundingBox.max,t),uv.needsUpdate=!0;const l=this.geometry,h=l.attributes.position,d=l.index,f=e.attributes.position,v=e.index,y=Id.getPrimitive(),w=Id.getPrimitive();let E=Hw,M=GB,P=null,L=null;i&&(P=HB,L=QB);let R=1/0,I=null,N=null;return x0.copy(t).invert(),RA.matrix.copy(x0),this.shapecast({boundsTraverseOrder:j=>uv.distanceToBox(j),intersectsBounds:(j,H,X)=>X<R&&X<o&&(H&&(RA.min.copy(j.min),RA.max.copy(j.max),RA.needsUpdate=!0),!0),intersectsRange:(j,H)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:X=>RA.distanceToBox(X),intersectsBounds:(X,ne,pe)=>pe<R&&pe<o,intersectsRange:(X,ne)=>{for(let pe=3*X,Ae=3*(X+ne);pe<Ae;pe+=3){Td(w,pe,v,f),w.a.applyMatrix4(t),w.b.applyMatrix4(t),w.c.applyMatrix4(t),w.needsUpdate=!0;for(let ve=3*j,Ee=3*(j+H);ve<Ee;ve+=3){Td(y,ve,d,h),y.needsUpdate=!0;const xe=y.distanceToTriangle(w,E,P);if(xe<R&&(M.copy(E),L&&L.copy(P),R=xe,I=ve/3,N=pe/3),xe<s)return!0}}}});for(let X=0,ne=v?v.count:f.count;X<ne;X+=3){Td(w,X,v,f),w.a.applyMatrix4(t),w.b.applyMatrix4(t),w.c.applyMatrix4(t),w.needsUpdate=!0;for(let pe=3*j,Ae=3*(j+H);pe<Ae;pe+=3){Td(y,pe,d,h),y.needsUpdate=!0;const ve=y.distanceToTriangle(w,E,P);if(ve<R&&(M.copy(E),L&&L.copy(P),R=ve,I=pe/3,N=X/3),ve<s)return!0}}}}),Id.releasePrimitive(y),Id.releasePrimitive(w),R===1/0?null:(n.point?n.point.copy(M):n.point=M.clone(),n.distance=R,n.faceIndex=I,i&&(i.point?i.point.copy(L):i.point=L.clone(),i.point.applyMatrix4(x0),M.applyMatrix4(x0),i.distance=M.sub(i.point).length(),i.faceIndex=N),n)}closestPointToPoint(e,t={},n=0,i=1/0){const s=n*n,o=i*i;let l=1/0,h=null;if(this.shapecast({boundsTraverseOrder:f=>(DA.copy(e).clamp(f.min,f.max),DA.distanceToSquared(e)),intersectsBounds:(f,v,y)=>y<l&&y<o,intersectsTriangle:(f,v)=>{f.closestPointToPoint(e,DA);const y=e.distanceToSquared(DA);return y<l&&(Hw.copy(DA),l=y,h=v),y<s}}),l===1/0)return null;const d=Math.sqrt(l);return t.point?t.point.copy(Hw):t.point=Hw.clone(),t.distance=d,t.faceIndex=h,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Md(0,new Float32Array(t),DI),e.union(DI)}),e}}const WB=1e6*(1+1e-7);function WS(a){return~~(a*WB)}function BI(a){return`${WS(a.x)},${WS(a.y)},${WS(a.z)}`}const qS=[new u.Pa4,new u.Pa4,new u.Pa4];class qB{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:n%3}updateFrom(e){const t=new Map,{attributes:n}=e,i=e.index,s=n.position;let o=i?i.count/3:s.count/3;const l=o;let h=0;this.useDrawRange&&(h=e.drawRange.start,e.drawRange.count!==1/0&&(o=~~(e.drawRange.count/3)));let d=this.data;(!d||d.length<3*l)&&(d=new Int32Array(3*l)),d.fill(-1);let f=0,v=0;for(let y=0;y<o;y++){const w=3*y+h;for(let E=0;E<3;E++){let M=w+E;i&&(M=i.getX(M)),qS[E].fromBufferAttribute(s,M)}for(let E=0;E<3;E++){const M=(E+1)%3,P=qS[E],L=qS[M],R=BI(P),I=BI(L),N=`${I}_${R}`;if(t.has(N)){const j=t.get(N);d[w+E]=j,d[j]=w+E,t.delete(N),f--,v++}else{const j=`${R}_${I}`;t.set(j,w+E),f++}}}this.matchedEdges=v,this.unmatchedEdges=f,this.data=d}}class Qw extends u.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new u.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,i=t.elements;for(let s=0;s<16;s++)if(n[s]!==i[s])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(aI())for(const n in t){const i=t[n];if(i.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");i.array=TB(i.array)}if(e.boundsTree||(e.boundsTree=new BA(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new qB(e)),!e.groupIndices){const n=e.index.count/3,i=new Uint16Array(n),s=e.groups;for(let o=0,l=s.length;o<l;o++){const{start:h,count:d}=s[o];for(let f=h/3,v=(h+d)/3;f<v;f++)i[f]=o}e.groupIndices=i}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function LI(a,e){let t=e;return Array.isArray(e)||(t=[],a.forEach(n=>{t[n.materialIndex]=e})),t}class XB{constructor(){this.triangleSplitter=new CB,this.attributeData=new IB,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new RB}evaluate(e,t,n,i=new Qw){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:s,attributeData:o,attributes:l,useGroups:h,debug:d}=this,f=i.geometry,v=e.geometry.attributes;for(let L=0,R=l.length;L<R;L++){const I=l[L],N=v[I];o.initializeArray(I,N.array.constructor)}for(const L in o.attributes)l.includes(L)||o.delete(L);for(const L in f.attributes)l.includes(L)||(f.deleteAttribute(L),f.dispose());o.clear(),d.enabled&&(d.reset(),mI(d)),function(L,R,I,N,j,H){const{useGroups:X=!0}=H,{aIntersections:ne,bIntersections:pe}=function(ve,Ee){const xe=new cI,we=new cI;return uI.copy(ve.matrixWorld).invert().multiply(Ee.matrixWorld),ve.geometry.boundsTree.bvhcast(Ee.geometry.boundsTree,uI,{intersectsTriangles(Re,Be,Oe,at){if(Re.intersectsTriangle(Be,PS,!0)){if(PS.distanceSq()===0&&Re.plane.normal.dot(Be.plane.normal)<1-1e-10)return!1;xe.add(Oe,at),we.add(at,Oe),Iw&&(Iw.addEdge(PS),Iw.addIntersectingTriangles(Oe,Re,at,Be))}return!1}}),{aIntersections:xe,bIntersections:we}}(L,R);let Ae;Ae=X?0:-1,yI(L,R,ne,I,!1,j,Ae),_I(L,R,ne,I,!1,N,j,Ae),Ae=X?L.geometry.groups.length||1:-1,yI(R,L,pe,I,!0,j,Ae),_I(R,L,pe,I,!0,N,j,Ae)}(e,t,n,s,o,{useGroups:h}),d.enabled&&mI(null);const y=h&&e.geometry.groups.length!==0?e.geometry.groups.map(L=>({...L})):[{start:0,count:1/0,materialIndex:0}],w=h&&t.geometry.groups.length!==0?t.geometry.groups.map(L=>({...L})):[{start:0,count:1/0,materialIndex:0}],E=LI(y,e.material),M=LI(w,t.material);w.forEach(L=>{L.materialIndex+=E.length}),function(L,R,I,N){let j=!1,H=-1;const X=N.groupCount,ne=L.attributes,pe=N.groupAttributes[0];for(const ve in pe){const Ee=N.getTotalLength(ve,X),xe=pe[ve].type;let we=ne[ve];if(!we||we.array.length<Ee){const Be=R.attributes[ve];we=new u.TlE(new xe(Ee),Be.itemSize,Be.normalized),L.setAttribute(ve,we),j=!0}let Re=0;for(let Be=0;Be<X;Be++){const{array:Oe,type:at,length:st}=N.groupAttributes[Be][ve],St=new at(Oe.buffer,0,st);we.array.set(St,Re),Re+=St.length}we.needsUpdate=!0,H=Ee/we.itemSize}L.setDrawRange(0,H),L.clearGroups();let Ae=0;for(let ve=0;ve<X;ve++){const Ee=N.getGroupArray("position",ve).length/3;if(Ee!==0){const xe=I[ve];L.addGroup(Ae,Ee,xe.materialIndex),Ae+=Ee}}if(L.index){const ve=L.index.array;if(ve.length<H)L.index=null,j=!0;else for(let Ee=0,xe=ve.length;Ee<xe;Ee++)ve[Ee]=Ee}L.boundsTree=null,j&&L.dispose()}(f,e.geometry,[...y,...w],o);const P=f.groups;if(h){const L=new Map,R=[...E,...M];let I=0;for(let N=0,j=R.length;N<j;N++)P.find(H=>H.materialIndex===N)?(L.set(N,I),I++):R[N]=null;for(let N=0,j=P.length;N<j;N++){const H=P[N];H.materialIndex=L.get(H.materialIndex)}i.material=R.filter(N=>N)}return i}evaluateHierarchy(e,t=new Qw){e.updateMatrixWorld(!0);const n=(s,o)=>{const l=s.children;for(let h=0,d=l.length;h<d;h++){const f=l[h];f.isOperationGroup?n(f,o):o(f)}},i=s=>{const o=s.children;let l=!1;for(let d=0,f=o.length;d<f;d++){const v=o[d];l=i(v)||l}const h=s.isDirty();if(h&&s.markUpdated(),l&&!s.isOperationGroup){let d;return n(s,f=>{d=d?this.evaluate(d,f,f.operation):this.evaluate(s,f,f.operation)}),s._cachedGeometry=d.geometry,s._cachedMaterials=d.material,!0}return l||h};return i(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const OI={union:tI,subtract:nI,intersect:rI,difference:iI};function kI(a,e){const t=new XB;t.useGroups=!0,t.attributes=["position","normal","uv"],a.forEach(s=>{for(const o of[...t.attributes])s[0].geometry.getAttribute(o)||t.attributes.splice(t.attributes.indexOf(o),1)});let n=new Qw(new u._12(.01,.01,2,2));a.forEach(([s,o])=>{if(!Object.keys(OI).includes(o))return void console.error(`Unknown operation ${o}`);s.updateMatrix(),s.updateMatrixWorld();const l=new Qw;l.geometry=s.geometry,l.material=s.material,s.matrixWorld.decompose(l.position,l.quaternion,l.scale),l.updateMatrix(),l.updateMatrixWorld(),n=t.evaluate(n,l,OI[o])});const i=n;return i.userData._isCSGMesh=!0,i}let LA=class extends jp{_buildCSGMesh(a){return kI(a)}};LA.PluginType="CSGPluginBVH",LA=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([Vn("CSG Plugin (BVH)")],LA);class Ww extends Sn{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,n,i,s;(n=(t=e.lastCamera)==null?void 0:t.removeControlsCtor)==null||n.call(t,this.controlsKey),(s=(i=e.camera)==null?void 0:i.setControlsCtor)==null||s.call(i,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var UI=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const YB=new u.Pa4(0,0,1),NI=new u.USm,KB=new u._fP,JB=new u._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),w0=new u._fP,ZB={type:"change"};let OA=class extends g.SimpleEventDispatcher{constructor(a){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new u._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new u._fP,this._initQuaternionInvert=new u._fP,this._initQuaternionDest=new u._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=a,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(a=>{a=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(a=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",a)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new u._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const a=this.deviceOrientation;if(a){const e=a.alpha!==null?u.M8C.degToRad(a.alpha):0,t=a.beta!==null?u.M8C.degToRad(a.beta):0,n=a.gamma!==null?u.M8C.degToRad(a.gamma):0,i=this.screenOrientation?u.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,t,n,i),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(ZB))}}dispose(){this.disconnect()}setObjectQuaternion(a,e,t,n){const i=(0,g.now)()/1e3;NI.set(e,a,-t,"YXZ"),w0.setFromEuler(NI),w0.multiply(JB),w0.multiply(KB.setFromAxisAngle(YB,-n)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(w0).invert(),this._initQuaternionDest.__init=!0),w0.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(w0,this.dampingFactor/(Math.min(1,i-this._lastTime)/(1/60))),this._lastTime=i}};UI([ke(),gn("Damping",[0,1],.01)],OA.prototype,"dampingFactor",void 0),OA=UI([Ml("Device Orientation Controls")],OA);class XS extends Ww{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new OA(e)}}XS.PluginType="DeviceOrientationControlsPlugin";var Xo=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const FI=new u.Pa4,YS=new u.$V,KS=new u.Pa4,$B={type:"change"};let Ra=class extends g.SimpleEventDispatcher{constructor(a,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new u.Pa4,this._lastTime=-1,this.object=a,this.domElement=e,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const a=this.object.quaternion;FI.set(0,0,-1).applyQuaternion(a),YS.setFromVector3(FI),this.lat=90-u.M8C.radToDeg(YS.phi),this.lon=u.M8C.radToDeg(YS.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(a){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(a.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(a){if(this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(a){this.domElement===document?(this.pointerX=a.pageX-this.viewHalfX,this.pointerY=a.pageY-this.viewHalfY):(this.pointerX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=a.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(a){if(this.enableKeys)switch(a.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(a){if(this.enableKeys)switch(a.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(a,e,t){return a.isVector3?KS.copy(a):e===void 0||t===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):KS.set(a,e,t),this.object.lookAt(KS),this.setOrientation(),this}update(){const a=(0,g.now)(),e=(this._lastTime<0?16:Math.min(a-this._lastTime,1e3))/1e3;if(this._lastTime=a,!this.enabled)return;if(this.heightSpeed){const h=u.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(h*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let n=e*this.lookSpeed;this.activeLook||(n=0);let i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*n,this.lookVertical&&(this.lat-=this.pointerY*n*i),this.lat=Math.max(-85,Math.min(85,this.lat));let s=u.M8C.degToRad(90-this.lat);const o=u.M8C.degToRad(this.lon);this.constrainVertical&&(s=u.M8C.mapLinear(s,0,Math.PI,this.verticalMin,this.verticalMax));const l=this.object.position;this.targetPosition.setFromSphericalCoords(1,s,o).add(l),this.object.lookAt(this.targetPosition),this.dispatchEvent($B)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(a){this.enableKeys&&a.preventDefault()}};Xo([ke(),sn()],Ra.prototype,"enabled",void 0),Xo([ke(),sn()],Ra.prototype,"enableKeys",void 0),Xo([ke(),gi()],Ra.prototype,"movementSpeed",void 0),Xo([ke(),gi()],Ra.prototype,"lookSpeed",void 0),Xo([ke(),sn()],Ra.prototype,"lookVertical",void 0),Xo([ke(),sn()],Ra.prototype,"autoForward",void 0),Xo([ke(),sn()],Ra.prototype,"activeLook",void 0),Xo([ke(),sn()],Ra.prototype,"heightSpeed",void 0),Xo([ke(),gi()],Ra.prototype,"heightCoef",void 0),Xo([ke(),gi()],Ra.prototype,"heightMin",void 0),Xo([ke(),gi()],Ra.prototype,"heightMax",void 0),Xo([ke(),sn()],Ra.prototype,"constrainVertical",void 0),Xo([ke(),gi()],Ra.prototype,"verticalMin",void 0),Xo([ke(),gi()],Ra.prototype,"verticalMax",void 0),Xo([ke(),sn()],Ra.prototype,"mouseDragOn",void 0),Ra=Xo([Vn("First Person Controls")],Ra);class JS extends Ww{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new Ra(e,t)}}JS.PluginType="FirstPersonControlsPlugin";var E0=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const S0=new u.USm(0,0,0,"YXZ"),M0=new u.Pa4,eL={type:"change"},tL={type:"lock"},nL={type:"unlock"},zI=Math.PI/2;let qp=class extends g.SimpleEventDispatcher{constructor(a,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new u.Pa4(0,0,-1),this.domElement=e,this.object=a,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(a){this.isLocked||this.autoLockOnClick&&(a.preventDefault(),this.lock())}onMouseMove(a){this.isLocked&&(this._movementX+=a.movementX||a.mozMovementX||a.webkitMovementX||0,this._movementY+=a.movementY||a.mozMovementY||a.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(tL),this.isLocked=!0):(this.dispatchEvent(nL),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(a){return a.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(a){M0.setFromMatrixColumn(this.object.matrix,0),M0.crossVectors(this.object.up,M0),this.object.position.addScaledVector(M0,a)}moveRight(a){M0.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(M0,a)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(S0.setFromQuaternion(this.object.quaternion),S0.y-=.002*this._movementX*this.pointerSpeed,S0.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,S0.x=Math.max(zI-this.maxPolarAngle,Math.min(zI-this.minPolarAngle,S0.x)),this.object.quaternion.setFromEuler(S0),this.dispatchEvent(eL))}};E0([sn(),ke()],qp.prototype,"enabled",void 0),E0([gi(),ke()],qp.prototype,"minPolarAngle",void 0),E0([gi(),ke()],qp.prototype,"maxPolarAngle",void 0),E0([gi(),ke()],qp.prototype,"pointerSpeed",void 0),E0([sn(),ke()],qp.prototype,"autoLockOnClick",void 0),qp=E0([Ml("Pointer Lock Controls")],qp);class ZS extends Ww{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new qp(e,t.ownerDocument?t:t.documentElement)}}ZS.PluginType="PointerLockControlsPlugin";class jI{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new u.SUY}loadModel(e){this._model=e,this.mixer=new u.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){var t;const n=[];(t=this._animations)==null||t.forEach(i=>{n.push(this.playClip(i,e))}),await Promise.all(n)}async reverseAllAnimation(e){var t;const n=[];(t=this._animations)==null||t.forEach(i=>{n.push(this.playClip(i,e,1,!0))}),await Promise.all(n)}async playClip(e,t,n=1,i=!1,s=!1){if(!this.mixer)return;const o=this.mixer.clipAction(e);return this._playingAnimations.has(o)&&this.mixer.dispatchEvent({type:"canceled",action:o}),s&&(this.mixer.setTime(0),this.mixer.stopAllAction()),i?(o.paused=!1,o.timeScale=-n):(o.reset(),o.timeScale=n),o.loop=t?u.YKA:u.jAl,o.clampWhenFinished=!0,new Promise(l=>{const h=async d=>{d.action===o&&(this.mixer.removeEventListener("finished",h),this.mixer.removeEventListener("canceled",h),this._playingAnimations.delete(o),l())};this.mixer.addEventListener("finished",h),this.mixer.addEventListener("canceled",h),this._playingAnimations.add(o),o.play()})}playClipByName(e,t,n=1,i=!1){let s;this._animations.forEach(o=>{o.name===e&&(s=o)}),s&&this.playClip(s,t,n,i)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class VI extends Sn{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){var t;await super.onAdded(e),(t=this._viewer)==null||t.addEventListener("postFrame",()=>{this.helperIdentities.forEach(n=>{var i;n.update()&&((i=this._viewer)==null||i.setDirty())})})}createHelper(e,t){var n;if(this.helperIdentities.has(e))(n=this._viewer)==null||n.console.warn("Helper with this id already exists");else{const i=new jI;i.loadModel(t),this.helperIdentities.set(e,i)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,t,n,i=1,s=!1,o=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClip(t,n,i,s,o)}async playAllAnimations(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playAllAnimations(t)}async playAllAnimationsInReverse(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).reverseAllAnimation(t)}async playAnimationByName(e,t,n,i=1,s=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClipByName(t,n,i,s)}}VI.PluginType="AnimationHelperPlugin";class kA extends Sn{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,t,n)=>{(0,g.downloadBlob)(e,t)}},this.actions={...this.defaultActions}}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting"}),await this.actions.exportFile(e,t,({state:n,progress:i})=>{this.dispatchEvent({type:"transferFile",path:t,state:n??"exporting",progress:i})}),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}}kA.PluginType="FileTransferPlugin";var C0=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Pd extends Sn{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:u.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[ar],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=t=>{this._preFrame(t)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var e,t;return((t=(e=this._viewer)==null?void 0:e.getPlugin(ar))==null?void 0:t.camViews)??[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){var t;if(!this.enabled)return;const n=this._cameraViews;if(n.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=u.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=u.M8C.clamp(this._oldState,0,n.length-1.001);const i=Math.floor(this._oldState),s=this._overrideStartView||n[i],o=this._overrideEndView||n[i+1];let l,h=this._overrideStartView?this._overrideTime:this._oldState-i;h=Zh[this.animEase](h),l=this.interpolateMode==="spherical"?this._lerpViewsSpherical(s,o,h):this._lerpViewsLinear(s,o,h);const d=(t=this._viewer)==null?void 0:t.scene.activeCamera;d&&(d.position.copy(l[0]),d.target.copy(l[1]),d.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,t,n){const i=new u.Pa4,s=new u.Pa4;return s.lerpVectors(e.position,t.position,n),i.lerpVectors(e.target,t.target,n),[s,i]}_lerpViewsSpherical(e,t,n){const i=e.target.clone(),s=new u.Pa4,o=new u.Pa4,l=oo(e,e.target),h=oo(t,t.target),d=new u.$V;return d.phi=xc(l.phi,h.phi,n),d.theta=xc(l.theta,h.theta,n),d.radius=u.M8C.lerp(l.radius,h.radius,n),s.copy(i).lerp(t.target,n),o.setFromSpherical(d),o.add(s),[o,s]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new sa(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const t=Math.floor(this._oldState),n=this._oldState-t;let i;i=this.interpolateMode==="spherical"?this._lerpViewsSpherical(e[t],e[t+1],n):this._lerpViewsLinear(e[t],e[t+1],n),this._overrideEndView=new sa(i[0],i[1]),this._overrideTime=0}}Pd.PluginType="CameraViewControlPlugin",C0([sn("Enabled"),(0,g.onChange)(Pd.prototype._onEnabledChanged1),ke()],Pd.prototype,"enabled",void 0),C0([ke(),Eo("Ease",Object.keys(Zh).map(a=>({label:a})))],Pd.prototype,"animEase",void 0),C0([ke(),Eo("Interpolation",["spherical","linear"].map(a=>({label:a})))],Pd.prototype,"interpolateMode",void 0),C0([sn("Enable Damping"),ke()],Pd.prototype,"enableDamping",void 0),C0([gn("Damping",[.01,1],.001),ke()],Pd.prototype,"damping",void 0),C0([gn("Init Anim Time",[.01,5],.001),ke()],Pd.prototype,"initAnimationTime",void 0);class $S extends Pd{constructor(e=document.body,t=!0){super(t),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...Sl(this)]},typeof e=="string"?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){if(!this.enabled||this._cameraViews.length<=1)return;const t=this._findActiveView(),n=this._getScroll(t);this.setState(n+t),super._preFrame(e)}_getScroll(e){if(e>=this._cameraViews.length-1)return 0;const t=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],n=this.parent.querySelector(this._cameraViews[e+1].name)??this.parent.getElementsByTagName("section")[e+1],i=this.parent.getBoundingClientRect();if(!t||!n)return 0;const s=t.getBoundingClientRect(),o=n.getBoundingClientRect(),l=this.parent===document.body?0:i.top;return u.M8C.clamp((l-s.top)/Math.max(o.top-s.top,1e-4),0,1)}_findActiveView(){var e;for(let t=this._cameraViews.length-1;t>=0;t--){const n=this.parent.querySelector(this._cameraViews[t].name)??this.parent.getElementsByTagName("section")[t],i=this.parent.getBoundingClientRect();if(n){if(n.getBoundingClientRect().top<(this.parent===document.body?0:i.top))return t}else(e=this._cameraViews[t].name)!=null&&e.startsWith("#")&&console.error("section with id "+this._cameraViews[t].name+" doesn't exist!")}return 0}}$S.PluginType="ScrollableCameraViewPlugin";var eM,tM=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Pm=eM=class extends $S{generateCode(){var a;const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="200";const t=document.createElement("textarea");t.rows=20,t.style.border="3px solid #27223a",t.style.borderRadius="5px",t.style.width="30%",t.style.padding="5px",t.style.zIndex="1000";const n=document.createElement("div");n.textContent="X",n.style.color="red",n.style.width="20px",n.style.height="20px",n.style.padding="2",n.style.textAlign="center",n.style.backgroundColor="white",n.style.borderRadius="100%",n.style.border="2px solid #27223a",n.style.cursor="pointer",n.addEventListener("click",()=>{var s;(s=this._viewer)==null||s.container.removeChild(e)});const i=document.createElement("div");i.textContent="Update",i.style.marginTop="10px",i.style.color="white",i.style.padding="4px 10px 4px 10px",i.style.justifyContent="center",i.style.alignItems="center",i.style.backgroundColor="green",i.style.borderRadius="10px",i.style.border="2px solid #fff",i.style.cursor="pointer",i.addEventListener("click",()=>{var s;const o=this.parent.innerHTML;this.parent.innerHTML=t.value;let l=0;for(;l<this._cameraViews.length;l++){const h=this.parent.querySelector(this._cameraViews[l].name)??this.parent.getElementsByTagName("section")[l];if(!h&&l<2){alert("you need to add 2 sections at least");break}if(!h){const d=((s=this._cameraViews[l].name)==null||s.startsWith("#"),this._cameraViews[l].name.replace(/^#/,""));t.value+=d,t.value=this._format(t.value)}}l<2?this.parent.innerHTML=o:async function(h,d){var f;h.innerHTML=d;const v=h.getElementsByTagName("script");for(let y=0;y<v.length;y++){const w=v[y],E=JR(w);let M=!1;await new Promise(P=>{E.onload=P,E.onerror=()=>{M=!0,P(void 0)}}),M||((f=w.parentNode)==null||f.replaceChild(E,w))}}(this.parent,t.value)}),e.appendChild(n),e.appendChild(t),e.appendChild(i),t.value=this._format(this.parent.innerHTML),(a=this._viewer)==null||a.container.appendChild(e)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(a=document.body,e=!1){super(a,e),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(a){var e,t,n,i,s,o;this.parent=this.wrapper,await super.onAdded(a),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(t=(e=this._viewer)==null?void 0:e.getPlugin(ar))==null||t.addEventListener("viewDelete",this.deleteView),(i=(n=this._viewer)==null?void 0:n.getPlugin(ar))==null||i.addEventListener("deserialize",this.deserialize),(o=(s=this._viewer)==null?void 0:s.getPlugin(ar))==null||o.addEventListener("viewAdd",this.addView)}deserialize(a){this._cameraViews.forEach(e=>{this._createSection(e.name)})}_addWrapper(){var a;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(a=this._viewer)==null||a.container.appendChild(this.wrapper)}_createSection(a){const e=document.createElement("section");e.style.width="100%",e.style.height="100%",e.style.opacity="50%",e.style.backgroundColor="black",e.style.zIndex="100",e.style.top="0",e.textContent=a,e.style.color="white",e.style.fontSize="100px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.id=a,this.parent.appendChild(e)}addView(a){this._cameraViews.forEach((e,t)=>{var n;if(!(this.parent.querySelector(e.name)??this.parent.getElementsByTagName("section")[t])){const i=`<section id="${(n=e.name)!=null&&n.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${e.name}
                    </section>`;this.parent.innerHTML+=i}})}deleteView(a){const e=this.parent.querySelector(a.view.name)??this.parent.getElementsByTagName("section").namedItem(a.view.name);e==null||e.remove()}_format(a){let e="",t="";return a.split(/>\s*</).forEach(function(n){n.match(/^\/\w/)&&(t=t.substring(1)),e+=t+"<"+n+`>\r
`,n.match(/^<?\w[^>]*[^/]$/)&&!n.startsWith("input")&&(t+="	")}),e.substring(1,e.length-3)}};tM([Bi("Show/Edit Code")],Pm.prototype,"generateCode",null),tM([sn("Canvas on top"),(0,g.onChange)(eM.prototype._togglePreview)],Pm.prototype,"canvasUp",void 0),Pm=eM=tM([Vn("Scrollable Camera View Preview (Dev)")],Pm);var nM={d:(a,e)=>{for(var t in e)nM.o(e,t)&&!nM.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:e[t]})},o:(a,e)=>Object.prototype.hasOwnProperty.call(a,e)},GI={};nM.d(GI,{Q:()=>aL});var iM=function(a,e,t,n){return new(t||(t=Promise))(function(i,s){function o(d){try{h(n.next(d))}catch(f){s(f)}}function l(d){try{h(n.throw(d))}catch(f){s(f)}}function h(d){var f;d.done?i(d.value):(f=d.value,f instanceof t?f:new t(function(v){v(f)})).then(o,l)}h((n=n.apply(a,e||[])).next())})};const HI=Symbol("Comlink.proxy"),iL=Symbol("Comlink.endpoint"),rL=Symbol("Comlink.releaseProxy"),rM=Symbol("Comlink.thrown"),QI=a=>typeof a=="object"&&a!==null||typeof a=="function",WI=new Map([["proxy",{canHandle:a=>QI(a)&&a[HI],serialize(a){const{port1:e,port2:t}=new MessageChannel;return qI(a,e),[t,[t]]},deserialize:a=>(a.start(),YI(a))}],["throw",{canHandle:a=>QI(a)&&rM in a,serialize({value:a}){let e;return e=a instanceof Error?{isError:!0,value:{message:a.message,name:a.name,stack:a.stack}}:{isError:!1,value:a},[e,[]]},deserialize(a){throw a.isError?Object.assign(new Error(a.value.message),a.value):a.value}}]]);function qI(a,e=self){e.addEventListener("message",function t(n){if(!n||!n.data)return;const{id:i,type:s,path:o}=Object.assign({path:[]},n.data),l=(n.data.argumentList||[]).map(hv);let h;try{const d=o.slice(0,-1).reduce((v,y)=>v[y],a),f=o.reduce((v,y)=>v[y],a);switch(s){case"GET":h=f;break;case"SET":d[o.slice(-1)[0]]=hv(n.data.value),h=!0;break;case"APPLY":h=f.apply(d,l);break;case"CONSTRUCT":h=Xw(new f(...l));break;case"ENDPOINT":{const{port1:v,port2:y}=new MessageChannel;qI(a,y),h=function(w,E){return JI.set(w,E),w}(v,[v])}break;case"RELEASE":h=void 0;break;default:return}}catch(d){h={value:d,[rM]:0}}Promise.resolve(h).catch(d=>({value:d,[rM]:0})).then(d=>{const[f,v]=aM(d);e.postMessage(Object.assign(Object.assign({},f),{id:i}),v),s==="RELEASE"&&(e.removeEventListener("message",t),XI(e))})}),e.start&&e.start()}function XI(a){(function(e){return e.constructor.name==="MessagePort"})(a)&&a.close()}function YI(a,e){return sM(a,[],e)}function qw(a){if(a)throw new Error("Proxy has been released and is not useable")}function sM(a,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(s,o){if(qw(n),o===rL)return()=>T0(a,{type:"RELEASE",path:e.map(l=>l.toString())}).then(()=>{XI(a),n=!0});if(o==="then"){if(e.length===0)return{then:()=>i};const l=T0(a,{type:"GET",path:e.map(h=>h.toString())}).then(hv);return l.then.bind(l)}return sM(a,[...e,o])},set(s,o,l){qw(n);const[h,d]=aM(l);return T0(a,{type:"SET",path:[...e,o].map(f=>f.toString()),value:h},d).then(hv)},apply(s,o,l){qw(n);const h=e[e.length-1];if(h===iL)return T0(a,{type:"ENDPOINT"}).then(hv);if(h==="bind")return sM(a,e.slice(0,-1));const[d,f]=KI(l);return T0(a,{type:"APPLY",path:e.map(v=>v.toString()),argumentList:d},f).then(hv)},construct(s,o){qw(n);const[l,h]=KI(o);return T0(a,{type:"CONSTRUCT",path:e.map(d=>d.toString()),argumentList:l},h).then(hv)}});return i}function KI(a){const e=a.map(aM);return[e.map(n=>n[0]),(t=e.map(n=>n[1]),Array.prototype.concat.apply([],t))];var t}const JI=new WeakMap;function Xw(a){return Object.assign(a,{[HI]:!0})}function aM(a){for(const[e,t]of WI)if(t.canHandle(a)){const[n,i]=t.serialize(a);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:a},JI.get(a)||[]]}function hv(a){switch(a.type){case"HANDLER":return WI.get(a.name).deserialize(a.value);case"RAW":return a.value}}function T0(a,e,t){return new Promise(n=>{const i=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");a.addEventListener("message",function s(o){o.data&&o.data.id&&o.data.id===i&&(a.removeEventListener("message",s),n(o.data))}),a.start&&a.start(),a.postMessage(Object.assign({id:i},e),t)})}class sL extends class{}{init(e,t,n,i){if(!this.api){if(!i)throw new Error("workerFilePath is required");(()=>{var s,o,l;s=this,l=function*(){const h=yield fetch(i).then(v=>v.blob()),d=URL.createObjectURL(h),f=new Worker(d,{type:"module"});this.api=yield new(YI(f))(Xw(()=>{e(),URL.revokeObjectURL(d)}),Xw((v,y)=>v==="xatlas_web.wasm"?n:v+y),Xw(t))},new((o=void 0)||(o=Promise))(function(h,d){function f(w){try{y(l.next(w))}catch(E){d(E)}}function v(w){try{y(l.throw(w))}catch(E){d(E)}}function y(w){var E;w.done?h(w.value):(E=w.value,E instanceof o?E:new o(function(M){M(E)})).then(f,v)}y((l=l.apply(s,[])).next())})})()}}}class aL extends class{constructor(e,t={resolution:2048},n={},i=!1,s=!1,o=!1){this.THREE=e,this.packOptions=t,this.chartOptions=n,this.useNormals=i,this.timeUnwrap=s,this.logProgress=o,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,t,n){return iM(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((i,s)=>{try{this.xAtlas.init(()=>{i()},e,t,n)}catch(o){s(o)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(i=>setTimeout(i,100));this._libraryLoaded=!0}})}packAtlas(e,t="uv2",n="uv"){return iM(this,void 0,void 0,function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const i=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(d=>setTimeout(d,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let s=[],o="";for(let d of e){let{uuid:f,index:v,attributes:y}=d;const w=d.userData.worldScale||1;s.push(f),v&&y.position&&y.position.itemSize===3?(o="Mesh"+s.length+" added to atlas: "+f,this.timeUnwrap&&console.time(o),yield this.xAtlas.api.addMesh(v.array,y.position.array,y.normal?y.normal.array:void 0,y.uv?y.uv.array:void 0,f,this.useNormals,i,w),this.timeUnwrap&&console.timeEnd(o)):console.warn("xatlas-three: Geometry not supported: ",d)}o="Generated atlas with "+s.length+" meshes",this.timeUnwrap&&console.time(o);let l=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(o);let h=[];for(let d of l){let f=e.find(v=>v.uuid===d.mesh);f?(d.vertex.vertices&&f.setAttribute("position",new this.THREE.BufferAttribute(d.vertex.vertices,3,!1)),d.vertex.normals&&f.setAttribute("normal",new this.THREE.BufferAttribute(d.vertex.normals,3,!0)),d.vertex.coords1&&f.setAttribute(t,new this.THREE.BufferAttribute(d.vertex.coords1,2,!1)),d.vertex.coords&&t!==n&&f.setAttribute(n,new this.THREE.BufferAttribute(d.vertex.coords,2,!1)),d.index&&f.setIndex(new this.THREE.BufferAttribute(d.index,1,!1)),h.push(f)):console.error("xatlas-three: Mesh not found: ",d.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,h})}unwrapGeometry(e,t="uv",n="uv2"){return iM(this,void 0,void 0,function*(){return this.packAtlas([e],t,n)})}}{_createXAtlas(){return new sL}}var UA,oL=GI.Q,Pr=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let yl=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};Pr([ke()],yl.prototype,"fixWinding",void 0),Pr([ke()],yl.prototype,"maxBoundaryLength",void 0),Pr([ke()],yl.prototype,"maxChartArea",void 0),Pr([ke()],yl.prototype,"maxCost",void 0),Pr([ke()],yl.prototype,"maxIterations",void 0),Pr([ke()],yl.prototype,"normalDeviationWeight",void 0),Pr([ke()],yl.prototype,"normalSeamWeight",void 0),Pr([ke()],yl.prototype,"roundnessWeight",void 0),Pr([ke()],yl.prototype,"straightnessWeight",void 0),Pr([ke()],yl.prototype,"textureSeamWeight",void 0),Pr([ke()],yl.prototype,"useInputMeshUvs",void 0),yl=Pr([Vn("Chart Options"),Ko("UChartOptions")],yl);let nc=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};Pr([ke()],nc.prototype,"bilinear",void 0),Pr([ke()],nc.prototype,"blockAlign",void 0),Pr([ke()],nc.prototype,"bruteForce",void 0),Pr([ke()],nc.prototype,"createImage",void 0),Pr([ke()],nc.prototype,"maxChartSize",void 0),Pr([ke()],nc.prototype,"padding",void 0),Pr([ke()],nc.prototype,"resolution",void 0),Pr([ke()],nc.prototype,"rotateCharts",void 0),Pr([ke()],nc.prototype,"rotateChartsToAxis",void 0),Pr([ke()],nc.prototype,"texelsPerUnit",void 0),nc=Pr([Vn("Pack Options"),Ko("UPackOptions")],nc);let uu=UA=class extends Sn{constructor(a=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new yl,this.packOptions=new nc,this._loaded=!1,this._unwrapProgress=(e,t)=>{console.log("Unwrapping",e,t)},this.unwrapSelected=async()=>{var e,t,n,i,s;const o=(t=(e=this._viewer)==null?void 0:e.getPlugin(Ti))==null?void 0:t.getSelectedObject();if(o)if(o.geometry){if(o.geometry.attributes.uv&&!await((n=this._viewer)==null?void 0:n.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(o.geometry)}else(i=this._viewer)==null||i.alert("Unwrap: Selected object has no geometry");else(s=this._viewer)==null||s.alert("Unwrap: No object selected")},a&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,g.timeout)(100);else this._unwrapper=new oL({BufferAttribute:u.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,UA.LIBRARY_PATH+"xatlas.wasm",UA.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(a,e="uv",t="uv"){var n;await this.loadLibrary(),await((n=this._unwrapper)==null?void 0:n.unwrapGeometry(a,e,t))}async packAtlas(a,e=!0,t="uv2",n="uv"){var i;await this.loadLibrary(),Array.isArray(a)||(a=[a]);const s=[];e?a.forEach(o=>o.traverse(l=>{l.geometry&&s.push(l.geometry)})):a.forEach(o=>{o.geometry&&s.push(o.geometry)}),await((i=this._unwrapper)==null?void 0:i.packAtlas(s,t,n))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};uu.PluginType="XAtlasPlugin",uu.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",Pr([(0,g.onChange)(UA.prototype._useNormalsChanged),ke()],uu.prototype,"useNormals",void 0),Pr([ke()],uu.prototype,"chartOptions",void 0),Pr([ke()],uu.prototype,"packOptions",void 0),Pr([Bi("Unwrap Selected Geometry")],uu.prototype,"unwrapSelected",void 0),uu=UA=Pr([Vn("UV Unwrapping (xAtlas)")],uu);class NA extends Sn{constructor(){super(...arguments),this.dependencies=[Yt],this.enabled=!0,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,t)=>{let n=e.icon;return(n&&/^(\w+)\(([^)]*)\)/.exec(n)||/^#([A-Fa-f\d]+)$/.exec(n))&&(n=(0,g.makeColorSvg)(n)),n&&n.startsWith("http")&&n.startsWith("data:")||(n=this.utils.pathToIcon(this.baseUrl+t+"/"+e.prefix+(n||""))),n},getItemIcon:(e,t,n)=>{const i=e.iconFiles[t];if(i)return URL.createObjectURL(i);let s=e.icons[t];return(s&&/^(\w+)\(([^)]*)\)/.exec(s)||/^#([A-Fa-f\d]+)$/.exec(s))&&(s=(0,g.makeColorSvg)(s)),s||(s=this.utils.pathToIcon(e.items[t])),!s||s.startsWith("http")||s.startsWith("data:")||(s=this.baseUrl+n+"/"+e.prefix+s),s},getItemTitle:(e,t)=>e.titles[t]||this.utils.pathToTitle(e.items[t]),getItemPath:(e,t,n)=>e.items[t].startsWith("http")?e.items[t]:`${this.baseUrl}${n}/${e.prefix}${e.items[t]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,t,n,i=!1){var s,o;if(!this._viewer)return;const l=this._getVariationId(e);typeof t=="number"&&(t=e.items[t]);const h=e.items.indexOf(t);if(h===-1)return void this._viewer.console.warn(`Item ${t} not found`);const d=e.itemFiles[h],f=e.selected;if(!i&&f===h)return;e.selected=h;const v=this._viewer.getManager(),y=this.utils.getItemPath(e,h,n);if(n==="objects"){let w=this._viewer.scene.findObjectsByName(l).map(R=>R.modelObject);w.length===0&&(w=[(await this._viewer.createObject3D()).modelObject],w[0].name=l),this._viewer.renderEnabled=!1;for(const R of w)[...R.children].forEach(I=>I.dispose&&this.autoDispose?I.dispose():I.removeFromParent());const E=await this._loadObject(y,d);if(!E.length)return void(y.endsWith("json")||this._viewer.console.warn(`Object ${y} not found`));let M=!1;for(const R of w){[...R.children].forEach(I=>I.dispose&&this.autoDispose?I.dispose():I.removeFromParent());for(const I of E)M?R.add(I.modelObject.clone()):R.add(I.modelObject);M=!0}const P=[],L=this.variations.materials.filter(R=>R&&typeof R.selected=="number");for(const R of L)P.push(this.applyVariation(R,R.selected,"materials",!0));await Promise.all(P),this._viewer.renderEnabled=!0}if(n==="materials"){const w=await this._loadMaterial(y,d);if(!w)return void this._viewer.console.warn(`Material ${y} not found`);w.userData.__isVariation=!0;const E=this._viewer.scene.findObjectsByName(l),M=P=>{var L,R,I;P.material&&(Array.isArray(P.material)?P.material.length!==0&&((L=e.data)==null?void 0:L.matType)!==P.material[0].typeSlug:((R=e.data)==null?void 0:R.matType)!==P.material.typeSlug)||((I=P==null?void 0:P.setMaterial)==null||I.call(P,w))};for(const P of E)(s=e.data)!=null&&s.traverse?P.traverse(M):M(P);(o=v.materials)==null||o.applyMaterial(w,l)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const t of e){const n=this._getVariationId(t),i=this._viewer.scene.findObjectsByName(n);for(const s of i)[...s.children].forEach(o=>(o.dispose??o.removeFromParent)())}}async _loadMaterial(e,t){var n,i,s;return(s=(i=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:i.importer)==null?void 0:s.importSinglePath(e,{importedFile:t})}async _loadObject(e,t){var n,i,s;return(s=(i=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:i.importer)==null?void 0:s.importPath(e,{importedFile:t,reimportDisposed:!0})}importConfig(e,t){typeof e=="string"&&(e=JSON.parse(e)),e.baseUrl!==void 0&&(this.baseUrl=e.baseUrl),!t&&e.folder&&(t=typeof e.folder=="object"?e.folder:typeof e.folder=="string"?ip(wa(e.folder)):ip(e.folder));for(const n of this._ty)if(e[n])for(const i of e[n]){const s={items:i.items,prefix:i.prefix,name:i.name,title:i.title||"",icon:i.icon||"",icons:i.icons??i.items.map(()=>""),titles:i.titles??i.items.map(()=>""),itemFiles:[],iconFiles:[],data:{...i.data}};if(t)for(let o=0;o<i.items.length;o++){const l=i.items[o],h=t[n+"/"+i.prefix+l];s.itemFiles[o]=h?new File([h],l):void 0;const d=i.icons[o];if(!d)continue;const f=t[n+"/"+i.prefix+d];s.iconFiles[o]=f?new File([f],d):void 0}this.variations[n].push(s)}}async importPath(e){var t,n;if(e.endsWith(".json")){const i=await((n=(t=this._viewer)==null?void 0:t.getManager().importer)==null?void 0:n.importSinglePath(e,{processImported:!1})),s=e.split("?")[0];return this.baseUrl||(this.baseUrl=s.substring(0,s.lastIndexOf("/")+1)),this.importConfig(i)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){var t;return((t=this.variations.materials.find(n=>this.utils.getName(n)===e))==null?void 0:t.items)||[]}getObjects(e){var t;return((t=this.variations.objects.find(n=>this.utils.getName(n)===e))==null?void 0:t.items)||[]}getMaterialVariations(){return this.variations.materials.map(e=>this.utils.getName(e))}getObjectVariations(){return this.variations.objects.map(e=>this.utils.getName(e))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){var e;let t={objects:{},materials:{}};const n={objects:[],materials:[],type:NA.PluginType};this.baseUrl&&(n.baseUrl=this.baseUrl);let i=!1;for(const s of this._ty)for(const o of this.variations[s]){const l={...o};l.data={...l.data},delete l.itemFiles,delete l.iconFiles,n[s].push(l);const h=o.prefix.replace(/^\//,""),d=h.trimEnd().endsWith("/")?"":h.split("/").pop()||"",f=h.replace(d,"").trimEnd().replace(/\/$/,""),v={};let y=!1;for(let M=0;M<o.items.length;M++){const P=o.items[M],L=o.itemFiles[M],R=o.iconFiles[M],I=o.icons[M];L?(v[d+P]=new Uint8Array(await L.arrayBuffer()),R&&!I&&((e=this._viewer)==null||e.console.error("Icon file without icon name")),R&&I&&(v[d+I]=new Uint8Array(await R.arrayBuffer())),y=!0):R&&alert("Icon file without model/material file not supported")}if(!y)continue;i=!0;const w=f.split("/");let E=t[s];for(const M of w){E[M]||(E[M]={});const P=E[M];if(typeof P!="object")throw new Error("Invalid prefix: "+o.prefix);E=P}Object.assign(E,v)}return i||(t=void 0),{folder:t,config:n}}}NA.PluginType="VariationConfiguratorPlugin";class I0 extends NA{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,Qe.RemoveAll(I0.PluginType);for(const e of["objects","materials"])for(const t of this.variations[e])Qe.Create(I0.PluginType,this.utils.getTitle(t),5,20,0,t.items.map((n,i)=>({id:n,image:this.utils.getItemIcon(t,i,e),onClick:async s=>this.applyVariation(t,s,e,!1),tooltip:this.utils.getItemTitle(t,i)})),(n,i)=>_m(n,{placement:"bottom",content:i.tooltip}));return Qe.RebuildUi(this._viewer.container),!0}}I0.PluginType="VariationConfiguratorPlugin";class FA extends I0{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map(t=>({type:"folder",expanded:this._uiExpandedState[t.name],onExpand:()=>this._uiExpandedState[t.name]=!0,onCollapse:()=>this._uiExpandedState[t.name]=!1,label:()=>this.utils.getName(t),children:[{type:"input",placeholder:()=>this.utils.getName(t),property:[t,"name"]},{type:"input",property:[t,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(t)),property:[t,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+t.prefix),property:[t,"icon"]},{type:"folder",label:"items",children:t.items.map((n,i)=>({type:"folder",label:()=>t.items[i],children:[{type:"input",label:"File/URL",isMonitor:!t.itemFiles[i],getValue:()=>t.items[i],setValue:s=>{t.items[i]=s}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(t.items[i]),getValue:()=>t.icons[i],setValue:s=>{t.icons[i]=s}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(t.items[i]),getValue:()=>t.titles[i],setValue:s=>{t.titles[i]=s}},{type:"button",label:"Apply",value:async()=>this.applyVariation(t,i,e)},t.itemFiles[i]?[{type:"button",label:"Remove",value:()=>{t.items.splice(i,1),t.itemFiles.splice(i,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const s=await(0,g.uploadFile)(!1,!1);s.length!==0&&(t.itemFiles[i]=s[0],t.items[i]=s[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const s=t.itemFiles[i];(0,g.downloadBlob)(s,s.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var n,i;const s=await(0,g.uploadFile)(!0,!1);if(s.length!==0){for(const o of s){if(!this._extForType[e].includes(o.name.split(".").pop()??"")){await((n=this._viewer)==null?void 0:n.alert(`Invalid file: ${o.name} is not a valid ${e} file`));continue}if(t.items.includes(o.name)){await((i=this._viewer)==null?void 0:i.alert(`Already exists: Item with name ${o.name} already exists`));continue}const l=t.items.push(o.name)-1;t.icons[l]="",t.titles[l]="",t.itemFiles[l]=o}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var n,i,s,o;const l=await((n=this._viewer)==null?void 0:n.prompt("URL: Enter the url of the object/material"));if(!l)return;if(!l.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((i=this._viewer)==null?void 0:i.alert(`Invalid url: ${l} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(l.split(".").pop()??""))return void await((s=this._viewer)==null?void 0:s.alert(`Invalid url: ${l} should be of a material ending with mat`));t.items.includes(l)&&await((o=this._viewer)==null?void 0:o.alert(`Already exists: Item with url ${l} already exists`)),t.items.push(l);const h=t.items.length-1;t.icons[h]="",t.titles[h]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(t),value:async()=>{var n;await((n=this._viewer)==null?void 0:n.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(t)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(t),1),this.refreshUi())}}]})),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{var t;const n=await((t=this._viewer)==null?void 0:t.prompt("Name: Enter the name of the object/material"));n&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:n+"/",name:n,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{var t,n,i;const s=await(0,g.uploadFile)(!1,!0);if(s.length===0)return;const o=[],l=[],h=[],d=[];for(const E of s){if(E.name.startsWith("."))continue;const M=E.name.split(".").pop()??"";M?this._extForType[e].includes(M)?(o.push(E.webkitRelativePath.replace(/^\//,"")),l.push(E)):this._extForType.images.includes(M)?(h.push(E.webkitRelativePath.replace(/^\//,"")),d.push(E)):await((t=this._viewer)==null?void 0:t.alert(`Invalid file: ${E.name} is not a valid ${e} file`)):await((n=this._viewer)==null?void 0:n.alert(`Invalid file: ${E.name} has no extension`))}const f=(0,g.longestCommonPrefix)(o),v=this.utils.getName({prefix:f});let y=await((i=this._viewer)==null?void 0:i.prompt("Name: Enter the name of the object/material",v,!0));if(y===null)return;y=y||v;const w=o.map(E=>{const M=E.replace(f,""),P=M.split(".").pop()??"",L=M.replace("."+P,"")+".",R=h.findIndex(I=>I.replace(f,"").startsWith(L));return R<0?["",void 0]:[h[R].replace(f,""),d[R]||void 0]});this.variations[e].push({items:o.map(E=>E.replace(f,"")),icons:w.map(E=>E[0]),iconFiles:w.map(E=>E[1]),titles:o.map(()=>""),itemFiles:l,prefix:f,name:y,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var e,t;try{const{folder:n,config:i}=await this._exportConfiguratorState(),s=JSON.stringify(i,null,4);if(n){n["config.json"]=wa(s);const o=await Q0(n),l=new Blob([o],{type:"application/zip"});(0,g.downloadBlob)(l,"configurator.zip")}else{const o=new Blob([s],{type:"application/json"});(0,g.downloadBlob)(o,"config.json")}}catch(n){return(e=this._viewer)==null||e.console.error(n),void await((t=this._viewer)==null?void 0:t.alert("Error: "+((n==null?void 0:n.message)||n)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var e,t,n;const i=await(0,g.uploadFile)(!1,!1,"application/zip,application/json");if(i.length===0)return;const s=i[0];if(s.name.endsWith(".zip")){const o=ip(new Uint8Array(await s.arrayBuffer()));if(!o["config.json"])return void await((e=this._viewer)==null?void 0:e.alert("Invalid zip: config.json not found"));const l=JSON.parse(Kc(o["config.json"]));this.importConfig(l,o)}else{if(!s.name.endsWith(".json"))return void await((t=this._viewer)==null?void 0:t.alert("Invalid file: "+s.name));{const o=JSON.parse(await s.text());this.importConfig(o)}}await((n=this._viewer)==null?void 0:n.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var e,t;const n=await((e=this._viewer)==null?void 0:e.prompt("URL: Enter the url of the json file."));n&&(await this.importPath(n),await((t=this._viewer)==null?void 0:t.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var e,t;(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,t){const n=await super._loadObject(e,t);for(const i of n)(i.modelObject||i).userData.excludeFromExport=!0;return n}}FA.PluginType="VariationConfiguratorPlugin";class Xp extends Sn{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=e=>{const t=e.object;t!=null&&t.traverse&&t.traverse(n=>{var i,s;n.userData[Xp.PluginType]===void 0&&(n.userData[Xp.PluginType]={transforms:[]});const o={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var l;this.addTransform(n),(l=o==null?void 0:o.uiRefresh)==null||l.call(o)}},()=>n.userData[Xp.PluginType].transforms.map((l,h)=>({type:"folder",label:`Transform ${h}`,children:[{type:"vec3",label:"Position",property:[l,"position"]},{type:"vec3",label:"Quaternion",property:[l,"quaternion"]},{type:"vec3",label:"Scale",property:[l,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(n,l)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(n,l)}}]}))]};(s=(i=n.uiConfig)==null?void 0:i.children)==null||s.push(o)})}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(e)}addTransform(e){e.userData[Xp.PluginType].transforms.push({position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()})}setTransform(e,t){var n,i,s,o;e.position.copy(t.position),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale),(i=(n=e.userData).setDirty)==null||i.call(n),(o=(s=e.uiConfig)==null?void 0:s.uiRefresh)==null||o.call(s)}animateTransform(e,t,n=2e3){var i,s;const o=(i=this._viewer)==null?void 0:i.getPluginByType("PopmotionPlugin");o||((s=this._viewer)==null||s.console.error("PopmotionPlugin required for animation"));const l=typeof t=="number"?e.userData[Xp.PluginType].transforms[t]:t,h=new u.Pa4,d=new u._fP,f=new u.Pa4,v=e.position.clone(),y=e.quaternion.clone(),w=e.scale.clone(),E=l.position,M=l.quaternion,P=l.scale;return o==null?void 0:o.animate({from:0,to:1,duration:n,onUpdate:L=>{var R,I;h.lerpVectors(v,E,L),d.slerpQuaternions(y,M,L),f.lerpVectors(w,P,L),e.position.copy(h),e.quaternion.copy(d),e.scale.copy(f),(R=this._viewer)==null||R.setDirty(),(I=this._viewer)==null||I.renderer.resetShadows()},onStop:()=>{var L,R,I,N;e.position.copy(l.position),e.quaternion.copy(l.quaternion),e.scale.copy(l.scale),(R=(L=e.userData).setDirty)==null||R.call(L),(N=(I=e.uiConfig)==null?void 0:I.uiRefresh)==null||N.call(I)}})}}Xp.PluginType="TransformAnimationPlugin";var ZI=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let dv=class extends Sn{constructor(a=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._preRender=()=>{if(this.enabled&&this._viewer)for(const e of this.cameras){if(!e.enabled)continue;const t=this._viewer,n=e.camera;try{t.scene.renderCamera=n,t.renderer.render(!1);const i=t.renderer.composer.readBuffer;t.renderer.blit(i.texture,e.target)}catch(i){console.error(i),e.enabled=!1}}},this.enabled=a}async onAdded(a){await super.onAdded(a),a.addEventListener("preRender",this._preRender)}addCamera(a){if(!this._viewer)throw"Plugin not added to viewer";const e={camera:a,target:this._viewer.renderer.composerTarget.clone(!0),enabled:!0};return this.cameras.push(e),e}};dv.PluginType="VirtualCamerasPlugin",ZI([sn()],dv.prototype,"enabled",void 0),dv=ZI([Vn("Virtual Cameras")],dv);class ch{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ge);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ge);const n=this.elements,i=e.x,s=e.y,o=e.z;return t.x=n[0]*i+n[1]*s+n[2]*o,t.y=n[3]*i+n[4]*s+n[5]*o,t.z=n[6]*i+n[7]*s+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new ch);const n=this.elements,i=e.elements,s=t.elements,o=n[0],l=n[1],h=n[2],d=n[3],f=n[4],v=n[5],y=n[6],w=n[7],E=n[8],M=i[0],P=i[1],L=i[2],R=i[3],I=i[4],N=i[5],j=i[6],H=i[7],X=i[8];return s[0]=o*M+l*R+h*j,s[1]=o*P+l*I+h*H,s[2]=o*L+l*N+h*X,s[3]=d*M+f*R+v*j,s[4]=d*P+f*I+v*H,s[5]=d*L+f*N+v*X,s[6]=y*M+w*R+E*j,s[7]=y*P+w*I+E*H,s[8]=y*L+w*N+E*X,t}scale(e,t){t===void 0&&(t=new ch);const n=this.elements,i=t.elements;for(let s=0;s!==3;s++)i[3*s+0]=e.x*n[3*s+0],i[3*s+1]=e.y*n[3*s+1],i[3*s+2]=e.z*n[3*s+2];return t}solve(e,t){t===void 0&&(t=new ge);const n=[];let i,s;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(s=0;s<3;s++)n[i+4*s]=this.elements[i+3*s];n[3]=e.x,n[7]=e.y,n[11]=e.z;let o=3;const l=o;let h,d;do{if(i=l-o,n[i+4*i]===0){for(s=i+1;s<l;s++)if(n[i+4*s]!==0){h=4;do d=4-h,n[d+4*i]+=n[d+4*s];while(--h);break}}if(n[i+4*i]!==0)for(s=i+1;s<l;s++){const f=n[i+4*s]/n[i+4*i];h=4;do d=4-h,n[d+4*s]=d<=i?0:n[d+4*s]-n[d+4*i]*f;while(--h)}}while(--o);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){e===void 0&&(e=new ch);const t=lL;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)t[n+6*i]=this.elements[n+3*i];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let s=3;const o=s;let l,h;do{if(n=o-s,t[n+6*n]===0){for(i=n+1;i<o;i++)if(t[n+6*i]!==0){l=6;do h=6-l,t[h+6*n]+=t[h+6*i];while(--l);break}}if(t[n+6*n]!==0)for(i=n+1;i<o;i++){const d=t[n+6*i]/t[n+6*n];l=6;do h=6-l,t[h+6*i]=h<=n?0:t[h+6*i]-t[h+6*n]*d;while(--l)}}while(--s);n=2;do{i=n-1;do{const d=t[n+6*i]/t[n+6*n];l=6;do h=6-l,t[h+6*i]=t[h+6*i]-t[h+6*n]*d;while(--l)}while(i--)}while(--n);n=2;do{const d=1/t[n+6*n];l=6;do h=6-l,t[h+6*n]=t[h+6*n]*d;while(--l)}while(n--);n=2;do{i=2;do{if(h=t[3+i+6*n],isNaN(h)||h===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(n,i,h)}while(i--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,s=e.w,o=t+t,l=n+n,h=i+i,d=t*o,f=t*l,v=t*h,y=n*l,w=n*h,E=i*h,M=s*o,P=s*l,L=s*h,R=this.elements;return R[0]=1-(y+E),R[1]=f-L,R[2]=v+P,R[3]=f+L,R[4]=1-(d+E),R[5]=w-M,R[6]=v-P,R[7]=w+M,R[8]=1-(d+y),this}transpose(e){e===void 0&&(e=new ch);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const lL=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ge{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new ge);const n=e.x,i=e.y,s=e.z,o=this.x,l=this.y,h=this.z;return t.x=l*s-h*i,t.y=h*n-o*s,t.z=o*i-l*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new ge(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new ge(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new ch([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const s=1/i;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return i}unit(e){e===void 0&&(e=new ge);const t=this.x,n=this.y,i=this.z;let s=Math.sqrt(t*t+n*n+i*i);return s>0?(s=1/s,e.x=t*s,e.y=n*s,e.z=i*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,l=e.z;return Math.sqrt((s-t)*(s-t)+(o-n)*(o-n)+(l-i)*(l-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,l=e.z;return(s-t)*(s-t)+(o-n)*(o-n)+(l-i)*(l-i)}scale(e,t){t===void 0&&(t=new ge);const n=this.x,i=this.y,s=this.z;return t.x=e*n,t.y=e*i,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new ge),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new ge),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ge),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=cL,s=1/n;i.set(this.x*s,this.y*s,this.z*s);const o=uL;Math.abs(i.x)<.9?(o.set(1,0,0),i.cross(o,e)):(o.set(0,1,0),i.cross(o,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,s=this.y,o=this.z;n.x=i+(e.x-i)*t,n.y=s+(e.y-s)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate($I),$I.almostEquals(e,t)}clone(){return new ge(this.x,this.y,this.z)}}ge.ZERO=new ge(0,0,0),ge.UNIT_X=new ge(1,0,0),ge.UNIT_Y=new ge(0,1,0),ge.UNIT_Z=new ge(0,0,1);const cL=new ge,uL=new ge,$I=new ge;class hs{constructor(e){e===void 0&&(e={}),this.lowerBound=new ge,this.upperBound=new ge,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const s=this.lowerBound,o=this.upperBound,l=n;s.copy(e[0]),l&&l.vmult(s,s),o.copy(s);for(let h=1;h<e.length;h++){let d=e[h];l&&(l.vmult(d,eP),d=eP),d.x>o.x&&(o.x=d.x),d.x<s.x&&(s.x=d.x),d.y>o.y&&(o.y=d.y),d.y<s.y&&(s.y=d.y),d.z>o.z&&(o.z=d.z),d.z<s.z&&(s.z=d.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),i&&(s.x-=i,s.y-=i,s.z-=i,o.x+=i,o.y+=i,o.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new hs().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound,o=i.x<=n.x&&n.x<=s.x||t.x<=s.x&&s.x<=n.x,l=i.y<=n.y&&n.y<=s.y||t.y<=s.y&&s.y<=n.y,h=i.z<=n.z&&n.z<=s.z||t.z<=s.z&&s.z<=n.z;return o&&l&&h}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound;return t.x<=i.x&&n.x>=s.x&&t.y<=i.y&&n.y>=s.y&&t.z<=i.z&&n.z>=s.z}getCorners(e,t,n,i,s,o,l,h){const d=this.lowerBound,f=this.upperBound;e.copy(d),t.set(f.x,d.y,d.z),n.set(f.x,f.y,d.z),i.set(d.x,f.y,f.z),s.set(f.x,d.y,f.z),o.set(d.x,f.y,d.z),l.set(d.x,d.y,f.z),h.copy(f)}toLocalFrame(e,t){const n=tP,i=n[0],s=n[1],o=n[2],l=n[3],h=n[4],d=n[5],f=n[6],v=n[7];this.getCorners(i,s,o,l,h,d,f,v);for(let y=0;y!==8;y++){const w=n[y];e.pointToLocal(w,w)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=tP,i=n[0],s=n[1],o=n[2],l=n[3],h=n[4],d=n[5],f=n[6],v=n[7];this.getCorners(i,s,o,l,h,d,f,v);for(let y=0;y!==8;y++){const w=n[y];e.pointToWorld(w,w)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,s=1/t.y,o=1/t.z,l=(this.lowerBound.x-n.x)*i,h=(this.upperBound.x-n.x)*i,d=(this.lowerBound.y-n.y)*s,f=(this.upperBound.y-n.y)*s,v=(this.lowerBound.z-n.z)*o,y=(this.upperBound.z-n.z)*o,w=Math.max(Math.max(Math.min(l,h),Math.min(d,f)),Math.min(v,y)),E=Math.min(Math.min(Math.max(l,h),Math.max(d,f)),Math.max(v,y));return!(E<0||w>E)}}const eP=new ge,tP=[new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge];class nP{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:i}=t;if(i>n){const s=i;i=n,n=s}return this.matrix[(n*(n+1)>>1)+i-1]}set(e,t,n){let{index:i}=e,{index:s}=t;if(s>i){const o=s;s=i,i=o}this.matrix[(i*(i+1)>>1)+s-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class iP{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return!(n[e]===void 0||!n[e].includes(t))}hasAnyEventListener(e){return this._listeners!==void 0&&this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners;if(n[e]===void 0)return this;const i=n[e].indexOf(t);return i!==-1&&n[e].splice(i,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){e.target=this;for(let n=0,i=t.length;n<i;n++)t[n].call(this,e)}return this}}class bs{constructor(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),i===void 0&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){e===void 0&&(e=new ge),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=hL,i=dL;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new bs);const n=this.x,i=this.y,s=this.z,o=this.w,l=e.x,h=e.y,d=e.z,f=e.w;return t.x=n*f+o*l+i*d-s*h,t.y=i*f+o*h+s*l-n*d,t.z=s*f+o*d+n*h-i*l,t.w=o*f-n*l-i*h-s*d,t}inverse(e){e===void 0&&(e=new bs);const t=this.x,n=this.y,i=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+n*n+i*i+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new bs),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ge);const n=e.x,i=e.y,s=e.z,o=this.x,l=this.y,h=this.z,d=this.w,f=d*n+l*s-h*i,v=d*i+h*n-o*s,y=d*s+o*i-l*n,w=-o*n-l*i-h*s;return t.x=f*d+w*-o+v*-h-y*-l,t.y=v*d+w*-l+y*-o-f*-h,t.z=y*d+w*-h+f*-l-v*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let n,i,s;t===void 0&&(t="YZX");const o=this.x,l=this.y,h=this.z,d=this.w;if(t!=="YZX")throw new Error(`Euler order ${t} not supported yet.`);{const f=o*l+h*d;if(f>.499&&(n=2*Math.atan2(o,d),i=Math.PI/2,s=0),f<-.499&&(n=-2*Math.atan2(o,d),i=-Math.PI/2,s=0),n===void 0){const v=o*o,y=l*l,w=h*h;n=Math.atan2(2*l*d-2*o*h,1-2*y-2*w),i=Math.asin(2*f),s=Math.atan2(2*o*d-2*l*h,1-2*v-2*w)}}e.y=n,e.z=i,e.x=s}setFromEuler(e,t,n,i){i===void 0&&(i="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),l=Math.cos(n/2),h=Math.sin(e/2),d=Math.sin(t/2),f=Math.sin(n/2);return i==="XYZ"?(this.x=h*o*l+s*d*f,this.y=s*d*l-h*o*f,this.z=s*o*f+h*d*l,this.w=s*o*l-h*d*f):i==="YXZ"?(this.x=h*o*l+s*d*f,this.y=s*d*l-h*o*f,this.z=s*o*f-h*d*l,this.w=s*o*l+h*d*f):i==="ZXY"?(this.x=h*o*l-s*d*f,this.y=s*d*l+h*o*f,this.z=s*o*f+h*d*l,this.w=s*o*l-h*d*f):i==="ZYX"?(this.x=h*o*l-s*d*f,this.y=s*d*l+h*o*f,this.z=s*o*f-h*d*l,this.w=s*o*l+h*d*f):i==="YZX"?(this.x=h*o*l+s*d*f,this.y=s*d*l+h*o*f,this.z=s*o*f-h*d*l,this.w=s*o*l-h*d*f):i==="XZY"&&(this.x=h*o*l-s*d*f,this.y=s*d*l-h*o*f,this.z=s*o*f+h*d*l,this.w=s*o*l+h*d*f),this}clone(){return new bs(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new bs);const i=this.x,s=this.y,o=this.z,l=this.w;let h,d,f,v,y,w=e.x,E=e.y,M=e.z,P=e.w;return d=i*w+s*E+o*M+l*P,d<0&&(d=-d,w=-w,E=-E,M=-M,P=-P),1-d>1e-6?(h=Math.acos(d),f=Math.sin(h),v=Math.sin((1-t)*h)/f,y=Math.sin(t*h)/f):(v=1-t,y=t),n.x=v*i+y*w,n.y=v*s+y*E,n.z=v*o+y*M,n.w=v*l+y*P,n}integrate(e,t,n,i){i===void 0&&(i=new bs);const s=e.x*n.x,o=e.y*n.y,l=e.z*n.z,h=this.x,d=this.y,f=this.z,v=this.w,y=.5*t;return i.x+=y*(s*v+o*f-l*d),i.y+=y*(o*v+l*h-s*f),i.z+=y*(l*v+s*d-o*h),i.w+=y*(-s*h-o*d-l*f),i}}const hL=new ge,dL=new ge;class Cn{constructor(e){e===void 0&&(e={}),this.id=Cn.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Cn.idCounter=0,Cn.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class dr{constructor(e){e===void 0&&(e={}),this.position=new ge,this.quaternion=new bs,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return dr.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return dr.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ge),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return i===void 0&&(i=new ge),n.vsub(e,i),t.conjugate(rP),rP.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return i===void 0&&(i=new ge),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new ge),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return i===void 0&&(i=new ge),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const rP=new bs;class pv extends Cn{constructor(e){e===void 0&&(e={});const{vertices:t=[],faces:n=[],normals:i=[],axes:s,boundingSphereRadius:o}=e;super({type:Cn.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=i,this.faceNormals.length===0&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=s?s.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new ge;for(let s=0;s!==e.length;s++){const o=e[s],l=o.length;for(let h=0;h!==l;h++){const d=(h+1)%l;t[o[h]].vsub(t[o[d]],i),i.normalize();let f=!1;for(let v=0;v!==n.length;v++)if(n[v].almostEquals(i)||n[v].almostEquals(i)){f=!0;break}f||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error(`Vertex ${this.faces[e][i]} not found!`);const t=this.faceNormals[e]||new ge;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let i=0;i<this.faces[e].length;i++)console.warn(`.vertices[${this.faces[e][i]}] = Vec3(${this.vertices[this.faces[e][i]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],s=this.vertices[n[1]],o=this.vertices[n[2]];pv.computeNormal(i,s,o,t)}static computeNormal(e,t,n,i){const s=new ge,o=new ge;t.vsub(e,o),n.vsub(t,s),s.cross(o,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,s,o,l,h,d){const f=new ge;let v=-1,y=-Number.MAX_VALUE;for(let E=0;E<n.faces.length;E++){f.copy(n.faceNormals[E]),s.vmult(f,f);const M=f.dot(o);M>y&&(y=M,v=E)}const w=[];for(let E=0;E<n.faces[v].length;E++){const M=n.vertices[n.faces[v][E]],P=new ge;P.copy(M),s.vmult(P,P),i.vadd(P,P),w.push(P)}v>=0&&this.clipFaceAgainstHull(o,e,t,w,l,h,d)}findSeparatingAxis(e,t,n,i,s,o,l,h){const d=new ge,f=new ge,v=new ge,y=new ge,w=new ge,E=new ge;let M=Number.MAX_VALUE;const P=this;if(P.uniqueAxes)for(let L=0;L!==P.uniqueAxes.length;L++){n.vmult(P.uniqueAxes[L],d);const R=P.testSepAxis(d,e,t,n,i,s);if(R===!1)return!1;R<M&&(M=R,o.copy(d))}else{const L=l?l.length:P.faces.length;for(let R=0;R<L;R++){const I=l?l[R]:R;d.copy(P.faceNormals[I]),n.vmult(d,d);const N=P.testSepAxis(d,e,t,n,i,s);if(N===!1)return!1;N<M&&(M=N,o.copy(d))}}if(e.uniqueAxes)for(let L=0;L!==e.uniqueAxes.length;L++){s.vmult(e.uniqueAxes[L],f);const R=P.testSepAxis(f,e,t,n,i,s);if(R===!1)return!1;R<M&&(M=R,o.copy(f))}else{const L=h?h.length:e.faces.length;for(let R=0;R<L;R++){const I=h?h[R]:R;f.copy(e.faceNormals[I]),s.vmult(f,f);const N=P.testSepAxis(f,e,t,n,i,s);if(N===!1)return!1;N<M&&(M=N,o.copy(f))}}for(let L=0;L!==P.uniqueEdges.length;L++){n.vmult(P.uniqueEdges[L],y);for(let R=0;R!==e.uniqueEdges.length;R++)if(s.vmult(e.uniqueEdges[R],w),y.cross(w,E),!E.almostZero()){E.normalize();const I=P.testSepAxis(E,e,t,n,i,s);if(I===!1)return!1;I<M&&(M=I,o.copy(E))}}return i.vsub(t,v),v.dot(o)>0&&o.negate(o),!0}testSepAxis(e,t,n,i,s,o){pv.project(this,e,n,i,oM),pv.project(t,e,s,o,lM);const l=oM[0],h=oM[1],d=lM[0],f=lM[1];if(l<f||d<h)return!1;const v=l-f,y=d-h;return v<y?v:y}calculateLocalInertia(e,t){const n=new ge,i=new ge;this.computeLocalAABB(i,n);const s=n.x-i.x,o=n.y-i.y,l=n.z-i.z;t.x=1/12*e*(2*o*2*o+2*l*2*l),t.y=1/12*e*(2*s*2*s+2*l*2*l),t.z=1/12*e*(2*o*2*o+2*s*2*s)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,s,o,l){const h=new ge,d=new ge,f=new ge,v=new ge,y=new ge,w=new ge,E=new ge,M=new ge,P=this,L=i,R=[];let I=-1,N=Number.MAX_VALUE;for(let pe=0;pe<P.faces.length;pe++){h.copy(P.faceNormals[pe]),n.vmult(h,h);const Ae=h.dot(e);Ae<N&&(N=Ae,I=pe)}if(I<0)return;const j=P.faces[I];j.connectedFaces=[];for(let pe=0;pe<P.faces.length;pe++)for(let Ae=0;Ae<P.faces[pe].length;Ae++)j.indexOf(P.faces[pe][Ae])!==-1&&pe!==I&&j.connectedFaces.indexOf(pe)===-1&&j.connectedFaces.push(pe);const H=j.length;for(let pe=0;pe<H;pe++){const Ae=P.vertices[j[pe]],ve=P.vertices[j[(pe+1)%H]];Ae.vsub(ve,d),f.copy(d),n.vmult(f,f),t.vadd(f,f),v.copy(this.faceNormals[I]),n.vmult(v,v),t.vadd(v,v),f.cross(v,y),y.negate(y),w.copy(Ae),n.vmult(w,w),t.vadd(w,w);const Ee=j.connectedFaces[pe];E.copy(this.faceNormals[Ee]);const xe=this.getPlaneConstantOfFace(Ee);M.copy(E),n.vmult(M,M);const we=xe-M.dot(t);for(this.clipFaceAgainstPlane(L,R,M,we);L.length;)L.shift();for(;R.length;)L.push(R.shift())}E.copy(this.faceNormals[I]);const X=this.getPlaneConstantOfFace(I);M.copy(E),n.vmult(M,M);const ne=X-M.dot(t);for(let pe=0;pe<L.length;pe++){let Ae=M.dot(L[pe])+ne;if(Ae<=s&&(console.log(`clamped: depth=${Ae} to minDist=${s}`),Ae=s),Ae<=o){const ve=L[pe];if(Ae<=1e-6){const Ee={point:ve,normal:M,depth:Ae};l.push(Ee)}}}}clipFaceAgainstPlane(e,t,n,i){let s,o;const l=e.length;if(l<2)return t;let h=e[e.length-1],d=e[0];s=n.dot(h)+i;for(let f=0;f<l;f++){if(d=e[f],o=n.dot(d)+i,s<0)if(o<0){const v=new ge;v.copy(d),t.push(v)}else{const v=new ge;h.lerp(d,s/(s-o),v),t.push(v)}else if(o<0){const v=new ge;h.lerp(d,s/(s-o),v),t.push(v),t.push(d)}h=d,s=o}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new ge);const n=this.vertices,i=this.worldVertices;for(let s=0;s!==this.vertices.length;s++)t.vmult(n[s],i[s]),e.vadd(i[s],i[s]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const s=n[i];s.x<e.x?e.x=s.x:s.x>t.x&&(t.x=s.x),s.y<e.y?e.y=s.y:s.y>t.y&&(t.y=s.y),s.z<e.z?e.z=s.z:s.z>t.z&&(t.z=s.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new ge);const n=this.faceNormals,i=this.worldFaceNormals;for(let s=0;s!==t;s++)e.vmult(n[s],i[s]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const s=this.vertices;let o,l,h,d,f,v,y=new ge;for(let w=0;w<s.length;w++){y.copy(s[w]),t.vmult(y,y),e.vadd(y,y);const E=y;(o===void 0||E.x<o)&&(o=E.x),(d===void 0||E.x>d)&&(d=E.x),(l===void 0||E.y<l)&&(l=E.y),(f===void 0||E.y>f)&&(f=E.y),(h===void 0||E.z<h)&&(h=E.z),(v===void 0||E.z>v)&&(v=E.z)}n.set(o,l,h),i.set(d,f,v)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new ge);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let s=0;s<n;s++){const o=i[s];t.vmult(o,o)}for(let s=0;s<this.faceNormals.length;s++){const o=this.faceNormals[s];t.vmult(o,o)}}if(e)for(let s=0;s<n;s++){const o=i[s];o.vadd(e,o)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,s=new ge;this.getAveragePointLocal(s);for(let o=0;o<this.faces.length;o++){let l=i[o];const h=t[n[o][0]],d=new ge;e.vsub(h,d);const f=l.dot(d),v=new ge;s.vsub(h,v);const y=l.dot(v);if(f<0&&y>0||f>0&&y<0)return!1}return-1}static project(e,t,n,i,s){const o=e.vertices.length,l=pL;let h=0,d=0;const f=fL,v=e.vertices;f.setZero(),dr.vectorToLocalFrame(n,i,t,l),dr.pointToLocalFrame(n,i,f,f);const y=f.dot(l);d=h=v[0].dot(l);for(let w=1;w<o;w++){const E=v[w].dot(l);E>h&&(h=E),E<d&&(d=E)}if(d-=y,h-=y,d>h){const w=d;d=h,h=w}s[0]=h,s[1]=d}}const oM=[],lM=[],pL=(new ge,new ge),fL=new ge;class Yw extends Cn{constructor(e){super({type:Cn.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=ge,s=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],o=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],l=new pv({vertices:s,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:o});this.convexPolyhedronRepresentation=l,l.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new ge),Yw.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),t!==void 0)for(let s=0;s!==n.length;s++)t.vmult(n[s],n[s]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,s=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let o=0;o<s.length;o++)Rm.set(s[o][0],s[o][1],s[o][2]),t.vmult(Rm,Rm),e.vadd(Rm,Rm),n(Rm.x,Rm.y,Rm.z)}calculateWorldAABB(e,t,n,i){const s=this.halfExtents;Rd[0].set(s.x,s.y,s.z),Rd[1].set(-s.x,s.y,s.z),Rd[2].set(-s.x,-s.y,s.z),Rd[3].set(-s.x,-s.y,-s.z),Rd[4].set(s.x,-s.y,-s.z),Rd[5].set(s.x,s.y,-s.z),Rd[6].set(-s.x,s.y,-s.z),Rd[7].set(s.x,-s.y,s.z);const o=Rd[0];t.vmult(o,o),e.vadd(o,o),i.copy(o),n.copy(o);for(let l=1;l<8;l++){const h=Rd[l];t.vmult(h,h),e.vadd(h,h);const d=h.x,f=h.y,v=h.z;d>i.x&&(i.x=d),f>i.y&&(i.y=f),v>i.z&&(i.z=v),d<n.x&&(n.x=d),f<n.y&&(n.y=f),v<n.z&&(n.z=v)}}}const Rm=new ge,Rd=[new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge];class Rn extends iP{constructor(e){e===void 0&&(e={}),super(),this.id=Rn.idCounter++,this.index=-1,this.world=null,this.vlambda=new ge,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse!="boolean"||e.collisionResponse,this.position=new ge,this.previousPosition=new ge,this.interpolatedPosition=new ge,this.initPosition=new ge,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new ge,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new ge,this.force=new ge;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?Rn.STATIC:Rn.DYNAMIC,typeof e.type==typeof Rn.STATIC&&(this.type=e.type),this.allowSleep=e.allowSleep===void 0||e.allowSleep,this.sleepState=Rn.AWAKE,this.sleepSpeedLimit=e.sleepSpeedLimit!==void 0?e.sleepSpeedLimit:.1,this.sleepTimeLimit=e.sleepTimeLimit!==void 0?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new ge,this.quaternion=new bs,this.initQuaternion=new bs,this.previousQuaternion=new bs,this.interpolatedQuaternion=new bs,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new ge,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new ge,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new ge,this.invInertia=new ge,this.invInertiaWorld=new ch,this.invMassSolve=0,this.invInertiaSolve=new ge,this.invInertiaWorldSolve=new ch,this.fixedRotation=e.fixedRotation!==void 0&&e.fixedRotation,this.angularDamping=e.angularDamping!==void 0?e.angularDamping:.01,this.linearFactor=new ge(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new ge(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new hs,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new ge,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=Rn.AWAKE,this.wakeUpAfterNarrowphase=!1,e===Rn.SLEEPING&&this.dispatchEvent(Rn.wakeupEvent)}sleep(){this.sleepState=Rn.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===Rn.AWAKE&&n<i?(this.sleepState=Rn.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(Rn.sleepyEvent)):t===Rn.SLEEPY&&n>i?this.wakeUp():t===Rn.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Rn.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Rn.SLEEPING||this.type===Rn.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new ge),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new ge),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new ge),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new ge),this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new ge,s=new bs;return t&&i.copy(t),n&&s.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let s=0;s!==n;s++){const o=e[s];o.updateBoundingSphereRadius();const l=t[s].length(),h=o.boundingSphereRadius;l+h>i&&(i=l+h)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,s=mL,o=gL,l=this.quaternion,h=this.aabb,d=vL;for(let f=0;f!==i;f++){const v=e[f];l.vmult(t[f],s),s.vadd(this.position,s),l.mult(n[f],o),v.calculateWorldAABB(s,o,d.lowerBound,d.upperBound),f===0?h.copy(d):h.extend(d)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const n=_L,i=yL;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(t,n),n.mmult(i,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new ge),this.type!==Rn.DYNAMIC)return;this.sleepState===Rn.SLEEPING&&this.wakeUp();const n=AL;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new ge),this.type!==Rn.DYNAMIC)return;const n=bL,i=xL;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===Rn.DYNAMIC&&(this.sleepState===Rn.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new ge),this.type!==Rn.DYNAMIC)return;this.sleepState===Rn.SLEEPING&&this.wakeUp();const n=t,i=wL;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const s=EL;n.cross(e,s),this.invInertiaWorld.vmult(s,s),this.angularVelocity.vadd(s,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new ge),this.type!==Rn.DYNAMIC)return;const n=SL,i=ML;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=CL;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Yw.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new ge;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==Rn.DYNAMIC&&this.type!==Rn.KINEMATIC||this.sleepState===Rn.SLEEPING)return;const i=this.velocity,s=this.angularVelocity,o=this.position,l=this.force,h=this.torque,d=this.quaternion,f=this.invMass,v=this.invInertiaWorld,y=this.linearFactor,w=f*e;i.x+=l.x*w*y.x,i.y+=l.y*w*y.y,i.z+=l.z*w*y.z;const E=v.elements,M=this.angularFactor,P=h.x*M.x,L=h.y*M.y,R=h.z*M.z;s.x+=e*(E[0]*P+E[1]*L+E[2]*R),s.y+=e*(E[3]*P+E[4]*L+E[5]*R),s.z+=e*(E[6]*P+E[7]*L+E[8]*R),o.x+=i.x*e,o.y+=i.y*e,o.z+=i.z*e,d.integrate(this.angularVelocity,e,this.angularFactor,d),t&&(n?d.normalizeFast():d.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Rn.idCounter=0,Rn.COLLIDE_EVENT_NAME="collide",Rn.DYNAMIC=1,Rn.STATIC=2,Rn.KINEMATIC=4,Rn.AWAKE=0,Rn.SLEEPY=1,Rn.SLEEPING=2,Rn.wakeupEvent={type:"wakeup"},Rn.sleepyEvent={type:"sleepy"},Rn.sleepEvent={type:"sleep"};const mL=new ge,gL=new bs,vL=new hs,_L=new ch,yL=new ch,AL=(new ch,new ge),bL=new ge,xL=new ge,wL=new ge,EL=new ge,SL=new ge,ML=new ge,CL=new ge;class TL{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return(e.collisionFilterGroup&t.collisionFilterMask)!=0&&(t.collisionFilterGroup&e.collisionFilterMask)!=0&&((e.type&Rn.STATIC)==0&&e.sleepState!==Rn.SLEEPING||(t.type&Rn.STATIC)==0&&t.sleepState!==Rn.SLEEPING)}intersectionTest(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)}doBoundingSphereBroadphase(e,t,n,i){const s=IL;t.position.vsub(e.position,s);const o=(e.boundingRadius+t.boundingRadius)**2;s.lengthSquared()<o&&(n.push(e),i.push(t))}doBoundingBoxBroadphase(e,t,n,i){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))}makePairsUnique(e,t){const n=PL,i=RL,s=DL,o=e.length;for(let l=0;l!==o;l++)i[l]=e[l],s[l]=t[l];e.length=0,t.length=0;for(let l=0;l!==o;l++){const h=i[l].id,d=s[l].id,f=h<d?`${h},${d}`:`${d},${h}`;n[f]=l,n.keys.push(f)}for(let l=0;l!==n.keys.length;l++){const h=n.keys.pop(),d=n[h];e.push(i[d]),t.push(s[d]),delete n[h]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new ge;e.position.vsub(t.position,n);const i=e.shapes[0],s=t.shapes[0];return Math.pow(i.boundingSphereRadius+s.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const IL=new ge;new ge,new bs,new ge;const PL={keys:[]},RL=[],DL=[];new ge,new ge,new ge;class BL extends TL{constructor(){super()}collisionPairs(e,t,n){const i=e.bodies,s=i.length;let o,l;for(let h=0;h!==s;h++)for(let d=0;d!==h;d++)o=i[h],l=i[d],this.needBroadphaseCollision(o,l)&&this.intersectionTest(o,l,t,n)}aabbQuery(e,t,n){n===void 0&&(n=[]);for(let i=0;i<e.bodies.length;i++){const s=e.bodies[i];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(t)&&n.push(s)}return n}}class Kw{constructor(){this.rayFromWorld=new ge,this.rayToWorld=new ge,this.hitNormalWorld=new ge,this.hitPointWorld=new ge,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,s,o,l){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=s,this.body=o,this.distance=l}}let sP,aP,oP,lP,cP,uP,hP;sP=Cn.types.SPHERE,aP=Cn.types.PLANE,oP=Cn.types.BOX,lP=Cn.types.CYLINDER,cP=Cn.types.CONVEXPOLYHEDRON,uP=Cn.types.HEIGHTFIELD,hP=Cn.types.TRIMESH;class da{get[sP](){return this._intersectSphere}get[aP](){return this._intersectPlane}get[oP](){return this._intersectBox}get[lP](){return this._intersectConvex}get[cP](){return this._intersectConvex}get[uP](){return this._intersectHeightfield}get[hP](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ge),t===void 0&&(t=new ge),this.from=e.clone(),this.to=t.clone(),this.direction=new ge,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=da.ANY,this.result=new Kw,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||da.ANY,this.result=t.result||new Kw,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:-1,this.checkCollisionResponse=t.checkCollisionResponse===void 0||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(dP),cM.length=0,e.broadphase.aabbQuery(e,dP,cM),this.intersectBodies(cM),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const i=LL,s=OL;for(let o=0,l=e.shapes.length;o<l;o++){const h=e.shapes[o];if((!n||h.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],i),i.vadd(e.position,i),this.intersectShape(h,s,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){if(function(l,h,d){d.vsub(l,fv);const f=fv.dot(h);return h.scale(f,Zw),Zw.vadd(l,Zw),d.distanceTo(Zw)}(this.from,this.direction,n)>e.boundingSphereRadius)return;const o=this[e.type];o&&o.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,s)}_intersectPlane(e,t,n,i,s){const o=this.from,l=this.to,h=this.direction,d=new ge(0,0,1);t.vmult(d,d);const f=new ge;o.vsub(n,f);const v=f.dot(d);if(l.vsub(n,f),v*f.dot(d)>0||o.distanceTo(l)<v)return;const y=d.dot(h);if(Math.abs(y)<this.precision)return;const w=new ge,E=new ge,M=new ge;o.vsub(n,w);const P=-d.dot(w)/y;h.scale(P,E),o.vadd(E,M),this.reportIntersection(d,M,s,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,s=this.from;t.x=Math.min(i.x,s.x),t.y=Math.min(i.y,s.y),t.z=Math.min(i.z,s.z),n.x=Math.max(i.x,s.x),n.y=Math.max(i.y,s.y),n.z=Math.max(i.z,s.z)}_intersectHeightfield(e,t,n,i,s){e.data,e.elementSize;const o=kL;o.from.copy(this.from),o.to.copy(this.to),dr.pointToLocalFrame(n,t,o.from,o.from),dr.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const l=UL;let h,d,f,v;h=d=0,f=v=e.data.length-1;const y=new hs;o.getAABB(y),e.getIndexOfPosition(y.lowerBound.x,y.lowerBound.y,l,!0),h=Math.max(h,l[0]),d=Math.max(d,l[1]),e.getIndexOfPosition(y.upperBound.x,y.upperBound.y,l,!0),f=Math.min(f,l[0]+1),v=Math.min(v,l[1]+1);for(let w=h;w<f;w++)for(let E=d;E<v;E++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(w,E,y),y.overlapsRay(o)){if(e.getConvexTrianglePillar(w,E,!1),dr.pointToWorldFrame(n,t,e.pillarOffset,Jw),this._intersectConvex(e.pillarConvex,t,Jw,i,s,pP),this.result.shouldStop)return;e.getConvexTrianglePillar(w,E,!0),dr.pointToWorldFrame(n,t,e.pillarOffset,Jw),this._intersectConvex(e.pillarConvex,t,Jw,i,s,pP)}}}_intersectSphere(e,t,n,i,s){const o=this.from,l=this.to,h=e.radius,d=(l.x-o.x)**2+(l.y-o.y)**2+(l.z-o.z)**2,f=2*((l.x-o.x)*(o.x-n.x)+(l.y-o.y)*(o.y-n.y)+(l.z-o.z)*(o.z-n.z)),v=f**2-4*d*((o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-h**2),y=NL,w=FL;if(!(v<0))if(v===0)o.lerp(l,v,y),y.vsub(n,w),w.normalize(),this.reportIntersection(w,y,s,i,-1);else{const E=(-f-Math.sqrt(v))/(2*d),M=(-f+Math.sqrt(v))/(2*d);if(E>=0&&E<=1&&(o.lerp(l,E,y),y.vsub(n,w),w.normalize(),this.reportIntersection(w,y,s,i,-1)),this.result.shouldStop)return;M>=0&&M<=1&&(o.lerp(l,M,y),y.vsub(n,w),w.normalize(),this.reportIntersection(w,y,s,i,-1))}}_intersectConvex(e,t,n,i,s,o){const l=zL,h=fP,d=o&&o.faceList||null,f=e.faces,v=e.vertices,y=e.faceNormals,w=this.direction,E=this.from,M=this.to,P=E.distanceTo(M),L=d?d.length:f.length,R=this.result;for(let I=0;!R.shouldStop&&I<L;I++){const N=d?d[I]:I,j=f[N],H=y[N],X=t,ne=n;h.copy(v[j[0]]),X.vmult(h,h),h.vadd(ne,h),h.vsub(E,h),X.vmult(H,l);const pe=w.dot(l);if(Math.abs(pe)<this.precision)continue;const Ae=l.dot(h)/pe;if(!(Ae<0)){w.scale(Ae,ic),ic.vadd(E,ic),uh.copy(v[j[0]]),X.vmult(uh,uh),ne.vadd(uh,uh);for(let ve=1;!R.shouldStop&&ve<j.length-1;ve++){Dd.copy(v[j[ve]]),Bd.copy(v[j[ve+1]]),X.vmult(Dd,Dd),X.vmult(Bd,Bd),ne.vadd(Dd,Dd),ne.vadd(Bd,Bd);const Ee=ic.distanceTo(E);!da.pointInTriangle(ic,uh,Dd,Bd)&&!da.pointInTriangle(ic,Dd,uh,Bd)||Ee>P||this.reportIntersection(l,ic,s,i,N)}}}}_intersectTrimesh(e,t,n,i,s,o){const l=jL,h=qL,d=XL,f=fP,v=VL,y=GL,w=HL,E=WL,M=QL,P=e.indices;e.vertices;const L=this.from,R=this.to,I=this.direction;d.position.copy(n),d.quaternion.copy(t),dr.vectorToLocalFrame(n,t,I,v),dr.pointToLocalFrame(n,t,L,y),dr.pointToLocalFrame(n,t,R,w),w.x*=e.scale.x,w.y*=e.scale.y,w.z*=e.scale.z,y.x*=e.scale.x,y.y*=e.scale.y,y.z*=e.scale.z,w.vsub(y,v),v.normalize();const N=y.distanceSquared(w);e.tree.rayQuery(this,d,h);for(let j=0,H=h.length;!this.result.shouldStop&&j!==H;j++){const X=h[j];e.getNormal(X,l),e.getVertex(P[3*X],uh),uh.vsub(y,f);const ne=v.dot(l),pe=l.dot(f)/ne;if(pe<0)continue;v.scale(pe,ic),ic.vadd(y,ic),e.getVertex(P[3*X+1],Dd),e.getVertex(P[3*X+2],Bd);const Ae=ic.distanceSquared(y);!da.pointInTriangle(ic,Dd,uh,Bd)&&!da.pointInTriangle(ic,uh,Dd,Bd)||Ae>N||(dr.vectorToWorldFrame(t,l,M),dr.pointToWorldFrame(n,t,ic,E),this.reportIntersection(M,E,s,i,X))}h.length=0}reportIntersection(e,t,n,i,s){const o=this.from,l=this.to,h=o.distanceTo(t),d=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(d.hitFaceIndex=s!==void 0?s:-1,this.mode){case da.ALL:this.hasHit=!0,d.set(o,l,e,t,n,i,h),d.hasHit=!0,this.callback(d);break;case da.CLOSEST:(h<d.distance||!d.hasHit)&&(this.hasHit=!0,d.hasHit=!0,d.set(o,l,e,t,n,i,h));break;case da.ANY:this.hasHit=!0,d.hasHit=!0,d.set(o,l,e,t,n,i,h),d.shouldStop=!0}}static pointInTriangle(e,t,n,i){i.vsub(t,fv),n.vsub(t,zA),e.vsub(t,uM);const s=fv.dot(fv),o=fv.dot(zA),l=fv.dot(uM),h=zA.dot(zA),d=zA.dot(uM);let f,v;return(f=h*l-o*d)>=0&&(v=s*d-o*l)>=0&&f+v<s*h-o*o}}da.CLOSEST=1,da.ANY=2,da.ALL=4;const dP=new hs,cM=[],zA=new ge,uM=new ge,LL=new ge,OL=new bs,ic=new ge,uh=new ge,Dd=new ge,Bd=new ge;new ge,new Kw;const pP={faceList:[0]},Jw=new ge,kL=new da,UL=[],NL=new ge,FL=new ge,zL=new ge,fP=(new ge,new ge,new ge),jL=new ge,VL=new ge,GL=new ge,HL=new ge,QL=new ge,WL=new ge;new hs;const qL=[],XL=new dr,fv=new ge,Zw=new ge;class mP{static defaults(e,t){e===void 0&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class $w{constructor(e,t,n){n===void 0&&(n={}),n=mP.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=$w.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}$w.idCounter=0;class gP{constructor(){this.spatial=new ge,this.rotational=new ge}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class jA{constructor(e,t,n,i){n===void 0&&(n=-1e6),i===void 0&&(i=1e6),this.id=jA.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new gP,this.jacobianElementB=new gP,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const i=t,s=e,o=n;this.a=4/(o*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(o*o*s*(1+4*i))}computeB(e,t,n){const i=this.computeGW();return-this.computeGq()*e-i*t-this.computeGiMf()*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,s=n.position,o=i.position;return e.spatial.dot(s)+t.spatial.dot(o)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,s=n.velocity,o=i.velocity,l=n.angularVelocity,h=i.angularVelocity;return e.multiplyVectors(s,l)+t.multiplyVectors(o,h)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,s=n.vlambda,o=i.vlambda,l=n.wlambda,h=i.wlambda;return e.multiplyVectors(s,l)+t.multiplyVectors(o,h)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,s=n.force,o=n.torque,l=i.force,h=i.torque,d=n.invMassSolve,f=i.invMassSolve;return s.scale(d,vP),l.scale(f,_P),n.invInertiaWorldSolve.vmult(o,yP),i.invInertiaWorldSolve.vmult(h,AP),e.multiplyVectors(vP,yP)+t.multiplyVectors(_P,AP)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,s=n.invMassSolve,o=i.invMassSolve,l=n.invInertiaWorldSolve,h=i.invInertiaWorldSolve;let d=s+o;return l.vmult(e.rotational,e1),d+=e1.dot(e.rotational),h.vmult(t.rotational,e1),d+=e1.dot(t.rotational),d}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,s=this.bj,o=YL;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),s.vlambda.addScaledVector(s.invMassSolve*e,n.spatial,s.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,o),i.wlambda.addScaledVector(e,o,i.wlambda),s.invInertiaWorldSolve.vmult(n.rotational,o),s.wlambda.addScaledVector(e,o,s.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}jA.idCounter=0;const vP=new ge,_P=new ge,yP=new ge,AP=new ge,e1=new ge,YL=new ge;class t1 extends jA{constructor(e,t,n){n===void 0&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new ge,this.rj=new ge,this.ni=new ge}computeB(e){const t=this.a,n=this.b,i=this.bi,s=this.bj,o=this.ri,l=this.rj,h=KL,d=JL,f=i.velocity,v=i.angularVelocity;i.force,i.torque;const y=s.velocity,w=s.angularVelocity;s.force,s.torque;const E=ZL,M=this.jacobianElementA,P=this.jacobianElementB,L=this.ni;o.cross(L,h),l.cross(L,d),L.negate(M.spatial),h.negate(M.rotational),P.spatial.copy(L),P.rotational.copy(d),E.copy(s.position),E.vadd(l,E),E.vsub(i.position,E),E.vsub(o,E);const R=L.dot(E),I=this.restitution+1;return-R*t-(I*y.dot(L)-I*f.dot(L)+w.dot(d)-v.dot(h))*n-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=$L,t=eO,n=tO,i=nO,s=iO;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,s),this.ni.dot(s)}}const KL=new ge,JL=new ge,ZL=new ge,$L=new ge,eO=new ge,tO=new ge,nO=new ge,iO=new ge;class rO extends $w{constructor(e,t,n,i,s){t===void 0&&(t=new ge),i===void 0&&(i=new ge),s===void 0&&(s=1e6),super(e,n),this.pivotA=t.clone(),this.pivotB=i.clone();const o=this.equationX=new t1(e,n),l=this.equationY=new t1(e,n),h=this.equationZ=new t1(e,n);this.equations.push(o,l,h),o.minForce=l.minForce=h.minForce=-s,o.maxForce=l.maxForce=h.maxForce=s,o.ni.set(1,0,0),l.ni.set(0,1,0),h.ni.set(0,0,1)}update(){const e=this.bodyA,t=this.bodyB,n=this.equationX,i=this.equationY,s=this.equationZ;e.quaternion.vmult(this.pivotA,n.ri),t.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),s.ri.copy(n.ri),s.rj.copy(n.rj)}}new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge;class bP extends jA{constructor(e,t,n){super(e,t,-n,n),this.ri=new ge,this.rj=new ge,this.t=new ge}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,s=sO,o=aO,l=this.t;n.cross(l,s),i.cross(l,o);const h=this.jacobianElementA,d=this.jacobianElementB;return l.negate(h.spatial),s.negate(h.rotational),d.spatial.copy(l),d.rotational.copy(o),-this.computeGW()*t-e*this.computeGiMf()}}const sO=new ge,aO=new ge;class n1{constructor(e,t,n){n=mP.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n1.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}n1.idCounter=0;class i1{constructor(e){e===void 0&&(e={});let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=i1.idCounter++,this.friction=e.friction!==void 0?e.friction:-1,this.restitution=e.restitution!==void 0?e.restitution:-1}}i1.idCounter=0,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new da,new ge,new ge,new ge,new ge(1,0,0),new ge(0,1,0),new ge(0,0,1),new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge;class xP extends Cn{constructor(e){if(super({type:Cn.types.SPHERE}),this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){t===void 0&&(t=new ge);const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,i){const s=this.radius,o=["x","y","z"];for(let l=0;l<o.length;l++){const h=o[l];n[h]=e[h]-s,i[h]=e[h]+s}}}new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge;class oO extends pv{constructor(e,t,n,i){if(e===void 0&&(e=1),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const s=i,o=[],l=[],h=[],d=[],f=[],v=Math.cos,y=Math.sin;o.push(new ge(-t*y(0),.5*-n,t*v(0))),d.push(0),o.push(new ge(-e*y(0),.5*n,e*v(0))),f.push(1);for(let E=0;E<s;E++){const M=2*Math.PI/s*(E+1),P=2*Math.PI/s*(E+.5);E<s-1?(o.push(new ge(-t*y(M),.5*-n,t*v(M))),d.push(2*E+2),o.push(new ge(-e*y(M),.5*n,e*v(M))),f.push(2*E+3),h.push([2*E,2*E+1,2*E+3,2*E+2])):h.push([2*E,2*E+1,1,0]),(s%2==1||E<s/2)&&l.push(new ge(-y(P),0,v(P)))}h.push(d),l.push(new ge(0,1,0));const w=[];for(let E=0;E<f.length;E++)w.push(f[f.length-E-1]);h.push(w),super({vertices:o,faces:h,axes:l}),this.type=Cn.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=i}}class lO extends Cn{constructor(){super({type:Cn.types.PLANE}),this.worldNormal=new ge,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return t===void 0&&(t=new ge),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,i){Yp.set(0,0,1),t.vmult(Yp,Yp);const s=Number.MAX_VALUE;n.set(-s,-s,-s),i.set(s,s,s),Yp.x===1?i.x=e.x:Yp.x===-1&&(n.x=e.x),Yp.y===1?i.y=e.y:Yp.y===-1&&(n.y=e.y),Yp.z===1?i.z=e.z:Yp.z===-1&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const Yp=new ge;new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge,new ge;class Ld{constructor(e){e===void 0&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new hs,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,n){n===void 0&&(n=0);const i=this.data;if(!this.aabb.contains(e))return!1;const s=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let o=!1;s.length||(this.subdivide(),o=!0);for(let l=0;l!==8;l++)if(s[l].insert(e,t,n+1))return!0;o&&(s.length=0)}return i.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,n=e.upperBound,i=this.children;i.push(new Ld({aabb:new hs({lowerBound:new ge(0,0,0)})}),new Ld({aabb:new hs({lowerBound:new ge(1,0,0)})}),new Ld({aabb:new hs({lowerBound:new ge(1,1,0)})}),new Ld({aabb:new hs({lowerBound:new ge(1,1,1)})}),new Ld({aabb:new hs({lowerBound:new ge(0,1,1)})}),new Ld({aabb:new hs({lowerBound:new ge(0,0,1)})}),new Ld({aabb:new hs({lowerBound:new ge(1,0,1)})}),new Ld({aabb:new hs({lowerBound:new ge(0,1,0)})})),n.vsub(t,mv),mv.scale(.5,mv);const s=this.root||this;for(let o=0;o!==8;o++){const l=i[o];l.root=s;const h=l.aabb.lowerBound;h.x*=mv.x,h.y*=mv.y,h.z*=mv.z,h.vadd(t,h),h.vadd(mv,l.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const n=[this];for(;n.length;){const i=n.pop();i.aabb.overlaps(e)&&Array.prototype.push.apply(t,i.data),Array.prototype.push.apply(n,i.children)}return t}rayQuery(e,t,n){return e.getAABB(r1),r1.toLocalFrame(t,r1),this.aabbQuery(r1,n),n}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class cO extends Ld{constructor(e,t){t===void 0&&(t={}),super({root:null,aabb:e}),this.maxDepth=t.maxDepth!==void 0?t.maxDepth:8}}const mv=new ge,r1=new hs;class s1 extends Cn{constructor(e,t){super({type:Cn.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new hs,this.edges=null,this.scale=new ge(1,1,1),this.tree=new cO,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const n=new hs,i=new ge,s=new ge,o=new ge,l=[i,s,o];for(let h=0;h<this.indices.length/3;h++){const d=3*h;this._getUnscaledVertex(this.indices[d],i),this._getUnscaledVertex(this.indices[d+1],s),this._getUnscaledVertex(this.indices[d+2],o),n.setFromPoints(l),e.insert(n,h)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){a1.copy(e);const n=this.scale,i=n.x,s=n.y,o=n.z,l=a1.lowerBound,h=a1.upperBound;return l.x/=i,l.y/=s,l.z/=o,h.x/=i,h.y/=s,h.z/=o,this.tree.aabbQuery(a1,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=e.x===e.y&&e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=uO,t=this.normals;for(let n=0;n<this.indices.length/3;n++){const i=3*n,s=this.indices[i],o=this.indices[i+1],l=this.indices[i+2];this.getVertex(s,SP),this.getVertex(o,MP),this.getVertex(l,CP),s1.computeNormal(MP,SP,CP,e),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z}}updateEdges(){const e={},t=(i,s)=>{e[i<s?`${i}_${s}`:`${s}_${i}`]=!0};for(let i=0;i<this.indices.length/3;i++){const s=3*i,o=this.indices[s],l=this.indices[s+1],h=this.indices[s+2];t(o,l),t(l,h),t(h,o)}const n=Object.keys(e);this.edges=new Int16Array(2*n.length);for(let i=0;i<n.length;i++){const s=n[i].split("_");this.edges[2*i]=parseInt(s[0],10),this.edges[2*i+1]=parseInt(s[1],10)}}getEdgeVertex(e,t,n){const i=this.edges[2*e+(t?1:0)];this.getVertex(i,n)}getEdgeVector(e,t){const n=hO,i=dO;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,i),i.vsub(n,t)}static computeNormal(e,t,n,i){t.vsub(e,EP),n.vsub(t,wP),wP.cross(EP,i),i.isZero()||i.normalize()}getVertex(e,t){const n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t}_getUnscaledVertex(e,t){const n=3*e,i=this.vertices;return t.set(i[n],i[n+1],i[n+2])}getWorldVertex(e,t,n,i){return this.getVertex(e,i),dr.pointToWorldFrame(t,n,i,i),i}getTriangleVertices(e,t,n,i){const s=3*e;this.getVertex(this.indices[s],t),this.getVertex(this.indices[s+1],n),this.getVertex(this.indices[s+2],i)}getNormal(e,t){const n=3*e;return t.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(e,t){this.computeLocalAABB(gv);const n=gv.upperBound.x-gv.lowerBound.x,i=gv.upperBound.y-gv.lowerBound.y,s=gv.upperBound.z-gv.lowerBound.z;return t.set(1/12*e*(2*i*2*i+2*s*2*s),1/12*e*(2*n*2*n+2*s*2*s),1/12*e*(2*i*2*i+2*n*2*n))}computeLocalAABB(e){const t=e.lowerBound,n=e.upperBound,i=this.vertices.length;this.vertices;const s=pO;this.getVertex(0,s),t.copy(s),n.copy(s);for(let o=0;o!==i;o++)this.getVertex(o,s),s.x<t.x?t.x=s.x:s.x>n.x&&(n.x=s.x),s.y<t.y?t.y=s.y:s.y>n.y&&(n.y=s.y),s.z<t.z?t.z=s.z:s.z>n.z&&(n.z=s.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,n=new ge;for(let i=0,s=t.length/3;i!==s;i++){this.getVertex(i,n);const o=n.lengthSquared();o>e&&(e=o)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const s=fO,o=mO;s.position=e,s.quaternion=t,this.aabb.toWorldFrame(s,o),n.copy(o.lowerBound),i.copy(o.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,t,n,i,s){e===void 0&&(e=1),t===void 0&&(t=.5),n===void 0&&(n=8),i===void 0&&(i=6),s===void 0&&(s=2*Math.PI);const o=[],l=[];for(let h=0;h<=n;h++)for(let d=0;d<=i;d++){const f=d/i*s,v=h/n*Math.PI*2,y=(e+t*Math.cos(v))*Math.cos(f),w=(e+t*Math.cos(v))*Math.sin(f),E=t*Math.sin(v);o.push(y,w,E)}for(let h=1;h<=n;h++)for(let d=1;d<=i;d++){const f=(i+1)*h+d-1,v=(i+1)*(h-1)+d-1,y=(i+1)*(h-1)+d,w=(i+1)*h+d;l.push(f,v,w),l.push(v,y,w)}return new s1(o,l)}}const uO=new ge,a1=new hs,hO=new ge,dO=new ge,wP=new ge,EP=new ge,SP=new ge,MP=new ge,CP=new ge,gv=new hs,pO=new ge,fO=new dr,mO=new hs;class gO{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class vO extends gO{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const i=this.iterations,s=this.tolerance*this.tolerance,o=this.equations,l=o.length,h=t.bodies,d=h.length,f=e;let v,y,w,E,M,P;if(l!==0)for(let N=0;N!==d;N++)h[N].updateSolveMassProperties();const L=yO,R=AO,I=_O;L.length=l,R.length=l,I.length=l;for(let N=0;N!==l;N++){const j=o[N];I[N]=0,R[N]=j.computeB(f),L[N]=1/j.computeC()}if(l!==0){for(let H=0;H!==d;H++){const X=h[H],ne=X.vlambda,pe=X.wlambda;ne.set(0,0,0),pe.set(0,0,0)}for(n=0;n!==i;n++){E=0;for(let H=0;H!==l;H++){const X=o[H];v=R[H],y=L[H],P=I[H],M=X.computeGWlambda(),w=y*(v-M-X.eps*P),P+w<X.minForce?w=X.minForce-P:P+w>X.maxForce&&(w=X.maxForce-P),I[H]+=w,E+=w>0?w:-w,X.addToWlambda(w)}if(E*E<s)break}for(let H=0;H!==d;H++){const X=h[H],ne=X.velocity,pe=X.angularVelocity;X.vlambda.vmul(X.linearFactor,X.vlambda),ne.vadd(X.vlambda,ne),X.wlambda.vmul(X.angularFactor,X.wlambda),pe.vadd(X.wlambda,pe)}let N=o.length;const j=1/f;for(;N--;)o[N].multiplier=I[N]*j}return n}}const _O=[],yO=[],AO=[];Rn.STATIC;class bO{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class xO extends bO{constructor(){super(...arguments),this.type=ge}constructObject(){return new ge}}const wO=Cn.types.SPHERE,EO=Cn.types.SPHERE|Cn.types.PLANE,SO=Cn.types.BOX|Cn.types.BOX,MO=Cn.types.SPHERE|Cn.types.BOX,CO=Cn.types.PLANE|Cn.types.BOX,TO=Cn.types.CONVEXPOLYHEDRON,IO=Cn.types.SPHERE|Cn.types.CONVEXPOLYHEDRON,PO=Cn.types.PLANE|Cn.types.CONVEXPOLYHEDRON,RO=Cn.types.BOX|Cn.types.CONVEXPOLYHEDRON,DO=Cn.types.SPHERE|Cn.types.HEIGHTFIELD,BO=Cn.types.BOX|Cn.types.HEIGHTFIELD,LO=Cn.types.CONVEXPOLYHEDRON|Cn.types.HEIGHTFIELD,OO=Cn.types.PARTICLE|Cn.types.SPHERE,kO=Cn.types.PLANE|Cn.types.PARTICLE,UO=Cn.types.BOX|Cn.types.PARTICLE,NO=Cn.types.PARTICLE|Cn.types.CONVEXPOLYHEDRON,FO=Cn.types.CYLINDER,zO=Cn.types.SPHERE|Cn.types.CYLINDER,jO=Cn.types.PLANE|Cn.types.CYLINDER,VO=Cn.types.BOX|Cn.types.CYLINDER,GO=Cn.types.CONVEXPOLYHEDRON|Cn.types.CYLINDER,HO=Cn.types.HEIGHTFIELD|Cn.types.CYLINDER,QO=Cn.types.PARTICLE|Cn.types.CYLINDER,WO=Cn.types.SPHERE|Cn.types.TRIMESH,qO=Cn.types.PLANE|Cn.types.TRIMESH;class XO{get[wO](){return this.sphereSphere}get[EO](){return this.spherePlane}get[SO](){return this.boxBox}get[MO](){return this.sphereBox}get[CO](){return this.planeBox}get[TO](){return this.convexConvex}get[IO](){return this.sphereConvex}get[PO](){return this.planeConvex}get[RO](){return this.boxConvex}get[DO](){return this.sphereHeightfield}get[BO](){return this.boxHeightfield}get[LO](){return this.convexHeightfield}get[OO](){return this.sphereParticle}get[kO](){return this.planeParticle}get[UO](){return this.boxParticle}get[NO](){return this.convexParticle}get[FO](){return this.convexConvex}get[zO](){return this.sphereConvex}get[jO](){return this.planeConvex}get[VO](){return this.boxConvex}get[GO](){return this.convexConvex}get[HO](){return this.heightfieldCylinder}get[QO](){return this.particleCylinder}get[WO](){return this.sphereTrimesh}get[qO](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new xO,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,i,s,o){let l;this.contactPointPool.length?(l=this.contactPointPool.pop(),l.bi=e,l.bj=t):l=new t1(e,t),l.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;const h=this.currentContactMaterial;l.restitution=h.restitution,l.setSpookParams(h.contactEquationStiffness,h.contactEquationRelaxation,this.world.dt);const d=n.material||e.material,f=i.material||t.material;return d&&f&&d.restitution>=0&&f.restitution>=0&&(l.restitution=d.restitution*f.restitution),l.si=s||n,l.sj=o||i,l}createFrictionEquationsFromContact(e,t){const n=e.bi,i=e.bj,s=e.si,o=e.sj,l=this.world,h=this.currentContactMaterial;let d=h.friction;const f=s.material||n.material,v=o.material||i.material;if(f&&v&&f.friction>=0&&v.friction>=0&&(d=f.friction*v.friction),d>0){const y=d*l.gravity.length();let w=n.invMass+i.invMass;w>0&&(w=1/w);const E=this.frictionEquationPool,M=E.length?E.pop():new bP(n,i,y*w),P=E.length?E.pop():new bP(n,i,y*w);return M.bi=P.bi=n,M.bj=P.bj=i,M.minForce=P.minForce=-y*w,M.maxForce=P.maxForce=y*w,M.ri.copy(e.ri),M.rj.copy(e.rj),P.ri.copy(e.ri),P.rj.copy(e.rj),e.ni.tangents(M.t,P.t),M.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,l.dt),P.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,l.dt),M.enabled=P.enabled=e.enabled,t.push(M,P),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];vv.setZero(),P0.setZero(),R0.setZero();const s=t.bi;t.bj;for(let l=0;l!==e;l++)t=this.result[this.result.length-1-l],t.bi!==s?(vv.vadd(t.ni,vv),P0.vadd(t.ri,P0),R0.vadd(t.rj,R0)):(vv.vsub(t.ni,vv),P0.vadd(t.rj,P0),R0.vadd(t.ri,R0));const o=1/e;P0.scale(o,n.ri),R0.scale(o,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),vv.normalize(),vv.tangents(n.t,i.t)}getContacts(e,t,n,i,s,o,l){this.contactPointPool=s,this.frictionEquationPool=l,this.result=i,this.frictionResult=o;const h=JO,d=ZO,f=YO,v=KO;for(let y=0,w=e.length;y!==w;y++){const E=e[y],M=t[y];let P=null;E.material&&M.material&&(P=n.getContactMaterial(E.material,M.material)||null);const L=E.type&Rn.KINEMATIC&&M.type&Rn.STATIC||E.type&Rn.STATIC&&M.type&Rn.KINEMATIC||E.type&Rn.KINEMATIC&&M.type&Rn.KINEMATIC;for(let R=0;R<E.shapes.length;R++){E.quaternion.mult(E.shapeOrientations[R],h),E.quaternion.vmult(E.shapeOffsets[R],f),f.vadd(E.position,f);const I=E.shapes[R];for(let N=0;N<M.shapes.length;N++){M.quaternion.mult(M.shapeOrientations[N],d),M.quaternion.vmult(M.shapeOffsets[N],v),v.vadd(M.position,v);const j=M.shapes[N];if(!(I.collisionFilterMask&j.collisionFilterGroup&&j.collisionFilterMask&I.collisionFilterGroup)||f.distanceTo(v)>I.boundingSphereRadius+j.boundingSphereRadius)continue;let H=null;I.material&&j.material&&(H=n.getContactMaterial(I.material,j.material)||null),this.currentContactMaterial=H||P||n.defaultContactMaterial;const X=this[I.type|j.type];if(X){let ne=!1;ne=I.type<j.type?X.call(this,I,j,f,v,h,d,E,M,I,j,L):X.call(this,j,I,v,f,d,h,M,E,I,j,L),ne&&L&&(n.shapeOverlapKeeper.set(I.id,j.id),n.bodyOverlapKeeper.set(E.id,M.id))}}}}}sphereSphere(e,t,n,i,s,o,l,h,d,f,v){if(v)return n.distanceSquared(i)<(e.radius+t.radius)**2;const y=this.createContactEquation(l,h,e,t,d,f);i.vsub(n,y.ni),y.ni.normalize(),y.ri.copy(y.ni),y.rj.copy(y.ni),y.ri.scale(e.radius,y.ri),y.rj.scale(-t.radius,y.rj),y.ri.vadd(n,y.ri),y.ri.vsub(l.position,y.ri),y.rj.vadd(i,y.rj),y.rj.vsub(h.position,y.rj),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult)}spherePlane(e,t,n,i,s,o,l,h,d,f,v){const y=this.createContactEquation(l,h,e,t,d,f);if(y.ni.set(0,0,1),o.vmult(y.ni,y.ni),y.ni.negate(y.ni),y.ni.normalize(),y.ni.scale(e.radius,y.ri),n.vsub(i,o1),y.ni.scale(y.ni.dot(o1),TP),o1.vsub(TP,y.rj),-o1.dot(y.ni)<=e.radius){if(v)return!0;const w=y.ri,E=y.rj;w.vadd(n,w),w.vsub(l.position,w),E.vadd(i,E),E.vsub(h.position,E),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult)}}boxBox(e,t,n,i,s,o,l,h,d,f,v){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,s,o,l,h,e,t,v)}sphereBox(e,t,n,i,s,o,l,h,d,f,v){const y=this.v3pool,w=Ek;n.vsub(i,l1),t.getSideNormals(w,o);const E=e.radius;let M=!1;const P=Mk,L=Ck,R=Tk;let I=null,N=0,j=0,H=0,X=null;for(let Be=0,Oe=w.length;Be!==Oe&&M===!1;Be++){const at=bk;at.copy(w[Be]);const st=at.length();at.normalize();const St=l1.dot(at);if(St<st+E&&St>0){const dt=xk,ht=wk;dt.copy(w[(Be+1)%3]),ht.copy(w[(Be+2)%3]);const Nt=dt.length(),Bt=ht.length();dt.normalize(),ht.normalize();const rn=l1.dot(dt),hn=l1.dot(ht);if(rn<Nt&&rn>-Nt&&hn<Bt&&hn>-Bt){const wn=Math.abs(St-st-E);if((X===null||wn<X)&&(X=wn,j=rn,H=hn,I=st,P.copy(at),L.copy(dt),R.copy(ht),N++,v))return!0}}}if(N){M=!0;const Be=this.createContactEquation(l,h,e,t,d,f);P.scale(-E,Be.ri),Be.ni.copy(P),Be.ni.negate(Be.ni),P.scale(I,P),L.scale(j,L),P.vadd(L,P),R.scale(H,R),P.vadd(R,Be.rj),Be.ri.vadd(n,Be.ri),Be.ri.vsub(l.position,Be.ri),Be.rj.vadd(i,Be.rj),Be.rj.vsub(h.position,Be.rj),this.result.push(Be),this.createFrictionEquationsFromContact(Be,this.frictionResult)}let ne=y.get();const pe=Sk;for(let Be=0;Be!==2&&!M;Be++)for(let Oe=0;Oe!==2&&!M;Oe++)for(let at=0;at!==2&&!M;at++)if(ne.set(0,0,0),Be?ne.vadd(w[0],ne):ne.vsub(w[0],ne),Oe?ne.vadd(w[1],ne):ne.vsub(w[1],ne),at?ne.vadd(w[2],ne):ne.vsub(w[2],ne),i.vadd(ne,pe),pe.vsub(n,pe),pe.lengthSquared()<E*E){if(v)return!0;M=!0;const st=this.createContactEquation(l,h,e,t,d,f);st.ri.copy(pe),st.ri.normalize(),st.ni.copy(st.ri),st.ri.scale(E,st.ri),st.rj.copy(ne),st.ri.vadd(n,st.ri),st.ri.vsub(l.position,st.ri),st.rj.vadd(i,st.rj),st.rj.vsub(h.position,st.rj),this.result.push(st),this.createFrictionEquationsFromContact(st,this.frictionResult)}y.release(ne),ne=null;const Ae=y.get(),ve=y.get(),Ee=y.get(),xe=y.get(),we=y.get(),Re=w.length;for(let Be=0;Be!==Re&&!M;Be++)for(let Oe=0;Oe!==Re&&!M;Oe++)if(Be%3!=Oe%3){w[Oe].cross(w[Be],Ae),Ae.normalize(),w[Be].vadd(w[Oe],ve),Ee.copy(n),Ee.vsub(ve,Ee),Ee.vsub(i,Ee);const at=Ee.dot(Ae);Ae.scale(at,xe);let st=0;for(;st===Be%3||st===Oe%3;)st++;we.copy(n),we.vsub(xe,we),we.vsub(ve,we),we.vsub(i,we);const St=Math.abs(at),dt=we.length();if(St<w[st].length()&&dt<E){if(v)return!0;M=!0;const ht=this.createContactEquation(l,h,e,t,d,f);ve.vadd(xe,ht.rj),ht.rj.copy(ht.rj),we.negate(ht.ni),ht.ni.normalize(),ht.ri.copy(ht.rj),ht.ri.vadd(i,ht.ri),ht.ri.vsub(n,ht.ri),ht.ri.normalize(),ht.ri.scale(E,ht.ri),ht.ri.vadd(n,ht.ri),ht.ri.vsub(l.position,ht.ri),ht.rj.vadd(i,ht.rj),ht.rj.vsub(h.position,ht.rj),this.result.push(ht),this.createFrictionEquationsFromContact(ht,this.frictionResult)}}y.release(Ae,ve,Ee,xe,we)}planeBox(e,t,n,i,s,o,l,h,d,f,v){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,s,o,l,h,e,t,v)}convexConvex(e,t,n,i,s,o,l,h,d,f,v,y,w){const E=Gk;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,s,i,o,E,y,w)){const M=[],P=Hk;e.clipAgainstHull(n,s,t,i,o,E,-100,100,M);let L=0;for(let R=0;R!==M.length;R++){if(v)return!0;const I=this.createContactEquation(l,h,e,t,d,f),N=I.ri,j=I.rj;E.negate(I.ni),M[R].normal.negate(P),P.scale(M[R].depth,P),M[R].point.vadd(P,N),j.copy(M[R].point),N.vsub(n,N),j.vsub(i,j),N.vadd(n,N),N.vsub(l.position,N),j.vadd(i,j),j.vsub(h.position,j),this.result.push(I),L++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(I,this.frictionResult)}this.enableFrictionReduction&&L&&this.createFrictionFromAverage(L)}}sphereConvex(e,t,n,i,s,o,l,h,d,f,v){const y=this.v3pool;n.vsub(i,Ik);const w=t.faceNormals,E=t.faces,M=t.vertices,P=e.radius;let L=!1;for(let R=0;R!==M.length;R++){const I=M[R],N=Bk;o.vmult(I,N),i.vadd(N,N);const j=Dk;if(N.vsub(n,j),j.lengthSquared()<P*P){if(v)return!0;L=!0;const H=this.createContactEquation(l,h,e,t,d,f);return H.ri.copy(j),H.ri.normalize(),H.ni.copy(H.ri),H.ri.scale(P,H.ri),N.vsub(i,H.rj),H.ri.vadd(n,H.ri),H.ri.vsub(l.position,H.ri),H.rj.vadd(i,H.rj),H.rj.vsub(h.position,H.rj),this.result.push(H),void this.createFrictionEquationsFromContact(H,this.frictionResult)}}for(let R=0,I=E.length;R!==I&&L===!1;R++){const N=w[R],j=E[R],H=Lk;o.vmult(N,H);const X=Ok;o.vmult(M[j[0]],X),X.vadd(i,X);const ne=kk;H.scale(-P,ne),n.vadd(ne,ne);const pe=Uk;ne.vsub(X,pe);const Ae=pe.dot(H),ve=Nk;if(n.vsub(X,ve),Ae<0&&ve.dot(H)>0){const Ee=[];for(let xe=0,we=j.length;xe!==we;xe++){const Re=y.get();o.vmult(M[j[xe]],Re),i.vadd(Re,Re),Ee.push(Re)}if(Ak(Ee,H,n)){if(v)return!0;L=!0;const xe=this.createContactEquation(l,h,e,t,d,f);H.scale(-P,xe.ri),H.negate(xe.ni);const we=y.get();H.scale(-Ae,we);const Re=y.get();H.scale(-P,Re),n.vsub(i,xe.rj),xe.rj.vadd(Re,xe.rj),xe.rj.vadd(we,xe.rj),xe.rj.vadd(i,xe.rj),xe.rj.vsub(h.position,xe.rj),xe.ri.vadd(n,xe.ri),xe.ri.vsub(l.position,xe.ri),y.release(we),y.release(Re),this.result.push(xe),this.createFrictionEquationsFromContact(xe,this.frictionResult);for(let Be=0,Oe=Ee.length;Be!==Oe;Be++)y.release(Ee[Be]);return}for(let xe=0;xe!==j.length;xe++){const we=y.get(),Re=y.get();o.vmult(M[j[(xe+1)%j.length]],we),o.vmult(M[j[(xe+2)%j.length]],Re),i.vadd(we,we),i.vadd(Re,Re);const Be=Pk;Re.vsub(we,Be);const Oe=Rk;Be.unit(Oe);const at=y.get(),st=y.get();n.vsub(we,st);const St=st.dot(Oe);Oe.scale(St,at),at.vadd(we,at);const dt=y.get();if(at.vsub(n,dt),St>0&&St*St<Be.lengthSquared()&&dt.lengthSquared()<P*P){if(v)return!0;const ht=this.createContactEquation(l,h,e,t,d,f);at.vsub(i,ht.rj),at.vsub(n,ht.ni),ht.ni.normalize(),ht.ni.scale(P,ht.ri),ht.rj.vadd(i,ht.rj),ht.rj.vsub(h.position,ht.rj),ht.ri.vadd(n,ht.ri),ht.ri.vsub(l.position,ht.ri),this.result.push(ht),this.createFrictionEquationsFromContact(ht,this.frictionResult);for(let Nt=0,Bt=Ee.length;Nt!==Bt;Nt++)y.release(Ee[Nt]);return y.release(we),y.release(Re),y.release(at),y.release(dt),void y.release(st)}y.release(we),y.release(Re),y.release(at),y.release(dt),y.release(st)}for(let xe=0,we=Ee.length;xe!==we;xe++)y.release(Ee[xe])}}}planeConvex(e,t,n,i,s,o,l,h,d,f,v){const y=Fk,w=zk;w.set(0,0,1),s.vmult(w,w);let E=0;const M=jk;for(let P=0;P!==t.vertices.length;P++)if(y.copy(t.vertices[P]),o.vmult(y,y),i.vadd(y,y),y.vsub(n,M),w.dot(M)<=0){if(v)return!0;const L=this.createContactEquation(l,h,e,t,d,f),R=Vk;w.scale(w.dot(M),R),y.vsub(R,R),R.vsub(n,L.ri),L.ni.copy(w),y.vsub(i,L.rj),L.ri.vadd(n,L.ri),L.ri.vsub(l.position,L.ri),L.rj.vadd(i,L.rj),L.rj.vsub(h.position,L.rj),this.result.push(L),E++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(L,this.frictionResult)}this.enableFrictionReduction&&E&&this.createFrictionFromAverage(E)}boxConvex(e,t,n,i,s,o,l,h,d,f,v){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,s,o,l,h,e,t,v)}sphereHeightfield(e,t,n,i,s,o,l,h,d,f,v){const y=t.data,w=e.radius,E=t.elementSize,M=nU,P=tU;dr.pointToLocalFrame(i,o,n,P);let L=Math.floor((P.x-w)/E)-1,R=Math.ceil((P.x+w)/E)+1,I=Math.floor((P.y-w)/E)-1,N=Math.ceil((P.y+w)/E)+1;if(R<0||N<0||L>y.length||I>y[0].length)return;L<0&&(L=0),R<0&&(R=0),I<0&&(I=0),N<0&&(N=0),L>=y.length&&(L=y.length-1),R>=y.length&&(R=y.length-1),N>=y[0].length&&(N=y[0].length-1),I>=y[0].length&&(I=y[0].length-1);const j=[];t.getRectMinMax(L,I,R,N,j);const H=j[0],X=j[1];if(P.z-w>X||P.z+w<H)return;const ne=this.result;for(let pe=L;pe<R;pe++)for(let Ae=I;Ae<N;Ae++){const ve=ne.length;let Ee=!1;if(t.getConvexTrianglePillar(pe,Ae,!1),dr.pointToWorldFrame(i,o,t.pillarOffset,M),n.distanceTo(M)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(Ee=this.sphereConvex(e,t.pillarConvex,n,M,s,o,l,h,e,t,v)),v&&Ee||(t.getConvexTrianglePillar(pe,Ae,!0),dr.pointToWorldFrame(i,o,t.pillarOffset,M),n.distanceTo(M)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(Ee=this.sphereConvex(e,t.pillarConvex,n,M,s,o,l,h,e,t,v)),v&&Ee))return!0;if(ne.length-ve>2)return}}boxHeightfield(e,t,n,i,s,o,l,h,d,f,v){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,s,o,l,h,e,t,v)}convexHeightfield(e,t,n,i,s,o,l,h,d,f,v){const y=t.data,w=t.elementSize,E=e.boundingSphereRadius,M=$k,P=eU,L=Zk;dr.pointToLocalFrame(i,o,n,L);let R=Math.floor((L.x-E)/w)-1,I=Math.ceil((L.x+E)/w)+1,N=Math.floor((L.y-E)/w)-1,j=Math.ceil((L.y+E)/w)+1;if(I<0||j<0||R>y.length||N>y[0].length)return;R<0&&(R=0),I<0&&(I=0),N<0&&(N=0),j<0&&(j=0),R>=y.length&&(R=y.length-1),I>=y.length&&(I=y.length-1),j>=y[0].length&&(j=y[0].length-1),N>=y[0].length&&(N=y[0].length-1);const H=[];t.getRectMinMax(R,N,I,j,H);const X=H[0],ne=H[1];if(!(L.z-E>ne||L.z+E<X))for(let pe=R;pe<I;pe++)for(let Ae=N;Ae<j;Ae++){let ve=!1;if(t.getConvexTrianglePillar(pe,Ae,!1),dr.pointToWorldFrame(i,o,t.pillarOffset,M),n.distanceTo(M)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ve=this.convexConvex(e,t.pillarConvex,n,M,s,o,l,h,null,null,v,P,null)),v&&ve||(t.getConvexTrianglePillar(pe,Ae,!0),dr.pointToWorldFrame(i,o,t.pillarOffset,M),n.distanceTo(M)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ve=this.convexConvex(e,t.pillarConvex,n,M,s,o,l,h,null,null,v,P,null)),v&&ve))return!0}}sphereParticle(e,t,n,i,s,o,l,h,d,f,v){const y=Xk;if(y.set(0,0,1),i.vsub(n,y),y.lengthSquared()<=e.radius*e.radius){if(v)return!0;const w=this.createContactEquation(h,l,t,e,d,f);y.normalize(),w.rj.copy(y),w.rj.scale(e.radius,w.rj),w.ni.copy(y),w.ni.negate(w.ni),w.ri.set(0,0,0),this.result.push(w),this.createFrictionEquationsFromContact(w,this.frictionResult)}}planeParticle(e,t,n,i,s,o,l,h,d,f,v){const y=Qk;y.set(0,0,1),l.quaternion.vmult(y,y);const w=Wk;if(i.vsub(l.position,w),y.dot(w)<=0){if(v)return!0;const E=this.createContactEquation(h,l,t,e,d,f);E.ni.copy(y),E.ni.negate(E.ni),E.ri.set(0,0,0);const M=qk;y.scale(y.dot(i),M),i.vsub(M,M),E.rj.copy(M),this.result.push(E),this.createFrictionEquationsFromContact(E,this.frictionResult)}}boxParticle(e,t,n,i,s,o,l,h,d,f,v){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,s,o,l,h,e,t,v)}convexParticle(e,t,n,i,s,o,l,h,d,f,v){let y=-1;const w=Kk,E=Jk;let M=null;const P=Yk;if(P.copy(i),P.vsub(n,P),s.conjugate(IP),IP.vmult(P,P),e.pointIsInside(P)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,s),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(s);for(let L=0,R=e.faces.length;L!==R;L++){const I=[e.worldVertices[e.faces[L][0]]],N=e.worldFaceNormals[L];i.vsub(I[0],PP);const j=-N.dot(PP);if(M===null||Math.abs(j)<Math.abs(M)){if(v)return!0;M=j,y=L,w.copy(N)}}if(y!==-1){const L=this.createContactEquation(h,l,t,e,d,f);w.scale(M,E),E.vadd(i,E),E.vsub(n,E),L.rj.copy(E),w.negate(L.ni),L.ri.set(0,0,0);const R=L.ri,I=L.rj;R.vadd(i,R),R.vsub(h.position,R),I.vadd(n,I),I.vsub(l.position,I),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,i,s,o,l,h,d,f,v){return this.convexHeightfield(t,e,i,n,o,s,h,l,d,f,v)}particleCylinder(e,t,n,i,s,o,l,h,d,f,v){return this.convexParticle(t,e,i,n,o,s,h,l,d,f,v)}sphereTrimesh(e,t,n,i,s,o,l,h,d,f,v){const y=ak,w=ok,E=lk,M=ck,P=uk,L=hk,R=mk,I=sk,N=ik,j=gk;dr.pointToLocalFrame(i,o,n,P);const H=e.radius;R.lowerBound.set(P.x-H,P.y-H,P.z-H),R.upperBound.set(P.x+H,P.y+H,P.z+H),t.getTrianglesInAABB(R,j);const X=rk,ne=e.radius*e.radius;for(let xe=0;xe<j.length;xe++)for(let we=0;we<3;we++)if(t.getVertex(t.indices[3*j[xe]+we],X),X.vsub(P,N),N.lengthSquared()<=ne){if(I.copy(X),dr.pointToWorldFrame(i,o,I,X),X.vsub(n,N),v)return!0;let Re=this.createContactEquation(l,h,e,t,d,f);Re.ni.copy(N),Re.ni.normalize(),Re.ri.copy(Re.ni),Re.ri.scale(e.radius,Re.ri),Re.ri.vadd(n,Re.ri),Re.ri.vsub(l.position,Re.ri),Re.rj.copy(X),Re.rj.vsub(h.position,Re.rj),this.result.push(Re),this.createFrictionEquationsFromContact(Re,this.frictionResult)}for(let xe=0;xe<j.length;xe++)for(let we=0;we<3;we++){t.getVertex(t.indices[3*j[xe]+we],y),t.getVertex(t.indices[3*j[xe]+(we+1)%3],w),w.vsub(y,E),P.vsub(w,L);const Re=L.dot(E);P.vsub(y,L);let Be=L.dot(E);if(Be>0&&Re<0&&(P.vsub(y,L),M.copy(E),M.normalize(),Be=L.dot(M),M.scale(Be,L),L.vadd(y,L),L.distanceTo(P)<e.radius)){if(v)return!0;const Oe=this.createContactEquation(l,h,e,t,d,f);L.vsub(P,Oe.ni),Oe.ni.normalize(),Oe.ni.scale(e.radius,Oe.ri),Oe.ri.vadd(n,Oe.ri),Oe.ri.vsub(l.position,Oe.ri),dr.pointToWorldFrame(i,o,L,L),L.vsub(h.position,Oe.rj),dr.vectorToWorldFrame(o,Oe.ni,Oe.ni),dr.vectorToWorldFrame(o,Oe.ri,Oe.ri),this.result.push(Oe),this.createFrictionEquationsFromContact(Oe,this.frictionResult)}}const pe=dk,Ae=pk,ve=fk,Ee=nk;for(let xe=0,we=j.length;xe!==we;xe++){t.getTriangleVertices(j[xe],pe,Ae,ve),t.getNormal(j[xe],Ee),P.vsub(pe,L);let Re=L.dot(Ee);if(Ee.scale(Re,L),P.vsub(L,L),Re=L.distanceTo(P),da.pointInTriangle(L,pe,Ae,ve)&&Re<e.radius){if(v)return!0;let Be=this.createContactEquation(l,h,e,t,d,f);L.vsub(P,Be.ni),Be.ni.normalize(),Be.ni.scale(e.radius,Be.ri),Be.ri.vadd(n,Be.ri),Be.ri.vsub(l.position,Be.ri),dr.pointToWorldFrame(i,o,L,L),L.vsub(h.position,Be.rj),dr.vectorToWorldFrame(o,Be.ni,Be.ni),dr.vectorToWorldFrame(o,Be.ri,Be.ri),this.result.push(Be),this.createFrictionEquationsFromContact(Be,this.frictionResult)}}j.length=0}planeTrimesh(e,t,n,i,s,o,l,h,d,f,v){const y=new ge,w=$O;w.set(0,0,1),s.vmult(w,w);for(let E=0;E<t.vertices.length/3;E++){t.getVertex(E,y);const M=new ge;M.copy(y),dr.pointToWorldFrame(i,o,M,y);const P=ek;if(y.vsub(n,P),w.dot(P)<=0){if(v)return!0;const L=this.createContactEquation(l,h,e,t,d,f);L.ni.copy(w);const R=tk;w.scale(P.dot(w),R),y.vsub(R,R),L.ri.copy(R),L.ri.vsub(l.position,L.ri),L.rj.copy(y),L.rj.vsub(h.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}}}}const vv=new ge,P0=new ge,R0=new ge,YO=new ge,KO=new ge,JO=new bs,ZO=new bs,$O=new ge,ek=new ge,tk=new ge,nk=new ge,ik=new ge;new ge;const rk=new ge,sk=new ge,ak=new ge,ok=new ge,lk=new ge,ck=new ge,uk=new ge,hk=new ge,dk=new ge,pk=new ge,fk=new ge,mk=new hs,gk=[],o1=new ge,TP=new ge,vk=new ge,_k=new ge,yk=new ge;function Ak(a,e,t){let n=null;const i=a.length;for(let s=0;s!==i;s++){const o=a[s],l=vk;a[(s+1)%i].vsub(o,l);const h=_k;l.cross(e,h);const d=yk;t.vsub(o,d);const f=h.dot(d);if(!(n===null||f>0&&n===!0||f<=0&&n===!1))return!1;n===null&&(n=f>0)}return!0}const l1=new ge,bk=new ge,xk=new ge,wk=new ge,Ek=[new ge,new ge,new ge,new ge,new ge,new ge],Sk=new ge,Mk=new ge,Ck=new ge,Tk=new ge,Ik=new ge,Pk=new ge,Rk=new ge,Dk=new ge,Bk=new ge,Lk=new ge,Ok=new ge,kk=new ge,Uk=new ge,Nk=new ge;new ge,new ge;const Fk=new ge,zk=new ge,jk=new ge,Vk=new ge,Gk=new ge,Hk=new ge,Qk=new ge,Wk=new ge,qk=new ge,Xk=new ge,IP=new bs,Yk=new ge;new ge;const Kk=new ge,PP=new ge,Jk=new ge,Zk=new ge,$k=new ge,eU=[0],tU=new ge,nU=new ge;class RP{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),i=this.current;let s=0;for(;n>i[s];)s++;if(n!==i[s]){for(let o=i.length-1;o>=s;o--)i[o+1]=i[o];i[s]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,i=this.previous,s=n.length,o=i.length;let l=0;for(let h=0;h<s;h++){let d=!1;const f=n[h];for(;f>i[l];)l++;d=f===i[l],d||DP(e,f)}l=0;for(let h=0;h<o;h++){let d=!1;const f=i[h];for(;f>n[l];)l++;d=n[l]===f,d||DP(t,f)}}}function DP(a,e){a.push((4294901760&e)>>16,65535&e)}const hM=(a,e)=>a<e?`${a}-${e}`:`${e}-${a}`;class iU{constructor(){this.data={keys:[]}}get(e,t){const n=hM(e,t);return this.data[n]}set(e,t,n){const i=hM(e,t);this.get(e,t)||this.data.keys.push(i),this.data[i]=n}delete(e,t){const n=hM(e,t),i=this.data.keys.indexOf(n);i!==-1&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;)delete e[t.pop()]}}class rU extends iP{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new ge,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new BL,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new vO,this.constraints=[],this.narrowphase=new XO(this),this.collisionMatrix=new nP,this.collisionMatrixPrevious=new nP,this.bodyOverlapKeeper=new RP,this.shapeOverlapKeeper=new RP,this.contactmaterials=[],this.contactMaterialTable=new iU,this.defaultMaterial=new i1("default"),this.defaultContactMaterial=new n1(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof Kw?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,i){return n===void 0&&(n={}),n.mode=da.ALL,n.from=e,n.to=t,n.callback=i,dM.intersectWorld(this,n)}raycastAny(e,t,n,i){return n===void 0&&(n={}),n.mode=da.ANY,n.from=e,n.to=t,n.result=i,dM.intersectWorld(this,n)}raycastClosest(e,t,n,i){return n===void 0&&(n={}),n.mode=da.CLOSEST,n.from=e,n.to=t,n.result=i,dM.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof Rn&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(i!==-1){n.splice(i,1);for(let s=0;s!==n.length;s++)n[s].index=s;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const i=t[n].shapes;for(let s=0;s<i.length;s++){const o=i[s];if(o.id===e)return o}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);const n=Da.now()/1e3;if(this.lastCallTime){const i=n-this.lastCallTime;this.step(e,i,t)}else this.step(e,void 0,t);this.lastCallTime=n}step(e,t,n){if(n===void 0&&(n=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const i=Da.now();let s=0;for(;this.accumulator>=e&&s<n&&(this.internalStep(e),this.accumulator-=e,s++,!(Da.now()-i>1e3*e)););this.accumulator=this.accumulator%e;const o=this.accumulator/e;for(let l=0;l!==this.bodies.length;l++){const h=this.bodies[l];h.previousPosition.lerp(h.position,o,h.interpolatedPosition),h.previousQuaternion.slerp(h.quaternion,o,h.interpolatedQuaternion),h.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=cU,i=uU,s=this.bodies.length,o=this.bodies,l=this.solver,h=this.gravity,d=this.doProfiling,f=this.profile,v=Rn.DYNAMIC;let y=-1/0;const w=this.constraints,E=lU;h.length();const M=h.x,P=h.y,L=h.z;let R=0;for(d&&(y=Da.now()),R=0;R!==s;R++){const Ee=o[R];if(Ee.type===v){const xe=Ee.force,we=Ee.mass;xe.x+=we*M,xe.y+=we*P,xe.z+=we*L}}for(let Ee=0,xe=this.subsystems.length;Ee!==xe;Ee++)this.subsystems[Ee].update();d&&(y=Da.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),d&&(f.broadphase=Da.now()-y);let I=w.length;for(R=0;R!==I;R++){const Ee=w[R];if(!Ee.collideConnected)for(let xe=n.length-1;xe>=0;xe-=1)(Ee.bodyA===n[xe]&&Ee.bodyB===i[xe]||Ee.bodyB===n[xe]&&Ee.bodyA===i[xe])&&(n.splice(xe,1),i.splice(xe,1))}this.collisionMatrixTick(),d&&(y=Da.now());const N=oU,j=t.length;for(R=0;R!==j;R++)N.push(t[R]);t.length=0;const H=this.frictionEquations.length;for(R=0;R!==H;R++)E.push(this.frictionEquations[R]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,t,N,this.frictionEquations,E),d&&(f.narrowphase=Da.now()-y),d&&(y=Da.now()),R=0;R<this.frictionEquations.length;R++)l.addEquation(this.frictionEquations[R]);const X=t.length;for(let Ee=0;Ee!==X;Ee++){const xe=t[Ee],we=xe.bi,Re=xe.bj,Be=xe.si,Oe=xe.sj;let at;at=we.material&&Re.material&&this.getContactMaterial(we.material,Re.material)||this.defaultContactMaterial,at.friction,we.material&&Re.material&&(we.material.friction>=0&&Re.material.friction>=0&&(we.material.friction,Re.material.friction),we.material.restitution>=0&&Re.material.restitution>=0&&(xe.restitution=we.material.restitution*Re.material.restitution)),l.addEquation(xe),we.allowSleep&&we.type===Rn.DYNAMIC&&we.sleepState===Rn.SLEEPING&&Re.sleepState===Rn.AWAKE&&Re.type!==Rn.STATIC&&Re.velocity.lengthSquared()+Re.angularVelocity.lengthSquared()>=2*Re.sleepSpeedLimit**2&&(we.wakeUpAfterNarrowphase=!0),Re.allowSleep&&Re.type===Rn.DYNAMIC&&Re.sleepState===Rn.SLEEPING&&we.sleepState===Rn.AWAKE&&we.type!==Rn.STATIC&&we.velocity.lengthSquared()+we.angularVelocity.lengthSquared()>=2*we.sleepSpeedLimit**2&&(Re.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(we,Re,!0),this.collisionMatrixPrevious.get(we,Re)||(VA.body=Re,VA.contact=xe,we.dispatchEvent(VA),VA.body=we,Re.dispatchEvent(VA)),this.bodyOverlapKeeper.set(we.id,Re.id),this.shapeOverlapKeeper.set(Be.id,Oe.id)}for(this.emitContactEvents(),d&&(f.makeContactConstraints=Da.now()-y,y=Da.now()),R=0;R!==s;R++){const Ee=o[R];Ee.wakeUpAfterNarrowphase&&(Ee.wakeUp(),Ee.wakeUpAfterNarrowphase=!1)}for(I=w.length,R=0;R!==I;R++){const Ee=w[R];Ee.update();for(let xe=0,we=Ee.equations.length;xe!==we;xe++){const Re=Ee.equations[xe];l.addEquation(Re)}}l.solve(e,this),d&&(f.solve=Da.now()-y),l.removeAllEquations();const ne=Math.pow;for(R=0;R!==s;R++){const Ee=o[R];if(Ee.type&v){const xe=ne(1-Ee.linearDamping,e),we=Ee.velocity;we.scale(xe,we);const Re=Ee.angularVelocity;if(Re){const Be=ne(1-Ee.angularDamping,e);Re.scale(Be,Re)}}}this.dispatchEvent(aU),d&&(y=Da.now());const pe=this.stepnumber%(this.quatNormalizeSkip+1)==0,Ae=this.quatNormalizeFast;for(R=0;R!==s;R++)o[R].integrate(e,pe,Ae);this.clearForces(),this.broadphase.dirty=!0,d&&(f.integrate=Da.now()-y),this.stepnumber+=1,this.dispatchEvent(sU);let ve=!0;if(this.allowSleep)for(ve=!1,R=0;R!==s;R++){const Ee=o[R];Ee.sleepTick(this.time),Ee.sleepState!==Rn.SLEEPING&&(ve=!0)}this.hasActiveBodies=ve}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Kp,Jp),e){for(let s=0,o=Kp.length;s<o;s+=2)GA.bodyA=this.getBodyById(Kp[s]),GA.bodyB=this.getBodyById(Kp[s+1]),this.dispatchEvent(GA);GA.bodyA=GA.bodyB=null}if(t){for(let s=0,o=Jp.length;s<o;s+=2)HA.bodyA=this.getBodyById(Jp[s]),HA.bodyB=this.getBodyById(Jp[s+1]),this.dispatchEvent(HA);HA.bodyA=HA.bodyB=null}Kp.length=Jp.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(Kp,Jp),n){for(let s=0,o=Kp.length;s<o;s+=2){const l=this.getShapeById(Kp[s]),h=this.getShapeById(Kp[s+1]);Zp.shapeA=l,Zp.shapeB=h,l&&(Zp.bodyA=l.body),h&&(Zp.bodyB=h.body),this.dispatchEvent(Zp)}Zp.bodyA=Zp.bodyB=Zp.shapeA=Zp.shapeB=null}if(i){for(let s=0,o=Jp.length;s<o;s+=2){const l=this.getShapeById(Jp[s]),h=this.getShapeById(Jp[s+1]);$p.shapeA=l,$p.shapeB=h,l&&($p.bodyA=l.body),h&&($p.bodyB=h.body),this.dispatchEvent($p)}$p.bodyA=$p.bodyB=$p.shapeA=$p.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const i=e[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}}new hs;const dM=new da,Da=globalThis.performance||{};if(!Da.now){let a=Date.now();Da.timing&&Da.timing.navigationStart&&(a=Da.timing.navigationStart),Da.now=()=>Date.now()-a}new ge;const sU={type:"postStep"},aU={type:"preStep"},VA={type:Rn.COLLIDE_EVENT_NAME,body:null,contact:null},oU=[],lU=[],cU=[],uU=[],Kp=[],Jp=[],GA={type:"beginContact",bodyA:null,bodyB:null},HA={type:"endContact",bodyA:null,bodyB:null},Zp={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},$p={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var hU=function(){var a,e,t,n,i=0,s=new u.Pa4;function o(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new f,this.unassigned=new f,this.vertices=[]}function l(){this.normal=new u.Pa4,this.midpoint=new u.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=i,this.edge=null}function h(v,y){this.vertex=v,this.prev=null,this.next=null,this.twin=null,this.face=y}function d(v,y){this.point=v,this.index=y,this.prev=null,this.next=null,this.face=null}function f(){this.head=null,this.tail=null}return Object.assign(o.prototype,{toJSON:function(){const v=this.faces.map(P=>P.toArray()),y=Array.from(new Set(v.flat())).sort(),w=[];for(let P=0;P<y.length;P++)w.push(this.vertices[y[P]].point.x,this.vertices[y[P]].point.y,this.vertices[y[P]].point.z);const E=new Map;for(let P=0;P<y.length;P++)E.set(y[P],P);const M=[];for(let P=0;P<v.length;P++)M.push([E.get(v[P][0]),E.get(v[P][1]),E.get(v[P][2])]);return[w,M]},setFromPoints:function(v){Array.isArray(v)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),v.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var y=0,w=v.length;y<w;y++)this.vertices.push(new d(v[y],y));return this.compute(),this},setFromObject:function(v){var y=[];return v.updateMatrixWorld(!0),v.traverse(function(w){var E,M,P,L=w.geometry;if(L!==void 0&&(L.isGeometry&&(L=L.toBufferGeometry?L.toBufferGeometry():new BufferGeometry().fromGeometry(L)),L.isBufferGeometry)){var R=L.attributes.position;if(R!==void 0)for(E=0,M=R.count;E<M;E++)(P=new u.Pa4).fromBufferAttribute(R,E).applyMatrix4(w.matrixWorld),y.push(P)}}),this.setFromPoints(y)},containsPoint:function(v){for(var y=this.faces,w=0,E=y.length;w<E;w++)if(y[w].distanceToPoint(v)>this.tolerance)return!1;return!0},intersectRay:function(v,y){for(var w=this.faces,E=-1/0,M=1/0,P=0,L=w.length;P<L;P++){var R=w[P],I=R.distanceToPoint(v.origin),N=R.normal.dot(v.direction);if(I>0&&N>=0)return null;var j=N!==0?-I/N:0;if(!(j<=0)&&(N>0?M=Math.min(j,M):E=Math.max(j,E),E>M))return null}return E!==-1/0?v.at(E,y):v.at(M,y),y},intersectsRay:function(v){return this.intersectRay(v,s)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(v,y){return v.face=y,y.outside===null?this.assigned.append(v):this.assigned.insertBefore(y.outside,v),y.outside=v,this},removeVertexFromFace:function(v,y){return v===y.outside&&(v.next!==null&&v.next.face===y?y.outside=v.next:y.outside=null),this.assigned.remove(v),this},removeAllVerticesFromFace:function(v){if(v.outside!==null){for(var y=v.outside,w=v.outside;w.next!==null&&w.next.face===v;)w=w.next;return this.assigned.removeSubList(y,w),y.prev=w.next=null,v.outside=null,y}},deleteFaceVertices:function(v,y){var w=this.removeAllVerticesFromFace(v);if(w!==void 0)if(y===void 0)this.unassigned.appendChain(w);else{var E=w;do{var M=E.next;y.distanceToPoint(E.point)>this.tolerance?this.addVertexToFace(E,y):this.unassigned.append(E),E=M}while(E!==null)}return this},resolveUnassignedPoints:function(v){if(this.unassigned.isEmpty()===!1){var y=this.unassigned.first();do{for(var w=y.next,E=this.tolerance,M=null,P=0;P<v.length;P++){var L=v[P];if(L.mark===i){var R=L.distanceToPoint(y.point);if(R>E&&(E=R,M=L),E>1e3*this.tolerance)break}}M!==null&&this.addVertexToFace(y,M),y=w}while(y!==null)}return this},computeExtremes:function(){var v,y,w,E=new u.Pa4,M=new u.Pa4,P=[],L=[];for(v=0;v<3;v++)P[v]=L[v]=this.vertices[0];for(E.copy(this.vertices[0].point),M.copy(this.vertices[0].point),v=0,y=this.vertices.length;v<y;v++){var R=this.vertices[v],I=R.point;for(w=0;w<3;w++)I.getComponent(w)<E.getComponent(w)&&(E.setComponent(w,I.getComponent(w)),P[w]=R);for(w=0;w<3;w++)I.getComponent(w)>M.getComponent(w)&&(M.setComponent(w,I.getComponent(w)),L[w]=R)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(E.x),Math.abs(M.x))+Math.max(Math.abs(E.y),Math.abs(M.y))+Math.max(Math.abs(E.z),Math.abs(M.z))),{min:P,max:L}},computeInitialHull:function(){a===void 0&&(a=new u.Zzh,e=new u.JOQ,t=new u.Pa4);var v,y,w,E,M,P,L,R,I,N=this.vertices,j=this.computeExtremes(),H=j.min,X=j.max,ne=0,pe=0;for(P=0;P<3;P++)(I=X[P].point.getComponent(P)-H[P].point.getComponent(P))>ne&&(ne=I,pe=P);for(y=H[pe],w=X[pe],ne=0,a.set(y.point,w.point),P=0,L=this.vertices.length;P<L;P++)(v=N[P])!==y&&v!==w&&(a.closestPointToPoint(v.point,!0,t),(I=t.distanceToSquared(v.point))>ne&&(ne=I,E=v));for(ne=-1,e.setFromCoplanarPoints(y.point,w.point,E.point),P=0,L=this.vertices.length;P<L;P++)(v=N[P])!==y&&v!==w&&v!==E&&(I=Math.abs(e.distanceToPoint(v.point)))>ne&&(ne=I,M=v);var Ae=[];if(e.distanceToPoint(M.point)<0)for(Ae.push(l.create(y,w,E),l.create(M,w,y),l.create(M,E,w),l.create(M,y,E)),P=0;P<3;P++)R=(P+1)%3,Ae[P+1].getEdge(2).setTwin(Ae[0].getEdge(R)),Ae[P+1].getEdge(1).setTwin(Ae[R+1].getEdge(0));else for(Ae.push(l.create(y,E,w),l.create(M,y,w),l.create(M,w,E),l.create(M,E,y)),P=0;P<3;P++)R=(P+1)%3,Ae[P+1].getEdge(2).setTwin(Ae[0].getEdge((3-P)%3)),Ae[P+1].getEdge(0).setTwin(Ae[R+1].getEdge(1));for(P=0;P<4;P++)this.faces.push(Ae[P]);for(P=0,L=N.length;P<L;P++)if((v=N[P])!==y&&v!==w&&v!==E&&v!==M){ne=this.tolerance;var ve=null;for(R=0;R<4;R++)(I=this.faces[R].distanceToPoint(v.point))>ne&&(ne=I,ve=this.faces[R]);ve!==null&&this.addVertexToFace(v,ve)}return this},reindexFaces:function(){for(var v=[],y=0;y<this.faces.length;y++){var w=this.faces[y];w.mark===i&&v.push(w)}return this.faces=v,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var v,y=0,w=this.assigned.first().face,E=w.outside;do{var M=w.distanceToPoint(E.point);M>y&&(y=M,v=E),E=E.next}while(E!==null&&E.face===w);return v}},computeHorizon:function(v,y,w,E){var M;this.deleteFaceVertices(w),w.mark=1,M=y===null?y=w.getEdge(0):y.next;do{var P=M.twin,L=P.face;L.mark===i&&(L.distanceToPoint(v)>this.tolerance?this.computeHorizon(v,P,L,E):E.push(M)),M=M.next}while(M!==y);return this},addAdjoiningFace:function(v,y){var w=l.create(v,y.tail(),y.head());return this.faces.push(w),w.getEdge(-1).setTwin(y.twin),w.getEdge(0)},addNewFaces:function(v,y){this.newFaces=[];for(var w=null,E=null,M=0;M<y.length;M++){var P=y[M],L=this.addAdjoiningFace(v,P);w===null?w=L:L.next.setTwin(E),this.newFaces.push(L.face),E=L}return w.next.setTwin(E),this},addVertexToHull:function(v){var y=[];return this.unassigned.clear(),this.removeVertexFromFace(v,v.face),this.computeHorizon(v.point,null,v.face,y),this.addNewFaces(v,y),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var v;for(this.computeInitialHull();(v=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(v);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(l,{create:function(v,y,w){var E=new l,M=new h(v,E),P=new h(y,E),L=new h(w,E);return M.next=L.prev=P,P.next=M.prev=L,L.next=P.prev=M,E.edge=M,E.compute()}}),Object.assign(l.prototype,{toArray:function(){const v=[];let y=this.edge;do v.push(y.head().index),y=y.next;while(y!==this.edge);return v},getEdge:function(v){for(var y=this.edge;v>0;)y=y.next,v--;for(;v<0;)y=y.prev,v++;return y},compute:function(){n===void 0&&(n=new u.CJI);var v=this.edge.tail(),y=this.edge.head(),w=this.edge.next.head();return n.set(v.point,y.point,w.point),n.getNormal(this.normal),n.getMidpoint(this.midpoint),this.area=n.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(v){return this.normal.dot(v)-this.constant}}),Object.assign(h.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var v=this.head(),y=this.tail();return y!==null?y.point.distanceTo(v.point):-1},lengthSquared:function(){var v=this.head(),y=this.tail();return y!==null?y.point.distanceToSquared(v.point):-1},setTwin:function(v){return this.twin=v,v.twin=this,this}}),Object.assign(f.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(v,y){return y.prev=v.prev,y.next=v,y.prev===null?this.head=y:y.prev.next=y,v.prev=y,this},insertAfter:function(v,y){return y.prev=v,y.next=v.next,y.next===null?this.tail=y:y.next.prev=y,v.next=y,this},append:function(v){return this.head===null?this.head=v:this.tail.next=v,v.prev=this.tail,v.next=null,this.tail=v,this},appendChain:function(v){for(this.head===null?this.head=v:this.tail.next=v,v.prev=this.tail;v.next!==null;)v=v.next;return this.tail=v,this},remove:function(v){return v.prev===null?this.head=v.next:v.prev.next=v.next,v.next===null?this.tail=v.prev:v.next.prev=v.prev,this},removeSubList:function(v,y){return v.prev===null?this.head=y.next:v.prev.next=y.next,y.next===null?this.tail=v.prev:y.next.prev=v.prev,this},isEmpty:function(){return this.head===null}}),o}();const dU=new u.Pa4,c1=new u.Pa4,pU=new u._fP;function u1(a){const e=function(i){const s=[];return i.traverse(function(o){o.isMesh&&s.push(o)}),s}(a);if(e.length===0)return null;if(e.length===1)return BP(e[0]);let t;const n=[];for(;t=e.pop();)n.push(fU(BP(t)));return function(i){let s=0;for(let h=0;h<i.length;h++){const d=i[h].attributes.position;d&&d.itemSize===3&&(s+=d.count)}const o=new Float32Array(3*s);let l=0;for(let h=0;h<i.length;h++){const d=i[h].attributes.position;if(d&&d.itemSize===3)for(let f=0;f<d.count;f++)o[l++]=d.getX(f),o[l++]=d.getY(f),o[l++]=d.getZ(f)}return new u.u9r().setAttribute("position",new u.TlE(o,3))}(n)}function BP(a){let e=a.geometry;return e=e.toBufferGeometry?e.toBufferGeometry():e.clone(),a.updateMatrixWorld(),a.matrixWorld.decompose(dU,pU,c1),e.scale(c1.x,c1.y,c1.z),e}function LP(a){const e=a.attributes.position,t=new Float32Array(3*e.count);for(let n=0;n<e.count;n++)t[3*n]=e.getX(n),t[3*n+1]=e.getY(n),t[3*n+2]=e.getZ(n);return t}function h1(a,e){switch(e){case"x":return a.x;case"y":return a.y;case"z":return a.z}throw new Error(`Unexpected component ${e}`)}function fU(a,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=a.getIndex(),i=a.getAttribute("position"),s=n?n.count:i.count;let o=0;const l=[],h=[],d=Math.log10(1/e),f=Math.pow(10,d);for(let w=0;w<s;w++){const E=n?n.getX(w):w;let M="";M+=~~(i.getX(E)*f)+",",M+=~~(i.getY(E)*f)+",",M+=~~(i.getZ(E)*f)+",",M in t?l.push(t[M]):(h.push(i.getX(E)),h.push(i.getY(E)),h.push(i.getZ(E)),t[M]=o,l.push(o),o++)}const v=new u.TlE(new Float32Array(h),i.itemSize,i.normalized),y=new u.u9r;return y.setAttribute("position",v),y.setIndex(l),y}const OP=Math.PI/2;var Ds;(function(a){a.BOX="Box",a.CYLINDER="Cylinder",a.SPHERE="Sphere",a.HULL="ConvexPolyhedron",a.MESH="Trimesh"})(Ds||(Ds={}));const mU=function(a,e={}){const t=function(h,d={}){let f;if(d.type===Ds.BOX)return UP(h);if(d.type===Ds.CYLINDER)return function(v,y){const w=["x","y","z"],E=y.cylinderAxis||"y",M=w.splice(w.indexOf(E),1)&&w,P=new u.ZzF().setFromObject(v);if(!isFinite(P.min.lengthSq()))return null;const L=P.max[E]-P.min[E],R=.5*Math.max(h1(P.max,M[0])-h1(P.min,M[0]),h1(P.max,M[1])-h1(P.min,M[1])),I=E==="y"?OP:0,N=E==="z"?OP:0;return{type:Ds.CYLINDER,params:{radiusTop:R,radiusBottom:R,height:L,segments:12},orientation:new bs().setFromEuler(I,N,0,"XYZ").normalize()}}(h,d);if(d.type===Ds.SPHERE)return function(v,y){if(y.sphereRadius)return{type:Ds.SPHERE,params:{radius:y.sphereRadius}};const w=u1(v);return w?(w.computeBoundingSphere(),{type:Ds.SPHERE,params:{radius:w.boundingSphere.radius}}):null}(h,d);if(d.type===Ds.HULL)return function(v){const y=u1(v);if(!y)return null;const w=1e-4;for(let P=0;P<y.attributes.position.count;P++)y.attributes.position.setXYZ(P,y.attributes.position.getX(P)+(Math.random()-.5)*w,y.attributes.position.getY(P)+(Math.random()-.5)*w,y.attributes.position.getZ(P)+(Math.random()-.5)*w);const[E,M]=new hU().setFromObject(new u.Kj0(y)).toJSON();return{type:Ds.HULL,params:{vertices:new Float32Array(E),faces:M}}}(h);if(d.type===Ds.MESH)return f=u1(h),f?function(v){const y=LP(v);if(!y.length)return null;const w=new Uint32Array(y.length);for(let E=0;E<y.length;E++)w[E]=E;return{type:Ds.MESH,params:{vertices:y,indices:w}}}(f):null;if(d.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${d.type}".`);if(f=u1(h),!f)return null;switch(f.type){case"BoxGeometry":case"BoxBufferGeometry":return kP(f);case"CylinderGeometry":case"CylinderBufferGeometry":return function(v){const y=v.parameters;return{type:Ds.CYLINDER,params:{radiusTop:y.radiusTop,radiusBottom:y.radiusBottom,height:y.height,segments:y.radialSegments},orientation:new bs().setFromEuler(u.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(f);case"PlaneGeometry":case"PlaneBufferGeometry":return function(v){v.computeBoundingBox();const y=v.boundingBox;return{type:Ds.BOX,params:{x:(y.max.x-y.min.x)/2||.1,y:(y.max.y-y.min.y)/2||.1,z:(y.max.z-y.min.z)/2||.1}}}(f);case"SphereGeometry":case"SphereBufferGeometry":return function(v){return{type:Ds.SPHERE,params:{radius:v.parameters.radius}}}(f);case"TubeGeometry":case"BufferGeometry":return UP(h);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',f.type),kP(f)}}(a,e);if(!t)return null;const{type:n,params:i,offset:s,orientation:o}=t;let l;return l=n===Ds.BOX?function(h){const{x:d,y:f,z:v}=h;return new Yw(new ge(d,f,v))}(i):n===Ds.CYLINDER?function(h){const{radiusTop:d,radiusBottom:f,height:v,segments:y}=h,w=new oO(d,f,v,y);return w.radiusTop=f,w.radiusBottom=f,w.height=v,w.numSegments=y,w}(i):n===Ds.SPHERE?function(h){return new xP(h.radius)}(i):n===Ds.HULL?function(h){const{faces:d,vertices:f}=h,v=[];for(let y=0;y<f.length;y+=3)v.push(new ge(f[y],f[y+1],f[y+2]));return new pv({faces:d,vertices:v})}(i):function(h){const{vertices:d,indices:f}=h;return new s1(d,f)}(i),{shape:l,offset:s,orientation:o}};function kP(a){if(!LP(a).length)return null;a.computeBoundingBox();const e=a.boundingBox;return{type:Ds.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function UP(a){const e=a.clone();e.quaternion.set(0,0,0,1),e.updateMatrixWorld();const t=new u.ZzF().setFromObject(e);if(!isFinite(t.min.lengthSq()))return null;const n=t.translate(e.position.negate()).getCenter(new u.Pa4);return{type:Ds.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2},offset:n.lengthSq()?new ge(n.x,n.y,n.z):void 0}}var d1,p1=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Od=d1=class extends Sn{constructor(a=!1){super(),this._world=new rU,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var i;(i=this._viewer)==null||i.scene.modelRoot.children.forEach(s=>{this.makeBody(s)})},this._bodyMeshMap=new Map,this._movementPlane=new u.Kj0(new u._12(100,100),new u.vBJ({color:65280,side:u.ehD})),this.enabled=a,this._world.gravity.set(0,-9.81,0);const e=new lO,t=new Rn({mass:0,position:new ge(0,-2,0)});t.addShape(e),t.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=t,this._world.addBody(t);const n=new xP(.1);this._jointBody=new Rn({mass:0}),this._jointBody.addShape(n),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(a){await super.onAdded(a);const e=new u.Pa4,t=new u.Pa4,n=new u.Pa4,i=new u._fP,s=new u._fP,o=new u.yGw,l=new u.yGw;let h=!1,d=!1;function f(v){const y=a.canvas.getBoundingClientRect(),w=new u.FM8;return w.x=(v.clientX-y.x)/y.width*2-1,w.y=-(v.clientY-y.y)/y.height*2+1,w}a.addEventListener("preFrame",()=>{const v=a.getPlugin(Yl),y=a.getPlugin(Nu);if(!this.enabled){if(!(this.nextSteps>0))return v&&h&&(v.enableRefreshTransform=!0,h=!1),y&&d&&(y.enable(d1.PluginType),d=!1),void(this._dirty=!1);this.enabled=!0}if(v&&v.enableRefreshTransform&&!h&&(v.enableRefreshTransform=!1,h=!0),y&&!d&&y.disable(d1.PluginType),this.nextSteps>0)for(let E=0;E<this.stepPhysics.stepCount;E++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let w=!1;for(const E of this._world.bodies){if(E.mass===0)continue;const M=this._bodyMeshMap.get(E);if(M&&(M.updateMatrixWorld(),M.getWorldPosition(t),M.getWorldQuaternion(s),M.getWorldScale(n),t.manhattanDistanceTo(e.copy(E.position))>0&&(w=!0),s.angleTo(i.copy(E.quaternion))>0&&(w=!0),w)){if(o.compose(e,i,n),!M.parent)throw new Error("no parent");l.copy(M.parent.matrixWorld).invert(),l.multiply(o),l.decompose(e,i,n),M.position.copy(e),M.quaternion.copy(i)}}this._dirty=w,a.setDirty(),a.renderer.resetShadows(),v==null||v.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),a.scene.addEventListener("update",v=>{this._bodyMeshMap.forEach((y,w)=>{w.velocity.set(0,0,0),w.angularVelocity.set(0,0,0)})}),a.scene.addEventListener("addSceneObject",v=>{var y;const w=(y=v.object)==null?void 0:y.modelObject;w&&w.traverse(E=>{const M=E.uiConfig;M&&Array.isArray(M.children)&&(M.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(E)},{type:"number",label:"Mass",hidden:()=>!E._physicsBody,getValue:()=>{var P;return((P=E._physicsBody)==null?void 0:P.mass)??0},setValue:P=>{E._physicsBody&&(E._physicsBody.mass=P)}}]}),E.userData.physicsMass!==void 0&&this.makeBody(E))})}),a.canvas.addEventListener("pointerdown",v=>{if(!this.enabled||!v.isPrimary)return;a.getPlugin(Ti).enabled=!1;const y=f(v),w=new u.iMs;w.setFromCamera(y,a.scene.activeCamera.cameraObject);const E=w.intersectObjects([...this._bodyMeshMap.values()],!0);if(!E.length)return;let M,P=null,L=E[0];for(const N of E){for(P=N.object,L=N;!(P==null||P.visible&&P.material);)P=P.parent;if(P)break}if(!P)return;for(;P.parent&&!M;){for(const[N,j]of this._bodyMeshMap.entries())if(j===P){N.mass>0&&(M=N);break}P=P.parent}if(!M)return;a.scene.activeCamera.interactionsEnabled=!1,this._movementPlane.position.copy(L.point),this._movementPlane.lookAt(a.scene.activeCamera.cameraObject.getWorldPosition(new u.Pa4));const R=new ge().copy(L.point).vsub(M.position),I=M.quaternion.inverse().vmult(R);this._jointBody.position.copy(L.point),this._jointConstraint=new rO(M,I,this._jointBody,new ge(0,0,0)),this._world.addConstraint(this._jointConstraint)}),a.canvas.addEventListener("pointermove",v=>{if(!this.enabled||!v.isPrimary||!this._jointConstraint)return;const y=f(v),w=new u.iMs;w.setFromCamera(y,a.scene.activeCamera.cameraObject);const E=w.intersectObject(this._movementPlane);if(!E.length)return;const M=E[0];this._jointBody.position.copy(M.point),this._jointConstraint.update()}),a.canvas.addEventListener("pointerup",v=>{this.enabled&&v.isPrimary&&(a.getPlugin(Ti).enabled=!0,a.scene.activeCamera.interactionsEnabled=!0,this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(a){if(a.isLight||a._physicsBody)return;const e=[];let t=0;if(a.updateMatrixWorld(),a.traverse(h=>{const d=h;if(!d.isMesh)return;if(d._physicsShape)return void e.push(d._physicsShape);if(t+=d.userData.physicsMass??1,d.addEventListener("objectUpdate",()=>{d.userData.physicsMass===0&&(this._ground.position.y=d.position.y,this._bodyMeshMap.forEach((v,y)=>{y.velocity.set(0,0,0),y.angularVelocity.set(0,0,0),y.force.set(0,0,0),y.torque.set(0,0,0)}))}),d.userData.physicsMass===0)return;const f=mU(d,{type:Ds.HULL});f?(e.push([f.shape,d]),d._physicsShape=f.shape):console.warn("Failed to convert mesh to cannon shape",d)}),!e.length)return;const n=new Rn({mass:t,angularVelocity:new ge(0,0,0),velocity:new ge(0,0,0)}),i=new u.Pa4,s=new u._fP,o=new u.Pa4,l=new u.yGw;for(const[h,d]of e)d!==a?(d.updateMatrixWorld(),l.copy(a.matrixWorld).invert(),l.multiply(d.matrixWorld),l.decompose(i,s,o),n.addShape(h,new ge(...i.toArray()),new bs(...s.toArray()))):n.addShape(h);n.position.set(...a.getWorldPosition(i).toArray()),n.quaternion.set(...a.getWorldQuaternion(s).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0),a.addEventListener("objectUpdate",()=>{n.position.set(...a.getWorldPosition(i).toArray()),n.quaternion.set(...a.getWorldQuaternion(s).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0)}),this._world.addBody(n),this._bodyMeshMap.set(n,a),a._physicsBody=n,a.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};Od.PluginType="CannonPhysics",p1([sn("Enabled",a=>({onChange:()=>{}})),ke()],Od.prototype,"enabled",void 0),p1([ma()],Od.prototype,"stepPhysics",void 0),p1([Bi("Make Root Bodies")],Od.prototype,"makeRootBodies",void 0),Od=d1=p1([Vn("Physics (dev)")],Od);var gU=__webpackgi_require__2(819),vU=__webpackgi_require__2(665);const _U=(a,e,t)=>{var n,i;const s=a.controller_,o=(i=(n=s.parent)==null?void 0:n.children)==null?void 0:i.indexOf(s);return!(((h,d)=>d.controller_.rackController.rack===h.controller_.parent)(a,e)&&o===t||(e.add(a,t),0))},NP=(a,e,t,n)=>{var i;let s=e.uiRef;s!=null&&s.controller_.viewProps.get("disposed")&&(s=void 0);const o=s==null?void 0:s.expanded;if(!s){const y=a.addFolder({title:""});s=y,s.on("fold",w=>{var E,M,P;let L=y.expanded;(0,g.safeSetProperty)(e,"expanded",L,!0),L=(0,g.getOrCall)(e.expanded)??L,L!==y.expanded&&(y.expanded=L),(E=e.uiRefresh)==null||E.call(e,"postFrame",!0,10),L?(M=e.onExpand)==null||M.call(e,e):(P=e.onCollapse)==null||P.call(e,e)})}if(!s)return s;s.expanded=(0,g.getOrCall)(e.expanded)??o??!1;const l=(e.children??[]).map(y=>y&&(0,g.getOrCall)(y)).flat(2).filter(y=>y);let h=0;for(const y of l){if(Array.isArray(y)||typeof y!="object"){console.error("child is not an object",y);continue}let w=y.uiRef;w&&w.controller_.viewProps.get("disposed")&&(y.uiRef=void 0,y.uiRefresh=void 0),w=y.uiRef,w||(t.appendUiObject({uiConfig:y},s),w=y.uiRef),w&&_U(w,s,h++)&&t.appendUiObject({uiConfig:y},s)}let d=s.children;for(;d.length>h;){const y=d[d.length-1];s.remove(y),y.dispose(),d=s.children}s.controller_.props.set("title",(0,g.getOrCall)(e.label)??"");const f=s.controller_.view.containerElement,v=(0,g.getOrCall)(e.domChildren,[]);if((v==null?void 0:v.length)!==void 0){const y=[];for(let w=0;w<f.children.length;w++){const E=f.children[w];(i=E.dataset)!=null&&i.tpCustomDOM&&y.push(E)}for(const w of y)f.removeChild(w);for(const w of v)w.parentElement!==f&&(f.appendChild(w),w.dataset.tpCustomDOM="true");s.controller_.foldable.cleanUpTransition()}return s},yU=(a,e,t,n)=>{const[i,s]=e.property??[void 0,void 0],o=(0,g.getOrCall)(e.label)??s;let l=e.uiRef;return l!=null&&l.controller_.viewProps.get("disposed")&&(l=void 0),l||(l=a.addButton({title:""}),l.on("click",async()=>{const h=[];e.prompt&&h.push(await t.prompt(...e.prompt));const d=(i&&s?i[s]:void 0)??e.value;if(typeof d=="function"){const f=()=>{t.removeEventListener("postFrame",f),d.call(e,...h)};t.addEventListener("postFrame",f)}else console.warn("Invalid action type for button")})),l&&(l.title=(o??"click me")+""),l},AU=(a,e,t,n)=>{const i=Object.fromEntries(((0,g.getOrCall)(e.children)??[]).map(s=>(0,g.getOrCall)(s)).flat(2).filter(s=>s).map(s=>{const o=(0,g.getOrCall)(s.label);return[o,s.value??o]}));return hh(a,e,t,{options:i,...n??{}})},bU=(a,e,t,n)=>{const i=(0,g.getOrCall)(e.bounds),s=((i==null?void 0:i.length)??0)>=2?i[1]:1,o=((i==null?void 0:i.length)??0)>=1?i[0]:0,l=e.stepSize||void 0;return hh(a,e,t,{min:o,max:s,step:l,...n??{}})},f1=(a,e,t,n)=>{const i=(0,g.getOrCall)(e.bounds);if(!i||i.length<1)return hh(a,e,t,{...n??{}});const s=(i.length??0)>=2?i[1]:1,o=(i.length??0)>=1?i[0]:0,l={min:o,max:s,step:e.stepSize??(s-o)/100},h={x:l,y:l};e.type!=="vec3"&&e.type!=="vec4"||(h.z=l),e.type==="vec4"&&(h.w=l);const d=e.property;if(e.value===void 0&&d&&d[0]&&typeof d[0]=="object"&&d[0][d[1]]&&Array.isArray(d[0][d[1]])){const[f,v]=d,y=f[v],w=y.length,E=new(w===2?u.FM8:w===3?u.Pa4:u.Ltg)().fromArray(y);e.value=E,e.property=void 0,e.onChange=[()=>{f[v]=E.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(M=>M),e.label===void 0&&(e.label=v)}return hh(a,e,t,{...h,...n??{}})},xU=(a,e,t,n)=>{var i;const s=e.property;if(e.value===void 0&&s&&typeof s[0]=="object"&&((i=s[0][s[1]])!=null&&i.isColor)){const[o,l]=s,h=u.KI_;Object.defineProperty(e,"value",{get:()=>{const d=o[l];return d?new er(d).getHex(h):0},set:d=>{const f=o[l],v=new er().setHex(d,h);f.isColor?f.copy(v):typeof f=="number"?o[l]=v.getHex():typeof f=="string"&&(o[l]="#"+v.getHexString()),typeof(o==null?void 0:o.setDirty)=="function"&&o.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(d=>d),e.label===void 0&&(e.label=l+"")}return(n=n??{}).view="color",(0,g.getOrCall)(e.inlinePicker)&&(n.picker="inline"),hh(a,e,t,n)},hh=(a,e,t,n)=>{var i;let s=(0,g.getOrCall)(e.property);if((e.getValue||e.setValue)&&s&&console.error("specify either property or value, or getValue and setValue",e),s)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if((Object.hasOwn?Object.hasOwn(e,"value"):e.hasOwnProperty("value"))||e.value!==void 0||!e.getValue&&!e.setValue||(Object.defineProperty(e,"value",{get:()=>{var h;return(h=e.getValue)==null?void 0:h.call(e)},set:h=>{var d;return(d=e.setValue)==null?void 0:d.call(e,h)}}),s=[e,"value"]),s||e.value===void 0||(s=[e,"value"]),!s)return void console.error("cannot determine property",e);n=n??{};const o={label:(0,g.getOrCall)(e.label)??s[1],...n};let l=e.uiRef;if(l!=null&&l.controller_.viewProps.get("disposed")&&(l=void 0),!l&&typeof s[0]=="object"&&s[0]){const[h,d]=s;try{l=e.isMonitor?a.addMonitor(h,d,o):a.addInput(h,d,o).on("change",f=>{[e.onChange].flat().forEach(v=>typeof v=="function"&&(v==null?void 0:v(f))),typeof(h==null?void 0:h.setDirty)=="function"&&h.setDirty(f)})}catch(f){if(!f.message.startsWith("No matching controller for"))throw f;l=void 0}}if(l){for(const[h,d]of Object.entries(o)){const f=l.controller_.props.value(h);f!==void 0&&f.rawValue!==d&&l.controller_.props.set(h,d)}e.type==="slider"&&(o.min!==void 0&&l.controller_.valueController.sliderController.props.set("minValue",o.min),o.max!==void 0&&l.controller_.valueController.sliderController.props.set("maxValue",o.max)),(i=l==null?void 0:l.controller_.valueController.view.inputElement)==null||i.setAttribute("placeholder",(0,g.getOrCall)(e.placeholder)??""),l.refresh()}return l};class FP extends g.SimpleEventDispatcher{constructor(e=!1,t=!1,n=!1,i=!0,s=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:NP,folder:NP,input:hh,number:hh,slider:bU,dropdown:AU,checkbox:hh,color:xU,vec:f1,vec2:f1,vec3:f1,vec4:f1,button:yU,monitor:(l,h,d,f)=>(h.isMonitor=!0,hh(l,h,d,f)),dummy:(l,h,d,f)=>hh(l,h,d,f)},this.alert=async l=>alert(l),this.confirm=async l=>confirm(l),this.prompt=async(l,h,d=!0)=>prompt(l,h),this._expand=e,this._limitedOptions=n;const o=this._createUiContainer();s.appendChild(o),this._pane=new vU.Pane({title:"Configuration",container:o}),this._pane.expanded=this._expand,i&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const t=this._refreshQueue[e],n=[],i=(0,g.now)(),s=i-this._lastModeTime[e];t.forEach(o=>{o[2]>.001?(o[2]-=s,n.push(o)):this._refreshUiObject(o[0],o[1],o[2])}),this._refreshQueue[e]=n,this._lastModeTime[e]=i}addToRefreshQueue(e,t){var n;const i=(n=t[0])==null?void 0:n.uiConfig,s=i==null?void 0:i.uuid,o=this._refreshQueue[e],l=o.find(h=>h[3]===s);l?l[2]=Math.max(l[2],t[2]):o.push([...t,s]),this._refreshQueue[e]=o}dispose(){var e;(e=this._pane)==null||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,t){var n,i;const{uiConfig:s}=e??{};if(s&&(!this._limitedOptions||s.limitedUi)&&(t=t??this._pane,s.type)){s.uuid||(s.uuid=Ys()),s.uiRef&&s.uiRefType!==s.type&&this.removeUiConfig(s);const o=(i=(n=this._typeGenerators)[s.type])==null?void 0:i.call(n,t,s,this);o&&(o.hidden=(0,g.getOrCall)(s.hidden)??!1,o.disabled=(0,g.getOrCall)(s.disabled)??!1),s.uiRef=o,s.uiRefType=o?s.type:void 0,s.uiRefresh=(l="postFrame",h=!1,d=0)=>this._uiObjectRefresh(l,(e==null?void 0:e.uiConfig)??s,t,h,d),o==null||o.controller_.viewProps.handleDispose(()=>{s.uiRef=void 0,s.uiRefType=void 0,s.uiRefresh=void 0})}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var t,n;e&&e.uiRef&&((n=(t=e.uiRef).dispose)==null||n.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,n,i,s){(i?m1(t,n):[{uiConfig:t,parentFolder:n}]).forEach(o=>{const l=[{uiConfig:o.uiConfig},o.parentFolder,s];e==="immediate"?this._refreshUiObject(...l):this.addToRefreshQueue(e,l)})}_refreshUiObject(e,t,n=0){this._appendUiObject(e,t),n>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,g.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,g.createStyles)(g.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function m1(a,e,t){return t=t??[],a&&a.uiRef&&(t.push({uiConfig:a,parentFolder:e}),[...a.children||[]].forEach(n=>{typeof n!="function"&&n&&(Array.isArray(n)?n.forEach(i=>t=m1(i,a.uiRef,t)):t=m1(n,a.uiRef,t))})),t}class zP{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const n=t.slice(0);for(let i=0,s=n.length;i<s;i++)n[i].call(this,e);e.target=null}}}function jP(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}const VP={};function pM(a){a in VP||(VP[a]=!0,console.warn(a))}let D0;class wU{static getDataURL(e,t=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{D0===void 0&&(D0=jP("canvas")),D0.width=e.width,D0.height=e.height;const i=D0.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=D0}return!t&&(n.width>2048||n.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=jP("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=255*lr(s[o]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(255*lr(t[n]/255)):t[n]=lr(t[n]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class EU{constructor(e=null){this.isSource=!0,this.uuid=Pe(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,l=i.length;o<l;o++)i[o].isDataTexture?s.push(fM(i[o].image)):s.push(fM(i[o]))}else s=fM(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function fM(a){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap)return wU.getDataURL(a);if(a.data){let e=[];try{e=Array.from(a.data)}catch(t){t.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(t),e=a.data}return{data:e,width:a.width,height:a.height,type:a.data.constructor.name}}return a.url!==void 0?a.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let SU=0;class Dm extends zP{constructor(e=Dm.DEFAULT_IMAGE,t=Dm.DEFAULT_MAPPING,n=1001,i=1001,s=Sr,o=1008,l=1023,h=1009,d=Dm.DEFAULT_ANISOTROPY,f=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:SU++}),this.uuid=Pe(),this.name="",this.source=new EU(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=d,this.format=l,this.internalFormat=null,this.type=h,this.offset=new je(0,0),this.repeat=new je(1,1),this.center=new je(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Mr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof f=="string"?this.colorSpace=f:(pM("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=f===Dr?_r:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===_r?Dr:3e3,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return pM("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===_r?Dr:3e3}set encoding(e){pM("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Dr?_r:""}}Dm.DEFAULT_IMAGE=null,Dm.DEFAULT_MAPPING=300,Dm.DEFAULT_ANISOTROPY=1;var g1=__webpackgi_require__2(898),QA={};g1.Z&&g1.Z.locals&&(QA.locals=g1.Z.locals);var mM,gM=0,_v={};_v.styleTagTransform=um(),_v.setAttributes=cm(),_v.insert=function(a,e){(e.target||document.head).appendChild(a)},_v.domAPI=lm(),_v.insertStyleElement=sd(),QA.use=function(a){return _v.options=a||{},gM++||(mM=om()(g1.Z,_v)),QA},QA.unuse=function(){gM>0&&!--gM&&(mM(),mM=null)};var MU=QA;class v1 extends FP{constructor(e=!1,t=!1,n=!1,i=document.body){super(e,t,n,!1),this.dependencies=[Yt],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=s=>{this.dispatchEvent(s),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async s=>this._viewer?this._viewer.alert(s):super.alert(s),this.confirm=async s=>this._viewer?this._viewer.confirm(s):super.confirm(s),this.prompt=async(s,o,l=!0)=>this._viewer?this._viewer.prompt(s,o,l):super.prompt(s,o,l),this._pane.registerPlugin(gU),MU.use({target:i})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(t=>(n,i,s,o)=>{let l=i.property||i.__property;const h="placeholder";if(i.value===void 0&&(i.getValue||i.setValue)&&(Object.defineProperty(i,"_value",{get:()=>{var d;return(d=i.getValue)==null?void 0:d.call(i)},set:d=>{var f;return(f=i.setValue)==null?void 0:f.call(i,d)}}),l=[i,"_value"]),(!(Object.hasOwn?Object.hasOwn(i,"value"):i.hasOwnProperty("value"))||i.value===void 0)&&l&&typeof l[0]=="object"){const[d,f]=l,v=(0,g.makeTextSvg)("Render Target"),y=(0,g.makeTextSvg)("Data Texture"),w=(0,g.makeTextSvg)("CUBE Texture"),E=(0,g.makeTextSvg)("Compressed Texture"),M={},P={};Object.defineProperty(i,"value",{get:()=>{let L,R=d[f];if(R!=null&&R.get&&(R=R.get()),!R)return h;if(R.isCompressedTexture&&!R.image.tp_src&&(R.image.tp_src=E),R.isTexture?(R.image&&!R.image.tp_src&&(R.image instanceof ImageBitmap||R.image instanceof HTMLImageElement||R.image instanceof HTMLVideoElement)?R.image.tp_src=(0,g.imageBitmapToBase64)(R.image,160):R.image&&R.isRenderTargetTexture&&!R.image.tp_src?R.__target&&(R.image.tp_src=t.renderer.renderTargetToDataUrl(R.__target)):R.image&&!R.image.tp_src&&(R.image.tp_src=vh(R,160,!1).toDataURL("image/png",90)),R.isRenderTargetTexture&&!R.image.tp_src&&(R.image.tp_src=v),R.isDataTexture&&!R.image.tp_src&&(R.image.tp_src=y),R.image&&(L=R.image.tp_src_uuid,L=L?M[L]:void 0,L||(L=R.image.tp_src||R.image.src))):typeof R=="string"?L=R:R.domainMin?(L=R.texture,R.texture.image&&!R.texture.image.tp_src&&(R.texture.image.tp_src=w),R.texture.image&&(L=R.texture.image.tp_src_uuid,L=L?M[L]:void 0,L||(L=R.texture.image.tp_src||R.texture.image.src))):R&&console.error("unknown value",R),L||(L=h),R.image&&!R.image.tp_src_uuid){const I=Ys();R.image.tp_src_uuid=I,P[L]=I}return typeof L=="string"&&(L=M[L]??L),L},set:L=>{var R,I,N,j,H,X,ne,pe,Ae;const ve=d[f],Ee=we=>{d[f]=we,we!=null&&we.isTexture&&(we.flipY=we.isDataTexture?we.flipY:(ve==null?void 0:ve.flipY)??!0)};if(typeof L=="string")return void(typeof ve=="string"&&Ee(L));if(!L)return void(i.value=h);if(L.isPlaceholder)return void(ve&&(Ee(typeof ve=="string"?"":null),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty()));let xe=L.tp_src_uuid;if(xe||(xe=L.src??L.tp_src,xe=P[xe]??xe,delete P[xe],L.tp_src_uuid=xe),xe&&(M[xe]=L),typeof ve!="string"){if(!((ve==null?void 0:ve.image)===L||((R=ve==null?void 0:ve.image)==null?void 0:R.src)===L.src||((I=ve==null?void 0:ve.image)==null?void 0:I.tp_src)===L.tp_src&&L.tp_src!=null||((N=ve==null?void 0:ve.image)==null?void 0:N.tp_src)===L.src&&L.src!=null||((j=ve==null?void 0:ve.image)==null?void 0:j.src)===L.tp_src&&L.tp_src!=null))if(L instanceof File){const we=t==null?void 0:t.getPlugin(Yt);if(!we)throw"Viewer or AssetManagerPlugin not found";(H=we.importer)==null||H.importSingle({file:L,path:L.src}).then(Re=>{var Be,Oe,at,st;if(Re){Re.isDataTexture&&(Re.needsUpdate=!0);const St=(at=(Oe=(Be=L.src)==null?void 0:Be.split("?"))==null?void 0:Oe[0])==null?void 0:at.split(".").pop();Re.userData&&(Re.userData.mimeType||(Re.userData.mimeType="image/"+(["jpg","jpeg"].includes(St)?"jpeg":"png"))),Ee(Re),[i.onChange].flat().forEach(dt=>typeof dt=="function"&&(dt==null?void 0:dt())),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty(),(st=i.uiRefresh)==null||st.call(i,"postFrame",!1)}})}else{const we=new Dm(L);we.assetType="texture",we.needsUpdate=!0;const Re=(pe=(ne=(X=L.src)==null?void 0:X.split("?"))==null?void 0:ne[0])==null?void 0:pe.split(".").pop();we.userData.mimeType||(we.userData.mimeType="image/"+(["jpg","jpeg"].includes(Re)?"jpeg":"png"));const Be=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(f);we.colorSpace=Be?u.GUF:u.KI_,we.wrapS=u.rpg,we.wrapT=u.rpg,Ee(we),[i.onChange].flat().forEach(Oe=>typeof Oe=="function"&&(Oe==null?void 0:Oe())),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty(),(Ae=i.uiRefresh)==null||Ae.call(i,"postFrame",!1)}}else Ee(xe)}}),i.__property=i.property,i.property=void 0,i.label===void 0&&(i.label=f)}return(o=o??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],o.imageFit===void 0&&(o.imageFit="contain"),o.clickCallback===void 0&&(o.clickCallback=(d,f)=>{var v;const y=d==null?void 0:d.target,w=y==null?void 0:y.getBoundingClientRect();if(!w)return void f.click();const E=i.uiRef.controller_.valueController.value.rawValue,M=E===h||E!=null&&E.isPlaceholder?{}:{"remove image":()=>{var L;i.uiRef.controller_.valueController.value.setRawValue("");const[R,I]=i.property||i.__property||[i,"value"],N=typeof R[I]=="string";R[I]=N?"":null,[i.onChange].flat().forEach(j=>typeof j=="function"&&(j==null?void 0:j())),typeof(R==null?void 0:R.setDirty)=="function"&&R.setDirty(),(L=i.uiRefresh)==null||L.call(i,"postFrame",!1),fl.Remove()},"download image":async()=>{fl.Remove();const[L,R]=i.property||i.__property||[i,"value"],I=L[R];if(!I)return;const N=(I==null?void 0:I.image)??i.uiRef.controller_.valueController.value.rawValue;let j=I.__rootBlob?I.__rootBlob.objectUrl||URL.createObjectURL(I.__rootBlob):I.userData.rootPath||(N==null?void 0:N.src);N&&(N instanceof ImageBitmap||N instanceof HTMLImageElement||N instanceof HTMLVideoElement)&&!j&&(j=(0,g.imageBitmapToBase64)(N));let H=I.__rootBlob?I.__rootBlob.name||"image."+(I.__rootBlob.ext||"png"):null;if(!j&&I.isRenderTargetTexture){const ne=I.__target;if(I.type===u.ywz)j=t.renderer.renderTargetToDataUrl(ne,"image/png",90),H="renderTarget.png";else{const pe=new Nx().parse(t.renderer.rendererObject,ne),Ae=new Blob([pe],{type:"image/x-exr"});if(!Ae)return void console.error("cannot export render target",N,L[R],L,R,i);H="renderTarget.exr",j=URL.createObjectURL(Ae)}}if(!j&&I.isDataTexture){const ne=new Nx().parse(void 0,I),pe=new Blob([ne],{type:"image/x-exr"});if(!pe)return void console.error("cannot export data texture",N,L[R],L,R,i);H="dataTexture.exr",j=URL.createObjectURL(pe)}if(!j)return void console.error("cannot export image",N,L[R],L,R,i);const X=document.createElement("a");document.body.appendChild(X),X.style.display="none",X.href=j,X.download=H||(j.startsWith("data:")?"image.png":j.split("/").pop()??"image.png"),X.target="_blank",X.click(),document.body.removeChild(X)}},P=fl.Create({...M,"set/replace image":()=>{f.click(),fl.Remove()},"from url":async()=>{var L,R;let I="";if(I=await s.prompt("Load texture: Enter Image/Texture URL",I,!0),!I||!I.startsWith("http")&&!I.startsWith("data:image"))return I!==null&&await s.alert("Loading Image: Invalid URL"),void fl.Remove();I=I.trim();const[N,j]=i.property||i.__property||[i,"value"],H=N[j];if(typeof H=="string")N[j]=I,[i.onChange].flat().forEach(X=>typeof X=="function"&&(X==null?void 0:X())),typeof(N==null?void 0:N.setDirty)=="function"&&N.setDirty(),(L=i.uiRefresh)==null||L.call(i,"postFrame",!1);else{const X=t==null?void 0:t.getPlugin(Yt);if(!X)throw"Viewer or AssetManagerPlugin not found";(R=X.importer)==null||R.importSinglePath(I).then(ne=>{var pe;if(ne){ne.isDataTexture?ne.needsUpdate=!0:ne&&(H==null?void 0:H.flipY)!==void 0&&(ne.flipY=H.flipY);const Ae=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(j);ne.colorSpace=Ae?u.GUF:u.KI_,N[j]=ne,[i.onChange].flat().forEach(ve=>typeof ve=="function"&&(ve==null?void 0:ve())),typeof(N==null?void 0:N.setDirty)=="function"&&N.setDirty(),(pe=i.uiRefresh)==null||pe.call(i,"postFrame",!1)}else console.warn("Failed to load texture",I)})}fl.Remove()},cancel:()=>{fl.Remove()}},2,w.height+8);(v=y.parentElement)==null||v.appendChild(P),w.y>.7*document.body.clientHeight&&(P.style.top="auto",P.style.bottom=w.height+8+"px")}),o.view="input-image",hh(n,i,s,o)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var t;const n=(t=this._viewer)==null?void 0:t.getPlugin(e);if(!n)return void console.warn("plugin not found:",e);this._plugins.push(n),n.uiConfig&&(n.uiConfig.limitedUi=!0),n.uiConfig&&n.uiConfig.hidden===void 0&&(n.uiConfig.hidden=!1),this._appendUiObject(n);const i=n.uiConfig;if(i!=null&&i.uiRef&&n.toJSON){const s=typeof n.toJSON=="function"?n.toJSON():null;n.resetDefaults=async()=>{var h,d;await((h=n.fromJSON)==null?void 0:h.call(n,s)),(d=i.uiRefresh)==null||d.call(i,"postFrame",!0)};const o=i.uiRef.controller_.view.element,l=(0,g.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});l.onclick=h=>{const d={};typeof n.toJSON=="function"&&(d["download preset"]=async()=>{var v,y;const w=(y=(v=this._viewer)==null?void 0:v.getPlugin(Yt))==null?void 0:y.exportPluginPreset(n);await(0,g.downloadBlob)(new Blob([JSON.stringify(w,null,2)],{type:"application/json"}),"preset."+n.constructor.PluginType+".json"),fl.Remove()}),typeof n.fromJSON=="function"&&(d["upload preset"]=async()=>{var v,y,w;fl.Remove();const E=await(0,g.uploadFile)(!1,!1);if(E.length===0)return;const M=E[0],P=await M.text(),L=JSON.parse(P);await((y=(v=this._viewer)==null?void 0:v.getPlugin(Yt))==null?void 0:y.importPluginPreset(L,n)),(w=i.uiRefresh)==null||w.call(i,"postFrame",!0)},s&&(d["reset defaults"]=async()=>{var v;fl.Remove(),await((v=n.resetDefaults)==null?void 0:v.call(n))}));const f=fl.Create(d,o.clientWidth-120,12);o.append(f),h.preventDefault()},o.appendChild(l)}return i}setupPlugins(...e){e.forEach(t=>this.setupPluginUi(t))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var t;const n=e.uiConfig;n&&((0,g.getOrCall)(n.hidden)!==!0?(t=n.uiRefresh)==null||t.call(n,"postFrame",!0):n.uiRef&&(n.uiRef.hidden=!0))})}}v1.PluginType="TweakpaneUi";class WA extends Sn{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.scene.backgroundIntensity)??1},setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0},{type:"checkbox",label:"Fixed Env Direction",property:[this,"sceneEnvironmentFixedDirection"]},{type:"checkbox",label:"Artistic Lighting",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.renderer.useLegacyLights)??!0},setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){var e,t;const n=(t=(e=this._viewer)==null?void 0:e.scene.backgroundColor)==null?void 0:t.getHex(u.KI_);return n!==void 0&&(this._savedBg=!0),n||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new er),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){var e;const t=(e=this._viewer)==null?void 0:e.scene.background;return t&&(t.isTexture||t.assetType==="texture")?t:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get sceneEnvironment(){var e;return((e=this._viewer)==null?void 0:e.scene.environment)||null}set sceneEnvironment(e){this._viewer&&(this._viewer.scene.environment=e)}get sceneEnvironmentRotation(){var e,t;return((t=(e=this._viewer)==null?void 0:e.scene.environment)==null?void 0:t.rotation)??0}set sceneEnvironmentRotation(e){var t,n;const i=(t=this._viewer)==null?void 0:t.scene.environment;i&&(i.rotation=e,(n=this._viewer)==null||n.scene.setDirty())}get sceneEnvironmentIntensity(){var e;return((e=this._viewer)==null?void 0:e.scene.envMapIntensity)??1}set sceneEnvironmentIntensity(e){var t;(t=this._viewer)!=null&&t.scene&&(this._viewer.scene.envMapIntensity=e)}get sceneEnvironmentFixedDirection(){var e;return((e=this._viewer)==null?void 0:e.scene.fixedEnvMapDirection)??!1}set sceneEnvironmentFixedDirection(e){var t;(t=this._viewer)!=null&&t.scene&&(this._viewer.scene.fixedEnvMapDirection=e)}get envmapBg(){var e,t,n;return((e=this._viewer)==null?void 0:e.scene.background)==="environment"||((t=this._viewer)==null?void 0:t.scene.background)===((n=this._viewer)==null?void 0:n.scene.environment)}set envmapBg(e){if(this._viewer)if(e){const t=this._viewer.scene.background;t&&t!==this._viewer.scene.environment&&t!=="environment"&&(this.lastBgVal=t),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",()=>{var t,n;(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}),e.scene.addEventListener("environmentChanged",()=>{var t,n;(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)})}}WA.PluginType="SimpleBackgroundEnvUiPlugin1";class qA extends Sn{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,t;(t=(e=this._uiConfig).uiRefresh)==null||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)==null||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var e,t;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...((t=(e=this._viewer)==null?void 0:e.scene.modelRoot.modelObject.children)==null?void 0:t.map(n=>n.assetType==="light"?null:n.uiConfig).filter(n=>n!=null))??[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,t;(t=(e=this._uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}}qA.PluginType="SimpleUi";var CU=__webpackgi_require__2(1),TU=__webpackgi_require__2.n(CU)();class XA extends Sn{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,g.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(t,n)=>(t.push({text:n.name||"unnamed",id:n.uuid,children:n.children.reduce(this._buildData,[])}),t),this._findVisible=(t,n)=>(n.visible&&(n.children.length<1?t.push(n.uuid):t.push(...n.children.reduce(this._findVisible,[]))),t),this._setVisible=t=>{var n;(n=this._viewer)==null||n.doOnce("postFrame",()=>{var i,s,o;const l=(i=this._viewer)==null?void 0:i.scene.modelRoot;if(!l||t==null)return;const h=new Set;l.traverse(d=>{d!==l&&(d.visible=t.includes(d.uuid),d.visible&&d.traverseAncestors(f=>h.add(f)))}),h.forEach(d=>d.visible=!0),(o=(s=this._viewer)==null?void 0:s.scene)==null||o.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=e,this.reset=this.reset.bind(this),(0,g.createStyles)(g.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var t;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const n=(t=this._viewer)==null?void 0:t.scene.modelRoot;if(!n)return;const i=n.children.reduce(this._buildData,[]),s=n.children.reduce(this._findVisible,[]);let o=!1;return new Promise((l,h)=>{this.treeView=new TU(this.hierarchyDiv,{closeDepth:1,data:i,loaded:function(){this.values=s,l()},onChange:()=>{o?(0,g.timeout)(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):o=!0},onItemLabelClick:d=>{var f;const v=(f=this._viewer)==null?void 0:f.scene.modelRoot.modelObject.getObjectByProperty("uuid",d);v&&n.visible&&v.dispatchEvent({type:"select",value:v,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}XA.PluginType="HierarchyUiPlugin";class YA extends Sn{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new il;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const e=new Jd;e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const e=new Th;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const e=new Kd;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,e.lookAt(0,0,0),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Yt],this._sceneUpdate=e=>{var t,n,i;if(!e.hierarchyChanged)return;const s=[];(t=this._viewer)==null||t.traverseSceneObjects(o=>{if(!o.lightObject)return;const l=o.uiConfig;l&&!s.includes(l)&&s.push(l)}),[...this.uiConfig.children].forEach(o=>{(o==null?void 0:o.type)==="button"||s.includes(o)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(o),1)}),s.forEach(o=>{this.uiConfig.children.includes(o)||this.uiConfig.children.push(o)}),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}YA.PluginType="SimpleLightsUi";class KA extends Sn{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",value:()=>{var e;if(!this._viewer)return;const t=this._viewer.createCamera(new u.cPb(45,1,.5,20));this._viewer.scene.modelRoot.add(t.cameraObject),t.setCameraOptions({controlsMode:"orbit"}),t.position.set(2,2,2),t.target.set(0,0,0),t.positionUpdated(!0),t.cameraObject.lookAt(0,0,0),t.setDirty();const n=this._viewer.getPluginByType("VirtualCamerasPlugin");if(n){const i=n.addCamera(t),s=(e=this._viewer)==null?void 0:e.getPluginByType("debug");s&&s.addTexture("camera frame",()=>i.target.texture,[40,310,300,200])}}}],limitedUi:!0},this.dependencies=[Yt],this._sceneUpdate=e=>{var t,n,i;if(!e.hierarchyChanged)return;const s=[];(t=this._viewer)==null||t.traverseSceneObjects(o=>{if(!o.cameraObject)return;const l=o.uiConfig;l&&!s.includes(l)&&s.push(l)}),[...this.uiConfig.children].forEach(o=>{(o==null?void 0:o.type)==="button"||s.includes(o)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(o),1)}),s.forEach(o=>{this.uiConfig.children.includes(o)||this.uiConfig.children.push(o)}),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}KA.PluginType="SimpleSceneCamerasUi";var ef,B0=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Bc=ef=class extends Sn{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(a=!0){if(!this._viewer)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const e={width:Math.floor(this.width),height:Math.floor(this.height)},t=this._viewer.container.getBoundingClientRect(),n={width:Math.floor(t.width),height:Math.floor(t.height)};let i=1;if(e.width>n.width){const s=e.width;e.width=n.width;const o=e.width/s;if(e.height=Math.floor(e.height*o),i/=o,i>ef.MaxCanvasScale)return this.width=n.width*ef.MaxCanvasScale,console.log("loop",this.width,n.width,i),void this._sizeChanged()}if(e.height>n.height){const s=e.height;e.height=n.height;const o=e.height/s;if(e.width=Math.floor(e.width*o),i/=o,i>ef.MaxCanvasScale)return this.height=n.height*ef.MaxCanvasScale,console.log("loop",this.width,n.width,this.height,n.height,i),void this._sizeChanged()}(e.width>=n.width||e.width<1)&&delete e.width,(e.height>=n.height||e.height<1)&&delete e.height,this._viewer.setSize(e),this._setScale(i),a&&(this.scale=i),this._refresh()}_setScale(a){this._viewer&&(this._viewer.renderer.displayCanvasScaling=a)}_scaleChanged(){if(!this._viewer)return;const a=this.scale;if(Math.abs(a-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const e=this.width/this.height,t=this._viewer.container.getBoundingClientRect(),n=Math.floor(t.width*a),i=Math.floor(n/e);this.width=n,this.height=i,this._sizeChanged(!1)}async onAdded(a){await super.onAdded(a);const e=a.canvas.clientWidth,t=a.canvas.clientHeight,n=a.renderer.displayCanvasScaling;this.width=e,this.height=t,this.scale=n,a.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",()=>this._sizeChanged(!0)),this._refresh()}async onRemove(a){return a.renderer.removeEventListener("resize",this._refresh),super.onRemove(a)}_refresh(){var a,e;(e=(a=this.uiConfig)==null?void 0:a.uiRefresh)==null||e.call(a,"postFrame",!0)}fromJSON(a,e){if(!a.mode)if(a.width||a.height){const t=this._viewer.container.getBoundingClientRect();a.width||(a.width=t.width),a.height||(a.height=t.height),a.scale&&(a.width*=a.scale,a.height*=a.scale,delete a.scale),a.width=Math.round(a.width),a.height=Math.round(a.height),a.mode="custom"}else a.mode="full";return super.fromJSON(a,e)}toJSON(a){const e=super.toJSON(a);return e.mode==="full"&&(delete e.width,delete e.height),e.mode==="custom"&&delete e.scale,e}};Bc.PluginType="RendererParamsUiPlugin",Bc.MaxCanvasScale=5,B0([ke("version")],Bc.prototype,"_serializeVersion",void 0),B0([ke(),Eo("Mode",["full","custom"].map(a=>({label:a}))),(0,g.onChange2)(ef.prototype._sizeChanged)],Bc.prototype,"mode",void 0),B0([ke(),gn("Width",void 0,1,a=>({onChange:()=>a._sizeChanged(),hidden:()=>a.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=a._viewer)==null?void 0:e.container.getBoundingClientRect().width)||1024)+2))]}}))],Bc.prototype,"width",void 0),B0([ke(),gn("Height",void 0,1,a=>({onChange:()=>a._sizeChanged(),hidden:()=>a.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=a._viewer)==null?void 0:e.container.getBoundingClientRect().height)||1024)+2))]}}))],Bc.prototype,"height",void 0),B0([ke(),(0,g.onChange)(ef.prototype._scaleChanged),gn("Scale",[.25,ef.MaxCanvasScale],.001,a=>({disabled:()=>a.mode==="custom"}))],Bc.prototype,"scale",void 0),Bc=ef=B0([Vn("Renderer")],Bc);class JA extends Sn{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){var t;const n=super.toJSON(e);return n.activeCamera=(t=this._viewer)==null?void 0:t.scene.activeCamera.toJSON(),n}fromJSON(e,t){var n;return e.activeCamera&&((n=this._viewer)==null||n.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)==null?void 0:e.scene.activeCamera.uiConfig)||{}}}JA.PluginType="CameraUiPlugin";var IU={create:a=>{let e="button"+(a.type?" "+a.type:""),t=di.createDiv(e,a.text);return t.addEventListener("click",a.onClick),t}};let Al={createElement:(a,e,t,n)=>{let i=document.createElement(a);if(e&&(i.className=e),t&&(i.innerHTML=t),n)for(let s in n)i.setAttribute(s,n[s]);return i},createDiv:(a,e,t)=>Al.createElement("div",a,e,t),createDomTree:a=>{if(!a||!a.hasOwnProperty("dom"))return a;let e=a.dom;if(a.children)for(let t in a.children)a.children[t]&&e.appendChild(Al.createDomTree(a.children[t]));return e},removeElement:a=>{a!=null&&a.parentNode.removeChild(a)},appendToBody:a=>{document.body.appendChild(a)},makeIconHTML:a=>{let e="";return a=="ok"&&(e="#tick"),a=="error"&&(e="#cancel"),a=="info"&&(e="#info-button"),a=="caution"&&(e="#danger"),a=="min"&&(e="#line"),a=="close"&&(e="#close"),`<svg class="icon ${a}"><use xlink:href="${e}" /></svg>`},makeNftContent:a=>{let e=null;if(a.type){let t=null;t=typeof a.content=="string"?Al.createDiv("inner-content",a.content):Al.createDomTree({dom:Al.createDiv("inner-content"),children:[a.content]}),e=a.type=="text"?Al.createDomTree({dom:Al.createDiv("content text"),children:[t]}):Al.createDomTree({dom:Al.createDiv("content"),children:[Al.createDiv("state",Al.makeIconHTML(a.type)),t]})}else typeof a.content=="string"&&(e=Al.createDiv("content",a.content));return e},standardizeButtons:(a,e)=>{let t=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||t.push({key:27,text:"Cancel",onClick:a.close.bind(a,"cancel")}),t.push({key:13,text:"OK",type:"main",onClick:a.close.bind(a,"ok")}),t;t=e.buttons,t.constructor!==Array&&(t=[t]);for(let n in t)!t[n].onClick&&(t[n].onClick=a.close.bind(a,t[n].id));return t},makeButtons:a=>{let e=[];if(a)for(let t in a)e.push(IU.create({text:a[t].text?a[t].text:"OK",type:a[t].normal?null:"main",onClick:a[t].onClick}));return Al.createDomTree({dom:Al.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:a=>{let e=t=>{for(let n in a)if(a[n].key===t.keyCode)return void a[n].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:a=>{window.removeEventListener("keydown",a)}};var di=Al,Ws=__webpackgi_require__2(476),_o={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let dh={};dh.overlay_in=[new Ws.Frame(_o["wwise-overlay-in-1"],0),new Ws.Frame(_o["wwise-overlay-in-2"],400)],dh.overlay_out=[new Ws.Frame(_o["wwise-overlay-out-1"],300)],dh.pop_in=[new Ws.Frame(_o["wwise-pop-in-1"],0),new Ws.Frame(_o["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new Ws.Frame(_o["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new Ws.Frame(_o["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],dh.pop_out=[new Ws.Frame(_o["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],dh.flip_in=[new Ws.Frame(_o["wwise-flip-in-1"],0),new Ws.Frame(_o["wwise-flip-in-2"],500)],dh.flip_out=[new Ws.Frame(_o["wwise-flip-out-1"],400)],dh.min_in=[new Ws.Frame(_o["wwise-min-in-1"],0),new Ws.Frame(_o["wwise-min-in-2"],350)],dh.min_out=[new Ws.Frame(_o["wwise-min-out-1"],400)];let GP=["top","bottom","left","right"];for(let a in GP){let e=GP[a];dh[e+"_in"]=[new Ws.Frame(_o["wwise-"+e+"-in-1"],0),new Ws.Frame(_o["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],dh[e+"_out"]=[new Ws.Frame(_o["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var _1=dh;let PU={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class vM{static create(e,t){let n=e.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let i=e.getElementsByClassName("content")[0];return i&&(i=i.innerHTML),di.removeElement(e),t.title=n,t.content=i,new vM(t)}constructor(e){this.options=JSON.parse(JSON.stringify(PU));for(let h in e)e[h]!=null&&(this.options[h]=e[h]);let t=this.options.position;if(t.indexOf(" ")==-1&&(t=="left"||t=="right"?t+=" center":t=t=="top"||t=="bottom"?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let h=document.getElementsByClassName("wwise-overlay");h.length?(this.overlay=h[0],this.hasOverlay=!0):(this.overlay=di.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let h=[];this.options.topbar.showMin&&(h.push(di.createDiv(null,di.makeIconHTML("min"))),h[h.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(h.push(di.createDiv(null,di.makeIconHTML("close"))),h[h.length-1].addEventListener("click",this.close.bind(this,void 0)));let d=null;d=typeof this.options.title=="string"?di.createDiv("title",this.options.title):di.createDomTree({dom:di.createDiv("title"),children:[this.options.title]}),this.topbar=di.createDomTree({dom:di.createDiv("topbar"),children:[{dom:di.createDiv("control"),children:h.map(f=>({dom:f}))},{dom:d},{dom:di.createDiv("clear")}]})}else n+=" no-topbar";typeof this.options.content=="string"?this.content=di.createDomTree({dom:di.createDiv(n,this.options.content)}):this.content=di.createDomTree({dom:di.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=di.createDomTree({dom:di.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let i=di.createDiv("wwise-wrapper");this.options.zIndex&&(i.style.zIndex=this.options.zIndex),this.wrapper=di.createDomTree({dom:i,children:[this.window]}),this.dom=di.createDomTree({dom:di.createDiv(),children:[this.wrapper]});let s=this.options.position.split(" "),o=-50,l=-50;if(s[0]=="left"?(o=0,this.wrapper.classList.add("left")):s[0]=="right"?(o=-100,this.wrapper.classList.add("right")):s[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=s[0],s[1]=="top"?(l=0,this.wrapper.classList.add("top")):s[1]=="bottom"?(l=-100,this.wrapper.classList.add("bottom")):s[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${o}%, ${l}%)`,this.options.style)for(let h in this.options.style)this.window.style[h]=this.options.style[h];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(n=>{this.promiseResolve=n}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new Ws.Queue(this.wrapper,_1[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&n.push(new Ws.Queue(this.overlay,_1.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new Ws.Queue(this.wrapper,_1[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&n.push(new Ws.Queue(this.overlay,_1.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(di.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),di.appendToBody(this.dom)}removeDoms(){di.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(di.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),i=this.options.draggable,s=parseFloat(n.left),o=parseFloat(n.top);if(n.left.indexOf("%")!=-1){s=n.left,s=s.substr(0,s.length-1),s=parseInt(s);let l=window,h=document,d=h.documentElement,f=h.getElementsByTagName("body")[0];s=s*(l.innerWidth||d.clientWidth||f.clientWidth)/100}if(n.top.indexOf("%")!=-1){o=n.top,o=o.substr(0,o.length-1),o=parseInt(o);let l=window,h=document,d=h.documentElement,f=h.getElementsByTagName("body")[0];o=o*(l.innerHeight||d.clientHeight||f.clientHeight)/100}i!=1&&i!="horizontal"||(this.wrapper.style.left=s+t.x+"px"),i!=1&&i!="vertical"||(this.wrapper.style.top=o+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&t.nodeName!="HTML"||(this.inDragging=!1)}}var RU=vM,_M=class{constructor(a){let e=this.options=a;!e.type&&(e.type="ok");let t={topbar:!1};t.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),t.overlay=!0,t.keepOverlay=e.keepOverlay,t.clickOverlayToClose=!1,t.animation=e.animation,t.zIndex=e.zIndex,this.wwise=new RU(t)}constructContent(a){let e=di.createDiv("modal"),t=di.createDomTree({dom:di.createDiv("main "+a.type),children:[di.createDiv(null,di.makeIconHTML(a.type)),di.createDiv("title",a.title),di.createDiv("text",a.text)]});this.buttonArr=di.standardizeButtons(this,a);let n=di.makeButtons(this.buttonArr),i=null;a.content&&(i=typeof a.content=="string"?di.createDiv(null,a.content):a.content);let s=null;return n.innerHTML&&(s=di.createDomTree({dom:di.createDiv("operation "+a.type),children:[n]})),i||s||t.classList.add("no-op"),di.createDomTree({dom:e,children:[t,i,s]})}open(){if(this.wwise.opened)return;let a=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=di.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),a}close(a){if(this.wwise.opened)return this.value=a,di.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let DU={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},BU={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var y1=__webpackgi_require__2(513),ZA={};y1.Z&&y1.Z.locals&&(ZA.locals=y1.Z.locals);var yM,AM=0,yv={};yv.styleTagTransform=um(),yv.setAttributes=cm(),yv.insert=function(a,e){(e.target||document.head).appendChild(a)},yv.domAPI=lm(),yv.insertStyleElement=sd(),ZA.use=function(a){return yv.options=a||{},AM++||(yM=om()(y1.Z,yv)),ZA},ZA.unuse=function(){AM>0&&!--AM&&(yM(),yM=null)};var LU=ZA;class bM extends Sn{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},di.appendToBody=t=>{e.container.appendChild(t)},di.makeIconHTML=t=>"",LU.use({target:e.container}),e.alert=async t=>{const n=t==null?void 0:t.split(":")[0],i=new _M({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return i.open(),i.getPromise()},e.confirm=async t=>{const n=t==null?void 0:t.split(":")[0],i=new _M({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return i.open(),await i.getPromise()==="yes"},e.prompt=async(t,n,i=!0)=>{const s=t==null?void 0:t.split(":")[0],o=new class{constructor(l){this.options=JSON.parse(JSON.stringify(DU));for(let v in l)l[v]!=null&&(this.options[v]=l[v]);let h=this.options,d=JSON.parse(JSON.stringify(BU));for(let v in d)h.hasOwnProperty(v)&&(d[v]=h[v]);let f=[];h.showCancel&&f.push({key:27,text:h.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),f.push({key:13,text:h.okText,onClick:this.handleOk.bind(this)}),d.buttons=f,this.input=di.createElement("input","input",null,{placeholder:h.placeholder}),this.error=di.createDiv("error"),d.content=di.createDomTree({dom:di.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new _M(d)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},l=>{this.error.innerText=l}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let l=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((h,d)=>{this.promiseResolve=h,this.promiseReject=d}),l}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:s??"&ndsp;",placeholder:n??"",showCancel:i,animation:"overlay",text:(t==null?void 0:t.replace(s||"","").replace(":",""))||""});return o.open(),await o.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}bM.PluginType="WindowiseDialogPlugin";var A1=__webpackgi_require__2(729),$A={};A1.Z&&A1.Z.locals&&($A.locals=A1.Z.locals);var xM,wM=0,Av={};Av.styleTagTransform=um(),Av.setAttributes=cm(),Av.insert=function(a,e){(e.target||document.head).appendChild(a)},Av.domAPI=lm(),Av.insertStyleElement=sd(),$A.use=function(a){return Av.options=a||{},wM++||(xM=om()(A1.Z,Av)),$A},$A.unuse=function(){wM>0&&!--wM&&(xM(),xM=null)};var OU=$A,b1=__webpackgi_require__2(109),eb={};b1.Z&&b1.Z.locals&&(eb.locals=b1.Z.locals);var EM,SM=0,bv={};bv.styleTagTransform=um(),bv.setAttributes=cm(),bv.insert=function(a,e){(e.target||document.head).appendChild(a)},bv.domAPI=lm(),bv.insertStyleElement=sd(),eb.use=function(a){return bv.options=a||{},SM++||(EM=om()(b1.Z,bv)),eb},eb.unuse=function(){SM>0&&!--SM&&(EM(),EM=null)};var kU=eb;function HP(){OU.use(),kU.use()}async function QP(a,e=void 0,t=[]){var n,i;_m.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>a.container});const s=(0,g.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),o=(0,g.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,g.getUrlQueryParam)("logo-img")&&(o.style.backgroundImage=`url(${(0,g.getUrlQueryParam)("logo-img")})`),o.onclick=()=>{window.open((0,g.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const l=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;a.container.appendChild(o),_m(o,{placement:"right",content:"Powered by WebGi SDK"});const h=(0,g.createDiv)({innerHTML:l,id:"fsToggle",classList:["round-button"],addToBody:!1});h.dataset.tippyContent="Full-Screen",(n=a.getPlugin(uo))==null||n.addEventListener("enter",()=>{h.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,h.dataset.tippyContent="Exit Full-Screen"}),(i=a.getPlugin(uo))==null||i.addEventListener("exit",()=>{h.innerHTML=l,h.dataset.tippyContent="Full-Screen"}),h.onclick=()=>{var P;(P=a.getPlugin(uo))==null||P.toggle(a.container)},a.container.appendChild(h),_m(h,{placement:"left"});const d=(0,g.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});a.container.appendChild(d);const f=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var P;if(!await a.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const L=E.map(R=>a.getPlugin(R));for(const R of L)await((P=R==null?void 0:R.resetDefaults)==null?void 0:P.call(R))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await a.confirm("Clear scene: Are you sure you want to clear the scene?")&&a.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var P;await a.fitToView((P=a.getPlugin(Ti))==null?void 0:P.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{a.getPlugin(ar)&&(a.getPlugin(ar).viewLooping=!a.getPlugin(ar).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var P;(P=a.getPlugin(hr))==null||P.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const P=a.scene.activeCamera.controls;P&&P.autoRotate!==void 0&&(P.autoRotate=!P.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const P=a.getPlugin(Vl);P?await P.downloadSnapshot():a.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const P=a.getPlugin(Am);P?await(P==null?void 0:P.downloadSceneGlb()):a.console.error("AssetExporterPlugin not added")}}];for(const P of f){const L=(0,g.createDiv)({innerHTML:P.icon,id:P.id,classList:["button-bar-button","util-button"],addToBody:!1});L.dataset.tippyContent=P.tooltip,L.onclick=()=>{P.toggle&&L.classList.toggle("button-bar-selected-box"),P.onclick()},d.appendChild(L)}PR(_m(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const v=a.getPlugin(Ti);for(const[P,L]of Object.entries(e??{})){const R=t.find(I=>I.title===P);R?R.plugins.push(...L):t.push({title:P,plugins:[...L]})}let y=t[2],w=[];const E=t.reduce((P,L)=>P.concat(L.plugins),[]);function M(P){var L;y=P,v&&(v.enabled=!0),w=[];for(const R of E){const I=a.getPlugin(R);if(!(I!=null&&I.uiConfig))continue;const N=P.plugins.includes(R);(0,g.safeSetProperty)(I.uiConfig,"hidden",!N,!0),N&&w.push(I)}for(const R of t)(L=R.div)==null||L.classList[y!==R?"remove":"add"]("mode-button-selected","button-bar-selected");a.getPlugin(v1).refreshPluginsEnabled()}for(const P of t){const L=(0,g.createDiv)({innerHTML:P.title,classList:["mode-button","button-bar-button"]});L.onclick=()=>{M(P)},P.div=L,s.appendChild(L)}M(t[0]),v==null||v.addEventListener("selectedObjectChanged",()=>{v!=null&&v.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(y.title)&&M(t.find(P=>P.plugins.includes(Ti)))})}class MM extends Sn{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Shadow type",type:"dropdown",children:[["Basic",u._MY],["PCF",u._iA],["PCFSoft",Er],["VSM",vr]].map(e=>({label:e[0],value:e[1]})),getValue:()=>{var e;return(e=this._viewer)==null?void 0:e.renderer.rendererObject.shadowMap.type},setValue:e=>{var t;(t=this._viewer)==null||t.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var e;return{label:((e=this._viewer)!=null&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,g.setUrlQueryParam)("rgbm",(n=this._viewer)!=null&&n.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,g.setUrlQueryParam)("msaa",(n=this._viewer)!=null&&n.isAntialiased?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,g.setUrlQueryParam)("depthPrepass",(n=this._viewer)!=null&&n.useGBufferDepth?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,g.setUrlQueryParam)("debug",(n=this._viewer)!=null&&n.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var e,t;const n=(t=(e=this._viewer)==null?void 0:e.getPlugin(Yt))==null?void 0:t.storage;if(n instanceof Storage)n.clear();else if(n instanceof Cache){const i=await n.keys();await Promise.all(i.map(async s=>n.delete(s)))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var e;const t=new Set;(e=this._viewer)==null||e.scene.modelRoot.traverse(n=>n.geometry&&t.add(n.geometry)),t.forEach(n=>pu(n))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var e;const t=new Set;(e=this._viewer)==null||e.scene.modelRoot.traverse(n=>n.geometry&&t.add(n.geometry)),t.forEach(n=>{const i=new u.Pa4;n.center(i),n.userData.__appliedMeshes.forEach(s=>{s.position.sub(i),s.setDirty&&s.setDirty()})})}}]}}}MM.PluginType="ExtrasUiPlugin1";class CM extends u.Tme{constructor(e){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=$a("Widget",this),this.object=e,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(e),this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}dispose(){this.detach()}_objectUpdate(){this.object&&this.update()}attach(e){var t,n;return this.object&&this.detach(),this.object=e,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&((n=(t=this.object.uiConfig)==null?void 0:t.children)==null||n.push(this.uiConfig)),this.visible=!0),this}detach(){var e,t,n,i;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const s=(t=(e=this.object.uiConfig)==null?void 0:e.children)==null?void 0:t.indexOf(this.uiConfig);s!==void 0&&s>=0&&((i=(n=this.object.uiConfig)==null?void 0:n.children)==null||i.splice(s,1))}this.object=void 0,this.visible=!1}return this}}(function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([sn()],CM.prototype,"visible",void 0);class TM extends CM{constructor(e){super(e),this.light=e,this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}}var IM=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class tf extends TM{constructor(e,t,n){super(e),this.lineWidth=5,this.size=.5,this._v1=new u.Pa4,this._v2=new u.Pa4,this._v3=new u.Pa4,this.color=n,t!==void 0&&(this.size=t);let i=new iA;this.material=new Fl({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new WE(i,this.material),this.add(this.lightPlane),i=new iA,i.setPositions([0,0,0,0,0,1]),this.targetLine=new WE(i,this.material),this.add(this.targetLine),this.update(),this.traverse(s=>{s.userData.__keepShadowDef=!0,s.castShadow=!1,s.receiveShadow=!1})}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(e){return e.isDirectionalLight}static Create(e){return new tf(e)}}IM([(0,g.onChange)(tf.prototype.update)],tf.prototype,"material",void 0),IM([(0,g.onChange)(tf.prototype.update),gn(void 0,[.1,20],.01)],tf.prototype,"lineWidth",void 0),IM([(0,g.onChange)(tf.prototype.update),gn(void 0,[.01,10],.01)],tf.prototype,"size",void 0);var PM=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class nf extends TM{constructor(e,t,n){super(e),this.lineWidth=5,this.size=.5,this.color=n,t!==void 0&&(this.size=t);const i=new ey(new u.xo$(.5,4,2));this.material=new Fl({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new Yv(i,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse(s=>{s.userData.__keepShadowDef=!0,s.castShadow=!1,s.receiveShadow=!1})}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){this.light&&this.lightSphere&&(this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(e){return e.isPointLight}static Create(e){return new nf(e)}}PM([(0,g.onChange)(nf.prototype.update)],nf.prototype,"material",void 0),PM([(0,g.onChange)(nf.prototype.update),gn(void 0,[.1,20],.01)],nf.prototype,"lineWidth",void 0),PM([(0,g.onChange)(nf.prototype.update),gn(void 0,[.01,10],.01)],nf.prototype,"size",void 0);var WP=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class xv extends TM{constructor(e,t,n){super(e),this.lineWidth=5,this._v1=new u.Pa4,this.color=n;let i=new jh;const s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,l=1,h=32;o<h;o++,l++){const d=o/h*Math.PI*2,f=l/h*Math.PI*2;s.push(Math.cos(d),Math.sin(d),1,Math.cos(f),Math.sin(f),1)}i.setPositions(s),this.material=new Fl({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new Ox(i,this.material),this.add(this.cone),i=new iA,i.setPositions([0,0,0,0,0,1]),this.update(),this.traverse(o=>{o.userData.__keepShadowDef=!0,o.castShadow=!1,o.receiveShadow=!1})}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set(this.color??this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(e){return e.isSpotLight}static Create(e){return new xv(e)}}WP([(0,g.onChange)(xv.prototype.update)],xv.prototype,"material",void 0),WP([(0,g.onChange)(xv.prototype.update),gn(void 0,[.1,20],.01)],xv.prototype,"lineWidth",void 0);class tb{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,o,l){let h=n[i+0],d=n[i+1],f=n[i+2],v=n[i+3];const y=s[o+0],w=s[o+1],E=s[o+2],M=s[o+3];if(l===0)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=v);if(l===1)return e[t+0]=y,e[t+1]=w,e[t+2]=E,void(e[t+3]=M);if(v!==M||h!==y||d!==w||f!==E){let P=1-l;const L=h*y+d*w+f*E+v*M,R=L>=0?1:-1,I=1-L*L;if(I>Number.EPSILON){const j=Math.sqrt(I),H=Math.atan2(j,L*R);P=Math.sin(P*H)/j,l=Math.sin(l*H)/j}const N=l*R;if(h=h*P+y*N,d=d*P+w*N,f=f*P+E*N,v=v*P+M*N,P===1-l){const j=1/Math.sqrt(h*h+d*d+f*f+v*v);h*=j,d*=j,f*=j,v*=j}}e[t]=h,e[t+1]=d,e[t+2]=f,e[t+3]=v}static multiplyQuaternionsFlat(e,t,n,i,s,o){const l=n[i],h=n[i+1],d=n[i+2],f=n[i+3],v=s[o],y=s[o+1],w=s[o+2],E=s[o+3];return e[t]=l*E+f*v+h*w-d*y,e[t+1]=h*E+f*y+d*v-l*w,e[t+2]=d*E+f*w+l*y-h*v,e[t+3]=f*E-l*v-h*y-d*w,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,s=e._z,o=e._order,l=Math.cos,h=Math.sin,d=l(n/2),f=l(i/2),v=l(s/2),y=h(n/2),w=h(i/2),E=h(s/2);switch(o){case"XYZ":this._x=y*f*v+d*w*E,this._y=d*w*v-y*f*E,this._z=d*f*E+y*w*v,this._w=d*f*v-y*w*E;break;case"YXZ":this._x=y*f*v+d*w*E,this._y=d*w*v-y*f*E,this._z=d*f*E-y*w*v,this._w=d*f*v+y*w*E;break;case"ZXY":this._x=y*f*v-d*w*E,this._y=d*w*v+y*f*E,this._z=d*f*E+y*w*v,this._w=d*f*v-y*w*E;break;case"ZYX":this._x=y*f*v-d*w*E,this._y=d*w*v+y*f*E,this._z=d*f*E-y*w*v,this._w=d*f*v+y*w*E;break;case"YZX":this._x=y*f*v+d*w*E,this._y=d*w*v+y*f*E,this._z=d*f*E-y*w*v,this._w=d*f*v-y*w*E;break;case"XZY":this._x=y*f*v-d*w*E,this._y=d*w*v-y*f*E,this._z=d*f*E+y*w*v,this._w=d*f*v+y*w*E;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],o=t[1],l=t[5],h=t[9],d=t[2],f=t[6],v=t[10],y=n+l+v;if(y>0){const w=.5/Math.sqrt(y+1);this._w=.25/w,this._x=(f-h)*w,this._y=(s-d)*w,this._z=(o-i)*w}else if(n>l&&n>v){const w=2*Math.sqrt(1+n-l-v);this._w=(f-h)/w,this._x=.25*w,this._y=(i+o)/w,this._z=(s+d)/w}else if(l>v){const w=2*Math.sqrt(1+l-n-v);this._w=(s-d)/w,this._x=(i+o)/w,this._y=.25*w,this._z=(h+f)/w}else{const w=2*Math.sqrt(1+v-n-l);this._w=(o-i)/w,this._x=(s+d)/w,this._y=(h+f)/w,this._z=.25*w}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ue(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,o=e._w,l=t._x,h=t._y,d=t._z,f=t._w;return this._x=n*f+o*l+i*d-s*h,this._y=i*f+o*h+s*l-n*d,this._z=s*f+o*d+n*h-i*l,this._w=o*f-n*l-i*h-s*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,s=this._z,o=this._w;let l=o*e._w+n*e._x+i*e._y+s*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=o,this._x=n,this._y=i,this._z=s,this;const h=1-l*l;if(h<=Number.EPSILON){const w=1-t;return this._w=w*o+t*this._w,this._x=w*n+t*this._x,this._y=w*i+t*this._y,this._z=w*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const d=Math.sqrt(h),f=Math.atan2(d,l),v=Math.sin((1-t)*f)/d,y=Math.sin(t*f)/d;return this._w=o*v+this._w*y,this._x=n*v+this._x*y,this._y=i*v+this._y*y,this._z=s*v+this._z*y,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(s),n*Math.cos(s),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class pa{constructor(e=0,t=0,n=0){pa.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(qP.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(qP.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,l=e.z,h=e.w,d=h*t+o*i-l*n,f=h*n+l*t-s*i,v=h*i+s*n-o*t,y=-s*t-o*n-l*i;return this.x=d*h+y*-s+f*-l-v*-o,this.y=f*h+y*-o+v*-s-d*-l,this.z=v*h+y*-l+d*-o-f*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,o=t.x,l=t.y,h=t.z;return this.x=i*h-s*l,this.y=s*o-n*h,this.z=n*l-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return RM.copy(this).projectOnVector(e),this.sub(RM)}reflect(e){return this.sub(RM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ue(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const RM=new pa,qP=new tb;class hu{constructor(){hu.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,s,o,l,h,d,f,v,y,w,E,M,P){const L=this.elements;return L[0]=e,L[4]=t,L[8]=n,L[12]=i,L[1]=s,L[5]=o,L[9]=l,L[13]=h,L[2]=d,L[6]=f,L[10]=v,L[14]=y,L[3]=w,L[7]=E,L[11]=M,L[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new hu().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/L0.setFromMatrixColumn(e,0).length(),s=1/L0.setFromMatrixColumn(e,1).length(),o=1/L0.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,o=Math.cos(n),l=Math.sin(n),h=Math.cos(i),d=Math.sin(i),f=Math.cos(s),v=Math.sin(s);if(e.order==="XYZ"){const y=o*f,w=o*v,E=l*f,M=l*v;t[0]=h*f,t[4]=-h*v,t[8]=d,t[1]=w+E*d,t[5]=y-M*d,t[9]=-l*h,t[2]=M-y*d,t[6]=E+w*d,t[10]=o*h}else if(e.order==="YXZ"){const y=h*f,w=h*v,E=d*f,M=d*v;t[0]=y+M*l,t[4]=E*l-w,t[8]=o*d,t[1]=o*v,t[5]=o*f,t[9]=-l,t[2]=w*l-E,t[6]=M+y*l,t[10]=o*h}else if(e.order==="ZXY"){const y=h*f,w=h*v,E=d*f,M=d*v;t[0]=y-M*l,t[4]=-o*v,t[8]=E+w*l,t[1]=w+E*l,t[5]=o*f,t[9]=M-y*l,t[2]=-o*d,t[6]=l,t[10]=o*h}else if(e.order==="ZYX"){const y=o*f,w=o*v,E=l*f,M=l*v;t[0]=h*f,t[4]=E*d-w,t[8]=y*d+M,t[1]=h*v,t[5]=M*d+y,t[9]=w*d-E,t[2]=-d,t[6]=l*h,t[10]=o*h}else if(e.order==="YZX"){const y=o*h,w=o*d,E=l*h,M=l*d;t[0]=h*f,t[4]=M-y*v,t[8]=E*v+w,t[1]=v,t[5]=o*f,t[9]=-l*f,t[2]=-d*f,t[6]=w*v+E,t[10]=y-M*v}else if(e.order==="XZY"){const y=o*h,w=o*d,E=l*h,M=l*d;t[0]=h*f,t[4]=-v,t[8]=d*f,t[1]=y*v+M,t[5]=o*f,t[9]=w*v-E,t[2]=E*v-w,t[6]=l*f,t[10]=M*v+y}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(UU,e,NU)}lookAt(e,t,n){const i=this.elements;return Lc.subVectors(e,t),Lc.lengthSq()===0&&(Lc.z=1),Lc.normalize(),Bm.crossVectors(n,Lc),Bm.lengthSq()===0&&(Math.abs(n.z)===1?Lc.x+=1e-4:Lc.z+=1e-4,Lc.normalize(),Bm.crossVectors(n,Lc)),Bm.normalize(),x1.crossVectors(Lc,Bm),i[0]=Bm.x,i[4]=x1.x,i[8]=Lc.x,i[1]=Bm.y,i[5]=x1.y,i[9]=Lc.y,i[2]=Bm.z,i[6]=x1.z,i[10]=Lc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],l=n[4],h=n[8],d=n[12],f=n[1],v=n[5],y=n[9],w=n[13],E=n[2],M=n[6],P=n[10],L=n[14],R=n[3],I=n[7],N=n[11],j=n[15],H=i[0],X=i[4],ne=i[8],pe=i[12],Ae=i[1],ve=i[5],Ee=i[9],xe=i[13],we=i[2],Re=i[6],Be=i[10],Oe=i[14],at=i[3],st=i[7],St=i[11],dt=i[15];return s[0]=o*H+l*Ae+h*we+d*at,s[4]=o*X+l*ve+h*Re+d*st,s[8]=o*ne+l*Ee+h*Be+d*St,s[12]=o*pe+l*xe+h*Oe+d*dt,s[1]=f*H+v*Ae+y*we+w*at,s[5]=f*X+v*ve+y*Re+w*st,s[9]=f*ne+v*Ee+y*Be+w*St,s[13]=f*pe+v*xe+y*Oe+w*dt,s[2]=E*H+M*Ae+P*we+L*at,s[6]=E*X+M*ve+P*Re+L*st,s[10]=E*ne+M*Ee+P*Be+L*St,s[14]=E*pe+M*xe+P*Oe+L*dt,s[3]=R*H+I*Ae+N*we+j*at,s[7]=R*X+I*ve+N*Re+j*st,s[11]=R*ne+I*Ee+N*Be+j*St,s[15]=R*pe+I*xe+N*Oe+j*dt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],o=e[1],l=e[5],h=e[9],d=e[13],f=e[2],v=e[6],y=e[10],w=e[14];return e[3]*(+s*h*v-i*d*v-s*l*y+n*d*y+i*l*w-n*h*w)+e[7]*(+t*h*w-t*d*y+s*o*y-i*o*w+i*d*f-s*h*f)+e[11]*(+t*d*v-t*l*w-s*o*v+n*o*w+s*l*f-n*d*f)+e[15]*(-i*l*f-t*h*v+t*l*y+i*o*v-n*o*y+n*h*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],l=e[5],h=e[6],d=e[7],f=e[8],v=e[9],y=e[10],w=e[11],E=e[12],M=e[13],P=e[14],L=e[15],R=v*P*d-M*y*d+M*h*w-l*P*w-v*h*L+l*y*L,I=E*y*d-f*P*d-E*h*w+o*P*w+f*h*L-o*y*L,N=f*M*d-E*v*d+E*l*w-o*M*w-f*l*L+o*v*L,j=E*v*h-f*M*h-E*l*y+o*M*y+f*l*P-o*v*P,H=t*R+n*I+i*N+s*j;if(H===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const X=1/H;return e[0]=R*X,e[1]=(M*y*s-v*P*s-M*i*w+n*P*w+v*i*L-n*y*L)*X,e[2]=(l*P*s-M*h*s+M*i*d-n*P*d-l*i*L+n*h*L)*X,e[3]=(v*h*s-l*y*s-v*i*d+n*y*d+l*i*w-n*h*w)*X,e[4]=I*X,e[5]=(f*P*s-E*y*s+E*i*w-t*P*w-f*i*L+t*y*L)*X,e[6]=(E*h*s-o*P*s-E*i*d+t*P*d+o*i*L-t*h*L)*X,e[7]=(o*y*s-f*h*s+f*i*d-t*y*d-o*i*w+t*h*w)*X,e[8]=N*X,e[9]=(E*v*s-f*M*s-E*n*w+t*M*w+f*n*L-t*v*L)*X,e[10]=(o*M*s-E*l*s+E*n*d-t*M*d-o*n*L+t*l*L)*X,e[11]=(f*l*s-o*v*s-f*n*d+t*v*d+o*n*w-t*l*w)*X,e[12]=j*X,e[13]=(f*M*i-E*v*i+E*n*y-t*M*y-f*n*P+t*v*P)*X,e[14]=(E*l*i-o*M*i-E*n*h+t*M*h+o*n*P-t*l*P)*X,e[15]=(o*v*i-f*l*i+f*n*h-t*v*h-o*n*y+t*l*y)*X,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,o=e.x,l=e.y,h=e.z,d=s*o,f=s*l;return this.set(d*o+n,d*l-i*h,d*h+i*l,0,d*l+i*h,f*l+n,f*h-i*o,0,d*h-i*l,f*h+i*o,s*h*h+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,o){return this.set(1,n,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,o=t._y,l=t._z,h=t._w,d=s+s,f=o+o,v=l+l,y=s*d,w=s*f,E=s*v,M=o*f,P=o*v,L=l*v,R=h*d,I=h*f,N=h*v,j=n.x,H=n.y,X=n.z;return i[0]=(1-(M+L))*j,i[1]=(w+N)*j,i[2]=(E-I)*j,i[3]=0,i[4]=(w-N)*H,i[5]=(1-(y+L))*H,i[6]=(P+R)*H,i[7]=0,i[8]=(E+I)*X,i[9]=(P-R)*X,i[10]=(1-(y+M))*X,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=L0.set(i[0],i[1],i[2]).length();const o=L0.set(i[4],i[5],i[6]).length(),l=L0.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],ph.copy(this);const h=1/s,d=1/o,f=1/l;return ph.elements[0]*=h,ph.elements[1]*=h,ph.elements[2]*=h,ph.elements[4]*=d,ph.elements[5]*=d,ph.elements[6]*=d,ph.elements[8]*=f,ph.elements[9]*=f,ph.elements[10]*=f,t.setFromRotationMatrix(ph),n.x=s,n.y=o,n.z=l,this}makePerspective(e,t,n,i,s,o){const l=this.elements,h=2*s/(t-e),d=2*s/(n-i),f=(t+e)/(t-e),v=(n+i)/(n-i),y=-(o+s)/(o-s),w=-2*o*s/(o-s);return l[0]=h,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=d,l[9]=v,l[13]=0,l[2]=0,l[6]=0,l[10]=y,l[14]=w,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,s,o){const l=this.elements,h=1/(t-e),d=1/(n-i),f=1/(o-s),v=(t+e)*h,y=(n+i)*d,w=(o+s)*f;return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-v,l[1]=0,l[5]=2*d,l[9]=0,l[13]=-y,l[2]=0,l[6]=0,l[10]=-2*f,l[14]=-w,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const L0=new pa,ph=new hu,UU=new pa(0,0,0),NU=new pa(1,1,1),Bm=new pa,x1=new pa,Lc=new pa,XP=new hu,YP=new tb;class w1{constructor(e=0,t=0,n=0,i=w1.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],o=i[4],l=i[8],h=i[1],d=i[5],f=i[9],v=i[2],y=i[6],w=i[10];switch(t){case"XYZ":this._y=Math.asin(ue(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,w),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(y,d),this._z=0);break;case"YXZ":this._x=Math.asin(-ue(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(l,w),this._z=Math.atan2(h,d)):(this._y=Math.atan2(-v,s),this._z=0);break;case"ZXY":this._x=Math.asin(ue(y,-1,1)),Math.abs(y)<.9999999?(this._y=Math.atan2(-v,w),this._z=Math.atan2(-o,d)):(this._y=0,this._z=Math.atan2(h,s));break;case"ZYX":this._y=Math.asin(-ue(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(y,w),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-o,d));break;case"YZX":this._z=Math.asin(ue(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-v,s)):(this._x=0,this._y=Math.atan2(l,w));break;case"XZY":this._z=Math.asin(-ue(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(y,d),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-f,w),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return XP.makeRotationFromQuaternion(e),this.setFromRotationMatrix(XP,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return YP.setFromEuler(this),this.setFromQuaternion(YP,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}w1.DEFAULT_ORDER="XYZ";class FU{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let zU=0;const KP=new pa,O0=new tb,rf=new hu,E1=new pa,nb=new pa,jU=new pa,VU=new tb,JP=new pa(1,0,0),ZP=new pa(0,1,0),$P=new pa(0,0,1),GU={type:"added"},eR={type:"removed"};class Lm extends zP{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:zU++}),this.uuid=Pe(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Lm.DEFAULT_UP.clone();const e=new pa,t=new w1,n=new tb,i=new pa(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new hu},normalMatrix:{value:new Mr}}),this.matrix=new hu,this.matrixWorld=new hu,this.matrixAutoUpdate=Lm.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Lm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new FU,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(e,t,n,i,s,o){this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,material:s,group:o})}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return O0.setFromAxisAngle(e,t),this.quaternion.multiply(O0),this}rotateOnWorldAxis(e,t){return O0.setFromAxisAngle(e,t),this.quaternion.premultiply(O0),this}rotateX(e){return this.rotateOnAxis(JP,e)}rotateY(e){return this.rotateOnAxis(ZP,e)}rotateZ(e){return this.rotateOnAxis($P,e)}translateOnAxis(e,t){return KP.copy(e).applyQuaternion(this.quaternion),this.position.add(KP.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(JP,e)}translateY(e){return this.translateOnAxis(ZP,e)}translateZ(e){return this.translateOnAxis($P,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(rf.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?E1.copy(e):E1.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),nb.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?rf.lookAt(nb,E1,this.up):rf.lookAt(E1,nb,this.up),this.quaternion.setFromRotationMatrix(rf),i&&(rf.extractRotation(i.matrixWorld),O0.setFromRotationMatrix(rf),this.quaternion.premultiply(O0.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(GU)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(eR)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(eR)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),rf.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),rf.multiply(e.parent.matrixWorld)),e.applyMatrix4(rf),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const s=this.children[n].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectsByProperty(e,t);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(nb,e,jU),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(nb,VU,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const s=t[n];s.matrixWorldAutoUpdate!==!0&&e!==!0||s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++){const l=i[s];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function s(l,h){return l[h.uuid]===void 0&&(l[h.uuid]=h.toJSON(e)),h.uuid}if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const h=l.shapes;if(Array.isArray(h))for(let d=0,f=h.length;d<f;d++){const v=h[d];s(e.shapes,v)}else s(e.shapes,h)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let h=0,d=this.material.length;h<d;h++)l.push(s(e.materials,this.material[h]));i.material=l}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++){const h=this.animations[l];i.animations.push(s(e.animations,h))}}if(t){const l=o(e.geometries),h=o(e.materials),d=o(e.textures),f=o(e.images),v=o(e.shapes),y=o(e.skeletons),w=o(e.animations),E=o(e.nodes);l.length>0&&(n.geometries=l),h.length>0&&(n.materials=h),d.length>0&&(n.textures=d),f.length>0&&(n.images=f),v.length>0&&(n.shapes=v),y.length>0&&(n.skeletons=y),w.length>0&&(n.animations=w),E.length>0&&(n.nodes=E)}return n.object=i,n;function o(l){const h=[];for(const d in l){const f=l[d];delete f.metadata,h.push(f)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData={};for(const[n,i]of Object.entries(e.userData))this.userData[n]=!i||i&&(i.isTexture||i.isObject3D)?i:JSON.parse(JSON.stringify(i));if(t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Lm.DEFAULT_UP=new pa(0,1,0),Lm.DEFAULT_MATRIX_AUTO_UPDATE=!0,Lm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class HU extends Lm{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new hu,this.projectionMatrix=new hu,this.projectionMatrixInverse=new hu}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class QU extends CM{constructor(e){super(e),this.camera=e,this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}}class DM extends QU{constructor(e){super(e),this._vector=new pa,this._camera=new HU;const t=new jh,n=new Fl({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:i,colors:s,pointMap:o}=function(){const y=[],w=[],E={};function M(L,R){P(L),P(R)}function P(L){y.push(0,0,0),w.push(0,0,0),E[L]===void 0&&(E[L]=[]),E[L].push(y.length/3-1)}return M("n1","n2"),M("n2","n4"),M("n4","n3"),M("n3","n1"),M("f1","f2"),M("f2","f4"),M("f4","f3"),M("f3","f1"),M("n1","f1"),M("n2","f2"),M("n3","f3"),M("n4","f4"),M("p","n1"),M("p","n2"),M("p","n3"),M("p","n4"),M("u1","u2"),M("u2","u3"),M("u3","u1"),M("c","t"),M("p","c"),M("cn1","cn2"),M("cn3","cn4"),M("cf1","cf2"),M("cf3","cf4"),{vertices:y,colors:w,pointMap:E}}();t.setPositions(i),t.setColors(s),this.line=new Ox(t,n),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=o,this.update();const l=new er(16755200),h=new er(16711680),d=new er(43775),f=new er(16777215),v=new er(3355443);this.setColors(l,h,d,f,v)}setColors(e,t,n,i,s){const o=this.line.geometry,l=o.getAttribute("instanceColorStart"),h=o.getAttribute("instanceColorEnd");function d(f,v){l.setXYZ(f/2,v.r,v.g,v.b),h.setXYZ(f/2,v.r,v.g,v.b)}d(0,e),d(2,e),d(4,e),d(6,e),d(8,e),d(10,e),d(12,e),d(14,e),d(16,e),d(18,e),d(20,e),d(22,e),d(24,t),d(26,t),d(28,t),d(30,t),d(32,n),d(34,n),d(36,n),d(38,i),d(40,s),d(42,s),d(44,s),d(46,s),d(48,s),l.needsUpdate=!0,h.needsUpdate=!0}update(){if(!this.camera)return;const e=this.line.geometry,t=this.pointMap,{_camera:n,_vector:i}=this;n.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),qs("c",t,e,n,0,0,-1,i),qs("t",t,e,n,0,0,1,i),qs("n1",t,e,n,-1,-1,-1,i),qs("n2",t,e,n,1,-1,-1,i),qs("n3",t,e,n,-1,1,-1,i),qs("n4",t,e,n,1,1,-1,i),qs("f1",t,e,n,-1,-1,1,i),qs("f2",t,e,n,1,-1,1,i),qs("f3",t,e,n,-1,1,1,i),qs("f4",t,e,n,1,1,1,i),qs("u1",t,e,n,.7,1.1,-1,i),qs("u2",t,e,n,-.7,1.1,-1,i),qs("u3",t,e,n,0,2,-1,i),qs("cf1",t,e,n,-1,0,1,i),qs("cf2",t,e,n,1,0,1,i),qs("cf3",t,e,n,0,-1,1,i),qs("cf4",t,e,n,0,1,1,i),qs("cn1",t,e,n,-1,0,-1,i),qs("cn2",t,e,n,1,0,-1,i),qs("cn3",t,e,n,0,-1,-1,i),qs("cn4",t,e,n,0,1,-1,i),e.getAttribute("instanceStart").needsUpdate=!0,e.getAttribute("instanceEnd").needsUpdate=!0,e.computeBoundingBox(),e.computeBoundingSphere()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(e){return e.isCamera}static Create(e){return new DM(e)}}function qs(a,e,t,n,i,s,o,l){l.set(i,s,o).unproject(n);const h=e[a];if(h!==void 0){const d=t.getAttribute("instanceStart"),f=t.getAttribute("instanceEnd");for(let v=0,y=h.length;v<y;v++){const w=Math.floor(h[v]/2);(h[v]%2==0?d:f).setXYZ(w,l.x,l.y,l.z)}}}class wv extends Sn{constructor(){super(...arguments),this.enabled=!0,this.helpers=[tf,xv,nf,DM],this.visible=!0,this.toJSON=null,this._addSceneObject=e=>{const t=e.object;this._createWidgets(t==null?void 0:t.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"visible"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]}}_onVisibleChange(){var e,t;(e=this.widgets)==null||e.forEach(n=>n.visible=this.visible),(t=this._viewer)==null||t.setDirty()}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach(t=>t.dispose&&t.dispose()),this.widgets=[],super.onRemove(e)}refresh(){var e;this._createWidgets((e=this._viewer)==null?void 0:e.scene.modelRoot)}_createWidgets(e){e==null||e.traverse(t=>{const n=this.widgets.find(i=>i.object===t);if(n)return void(n.update&&n.update());this.helpers.filter(i=>i.Check(t)).forEach(i=>{var s;const o=i.Create(t);this.widgets.push(o),(s=this._viewer)==null||s.scene.addWidget(o)})})}}wv.PluginType="WidgetsPlugin",function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([(0,g.onChange)(wv.prototype._onVisibleChange)],wv.prototype,"visible",void 0);var WU=Ta({defaultModifiers:[Ur,cs,eA,Lp]}),qU=__webpackgi_require__2(388),XU=__webpackgi_require__2.n(qU);function YU(a){const e=[];a.traverse(i=>{i.geometry&&e.push(i)});const t={},n={};e.forEach(i=>{if(!t[i.geometry.uuid]){const l=i.geometry.toJSON().data,h=l?XU()({a:l.attributes||{},b:l.index||[]}):"";t[i.geometry.uuid]=h}const s=t[i.geometry.uuid],o=n[s]??(n[s]=[]);o.includes(i)||o.push(i)}),Object.values(n).forEach(i=>{if(i.length<2)return;const s=i[0].geometry;i.forEach((o,l)=>{l<1||(o.geometry.dispose(),o.geometry=s)})})}const sf=new u.Pa4,Ev=new u.Pa4,S1=new u.Pa4,BM=new u.Pa4,M1=new u.Pa4,k0=new u.Pa4;let LM=1;const KU=new u.Pa4(0,1,0);class JU extends mf{constructor(e,t){super(e,t),this.throttleUpdate=60,this.targetOffset=new u.Pa4(0,0,0);const n=this.update;this.update=()=>this._update(n)}_update(e){this.target.add(this.targetOffset),sf.copy(this.object.position).sub(this.target),LM=sf.length(),k0.copy(this.target);const t=e();return k0.sub(this.target),sf.copy(this.object.position).sub(this.target),LM/=sf.length(),this.target.add(k0),this.object.position.copy(this.target).add(sf),sf.normalize(),Ev.crossVectors(KU,sf).normalize(),S1.crossVectors(sf,Ev).normalize(),BM.crossVectors(Ev,S1).normalize().negate(),Ev.length()>.1&&this.object.up.crossVectors(sf.clone().normalize(),Ev),this.enablePan&&(M1.set(0,0,0).addScaledVector(Ev,k0.x).addScaledVector(S1,k0.y).addScaledVector(BM,k0.z),this.targetOffset.add(M1),this.targetOffset.multiplyScalar(1/LM)),M1.set(0,0,0).addScaledVector(Ev,-this.targetOffset.x).addScaledVector(S1,-this.targetOffset.y).addScaledVector(BM,-this.targetOffset.z),this.object.lookAt(M1.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class C1 extends g.SimpleEventDispatcher{_setOptions(e){var t;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=C1.GetSupportedMimeTypes([],["h264"],!0)??C1.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!((t=this._options.mimeType)!=null&&t.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=i=>{var s;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const o=new Blob(this._currentRecording,{type:this._options.mimeType});(s=this._recordingCallback)==null||s.call(this,o)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=i=>{var s;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((s=this._recorder)==null||s.pause())},this._onresume=i=>{if(!this.stepMode)return;const s=()=>{var l;this._state==="recording"&&((l=this._recorder)==null||l.pause())},o=Math.min(this._resumeSyncTime-(0,g.now)(),0)+1e3/this._options.frameRate;o>0?(0,g.timeout)(o).then(s):s()},this._onpause=i=>{},this._ondataavailable=i=>{i.data&&i.data.size>0&&this._currentRecording.push(i.data)},this._onerror=i=>{this._state="error",this._console.error(i),this.dispatchEvent({type:"error",error:i}),this._recorder=void 0},this._canvas=e;const n=t==null?void 0:t.mimeType;this._options={mimeType:n||"auto",frameRate:30,stepMode:!1},this._setOptions(t||this._options)}isRecording(){return this._state==="recording"}start(){var e,t,n;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const i={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=i.mimeType)==null?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const s=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),o=(t=s.getVideoTracks())==null?void 0:t[0];this._track=o,this._recorder=new window.MediaRecorder(s,i),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(n=this._recorder)==null||n.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async s=>{const o=await(s==null?void 0:s.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=o,this._state="recording",this._onstart({})}).catch(s=>{this._onerror({detail:s})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,g.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const t=await Promise.all(e.map(async([i,s])=>await(await fetch(s)).blob())),n=[];for(let i=0;i<e.length;i++){const s=await this._imgDirectory.getFileHandle(e[i][0],{create:!0});n.push((0,g.writeFile)(s,t[i]))}await Promise.all(n)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter(l=>!e||e.length<1||e.includes(l)),s=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(l=>!t||t.length<1||t.includes(l)),o=[];return i.forEach(l=>{const h=`video/${l}`;s.forEach(d=>{[`${h};codecs=${d}`,`${h};codecs:${d}`,`${h};codecs=${d.toUpperCase()}`,`${h};codecs:${d.toUpperCase()}`,`${h}`].forEach(f=>{MediaRecorder.isTypeSupported(f)&&o.push(f)})})}),n?o.length>0?o[0]:void 0:o}}class ZU extends Kv{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new u.cJO(1,0))}}function OM(a,e){const t=Array.from((a.access??"").split(".")),n=t.pop();let i=a.targetObject??e;if(!n||n.length===0)return{key:void 0,tar:i};if(i=(0,g.deepAccessObject)(t,i),i&&!(n in i))throw console.error("invalid key",n,i,e,a),"";return{key:n,tar:i}}function kM(a,e,t,n){const{key:i,tar:s}=OM(a,e);return i&&s?S_(s,i,()=>{var o;t&&((o=a.updater)!=null&&o.length)&&a.updater.forEach(l=>t[l]()),n==null||n()}):o=>console.warn("Unable to set ",o,i,s,a,e)}async function T1(a,e,t){const{key:n,tar:i}=OM(e,a),s=e.animSet?[tR(i,e.animSet,t,e.animSetParallel??!1)]:[];if(n&&i){const o=e.updater??[],l=async()=>Tg(i,n,{...e,onUpdate:h=>{var d;(d=e.onUpdate)==null||d.call(e,h),o.forEach(f=>{var v;return(v=t[f])==null?void 0:v.call(t)})}});e.delay?s.push((0,g.timeout)(e.delay).then(l)):s.push(l())}else(e.duration||e.delay)&&s.push((0,g.timeout)((e.delay??0)+(e.duration??0)));return s.length===1?s[0]:Promise.all(s)}async function tR(a,e,t,n=!1){if(n)return Promise.all(e.map(async i=>T1(a,i,t)));for(const i of e)await T1(a,i,t)}function nR(a,e,t,n){var i,s;if(!a)return;e||(e=[]);const o=n??{},l=a;for(let h=0,d=e.length;h<d;h++){const f=e[h];if(f.uiRef){const y=(l==null?void 0:l.indexOf(f.uiRef))??-1;y!==h&&(y>=0&&(l==null||l.splice(y,1)),l==null||l.splice(h,0,f.uiRef))}else{f.uiRef={type:"folder",label:f.name??"Animation "+h,children:[]};const y=[{type:"button",label:"animate",value:()=>{T1(t,f,o).then(()=>{var w;return console.log(((w=f.uiRef)==null?void 0:w.label)+" finished")})}}];f.access!==void 0&&y.push({type:"input",property:[f,"access"]}),f.from!==void 0&&y.push({type:f.uiObjectType??"input",property:[f,"from"],onChange:()=>{var w;kM(f,t)(f.from),(w=f.updater)==null||w.forEach(E=>E in o&&o[E]())}}),f.to!==void 0&&y.push({type:f.uiObjectType??"input",property:[f,"to"],onChange:()=>{var w;kM(f,t)(f.to),(w=f.updater)==null||w.forEach(E=>E in o&&o[E]())}}),f.duration!==void 0&&y.push({type:"input",property:[f,"duration"]}),f.animSet&&(f.animSetParallel||(f.animSetParallel=!1),y.push({type:"input",label:"run parallel",property:[f,"animSetParallel"]})),f.animSet&&y.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(i=f.uiRef.children)==null||i.push(...y),l==null||l.splice(h,0,f.uiRef)}const v=(s=f.uiRef.children)==null?void 0:s.map(y=>(0,g.getOrCall)(y)).flat(2).find(y=>y==null?void 0:y.animSetContainer);f.animSet&&v&&nR(v.children,f.animSet,f.targetObject??t,n)}}const UM=new TextEncoder,$U={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},eN=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class tN{constructor({accessKeyId:e,secretAccessKey:t,sessionToken:n,service:i,region:s,cache:o,retries:l,initRetryMs:h}){if(e==null)throw new TypeError("accessKeyId is a required option");if(t==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=t,this.sessionToken=n,this.service=i,this.region=s,this.cache=o||new Map,this.retries=l??10,this.initRetryMs=h||50}async sign(e,t){if(e instanceof Request){const{method:s,url:o,headers:l,body:h}=e;(t=Object.assign({method:s,url:o,headers:l},t)).body==null&&l.has("Content-Type")&&(t.body=h!=null&&l.has("X-Amz-Content-Sha256")?h:await e.clone().arrayBuffer()),e=o}const n=new nN(Object.assign({url:e},t,this,t&&t.aws)),i=Object.assign({},t,await n.sign());delete i.aws;try{return new Request(i.url.toString(),i)}catch(s){if(s instanceof TypeError)return new Request(i.url.toString(),Object.assign({duplex:"half"},i));throw s}}async fetch(e,t){for(let n=0;n<=this.retries;n++){const i=fetch(await this.sign(e,t));if(n===this.retries)return i;const s=await i;if(s.status<500&&s.status!==429)return s;await new Promise(o=>setTimeout(o,Math.random()*this.initRetryMs*Math.pow(2,n)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class nN{constructor({method:e,url:t,headers:n,body:i,accessKeyId:s,secretAccessKey:o,sessionToken:l,service:h,region:d,cache:f,datetime:v,signQuery:y,appendSessionToken:w,allHeaders:E,singleEncode:M}){if(t==null)throw new TypeError("url is a required option");if(s==null)throw new TypeError("accessKeyId is a required option");if(o==null)throw new TypeError("secretAccessKey is a required option");let P,L;this.method=e||(i?"POST":"GET"),this.url=new URL(t),this.headers=new Headers(n||{}),this.body=i,this.accessKeyId=s,this.secretAccessKey=o,this.sessionToken=l,h&&d||([P,L]=function(N,j){const{hostname:H,pathname:X}=N;if(H.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(H.endsWith(".backblazeb2.com")){const ve=H.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return ve!=null?["s3",ve[1]]:["",""]}const ne=H.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[pe,Ae]=(ne||["",""]).slice(1,3);if(Ae==="us-gov")Ae="us-gov-west-1";else if(Ae==="s3"||Ae==="s3-accelerate")Ae="us-east-1",pe="s3";else if(pe==="iot")pe=H.startsWith("iot.")?"execute-api":H.startsWith("data.jobs.iot.")?"iot-jobs-data":X==="/mqtt"?"iotdevicegateway":"iotdata";else if(pe==="autoscaling"){const ve=(j.get("X-Amz-Target")||"").split(".")[0];ve==="AnyScaleFrontendService"?pe="application-autoscaling":ve==="AnyScaleScalingPlannerFrontendService"&&(pe="autoscaling-plans")}else Ae==null&&pe.startsWith("s3-")?(Ae=pe.slice(3).replace(/^fips-|^external-1/,""),pe="s3"):pe.endsWith("-fips")?pe=pe.slice(0,-5):Ae&&/-\d$/.test(pe)&&!/-\d$/.test(Ae)&&([pe,Ae]=[Ae,pe]);return[$U[pe]||pe,Ae]}(this.url,this.headers)),this.service=h||P||"",this.region=d||L||"us-east-1",this.cache=f||new Map,this.datetime=v||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=y,this.appendSessionToken=w||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const R=this.signQuery?this.url.searchParams:this.headers;if(R.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&R.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(N=>E||!eN.has(N)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(N=>N+":"+(N==="host"?this.url.host:(this.headers.get(N)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||R.has("X-Amz-Expires")||R.set("X-Amz-Expires","86400"),R.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),R.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),R.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");M||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=rR(this.encodedPath);const I=new Set;this.encodedSearch=[...this.url.searchParams].filter(([N])=>{if(!N)return!1;if(this.service==="s3"){if(I.has(N))return!1;I.add(N)}return!0}).map(N=>N.map(j=>rR(encodeURIComponent(j)))).sort(([N,j],[H,X])=>N<H?-1:N>H?1:j<X?-1:j>X?1:0).map(N=>N.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),t=[this.secretAccessKey,e,this.region,this.service].join();let n=this.cache.get(t);if(!n){const i=await ib("AWS4"+this.secretAccessKey,e),s=await ib(i,this.region),o=await ib(s,this.service);n=await ib(o,"aws4_request"),this.cache.set(t,n)}return NM(await ib(n,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,NM(await iR(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(e==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=NM(await iR(this.body||""))}return e}}async function ib(a,e){const t=await crypto.subtle.importKey("raw",typeof a=="string"?UM.encode(a):a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",t,UM.encode(e))}async function iR(a){return crypto.subtle.digest("SHA-256",typeof a=="string"?UM.encode(a):a)}function NM(a){return Array.prototype.map.call(new Uint8Array(a),e=>("0"+e.toString(16)).slice(-2)).join("")}function rR(a){return a.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}var Sv=function(a,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,n);else for(var l=a.length-1;l>=0;l--)(i=a[l])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Oc=class extends Sn{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[kA],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1}connect(){this._connected&&this.disconnect(),this._client=new tN({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var a,e;(e=(a=this.uiConfig)==null?void 0:a.uiRefresh)==null||e.call(a,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(a){return this.serializeSettings?super.toJSON(a):{type:this.constructor.PluginType}}async onAdded(a){await super.onAdded(a);const e=a.getPlugin(kA);e.actions.exportFile=async(t,n,i)=>{if(!this._connected)return void await e.defaultActions.exportFile(t,n);const s=(0,g.pathJoin)([this.endpointURL,this.pathPrefix,n]),o=await this._fetch(s,{method:"PUT",body:t},i);if(!o.ok)return a.console.error("Error uploading file",o),void await e.defaultActions.exportFile(t,n);this.dispatchEvent({type:"fileUpload",name:n,blob:t,response:o,path:s}),a.console.log("File uploaded",o)}}async _fetch(a,e,t){if(!this._client)throw new Error("Not connected");for(let n=0;n<=this._client.retries;n++){const i=fetch(await this._client.sign(a,e));if(n===this._client.retries)return i;const s=await i;if(s.status<500&&s.status!==429)return s;await(0,g.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,n))}throw new Error("An unknown error occurred, ensure retries is not negative")}};Oc.PluginType="AWSClientPlugin1",Sv([ke(),gi("Access Key ID",a=>({disabled:()=>!a.enabled||a._connected}))],Oc.prototype,"accessKeyId",void 0),Sv([ke(),gi("Access Key Secret",a=>({disabled:()=>!a.enabled||a._connected}))],Oc.prototype,"accessKeySecret",void 0),Sv([ke(),gi("Endpoint URL",a=>({disabled:()=>!a.enabled||a._connected}))],Oc.prototype,"endpointURL",void 0),Sv([ke(),gi("Path Prefix",a=>({disabled:()=>!a.enabled}))],Oc.prototype,"pathPrefix",void 0),Sv([ke(),sn("Remember",a=>({disabled:()=>!a.enabled||a._connected}))],Oc.prototype,"serializeSettings",void 0),Sv([Bi(void 0,a=>({label:()=>a._connected?"Disconnect":"Connect"}))],Oc.prototype,"toggleConnection",void 0),Oc=Sv([Vn("S3 Connection")],Oc);const iN={Background:new ym({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(a=>({path:a}))}).assets,Environment:new ym({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(a=>({path:a}))}).assets,GemEnvironment:new ym({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(a=>({path:a}))}).assets,Ground:new ym({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(a=>({path:a}))}).assets,CameraViews:new ym({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(a=>({path:a}))}).assets,MaterialConfiguration:new ym({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(a=>({path:a}))}).assets,MaterialLibraries:new ym({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(a=>({path:a}))}).assets};function sR(a,e){return e?a*(1e3/e):0}function rN(a){var e,t=a.from,n=t===void 0?0:t,i=a.velocity,s=i===void 0?0:i,o=a.min,l=a.max,h=a.power,d=h===void 0?.8:h,f=a.timeConstant,v=f===void 0?750:f,y=a.bounceStiffness,w=y===void 0?500:y,E=a.bounceDamping,M=E===void 0?10:E,P=a.restDelta,L=P===void 0?1:P,R=a.modifyTarget,I=a.driver,N=a.onUpdate,j=a.onComplete,H=a.onStop;function X(Be){return o!==void 0&&Be<o||l!==void 0&&Be>l}function ne(Be){return o===void 0?l:l===void 0||Math.abs(o-Be)<Math.abs(l-Be)?o:l}function pe(Be){e==null||e.stop(),e=nu(jr(jr({},Be),{driver:I,onUpdate:function(Oe){var at;N==null||N(Oe),(at=Be.onUpdate)===null||at===void 0||at.call(Be,Oe)},onComplete:j,onStop:H}))}function Ae(Be){pe(jr({type:"spring",stiffness:w,damping:M,restDelta:L},Be))}if(X(n))Ae({from:n,velocity:s,to:ne(n)});else{var ve=d*s+n;R!==void 0&&(ve=R(ve));var Ee,xe,we=ne(ve),Re=we===o?-1:1;pe({type:"decay",from:n,velocity:s,timeConstant:v,power:d,restDelta:L,modifyTarget:R,onUpdate:X(ve)?function(Be){Ee=xe,xe=Be,s=sR(Be-Ee,Sy().delta),(Re===1&&Be>we||Re===-1&&Be<we)&&Ae({from:Be,to:we,velocity:s})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var aR=function(a){return 180*a/Math.PI},sN=function(a,e){return e===void 0&&(e=Sg),aR(Math.atan2(e.y-a.y,e.x-a.x))},aN=function(a,e){var t=!0;return e===void 0&&(e=a,t=!1),function(n){return t?n-a+e:(a=n,t=!0,e)}},oN=function(a){return a},FM=function(a){return a===void 0&&(a=oN),function(e,t,n){var i=t-n,s=-(0-e+1)*(0-a(Math.abs(i)));return i<=0?t+s:t-s}},lN=FM(),cN=FM(Math.sqrt),oR=function(a){return a*Math.PI/180},I1=function(a){return a.hasOwnProperty("x")&&a.hasOwnProperty("y")},zM=function(a){return I1(a)&&a.hasOwnProperty("z")},P1=function(a,e){return Math.abs(a-e)};function uN(a,e){if(b_(a)&&b_(e))return P1(a,e);if(I1(a)&&I1(e)){var t=P1(a.x,e.x),n=P1(a.y,e.y),i=zM(a)&&zM(e)?P1(a.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(n,2)+Math.pow(i,2))}}var hN=function(a,e,t){return e=oR(e),{x:t*Math.cos(e)+a.x,y:t*Math.sin(e)+a.y}},lR=function(a,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(a*e)/e},cR=function(a,e,t,n){return n===void 0&&(n=0),lR(a+t*(e-a)/Math.max(n,t))},dN=function(a){a===void 0&&(a=50);var e=0,t=0;return function(n){var i=Sy().timestamp,s=i!==t?i-t:0,o=s?cR(e,n,s,a):e;return t=i,e=o,o}},pN=function(a){if(typeof a=="number")return function(n){return Math.round(n/a)*a};var e=0,t=a.length;return function(n){var i=Math.abs(a[0]-n);for(e=1;e<t;e++){var s=a[e],o=Math.abs(s-n);if(o===0)return s;if(o>i)return a[e-1];if(e===t-1)return s;i=o}}};function fN(a,e){return a/(1e3/e)}var mN=function(a,e,t){var n=e-a;return((t-a)%n+n)%n+a},uR=function(a,e){return 1-3*e+3*a},hR=function(a,e){return 3*e-6*a},dR=function(a){return 3*a},R1=function(a,e,t){return((uR(e,t)*a+hR(e,t))*a+dR(e))*a},pR=function(a,e,t){return 3*uR(e,t)*a*a+2*hR(e,t)*a+dR(e)},gN=1e-7,vN=10,_N=8,yN=.001,D1=11,B1=1/(D1-1);function AN(a,e,t,n){if(a===e&&t===n)return h_;for(var i=new Float32Array(D1),s=0;s<D1;++s)i[s]=R1(s*B1,a,t);return function(o){return o===0||o===1?o:R1(function(l){for(var h=0,d=1,f=D1-1;d!==f&&i[d]<=l;++d)h+=B1;--d;var v=h+(l-i[d])/(i[d+1]-i[d])*B1,y=pR(v,a,t);return y>=yN?function(w,E,M,P){for(var L=0;L<_N;++L){var R=pR(E,M,P);if(R===0)return E;E-=(R1(E,M,P)-w)/R}return E}(l,v,a,t):y===0?v:function(w,E,M,P,L){var R,I,N=0;do(R=R1(I=E+(M-E)/2,P,L)-w)>0?M=I:E=I;while(Math.abs(R)>gN&&++N<vN);return I}(l,h,h+B1,a,t)}(o),e,n)}}var bN=function(a,e){return e===void 0&&(e="end"),function(t){var n=(t=e==="end"?Math.min(t,.999):Math.max(t,.001))*a,i=e==="end"?Math.floor(n):Math.ceil(n);return Vu(0,1,i/a)}};class xN extends ol{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[Bc,JA,lp,Jc]},{title:"Picking",plugins:[XA,Ti,Zi,fd,uu,wv]},{title:"Scene",plugins:[WA,Yl,qA,YA,KA,ju,Ga,Dc]},{title:"Anti-aliasing",plugins:[na,im,pl]},{title:"Post Processing",plugins:[Df,yA,ls,Bf,sg,qu,jf,tg,ll,zh,js,Ea]},{title:"Export",plugins:[Am,Vl,ah,Oc]},{title:"Animations",plugins:[hr,ar,os,Pm,Od]},{title:"Modifiers",plugins:[oh,$l,ec,cu,wA,LA,co]},{title:"Configurators",plugins:[kp,Op,su,FA]},{title:"Plugins",plugins:[so,uo,Is,Nu,Ql,cl,Fo,Ec,hl,jo,ho,wd,rh]},{title:"Extras",plugins:[MM]}],HP()}async setupUi(e,t){await QP(this,e,t??this.defaultModes),this._editorInitialized=!0}}async function fR(a,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!1,importPopup:s=!0,caching:o=!0}){a.enabled=!1,e&&await a.addPlugin(Wl),a.getPlugin(Yt)||await a.addPlugin(Yt,void 0,void 0,{storage:o&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await a.addPlugin(Am),await a.addPlugin(gS),await a.addPlugin(kA),s&&await a.addPlugin(ho),await a.addPlugin(ad,!1),await a.addPlugin(bM),await a.addPlugin(dv,!1),await a.addPlugin(qE),await a.addPlugin(p0),await a.addPlugin(Jc),await a.addPlugin(Od),await a.addPlugin(Xp),await a.addPlugin(Ti,ny,!1,!0),await Dx(a,{ground:t,bloom:n,depthTonemap:i}),await a.addPlugin(yA),await a.addPlugin(cu,!1),await a.addPlugin(XS),await a.addPlugin(JS),await a.addPlugin(ZS),await a.addPlugin(wd,!1),await a.addPlugin(oh),await a.addPlugin($l),await a.addPlugin(ec),await a.addPlugin(Op),await a.addPlugin(kp),await a.addPlugin(FA),await a.addPlugin(fd),await a.addPlugin(ah),await a.addPlugin(Vl),await a.addPlugin(XA),await a.addPlugin(qA),await a.addPlugin(YA),await a.addPlugin(KA),await a.addPlugin(Bc),await a.addPlugin(JA),await a.addPlugin(WA),await a.addPlugin(wv),await a.addPlugin(uu),await a.addPlugin(Pm,a.container,!1),await a.addPlugin(Oc);const l=await a.addPlugin(new v1(!(0,g.mobileAndTabletCheck)()));return a.renderer.refreshPipeline(),a.scene.addEventListener("textureAdded",h=>{h.texture&&a.scene.setEnvironment(h.texture)}),l.setupPluginUi(uo),l.setupPluginUi(Bc),l.setupPluginUi(JA),l.setupPluginUi(Jc),l.setupPluginUi(WA),l.setupPluginUi(Am),l.setupPluginUi(hr),l.setupPluginUi(ju),l.setupPluginUi(kp),l.setupPluginUi(Op),l.setupPluginUi(Od),l.setupPluginUi(XA),l.setupPluginUi(fd),l.setupPluginUi(Zi),l.setupPluginUi(Ti),t&&a.getPlugin(Yl)&&l.setupPluginUi(Yl),t&&a.getPlugin(Dc)&&l.setupPluginUi(Dc),l.setupPluginUi(jf),l.setupPluginUi(ar),l.setupPluginUi(ah),l.setupPluginUi(Df),l.setupPluginUi(yA),l.setupPluginUi(Bf),l.setupPluginUi(sg),l.setupPluginUi(ls),l.setupPluginUi(qu),l.setupPluginUi(zh),l.setupPluginUi(tg),l.setupPluginUi(hl),l.setupPluginUi(Ec),l.setupPluginUi(qA),l.setupPluginUi(oh),l.setupPluginUi($l),l.setupPluginUi(na),l.setupPluginUi(YA),l.setupPluginUi(KA),l.setupPluginUi(cl),l.setupPluginUi(Fo),l.setupPluginUi(jo),n&&l.setupPluginUi(ll),l.setupPluginUi(Vl),l.setupPluginUi(so),l.setupPluginUi(im),l.setupPluginUi(Ga),l.setupPluginUi(js),l.setupPluginUi(Ea),l.setupPluginUi(ec),l.setupPluginUi(Nu),l.setupPluginUi(pl),l.setupPluginUi(lp),l.setupPluginUi(su),l.setupPluginUi(Is),l.setupPluginUi(cu),l.setupPluginUi(ho),l.setupPluginUi(os),l.setupPluginUi(wd),l.setupPluginUi(Oc),l.setupPluginUi(Pm),l.setupPluginUi(uu),l.setupPluginUi(FA),l.setupPluginUi(co),l.setupPluginUi(wv),l.setupPluginUi(rh),l.setupPluginUi(dv),a.enabled=!0,a}async function wN(a,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!1,importPopup:s=!0,caching:o=!0}){const l=new ol(a);return await fR(l,{debug:e,ground:t,bloom:n,depthTonemap:i,importPopup:s,caching:o}),l}async function EN(a,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!0,importPopup:s=!1,enableDrop:o=!1,caching:l=!0}={}){const h=new ol(a);return e&&await h.addPlugin(Wl),h.getPlugin(Yt)||h.addPluginSync(Yt,void 0,void 0,{storage:l&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await h.addPlugin(ad,!0),await Dx(h,{ground:t,bloom:n,depthTonemap:i,enableDrop:o,importPopup:s}),h}})();__webpackgi_exports__2.MWW;__webpackgi_exports__2.LY2;__webpackgi_exports__2.GYo;__webpackgi_exports__2.GPz;__webpackgi_exports__2.HRj;__webpackgi_exports__2.li4;__webpackgi_exports__2.FO5;__webpackgi_exports__2.Nlh;__webpackgi_exports__2.Mp4;__webpackgi_exports__2.QvI;__webpackgi_exports__2.PrA;__webpackgi_exports__2.JHp;__webpackgi_exports__2.bGH;__webpackgi_exports__2.NDo;__webpackgi_exports__2.gSk;__webpackgi_exports__2.WMw;__webpackgi_exports__2.OTo;__webpackgi_exports__2.Se2;__webpackgi_exports__2.cum;__webpackgi_exports__2.Mig;__webpackgi_exports__2.B$7;__webpackgi_exports__2.i_9;__webpackgi_exports__2.bBp;__webpackgi_exports__2.m7l;__webpackgi_exports__2.sYA;__webpackgi_exports__2.Xcj;__webpackgi_exports__2.mzJ;__webpackgi_exports__2.ZZA;__webpackgi_exports__2.$Ph;__webpackgi_exports__2.T__;__webpackgi_exports__2.HkE;__webpackgi_exports__2.tGC;__webpackgi_exports__2.g1S;__webpackgi_exports__2.I$C;__webpackgi_exports__2.QIH;__webpackgi_exports__2._JE;__webpackgi_exports__2.SwW;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__2.ksm;__webpackgi_exports__2.jl_;__webpackgi_exports__2.b7R;__webpackgi_exports__2.BDV;__webpackgi_exports__2.Ea_;__webpackgi_exports__2.qff;__webpackgi_exports__2.tmC;__webpackgi_exports__2.BON;__webpackgi_exports__2.P40;__webpackgi_exports__2.wLL;__webpackgi_exports__2.iHO;__webpackgi_exports__2.BbS;__webpackgi_exports__2.kqm;__webpackgi_exports__2.Hmr;__webpackgi_exports__2.SJI;__webpackgi_exports__2.mTL;__webpackgi_exports__2.y8_;__webpackgi_exports__2._Li;__webpackgi_exports__2.w7U;__webpackgi_exports__2.g56;__webpackgi_exports__2.bj3;__webpackgi_exports__2.z81;__webpackgi_exports__2._MY;__webpackgi_exports__2.yEv;__webpackgi_exports__2.dFZ;__webpackgi_exports__2.N$j;__webpackgi_exports__2._YM;__webpackgi_exports__2.TUj;__webpackgi_exports__2.ZzF;__webpackgi_exports__2.qzb;__webpackgi_exports__2.GQ;__webpackgi_exports__2.nvb;__webpackgi_exports__2.DvJ;__webpackgi_exports__2.fQA;__webpackgi_exports__2.cPz;__webpackgi_exports__2.TlE;__webpackgi_exports__2.u9r;__webpackgi_exports__2.s4_;__webpackgi_exports__2.T95;__webpackgi_exports__2.F5w;__webpackgi_exports__2.NlP;__webpackgi_exports__2.$8Z;__webpackgi_exports__2.YYN;__webpackgi_exports__2.CtF;__webpackgi_exports__2.V1s;__webpackgi_exports__2.jOv;__webpackgi_exports__2.Rki;__webpackgi_exports__2.pzV;__webpackgi_exports__2.itZ;__webpackgi_exports__2.MMq;__webpackgi_exports__2.qKx;__webpackgi_exports__2.Hmi;__webpackgi_exports__2.X4S;__webpackgi_exports__2.vlJ;__webpackgi_exports__2.nPO;__webpackgi_exports__2.zcQ;__webpackgi_exports__2.GH1;__webpackgi_exports__2.ROQ;__webpackgi_exports__2.YN5;__webpackgi_exports__2.BVQ;__webpackgi_exports__2.YT8;__webpackgi_exports__2._DE;__webpackgi_exports__2.YGz;__webpackgi_exports__2.trn;__webpackgi_exports__2.zf8;__webpackgi_exports__2.uWy;__webpackgi_exports__2.wYQ;__webpackgi_exports__2.SUY;var __webpackgi_exports__Color=__webpackgi_exports__2.Ilk;__webpackgi_exports__2.R2R;__webpackgi_exports__2.epp;__webpackgi_exports__2.xmJ;__webpackgi_exports__2.GD$;__webpackgi_exports__2.Z_g;__webpackgi_exports__2.EB7;__webpackgi_exports__2.DqL;__webpackgi_exports__2._3;__webpackgi_exports__2.b_z;__webpackgi_exports__2.OCn;__webpackgi_exports__2.N_j;__webpackgi_exports__2.hNv;__webpackgi_exports__2._am;__webpackgi_exports__2.kB7;__webpackgi_exports__2.fY$;__webpackgi_exports__2.vxC;__webpackgi_exports__2.BtG;__webpackgi_exports__2.cBK;__webpackgi_exports__2.g8_;__webpackgi_exports__2.AXT;__webpackgi_exports__2.yj7;__webpackgi_exports__2.dYG;__webpackgi_exports__2.tm_;__webpackgi_exports__2.S2y;__webpackgi_exports__2.B02;__webpackgi_exports__2.PeU;__webpackgi_exports__2.Hyl;__webpackgi_exports__2.Wqd;__webpackgi_exports__2.c0Q;__webpackgi_exports__2.re0;__webpackgi_exports__2.Xaj;__webpackgi_exports__2.DUb;__webpackgi_exports__2.dZ3;__webpackgi_exports__2.m_w;__webpackgi_exports__2.fHI;__webpackgi_exports__2.LBq;__webpackgi_exports__2.Qww;__webpackgi_exports__2.CGV;__webpackgi_exports__2.JUT;__webpackgi_exports__2.p3g;__webpackgi_exports__2.IEO;__webpackgi_exports__2.yxD;__webpackgi_exports__2.CUS;__webpackgi_exports__2.A5E;__webpackgi_exports__2.zqG;__webpackgi_exports__2.PfX;__webpackgi_exports__2.Q1o;__webpackgi_exports__2.jfJ;__webpackgi_exports__2.T_J;__webpackgi_exports__2.tEQ;__webpackgi_exports__2.gb4;__webpackgi_exports__2.qkB;__webpackgi_exports__2.cvk;__webpackgi_exports__2.HWo;__webpackgi_exports__2.brP;__webpackgi_exports__2.$YQ;__webpackgi_exports__2.X8d;__webpackgi_exports__2.Zdt;__webpackgi_exports__2.yNB;__webpackgi_exports__2.h7x;__webpackgi_exports__2.Ox3;__webpackgi_exports__2.qtn;__webpackgi_exports__2.cBI;__webpackgi_exports__2.cU9;__webpackgi_exports__2.ntt;__webpackgi_exports__2.DT1;__webpackgi_exports__2.Kgo;__webpackgi_exports__2.ehD;__webpackgi_exports__2.fhJ;__webpackgi_exports__2.y1s;__webpackgi_exports__2.fSK;__webpackgi_exports__2.Vdb;__webpackgi_exports__2.l8J;__webpackgi_exports__2.dj0;__webpackgi_exports__2.QM0;__webpackgi_exports__2.n94;__webpackgi_exports__2.OIS;__webpackgi_exports__2.q8b;__webpackgi_exports__2.TOt;__webpackgi_exports__2.xaN;__webpackgi_exports__2.Ny0;__webpackgi_exports__2.NeD;__webpackgi_exports__2.Zof;__webpackgi_exports__2.N1Y;__webpackgi_exports__2.itK;__webpackgi_exports__2.eD;__webpackgi_exports__2.jwo;__webpackgi_exports__2.dSO;__webpackgi_exports__2.Bf4;__webpackgi_exports__2.USm;__webpackgi_exports__2.pBf;__webpackgi_exports__2.eBg;__webpackgi_exports__2.$Vf;__webpackgi_exports__2.O7d;__webpackgi_exports__2.ksq;__webpackgi_exports__2.hFL;__webpackgi_exports__2.gXf;__webpackgi_exports__2.hH6;__webpackgi_exports__2.izP;__webpackgi_exports__2.kpi;__webpackgi_exports__2.DwZ;__webpackgi_exports__2.kN3;__webpackgi_exports__2.e62;__webpackgi_exports__2.a$l;__webpackgi_exports__2.OM3;__webpackgi_exports__2.VzW;__webpackgi_exports__2.ybr;__webpackgi_exports__2.yo9;__webpackgi_exports__2.Dzq;__webpackgi_exports__2.zCA;__webpackgi_exports__2.$Bt;__webpackgi_exports__2.Wzm;__webpackgi_exports__2.Wl3;__webpackgi_exports__2.iWj;__webpackgi_exports__2.DNz;__webpackgi_exports__2.m1M;__webpackgi_exports__2.ylh;__webpackgi_exports__2.v9Y;__webpackgi_exports__2.LSk;__webpackgi_exports__2.LHE;__webpackgi_exports__2.KE0;__webpackgi_exports__2.KCF;__webpackgi_exports__2.a4n;__webpackgi_exports__2.NKC;__webpackgi_exports__2.jrv;__webpackgi_exports__2.zIH;__webpackgi_exports__2.Hfk;__webpackgi_exports__2.png;__webpackgi_exports__2.tAj;__webpackgi_exports__2.Eb_;__webpackgi_exports__2.SJj;__webpackgi_exports__2.cF0;__webpackgi_exports__2.BT2;__webpackgi_exports__2._8p;__webpackgi_exports__2.V5Z;__webpackgi_exports__2.s5b;__webpackgi_exports__2.BHZ;__webpackgi_exports__2.hkn;__webpackgi_exports__2.GFY;__webpackgi_exports__2.w$m;__webpackgi_exports__2.ksN;__webpackgi_exports__2.j4z;__webpackgi_exports__2.OAl;__webpackgi_exports__2.VLJ;__webpackgi_exports__2.C73;__webpackgi_exports__2.ZAu;__webpackgi_exports__2.ibP;__webpackgi_exports__2.lth;__webpackgi_exports__2._fI;__webpackgi_exports__2.hUN;__webpackgi_exports__2.cLu;__webpackgi_exports__2.vmT;__webpackgi_exports__2.Qpg;__webpackgi_exports__2.So8;__webpackgi_exports__2.eOv;__webpackgi_exports__2.Wjw;__webpackgi_exports__2.cJO;__webpackgi_exports__2.QRU;__webpackgi_exports__2.S3k;__webpackgi_exports__2.OPJ;__webpackgi_exports__2.PpQ;__webpackgi_exports__2.q_9;__webpackgi_exports__2.ZRs;__webpackgi_exports__2.oqc;__webpackgi_exports__2.T_x;__webpackgi_exports__2.lb7;__webpackgi_exports__2.L5s;__webpackgi_exports__2.$TI;__webpackgi_exports__2.SPe;__webpackgi_exports__2.aVm;__webpackgi_exports__2.j87;__webpackgi_exports__2.RNb;__webpackgi_exports__2.Kz5;__webpackgi_exports__2.vpT;__webpackgi_exports__2.kB5;__webpackgi_exports__2._C8;__webpackgi_exports__2.Syv;__webpackgi_exports__2.NMF;__webpackgi_exports__2.pIN;__webpackgi_exports__2.eMJ;__webpackgi_exports__2.rN7;__webpackgi_exports__2.iUp;__webpackgi_exports__2.GFd;__webpackgi_exports__2.x5V;__webpackgi_exports__2.tUh;__webpackgi_exports__2.z8B;__webpackgi_exports__2.vcl;__webpackgi_exports__2.GZb;__webpackgi_exports__2.p7y;__webpackgi_exports__2.S9g;__webpackgi_exports__2.Zr5;__webpackgi_exports__2.vCF;__webpackgi_exports__2.yt0;__webpackgi_exports__2.uXU;__webpackgi_exports__2._kC;__webpackgi_exports__2.lk7;__webpackgi_exports__2.USc;__webpackgi_exports__2.x12;__webpackgi_exports__2.w_R;__webpackgi_exports__2.Zzh;__webpackgi_exports__2.nls;__webpackgi_exports__2.g_z;__webpackgi_exports__2.U7;__webpackgi_exports__2.FT0;__webpackgi_exports__2.L1_;__webpackgi_exports__2.blk;__webpackgi_exports__2.YRm;__webpackgi_exports__2.ejS;__webpackgi_exports__2.wUb;__webpackgi_exports__2.zOz;__webpackgi_exports__2.rnI;__webpackgi_exports__2.wem;__webpackgi_exports__2.lfu;__webpackgi_exports__2.FDw;__webpackgi_exports__2.lRj;__webpackgi_exports__2.D1R;__webpackgi_exports__2.qyh;__webpackgi_exports__2.GUF;__webpackgi_exports__2.EoG;__webpackgi_exports__2.aNw;__webpackgi_exports__2.Zp0;__webpackgi_exports__2.lLk;__webpackgi_exports__2.jAl;__webpackgi_exports__2.uEv;__webpackgi_exports__2.YKA;__webpackgi_exports__2.cRx;__webpackgi_exports__2.Y8D;__webpackgi_exports__2.RsA;__webpackgi_exports__2.Y0m;__webpackgi_exports__2.F5T;__webpackgi_exports__2.EDU;__webpackgi_exports__2.z$Q;__webpackgi_exports__2.KA8;__webpackgi_exports__2.ZqF;__webpackgi_exports__2.XUj;__webpackgi_exports__2.Me$;__webpackgi_exports__2.u7G;__webpackgi_exports__2.PEk;__webpackgi_exports__2.BG4;__webpackgi_exports__2.M8C;__webpackgi_exports__2.Vkp;__webpackgi_exports__2.yGw;__webpackgi_exports__2.Sm8;__webpackgi_exports__2.Kj0;__webpackgi_exports__2.vBJ;__webpackgi_exports__2.QfV;__webpackgi_exports__2.lRF;__webpackgi_exports__2.Lun;__webpackgi_exports__2.YBo;__webpackgi_exports__2.kaV;__webpackgi_exports__2.RSm;__webpackgi_exports__2.xoR;__webpackgi_exports__2.EJi;__webpackgi_exports__2.Wid;__webpackgi_exports__2.iuj;__webpackgi_exports__2.IKL;__webpackgi_exports__2.r_;__webpackgi_exports__2.OoA;__webpackgi_exports__2.qhX;__webpackgi_exports__2.CRe;__webpackgi_exports__2.qPT;__webpackgi_exports__2.M5h;__webpackgi_exports__2.Ns1;__webpackgi_exports__2.TyD;__webpackgi_exports__2.vZf;__webpackgi_exports__2.HTd;__webpackgi_exports__2.aH4;__webpackgi_exports__2.YLQ;__webpackgi_exports__2.BVF;__webpackgi_exports__2.MyG;__webpackgi_exports__2.jFi;__webpackgi_exports__2.aCh;__webpackgi_exports__2.uL9;__webpackgi_exports__2.TNj;__webpackgi_exports__2.IFH;__webpackgi_exports__2.bdR;__webpackgi_exports__2.RPs;__webpackgi_exports__2.kM_;__webpackgi_exports__2.M6v;__webpackgi_exports__2.RvT;__webpackgi_exports__2.dUE;__webpackgi_exports__2.oe_;__webpackgi_exports__2.BuN;__webpackgi_exports__2.Tme;__webpackgi_exports__2.N9P;__webpackgi_exports__2.tfP;__webpackgi_exports__2.Gql;__webpackgi_exports__2.$XY;__webpackgi_exports__2.O9d;__webpackgi_exports__2.zEO;__webpackgi_exports__2.qfx;__webpackgi_exports__2.PA7;__webpackgi_exports__2.REq;__webpackgi_exports__2.pQR;__webpackgi_exports__2.ghN;__webpackgi_exports__2.Hy8;__webpackgi_exports__2.Wpd;__webpackgi_exports__2.LgZ;__webpackgi_exports__2.iWC;__webpackgi_exports__2.mqn;__webpackgi_exports__2.SKe;__webpackgi_exports__2.iKG;__webpackgi_exports__2.rCq;__webpackgi_exports__2._iA;__webpackgi_exports__2.ntZ;__webpackgi_exports__2.anP;__webpackgi_exports__2.X2e;__webpackgi_exports__2.oxT;__webpackgi_exports__2.FCo;__webpackgi_exports__2.y$t;__webpackgi_exports__2.cPb;__webpackgi_exports__2.lmx;__webpackgi_exports__2.JOQ;__webpackgi_exports__2.BKK;__webpackgi_exports__2._12;__webpackgi_exports__2.tJx;__webpackgi_exports__2.mjX;__webpackgi_exports__2.cek;__webpackgi_exports__2.qD0;__webpackgi_exports__2.xG9;__webpackgi_exports__2.eqi;__webpackgi_exports__2.wI8;__webpackgi_exports__2.Sgv;__webpackgi_exports__2.woe;__webpackgi_exports__2.UY4;__webpackgi_exports__2.aq0;__webpackgi_exports__2.ujx;__webpackgi_exports__2.Uol;__webpackgi_exports__2.JiH;__webpackgi_exports__2.VYz;__webpackgi_exports__2.B2H;__webpackgi_exports__2._Pm;__webpackgi_exports__2.EsW;__webpackgi_exports__2.iUV;__webpackgi_exports__2.tf;__webpackgi_exports__2.ZQ6;__webpackgi_exports__2.mXe;__webpackgi_exports__2._fP;__webpackgi_exports__2.iLg;__webpackgi_exports__2.zbs;__webpackgi_exports__2.ZTh;__webpackgi_exports__2.HdW;__webpackgi_exports__2.UZH;__webpackgi_exports__2.mSO;__webpackgi_exports__2.wk1;__webpackgi_exports__2.E2K;__webpackgi_exports__2.FUD;__webpackgi_exports__2.pKu;__webpackgi_exports__2.GG6;__webpackgi_exports__2.Gih;__webpackgi_exports__2.iiP;__webpackgi_exports__2.SvJ;__webpackgi_exports__2.ptH;__webpackgi_exports__2.jZA;__webpackgi_exports__2.y2t;__webpackgi_exports__2.gi4;__webpackgi_exports__2.Djp;__webpackgi_exports__2.BG$;__webpackgi_exports__2.NYV;__webpackgi_exports__2.xJs;__webpackgi_exports__2.bsb;__webpackgi_exports__2.ekQ;__webpackgi_exports__2.CaW;__webpackgi_exports__2.eaV;__webpackgi_exports__2.BFQ;__webpackgi_exports__2.v3W;__webpackgi_exports__2.ILR;__webpackgi_exports__2.G_r;__webpackgi_exports__2.N3F;__webpackgi_exports__2.fto;__webpackgi_exports__2.l0P;__webpackgi_exports__2.vCx;__webpackgi_exports__2._AM;__webpackgi_exports__2.wuA;__webpackgi_exports__2.av9;__webpackgi_exports__2.CtA;__webpackgi_exports__2.BvQ;__webpackgi_exports__2.FZJ;__webpackgi_exports__2.FIo;__webpackgi_exports__2.zHn;__webpackgi_exports__2.iMs;__webpackgi_exports__2.T_f;__webpackgi_exports__2.hEm;__webpackgi_exports__2.D9w;__webpackgi_exports__2.sHH;__webpackgi_exports__2.CdI;__webpackgi_exports__2.rkc;__webpackgi_exports__2.rpg;__webpackgi_exports__2.ce8;__webpackgi_exports__2.rOj;__webpackgi_exports__2.P6m;__webpackgi_exports__2.JA6;__webpackgi_exports__2.V4E;__webpackgi_exports__2.o8S;__webpackgi_exports__2.flB;__webpackgi_exports__2.lGU;__webpackgi_exports__2.vuL;__webpackgi_exports__2.KI_;__webpackgi_exports__2.iLN;__webpackgi_exports__2.X6w;__webpackgi_exports__2.rz_;__webpackgi_exports__2.jsw;__webpackgi_exports__2.srG;__webpackgi_exports__2.i6Z;__webpackgi_exports__2.vfv;__webpackgi_exports__2.xsS;__webpackgi_exports__2.or;__webpackgi_exports__2.EQj;__webpackgi_exports__2.Rnn;__webpackgi_exports__2.TyN;__webpackgi_exports__2.ov0;__webpackgi_exports__2.WdD;__webpackgi_exports__2.Vj0;__webpackgi_exports__2.jyz;__webpackgi_exports__2.mTM;__webpackgi_exports__2.Mn1;__webpackgi_exports__2.Hlq;__webpackgi_exports__2.Fi7;__webpackgi_exports__2.Tn7;__webpackgi_exports__2.bnF;__webpackgi_exports__2.HW6;__webpackgi_exports__2.oa8;__webpackgi_exports__2.T_1;__webpackgi_exports__2.zHJ;__webpackgi_exports__2.iDF;__webpackgi_exports__2.iAb;__webpackgi_exports__2.d4E;__webpackgi_exports__2.lBg;__webpackgi_exports__2.JeJ;__webpackgi_exports__2.FKY;__webpackgi_exports__2.zlZ;__webpackgi_exports__2.vkg;__webpackgi_exports__2.brh;__webpackgi_exports__2.kZK;__webpackgi_exports__2.puG;__webpackgi_exports__2.OdW;__webpackgi_exports__2._YX;__webpackgi_exports__2.TUv;__webpackgi_exports__2.Hw6;__webpackgi_exports__2.aLr;__webpackgi_exports__2.Aip;__webpackgi_exports__2.xo$;__webpackgi_exports__2.bIn;__webpackgi_exports__2.$V;__webpackgi_exports__2.lDi;__webpackgi_exports__2.gti;__webpackgi_exports__2.PMe;__webpackgi_exports__2.iwP;__webpackgi_exports__2.FvO;__webpackgi_exports__2.jyi;__webpackgi_exports__2.xeV;__webpackgi_exports__2.k74;__webpackgi_exports__2.RlZ;__webpackgi_exports__2.KhW;__webpackgi_exports__2.HgB;__webpackgi_exports__2.W2J;__webpackgi_exports__2.JWc;__webpackgi_exports__2.u37;__webpackgi_exports__2.Z6B;__webpackgi_exports__2.QZ1;__webpackgi_exports__2.Ir4;__webpackgi_exports__2.NwF;__webpackgi_exports__2.Wbm;__webpackgi_exports__2.N4l;__webpackgi_exports__2.Jxm;__webpackgi_exports__2.ej9;__webpackgi_exports__2.QmN;__webpackgi_exports__2.Y4W;__webpackgi_exports__2.IOt;__webpackgi_exports__2.NOD;__webpackgi_exports__2.L5g;__webpackgi_exports__2.H$k;__webpackgi_exports__2.cuP;var __webpackgi_exports__Texture=__webpackgi_exports__2.xEZ;__webpackgi_exports__2.dpR;__webpackgi_exports__2.wOD;__webpackgi_exports__2.KNb;__webpackgi_exports__2.IiN;__webpackgi_exports__2.Cne;__webpackgi_exports__2.XvJ;__webpackgi_exports__2.XZw;__webpackgi_exports__2.FE5;__webpackgi_exports__2.Mck;__webpackgi_exports__2.lVp;__webpackgi_exports__2.CJI;__webpackgi_exports__2.z$h;__webpackgi_exports__2.UlW;__webpackgi_exports__2.WwZ;__webpackgi_exports__2.zG7;__webpackgi_exports__2.Lcc;__webpackgi_exports__2.WXh;__webpackgi_exports__2.Vjr;__webpackgi_exports__2.LuM;__webpackgi_exports__2.LP5;__webpackgi_exports__2.ub3;__webpackgi_exports__2.OV;__webpackgi_exports__2.G_n;__webpackgi_exports__2.xfE;__webpackgi_exports__2.qlB;__webpackgi_exports__2.lCJ;__webpackgi_exports__2.WTc;__webpackgi_exports__2.rAo;__webpackgi_exports__2.LZj;__webpackgi_exports__2.xWb;__webpackgi_exports__2.gH0;__webpackgi_exports__2.rBU;__webpackgi_exports__2.rDY;__webpackgi_exports__2.ywz;__webpackgi_exports__2.wJv;__webpackgi_exports__2.JQ4;__webpackgi_exports__2.k0A;__webpackgi_exports__2.irR;__webpackgi_exports__2.LsT;__webpackgi_exports__2.q5h;__webpackgi_exports__2.TKh;__webpackgi_exports__2.tyg;__webpackgi_exports__2.Ro5;__webpackgi_exports__2.dwk;__webpackgi_exports__2.t0w;__webpackgi_exports__2.M7$;__webpackgi_exports__2.ML4;__webpackgi_exports__2.FM8;__webpackgi_exports__2.Pa4;__webpackgi_exports__2.Ltg;__webpackgi_exports__2.yC1;__webpackgi_exports__2.lHq;__webpackgi_exports__2.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__2.oMA;__webpackgi_exports__2.JzW;__webpackgi_exports__2.QEt;__webpackgi_exports__2.IFZ;__webpackgi_exports__2.b5g;__webpackgi_exports__2.Ywn;__webpackgi_exports__2.GVz;__webpackgi_exports__2.oAp;__webpackgi_exports__2.kFz;__webpackgi_exports__2.dd2;__webpackgi_exports__2.CP7;__webpackgi_exports__2.fQK;__webpackgi_exports__2.Wd$;__webpackgi_exports__2.t1_;__webpackgi_exports__2.v27;__webpackgi_exports__2.Uk6;__webpackgi_exports__2.H7Z;__webpackgi_exports__2._sL;__webpackgi_exports__2.czO;__webpackgi_exports__2.Pnf;__webpackgi_exports__2.c8b;__webpackgi_exports__2._lf;__webpackgi_exports__2.ad5;__webpackgi_exports__2.sZV;__webpackgi_exports__2.TfA;__webpackgi_exports__2.sKX;__webpackgi_exports__2.UdM;__webpackgi_exports__2.P0y;__webpackgi_exports__2.L_r;__webpackgi_exports__2.zC5;var __webpackgi_exports__addBasePlugins=__webpackgi_exports__2.Bve;__webpackgi_exports__2.b5G;__webpackgi_exports__2.UeO;__webpackgi_exports__2.qCx;__webpackgi_exports__2.$nx;__webpackgi_exports__2.Bk6;__webpackgi_exports__2.EER;__webpackgi_exports__2.y4l;__webpackgi_exports__2.P39;__webpackgi_exports__2.HI1;__webpackgi_exports__2.ZYi;__webpackgi_exports__2.wXW;__webpackgi_exports__2.r5x;__webpackgi_exports__2.MSI;__webpackgi_exports__2.EUu;__webpackgi_exports__2.jtH;__webpackgi_exports__2.T0T;__webpackgi_exports__2.gAb;__webpackgi_exports__2.je_;__webpackgi_exports__2.wBP;__webpackgi_exports__2.LU2;__webpackgi_exports__2.wQL;__webpackgi_exports__2.Zs7;__webpackgi_exports__2.sMc;__webpackgi_exports__2.x7s;__webpackgi_exports__2.Mnd;__webpackgi_exports__2.A0_;__webpackgi_exports__2.d73;__webpackgi_exports__2.HCD;__webpackgi_exports__2.YQ8;__webpackgi_exports__2.RG9;__webpackgi_exports__2.G2P;__webpackgi_exports__2.XLf;__webpackgi_exports__2.CGN;__webpackgi_exports__2.RGi;__webpackgi_exports__2.mvg;__webpackgi_exports__2.Hiy;__webpackgi_exports__2.XMc;__webpackgi_exports__2.N7M;__webpackgi_exports__2.iv;__webpackgi_exports__2.n55;__webpackgi_exports__2.IaC;__webpackgi_exports__2.h9t;__webpackgi_exports__2.yDW;__webpackgi_exports__2.gJv;__webpackgi_exports__2.l$g;__webpackgi_exports__2.vQi;__webpackgi_exports__2.$MY;__webpackgi_exports__2.wJl;__webpackgi_exports__2.Z7Y;__webpackgi_exports__2.X7D;__webpackgi_exports__2.BnX;__webpackgi_exports__2.uZ5;__webpackgi_exports__2.zVI;__webpackgi_exports__2.Wz1;__webpackgi_exports__2.DpF;__webpackgi_exports__2.nNb;__webpackgi_exports__2.cqZ;__webpackgi_exports__2.pKN;__webpackgi_exports__2.CN8;__webpackgi_exports__2.DdI;__webpackgi_exports__2.rrX;__webpackgi_exports__2.uqj;__webpackgi_exports__2.Z9P;__webpackgi_exports__2.KlC;__webpackgi_exports__2.KVn;__webpackgi_exports__2.oau;__webpackgi_exports__2.aw9;__webpackgi_exports__2.Aap;__webpackgi_exports__2.Dxg;__webpackgi_exports__2.MjT;__webpackgi_exports__2.F7Q;__webpackgi_exports__2.IFq;__webpackgi_exports__2.IJl;__webpackgi_exports__2.O5A;__webpackgi_exports__2.wCn;__webpackgi_exports__2.gGT;__webpackgi_exports__2.pEc;__webpackgi_exports__2.Bi6;__webpackgi_exports__2.fi_;__webpackgi_exports__2.TT;__webpackgi_exports__2.q2Z;__webpackgi_exports__2.NyK;__webpackgi_exports__2.bgu;__webpackgi_exports__2.kcS;__webpackgi_exports__2.rRN;__webpackgi_exports__2.ivY;__webpackgi_exports__2._s1;__webpackgi_exports__2._HO;__webpackgi_exports__2.tpL;__webpackgi_exports__2.DMK;__webpackgi_exports__2.LjN;__webpackgi_exports__2.iFs;__webpackgi_exports__2.qTg;__webpackgi_exports__2.J4G;__webpackgi_exports__2.Zj8;__webpackgi_exports__2.Wtl;__webpackgi_exports__2.DmK;__webpackgi_exports__2.Htt;__webpackgi_exports__2.Nv0;__webpackgi_exports__2.tCp;__webpackgi_exports__2.Hx7;__webpackgi_exports__2.imt;__webpackgi_exports__2.US6;__webpackgi_exports__2.vZs;__webpackgi_exports__2.TE$;__webpackgi_exports__2.lmu;__webpackgi_exports__2.SvO;__webpackgi_exports__2.YQY;__webpackgi_exports__2.mZN;__webpackgi_exports__2.VvG;__webpackgi_exports__2.omp;__webpackgi_exports__2.utz;__webpackgi_exports__2.TFV;__webpackgi_exports__2.hrz;__webpackgi_exports__2.H$s;__webpackgi_exports__2.JKM;__webpackgi_exports__2.jZf;__webpackgi_exports__2.RjL;__webpackgi_exports__2.RRI;__webpackgi_exports__2.RUq;__webpackgi_exports__2._t4;__webpackgi_exports__2.YHh;__webpackgi_exports__2.R8g;__webpackgi_exports__2.f1L;__webpackgi_exports__2.Bbl;__webpackgi_exports__2.V9r;__webpackgi_exports__2.a95;__webpackgi_exports__2.PZ2;__webpackgi_exports__2.w7A;__webpackgi_exports__2.N6S;__webpackgi_exports__2.Uxp;__webpackgi_exports__2.tAz;__webpackgi_exports__2.R$F;__webpackgi_exports__2.N33;__webpackgi_exports__2.JFD;__webpackgi_exports__2.gw2;__webpackgi_exports__2.rfc;__webpackgi_exports__2.wo6;__webpackgi_exports__2.V4T;__webpackgi_exports__2.H4P;__webpackgi_exports__2.NLp;__webpackgi_exports__2.swA;__webpackgi_exports__2._Z3;__webpackgi_exports__2.ivc;__webpackgi_exports__2.rZ1;__webpackgi_exports__2.CpZ;__webpackgi_exports__2.dyc;__webpackgi_exports__2.MxZ;__webpackgi_exports__2.btp;__webpackgi_exports__2.mXy;__webpackgi_exports__2.Ej0;__webpackgi_exports__2.ep4;__webpackgi_exports__2.DQP;__webpackgi_exports__2.VNr;__webpackgi_exports__2.V7q;__webpackgi_exports__2.hiB;__webpackgi_exports__2.zEk;__webpackgi_exports__2.qfq;__webpackgi_exports__2.piB;__webpackgi_exports__2.IIc;__webpackgi_exports__2.rrF;__webpackgi_exports__2.naq;__webpackgi_exports__2.zlD;__webpackgi_exports__2.sXR;__webpackgi_exports__2.p5I;__webpackgi_exports__2.wps;__webpackgi_exports__2.wuo;__webpackgi_exports__2.GpE;__webpackgi_exports__2.F4b;__webpackgi_exports__2.NN$;__webpackgi_exports__2.t$v;__webpackgi_exports__2.tdn;__webpackgi_exports__2.Y9t;__webpackgi_exports__2.GEo;__webpackgi_exports__2.GGm;__webpackgi_exports__2.DH3;__webpackgi_exports__2.uxM;__webpackgi_exports__2.zH3;__webpackgi_exports__2.MLs;__webpackgi_exports__2.xXG;__webpackgi_exports__2.YM4;__webpackgi_exports__2.B3r;__webpackgi_exports__2.iAx;__webpackgi_exports__2.lDn;__webpackgi_exports__2.P1O;__webpackgi_exports__2.iib;__webpackgi_exports__2.qf5;__webpackgi_exports__2.n4s;__webpackgi_exports__2.fr;__webpackgi_exports__2.Z9s;__webpackgi_exports__2.oaQ;__webpackgi_exports__2.CD7;__webpackgi_exports__2.Rc0;__webpackgi_exports__2.iPG;__webpackgi_exports__2.TIc;__webpackgi_exports__2.xsC;__webpackgi_exports__2.zOc;__webpackgi_exports__2.i8W;__webpackgi_exports__2.r46;__webpackgi_exports__2.z2C;__webpackgi_exports__2.N4A;__webpackgi_exports__2.hjq;__webpackgi_exports__2._X$;__webpackgi_exports__2._yn;__webpackgi_exports__2.Dyg;__webpackgi_exports__2.cUc;__webpackgi_exports__2.zGw;__webpackgi_exports__2.Ctq;__webpackgi_exports__2.$ch;__webpackgi_exports__2.k5b;__webpackgi_exports__2.kZl;__webpackgi_exports__2.OCg;__webpackgi_exports__2.Kd3;__webpackgi_exports__2.YjH;__webpackgi_exports__2.Ui8;__webpackgi_exports__2.YD2;__webpackgi_exports__2.vi9;__webpackgi_exports__2.ij3;__webpackgi_exports__2.pJq;__webpackgi_exports__2.YPW;__webpackgi_exports__2._tY;__webpackgi_exports__2.Bg1;__webpackgi_exports__2.kon;__webpackgi_exports__2.M3g;__webpackgi_exports__2.F2z;__webpackgi_exports__2.pJF;__webpackgi_exports__2.knz;__webpackgi_exports__2.Ejo;__webpackgi_exports__2.BgY;__webpackgi_exports__2.qCG;__webpackgi_exports__2.HD9;__webpackgi_exports__2.Rgz;__webpackgi_exports__2.fEB;__webpackgi_exports__2.Udc;__webpackgi_exports__2.ZQg;__webpackgi_exports__2.ofC;__webpackgi_exports__2.yRy;__webpackgi_exports__2._NL;__webpackgi_exports__2.LCA;__webpackgi_exports__2.Sy1;__webpackgi_exports__2.Vs_;__webpackgi_exports__2.j1w;__webpackgi_exports__2.i8J;__webpackgi_exports__2.p7C;__webpackgi_exports__2.ZAS;__webpackgi_exports__2.ipH;__webpackgi_exports__2.$TF;__webpackgi_exports__2.uZI;__webpackgi_exports__2.VWG;__webpackgi_exports__2.pQ7;__webpackgi_exports__2.STw;__webpackgi_exports__2.jc8;__webpackgi_exports__2.BL_;__webpackgi_exports__2.S6;__webpackgi_exports__2.T8U;__webpackgi_exports__2.TD6;__webpackgi_exports__2.akS;__webpackgi_exports__2.QKE;__webpackgi_exports__2.dKx;__webpackgi_exports__2.OvX;__webpackgi_exports__2.doP;__webpackgi_exports__2.$jA;__webpackgi_exports__2.T99;__webpackgi_exports__2.LJS;__webpackgi_exports__2.VsW;__webpackgi_exports__2.LZE;__webpackgi_exports__2.YMc;__webpackgi_exports__2.aPg;__webpackgi_exports__2.LFn;__webpackgi_exports__2.VsX;__webpackgi_exports__2.wey;__webpackgi_exports__2.MaE;__webpackgi_exports__2.s4x;__webpackgi_exports__2.FJA;__webpackgi_exports__2.vIA;__webpackgi_exports__2.Spv;__webpackgi_exports__2.w8l;__webpackgi_exports__2.riG;__webpackgi_exports__2.Kbh;__webpackgi_exports__2.BFq;__webpackgi_exports__2.t8K;__webpackgi_exports__2.Q7n;__webpackgi_exports__2.KGF;__webpackgi_exports__2.e5;__webpackgi_exports__2.Rik;__webpackgi_exports__2.GZo;__webpackgi_exports__2.Bds;__webpackgi_exports__2.HTu;__webpackgi_exports__2.cTq;__webpackgi_exports__2.X_Y;__webpackgi_exports__2.dA8;__webpackgi_exports__2.NSm;__webpackgi_exports__2.bwS;__webpackgi_exports__2.Lks;__webpackgi_exports__2.Rvq;__webpackgi_exports__2.P4F;__webpackgi_exports__2.Pd0;__webpackgi_exports__2.Pjo;__webpackgi_exports__2.Tum;__webpackgi_exports__2.dRH;__webpackgi_exports__2.RX0;__webpackgi_exports__2.reQ;__webpackgi_exports__2.cWm;__webpackgi_exports__2.NC9;__webpackgi_exports__2.$Re;__webpackgi_exports__2.Xo9;__webpackgi_exports__2.LNO;__webpackgi_exports__2.iZP;/*! Bundled license information:

webgi/dist/examples/runtime/bundle.m.js:
  (*! For license information please see bundle.m.js.LICENSE.txt *)
*/var REVISION="170",FrontSide=0,BackSide=1,NormalBlending=1,AddEquation=100,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,LessEqualDepth=3,MultiplyOperation=0,UVMapping=300,CubeReflectionMapping=301,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,LinearFilter=1006,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,UnsignedIntType=1014,FloatType=1015,UnsignedInt248Type=1020,RGBAFormat=1023,DepthFormat=1026,DepthStencilFormat=1027,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",KeepStencilOp=7680,AlwaysStencilFunc=519,StaticDrawUsage=35044,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001,EventDispatcher=class{addEventListener(T,g){this._listeners===void 0&&(this._listeners={});const u=this._listeners;u[T]===void 0&&(u[T]=[]),u[T].indexOf(g)===-1&&u[T].push(g)}hasEventListener(T,g){if(this._listeners===void 0)return!1;const u=this._listeners;return u[T]!==void 0&&u[T].indexOf(g)!==-1}removeEventListener(T,g){if(this._listeners===void 0)return;const O=this._listeners[T];if(O!==void 0){const z=O.indexOf(g);z!==-1&&O.splice(z,1)}}dispatchEvent(T){if(this._listeners===void 0)return;const u=this._listeners[T.type];if(u!==void 0){T.target=this;const O=u.slice(0);for(let z=0,W=O.length;z<W;z++)O[z].call(this,T);T.target=null}}},_lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function generateUUID(){const T=Math.random()*4294967295|0,g=Math.random()*4294967295|0,u=Math.random()*4294967295|0,O=Math.random()*4294967295|0;return(_lut[T&255]+_lut[T>>8&255]+_lut[T>>16&255]+_lut[T>>24&255]+"-"+_lut[g&255]+_lut[g>>8&255]+"-"+_lut[g>>16&15|64]+_lut[g>>24&255]+"-"+_lut[u&63|128]+_lut[u>>8&255]+"-"+_lut[u>>16&255]+_lut[u>>24&255]+_lut[O&255]+_lut[O>>8&255]+_lut[O>>16&255]+_lut[O>>24&255]).toLowerCase()}function clamp(T,g,u){return Math.max(g,Math.min(u,T))}function euclideanModulo(T,g){return(T%g+g)%g}function lerp(T,g,u){return(1-u)*T+u*g}function denormalize(T,g){switch(g.constructor){case Float32Array:return T;case Uint32Array:return T/4294967295;case Uint16Array:return T/65535;case Uint8Array:return T/255;case Int32Array:return Math.max(T/2147483647,-1);case Int16Array:return Math.max(T/32767,-1);case Int8Array:return Math.max(T/127,-1);default:throw new Error("Invalid component type.")}}function normalize(T,g){switch(g.constructor){case Float32Array:return T;case Uint32Array:return Math.round(T*4294967295);case Uint16Array:return Math.round(T*65535);case Uint8Array:return Math.round(T*255);case Int32Array:return Math.round(T*2147483647);case Int16Array:return Math.round(T*32767);case Int8Array:return Math.round(T*127);default:throw new Error("Invalid component type.")}}var Vector2=class gR{constructor(g=0,u=0){gR.prototype.isVector2=!0,this.x=g,this.y=u}get width(){return this.x}set width(g){this.x=g}get height(){return this.y}set height(g){this.y=g}set(g,u){return this.x=g,this.y=u,this}setScalar(g){return this.x=g,this.y=g,this}setX(g){return this.x=g,this}setY(g){return this.y=g,this}setComponent(g,u){switch(g){case 0:this.x=u;break;case 1:this.y=u;break;default:throw new Error("index is out of range: "+g)}return this}getComponent(g){switch(g){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+g)}}clone(){return new this.constructor(this.x,this.y)}copy(g){return this.x=g.x,this.y=g.y,this}add(g){return this.x+=g.x,this.y+=g.y,this}addScalar(g){return this.x+=g,this.y+=g,this}addVectors(g,u){return this.x=g.x+u.x,this.y=g.y+u.y,this}addScaledVector(g,u){return this.x+=g.x*u,this.y+=g.y*u,this}sub(g){return this.x-=g.x,this.y-=g.y,this}subScalar(g){return this.x-=g,this.y-=g,this}subVectors(g,u){return this.x=g.x-u.x,this.y=g.y-u.y,this}multiply(g){return this.x*=g.x,this.y*=g.y,this}multiplyScalar(g){return this.x*=g,this.y*=g,this}divide(g){return this.x/=g.x,this.y/=g.y,this}divideScalar(g){return this.multiplyScalar(1/g)}applyMatrix3(g){const u=this.x,O=this.y,z=g.elements;return this.x=z[0]*u+z[3]*O+z[6],this.y=z[1]*u+z[4]*O+z[7],this}min(g){return this.x=Math.min(this.x,g.x),this.y=Math.min(this.y,g.y),this}max(g){return this.x=Math.max(this.x,g.x),this.y=Math.max(this.y,g.y),this}clamp(g,u){return this.x=Math.max(g.x,Math.min(u.x,this.x)),this.y=Math.max(g.y,Math.min(u.y,this.y)),this}clampScalar(g,u){return this.x=Math.max(g,Math.min(u,this.x)),this.y=Math.max(g,Math.min(u,this.y)),this}clampLength(g,u){const O=this.length();return this.divideScalar(O||1).multiplyScalar(Math.max(g,Math.min(u,O)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(g){return this.x*g.x+this.y*g.y}cross(g){return this.x*g.y-this.y*g.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(g){const u=Math.sqrt(this.lengthSq()*g.lengthSq());if(u===0)return Math.PI/2;const O=this.dot(g)/u;return Math.acos(clamp(O,-1,1))}distanceTo(g){return Math.sqrt(this.distanceToSquared(g))}distanceToSquared(g){const u=this.x-g.x,O=this.y-g.y;return u*u+O*O}manhattanDistanceTo(g){return Math.abs(this.x-g.x)+Math.abs(this.y-g.y)}setLength(g){return this.normalize().multiplyScalar(g)}lerp(g,u){return this.x+=(g.x-this.x)*u,this.y+=(g.y-this.y)*u,this}lerpVectors(g,u,O){return this.x=g.x+(u.x-g.x)*O,this.y=g.y+(u.y-g.y)*O,this}equals(g){return g.x===this.x&&g.y===this.y}fromArray(g,u=0){return this.x=g[u],this.y=g[u+1],this}toArray(g=[],u=0){return g[u]=this.x,g[u+1]=this.y,g}fromBufferAttribute(g,u){return this.x=g.getX(u),this.y=g.getY(u),this}rotateAround(g,u){const O=Math.cos(u),z=Math.sin(u),W=this.x-g.x,J=this.y-g.y;return this.x=W*O-J*z+g.x,this.y=W*z+J*O+g.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Matrix3=class vR{constructor(g,u,O,z,W,J,se,Y,ie){vR.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],g!==void 0&&this.set(g,u,O,z,W,J,se,Y,ie)}set(g,u,O,z,W,J,se,Y,ie){const oe=this.elements;return oe[0]=g,oe[1]=z,oe[2]=se,oe[3]=u,oe[4]=W,oe[5]=Y,oe[6]=O,oe[7]=J,oe[8]=ie,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(g){const u=this.elements,O=g.elements;return u[0]=O[0],u[1]=O[1],u[2]=O[2],u[3]=O[3],u[4]=O[4],u[5]=O[5],u[6]=O[6],u[7]=O[7],u[8]=O[8],this}extractBasis(g,u,O){return g.setFromMatrix3Column(this,0),u.setFromMatrix3Column(this,1),O.setFromMatrix3Column(this,2),this}setFromMatrix4(g){const u=g.elements;return this.set(u[0],u[4],u[8],u[1],u[5],u[9],u[2],u[6],u[10]),this}multiply(g){return this.multiplyMatrices(this,g)}premultiply(g){return this.multiplyMatrices(g,this)}multiplyMatrices(g,u){const O=g.elements,z=u.elements,W=this.elements,J=O[0],se=O[3],Y=O[6],ie=O[1],oe=O[4],fe=O[7],me=O[2],de=O[5],Pe=O[8],ue=z[0],He=z[3],je=z[6],Fe=z[1],et=z[4],pt=z[7],Ge=z[2],Ye=z[5],$=z[8];return W[0]=J*ue+se*Fe+Y*Ge,W[3]=J*He+se*et+Y*Ye,W[6]=J*je+se*pt+Y*$,W[1]=ie*ue+oe*Fe+fe*Ge,W[4]=ie*He+oe*et+fe*Ye,W[7]=ie*je+oe*pt+fe*$,W[2]=me*ue+de*Fe+Pe*Ge,W[5]=me*He+de*et+Pe*Ye,W[8]=me*je+de*pt+Pe*$,this}multiplyScalar(g){const u=this.elements;return u[0]*=g,u[3]*=g,u[6]*=g,u[1]*=g,u[4]*=g,u[7]*=g,u[2]*=g,u[5]*=g,u[8]*=g,this}determinant(){const g=this.elements,u=g[0],O=g[1],z=g[2],W=g[3],J=g[4],se=g[5],Y=g[6],ie=g[7],oe=g[8];return u*J*oe-u*se*ie-O*W*oe+O*se*Y+z*W*ie-z*J*Y}invert(){const g=this.elements,u=g[0],O=g[1],z=g[2],W=g[3],J=g[4],se=g[5],Y=g[6],ie=g[7],oe=g[8],fe=oe*J-se*ie,me=se*Y-oe*W,de=ie*W-J*Y,Pe=u*fe+O*me+z*de;if(Pe===0)return this.set(0,0,0,0,0,0,0,0,0);const ue=1/Pe;return g[0]=fe*ue,g[1]=(z*ie-oe*O)*ue,g[2]=(se*O-z*J)*ue,g[3]=me*ue,g[4]=(oe*u-z*Y)*ue,g[5]=(z*W-se*u)*ue,g[6]=de*ue,g[7]=(O*Y-ie*u)*ue,g[8]=(J*u-O*W)*ue,this}transpose(){let g;const u=this.elements;return g=u[1],u[1]=u[3],u[3]=g,g=u[2],u[2]=u[6],u[6]=g,g=u[5],u[5]=u[7],u[7]=g,this}getNormalMatrix(g){return this.setFromMatrix4(g).invert().transpose()}transposeIntoArray(g){const u=this.elements;return g[0]=u[0],g[1]=u[3],g[2]=u[6],g[3]=u[1],g[4]=u[4],g[5]=u[7],g[6]=u[2],g[7]=u[5],g[8]=u[8],this}setUvTransform(g,u,O,z,W,J,se){const Y=Math.cos(W),ie=Math.sin(W);return this.set(O*Y,O*ie,-O*(Y*J+ie*se)+J+g,-z*ie,z*Y,-z*(-ie*J+Y*se)+se+u,0,0,1),this}scale(g,u){return this.premultiply(_m3.makeScale(g,u)),this}rotate(g){return this.premultiply(_m3.makeRotation(-g)),this}translate(g,u){return this.premultiply(_m3.makeTranslation(g,u)),this}makeTranslation(g,u){return g.isVector2?this.set(1,0,g.x,0,1,g.y,0,0,1):this.set(1,0,g,0,1,u,0,0,1),this}makeRotation(g){const u=Math.cos(g),O=Math.sin(g);return this.set(u,-O,0,O,u,0,0,0,1),this}makeScale(g,u){return this.set(g,0,0,0,u,0,0,0,1),this}equals(g){const u=this.elements,O=g.elements;for(let z=0;z<9;z++)if(u[z]!==O[z])return!1;return!0}fromArray(g,u=0){for(let O=0;O<9;O++)this.elements[O]=g[O+u];return this}toArray(g=[],u=0){const O=this.elements;return g[u]=O[0],g[u+1]=O[1],g[u+2]=O[2],g[u+3]=O[3],g[u+4]=O[4],g[u+5]=O[5],g[u+6]=O[6],g[u+7]=O[7],g[u+8]=O[8],g}clone(){return new this.constructor().fromArray(this.elements)}},_m3=new Matrix3;function arrayNeedsUint32(T){for(let g=T.length-1;g>=0;--g)if(T[g]>=65535)return!0;return!1}function createElementNS(T){return document.createElementNS("http://www.w3.org/1999/xhtml",T)}var ColorManagement={enabled:!0,workingColorSpace:LinearSRGBColorSpace,spaces:{},convert:function(T,g,u){return this.enabled===!1||g===u||!g||!u||(this.spaces[g].transfer===SRGBTransfer&&(T.r=SRGBToLinear(T.r),T.g=SRGBToLinear(T.g),T.b=SRGBToLinear(T.b)),this.spaces[g].primaries!==this.spaces[u].primaries&&(T.applyMatrix3(this.spaces[g].toXYZ),T.applyMatrix3(this.spaces[u].fromXYZ)),this.spaces[u].transfer===SRGBTransfer&&(T.r=LinearToSRGB(T.r),T.g=LinearToSRGB(T.g),T.b=LinearToSRGB(T.b))),T},fromWorkingColorSpace:function(T,g){return this.convert(T,this.workingColorSpace,g)},toWorkingColorSpace:function(T,g){return this.convert(T,g,this.workingColorSpace)},getPrimaries:function(T){return this.spaces[T].primaries},getTransfer:function(T){return T===NoColorSpace?LinearTransfer:this.spaces[T].transfer},getLuminanceCoefficients:function(T,g=this.workingColorSpace){return T.fromArray(this.spaces[g].luminanceCoefficients)},define:function(T){Object.assign(this.spaces,T)},_getMatrix:function(T,g,u){return T.copy(this.spaces[g].toXYZ).multiply(this.spaces[u].fromXYZ)},_getDrawingBufferColorSpace:function(T){return this.spaces[T].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(T=this.workingColorSpace){return this.spaces[T].workingColorSpaceConfig.unpackColorSpace}};function SRGBToLinear(T){return T<.04045?T*.0773993808:Math.pow(T*.9478672986+.0521327014,2.4)}function LinearToSRGB(T){return T<.0031308?T*12.92:1.055*Math.pow(T,.41666)-.055}var REC709_PRIMARIES=[.64,.33,.3,.6,.15,.06],REC709_LUMINANCE_COEFFICIENTS=[.2126,.7152,.0722],D65=[.3127,.329],LINEAR_REC709_TO_XYZ=new Matrix3().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=new Matrix3().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ColorManagement.define({[LinearSRGBColorSpace]:{primaries:REC709_PRIMARIES,whitePoint:D65,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:REC709_LUMINANCE_COEFFICIENTS,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}},[SRGBColorSpace]:{primaries:REC709_PRIMARIES,whitePoint:D65,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:REC709_LUMINANCE_COEFFICIENTS,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}}});var _canvas,ImageUtils=class{static getDataURL(T){if(/^data:/i.test(T.src)||typeof HTMLCanvasElement>"u")return T.src;let g;if(T instanceof HTMLCanvasElement)g=T;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=T.width,_canvas.height=T.height;const u=_canvas.getContext("2d");T instanceof ImageData?u.putImageData(T,0,0):u.drawImage(T,0,0,T.width,T.height),g=_canvas}return g.width>2048||g.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",T),g.toDataURL("image/jpeg",.6)):g.toDataURL("image/png")}static sRGBToLinear(T){if(typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&T instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&T instanceof ImageBitmap){const g=createElementNS("canvas");g.width=T.width,g.height=T.height;const u=g.getContext("2d");u.drawImage(T,0,0,T.width,T.height);const O=u.getImageData(0,0,T.width,T.height),z=O.data;for(let W=0;W<z.length;W++)z[W]=SRGBToLinear(z[W]/255)*255;return u.putImageData(O,0,0),g}else if(T.data){const g=T.data.slice(0);for(let u=0;u<g.length;u++)g instanceof Uint8Array||g instanceof Uint8ClampedArray?g[u]=Math.floor(SRGBToLinear(g[u]/255)*255):g[u]=SRGBToLinear(g[u]);return{data:g,width:T.width,height:T.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),T}},_sourceId=0,Source=class{constructor(T=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=T,this.dataReady=!0,this.version=0}set needsUpdate(T){T===!0&&this.version++}toJSON(T){const g=T===void 0||typeof T=="string";if(!g&&T.images[this.uuid]!==void 0)return T.images[this.uuid];const u={uuid:this.uuid,url:""},O=this.data;if(O!==null){let z;if(Array.isArray(O)){z=[];for(let W=0,J=O.length;W<J;W++)O[W].isDataTexture?z.push(serializeImage(O[W].image)):z.push(serializeImage(O[W]))}else z=serializeImage(O);u.url=z}return g||(T.images[this.uuid]=u),u}};function serializeImage(T){return typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&T instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&T instanceof ImageBitmap?ImageUtils.getDataURL(T):T.data?{data:Array.from(T.data),width:T.width,height:T.height,type:T.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var _textureId=0,Texture=class k1 extends EventDispatcher{constructor(g=k1.DEFAULT_IMAGE,u=k1.DEFAULT_MAPPING,O=ClampToEdgeWrapping,z=ClampToEdgeWrapping,W=LinearFilter,J=LinearMipmapLinearFilter,se=RGBAFormat,Y=UnsignedByteType,ie=k1.DEFAULT_ANISOTROPY,oe=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(g),this.mipmaps=[],this.mapping=u,this.channel=0,this.wrapS=O,this.wrapT=z,this.magFilter=W,this.minFilter=J,this.anisotropy=ie,this.format=se,this.internalFormat=null,this.type=Y,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=oe,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(g=null){this.source.data=g}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(g){return this.name=g.name,this.source=g.source,this.mipmaps=g.mipmaps.slice(0),this.mapping=g.mapping,this.channel=g.channel,this.wrapS=g.wrapS,this.wrapT=g.wrapT,this.magFilter=g.magFilter,this.minFilter=g.minFilter,this.anisotropy=g.anisotropy,this.format=g.format,this.internalFormat=g.internalFormat,this.type=g.type,this.offset.copy(g.offset),this.repeat.copy(g.repeat),this.center.copy(g.center),this.rotation=g.rotation,this.matrixAutoUpdate=g.matrixAutoUpdate,this.matrix.copy(g.matrix),this.generateMipmaps=g.generateMipmaps,this.premultiplyAlpha=g.premultiplyAlpha,this.flipY=g.flipY,this.unpackAlignment=g.unpackAlignment,this.colorSpace=g.colorSpace,this.userData=JSON.parse(JSON.stringify(g.userData)),this.needsUpdate=!0,this}toJSON(g){const u=g===void 0||typeof g=="string";if(!u&&g.textures[this.uuid]!==void 0)return g.textures[this.uuid];const O={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(g).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(O.userData=this.userData),u||(g.textures[this.uuid]=O),O}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(g){if(this.mapping!==UVMapping)return g;if(g.applyMatrix3(this.matrix),g.x<0||g.x>1)switch(this.wrapS){case RepeatWrapping:g.x=g.x-Math.floor(g.x);break;case ClampToEdgeWrapping:g.x=g.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(g.x)%2)===1?g.x=Math.ceil(g.x)-g.x:g.x=g.x-Math.floor(g.x);break}if(g.y<0||g.y>1)switch(this.wrapT){case RepeatWrapping:g.y=g.y-Math.floor(g.y);break;case ClampToEdgeWrapping:g.y=g.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(g.y)%2)===1?g.y=Math.ceil(g.y)-g.y:g.y=g.y-Math.floor(g.y);break}return this.flipY&&(g.y=1-g.y),g}set needsUpdate(g){g===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(g){g===!0&&this.pmremVersion++}};Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;var Vector4=class _R{constructor(g=0,u=0,O=0,z=1){_R.prototype.isVector4=!0,this.x=g,this.y=u,this.z=O,this.w=z}get width(){return this.z}set width(g){this.z=g}get height(){return this.w}set height(g){this.w=g}set(g,u,O,z){return this.x=g,this.y=u,this.z=O,this.w=z,this}setScalar(g){return this.x=g,this.y=g,this.z=g,this.w=g,this}setX(g){return this.x=g,this}setY(g){return this.y=g,this}setZ(g){return this.z=g,this}setW(g){return this.w=g,this}setComponent(g,u){switch(g){case 0:this.x=u;break;case 1:this.y=u;break;case 2:this.z=u;break;case 3:this.w=u;break;default:throw new Error("index is out of range: "+g)}return this}getComponent(g){switch(g){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+g)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(g){return this.x=g.x,this.y=g.y,this.z=g.z,this.w=g.w!==void 0?g.w:1,this}add(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this.w+=g.w,this}addScalar(g){return this.x+=g,this.y+=g,this.z+=g,this.w+=g,this}addVectors(g,u){return this.x=g.x+u.x,this.y=g.y+u.y,this.z=g.z+u.z,this.w=g.w+u.w,this}addScaledVector(g,u){return this.x+=g.x*u,this.y+=g.y*u,this.z+=g.z*u,this.w+=g.w*u,this}sub(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this.w-=g.w,this}subScalar(g){return this.x-=g,this.y-=g,this.z-=g,this.w-=g,this}subVectors(g,u){return this.x=g.x-u.x,this.y=g.y-u.y,this.z=g.z-u.z,this.w=g.w-u.w,this}multiply(g){return this.x*=g.x,this.y*=g.y,this.z*=g.z,this.w*=g.w,this}multiplyScalar(g){return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this}applyMatrix4(g){const u=this.x,O=this.y,z=this.z,W=this.w,J=g.elements;return this.x=J[0]*u+J[4]*O+J[8]*z+J[12]*W,this.y=J[1]*u+J[5]*O+J[9]*z+J[13]*W,this.z=J[2]*u+J[6]*O+J[10]*z+J[14]*W,this.w=J[3]*u+J[7]*O+J[11]*z+J[15]*W,this}divide(g){return this.x/=g.x,this.y/=g.y,this.z/=g.z,this.w/=g.w,this}divideScalar(g){return this.multiplyScalar(1/g)}setAxisAngleFromQuaternion(g){this.w=2*Math.acos(g.w);const u=Math.sqrt(1-g.w*g.w);return u<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=g.x/u,this.y=g.y/u,this.z=g.z/u),this}setAxisAngleFromRotationMatrix(g){let u,O,z,W;const Y=g.elements,ie=Y[0],oe=Y[4],fe=Y[8],me=Y[1],de=Y[5],Pe=Y[9],ue=Y[2],He=Y[6],je=Y[10];if(Math.abs(oe-me)<.01&&Math.abs(fe-ue)<.01&&Math.abs(Pe-He)<.01){if(Math.abs(oe+me)<.1&&Math.abs(fe+ue)<.1&&Math.abs(Pe+He)<.1&&Math.abs(ie+de+je-3)<.1)return this.set(1,0,0,0),this;u=Math.PI;const et=(ie+1)/2,pt=(de+1)/2,Ge=(je+1)/2,Ye=(oe+me)/4,$=(fe+ue)/4,le=(Pe+He)/4;return et>pt&&et>Ge?et<.01?(O=0,z=.707106781,W=.707106781):(O=Math.sqrt(et),z=Ye/O,W=$/O):pt>Ge?pt<.01?(O=.707106781,z=0,W=.707106781):(z=Math.sqrt(pt),O=Ye/z,W=le/z):Ge<.01?(O=.707106781,z=.707106781,W=0):(W=Math.sqrt(Ge),O=$/W,z=le/W),this.set(O,z,W,u),this}let Fe=Math.sqrt((He-Pe)*(He-Pe)+(fe-ue)*(fe-ue)+(me-oe)*(me-oe));return Math.abs(Fe)<.001&&(Fe=1),this.x=(He-Pe)/Fe,this.y=(fe-ue)/Fe,this.z=(me-oe)/Fe,this.w=Math.acos((ie+de+je-1)/2),this}setFromMatrixPosition(g){const u=g.elements;return this.x=u[12],this.y=u[13],this.z=u[14],this.w=u[15],this}min(g){return this.x=Math.min(this.x,g.x),this.y=Math.min(this.y,g.y),this.z=Math.min(this.z,g.z),this.w=Math.min(this.w,g.w),this}max(g){return this.x=Math.max(this.x,g.x),this.y=Math.max(this.y,g.y),this.z=Math.max(this.z,g.z),this.w=Math.max(this.w,g.w),this}clamp(g,u){return this.x=Math.max(g.x,Math.min(u.x,this.x)),this.y=Math.max(g.y,Math.min(u.y,this.y)),this.z=Math.max(g.z,Math.min(u.z,this.z)),this.w=Math.max(g.w,Math.min(u.w,this.w)),this}clampScalar(g,u){return this.x=Math.max(g,Math.min(u,this.x)),this.y=Math.max(g,Math.min(u,this.y)),this.z=Math.max(g,Math.min(u,this.z)),this.w=Math.max(g,Math.min(u,this.w)),this}clampLength(g,u){const O=this.length();return this.divideScalar(O||1).multiplyScalar(Math.max(g,Math.min(u,O)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(g){return this.x*g.x+this.y*g.y+this.z*g.z+this.w*g.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(g){return this.normalize().multiplyScalar(g)}lerp(g,u){return this.x+=(g.x-this.x)*u,this.y+=(g.y-this.y)*u,this.z+=(g.z-this.z)*u,this.w+=(g.w-this.w)*u,this}lerpVectors(g,u,O){return this.x=g.x+(u.x-g.x)*O,this.y=g.y+(u.y-g.y)*O,this.z=g.z+(u.z-g.z)*O,this.w=g.w+(u.w-g.w)*O,this}equals(g){return g.x===this.x&&g.y===this.y&&g.z===this.z&&g.w===this.w}fromArray(g,u=0){return this.x=g[u],this.y=g[u+1],this.z=g[u+2],this.w=g[u+3],this}toArray(g=[],u=0){return g[u]=this.x,g[u+1]=this.y,g[u+2]=this.z,g[u+3]=this.w,g}fromBufferAttribute(g,u){return this.x=g.getX(u),this.y=g.getY(u),this.z=g.getZ(u),this.w=g.getW(u),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},DataArrayTexture=class extends Texture{constructor(T=null,g=1,u=1,O=1){super(null),this.isDataArrayTexture=!0,this.image={data:T,width:g,height:u,depth:O},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(T){this.layerUpdates.add(T)}clearLayerUpdates(){this.layerUpdates.clear()}},Data3DTexture=class extends Texture{constructor(T=null,g=1,u=1,O=1){super(null),this.isData3DTexture=!0,this.image={data:T,width:g,height:u,depth:O},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Quaternion=class{constructor(T=0,g=0,u=0,O=1){this.isQuaternion=!0,this._x=T,this._y=g,this._z=u,this._w=O}static slerpFlat(T,g,u,O,z,W,J){let se=u[O+0],Y=u[O+1],ie=u[O+2],oe=u[O+3];const fe=z[W+0],me=z[W+1],de=z[W+2],Pe=z[W+3];if(J===0){T[g+0]=se,T[g+1]=Y,T[g+2]=ie,T[g+3]=oe;return}if(J===1){T[g+0]=fe,T[g+1]=me,T[g+2]=de,T[g+3]=Pe;return}if(oe!==Pe||se!==fe||Y!==me||ie!==de){let ue=1-J;const He=se*fe+Y*me+ie*de+oe*Pe,je=He>=0?1:-1,Fe=1-He*He;if(Fe>Number.EPSILON){const pt=Math.sqrt(Fe),Ge=Math.atan2(pt,He*je);ue=Math.sin(ue*Ge)/pt,J=Math.sin(J*Ge)/pt}const et=J*je;if(se=se*ue+fe*et,Y=Y*ue+me*et,ie=ie*ue+de*et,oe=oe*ue+Pe*et,ue===1-J){const pt=1/Math.sqrt(se*se+Y*Y+ie*ie+oe*oe);se*=pt,Y*=pt,ie*=pt,oe*=pt}}T[g]=se,T[g+1]=Y,T[g+2]=ie,T[g+3]=oe}static multiplyQuaternionsFlat(T,g,u,O,z,W){const J=u[O],se=u[O+1],Y=u[O+2],ie=u[O+3],oe=z[W],fe=z[W+1],me=z[W+2],de=z[W+3];return T[g]=J*de+ie*oe+se*me-Y*fe,T[g+1]=se*de+ie*fe+Y*oe-J*me,T[g+2]=Y*de+ie*me+J*fe-se*oe,T[g+3]=ie*de-J*oe-se*fe-Y*me,T}get x(){return this._x}set x(T){this._x=T,this._onChangeCallback()}get y(){return this._y}set y(T){this._y=T,this._onChangeCallback()}get z(){return this._z}set z(T){this._z=T,this._onChangeCallback()}get w(){return this._w}set w(T){this._w=T,this._onChangeCallback()}set(T,g,u,O){return this._x=T,this._y=g,this._z=u,this._w=O,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(T){return this._x=T.x,this._y=T.y,this._z=T.z,this._w=T.w,this._onChangeCallback(),this}setFromEuler(T,g=!0){const u=T._x,O=T._y,z=T._z,W=T._order,J=Math.cos,se=Math.sin,Y=J(u/2),ie=J(O/2),oe=J(z/2),fe=se(u/2),me=se(O/2),de=se(z/2);switch(W){case"XYZ":this._x=fe*ie*oe+Y*me*de,this._y=Y*me*oe-fe*ie*de,this._z=Y*ie*de+fe*me*oe,this._w=Y*ie*oe-fe*me*de;break;case"YXZ":this._x=fe*ie*oe+Y*me*de,this._y=Y*me*oe-fe*ie*de,this._z=Y*ie*de-fe*me*oe,this._w=Y*ie*oe+fe*me*de;break;case"ZXY":this._x=fe*ie*oe-Y*me*de,this._y=Y*me*oe+fe*ie*de,this._z=Y*ie*de+fe*me*oe,this._w=Y*ie*oe-fe*me*de;break;case"ZYX":this._x=fe*ie*oe-Y*me*de,this._y=Y*me*oe+fe*ie*de,this._z=Y*ie*de-fe*me*oe,this._w=Y*ie*oe+fe*me*de;break;case"YZX":this._x=fe*ie*oe+Y*me*de,this._y=Y*me*oe+fe*ie*de,this._z=Y*ie*de-fe*me*oe,this._w=Y*ie*oe-fe*me*de;break;case"XZY":this._x=fe*ie*oe-Y*me*de,this._y=Y*me*oe-fe*ie*de,this._z=Y*ie*de+fe*me*oe,this._w=Y*ie*oe+fe*me*de;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+W)}return g===!0&&this._onChangeCallback(),this}setFromAxisAngle(T,g){const u=g/2,O=Math.sin(u);return this._x=T.x*O,this._y=T.y*O,this._z=T.z*O,this._w=Math.cos(u),this._onChangeCallback(),this}setFromRotationMatrix(T){const g=T.elements,u=g[0],O=g[4],z=g[8],W=g[1],J=g[5],se=g[9],Y=g[2],ie=g[6],oe=g[10],fe=u+J+oe;if(fe>0){const me=.5/Math.sqrt(fe+1);this._w=.25/me,this._x=(ie-se)*me,this._y=(z-Y)*me,this._z=(W-O)*me}else if(u>J&&u>oe){const me=2*Math.sqrt(1+u-J-oe);this._w=(ie-se)/me,this._x=.25*me,this._y=(O+W)/me,this._z=(z+Y)/me}else if(J>oe){const me=2*Math.sqrt(1+J-u-oe);this._w=(z-Y)/me,this._x=(O+W)/me,this._y=.25*me,this._z=(se+ie)/me}else{const me=2*Math.sqrt(1+oe-u-J);this._w=(W-O)/me,this._x=(z+Y)/me,this._y=(se+ie)/me,this._z=.25*me}return this._onChangeCallback(),this}setFromUnitVectors(T,g){let u=T.dot(g)+1;return u<Number.EPSILON?(u=0,Math.abs(T.x)>Math.abs(T.z)?(this._x=-T.y,this._y=T.x,this._z=0,this._w=u):(this._x=0,this._y=-T.z,this._z=T.y,this._w=u)):(this._x=T.y*g.z-T.z*g.y,this._y=T.z*g.x-T.x*g.z,this._z=T.x*g.y-T.y*g.x,this._w=u),this.normalize()}angleTo(T){return 2*Math.acos(Math.abs(clamp(this.dot(T),-1,1)))}rotateTowards(T,g){const u=this.angleTo(T);if(u===0)return this;const O=Math.min(1,g/u);return this.slerp(T,O),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(T){return this._x*T._x+this._y*T._y+this._z*T._z+this._w*T._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let T=this.length();return T===0?(this._x=0,this._y=0,this._z=0,this._w=1):(T=1/T,this._x=this._x*T,this._y=this._y*T,this._z=this._z*T,this._w=this._w*T),this._onChangeCallback(),this}multiply(T){return this.multiplyQuaternions(this,T)}premultiply(T){return this.multiplyQuaternions(T,this)}multiplyQuaternions(T,g){const u=T._x,O=T._y,z=T._z,W=T._w,J=g._x,se=g._y,Y=g._z,ie=g._w;return this._x=u*ie+W*J+O*Y-z*se,this._y=O*ie+W*se+z*J-u*Y,this._z=z*ie+W*Y+u*se-O*J,this._w=W*ie-u*J-O*se-z*Y,this._onChangeCallback(),this}slerp(T,g){if(g===0)return this;if(g===1)return this.copy(T);const u=this._x,O=this._y,z=this._z,W=this._w;let J=W*T._w+u*T._x+O*T._y+z*T._z;if(J<0?(this._w=-T._w,this._x=-T._x,this._y=-T._y,this._z=-T._z,J=-J):this.copy(T),J>=1)return this._w=W,this._x=u,this._y=O,this._z=z,this;const se=1-J*J;if(se<=Number.EPSILON){const me=1-g;return this._w=me*W+g*this._w,this._x=me*u+g*this._x,this._y=me*O+g*this._y,this._z=me*z+g*this._z,this.normalize(),this}const Y=Math.sqrt(se),ie=Math.atan2(Y,J),oe=Math.sin((1-g)*ie)/Y,fe=Math.sin(g*ie)/Y;return this._w=W*oe+this._w*fe,this._x=u*oe+this._x*fe,this._y=O*oe+this._y*fe,this._z=z*oe+this._z*fe,this._onChangeCallback(),this}slerpQuaternions(T,g,u){return this.copy(T).slerp(g,u)}random(){const T=2*Math.PI*Math.random(),g=2*Math.PI*Math.random(),u=Math.random(),O=Math.sqrt(1-u),z=Math.sqrt(u);return this.set(O*Math.sin(T),O*Math.cos(T),z*Math.sin(g),z*Math.cos(g))}equals(T){return T._x===this._x&&T._y===this._y&&T._z===this._z&&T._w===this._w}fromArray(T,g=0){return this._x=T[g],this._y=T[g+1],this._z=T[g+2],this._w=T[g+3],this._onChangeCallback(),this}toArray(T=[],g=0){return T[g]=this._x,T[g+1]=this._y,T[g+2]=this._z,T[g+3]=this._w,T}fromBufferAttribute(T,g){return this._x=T.getX(g),this._y=T.getY(g),this._z=T.getZ(g),this._w=T.getW(g),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(T){return this._onChangeCallback=T,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Vector3=class yR{constructor(g=0,u=0,O=0){yR.prototype.isVector3=!0,this.x=g,this.y=u,this.z=O}set(g,u,O){return O===void 0&&(O=this.z),this.x=g,this.y=u,this.z=O,this}setScalar(g){return this.x=g,this.y=g,this.z=g,this}setX(g){return this.x=g,this}setY(g){return this.y=g,this}setZ(g){return this.z=g,this}setComponent(g,u){switch(g){case 0:this.x=u;break;case 1:this.y=u;break;case 2:this.z=u;break;default:throw new Error("index is out of range: "+g)}return this}getComponent(g){switch(g){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+g)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(g){return this.x=g.x,this.y=g.y,this.z=g.z,this}add(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this}addScalar(g){return this.x+=g,this.y+=g,this.z+=g,this}addVectors(g,u){return this.x=g.x+u.x,this.y=g.y+u.y,this.z=g.z+u.z,this}addScaledVector(g,u){return this.x+=g.x*u,this.y+=g.y*u,this.z+=g.z*u,this}sub(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this}subScalar(g){return this.x-=g,this.y-=g,this.z-=g,this}subVectors(g,u){return this.x=g.x-u.x,this.y=g.y-u.y,this.z=g.z-u.z,this}multiply(g){return this.x*=g.x,this.y*=g.y,this.z*=g.z,this}multiplyScalar(g){return this.x*=g,this.y*=g,this.z*=g,this}multiplyVectors(g,u){return this.x=g.x*u.x,this.y=g.y*u.y,this.z=g.z*u.z,this}applyEuler(g){return this.applyQuaternion(_quaternion$4.setFromEuler(g))}applyAxisAngle(g,u){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(g,u))}applyMatrix3(g){const u=this.x,O=this.y,z=this.z,W=g.elements;return this.x=W[0]*u+W[3]*O+W[6]*z,this.y=W[1]*u+W[4]*O+W[7]*z,this.z=W[2]*u+W[5]*O+W[8]*z,this}applyNormalMatrix(g){return this.applyMatrix3(g).normalize()}applyMatrix4(g){const u=this.x,O=this.y,z=this.z,W=g.elements,J=1/(W[3]*u+W[7]*O+W[11]*z+W[15]);return this.x=(W[0]*u+W[4]*O+W[8]*z+W[12])*J,this.y=(W[1]*u+W[5]*O+W[9]*z+W[13])*J,this.z=(W[2]*u+W[6]*O+W[10]*z+W[14])*J,this}applyQuaternion(g){const u=this.x,O=this.y,z=this.z,W=g.x,J=g.y,se=g.z,Y=g.w,ie=2*(J*z-se*O),oe=2*(se*u-W*z),fe=2*(W*O-J*u);return this.x=u+Y*ie+J*fe-se*oe,this.y=O+Y*oe+se*ie-W*fe,this.z=z+Y*fe+W*oe-J*ie,this}project(g){return this.applyMatrix4(g.matrixWorldInverse).applyMatrix4(g.projectionMatrix)}unproject(g){return this.applyMatrix4(g.projectionMatrixInverse).applyMatrix4(g.matrixWorld)}transformDirection(g){const u=this.x,O=this.y,z=this.z,W=g.elements;return this.x=W[0]*u+W[4]*O+W[8]*z,this.y=W[1]*u+W[5]*O+W[9]*z,this.z=W[2]*u+W[6]*O+W[10]*z,this.normalize()}divide(g){return this.x/=g.x,this.y/=g.y,this.z/=g.z,this}divideScalar(g){return this.multiplyScalar(1/g)}min(g){return this.x=Math.min(this.x,g.x),this.y=Math.min(this.y,g.y),this.z=Math.min(this.z,g.z),this}max(g){return this.x=Math.max(this.x,g.x),this.y=Math.max(this.y,g.y),this.z=Math.max(this.z,g.z),this}clamp(g,u){return this.x=Math.max(g.x,Math.min(u.x,this.x)),this.y=Math.max(g.y,Math.min(u.y,this.y)),this.z=Math.max(g.z,Math.min(u.z,this.z)),this}clampScalar(g,u){return this.x=Math.max(g,Math.min(u,this.x)),this.y=Math.max(g,Math.min(u,this.y)),this.z=Math.max(g,Math.min(u,this.z)),this}clampLength(g,u){const O=this.length();return this.divideScalar(O||1).multiplyScalar(Math.max(g,Math.min(u,O)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(g){return this.x*g.x+this.y*g.y+this.z*g.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(g){return this.normalize().multiplyScalar(g)}lerp(g,u){return this.x+=(g.x-this.x)*u,this.y+=(g.y-this.y)*u,this.z+=(g.z-this.z)*u,this}lerpVectors(g,u,O){return this.x=g.x+(u.x-g.x)*O,this.y=g.y+(u.y-g.y)*O,this.z=g.z+(u.z-g.z)*O,this}cross(g){return this.crossVectors(this,g)}crossVectors(g,u){const O=g.x,z=g.y,W=g.z,J=u.x,se=u.y,Y=u.z;return this.x=z*Y-W*se,this.y=W*J-O*Y,this.z=O*se-z*J,this}projectOnVector(g){const u=g.lengthSq();if(u===0)return this.set(0,0,0);const O=g.dot(this)/u;return this.copy(g).multiplyScalar(O)}projectOnPlane(g){return _vector$c.copy(this).projectOnVector(g),this.sub(_vector$c)}reflect(g){return this.sub(_vector$c.copy(g).multiplyScalar(2*this.dot(g)))}angleTo(g){const u=Math.sqrt(this.lengthSq()*g.lengthSq());if(u===0)return Math.PI/2;const O=this.dot(g)/u;return Math.acos(clamp(O,-1,1))}distanceTo(g){return Math.sqrt(this.distanceToSquared(g))}distanceToSquared(g){const u=this.x-g.x,O=this.y-g.y,z=this.z-g.z;return u*u+O*O+z*z}manhattanDistanceTo(g){return Math.abs(this.x-g.x)+Math.abs(this.y-g.y)+Math.abs(this.z-g.z)}setFromSpherical(g){return this.setFromSphericalCoords(g.radius,g.phi,g.theta)}setFromSphericalCoords(g,u,O){const z=Math.sin(u)*g;return this.x=z*Math.sin(O),this.y=Math.cos(u)*g,this.z=z*Math.cos(O),this}setFromCylindrical(g){return this.setFromCylindricalCoords(g.radius,g.theta,g.y)}setFromCylindricalCoords(g,u,O){return this.x=g*Math.sin(u),this.y=O,this.z=g*Math.cos(u),this}setFromMatrixPosition(g){const u=g.elements;return this.x=u[12],this.y=u[13],this.z=u[14],this}setFromMatrixScale(g){const u=this.setFromMatrixColumn(g,0).length(),O=this.setFromMatrixColumn(g,1).length(),z=this.setFromMatrixColumn(g,2).length();return this.x=u,this.y=O,this.z=z,this}setFromMatrixColumn(g,u){return this.fromArray(g.elements,u*4)}setFromMatrix3Column(g,u){return this.fromArray(g.elements,u*3)}setFromEuler(g){return this.x=g._x,this.y=g._y,this.z=g._z,this}setFromColor(g){return this.x=g.r,this.y=g.g,this.z=g.b,this}equals(g){return g.x===this.x&&g.y===this.y&&g.z===this.z}fromArray(g,u=0){return this.x=g[u],this.y=g[u+1],this.z=g[u+2],this}toArray(g=[],u=0){return g[u]=this.x,g[u+1]=this.y,g[u+2]=this.z,g}fromBufferAttribute(g,u){return this.x=g.getX(u),this.y=g.getY(u),this.z=g.getZ(u),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const g=Math.random()*Math.PI*2,u=Math.random()*2-1,O=Math.sqrt(1-u*u);return this.x=O*Math.cos(g),this.y=u,this.z=O*Math.sin(g),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},_vector$c=new Vector3,_quaternion$4=new Quaternion,Box3=class{constructor(T=new Vector3(1/0,1/0,1/0),g=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=T,this.max=g}set(T,g){return this.min.copy(T),this.max.copy(g),this}setFromArray(T){this.makeEmpty();for(let g=0,u=T.length;g<u;g+=3)this.expandByPoint(_vector$b.fromArray(T,g));return this}setFromBufferAttribute(T){this.makeEmpty();for(let g=0,u=T.count;g<u;g++)this.expandByPoint(_vector$b.fromBufferAttribute(T,g));return this}setFromPoints(T){this.makeEmpty();for(let g=0,u=T.length;g<u;g++)this.expandByPoint(T[g]);return this}setFromCenterAndSize(T,g){const u=_vector$b.copy(g).multiplyScalar(.5);return this.min.copy(T).sub(u),this.max.copy(T).add(u),this}setFromObject(T,g=!1){return this.makeEmpty(),this.expandByObject(T,g)}clone(){return new this.constructor().copy(this)}copy(T){return this.min.copy(T.min),this.max.copy(T.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(T){return this.isEmpty()?T.set(0,0,0):T.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(T){return this.isEmpty()?T.set(0,0,0):T.subVectors(this.max,this.min)}expandByPoint(T){return this.min.min(T),this.max.max(T),this}expandByVector(T){return this.min.sub(T),this.max.add(T),this}expandByScalar(T){return this.min.addScalar(-T),this.max.addScalar(T),this}expandByObject(T,g=!1){T.updateWorldMatrix(!1,!1);const u=T.geometry;if(u!==void 0){const z=u.getAttribute("position");if(g===!0&&z!==void 0&&T.isInstancedMesh!==!0)for(let W=0,J=z.count;W<J;W++)T.isMesh===!0?T.getVertexPosition(W,_vector$b):_vector$b.fromBufferAttribute(z,W),_vector$b.applyMatrix4(T.matrixWorld),this.expandByPoint(_vector$b);else T.boundingBox!==void 0?(T.boundingBox===null&&T.computeBoundingBox(),_box$4.copy(T.boundingBox)):(u.boundingBox===null&&u.computeBoundingBox(),_box$4.copy(u.boundingBox)),_box$4.applyMatrix4(T.matrixWorld),this.union(_box$4)}const O=T.children;for(let z=0,W=O.length;z<W;z++)this.expandByObject(O[z],g);return this}containsPoint(T){return T.x>=this.min.x&&T.x<=this.max.x&&T.y>=this.min.y&&T.y<=this.max.y&&T.z>=this.min.z&&T.z<=this.max.z}containsBox(T){return this.min.x<=T.min.x&&T.max.x<=this.max.x&&this.min.y<=T.min.y&&T.max.y<=this.max.y&&this.min.z<=T.min.z&&T.max.z<=this.max.z}getParameter(T,g){return g.set((T.x-this.min.x)/(this.max.x-this.min.x),(T.y-this.min.y)/(this.max.y-this.min.y),(T.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(T){return T.max.x>=this.min.x&&T.min.x<=this.max.x&&T.max.y>=this.min.y&&T.min.y<=this.max.y&&T.max.z>=this.min.z&&T.min.z<=this.max.z}intersectsSphere(T){return this.clampPoint(T.center,_vector$b),_vector$b.distanceToSquared(T.center)<=T.radius*T.radius}intersectsPlane(T){let g,u;return T.normal.x>0?(g=T.normal.x*this.min.x,u=T.normal.x*this.max.x):(g=T.normal.x*this.max.x,u=T.normal.x*this.min.x),T.normal.y>0?(g+=T.normal.y*this.min.y,u+=T.normal.y*this.max.y):(g+=T.normal.y*this.max.y,u+=T.normal.y*this.min.y),T.normal.z>0?(g+=T.normal.z*this.min.z,u+=T.normal.z*this.max.z):(g+=T.normal.z*this.max.z,u+=T.normal.z*this.min.z),g<=-T.constant&&u>=-T.constant}intersectsTriangle(T){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$3.subVectors(T.a,_center),_v1$7.subVectors(T.b,_center),_v2$4.subVectors(T.c,_center),_f0.subVectors(_v1$7,_v0$3),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$3,_v2$4);let g=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(g,_v0$3,_v1$7,_v2$4,_extents)||(g=[1,0,0,0,1,0,0,0,1],!satForAxes(g,_v0$3,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),g=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(g,_v0$3,_v1$7,_v2$4,_extents))}clampPoint(T,g){return g.copy(T).clamp(this.min,this.max)}distanceToPoint(T){return this.clampPoint(T,_vector$b).distanceTo(T)}getBoundingSphere(T){return this.isEmpty()?T.makeEmpty():(this.getCenter(T.center),T.radius=this.getSize(_vector$b).length()*.5),T}intersect(T){return this.min.max(T.min),this.max.min(T.max),this.isEmpty()&&this.makeEmpty(),this}union(T){return this.min.min(T.min),this.max.max(T.max),this}applyMatrix4(T){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(T),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(T),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(T),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(T),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(T),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(T),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(T),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(T),this.setFromPoints(_points),this)}translate(T){return this.min.add(T),this.max.add(T),this}equals(T){return T.min.equals(this.min)&&T.max.equals(this.max)}},_points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$4=new Box3,_v0$3=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(T,g,u,O,z){for(let W=0,J=T.length-3;W<=J;W+=3){_testAxis.fromArray(T,W);const se=z.x*Math.abs(_testAxis.x)+z.y*Math.abs(_testAxis.y)+z.z*Math.abs(_testAxis.z),Y=g.dot(_testAxis),ie=u.dot(_testAxis),oe=O.dot(_testAxis);if(Math.max(-Math.max(Y,ie,oe),Math.min(Y,ie,oe))>se)return!1}return!0}var _box$3=new Box3,_v1$6=new Vector3,_v2$3=new Vector3,Sphere=class{constructor(T=new Vector3,g=-1){this.isSphere=!0,this.center=T,this.radius=g}set(T,g){return this.center.copy(T),this.radius=g,this}setFromPoints(T,g){const u=this.center;g!==void 0?u.copy(g):_box$3.setFromPoints(T).getCenter(u);let O=0;for(let z=0,W=T.length;z<W;z++)O=Math.max(O,u.distanceToSquared(T[z]));return this.radius=Math.sqrt(O),this}copy(T){return this.center.copy(T.center),this.radius=T.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(T){return T.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(T){return T.distanceTo(this.center)-this.radius}intersectsSphere(T){const g=this.radius+T.radius;return T.center.distanceToSquared(this.center)<=g*g}intersectsBox(T){return T.intersectsSphere(this)}intersectsPlane(T){return Math.abs(T.distanceToPoint(this.center))<=this.radius}clampPoint(T,g){const u=this.center.distanceToSquared(T);return g.copy(T),u>this.radius*this.radius&&(g.sub(this.center).normalize(),g.multiplyScalar(this.radius).add(this.center)),g}getBoundingBox(T){return this.isEmpty()?(T.makeEmpty(),T):(T.set(this.center,this.center),T.expandByScalar(this.radius),T)}applyMatrix4(T){return this.center.applyMatrix4(T),this.radius=this.radius*T.getMaxScaleOnAxis(),this}translate(T){return this.center.add(T),this}expandByPoint(T){if(this.isEmpty())return this.center.copy(T),this.radius=0,this;_v1$6.subVectors(T,this.center);const g=_v1$6.lengthSq();if(g>this.radius*this.radius){const u=Math.sqrt(g),O=(u-this.radius)*.5;this.center.addScaledVector(_v1$6,O/u),this.radius+=O}return this}union(T){return T.isEmpty()?this:this.isEmpty()?(this.copy(T),this):(this.center.equals(T.center)===!0?this.radius=Math.max(this.radius,T.radius):(_v2$3.subVectors(T.center,this.center).setLength(T.radius),this.expandByPoint(_v1$6.copy(T.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(T.center).sub(_v2$3))),this)}equals(T){return T.center.equals(this.center)&&T.radius===this.radius}clone(){return new this.constructor().copy(this)}},_vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3,Ray=class{constructor(T=new Vector3,g=new Vector3(0,0,-1)){this.origin=T,this.direction=g}set(T,g){return this.origin.copy(T),this.direction.copy(g),this}copy(T){return this.origin.copy(T.origin),this.direction.copy(T.direction),this}at(T,g){return g.copy(this.origin).addScaledVector(this.direction,T)}lookAt(T){return this.direction.copy(T).sub(this.origin).normalize(),this}recast(T){return this.origin.copy(this.at(T,_vector$a)),this}closestPointToPoint(T,g){g.subVectors(T,this.origin);const u=g.dot(this.direction);return u<0?g.copy(this.origin):g.copy(this.origin).addScaledVector(this.direction,u)}distanceToPoint(T){return Math.sqrt(this.distanceSqToPoint(T))}distanceSqToPoint(T){const g=_vector$a.subVectors(T,this.origin).dot(this.direction);return g<0?this.origin.distanceToSquared(T):(_vector$a.copy(this.origin).addScaledVector(this.direction,g),_vector$a.distanceToSquared(T))}distanceSqToSegment(T,g,u,O){_segCenter.copy(T).add(g).multiplyScalar(.5),_segDir.copy(g).sub(T).normalize(),_diff.copy(this.origin).sub(_segCenter);const z=T.distanceTo(g)*.5,W=-this.direction.dot(_segDir),J=_diff.dot(this.direction),se=-_diff.dot(_segDir),Y=_diff.lengthSq(),ie=Math.abs(1-W*W);let oe,fe,me,de;if(ie>0)if(oe=W*se-J,fe=W*J-se,de=z*ie,oe>=0)if(fe>=-de)if(fe<=de){const Pe=1/ie;oe*=Pe,fe*=Pe,me=oe*(oe+W*fe+2*J)+fe*(W*oe+fe+2*se)+Y}else fe=z,oe=Math.max(0,-(W*fe+J)),me=-oe*oe+fe*(fe+2*se)+Y;else fe=-z,oe=Math.max(0,-(W*fe+J)),me=-oe*oe+fe*(fe+2*se)+Y;else fe<=-de?(oe=Math.max(0,-(-W*z+J)),fe=oe>0?-z:Math.min(Math.max(-z,-se),z),me=-oe*oe+fe*(fe+2*se)+Y):fe<=de?(oe=0,fe=Math.min(Math.max(-z,-se),z),me=fe*(fe+2*se)+Y):(oe=Math.max(0,-(W*z+J)),fe=oe>0?z:Math.min(Math.max(-z,-se),z),me=-oe*oe+fe*(fe+2*se)+Y);else fe=W>0?-z:z,oe=Math.max(0,-(W*fe+J)),me=-oe*oe+fe*(fe+2*se)+Y;return u&&u.copy(this.origin).addScaledVector(this.direction,oe),O&&O.copy(_segCenter).addScaledVector(_segDir,fe),me}intersectSphere(T,g){_vector$a.subVectors(T.center,this.origin);const u=_vector$a.dot(this.direction),O=_vector$a.dot(_vector$a)-u*u,z=T.radius*T.radius;if(O>z)return null;const W=Math.sqrt(z-O),J=u-W,se=u+W;return se<0?null:J<0?this.at(se,g):this.at(J,g)}intersectsSphere(T){return this.distanceSqToPoint(T.center)<=T.radius*T.radius}distanceToPlane(T){const g=T.normal.dot(this.direction);if(g===0)return T.distanceToPoint(this.origin)===0?0:null;const u=-(this.origin.dot(T.normal)+T.constant)/g;return u>=0?u:null}intersectPlane(T,g){const u=this.distanceToPlane(T);return u===null?null:this.at(u,g)}intersectsPlane(T){const g=T.distanceToPoint(this.origin);return g===0||T.normal.dot(this.direction)*g<0}intersectBox(T,g){let u,O,z,W,J,se;const Y=1/this.direction.x,ie=1/this.direction.y,oe=1/this.direction.z,fe=this.origin;return Y>=0?(u=(T.min.x-fe.x)*Y,O=(T.max.x-fe.x)*Y):(u=(T.max.x-fe.x)*Y,O=(T.min.x-fe.x)*Y),ie>=0?(z=(T.min.y-fe.y)*ie,W=(T.max.y-fe.y)*ie):(z=(T.max.y-fe.y)*ie,W=(T.min.y-fe.y)*ie),u>W||z>O||((z>u||isNaN(u))&&(u=z),(W<O||isNaN(O))&&(O=W),oe>=0?(J=(T.min.z-fe.z)*oe,se=(T.max.z-fe.z)*oe):(J=(T.max.z-fe.z)*oe,se=(T.min.z-fe.z)*oe),u>se||J>O)||((J>u||u!==u)&&(u=J),(se<O||O!==O)&&(O=se),O<0)?null:this.at(u>=0?u:O,g)}intersectsBox(T){return this.intersectBox(T,_vector$a)!==null}intersectTriangle(T,g,u,O,z){_edge1.subVectors(g,T),_edge2.subVectors(u,T),_normal$1.crossVectors(_edge1,_edge2);let W=this.direction.dot(_normal$1),J;if(W>0){if(O)return null;J=1}else if(W<0)J=-1,W=-W;else return null;_diff.subVectors(this.origin,T);const se=J*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(se<0)return null;const Y=J*this.direction.dot(_edge1.cross(_diff));if(Y<0||se+Y>W)return null;const ie=-J*_diff.dot(_normal$1);return ie<0?null:this.at(ie/W,z)}applyMatrix4(T){return this.origin.applyMatrix4(T),this.direction.transformDirection(T),this}equals(T){return T.origin.equals(this.origin)&&T.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Matrix4=class VM{constructor(g,u,O,z,W,J,se,Y,ie,oe,fe,me,de,Pe,ue,He){VM.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],g!==void 0&&this.set(g,u,O,z,W,J,se,Y,ie,oe,fe,me,de,Pe,ue,He)}set(g,u,O,z,W,J,se,Y,ie,oe,fe,me,de,Pe,ue,He){const je=this.elements;return je[0]=g,je[4]=u,je[8]=O,je[12]=z,je[1]=W,je[5]=J,je[9]=se,je[13]=Y,je[2]=ie,je[6]=oe,je[10]=fe,je[14]=me,je[3]=de,je[7]=Pe,je[11]=ue,je[15]=He,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new VM().fromArray(this.elements)}copy(g){const u=this.elements,O=g.elements;return u[0]=O[0],u[1]=O[1],u[2]=O[2],u[3]=O[3],u[4]=O[4],u[5]=O[5],u[6]=O[6],u[7]=O[7],u[8]=O[8],u[9]=O[9],u[10]=O[10],u[11]=O[11],u[12]=O[12],u[13]=O[13],u[14]=O[14],u[15]=O[15],this}copyPosition(g){const u=this.elements,O=g.elements;return u[12]=O[12],u[13]=O[13],u[14]=O[14],this}setFromMatrix3(g){const u=g.elements;return this.set(u[0],u[3],u[6],0,u[1],u[4],u[7],0,u[2],u[5],u[8],0,0,0,0,1),this}extractBasis(g,u,O){return g.setFromMatrixColumn(this,0),u.setFromMatrixColumn(this,1),O.setFromMatrixColumn(this,2),this}makeBasis(g,u,O){return this.set(g.x,u.x,O.x,0,g.y,u.y,O.y,0,g.z,u.z,O.z,0,0,0,0,1),this}extractRotation(g){const u=this.elements,O=g.elements,z=1/_v1$5.setFromMatrixColumn(g,0).length(),W=1/_v1$5.setFromMatrixColumn(g,1).length(),J=1/_v1$5.setFromMatrixColumn(g,2).length();return u[0]=O[0]*z,u[1]=O[1]*z,u[2]=O[2]*z,u[3]=0,u[4]=O[4]*W,u[5]=O[5]*W,u[6]=O[6]*W,u[7]=0,u[8]=O[8]*J,u[9]=O[9]*J,u[10]=O[10]*J,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}makeRotationFromEuler(g){const u=this.elements,O=g.x,z=g.y,W=g.z,J=Math.cos(O),se=Math.sin(O),Y=Math.cos(z),ie=Math.sin(z),oe=Math.cos(W),fe=Math.sin(W);if(g.order==="XYZ"){const me=J*oe,de=J*fe,Pe=se*oe,ue=se*fe;u[0]=Y*oe,u[4]=-Y*fe,u[8]=ie,u[1]=de+Pe*ie,u[5]=me-ue*ie,u[9]=-se*Y,u[2]=ue-me*ie,u[6]=Pe+de*ie,u[10]=J*Y}else if(g.order==="YXZ"){const me=Y*oe,de=Y*fe,Pe=ie*oe,ue=ie*fe;u[0]=me+ue*se,u[4]=Pe*se-de,u[8]=J*ie,u[1]=J*fe,u[5]=J*oe,u[9]=-se,u[2]=de*se-Pe,u[6]=ue+me*se,u[10]=J*Y}else if(g.order==="ZXY"){const me=Y*oe,de=Y*fe,Pe=ie*oe,ue=ie*fe;u[0]=me-ue*se,u[4]=-J*fe,u[8]=Pe+de*se,u[1]=de+Pe*se,u[5]=J*oe,u[9]=ue-me*se,u[2]=-J*ie,u[6]=se,u[10]=J*Y}else if(g.order==="ZYX"){const me=J*oe,de=J*fe,Pe=se*oe,ue=se*fe;u[0]=Y*oe,u[4]=Pe*ie-de,u[8]=me*ie+ue,u[1]=Y*fe,u[5]=ue*ie+me,u[9]=de*ie-Pe,u[2]=-ie,u[6]=se*Y,u[10]=J*Y}else if(g.order==="YZX"){const me=J*Y,de=J*ie,Pe=se*Y,ue=se*ie;u[0]=Y*oe,u[4]=ue-me*fe,u[8]=Pe*fe+de,u[1]=fe,u[5]=J*oe,u[9]=-se*oe,u[2]=-ie*oe,u[6]=de*fe+Pe,u[10]=me-ue*fe}else if(g.order==="XZY"){const me=J*Y,de=J*ie,Pe=se*Y,ue=se*ie;u[0]=Y*oe,u[4]=-fe,u[8]=ie*oe,u[1]=me*fe+ue,u[5]=J*oe,u[9]=de*fe-Pe,u[2]=Pe*fe-de,u[6]=se*oe,u[10]=ue*fe+me}return u[3]=0,u[7]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}makeRotationFromQuaternion(g){return this.compose(_zero,g,_one)}lookAt(g,u,O){const z=this.elements;return _z.subVectors(g,u),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(O,_z),_x.lengthSq()===0&&(Math.abs(O.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(O,_z)),_x.normalize(),_y.crossVectors(_z,_x),z[0]=_x.x,z[4]=_y.x,z[8]=_z.x,z[1]=_x.y,z[5]=_y.y,z[9]=_z.y,z[2]=_x.z,z[6]=_y.z,z[10]=_z.z,this}multiply(g){return this.multiplyMatrices(this,g)}premultiply(g){return this.multiplyMatrices(g,this)}multiplyMatrices(g,u){const O=g.elements,z=u.elements,W=this.elements,J=O[0],se=O[4],Y=O[8],ie=O[12],oe=O[1],fe=O[5],me=O[9],de=O[13],Pe=O[2],ue=O[6],He=O[10],je=O[14],Fe=O[3],et=O[7],pt=O[11],Ge=O[15],Ye=z[0],$=z[4],le=z[8],_e=z[12],qe=z[1],re=z[5],he=z[9],ye=z[13],Me=z[2],nt=z[6],ft=z[10],Mt=z[14],At=z[3],Dt=z[7],ot=z[11],Ct=z[15];return W[0]=J*Ye+se*qe+Y*Me+ie*At,W[4]=J*$+se*re+Y*nt+ie*Dt,W[8]=J*le+se*he+Y*ft+ie*ot,W[12]=J*_e+se*ye+Y*Mt+ie*Ct,W[1]=oe*Ye+fe*qe+me*Me+de*At,W[5]=oe*$+fe*re+me*nt+de*Dt,W[9]=oe*le+fe*he+me*ft+de*ot,W[13]=oe*_e+fe*ye+me*Mt+de*Ct,W[2]=Pe*Ye+ue*qe+He*Me+je*At,W[6]=Pe*$+ue*re+He*nt+je*Dt,W[10]=Pe*le+ue*he+He*ft+je*ot,W[14]=Pe*_e+ue*ye+He*Mt+je*Ct,W[3]=Fe*Ye+et*qe+pt*Me+Ge*At,W[7]=Fe*$+et*re+pt*nt+Ge*Dt,W[11]=Fe*le+et*he+pt*ft+Ge*ot,W[15]=Fe*_e+et*ye+pt*Mt+Ge*Ct,this}multiplyScalar(g){const u=this.elements;return u[0]*=g,u[4]*=g,u[8]*=g,u[12]*=g,u[1]*=g,u[5]*=g,u[9]*=g,u[13]*=g,u[2]*=g,u[6]*=g,u[10]*=g,u[14]*=g,u[3]*=g,u[7]*=g,u[11]*=g,u[15]*=g,this}determinant(){const g=this.elements,u=g[0],O=g[4],z=g[8],W=g[12],J=g[1],se=g[5],Y=g[9],ie=g[13],oe=g[2],fe=g[6],me=g[10],de=g[14],Pe=g[3],ue=g[7],He=g[11],je=g[15];return Pe*(+W*Y*fe-z*ie*fe-W*se*me+O*ie*me+z*se*de-O*Y*de)+ue*(+u*Y*de-u*ie*me+W*J*me-z*J*de+z*ie*oe-W*Y*oe)+He*(+u*ie*fe-u*se*de-W*J*fe+O*J*de+W*se*oe-O*ie*oe)+je*(-z*se*oe-u*Y*fe+u*se*me+z*J*fe-O*J*me+O*Y*oe)}transpose(){const g=this.elements;let u;return u=g[1],g[1]=g[4],g[4]=u,u=g[2],g[2]=g[8],g[8]=u,u=g[6],g[6]=g[9],g[9]=u,u=g[3],g[3]=g[12],g[12]=u,u=g[7],g[7]=g[13],g[13]=u,u=g[11],g[11]=g[14],g[14]=u,this}setPosition(g,u,O){const z=this.elements;return g.isVector3?(z[12]=g.x,z[13]=g.y,z[14]=g.z):(z[12]=g,z[13]=u,z[14]=O),this}invert(){const g=this.elements,u=g[0],O=g[1],z=g[2],W=g[3],J=g[4],se=g[5],Y=g[6],ie=g[7],oe=g[8],fe=g[9],me=g[10],de=g[11],Pe=g[12],ue=g[13],He=g[14],je=g[15],Fe=fe*He*ie-ue*me*ie+ue*Y*de-se*He*de-fe*Y*je+se*me*je,et=Pe*me*ie-oe*He*ie-Pe*Y*de+J*He*de+oe*Y*je-J*me*je,pt=oe*ue*ie-Pe*fe*ie+Pe*se*de-J*ue*de-oe*se*je+J*fe*je,Ge=Pe*fe*Y-oe*ue*Y-Pe*se*me+J*ue*me+oe*se*He-J*fe*He,Ye=u*Fe+O*et+z*pt+W*Ge;if(Ye===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const $=1/Ye;return g[0]=Fe*$,g[1]=(ue*me*W-fe*He*W-ue*z*de+O*He*de+fe*z*je-O*me*je)*$,g[2]=(se*He*W-ue*Y*W+ue*z*ie-O*He*ie-se*z*je+O*Y*je)*$,g[3]=(fe*Y*W-se*me*W-fe*z*ie+O*me*ie+se*z*de-O*Y*de)*$,g[4]=et*$,g[5]=(oe*He*W-Pe*me*W+Pe*z*de-u*He*de-oe*z*je+u*me*je)*$,g[6]=(Pe*Y*W-J*He*W-Pe*z*ie+u*He*ie+J*z*je-u*Y*je)*$,g[7]=(J*me*W-oe*Y*W+oe*z*ie-u*me*ie-J*z*de+u*Y*de)*$,g[8]=pt*$,g[9]=(Pe*fe*W-oe*ue*W-Pe*O*de+u*ue*de+oe*O*je-u*fe*je)*$,g[10]=(J*ue*W-Pe*se*W+Pe*O*ie-u*ue*ie-J*O*je+u*se*je)*$,g[11]=(oe*se*W-J*fe*W-oe*O*ie+u*fe*ie+J*O*de-u*se*de)*$,g[12]=Ge*$,g[13]=(oe*ue*z-Pe*fe*z+Pe*O*me-u*ue*me-oe*O*He+u*fe*He)*$,g[14]=(Pe*se*z-J*ue*z-Pe*O*Y+u*ue*Y+J*O*He-u*se*He)*$,g[15]=(J*fe*z-oe*se*z+oe*O*Y-u*fe*Y-J*O*me+u*se*me)*$,this}scale(g){const u=this.elements,O=g.x,z=g.y,W=g.z;return u[0]*=O,u[4]*=z,u[8]*=W,u[1]*=O,u[5]*=z,u[9]*=W,u[2]*=O,u[6]*=z,u[10]*=W,u[3]*=O,u[7]*=z,u[11]*=W,this}getMaxScaleOnAxis(){const g=this.elements,u=g[0]*g[0]+g[1]*g[1]+g[2]*g[2],O=g[4]*g[4]+g[5]*g[5]+g[6]*g[6],z=g[8]*g[8]+g[9]*g[9]+g[10]*g[10];return Math.sqrt(Math.max(u,O,z))}makeTranslation(g,u,O){return g.isVector3?this.set(1,0,0,g.x,0,1,0,g.y,0,0,1,g.z,0,0,0,1):this.set(1,0,0,g,0,1,0,u,0,0,1,O,0,0,0,1),this}makeRotationX(g){const u=Math.cos(g),O=Math.sin(g);return this.set(1,0,0,0,0,u,-O,0,0,O,u,0,0,0,0,1),this}makeRotationY(g){const u=Math.cos(g),O=Math.sin(g);return this.set(u,0,O,0,0,1,0,0,-O,0,u,0,0,0,0,1),this}makeRotationZ(g){const u=Math.cos(g),O=Math.sin(g);return this.set(u,-O,0,0,O,u,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(g,u){const O=Math.cos(u),z=Math.sin(u),W=1-O,J=g.x,se=g.y,Y=g.z,ie=W*J,oe=W*se;return this.set(ie*J+O,ie*se-z*Y,ie*Y+z*se,0,ie*se+z*Y,oe*se+O,oe*Y-z*J,0,ie*Y-z*se,oe*Y+z*J,W*Y*Y+O,0,0,0,0,1),this}makeScale(g,u,O){return this.set(g,0,0,0,0,u,0,0,0,0,O,0,0,0,0,1),this}makeShear(g,u,O,z,W,J){return this.set(1,O,W,0,g,1,J,0,u,z,1,0,0,0,0,1),this}compose(g,u,O){const z=this.elements,W=u._x,J=u._y,se=u._z,Y=u._w,ie=W+W,oe=J+J,fe=se+se,me=W*ie,de=W*oe,Pe=W*fe,ue=J*oe,He=J*fe,je=se*fe,Fe=Y*ie,et=Y*oe,pt=Y*fe,Ge=O.x,Ye=O.y,$=O.z;return z[0]=(1-(ue+je))*Ge,z[1]=(de+pt)*Ge,z[2]=(Pe-et)*Ge,z[3]=0,z[4]=(de-pt)*Ye,z[5]=(1-(me+je))*Ye,z[6]=(He+Fe)*Ye,z[7]=0,z[8]=(Pe+et)*$,z[9]=(He-Fe)*$,z[10]=(1-(me+ue))*$,z[11]=0,z[12]=g.x,z[13]=g.y,z[14]=g.z,z[15]=1,this}decompose(g,u,O){const z=this.elements;let W=_v1$5.set(z[0],z[1],z[2]).length();const J=_v1$5.set(z[4],z[5],z[6]).length(),se=_v1$5.set(z[8],z[9],z[10]).length();this.determinant()<0&&(W=-W),g.x=z[12],g.y=z[13],g.z=z[14],_m1$4.copy(this);const ie=1/W,oe=1/J,fe=1/se;return _m1$4.elements[0]*=ie,_m1$4.elements[1]*=ie,_m1$4.elements[2]*=ie,_m1$4.elements[4]*=oe,_m1$4.elements[5]*=oe,_m1$4.elements[6]*=oe,_m1$4.elements[8]*=fe,_m1$4.elements[9]*=fe,_m1$4.elements[10]*=fe,u.setFromRotationMatrix(_m1$4),O.x=W,O.y=J,O.z=se,this}makePerspective(g,u,O,z,W,J,se=WebGLCoordinateSystem){const Y=this.elements,ie=2*W/(u-g),oe=2*W/(O-z),fe=(u+g)/(u-g),me=(O+z)/(O-z);let de,Pe;if(se===WebGLCoordinateSystem)de=-(J+W)/(J-W),Pe=-2*J*W/(J-W);else if(se===WebGPUCoordinateSystem)de=-J/(J-W),Pe=-J*W/(J-W);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+se);return Y[0]=ie,Y[4]=0,Y[8]=fe,Y[12]=0,Y[1]=0,Y[5]=oe,Y[9]=me,Y[13]=0,Y[2]=0,Y[6]=0,Y[10]=de,Y[14]=Pe,Y[3]=0,Y[7]=0,Y[11]=-1,Y[15]=0,this}makeOrthographic(g,u,O,z,W,J,se=WebGLCoordinateSystem){const Y=this.elements,ie=1/(u-g),oe=1/(O-z),fe=1/(J-W),me=(u+g)*ie,de=(O+z)*oe;let Pe,ue;if(se===WebGLCoordinateSystem)Pe=(J+W)*fe,ue=-2*fe;else if(se===WebGPUCoordinateSystem)Pe=W*fe,ue=-1*fe;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+se);return Y[0]=2*ie,Y[4]=0,Y[8]=0,Y[12]=-me,Y[1]=0,Y[5]=2*oe,Y[9]=0,Y[13]=-de,Y[2]=0,Y[6]=0,Y[10]=ue,Y[14]=-Pe,Y[3]=0,Y[7]=0,Y[11]=0,Y[15]=1,this}equals(g){const u=this.elements,O=g.elements;for(let z=0;z<16;z++)if(u[z]!==O[z])return!1;return!0}fromArray(g,u=0){for(let O=0;O<16;O++)this.elements[O]=g[O+u];return this}toArray(g=[],u=0){const O=this.elements;return g[u]=O[0],g[u+1]=O[1],g[u+2]=O[2],g[u+3]=O[3],g[u+4]=O[4],g[u+5]=O[5],g[u+6]=O[6],g[u+7]=O[7],g[u+8]=O[8],g[u+9]=O[9],g[u+10]=O[10],g[u+11]=O[11],g[u+12]=O[12],g[u+13]=O[13],g[u+14]=O[14],g[u+15]=O[15],g}},_v1$5=new Vector3,_m1$4=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$2=new Matrix4,_quaternion$3=new Quaternion,Euler=class AR{constructor(g=0,u=0,O=0,z=AR.DEFAULT_ORDER){this.isEuler=!0,this._x=g,this._y=u,this._z=O,this._order=z}get x(){return this._x}set x(g){this._x=g,this._onChangeCallback()}get y(){return this._y}set y(g){this._y=g,this._onChangeCallback()}get z(){return this._z}set z(g){this._z=g,this._onChangeCallback()}get order(){return this._order}set order(g){this._order=g,this._onChangeCallback()}set(g,u,O,z=this._order){return this._x=g,this._y=u,this._z=O,this._order=z,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(g){return this._x=g._x,this._y=g._y,this._z=g._z,this._order=g._order,this._onChangeCallback(),this}setFromRotationMatrix(g,u=this._order,O=!0){const z=g.elements,W=z[0],J=z[4],se=z[8],Y=z[1],ie=z[5],oe=z[9],fe=z[2],me=z[6],de=z[10];switch(u){case"XYZ":this._y=Math.asin(clamp(se,-1,1)),Math.abs(se)<.9999999?(this._x=Math.atan2(-oe,de),this._z=Math.atan2(-J,W)):(this._x=Math.atan2(me,ie),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(oe,-1,1)),Math.abs(oe)<.9999999?(this._y=Math.atan2(se,de),this._z=Math.atan2(Y,ie)):(this._y=Math.atan2(-fe,W),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(me,-1,1)),Math.abs(me)<.9999999?(this._y=Math.atan2(-fe,de),this._z=Math.atan2(-J,ie)):(this._y=0,this._z=Math.atan2(Y,W));break;case"ZYX":this._y=Math.asin(-clamp(fe,-1,1)),Math.abs(fe)<.9999999?(this._x=Math.atan2(me,de),this._z=Math.atan2(Y,W)):(this._x=0,this._z=Math.atan2(-J,ie));break;case"YZX":this._z=Math.asin(clamp(Y,-1,1)),Math.abs(Y)<.9999999?(this._x=Math.atan2(-oe,ie),this._y=Math.atan2(-fe,W)):(this._x=0,this._y=Math.atan2(se,de));break;case"XZY":this._z=Math.asin(-clamp(J,-1,1)),Math.abs(J)<.9999999?(this._x=Math.atan2(me,ie),this._y=Math.atan2(se,W)):(this._x=Math.atan2(-oe,de),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+u)}return this._order=u,O===!0&&this._onChangeCallback(),this}setFromQuaternion(g,u,O){return _matrix$2.makeRotationFromQuaternion(g),this.setFromRotationMatrix(_matrix$2,u,O)}setFromVector3(g,u=this._order){return this.set(g.x,g.y,g.z,u)}reorder(g){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,g)}equals(g){return g._x===this._x&&g._y===this._y&&g._z===this._z&&g._order===this._order}fromArray(g){return this._x=g[0],this._y=g[1],this._z=g[2],g[3]!==void 0&&(this._order=g[3]),this._onChangeCallback(),this}toArray(g=[],u=0){return g[u]=this._x,g[u+1]=this._y,g[u+2]=this._z,g[u+3]=this._order,g}_onChange(g){return this._onChangeCallback=g,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Euler.DEFAULT_ORDER="XYZ";var Layers=class{constructor(){this.mask=1}set(T){this.mask=(1<<T|0)>>>0}enable(T){this.mask|=1<<T|0}enableAll(){this.mask=-1}toggle(T){this.mask^=1<<T|0}disable(T){this.mask&=~(1<<T|0)}disableAll(){this.mask=0}test(T){return(this.mask&T.mask)!==0}isEnabled(T){return(this.mask&(1<<T|0))!==0}},_object3DId=0,_v1$4=new Vector3,_q1=new Quaternion,_m1$3=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null},Object3D=class U1 extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=U1.DEFAULT_UP.clone();const g=new Vector3,u=new Euler,O=new Quaternion,z=new Vector3(1,1,1);function W(){O.setFromEuler(u,!1)}function J(){u.setFromQuaternion(O,void 0,!1)}u._onChange(W),O._onChange(J),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:g},rotation:{configurable:!0,enumerable:!0,value:u},quaternion:{configurable:!0,enumerable:!0,value:O},scale:{configurable:!0,enumerable:!0,value:z},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=U1.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=U1.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(g){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(g),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(g){return this.quaternion.premultiply(g),this}setRotationFromAxisAngle(g,u){this.quaternion.setFromAxisAngle(g,u)}setRotationFromEuler(g){this.quaternion.setFromEuler(g,!0)}setRotationFromMatrix(g){this.quaternion.setFromRotationMatrix(g)}setRotationFromQuaternion(g){this.quaternion.copy(g)}rotateOnAxis(g,u){return _q1.setFromAxisAngle(g,u),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(g,u){return _q1.setFromAxisAngle(g,u),this.quaternion.premultiply(_q1),this}rotateX(g){return this.rotateOnAxis(_xAxis,g)}rotateY(g){return this.rotateOnAxis(_yAxis,g)}rotateZ(g){return this.rotateOnAxis(_zAxis,g)}translateOnAxis(g,u){return _v1$4.copy(g).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(u)),this}translateX(g){return this.translateOnAxis(_xAxis,g)}translateY(g){return this.translateOnAxis(_yAxis,g)}translateZ(g){return this.translateOnAxis(_zAxis,g)}localToWorld(g){return this.updateWorldMatrix(!0,!1),g.applyMatrix4(this.matrixWorld)}worldToLocal(g){return this.updateWorldMatrix(!0,!1),g.applyMatrix4(_m1$3.copy(this.matrixWorld).invert())}lookAt(g,u,O){g.isVector3?_target.copy(g):_target.set(g,u,O);const z=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$3.lookAt(_position$3,_target,this.up):_m1$3.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$3),z&&(_m1$3.extractRotation(z.matrixWorld),_q1.setFromRotationMatrix(_m1$3),this.quaternion.premultiply(_q1.invert()))}add(g){if(arguments.length>1){for(let u=0;u<arguments.length;u++)this.add(arguments[u]);return this}return g===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",g),this):(g&&g.isObject3D?(g.removeFromParent(),g.parent=this,this.children.push(g),g.dispatchEvent(_addedEvent),_childaddedEvent.child=g,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",g),this)}remove(g){if(arguments.length>1){for(let O=0;O<arguments.length;O++)this.remove(arguments[O]);return this}const u=this.children.indexOf(g);return u!==-1&&(g.parent=null,this.children.splice(u,1),g.dispatchEvent(_removedEvent),_childremovedEvent.child=g,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const g=this.parent;return g!==null&&g.remove(this),this}clear(){return this.remove(...this.children)}attach(g){return this.updateWorldMatrix(!0,!1),_m1$3.copy(this.matrixWorld).invert(),g.parent!==null&&(g.parent.updateWorldMatrix(!0,!1),_m1$3.multiply(g.parent.matrixWorld)),g.applyMatrix4(_m1$3),g.removeFromParent(),g.parent=this,this.children.push(g),g.updateWorldMatrix(!1,!0),g.dispatchEvent(_addedEvent),_childaddedEvent.child=g,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(g){return this.getObjectByProperty("id",g)}getObjectByName(g){return this.getObjectByProperty("name",g)}getObjectByProperty(g,u){if(this[g]===u)return this;for(let O=0,z=this.children.length;O<z;O++){const J=this.children[O].getObjectByProperty(g,u);if(J!==void 0)return J}}getObjectsByProperty(g,u,O=[]){this[g]===u&&O.push(this);const z=this.children;for(let W=0,J=z.length;W<J;W++)z[W].getObjectsByProperty(g,u,O);return O}getWorldPosition(g){return this.updateWorldMatrix(!0,!1),g.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(g){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,g,_scale$2),g}getWorldScale(g){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,g),g}getWorldDirection(g){this.updateWorldMatrix(!0,!1);const u=this.matrixWorld.elements;return g.set(u[8],u[9],u[10]).normalize()}raycast(){}traverse(g){g(this);const u=this.children;for(let O=0,z=u.length;O<z;O++)u[O].traverse(g)}traverseVisible(g){if(this.visible===!1)return;g(this);const u=this.children;for(let O=0,z=u.length;O<z;O++)u[O].traverseVisible(g)}traverseAncestors(g){const u=this.parent;u!==null&&(g(u),u.traverseAncestors(g))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(g){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||g)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,g=!0);const u=this.children;for(let O=0,z=u.length;O<z;O++)u[O].updateMatrixWorld(g)}updateWorldMatrix(g,u){const O=this.parent;if(g===!0&&O!==null&&O.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),u===!0){const z=this.children;for(let W=0,J=z.length;W<J;W++)z[W].updateWorldMatrix(!1,!0)}}toJSON(g){const u=g===void 0||typeof g=="string",O={};u&&(g={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},O.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const z={};z.uuid=this.uuid,z.type=this.type,this.name!==""&&(z.name=this.name),this.castShadow===!0&&(z.castShadow=!0),this.receiveShadow===!0&&(z.receiveShadow=!0),this.visible===!1&&(z.visible=!1),this.frustumCulled===!1&&(z.frustumCulled=!1),this.renderOrder!==0&&(z.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(z.userData=this.userData),z.layers=this.layers.mask,z.matrix=this.matrix.toArray(),z.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(z.matrixAutoUpdate=!1),this.isInstancedMesh&&(z.type="InstancedMesh",z.count=this.count,z.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(z.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(z.type="BatchedMesh",z.perObjectFrustumCulled=this.perObjectFrustumCulled,z.sortObjects=this.sortObjects,z.drawRanges=this._drawRanges,z.reservedRanges=this._reservedRanges,z.visibility=this._visibility,z.active=this._active,z.bounds=this._bounds.map(se=>({boxInitialized:se.boxInitialized,boxMin:se.box.min.toArray(),boxMax:se.box.max.toArray(),sphereInitialized:se.sphereInitialized,sphereRadius:se.sphere.radius,sphereCenter:se.sphere.center.toArray()})),z.maxInstanceCount=this._maxInstanceCount,z.maxVertexCount=this._maxVertexCount,z.maxIndexCount=this._maxIndexCount,z.geometryInitialized=this._geometryInitialized,z.geometryCount=this._geometryCount,z.matricesTexture=this._matricesTexture.toJSON(g),this._colorsTexture!==null&&(z.colorsTexture=this._colorsTexture.toJSON(g)),this.boundingSphere!==null&&(z.boundingSphere={center:z.boundingSphere.center.toArray(),radius:z.boundingSphere.radius}),this.boundingBox!==null&&(z.boundingBox={min:z.boundingBox.min.toArray(),max:z.boundingBox.max.toArray()}));function W(se,Y){return se[Y.uuid]===void 0&&(se[Y.uuid]=Y.toJSON(g)),Y.uuid}if(this.isScene)this.background&&(this.background.isColor?z.background=this.background.toJSON():this.background.isTexture&&(z.background=this.background.toJSON(g).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(z.environment=this.environment.toJSON(g).uuid);else if(this.isMesh||this.isLine||this.isPoints){z.geometry=W(g.geometries,this.geometry);const se=this.geometry.parameters;if(se!==void 0&&se.shapes!==void 0){const Y=se.shapes;if(Array.isArray(Y))for(let ie=0,oe=Y.length;ie<oe;ie++){const fe=Y[ie];W(g.shapes,fe)}else W(g.shapes,Y)}}if(this.isSkinnedMesh&&(z.bindMode=this.bindMode,z.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(W(g.skeletons,this.skeleton),z.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const se=[];for(let Y=0,ie=this.material.length;Y<ie;Y++)se.push(W(g.materials,this.material[Y]));z.material=se}else z.material=W(g.materials,this.material);if(this.children.length>0){z.children=[];for(let se=0;se<this.children.length;se++)z.children.push(this.children[se].toJSON(g).object)}if(this.animations.length>0){z.animations=[];for(let se=0;se<this.animations.length;se++){const Y=this.animations[se];z.animations.push(W(g.animations,Y))}}if(u){const se=J(g.geometries),Y=J(g.materials),ie=J(g.textures),oe=J(g.images),fe=J(g.shapes),me=J(g.skeletons),de=J(g.animations),Pe=J(g.nodes);se.length>0&&(O.geometries=se),Y.length>0&&(O.materials=Y),ie.length>0&&(O.textures=ie),oe.length>0&&(O.images=oe),fe.length>0&&(O.shapes=fe),me.length>0&&(O.skeletons=me),de.length>0&&(O.animations=de),Pe.length>0&&(O.nodes=Pe)}return O.object=z,O;function J(se){const Y=[];for(const ie in se){const oe=se[ie];delete oe.metadata,Y.push(oe)}return Y}}clone(g){return new this.constructor().copy(this,g)}copy(g,u=!0){if(this.name=g.name,this.up.copy(g.up),this.position.copy(g.position),this.rotation.order=g.rotation.order,this.quaternion.copy(g.quaternion),this.scale.copy(g.scale),this.matrix.copy(g.matrix),this.matrixWorld.copy(g.matrixWorld),this.matrixAutoUpdate=g.matrixAutoUpdate,this.matrixWorldAutoUpdate=g.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=g.matrixWorldNeedsUpdate,this.layers.mask=g.layers.mask,this.visible=g.visible,this.castShadow=g.castShadow,this.receiveShadow=g.receiveShadow,this.frustumCulled=g.frustumCulled,this.renderOrder=g.renderOrder,this.animations=g.animations.slice(),this.userData=JSON.parse(JSON.stringify(g.userData)),u===!0)for(let O=0;O<g.children.length;O++){const z=g.children[O];this.add(z.clone())}return this}};Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var _v0$2=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$2=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3,_v40=new Vector4,_v41=new Vector4,_v42=new Vector4,Triangle=class F0{constructor(g=new Vector3,u=new Vector3,O=new Vector3){this.a=g,this.b=u,this.c=O}static getNormal(g,u,O,z){z.subVectors(O,u),_v0$2.subVectors(g,u),z.cross(_v0$2);const W=z.lengthSq();return W>0?z.multiplyScalar(1/Math.sqrt(W)):z.set(0,0,0)}static getBarycoord(g,u,O,z,W){_v0$2.subVectors(z,u),_v1$3.subVectors(O,u),_v2$2.subVectors(g,u);const J=_v0$2.dot(_v0$2),se=_v0$2.dot(_v1$3),Y=_v0$2.dot(_v2$2),ie=_v1$3.dot(_v1$3),oe=_v1$3.dot(_v2$2),fe=J*ie-se*se;if(fe===0)return W.set(0,0,0),null;const me=1/fe,de=(ie*Y-se*oe)*me,Pe=(J*oe-se*Y)*me;return W.set(1-de-Pe,Pe,de)}static containsPoint(g,u,O,z){return this.getBarycoord(g,u,O,z,_v3$2)===null?!1:_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(g,u,O,z,W,J,se,Y){return this.getBarycoord(g,u,O,z,_v3$2)===null?(Y.x=0,Y.y=0,"z"in Y&&(Y.z=0),"w"in Y&&(Y.w=0),null):(Y.setScalar(0),Y.addScaledVector(W,_v3$2.x),Y.addScaledVector(J,_v3$2.y),Y.addScaledVector(se,_v3$2.z),Y)}static getInterpolatedAttribute(g,u,O,z,W,J){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(g,u),_v41.fromBufferAttribute(g,O),_v42.fromBufferAttribute(g,z),J.setScalar(0),J.addScaledVector(_v40,W.x),J.addScaledVector(_v41,W.y),J.addScaledVector(_v42,W.z),J}static isFrontFacing(g,u,O,z){return _v0$2.subVectors(O,u),_v1$3.subVectors(g,u),_v0$2.cross(_v1$3).dot(z)<0}set(g,u,O){return this.a.copy(g),this.b.copy(u),this.c.copy(O),this}setFromPointsAndIndices(g,u,O,z){return this.a.copy(g[u]),this.b.copy(g[O]),this.c.copy(g[z]),this}setFromAttributeAndIndices(g,u,O,z){return this.a.fromBufferAttribute(g,u),this.b.fromBufferAttribute(g,O),this.c.fromBufferAttribute(g,z),this}clone(){return new this.constructor().copy(this)}copy(g){return this.a.copy(g.a),this.b.copy(g.b),this.c.copy(g.c),this}getArea(){return _v0$2.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$2.cross(_v1$3).length()*.5}getMidpoint(g){return g.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(g){return F0.getNormal(this.a,this.b,this.c,g)}getPlane(g){return g.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(g,u){return F0.getBarycoord(g,this.a,this.b,this.c,u)}getInterpolation(g,u,O,z,W){return F0.getInterpolation(g,this.a,this.b,this.c,u,O,z,W)}containsPoint(g){return F0.containsPoint(g,this.a,this.b,this.c)}isFrontFacing(g){return F0.isFrontFacing(this.a,this.b,this.c,g)}intersectsBox(g){return g.intersectsTriangle(this)}closestPointToPoint(g,u){const O=this.a,z=this.b,W=this.c;let J,se;_vab.subVectors(z,O),_vac.subVectors(W,O),_vap.subVectors(g,O);const Y=_vab.dot(_vap),ie=_vac.dot(_vap);if(Y<=0&&ie<=0)return u.copy(O);_vbp.subVectors(g,z);const oe=_vab.dot(_vbp),fe=_vac.dot(_vbp);if(oe>=0&&fe<=oe)return u.copy(z);const me=Y*fe-oe*ie;if(me<=0&&Y>=0&&oe<=0)return J=Y/(Y-oe),u.copy(O).addScaledVector(_vab,J);_vcp.subVectors(g,W);const de=_vab.dot(_vcp),Pe=_vac.dot(_vcp);if(Pe>=0&&de<=Pe)return u.copy(W);const ue=de*ie-Y*Pe;if(ue<=0&&ie>=0&&Pe<=0)return se=ie/(ie-Pe),u.copy(O).addScaledVector(_vac,se);const He=oe*Pe-de*fe;if(He<=0&&fe-oe>=0&&de-Pe>=0)return _vbc.subVectors(W,z),se=(fe-oe)/(fe-oe+(de-Pe)),u.copy(z).addScaledVector(_vbc,se);const je=1/(He+ue+me);return J=ue*je,se=me*je,u.copy(O).addScaledVector(_vab,J).addScaledVector(_vac,se)}equals(g){return g.a.equals(this.a)&&g.b.equals(this.b)&&g.c.equals(this.c)}},_colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(T,g,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?T+(g-T)*6*u:u<1/2?g:u<2/3?T+(g-T)*6*(2/3-u):T}var Color=class{constructor(T,g,u){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(T,g,u)}set(T,g,u){if(g===void 0&&u===void 0){const O=T;O&&O.isColor?this.copy(O):typeof O=="number"?this.setHex(O):typeof O=="string"&&this.setStyle(O)}else this.setRGB(T,g,u);return this}setScalar(T){return this.r=T,this.g=T,this.b=T,this}setHex(T,g=SRGBColorSpace){return T=Math.floor(T),this.r=(T>>16&255)/255,this.g=(T>>8&255)/255,this.b=(T&255)/255,ColorManagement.toWorkingColorSpace(this,g),this}setRGB(T,g,u,O=ColorManagement.workingColorSpace){return this.r=T,this.g=g,this.b=u,ColorManagement.toWorkingColorSpace(this,O),this}setHSL(T,g,u,O=ColorManagement.workingColorSpace){if(T=euclideanModulo(T,1),g=clamp(g,0,1),u=clamp(u,0,1),g===0)this.r=this.g=this.b=u;else{const z=u<=.5?u*(1+g):u+g-u*g,W=2*u-z;this.r=hue2rgb(W,z,T+1/3),this.g=hue2rgb(W,z,T),this.b=hue2rgb(W,z,T-1/3)}return ColorManagement.toWorkingColorSpace(this,O),this}setStyle(T,g=SRGBColorSpace){function u(z){z!==void 0&&parseFloat(z)<1&&console.warn("THREE.Color: Alpha component of "+T+" will be ignored.")}let O;if(O=/^(\w+)\(([^\)]*)\)/.exec(T)){let z;const W=O[1],J=O[2];switch(W){case"rgb":case"rgba":if(z=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(J))return u(z[4]),this.setRGB(Math.min(255,parseInt(z[1],10))/255,Math.min(255,parseInt(z[2],10))/255,Math.min(255,parseInt(z[3],10))/255,g);if(z=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(J))return u(z[4]),this.setRGB(Math.min(100,parseInt(z[1],10))/100,Math.min(100,parseInt(z[2],10))/100,Math.min(100,parseInt(z[3],10))/100,g);break;case"hsl":case"hsla":if(z=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(J))return u(z[4]),this.setHSL(parseFloat(z[1])/360,parseFloat(z[2])/100,parseFloat(z[3])/100,g);break;default:console.warn("THREE.Color: Unknown color model "+T)}}else if(O=/^\#([A-Fa-f\d]+)$/.exec(T)){const z=O[1],W=z.length;if(W===3)return this.setRGB(parseInt(z.charAt(0),16)/15,parseInt(z.charAt(1),16)/15,parseInt(z.charAt(2),16)/15,g);if(W===6)return this.setHex(parseInt(z,16),g);console.warn("THREE.Color: Invalid hex color "+T)}else if(T&&T.length>0)return this.setColorName(T,g);return this}setColorName(T,g=SRGBColorSpace){const u=_colorKeywords[T.toLowerCase()];return u!==void 0?this.setHex(u,g):console.warn("THREE.Color: Unknown color "+T),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(T){return this.r=T.r,this.g=T.g,this.b=T.b,this}copySRGBToLinear(T){return this.r=SRGBToLinear(T.r),this.g=SRGBToLinear(T.g),this.b=SRGBToLinear(T.b),this}copyLinearToSRGB(T){return this.r=LinearToSRGB(T.r),this.g=LinearToSRGB(T.g),this.b=LinearToSRGB(T.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(T=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),T),Math.round(clamp(_color.r*255,0,255))*65536+Math.round(clamp(_color.g*255,0,255))*256+Math.round(clamp(_color.b*255,0,255))}getHexString(T=SRGBColorSpace){return("000000"+this.getHex(T).toString(16)).slice(-6)}getHSL(T,g=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),g);const u=_color.r,O=_color.g,z=_color.b,W=Math.max(u,O,z),J=Math.min(u,O,z);let se,Y;const ie=(J+W)/2;if(J===W)se=0,Y=0;else{const oe=W-J;switch(Y=ie<=.5?oe/(W+J):oe/(2-W-J),W){case u:se=(O-z)/oe+(O<z?6:0);break;case O:se=(z-u)/oe+2;break;case z:se=(u-O)/oe+4;break}se/=6}return T.h=se,T.s=Y,T.l=ie,T}getRGB(T,g=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),g),T.r=_color.r,T.g=_color.g,T.b=_color.b,T}getStyle(T=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),T);const g=_color.r,u=_color.g,O=_color.b;return T!==SRGBColorSpace?`color(${T} ${g.toFixed(3)} ${u.toFixed(3)} ${O.toFixed(3)})`:`rgb(${Math.round(g*255)},${Math.round(u*255)},${Math.round(O*255)})`}offsetHSL(T,g,u){return this.getHSL(_hslA),this.setHSL(_hslA.h+T,_hslA.s+g,_hslA.l+u)}add(T){return this.r+=T.r,this.g+=T.g,this.b+=T.b,this}addColors(T,g){return this.r=T.r+g.r,this.g=T.g+g.g,this.b=T.b+g.b,this}addScalar(T){return this.r+=T,this.g+=T,this.b+=T,this}sub(T){return this.r=Math.max(0,this.r-T.r),this.g=Math.max(0,this.g-T.g),this.b=Math.max(0,this.b-T.b),this}multiply(T){return this.r*=T.r,this.g*=T.g,this.b*=T.b,this}multiplyScalar(T){return this.r*=T,this.g*=T,this.b*=T,this}lerp(T,g){return this.r+=(T.r-this.r)*g,this.g+=(T.g-this.g)*g,this.b+=(T.b-this.b)*g,this}lerpColors(T,g,u){return this.r=T.r+(g.r-T.r)*u,this.g=T.g+(g.g-T.g)*u,this.b=T.b+(g.b-T.b)*u,this}lerpHSL(T,g){this.getHSL(_hslA),T.getHSL(_hslB);const u=lerp(_hslA.h,_hslB.h,g),O=lerp(_hslA.s,_hslB.s,g),z=lerp(_hslA.l,_hslB.l,g);return this.setHSL(u,O,z),this}setFromVector3(T){return this.r=T.x,this.g=T.y,this.b=T.z,this}applyMatrix3(T){const g=this.r,u=this.g,O=this.b,z=T.elements;return this.r=z[0]*g+z[3]*u+z[6]*O,this.g=z[1]*g+z[4]*u+z[7]*O,this.b=z[2]*g+z[5]*u+z[8]*O,this}equals(T){return T.r===this.r&&T.g===this.g&&T.b===this.b}fromArray(T,g=0){return this.r=T[g],this.g=T[g+1],this.b=T[g+2],this}toArray(T=[],g=0){return T[g]=this.r,T[g+1]=this.g,T[g+2]=this.b,T}fromBufferAttribute(T,g){return this.r=T.getX(g),this.g=T.getY(g),this.b=T.getZ(g),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},_color=new Color;Color.NAMES=_colorKeywords;var _materialId=0,Material=class extends EventDispatcher{static get type(){return"Material"}get type(){return this.constructor.type}set type(T){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(T){this._alphaTest>0!=T>0&&this.version++,this._alphaTest=T}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(T){if(T!==void 0)for(const g in T){const u=T[g];if(u===void 0){console.warn(`THREE.Material: parameter '${g}' has value of undefined.`);continue}const O=this[g];if(O===void 0){console.warn(`THREE.Material: '${g}' is not a property of THREE.${this.type}.`);continue}O&&O.isColor?O.set(u):O&&O.isVector3&&u&&u.isVector3?O.copy(u):this[g]=u}}toJSON(T){const g=T===void 0||typeof T=="string";g&&(T={textures:{},images:{}});const u={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};u.uuid=this.uuid,u.type=this.type,this.name!==""&&(u.name=this.name),this.color&&this.color.isColor&&(u.color=this.color.getHex()),this.roughness!==void 0&&(u.roughness=this.roughness),this.metalness!==void 0&&(u.metalness=this.metalness),this.sheen!==void 0&&(u.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(u.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(u.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(u.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(u.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(u.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(u.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(u.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(u.shininess=this.shininess),this.clearcoat!==void 0&&(u.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(u.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(u.clearcoatMap=this.clearcoatMap.toJSON(T).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(u.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(T).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(u.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(T).uuid,u.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(u.dispersion=this.dispersion),this.iridescence!==void 0&&(u.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(u.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(u.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(u.iridescenceMap=this.iridescenceMap.toJSON(T).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(u.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(T).uuid),this.anisotropy!==void 0&&(u.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(u.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(u.anisotropyMap=this.anisotropyMap.toJSON(T).uuid),this.map&&this.map.isTexture&&(u.map=this.map.toJSON(T).uuid),this.matcap&&this.matcap.isTexture&&(u.matcap=this.matcap.toJSON(T).uuid),this.alphaMap&&this.alphaMap.isTexture&&(u.alphaMap=this.alphaMap.toJSON(T).uuid),this.lightMap&&this.lightMap.isTexture&&(u.lightMap=this.lightMap.toJSON(T).uuid,u.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(u.aoMap=this.aoMap.toJSON(T).uuid,u.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(u.bumpMap=this.bumpMap.toJSON(T).uuid,u.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(u.normalMap=this.normalMap.toJSON(T).uuid,u.normalMapType=this.normalMapType,u.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(u.displacementMap=this.displacementMap.toJSON(T).uuid,u.displacementScale=this.displacementScale,u.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(u.roughnessMap=this.roughnessMap.toJSON(T).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(u.metalnessMap=this.metalnessMap.toJSON(T).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(u.emissiveMap=this.emissiveMap.toJSON(T).uuid),this.specularMap&&this.specularMap.isTexture&&(u.specularMap=this.specularMap.toJSON(T).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(u.specularIntensityMap=this.specularIntensityMap.toJSON(T).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(u.specularColorMap=this.specularColorMap.toJSON(T).uuid),this.envMap&&this.envMap.isTexture&&(u.envMap=this.envMap.toJSON(T).uuid,this.combine!==void 0&&(u.combine=this.combine)),this.envMapRotation!==void 0&&(u.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(u.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(u.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(u.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(u.gradientMap=this.gradientMap.toJSON(T).uuid),this.transmission!==void 0&&(u.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(u.transmissionMap=this.transmissionMap.toJSON(T).uuid),this.thickness!==void 0&&(u.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(u.thicknessMap=this.thicknessMap.toJSON(T).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(u.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(u.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(u.size=this.size),this.shadowSide!==null&&(u.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(u.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(u.blending=this.blending),this.side!==FrontSide&&(u.side=this.side),this.vertexColors===!0&&(u.vertexColors=!0),this.opacity<1&&(u.opacity=this.opacity),this.transparent===!0&&(u.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(u.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(u.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(u.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(u.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(u.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(u.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(u.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(u.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(u.depthFunc=this.depthFunc),this.depthTest===!1&&(u.depthTest=this.depthTest),this.depthWrite===!1&&(u.depthWrite=this.depthWrite),this.colorWrite===!1&&(u.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(u.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(u.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(u.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(u.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(u.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(u.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(u.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(u.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(u.rotation=this.rotation),this.polygonOffset===!0&&(u.polygonOffset=!0),this.polygonOffsetFactor!==0&&(u.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(u.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(u.linewidth=this.linewidth),this.dashSize!==void 0&&(u.dashSize=this.dashSize),this.gapSize!==void 0&&(u.gapSize=this.gapSize),this.scale!==void 0&&(u.scale=this.scale),this.dithering===!0&&(u.dithering=!0),this.alphaTest>0&&(u.alphaTest=this.alphaTest),this.alphaHash===!0&&(u.alphaHash=!0),this.alphaToCoverage===!0&&(u.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(u.premultipliedAlpha=!0),this.forceSinglePass===!0&&(u.forceSinglePass=!0),this.wireframe===!0&&(u.wireframe=!0),this.wireframeLinewidth>1&&(u.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(u.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(u.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(u.flatShading=!0),this.visible===!1&&(u.visible=!1),this.toneMapped===!1&&(u.toneMapped=!1),this.fog===!1&&(u.fog=!1),Object.keys(this.userData).length>0&&(u.userData=this.userData);function O(z){const W=[];for(const J in z){const se=z[J];delete se.metadata,W.push(se)}return W}if(g){const z=O(T.textures),W=O(T.images);z.length>0&&(u.textures=z),W.length>0&&(u.images=W)}return u}clone(){return new this.constructor().copy(this)}copy(T){this.name=T.name,this.blending=T.blending,this.side=T.side,this.vertexColors=T.vertexColors,this.opacity=T.opacity,this.transparent=T.transparent,this.blendSrc=T.blendSrc,this.blendDst=T.blendDst,this.blendEquation=T.blendEquation,this.blendSrcAlpha=T.blendSrcAlpha,this.blendDstAlpha=T.blendDstAlpha,this.blendEquationAlpha=T.blendEquationAlpha,this.blendColor.copy(T.blendColor),this.blendAlpha=T.blendAlpha,this.depthFunc=T.depthFunc,this.depthTest=T.depthTest,this.depthWrite=T.depthWrite,this.stencilWriteMask=T.stencilWriteMask,this.stencilFunc=T.stencilFunc,this.stencilRef=T.stencilRef,this.stencilFuncMask=T.stencilFuncMask,this.stencilFail=T.stencilFail,this.stencilZFail=T.stencilZFail,this.stencilZPass=T.stencilZPass,this.stencilWrite=T.stencilWrite;const g=T.clippingPlanes;let u=null;if(g!==null){const O=g.length;u=new Array(O);for(let z=0;z!==O;++z)u[z]=g[z].clone()}return this.clippingPlanes=u,this.clipIntersection=T.clipIntersection,this.clipShadows=T.clipShadows,this.shadowSide=T.shadowSide,this.colorWrite=T.colorWrite,this.precision=T.precision,this.polygonOffset=T.polygonOffset,this.polygonOffsetFactor=T.polygonOffsetFactor,this.polygonOffsetUnits=T.polygonOffsetUnits,this.dithering=T.dithering,this.alphaTest=T.alphaTest,this.alphaHash=T.alphaHash,this.alphaToCoverage=T.alphaToCoverage,this.premultipliedAlpha=T.premultipliedAlpha,this.forceSinglePass=T.forceSinglePass,this.visible=T.visible,this.toneMapped=T.toneMapped,this.userData=JSON.parse(JSON.stringify(T.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(T){T===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}},MeshBasicMaterial=class extends Material{static get type(){return"MeshBasicMaterial"}constructor(T){super(),this.isMeshBasicMaterial=!0,this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(T)}copy(T){return super.copy(T),this.color.copy(T.color),this.map=T.map,this.lightMap=T.lightMap,this.lightMapIntensity=T.lightMapIntensity,this.aoMap=T.aoMap,this.aoMapIntensity=T.aoMapIntensity,this.specularMap=T.specularMap,this.alphaMap=T.alphaMap,this.envMap=T.envMap,this.envMapRotation.copy(T.envMapRotation),this.combine=T.combine,this.reflectivity=T.reflectivity,this.refractionRatio=T.refractionRatio,this.wireframe=T.wireframe,this.wireframeLinewidth=T.wireframeLinewidth,this.wireframeLinecap=T.wireframeLinecap,this.wireframeLinejoin=T.wireframeLinejoin,this.fog=T.fog,this}};_generateTables();function _generateTables(){const T=new ArrayBuffer(4),g=new Float32Array(T),u=new Uint32Array(T),O=new Uint32Array(512),z=new Uint32Array(512);for(let Y=0;Y<256;++Y){const ie=Y-127;ie<-27?(O[Y]=0,O[Y|256]=32768,z[Y]=24,z[Y|256]=24):ie<-14?(O[Y]=1024>>-ie-14,O[Y|256]=1024>>-ie-14|32768,z[Y]=-ie-1,z[Y|256]=-ie-1):ie<=15?(O[Y]=ie+15<<10,O[Y|256]=ie+15<<10|32768,z[Y]=13,z[Y|256]=13):ie<128?(O[Y]=31744,O[Y|256]=64512,z[Y]=24,z[Y|256]=24):(O[Y]=31744,O[Y|256]=64512,z[Y]=13,z[Y|256]=13)}const W=new Uint32Array(2048),J=new Uint32Array(64),se=new Uint32Array(64);for(let Y=1;Y<1024;++Y){let ie=Y<<13,oe=0;for(;!(ie&8388608);)ie<<=1,oe-=8388608;ie&=-8388609,oe+=947912704,W[Y]=ie|oe}for(let Y=1024;Y<2048;++Y)W[Y]=939524096+(Y-1024<<13);for(let Y=1;Y<31;++Y)J[Y]=Y<<23;J[31]=1199570944,J[32]=2147483648;for(let Y=33;Y<63;++Y)J[Y]=2147483648+(Y-32<<23);J[63]=3347054592;for(let Y=1;Y<64;++Y)Y!==32&&(se[Y]=1024);return{floatView:g,uint32View:u,baseTable:O,shiftTable:z,mantissaTable:W,exponentTable:J,offsetTable:se}}var _vector$9=new Vector3,_vector2$1=new Vector2,BufferAttribute=class{constructor(T,g,u=!1){if(Array.isArray(T))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=T,this.itemSize=g,this.count=T!==void 0?T.length/g:0,this.normalized=u,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(T){T===!0&&this.version++}setUsage(T){return this.usage=T,this}addUpdateRange(T,g){this.updateRanges.push({start:T,count:g})}clearUpdateRanges(){this.updateRanges.length=0}copy(T){return this.name=T.name,this.array=new T.array.constructor(T.array),this.itemSize=T.itemSize,this.count=T.count,this.normalized=T.normalized,this.usage=T.usage,this.gpuType=T.gpuType,this}copyAt(T,g,u){T*=this.itemSize,u*=g.itemSize;for(let O=0,z=this.itemSize;O<z;O++)this.array[T+O]=g.array[u+O];return this}copyArray(T){return this.array.set(T),this}applyMatrix3(T){if(this.itemSize===2)for(let g=0,u=this.count;g<u;g++)_vector2$1.fromBufferAttribute(this,g),_vector2$1.applyMatrix3(T),this.setXY(g,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let g=0,u=this.count;g<u;g++)_vector$9.fromBufferAttribute(this,g),_vector$9.applyMatrix3(T),this.setXYZ(g,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(T){for(let g=0,u=this.count;g<u;g++)_vector$9.fromBufferAttribute(this,g),_vector$9.applyMatrix4(T),this.setXYZ(g,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(T){for(let g=0,u=this.count;g<u;g++)_vector$9.fromBufferAttribute(this,g),_vector$9.applyNormalMatrix(T),this.setXYZ(g,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(T){for(let g=0,u=this.count;g<u;g++)_vector$9.fromBufferAttribute(this,g),_vector$9.transformDirection(T),this.setXYZ(g,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(T,g=0){return this.array.set(T,g),this}getComponent(T,g){let u=this.array[T*this.itemSize+g];return this.normalized&&(u=denormalize(u,this.array)),u}setComponent(T,g,u){return this.normalized&&(u=normalize(u,this.array)),this.array[T*this.itemSize+g]=u,this}getX(T){let g=this.array[T*this.itemSize];return this.normalized&&(g=denormalize(g,this.array)),g}setX(T,g){return this.normalized&&(g=normalize(g,this.array)),this.array[T*this.itemSize]=g,this}getY(T){let g=this.array[T*this.itemSize+1];return this.normalized&&(g=denormalize(g,this.array)),g}setY(T,g){return this.normalized&&(g=normalize(g,this.array)),this.array[T*this.itemSize+1]=g,this}getZ(T){let g=this.array[T*this.itemSize+2];return this.normalized&&(g=denormalize(g,this.array)),g}setZ(T,g){return this.normalized&&(g=normalize(g,this.array)),this.array[T*this.itemSize+2]=g,this}getW(T){let g=this.array[T*this.itemSize+3];return this.normalized&&(g=denormalize(g,this.array)),g}setW(T,g){return this.normalized&&(g=normalize(g,this.array)),this.array[T*this.itemSize+3]=g,this}setXY(T,g,u){return T*=this.itemSize,this.normalized&&(g=normalize(g,this.array),u=normalize(u,this.array)),this.array[T+0]=g,this.array[T+1]=u,this}setXYZ(T,g,u,O){return T*=this.itemSize,this.normalized&&(g=normalize(g,this.array),u=normalize(u,this.array),O=normalize(O,this.array)),this.array[T+0]=g,this.array[T+1]=u,this.array[T+2]=O,this}setXYZW(T,g,u,O,z){return T*=this.itemSize,this.normalized&&(g=normalize(g,this.array),u=normalize(u,this.array),O=normalize(O,this.array),z=normalize(z,this.array)),this.array[T+0]=g,this.array[T+1]=u,this.array[T+2]=O,this.array[T+3]=z,this}onUpload(T){return this.onUploadCallback=T,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const T={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(T.name=this.name),this.usage!==StaticDrawUsage&&(T.usage=this.usage),T}},Uint16BufferAttribute=class extends BufferAttribute{constructor(T,g,u){super(new Uint16Array(T),g,u)}},Uint32BufferAttribute=class extends BufferAttribute{constructor(T,g,u){super(new Uint32Array(T),g,u)}},Float32BufferAttribute=class extends BufferAttribute{constructor(T,g,u){super(new Float32Array(T),g,u)}},_id$2=0,_m1$2=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3,BufferGeometry$1=class bR extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(g){return Array.isArray(g)?this.index=new(arrayNeedsUint32(g)?Uint32BufferAttribute:Uint16BufferAttribute)(g,1):this.index=g,this}setIndirect(g){return this.indirect=g,this}getIndirect(){return this.indirect}getAttribute(g){return this.attributes[g]}setAttribute(g,u){return this.attributes[g]=u,this}deleteAttribute(g){return delete this.attributes[g],this}hasAttribute(g){return this.attributes[g]!==void 0}addGroup(g,u,O=0){this.groups.push({start:g,count:u,materialIndex:O})}clearGroups(){this.groups=[]}setDrawRange(g,u){this.drawRange.start=g,this.drawRange.count=u}applyMatrix4(g){const u=this.attributes.position;u!==void 0&&(u.applyMatrix4(g),u.needsUpdate=!0);const O=this.attributes.normal;if(O!==void 0){const W=new Matrix3().getNormalMatrix(g);O.applyNormalMatrix(W),O.needsUpdate=!0}const z=this.attributes.tangent;return z!==void 0&&(z.transformDirection(g),z.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(g){return _m1$2.makeRotationFromQuaternion(g),this.applyMatrix4(_m1$2),this}rotateX(g){return _m1$2.makeRotationX(g),this.applyMatrix4(_m1$2),this}rotateY(g){return _m1$2.makeRotationY(g),this.applyMatrix4(_m1$2),this}rotateZ(g){return _m1$2.makeRotationZ(g),this.applyMatrix4(_m1$2),this}translate(g,u,O){return _m1$2.makeTranslation(g,u,O),this.applyMatrix4(_m1$2),this}scale(g,u,O){return _m1$2.makeScale(g,u,O),this.applyMatrix4(_m1$2),this}lookAt(g){return _obj.lookAt(g),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(g){const u=this.getAttribute("position");if(u===void 0){const O=[];for(let z=0,W=g.length;z<W;z++){const J=g[z];O.push(J.x,J.y,J.z||0)}this.setAttribute("position",new Float32BufferAttribute(O,3))}else{for(let O=0,z=u.count;O<z;O++){const W=g[O];u.setXYZ(O,W.x,W.y,W.z||0)}g.length>u.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),u.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const g=this.attributes.position,u=this.morphAttributes.position;if(g&&g.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(g!==void 0){if(this.boundingBox.setFromBufferAttribute(g),u)for(let O=0,z=u.length;O<z;O++){const W=u[O];_box$2.setFromBufferAttribute(W),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const g=this.attributes.position,u=this.morphAttributes.position;if(g&&g.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3,1/0);return}if(g){const O=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(g),u)for(let W=0,J=u.length;W<J;W++){const se=u[W];_boxMorphTargets.setFromBufferAttribute(se),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(O);let z=0;for(let W=0,J=g.count;W<J;W++)_vector$8.fromBufferAttribute(g,W),z=Math.max(z,O.distanceToSquared(_vector$8));if(u)for(let W=0,J=u.length;W<J;W++){const se=u[W],Y=this.morphTargetsRelative;for(let ie=0,oe=se.count;ie<oe;ie++)_vector$8.fromBufferAttribute(se,ie),Y&&(_offset.fromBufferAttribute(g,ie),_vector$8.add(_offset)),z=Math.max(z,O.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(z),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const g=this.index,u=this.attributes;if(g===null||u.position===void 0||u.normal===void 0||u.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const O=u.position,z=u.normal,W=u.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*O.count),4));const J=this.getAttribute("tangent"),se=[],Y=[];for(let le=0;le<O.count;le++)se[le]=new Vector3,Y[le]=new Vector3;const ie=new Vector3,oe=new Vector3,fe=new Vector3,me=new Vector2,de=new Vector2,Pe=new Vector2,ue=new Vector3,He=new Vector3;function je(le,_e,qe){ie.fromBufferAttribute(O,le),oe.fromBufferAttribute(O,_e),fe.fromBufferAttribute(O,qe),me.fromBufferAttribute(W,le),de.fromBufferAttribute(W,_e),Pe.fromBufferAttribute(W,qe),oe.sub(ie),fe.sub(ie),de.sub(me),Pe.sub(me);const re=1/(de.x*Pe.y-Pe.x*de.y);isFinite(re)&&(ue.copy(oe).multiplyScalar(Pe.y).addScaledVector(fe,-de.y).multiplyScalar(re),He.copy(fe).multiplyScalar(de.x).addScaledVector(oe,-Pe.x).multiplyScalar(re),se[le].add(ue),se[_e].add(ue),se[qe].add(ue),Y[le].add(He),Y[_e].add(He),Y[qe].add(He))}let Fe=this.groups;Fe.length===0&&(Fe=[{start:0,count:g.count}]);for(let le=0,_e=Fe.length;le<_e;++le){const qe=Fe[le],re=qe.start,he=qe.count;for(let ye=re,Me=re+he;ye<Me;ye+=3)je(g.getX(ye+0),g.getX(ye+1),g.getX(ye+2))}const et=new Vector3,pt=new Vector3,Ge=new Vector3,Ye=new Vector3;function $(le){Ge.fromBufferAttribute(z,le),Ye.copy(Ge);const _e=se[le];et.copy(_e),et.sub(Ge.multiplyScalar(Ge.dot(_e))).normalize(),pt.crossVectors(Ye,_e);const re=pt.dot(Y[le])<0?-1:1;J.setXYZW(le,et.x,et.y,et.z,re)}for(let le=0,_e=Fe.length;le<_e;++le){const qe=Fe[le],re=qe.start,he=qe.count;for(let ye=re,Me=re+he;ye<Me;ye+=3)$(g.getX(ye+0)),$(g.getX(ye+1)),$(g.getX(ye+2))}}computeVertexNormals(){const g=this.index,u=this.getAttribute("position");if(u!==void 0){let O=this.getAttribute("normal");if(O===void 0)O=new BufferAttribute(new Float32Array(u.count*3),3),this.setAttribute("normal",O);else for(let me=0,de=O.count;me<de;me++)O.setXYZ(me,0,0,0);const z=new Vector3,W=new Vector3,J=new Vector3,se=new Vector3,Y=new Vector3,ie=new Vector3,oe=new Vector3,fe=new Vector3;if(g)for(let me=0,de=g.count;me<de;me+=3){const Pe=g.getX(me+0),ue=g.getX(me+1),He=g.getX(me+2);z.fromBufferAttribute(u,Pe),W.fromBufferAttribute(u,ue),J.fromBufferAttribute(u,He),oe.subVectors(J,W),fe.subVectors(z,W),oe.cross(fe),se.fromBufferAttribute(O,Pe),Y.fromBufferAttribute(O,ue),ie.fromBufferAttribute(O,He),se.add(oe),Y.add(oe),ie.add(oe),O.setXYZ(Pe,se.x,se.y,se.z),O.setXYZ(ue,Y.x,Y.y,Y.z),O.setXYZ(He,ie.x,ie.y,ie.z)}else for(let me=0,de=u.count;me<de;me+=3)z.fromBufferAttribute(u,me+0),W.fromBufferAttribute(u,me+1),J.fromBufferAttribute(u,me+2),oe.subVectors(J,W),fe.subVectors(z,W),oe.cross(fe),O.setXYZ(me+0,oe.x,oe.y,oe.z),O.setXYZ(me+1,oe.x,oe.y,oe.z),O.setXYZ(me+2,oe.x,oe.y,oe.z);this.normalizeNormals(),O.needsUpdate=!0}}normalizeNormals(){const g=this.attributes.normal;for(let u=0,O=g.count;u<O;u++)_vector$8.fromBufferAttribute(g,u),_vector$8.normalize(),g.setXYZ(u,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function g(se,Y){const ie=se.array,oe=se.itemSize,fe=se.normalized,me=new ie.constructor(Y.length*oe);let de=0,Pe=0;for(let ue=0,He=Y.length;ue<He;ue++){se.isInterleavedBufferAttribute?de=Y[ue]*se.data.stride+se.offset:de=Y[ue]*oe;for(let je=0;je<oe;je++)me[Pe++]=ie[de++]}return new BufferAttribute(me,oe,fe)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const u=new bR,O=this.index.array,z=this.attributes;for(const se in z){const Y=z[se],ie=g(Y,O);u.setAttribute(se,ie)}const W=this.morphAttributes;for(const se in W){const Y=[],ie=W[se];for(let oe=0,fe=ie.length;oe<fe;oe++){const me=ie[oe],de=g(me,O);Y.push(de)}u.morphAttributes[se]=Y}u.morphTargetsRelative=this.morphTargetsRelative;const J=this.groups;for(let se=0,Y=J.length;se<Y;se++){const ie=J[se];u.addGroup(ie.start,ie.count,ie.materialIndex)}return u}toJSON(){const g={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(g.uuid=this.uuid,g.type=this.type,this.name!==""&&(g.name=this.name),Object.keys(this.userData).length>0&&(g.userData=this.userData),this.parameters!==void 0){const Y=this.parameters;for(const ie in Y)Y[ie]!==void 0&&(g[ie]=Y[ie]);return g}g.data={attributes:{}};const u=this.index;u!==null&&(g.data.index={type:u.array.constructor.name,array:Array.prototype.slice.call(u.array)});const O=this.attributes;for(const Y in O){const ie=O[Y];g.data.attributes[Y]=ie.toJSON(g.data)}const z={};let W=!1;for(const Y in this.morphAttributes){const ie=this.morphAttributes[Y],oe=[];for(let fe=0,me=ie.length;fe<me;fe++){const de=ie[fe];oe.push(de.toJSON(g.data))}oe.length>0&&(z[Y]=oe,W=!0)}W&&(g.data.morphAttributes=z,g.data.morphTargetsRelative=this.morphTargetsRelative);const J=this.groups;J.length>0&&(g.data.groups=JSON.parse(JSON.stringify(J)));const se=this.boundingSphere;return se!==null&&(g.data.boundingSphere={center:se.center.toArray(),radius:se.radius}),g}clone(){return new this.constructor().copy(this)}copy(g){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const u={};this.name=g.name;const O=g.index;O!==null&&this.setIndex(O.clone(u));const z=g.attributes;for(const ie in z){const oe=z[ie];this.setAttribute(ie,oe.clone(u))}const W=g.morphAttributes;for(const ie in W){const oe=[],fe=W[ie];for(let me=0,de=fe.length;me<de;me++)oe.push(fe[me].clone(u));this.morphAttributes[ie]=oe}this.morphTargetsRelative=g.morphTargetsRelative;const J=g.groups;for(let ie=0,oe=J.length;ie<oe;ie++){const fe=J[ie];this.addGroup(fe.start,fe.count,fe.materialIndex)}const se=g.boundingBox;se!==null&&(this.boundingBox=se.clone());const Y=g.boundingSphere;return Y!==null&&(this.boundingSphere=Y.clone()),this.drawRange.start=g.drawRange.start,this.drawRange.count=g.drawRange.count,this.userData=g.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},_inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$6=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3,Mesh=class extends Object3D{constructor(T=new BufferGeometry$1,g=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=T,this.material=g,this.updateMorphTargets()}copy(T,g){return super.copy(T,g),T.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=T.morphTargetInfluences.slice()),T.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},T.morphTargetDictionary)),this.material=Array.isArray(T.material)?T.material.slice():T.material,this.geometry=T.geometry,this}updateMorphTargets(){const g=this.geometry.morphAttributes,u=Object.keys(g);if(u.length>0){const O=g[u[0]];if(O!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let z=0,W=O.length;z<W;z++){const J=O[z].name||String(z);this.morphTargetInfluences.push(0),this.morphTargetDictionary[J]=z}}}}getVertexPosition(T,g){const u=this.geometry,O=u.attributes.position,z=u.morphAttributes.position,W=u.morphTargetsRelative;g.fromBufferAttribute(O,T);const J=this.morphTargetInfluences;if(z&&J){_morphA.set(0,0,0);for(let se=0,Y=z.length;se<Y;se++){const ie=J[se],oe=z[se];ie!==0&&(_tempA.fromBufferAttribute(oe,T),W?_morphA.addScaledVector(_tempA,ie):_morphA.addScaledVector(_tempA.sub(g),ie))}g.add(_morphA)}return g}raycast(T,g){const u=this.geometry,O=this.material,z=this.matrixWorld;O!==void 0&&(u.boundingSphere===null&&u.computeBoundingSphere(),_sphere$6.copy(u.boundingSphere),_sphere$6.applyMatrix4(z),_ray$3.copy(T.ray).recast(T.near),!(_sphere$6.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(T.far-T.near)**2))&&(_inverseMatrix$3.copy(z).invert(),_ray$3.copy(T.ray).applyMatrix4(_inverseMatrix$3),!(u.boundingBox!==null&&_ray$3.intersectsBox(u.boundingBox)===!1)&&this._computeIntersections(T,g,_ray$3)))}_computeIntersections(T,g,u){let O;const z=this.geometry,W=this.material,J=z.index,se=z.attributes.position,Y=z.attributes.uv,ie=z.attributes.uv1,oe=z.attributes.normal,fe=z.groups,me=z.drawRange;if(J!==null)if(Array.isArray(W))for(let de=0,Pe=fe.length;de<Pe;de++){const ue=fe[de],He=W[ue.materialIndex],je=Math.max(ue.start,me.start),Fe=Math.min(J.count,Math.min(ue.start+ue.count,me.start+me.count));for(let et=je,pt=Fe;et<pt;et+=3){const Ge=J.getX(et),Ye=J.getX(et+1),$=J.getX(et+2);O=checkGeometryIntersection(this,He,T,u,Y,ie,oe,Ge,Ye,$),O&&(O.faceIndex=Math.floor(et/3),O.face.materialIndex=ue.materialIndex,g.push(O))}}else{const de=Math.max(0,me.start),Pe=Math.min(J.count,me.start+me.count);for(let ue=de,He=Pe;ue<He;ue+=3){const je=J.getX(ue),Fe=J.getX(ue+1),et=J.getX(ue+2);O=checkGeometryIntersection(this,W,T,u,Y,ie,oe,je,Fe,et),O&&(O.faceIndex=Math.floor(ue/3),g.push(O))}}else if(se!==void 0)if(Array.isArray(W))for(let de=0,Pe=fe.length;de<Pe;de++){const ue=fe[de],He=W[ue.materialIndex],je=Math.max(ue.start,me.start),Fe=Math.min(se.count,Math.min(ue.start+ue.count,me.start+me.count));for(let et=je,pt=Fe;et<pt;et+=3){const Ge=et,Ye=et+1,$=et+2;O=checkGeometryIntersection(this,He,T,u,Y,ie,oe,Ge,Ye,$),O&&(O.faceIndex=Math.floor(et/3),O.face.materialIndex=ue.materialIndex,g.push(O))}}else{const de=Math.max(0,me.start),Pe=Math.min(se.count,me.start+me.count);for(let ue=de,He=Pe;ue<He;ue+=3){const je=ue,Fe=ue+1,et=ue+2;O=checkGeometryIntersection(this,W,T,u,Y,ie,oe,je,Fe,et),O&&(O.faceIndex=Math.floor(ue/3),g.push(O))}}}};function checkIntersection$1(T,g,u,O,z,W,J,se){let Y;if(g.side===BackSide?Y=O.intersectTriangle(J,W,z,!0,se):Y=O.intersectTriangle(z,W,J,g.side===FrontSide,se),Y===null)return null;_intersectionPointWorld.copy(se),_intersectionPointWorld.applyMatrix4(T.matrixWorld);const ie=u.ray.origin.distanceTo(_intersectionPointWorld);return ie<u.near||ie>u.far?null:{distance:ie,point:_intersectionPointWorld.clone(),object:T}}function checkGeometryIntersection(T,g,u,O,z,W,J,se,Y,ie){T.getVertexPosition(se,_vA$1),T.getVertexPosition(Y,_vB$1),T.getVertexPosition(ie,_vC$1);const oe=checkIntersection$1(T,g,u,O,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(oe){const fe=new Vector3;Triangle.getBarycoord(_intersectionPoint,_vA$1,_vB$1,_vC$1,fe),z&&(oe.uv=Triangle.getInterpolatedAttribute(z,se,Y,ie,fe,new Vector2)),W&&(oe.uv1=Triangle.getInterpolatedAttribute(W,se,Y,ie,fe,new Vector2)),J&&(oe.normal=Triangle.getInterpolatedAttribute(J,se,Y,ie,fe,new Vector3),oe.normal.dot(O.direction)>0&&oe.normal.multiplyScalar(-1));const me={a:se,b:Y,c:ie,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,me.normal),oe.face=me,oe.barycoord=fe}return oe}function cloneUniforms(T){const g={};for(const u in T){g[u]={};for(const O in T[u]){const z=T[u][O];z&&(z.isColor||z.isMatrix3||z.isMatrix4||z.isVector2||z.isVector3||z.isVector4||z.isTexture||z.isQuaternion)?z.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),g[u][O]=null):g[u][O]=z.clone():Array.isArray(z)?g[u][O]=z.slice():g[u][O]=z}}return g}function mergeUniforms(T){const g={};for(let u=0;u<T.length;u++){const O=cloneUniforms(T[u]);for(const z in O)g[z]=O[z]}return g}var Camera=class extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(T,g){return super.copy(T,g),this.matrixWorldInverse.copy(T.matrixWorldInverse),this.projectionMatrix.copy(T.projectionMatrix),this.projectionMatrixInverse.copy(T.projectionMatrixInverse),this.coordinateSystem=T.coordinateSystem,this}getWorldDirection(T){return super.getWorldDirection(T).negate()}updateMatrixWorld(T){super.updateMatrixWorld(T),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(T,g){super.updateWorldMatrix(T,g),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};new Vector3;new Vector2;new Vector2;var CubeTexture=class extends Texture{constructor(T,g,u,O,z,W,J,se,Y,ie){T=T!==void 0?T:[],g=g!==void 0?g:CubeReflectionMapping,super(T,g,u,O,z,W,J,se,Y,ie),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(T){this.image=T}},_vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3,Plane=class{constructor(T=new Vector3(1,0,0),g=0){this.isPlane=!0,this.normal=T,this.constant=g}set(T,g){return this.normal.copy(T),this.constant=g,this}setComponents(T,g,u,O){return this.normal.set(T,g,u),this.constant=O,this}setFromNormalAndCoplanarPoint(T,g){return this.normal.copy(T),this.constant=-g.dot(this.normal),this}setFromCoplanarPoints(T,g,u){const O=_vector1.subVectors(u,g).cross(_vector2.subVectors(T,g)).normalize();return this.setFromNormalAndCoplanarPoint(O,T),this}copy(T){return this.normal.copy(T.normal),this.constant=T.constant,this}normalize(){const T=1/this.normal.length();return this.normal.multiplyScalar(T),this.constant*=T,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(T){return this.normal.dot(T)+this.constant}distanceToSphere(T){return this.distanceToPoint(T.center)-T.radius}projectPoint(T,g){return g.copy(T).addScaledVector(this.normal,-this.distanceToPoint(T))}intersectLine(T,g){const u=T.delta(_vector1),O=this.normal.dot(u);if(O===0)return this.distanceToPoint(T.start)===0?g.copy(T.start):null;const z=-(T.start.dot(this.normal)+this.constant)/O;return z<0||z>1?null:g.copy(T.start).addScaledVector(u,z)}intersectsLine(T){const g=this.distanceToPoint(T.start),u=this.distanceToPoint(T.end);return g<0&&u>0||u<0&&g>0}intersectsBox(T){return T.intersectsPlane(this)}intersectsSphere(T){return T.intersectsPlane(this)}coplanarPoint(T){return T.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(T,g){const u=g||_normalMatrix.getNormalMatrix(T),O=this.coplanarPoint(_vector1).applyMatrix4(T),z=this.normal.applyMatrix3(u).normalize();return this.constant=-O.dot(z),this}translate(T){return this.constant-=T.dot(this.normal),this}equals(T){return T.normal.equals(this.normal)&&T.constant===this.constant}clone(){return new this.constructor().copy(this)}},_sphere$5=new Sphere,_vector$7=new Vector3,Frustum=class{constructor(T=new Plane,g=new Plane,u=new Plane,O=new Plane,z=new Plane,W=new Plane){this.planes=[T,g,u,O,z,W]}set(T,g,u,O,z,W){const J=this.planes;return J[0].copy(T),J[1].copy(g),J[2].copy(u),J[3].copy(O),J[4].copy(z),J[5].copy(W),this}copy(T){const g=this.planes;for(let u=0;u<6;u++)g[u].copy(T.planes[u]);return this}setFromProjectionMatrix(T,g=WebGLCoordinateSystem){const u=this.planes,O=T.elements,z=O[0],W=O[1],J=O[2],se=O[3],Y=O[4],ie=O[5],oe=O[6],fe=O[7],me=O[8],de=O[9],Pe=O[10],ue=O[11],He=O[12],je=O[13],Fe=O[14],et=O[15];if(u[0].setComponents(se-z,fe-Y,ue-me,et-He).normalize(),u[1].setComponents(se+z,fe+Y,ue+me,et+He).normalize(),u[2].setComponents(se+W,fe+ie,ue+de,et+je).normalize(),u[3].setComponents(se-W,fe-ie,ue-de,et-je).normalize(),u[4].setComponents(se-J,fe-oe,ue-Pe,et-Fe).normalize(),g===WebGLCoordinateSystem)u[5].setComponents(se+J,fe+oe,ue+Pe,et+Fe).normalize();else if(g===WebGPUCoordinateSystem)u[5].setComponents(J,oe,Pe,Fe).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+g);return this}intersectsObject(T){if(T.boundingSphere!==void 0)T.boundingSphere===null&&T.computeBoundingSphere(),_sphere$5.copy(T.boundingSphere).applyMatrix4(T.matrixWorld);else{const g=T.geometry;g.boundingSphere===null&&g.computeBoundingSphere(),_sphere$5.copy(g.boundingSphere).applyMatrix4(T.matrixWorld)}return this.intersectsSphere(_sphere$5)}intersectsSprite(T){return _sphere$5.center.set(0,0,0),_sphere$5.radius=.7071067811865476,_sphere$5.applyMatrix4(T.matrixWorld),this.intersectsSphere(_sphere$5)}intersectsSphere(T){const g=this.planes,u=T.center,O=-T.radius;for(let z=0;z<6;z++)if(g[z].distanceToPoint(u)<O)return!1;return!0}intersectsBox(T){const g=this.planes;for(let u=0;u<6;u++){const O=g[u];if(_vector$7.x=O.normal.x>0?T.max.x:T.min.x,_vector$7.y=O.normal.y>0?T.max.y:T.min.y,_vector$7.z=O.normal.z>0?T.max.z:T.min.z,O.distanceToPoint(_vector$7)<0)return!1}return!0}containsPoint(T){const g=this.planes;for(let u=0;u<6;u++)if(g[u].distanceToPoint(T)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}},alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,batching_pars_vertex,batching_vertex,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphinstance_vertex,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},envMapRotation:{value:new Matrix3},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Matrix3}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};new Matrix4;var OrthographicCamera=class extends Camera{constructor(T=-1,g=1,u=1,O=-1,z=.1,W=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=T,this.right=g,this.top=u,this.bottom=O,this.near=z,this.far=W,this.updateProjectionMatrix()}copy(T,g){return super.copy(T,g),this.left=T.left,this.right=T.right,this.top=T.top,this.bottom=T.bottom,this.near=T.near,this.far=T.far,this.zoom=T.zoom,this.view=T.view===null?null:Object.assign({},T.view),this}setViewOffset(T,g,u,O,z,W){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=T,this.view.fullHeight=g,this.view.offsetX=u,this.view.offsetY=O,this.view.width=z,this.view.height=W,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const T=(this.right-this.left)/(2*this.zoom),g=(this.top-this.bottom)/(2*this.zoom),u=(this.right+this.left)/2,O=(this.top+this.bottom)/2;let z=u-T,W=u+T,J=O+g,se=O-g;if(this.view!==null&&this.view.enabled){const Y=(this.right-this.left)/this.view.fullWidth/this.zoom,ie=(this.top-this.bottom)/this.view.fullHeight/this.zoom;z+=Y*this.view.offsetX,W=z+Y*this.view.width,J-=ie*this.view.offsetY,se=J-ie*this.view.height}this.projectionMatrix.makeOrthographic(z,W,J,se,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(T){const g=super.toJSON(T);return g.object.zoom=this.zoom,g.object.left=this.left,g.object.right=this.right,g.object.top=this.top,g.object.bottom=this.bottom,g.object.near=this.near,g.object.far=this.far,this.view!==null&&(g.object.view=Object.assign({},this.view)),g}};new OrthographicCamera;new Color;var PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI;new Vector3(-PHI,INV_PHI,0),new Vector3(PHI,INV_PHI,0),new Vector3(-INV_PHI,0,PHI),new Vector3(INV_PHI,0,PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(0,PHI,INV_PHI),new Vector3(-1,1,-1),new Vector3(1,1,-1),new Vector3(-1,1,1),new Vector3(1,1,1);var DepthTexture=class extends Texture{constructor(T,g,u,O,z,W,J,se,Y,ie=DepthFormat){if(ie!==DepthFormat&&ie!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");u===void 0&&ie===DepthFormat&&(u=UnsignedIntType),u===void 0&&ie===DepthStencilFormat&&(u=UnsignedInt248Type),super(null,O,z,W,J,se,ie,u,Y),this.isDepthTexture=!0,this.image={width:T,height:g},this.magFilter=J!==void 0?J:NearestFilter,this.minFilter=se!==void 0?se:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(T){return super.copy(T),this.compareFunction=T.compareFunction,this}toJSON(T){const g=super.toJSON(T);return this.compareFunction!==null&&(g.compareFunction=this.compareFunction),g}};new Texture;new DepthTexture(1,1);new DataArrayTexture;new Data3DTexture;new CubeTexture;new Matrix3;new Vector3;new Matrix4;new Vector3;new Vector3;new Vector3;new Vector3;new Vector2;new Vector2;new Matrix4;new Vector3;new Vector3;new Vector3;new Vector2;new Vector2;new Vector2;new Vector3;new Vector3;new Vector3;new Vector4;new Vector4;new Vector3;new Matrix4;new Vector3;new Sphere;new Matrix4;new Ray;new Matrix4;new Matrix4;new Matrix4;new Matrix4;new Box3;new Matrix4;new Mesh;new Sphere;new Matrix4;new Color(1,1,1);new Frustum;new Box3;new Sphere;new Vector3;new Vector3;new Vector3;new Mesh;new Vector3;new Vector3;new Matrix4;new Ray;new Sphere;new Vector3;new Vector3;new Vector3;new Vector3;new Matrix4;new Ray;new Sphere;new Vector3;new Vector3;new Vector3;new Vector3;new Vector3;new Triangle;var Cache$1={enabled:!1,files:{},add:function(T,g){this.enabled!==!1&&(this.files[T]=g)},get:function(T){if(this.enabled!==!1)return this.files[T]},remove:function(T){delete this.files[T]},clear:function(){this.files={}}},LoadingManager=class{constructor(T,g,u){const O=this;let z=!1,W=0,J=0,se;const Y=[];this.onStart=void 0,this.onLoad=T,this.onProgress=g,this.onError=u,this.itemStart=function(ie){J++,z===!1&&O.onStart!==void 0&&O.onStart(ie,W,J),z=!0},this.itemEnd=function(ie){W++,O.onProgress!==void 0&&O.onProgress(ie,W,J),W===J&&(z=!1,O.onLoad!==void 0&&O.onLoad())},this.itemError=function(ie){O.onError!==void 0&&O.onError(ie)},this.resolveURL=function(ie){return se?se(ie):ie},this.setURLModifier=function(ie){return se=ie,this},this.addHandler=function(ie,oe){return Y.push(ie,oe),this},this.removeHandler=function(ie){const oe=Y.indexOf(ie);return oe!==-1&&Y.splice(oe,2),this},this.getHandler=function(ie){for(let oe=0,fe=Y.length;oe<fe;oe+=2){const me=Y[oe],de=Y[oe+1];if(me.global&&(me.lastIndex=0),me.test(ie))return de}return null}}},DefaultLoadingManager=new LoadingManager,Loader=class{constructor(T){this.manager=T!==void 0?T:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(T,g){const u=this;return new Promise(function(O,z){u.load(T,O,g,z)})}parse(){}setCrossOrigin(T){return this.crossOrigin=T,this}setWithCredentials(T){return this.withCredentials=T,this}setPath(T){return this.path=T,this}setResourcePath(T){return this.resourcePath=T,this}setRequestHeader(T){return this.requestHeader=T,this}};Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";var ImageLoader=class extends Loader{constructor(T){super(T)}load(T,g,u,O){this.path!==void 0&&(T=this.path+T),T=this.manager.resolveURL(T);const z=this,W=Cache$1.get(T);if(W!==void 0)return z.manager.itemStart(T),setTimeout(function(){g&&g(W),z.manager.itemEnd(T)},0),W;const J=createElementNS("img");function se(){ie(),Cache$1.add(T,this),g&&g(this),z.manager.itemEnd(T)}function Y(oe){ie(),O&&O(oe),z.manager.itemError(T),z.manager.itemEnd(T)}function ie(){J.removeEventListener("load",se,!1),J.removeEventListener("error",Y,!1)}return J.addEventListener("load",se,!1),J.addEventListener("error",Y,!1),T.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(J.crossOrigin=this.crossOrigin),z.manager.itemStart(T),J.src=T,J}},TextureLoader=class extends Loader{constructor(T){super(T)}load(T,g,u,O){const z=new Texture,W=new ImageLoader(this.manager);return W.setCrossOrigin(this.crossOrigin),W.setPath(this.path),W.load(T,function(J){z.image=J,z.needsUpdate=!0,g!==void 0&&g(z)},u,O),z}};new Matrix4;new Vector3;new Vector3;new Matrix4;new Vector3;new Vector3;new Matrix4;new Matrix4;new Matrix4;new Vector3;new Vector3;new Vector3;new Vector3;new Vector3;new Vector3;var _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]";/((?:WC+[\/:])*)/.source.replace("WC",_wordChar);/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot);/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar);/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar);new Matrix4;new Vector2;new Vector3;new Vector3;new Vector3;new Vector3;new Matrix4;new Matrix4;new Vector3;new Color;new Color;new Vector3;new Vector3;new Vector3;new Vector3;new Camera;new Box3;new Vector3;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);/*! Bundled license information:

three/build/three.module.js:
  (**
   * @license
   * Copyright 2010-2024 Three.js Authors
   * SPDX-License-Identifier: MIT
   *)
*/new TextureLoader;let scrollSpeed=1;document.addEventListener("wheel",function(T){T.preventDefault();let g=T.deltaY,u=window.scrollY+g*scrollSpeed;window.scrollTo({top:u,behavior:"smooth"})},{passive:!1});async function setupViewer(){var ie,oe,fe,me,de,Pe,ue,He;const T=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("web-canvas")});await __webpackgi_exports__addBasePlugins(T);const g=await T.addPlugin(__webpackgi_exports__AssetManagerPlugin);T.renderer.refreshPipeline(),await T.setEnvironmentMap("./static/assets/autumn forest.hdr");const u=await T.load("./static/assets/BaseIDDLaptop.glb"),O=g.materials.findMaterialsByName("lambert1")[0],z=g.materials.findMaterialsByName("Screen")[0],W=new MeshBasicMaterial({map:new __webpackgi_exports__Texture(g.materials.findMaterialsByName("lambert2")[0]).Texture});(ie=document.querySelector(".red0"))==null||ie.addEventListener("click",()=>{J(new __webpackgi_exports__Color(13852014),"static/assets/PokemonIDDVid.mp4"),console.log("red pressed")}),(oe=document.querySelector(".green0"))==null||oe.addEventListener("click",()=>{J(new __webpackgi_exports__Color(5025616),"static/assets/MarioVid.mp4")}),(fe=document.querySelector(".blue0"))==null||fe.addEventListener("click",()=>{J(new __webpackgi_exports__Color(5201880),"static/assets/PacMadIDDVid.mp4")}),(me=document.querySelector(".black0"))==null||me.addEventListener("click",()=>{J(new __webpackgi_exports__Color(0),null)});function J(je,Fe,et){O.color=je,z.color=new __webpackgi_exports__Color(0),console.log(W.map),document.getElementById("changevid").src=Fe,T.scene.setDirty()}(de=document.querySelector(".red0"))==null||de.addEventListener("click",()=>{se("static/assets/CPokemon.png")}),(Pe=document.querySelector(".green0"))==null||Pe.addEventListener("click",()=>{se("static/assets/CMario.png")}),(ue=document.querySelector(".blue0"))==null||ue.addEventListener("click",()=>{se("static/assets/CPacMan.png")}),(He=document.querySelector(".black0"))==null||He.addEventListener("click",()=>{se("static/assets/CNorm.png")});function se(je){const Fe=g.materials.findMaterialsByName("lambert2")[0];if(!Fe){console.error('Material "lambert2" not found.');return}je?new TextureLoader().load(je,pt=>{Fe.map=pt,Fe.needsUpdate=!0,T.scene.setDirty()}):(Fe.map=null,Fe.needsUpdate=!0,T.scene.setDirty())}const Y=document.getElementById("rotationSlider");Y.addEventListener("input",function(){const je=Y.value*3.6;u?(u.rotation.y=je,T.scene.setDirty()):console.error("Model not found")}),Y.addEventListener("input",function(){console.log("Slider value:",Y.value)})}setupViewer();
